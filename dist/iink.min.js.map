{"version":3,"file":"iink.min.js","sources":["../src/Constants.ts","../src/utils/DeferredPromise.ts","../src/utils/math.ts","../src/utils/geometry.ts","../src/utils/version.ts","../src/utils/crypto.ts","../src/utils/units.ts","../src/utils/uuid.ts","../src/utils/object.ts","../src/utils/language.ts","../src/utils/quadratics.ts","../src/utils/infos.ts","../src/logger/logger.ts","../src/logger/LoggerManager.ts","../src/logger/LoggerConfiguration.ts","../src/editor/EditorEvent.ts","../src/model/Export.ts","../src/model/ExportV2.ts","../src/editor/EditorLayer.ts","../src/editor/AbstractEditor.ts","../src/symbol/Box.ts","../src/style/Style.ts","../src/style/PenStyle.ts","../src/style/Theme.ts","../node_modules/json-css/lib/jsoncss.min.js","../src/style/StyleHelper.ts","../src/style/StyleManager.ts","../src/symbol/IIDecorator.ts","../src/symbol/Symbol.ts","../src/symbol/geometry/IIEdge.ts","../src/symbol/geometry/IIShape.ts","../src/symbol/recognized/IIRecognizedBase.ts","../src/transform/Matrix.ts","../src/symbol/IISymbolBase.ts","../src/symbol/Point.ts","../src/symbol/geometry/IIEdgeArc.ts","../src/symbol/geometry/IIEdgeLine.ts","../src/symbol/geometry/IIEdgePolyLine.ts","../src/symbol/geometry/IIShapeCircle.ts","../src/symbol/geometry/IIShapeEllipse.ts","../src/symbol/geometry/IIShapePolygon.ts","../src/symbol/IIStroke.ts","../src/symbol/recognized/IIRecognizedArc.ts","../src/symbol/recognized/IIRecognizedCircle.ts","../src/symbol/recognized/IIRecognizedEllipse.ts","../src/symbol/recognized/IIRecognizedLine.ts","../src/symbol/recognized/IIRecognizedPolyLine.ts","../src/symbol/recognized/IIRecognizedPolygon.ts","../src/symbol/recognized/IIRecognizedText.ts","../src/symbol/IISymbolGroup.ts","../src/symbol/IIText.ts","../src/symbol/IIEraser.ts","../src/symbol/Stroke.ts","../src/model/Model.ts","../src/model/IIModel.ts","../src/model/IModel.ts","../src/recognizer/ServerConfiguration.ts","../src/recognizer/recognition/EraserConfiguration.ts","../src/recognizer/recognition/DiagramConfiguration.ts","../src/recognizer/recognition/ExportConfiguration.ts","../src/recognizer/recognition/MarginConfiguration.ts","../src/recognizer/recognition/MathConfiguration.ts","../src/recognizer/recognition/RawContentConfiguration.ts","../src/recognizer/recognition/RecognitionRendererConfiguration.ts","../src/recognizer/recognition/TextConfiguration.ts","../src/recognizer/recognition/TextConfigurationV2.ts","../src/recognizer/recognition/ShapeConfiguration.ts","../src/recognizer/recognition/MathV2Configuration.ts","../src/recognizer/recognition/RawContentV2Configuration.ts","../src/recognizer/RecognizerEvent.ts","../src/recognizer/RecognizerError.ts","../src/recognizer/RecognizerHTTPV1Configuration.ts","../src/recognizer/RecognizerHTTPV1.ts","../src/recognizer/RecognizerHTTPV2Configuration.ts","../src/recognizer/RecognizerHTTPV2.ts","../src/recognizer/RecognizerWebSocketMessage.ts","../src/recognizer/RecognizerWebSocketConfiguration.ts","../src/recognizer/RecognizerWebSocket.ts","../src/recognizer/RecognizerWebSocketSSRConfiguration.ts","../src/recognizer/RecognizerWebSocketSSR.ts","../src/renderer/canvas/CanvasRendererShape.ts","../src/renderer/canvas/CanvasRendererStroke.ts","../src/renderer/canvas/CanvasRendererText.ts","../src/renderer/canvas/CanvasRenderer.ts","../src/renderer/svg/SVGRendererConst.ts","../src/renderer/svg/SVGBuilder.ts","../src/renderer/svg/SVGRendererEdgeUtil.ts","../src/renderer/svg/SVGRendererEraserUtil.ts","../src/renderer/svg/SVGRendererDecoratorUtil.ts","../src/renderer/svg/SVGRendererShapeUtil.ts","../src/renderer/svg/SVGRendererStrokeUtil.ts","../src/renderer/svg/SVGRendererTextUtil.ts","../src/renderer/svg/SVGRendererRecognizedUtil.ts","../src/renderer/svg/SVGRendererGroupUtil.ts","../src/renderer/svg/SVGRenderer.ts","../src/renderer/svg/SVGStroker.ts","../src/renderer/svg/SVGSSRenderer.ts","../src/renderer/RendererConfiguration.ts","../src/grabber/GrabberConfiguration.ts","../src/grabber/PointerEventGrabber.ts","../src/manager/AbstractWriterManager.ts","../src/manager/IIConversionManager.ts","../src/manager/IIResizeManager.ts","../src/manager/IIRotationManager.ts","../src/manager/IISelectionManager.ts","../src/manager/IITextManager.ts","../src/manager/IITranslateManager.ts","../src/manager/IIWriterManager.ts","../src/manager/IIDebugSVGManager.ts","../src/manager/IIMoveManager.ts","../src/manager/IDebugSVGManager.ts","../src/manager/EraseManager.ts","../src/history/HistoryContext.ts","../src/history/HistoryManager.ts","../src/history/IIHistoryManager.ts","../src/history/IHistoryManager.ts","../src/history/HistoryConfiguration.ts","../src/menu/MenuHelper.ts","../src/menu/IIMenu.ts","../src/gesture/Gesture.ts","../src/gesture/GestureConfiguration.ts","../src/gesture/IIGestureManager.ts","../src/menu/IIMenuSub.ts","../src/menu/IIMenuAction.ts","../src/menu/IIMenuTool.ts","../src/menu/IIMenuStyle.ts","../src/menu/IIMenuContext.ts","../src/menu/MenuConfiguration.ts","../src/menu/IIMenuManager.ts","../src/snap/IISnapConfiguration.ts","../src/snap/IISnapManager.ts","../src/editor/InteractiveInkEditorConfiguration.ts","../src/editor/InteractiveInkEditor.ts","../src/editor/EditorTriggerConfiguration.ts","../src/editor/InkEditorDeprecatedConfiguration.ts","../src/editor/InkEditorDeprecated.ts","../src/smartguide/InteractiveInkSSRSmartGuide.ts","../src/editor/InteractiveInkSSREditorConfiguration.ts","../src/editor/InteractiveInkSSREditor.ts","../src/editor/InkEditorConfiguration.ts","../src/manager/IWriterManager.ts","../src/editor/InkEditor.ts","../src/editor/Editor.ts","../src/recognizer/recognition/ConvertionConfiguration.ts","../src/utils/font.ts"],"sourcesContent":["/**\n * @group Editor\n * @summary\n * List the possibilities of interactions\n */\nexport enum EditorTool\n{\n  Write = \"write\",\n  Erase = \"erase\",\n  /**\n   * @remarks only usable in the case of offscreen\n   */\n  Select = \"select\",\n  /**\n   * @remarks only usable in the case of offscreen\n   */\n  Move = \"move\"\n}\n\n/**\n * @group Editor\n * @summary\n * List all the shapes that can be drawn\n * @remarks\n * only usable in the case of offscreen\n */\nexport enum EditorWriteTool\n{\n  Pencil = \"pencil\",\n  Rectangle = \"rectangle\",\n  Rhombus = \"rhombus\",\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Triangle = \"triangle\",\n  Parallelogram = \"parallelogram\",\n  Line = \"line\",\n  Arrow = \"arrow\",\n  DoubleArrow = \"double-arrow\",\n}\n\n/**\n * @group Renderer\n * @summary\n * List all svg elements roles\n * @remarks\n * only usable in the case of offscreen\n */\nexport enum SvgElementRole\n{\n  Guide = \"guide\",\n  InteractElementsGroup = \"interact-elements-group\",\n  Translate = \"translate\",\n  Resize = \"resize\",\n  Rotate = \"rotate\",\n}\n\n/**\n * @group Renderer\n * @summary\n * List all svg elements resize direction\n * @remarks\n * only usable in the case of offscreen\n */\nexport const enum ResizeDirection\n{\n  North = \"n-resize\",\n  East = \"e-resize\",\n  South = \"s-resize\",\n  West = \"w-resize\",\n  NorthEast = \"ne-resize\",\n  NorthWest = \"nw-resize\",\n  SouthEast = \"se-resize\",\n  SouthWest = \"sw-resize\"\n}\n\n/**\n * @group Renderer\n */\nexport const SELECTION_MARGIN = 10 as const\n","\n/**\n * @group Utils\n */\nexport class DeferredPromise<T> {\n  promise: Promise<T>\n  resolve!: (value: T) => void\n  reject!: (value: Error | string) => void\n\n  isFullFilled: boolean\n  isPending: boolean\n\n\n  constructor()\n  {\n    this.isFullFilled = false\n    this.isPending = true\n\n    this.promise = new Promise((resolve, reject) =>\n    {\n      this.reject = async (v: unknown) =>\n      {\n        this.isFullFilled = true\n        this.isPending = false\n        return reject(v)\n      }\n      this.resolve = async (v: unknown) =>\n      {\n        this.isFullFilled = true\n        this.isPending = false\n        return resolve(v as T)\n      }\n    })\n  }\n}\n","/**\n * @group Utils\n */\nexport function isValidNumber(x: unknown): boolean\n{\n  if (x === undefined || x === null) return false\n  return !isNaN(parseFloat(x.toString())) && isFinite(+x)\n}\n/**\n * @group Utils\n */\nexport function isBetween(val: number, min: number, max: number): boolean\n{\n  return val >= min && val <= max\n}\n\n/**\n * @group Utils\n */\nexport function computeAverage(arr: number[]): number\n{\n  return arr.reduce((p, c) => p + c, 0) / (arr.length || 1)\n}\n","import { TBox, TPoint, TSegment } from \"../symbol\"\nimport { isBetween } from \"./math\"\n\n/**\n * @group Utils\n */\nexport function computeDistance(p1: TPoint, p2: TPoint): number\n{\n  const distance = Math.hypot(p2.y - p1.y, p2.x - p1.x)\n  return isNaN(distance) ? 0 : distance\n}\n\n/**\n * @group Utils\n * @remarks Faster than computeDistance when comparing distances (avoids sqrt)\n */\nexport function computeDistanceSquared(p1: TPoint, p2: TPoint): number\n{\n  const dx = p2.x - p1.x\n  const dy = p2.y - p1.y\n  return dx * dx + dy * dy\n}\n\n/**\n * @group Utils\n */\nexport function computeAngleAxeRadian(begin: TPoint, end: TPoint): number\n{\n  return Math.atan2(end.y - begin.y, end.x - begin.x)\n}\n\n/**\n * @group Utils\n */\nexport function createPointsOnSegment(p1: TPoint, p2: TPoint, spaceBetweenPoint = 1): TPoint[]\n{\n  const points: TPoint[] = []\n  const globalDistance = computeDistance(p1, p2)\n  let spaceWithP1 = spaceBetweenPoint\n  while (spaceWithP1 < globalDistance) {\n    const p = {\n      x: p1.x + (spaceWithP1 * (p2.x - p1.x)) / globalDistance,\n      y: p1.y + (spaceWithP1 * (p2.y - p1.y)) / globalDistance\n    }\n    points.push(p)\n    spaceWithP1 += spaceBetweenPoint\n  }\n  return points\n}\n\n/**\n * @group Utils\n */\nexport function scalaire(v1: TPoint, v2: TPoint): number\n{\n  return v1.x * v2.x + v1.y * v2.y\n}\n\n/**\n * @group Utils\n */\nexport function computeNearestPointOnSegment(p: TPoint, seg: TSegment): TPoint\n{\n  const vectP1P = { x: p.x - seg.p1.x, y: p.y - seg.p1.y }\n  const vectP1P2 = { x: seg.p2.x - seg.p1.x, y: seg.p2.y - seg.p1.y }\n  if (vectP1P2.x === 0 && vectP1P2.y === 0) {\n    return seg.p1\n  }\n  const scalaireP1P_P1P2 = scalaire(vectP1P, vectP1P2)\n  const scalaireP1P2_P1P2 = scalaire(vectP1P2, vectP1P2)\n\n  const t = Math.min(1, Math.max(0, scalaireP1P_P1P2 / scalaireP1P2_P1P2))\n  return { x: seg.p1.x + (vectP1P2.x * t), y: seg.p1.y + (vectP1P2.y * t) }\n}\n\n/**\n * @group Utils\n */\nexport function isPointInsideBox(point: TPoint, box: TBox): boolean\n{\n  return isBetween(point.x, box.x, box.x + box.width) && isBetween(point.y, box.y, box.y + box.height)\n}\n\n/**\n * @group Utils\n */\nexport function convertRadianToDegree(radian: number): number\n{\n  return +((radian % (2 * Math.PI)) / Math.PI * 180).toFixed(4)\n}\n\n/**\n * @group Utils\n */\nexport function convertDegreeToRadian(degree: number): number\n{\n  return +((degree % 360) / 180 * Math.PI).toFixed(4)\n}\n\n/**\n * @group Utils\n */\nexport function computeRotatedPoint(point: TPoint, center: TPoint, radian: number): TPoint\n{\n  const dx = point.x - center.x\n  const dy = point.y - center.y\n  const cos = Math.cos(radian)\n  const sin = Math.sin(radian)\n  return {\n    x: +(center.x + cos * dx - sin * dy).toFixed(3),\n    y: +(center.y + sin * dx + cos * dy).toFixed(3)\n  }\n}\n\n/**\n * @group Utils\n */\nexport function computePointOnEllipse(center: TPoint, radiusX: number, radiusY: number, phi: number, theta: number): TPoint\n{\n  const cosPhi = Math.cos(phi)\n  const sinPhi = Math.sin(phi)\n\n  const M = Math.abs(radiusX) * Math.cos(theta)\n  const N = Math.abs(radiusY) * Math.sin(theta)\n\n  return {\n    x: +(center.x + cosPhi * M - sinPhi * N).toFixed(3),\n    y: +(center.y + sinPhi * M + cosPhi * N).toFixed(3)\n  }\n}\n\n/**\n * @group Utils\n */\nexport function computeDistanceBetweenPointAndSegment(p: TPoint, seg: TSegment): number\n{\n  return computeDistance(p, computeNearestPointOnSegment(p, seg))\n}\n\n/**\n * @group Utils\n */\nexport function findIntersectionBetween2Segment(seg1: TSegment, seg2: TSegment): TPoint | undefined\n{\n\n  if (seg1.p1.x === seg2.p1.x && seg1.p1.y === seg2.p1.y) return seg1.p1\n  if (seg1.p1.x === seg2.p2.x && seg1.p1.y === seg2.p2.y) return seg1.p1\n\n  if (seg1.p2.x === seg2.p1.x && seg1.p2.y === seg2.p1.y) return seg1.p2\n  if (seg1.p2.x === seg2.p2.x && seg1.p2.y === seg2.p2.y) return seg1.p2\n\n  const S1dx = seg1.p2.x - seg1.p1.x\n  const S1dy = seg1.p2.y - seg1.p1.y\n\n  const S2dx = seg2.p2.x - seg2.p1.x\n  const S2dy = seg2.p2.y - seg2.p1.y\n\n  const S1S2dx = seg1.p1.x - seg2.p1.x\n  const S1S2dy = seg1.p1.y - seg2.p1.y\n\n  const ua_t = S2dx * S1S2dy - S2dy * S1S2dx\n  const ub_t = S1dx * S1S2dy - S1dy * S1S2dx\n  const u_b = S2dy * S1dx - S2dx * S1dy\n\n  if (ua_t === 0 || ub_t === 0 || u_b === 0) return\n\n  const ua = ua_t / u_b\n  const ub = ub_t / u_b\n  if (isBetween(ua, 0, 1) && isBetween(ub, 0, 1)) {\n    return {\n      x: seg1.p1.x + ua * S1dx,\n      y: seg1.p1.y + ua * S1dy\n    }\n  }\n  return\n}\n\n/**\n * @group Utils\n */\nexport function findIntersectBetweenSegmentAndCircle(seg: TSegment, c: TPoint, r: number): TPoint[]\n{\n  const result: TPoint[] = []\n\n  const dx = seg.p2.x - seg.p1.x\n  const dy = seg.p2.y - seg.p1.y\n  const fx = seg.p1.x - c.x\n  const fy = seg.p1.y - c.y\n\n  const a = dx * dx + dy * dy\n  const b = 2 * (dx * fx + dy * fy)\n  const cc = fx * fx + fy * fy - r * r\n  const deter = Math.pow(b, 2) - 4 * a * cc\n\n  if (deter <= 0) return []\n\n  const e = Math.sqrt(deter)\n  const u1 = (-b + e) / (2 * a)\n  const u2 = (-b - e) / (2 * a)\n\n  if ((u1 < 0 || u1 > 1) && (u2 < 0 || u2 > 1)) {\n    return result\n  }\n\n  if (isBetween(u1, 0, 1)) {\n    result.push({\n      x: (seg.p2.x - seg.p1.x) * u1 + seg.p1.x,\n      y: (seg.p2.y - seg.p1.y) * u1 + seg.p1.y\n    })\n  }\n\n  if (isBetween(u2, 0, 1)) {\n    result.push({\n      x: (seg.p2.x - seg.p1.x) * u2 + seg.p1.x,\n      y: (seg.p2.y - seg.p1.y) * u2 + seg.p1.y\n    })\n  }\n\n  return result\n}\n\n/**\n * @group Utils\n */\nexport function computeAngleRadian(p1: TPoint, center: TPoint, p2: TPoint): number\n{\n  const p1c = Math.hypot(center.x - p1.x, center.y - p1.y)\n  const p2c = Math.hypot(center.x - p2.x, center.y - p2.y)\n  const p1p2 = Math.hypot(p2.x - p1.x, p2.y - p1.y)\n  return Math.acos((p2c * p2c + p1c * p1c - p1p2 * p1p2) / (2 * p2c * p1c))\n}\n\n/**\n * @group Utils\n */\nexport function getClosestPoints(points1: TPoint[], points2: TPoint[]): { p1: TPoint, p2: TPoint }\n{\n  let minDistanceSquared = Number.MAX_SAFE_INTEGER\n  let result = { p1: points1[0], p2: points2[0] }\n\n  for (const _p1 of points1) {\n    for (const _p2 of points2) {\n      const dSquared = computeDistanceSquared(_p1, _p2)\n      if (dSquared < minDistanceSquared) {\n        minDistanceSquared = dSquared\n        result = { p1: _p1, p2: _p2 }\n      }\n    }\n  }\n  return result\n}\n\n/**\n * @group Utils\n */\nexport function getClosestPoint(points: TPoint[], point: TPoint): { point?: TPoint, index: number }\n{\n  let minDistanceSquared = Number.MAX_SAFE_INTEGER\n  let closest: TPoint | undefined\n  let index = -1\n\n  for (let i = 0; i < points.length; i++) {\n    const dSquared = computeDistanceSquared(points[i], point)\n    if (dSquared < minDistanceSquared) {\n      minDistanceSquared = dSquared\n      closest = points[i]\n      index = i\n    }\n  }\n  return { point: closest, index }\n}\n\n/**\n * @group Utils\n */\nexport function isPointInsidePolygon(point: TPoint, points: TPoint[])\n{\n  let inside = false\n  for (let i = 0, j = points.length - 1; i < points.length; j = i++) {\n    const p1 = points[i]\n    const p2 = points[j]\n    const intersect = ((p1.y > point.y) != (p2.y > point.y))\n      && (point.x < (p2.x - p1.x) * (point.y - p1.y) / (p2.y - p1.y) + p1.x)\n    if (intersect) inside = !inside\n  }\n\n  return inside\n}\n","\n/**\n * @group Utils\n */\nexport const isVersionSuperiorOrEqual = (source: string, target: string): boolean =>\n{\n  const sourceParts = source.split(\".\")\n  const targetParts = target.split(\".\")\n\n  for (let i = 0; i < targetParts.length; i++) {\n    const a = Number(targetParts[i])\n    const b = Number(sourceParts[i])\n    if (a > b) return false\n    if (a < b) return true\n  }\n  return true\n}\n","/**\n * @group Utils\n */\nexport async function computeHmac(message: string, applicationKey: string, hmacKey: string): Promise<string>\n{\n  const enc = new TextEncoder()\n  const messageEncoded = enc.encode(message)\n  const keyEncoded = enc.encode(applicationKey + hmacKey)\n\n  const key = await crypto.subtle.importKey(\n    \"raw\",\n    keyEncoded,\n    {\n      name: \"HMAC\",\n      hash: { name: \"SHA-512\" }\n    },\n    false,\n    [\"sign\"]\n  )\n\n  const signature = await crypto.subtle.sign(\n    \"HMAC\",\n    key,\n    messageEncoded\n  )\n\n  const buffer = new Uint8Array(signature)\n  return Array.prototype.map.call(buffer, x => x.toString(16).padStart(2, \"0\")).join(\"\")\n}\n","import { TBox } from \"../symbol\"\n\nconst MM_TO_PX_RATIO = 96 / 25.4\nconst PX_TO_MM_RATIO = 25.4 / 96\n\n/**\n * @group Utils\n */\nexport function convertMillimeterToPixel(mm: number): number\n{\n  return +(mm * MM_TO_PX_RATIO).toFixed(3)\n}\n\n/**\n * @group Utils\n */\nexport function convertPixelToMillimeter(px: number): number\n{\n  return +(px * PX_TO_MM_RATIO).toFixed(3)\n}\n\n/**\n * @group Utils\n */\nexport function convertBoundingBoxMillimeterToPixel(box?: TBox): TBox\n{\n  if (!box) {\n    return { height: 0, width: 0, x: 0, y: 0}\n  }\n  return {\n    x: convertMillimeterToPixel(box.x),\n    y: convertMillimeterToPixel(box.y),\n    width: convertMillimeterToPixel(box.width),\n    height: convertMillimeterToPixel(box.height),\n  }\n}\n","\n/**\n * @group Utils\n */\nexport function createUUID(): string\n{\n  let dt = Date.now()\n  const uuid = \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function (c)\n  {\n    const r = (dt + Math.random() * 16) % 16 | 0\n    dt = Math.floor(dt / 16)\n    return (c == \"x\" ? r : (r & 0x3 | 0x8)).toString(16)\n  })\n  return uuid\n}\n","\n/**\n * @group Utils\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const mergeDeep = (target: any, ...sources: any[]): any =>\n{\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const isObject = (item: any) =>\n  {\n    return (item && typeof item === \"object\" && !Array.isArray(item))\n  }\n  if (!sources.length) return target\n  const source = sources.shift()\n\n  if (isObject(target) && isObject(source)) {\n    for (const key in source) {\n      if (isObject(source[key])) {\n        if (!target[key]) {\n          Object.assign(target, { [key]: {} })\n        }\n        mergeDeep(target[key], source[key])\n      }\n      else if (Array.isArray(target[key]) && Array.isArray(source[key])) {\n        target[key] = target[key].concat(source[key])\n      }\n      else {\n        Object.assign(target, { [key]: source[key] })\n      }\n    }\n  }\n  else if (Array.isArray(target) && Array.isArray(source)) {\n    target = target.concat(source)\n  }\n  else if (source) {\n    target = source\n  }\n\n  return mergeDeep(target, ...sources)\n}\n\n/**\n * @group Utils\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const isDeepEqual = (object1: any, object2: any) =>\n{\n  const objKeys1 = Object.keys(object1)\n  const objKeys2 = Object.keys(object2)\n\n  if (objKeys1.length !== objKeys2.length) return false\n\n  for (const key of objKeys1) {\n    const value1 = object1[key]\n    const value2 = object2[key]\n\n    const isObjects = isObject(value1) && isObject(value2)\n\n    if (\n      (isObjects && !isDeepEqual(value1, value2)) ||\n      (!isObjects && value1 !== value2)\n    ) {\n      return false\n    }\n  }\n  return true\n}\n\n/**\n * @group Utils\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst isObject = (object: any) =>\n{\n  return object && typeof object === \"object\"\n}\n","import { TServerHTTPConfiguration } from \"../recognizer\"\nimport { PartialDeep } from \"./types\"\n\n/**\n * @group Utils\n */\nexport async function getAvailableLanguageList(configuration: PartialDeep<{ server: TServerHTTPConfiguration }>): Promise<{ result: { [key: string]: string } }>\n{\n  if (configuration?.server?.scheme && configuration?.server?.host) {\n    const serverConfig = configuration.server\n    const response = await fetch(`${ serverConfig.scheme }://${ serverConfig.host }/api/v4.0/iink/availableLanguageList`)\n    return response.json()\n  } else {\n    return Promise.reject(\"Failed to get languages: configuration.server.scheme & configuration.server.host are required!\")\n  }\n}\n","import { TPoint, TPointer } from \"../symbol\"\n\n/**\n * @group Utils\n */\nexport function computeLinksPointers(point: TPointer, angle: number, width: number): TPoint[]\n{\n  const radius = point.p * width\n  return [\n    {\n      x: +(point.x - (Math.sin(angle) * radius)).toFixed(3),\n      y: +(point.y + (Math.cos(angle) * radius)).toFixed(3)\n    },\n    {\n      x: +(point.x + (Math.sin(angle) * radius)).toFixed(3),\n      y: +(point.y - (Math.cos(angle) * radius)).toFixed(3),\n    }\n  ]\n}\n\n/**\n * @group Utils\n */\nexport function computeMiddlePointer(point1: TPointer, point2: TPointer): TPointer\n{\n  return {\n    x: +((point2.x + point1.x) / 2).toFixed(3),\n    y: +((point2.y + point1.y) / 2).toFixed(3),\n    p: +((point2.p + point1.p) / 2).toFixed(3),\n    t: +((point2.t + point1.t) / 2).toFixed(3),\n  }\n}\n","import { TServerHTTPConfiguration } from \"../recognizer\"\nimport { PartialDeep } from \"./types\"\n\n/**\n * @group Utils\n */\nexport type TApiInfos = {\n  version: string,\n  gitCommit: string,\n  nativeVersion: string\n}\n\n/**\n * @group Utils\n */\nexport async function getApiInfos(configuration?: PartialDeep<{ server: TServerHTTPConfiguration }>): Promise<TApiInfos>\n{\n  try {\n    if (!configuration?.server?.scheme && !configuration?.server?.host) {\n      return Promise.reject(\"Failed to get infos: configuration.server.scheme & configuration.server.host are required!\")\n    }\n    const response = await fetch(`${ configuration.server.scheme }://${ configuration.server.host }/api/v4.0/iink/version`)\n    if (response.ok) {\n      const version = await response.json() as TApiInfos\n      return version\n    }\n    else {\n      //latest version published before this endpoint\n      return { version: \"3.1.3\", gitCommit: \"unknown\", nativeVersion: \"<=3.1.1\" }\n    }\n\n  } catch {\n    //latest version published before this endpoint\n    return { version: \"3.1.3\", gitCommit: \"7e148bd566438ca77dc83cb4edcc6ed0f51a8a15\", nativeVersion: \"<=3.1.1\" }\n   }\n\n}\n","/**\n * @group Logger\n */\nexport enum LoggerLevel\n{\n  DEBUG = \"1\",\n  INFO = \"2\",\n  WARN = \"3\",\n  ERROR = \"4\"\n}\n\n/**\n * @group Logger\n */\nexport enum LoggerCategory\n{\n  EDITOR = \"EDITOR\",\n  RECOGNIZER = \"RECOGNIZER\",\n  GRABBER = \"GRABBER\",\n  GESTURE = \"GESTURE\",\n  EDITOR_EVENT = \"EDITOR_EVENT\",\n  MODEL = \"MODEL\",\n  RENDERER = \"RENDERER\",\n  SMARTGUIDE = \"SMARTGUIDE\",\n  STYLE = \"STYLE\",\n  HISTORY = \"HISTORY\",\n  SYMBOL = \"SYMBOL\",\n  WRITE = \"WRITE\",\n  TRANSFORMER = \"TRANSFORMER\",\n  CONVERTER = \"CONVERTER\",\n  SELECTION = \"SELECTION\",\n  SVGDEBUG = \"SVGDEBUG\",\n  MENU = \"MENU\"\n}\n\n/**\n * @group Logger\n */\nexport class Logger\n{\n  category: LoggerCategory\n  level: LoggerLevel\n\n  constructor(category: LoggerCategory, level: LoggerLevel)\n  {\n    this.category = category\n    this.level = level\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  debug(functionName: string, ...data: any)\n  {\n    if (LoggerLevel.DEBUG >= this.level) {\n      const dataLog = {\n        level: \"debug\",\n        from: `${ this.category }.${ functionName }`,\n        message: data,\n      }\n      console.debug(dataLog)\n    }\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  info(functionName: string, ...data: any)\n  {\n    if (LoggerLevel.INFO >= this.level) {\n      const dataLog = {\n        level: \"info\",\n        from: `${ this.category }.${ functionName }`,\n        message: data,\n      }\n      console.info(dataLog)\n    }\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  warn(functionName: string, ...data: any)\n  {\n    if (LoggerLevel.WARN >= this.level) {\n      const dataLog = {\n        level: \"warn\",\n        from: `${ this.category }.${ functionName }`,\n        message: data,\n      }\n      console.warn(dataLog)\n    }\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  error(functionName: string, ...error: any)\n  {\n    const dataLog = {\n      level: \"error\",\n      from: `${ this.category }.${ functionName }`,\n      message: error,\n    }\n    console.error(dataLog)\n  }\n}\n","import { TLoggerConfiguration } from \"./LoggerConfiguration\"\nimport { Logger, LoggerCategory, LoggerLevel } from \"./logger\"\n\n/**\n * @group Logger\n */\nexport class LoggerManager\n{\n  static #loggerMap: Map<LoggerCategory, Logger> = new Map()\n\n  static getLogger(name: LoggerCategory): Logger\n  {\n    if (!this.#loggerMap.has(name)) {\n      this.#loggerMap.set(name, new Logger(name, LoggerLevel.ERROR))\n    }\n    return this.#loggerMap.get(name) as Logger\n  }\n\n  static setLoggerLevel(config: TLoggerConfiguration)\n  {\n    for (const lc in config) {\n      LoggerManager.getLogger(lc as LoggerCategory).level = config[lc as LoggerCategory]\n    }\n  }\n}\n","import { LoggerCategory, LoggerLevel } from \"./logger\"\n\n/**\n * @group Logger\n */\nexport type TLoggerConfiguration = {\n  [key in keyof typeof LoggerCategory]: LoggerLevel\n}\n\n/**\n * @group Logger\n * @source\n */\nexport const DefaultLoggerConfiguration: TLoggerConfiguration = {\n  [LoggerCategory.EDITOR]: LoggerLevel.ERROR,\n  [LoggerCategory.RECOGNIZER]: LoggerLevel.ERROR,\n  [LoggerCategory.GRABBER]: LoggerLevel.ERROR,\n  [LoggerCategory.RENDERER]: LoggerLevel.ERROR,\n  [LoggerCategory.EDITOR_EVENT]: LoggerLevel.ERROR,\n  [LoggerCategory.MODEL]: LoggerLevel.ERROR,\n  [LoggerCategory.SYMBOL]: LoggerLevel.ERROR,\n  [LoggerCategory.SMARTGUIDE]: LoggerLevel.ERROR,\n  [LoggerCategory.GESTURE]: LoggerLevel.ERROR,\n  [LoggerCategory.STYLE]: LoggerLevel.ERROR,\n  [LoggerCategory.HISTORY]: LoggerLevel.ERROR,\n  [LoggerCategory.TRANSFORMER]: LoggerLevel.ERROR,\n  [LoggerCategory.CONVERTER]: LoggerLevel.ERROR,\n  [LoggerCategory.WRITE]: LoggerLevel.ERROR,\n  [LoggerCategory.SELECTION]: LoggerLevel.ERROR,\n  [LoggerCategory.SVGDEBUG]: LoggerLevel.ERROR,\n  [LoggerCategory.MENU]: LoggerLevel.ERROR,\n}\n","import { EditorTool } from \"../Constants\"\nimport { LoggerManager, LoggerCategory } from \"../logger\"\nimport { TExport, TExportV2 } from \"../model\"\nimport { IIStroke, TIISymbol, TSymbol } from \"../symbol\"\nimport { THistoryContext } from \"../history\"\nimport { TGestureType } from \"../gesture\"\n\n/**\n * @group Editor\n * @remarks Lists all events that can be listened to on the editor or DOM element\n * @example\n * You can run code on \"EditorEventName\" raised by using\n * ```ts\n * editor.event.addEventListener(EditorEventName.CHANGED, (evt) => console.log(evt.detail))\n * ```\n */\nexport enum EditorEventName\n{\n  /**\n   * @remarks event emitted when history has changed i.e. the context of undo-redo\n   */\n  CHANGED = \"changed\",\n  /**\n   * @remarks event emitted when clearing is complete\n   */\n  CLEARED = \"cleared\",\n  /**\n   * @remarks event emitted after the conversion is complete\n   */\n  CONVERTED = \"converted\",\n  /**\n   * @remarks event emitted when the editor encounters an error\n   */\n  ERROR = \"error\",\n  /**\n   * @remarks event emitted on click on pointer events\n   */\n  POINTEREVENTS = \"pointer_events\",\n  /**\n   * @remarks event emitted after\n   */\n  NOTIF = \"notif\",\n  /**\n   * @remarks event emitted after the end of the export\n   */\n  EXPORTED = \"exported\",\n  /**\n   * @remarks event emitted after the end of the import\n   */\n  IMPORTED = \"imported\",\n  /**\n   * @remarks event emitted when the server is idle after a job\n   */\n  IDLE = \"idle\",\n  /**\n   * @remarks event emitted after full editor initialization\n   */\n  LOADED = \"loaded\",\n  /**\n   * @remarks event emitted session opened\n   */\n  SESSION_OPENED = \"session-opened\",\n  /**\n   * @remarks event emitted after selection change\n   */\n  SELECTED = \"selected\",\n  /**\n   * @remarks event emitted after tool change\n   */\n  TOOL_CHANGED = \"tool-changed\",\n  /**\n   * @remarks event emitted after mode change\n   */\n  UI_UPDATED = \"ui-updated\",\n  /**\n   * @remarks event emitted after stroke synchronized with jiix\n   */\n  SYNCHRONIZED = \"synchronized\",\n  /**\n   * @remarks event emitted after applying a gesture\n   */\n  GESTURED = \"gestured\"\n}\n\n/**\n * @group Editor\n */\nexport class EditorEvent extends EventTarget\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.EDITOR_EVENT);\n  protected abortController: AbortController\n  element: Element\n\n  constructor(element: Element)\n  {\n    super()\n    this.#logger.info(\"constructor\", { element })\n    this.abortController = new AbortController()\n    this.element = element\n  }\n\n  removeAllListeners(): void\n  {\n    this.#logger.info(\"removeAllListeners\")\n    this.abortController.abort()\n    this.abortController = new AbortController()\n  }\n\n  protected emit(type: string, data?: unknown): void\n  {\n    const evt = new CustomEvent(type, Object.assign({ bubbles: true, composed: true }, data ? { detail: data } : undefined))\n    this.dispatchEvent(evt)\n    this.element?.dispatchEvent(evt)\n  }\n\n  emitSessionOpened(sessionId: string): void\n  {\n    this.#logger.info(\"emitSessionOpened\")\n    this.emit(EditorEventName.SESSION_OPENED, sessionId)\n  }\n  addSessionOpenedListener(callback: (sessionId: string) => void): void\n  {\n    this.#logger.info(\"addSessionOpenedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.SESSION_OPENED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as string),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitLoaded(): void\n  {\n    this.#logger.info(\"emitLoaded\")\n    this.emit(EditorEventName.LOADED)\n  }\n  addLoadedListener(callback: () => void): void\n  {\n    this.#logger.info(\"addLoadedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.LOADED,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitNotif(notif: { message: string; timeout?: number }): void\n  {\n    this.#logger.info(\"emitNotif\", { notif })\n    this.emit(EditorEventName.NOTIF, notif)\n  }\n  addNotifListener(callback: (notif: { message: string; timeout?: number }) => void): void\n  {\n    this.#logger.info(\"addNotifListener\", { callback })\n    this.addEventListener(\n      EditorEventName.NOTIF,\n      (evt: unknown) => callback((evt as CustomEvent).detail as { message: string; timeout?: number }),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitError(err: Error): void\n  {\n    this.#logger.info(\"emitError\", { err })\n    this.emit(EditorEventName.ERROR, err)\n  }\n  addErrorListener(callback: (err: Error) => void): void\n  {\n    this.#logger.info(\"addErrorListener\", { callback })\n    this.addEventListener(\n      EditorEventName.ERROR,\n      (evt: unknown) => callback((evt as CustomEvent).detail as Error),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitExported(exports: TExport | TExportV2): void\n  {\n    this.#logger.info(\"emitExported\", { exports })\n    this.emit(EditorEventName.EXPORTED, exports)\n  }\n  addExportedListener(callback: (exports: TExport | TExportV2) => void): void\n  {\n    this.#logger.info(\"addExportedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.EXPORTED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TExport | TExportV2),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitChanged(undoRedoContext: THistoryContext): void\n  {\n    this.#logger.info(\"emitChanged\", { undoRedoContext })\n    this.emit(EditorEventName.CHANGED, {\n      ...undoRedoContext,\n      canClear: !undoRedoContext.empty\n    })\n  }\n  addChangedListener(callback: (context: THistoryContext) => void): void\n  {\n    this.#logger.info(\"addChangedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.CHANGED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as THistoryContext),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitIdle(idle: boolean): void\n  {\n    this.#logger.info(\"emitIdle\", { idle })\n    this.emit(EditorEventName.IDLE, idle)\n  }\n  addIdleListener(callback: (idle: boolean) => void): void\n  {\n    this.#logger.info(\"addIdleListener\", { callback })\n    this.addEventListener(\n      EditorEventName.IDLE,\n      (evt: unknown) => callback((evt as CustomEvent).detail as boolean),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitCleared(): void\n  {\n    this.#logger.info(\"emitCleared\")\n    this.emit(EditorEventName.CLEARED)\n  }\n  addClearedListener(callback: () => void): void\n  {\n    this.#logger.info(\"addClearedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.CLEARED,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitConverted(exports: TExport): void\n  {\n    this.#logger.info(\"emitConverted\", { exports })\n    this.emit(EditorEventName.CONVERTED, exports)\n  }\n  addConvertedListener(callback: (exports: TExport) => void): void\n  {\n    this.#logger.info(\"addConvertedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.CONVERTED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TExport),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitImported(exports: TExport): void\n  {\n    this.#logger.info(\"emitImported\", { exports })\n    this.emit(EditorEventName.IMPORTED, exports)\n  }\n  addImportedListener(callback: (exports: TExport) => void): void\n  {\n    this.#logger.info(\"addImportedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.IMPORTED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TExport),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitSelected(symbols: TSymbol[]): void\n  {\n    this.#logger.info(\"emitSelected\")\n    this.emit(EditorEventName.SELECTED, symbols)\n  }\n  addSelectedListener(callback: (symbols: TIISymbol[]) => void): void\n  {\n    this.#logger.info(\"addSelectedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.SELECTED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TIISymbol[]),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitToolChanged(mode: EditorTool): void\n  {\n    this.#logger.info(\"emitToolChanged\")\n    this.emit(EditorEventName.TOOL_CHANGED, mode)\n  }\n  addToolChangedListener(callback: (mode: EditorTool) => void): void\n  {\n    this.#logger.info(\"addToolChangedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.TOOL_CHANGED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as EditorTool),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitUIpdated(): void\n  {\n    this.#logger.info(\"emitUIpdated\")\n    this.emit(EditorEventName.UI_UPDATED)\n  }\n  addUIpdatedListener(callback: () => void): void\n  {\n    this.#logger.info(\"addUIpdatedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.UI_UPDATED,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitSynchronized(): void\n  {\n    this.#logger.info(\"emitSynchronized\")\n    this.emit(EditorEventName.SYNCHRONIZED)\n  }\n  addSynchronizedListener(callback: () => void): void\n  {\n    this.#logger.info(\"addSynchronizedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.SYNCHRONIZED,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitGestured(gesture: { gestureType: TGestureType, stroke: IIStroke }): void\n  {\n    this.#logger.info(\"emitSynchronized\")\n    this.emit(EditorEventName.GESTURED, gesture)\n  }\n  addGesturedListener(callback: (gesture: { gestureType: TGestureType, stroke: IIStroke }) => void): void\n  {\n    this.#logger.info(\"addSynchronizedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.GESTURED,\n      (evt) => callback((evt as CustomEvent).detail as { gestureType: TGestureType, stroke: IIStroke }),\n      { signal: this.abortController.signal }\n    )\n  }\n}\n","import { EdgeDecoration, TBox, TPoint } from \"../symbol\"\n\n/**\n * @group Exports\n * @remarks List all supported MIME types for export. Please note, the MIME types supported depend on the recognition type configured\n */\nexport enum ExportType\n{\n  JIIX = \"application/vnd.myscript.jiix\",\n  TEXT = \"text/plain\",\n  LATEX = \"application/x-latex\",\n  MATHML = \"application/mathml+xml\",\n  SVG = \"image/svg+xml\",\n  OFFICE_DOCUMENT = \"application/vnd.openxmlformats-officedocument.presentationml.presentation\"\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix  Element type}\n */\nexport enum JIIXELementType\n{\n  Text = \"Text\",\n  Node = \"Node\",\n  Edge = \"Edge\",\n  RawContent = \"Raw Content\",\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#diagram-item-blocks | Element node kind}\n */\nexport enum JIIXNodeKind\n{\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Rectangle = \"rectangle\",\n  Triangle = \"triangle\",\n  Parallelogram = \"parallelogram\",\n  Polygon = \"polygon\",\n  Rhombus = \"rhombus\",\n}\n\n/**\n * @group Exports\n */\nexport enum JIIXEdgeKind\n{\n  Line = \"line\",\n  PolyEdge = \"polyedge\",\n  Arc = \"arc\",\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#stroke-item | Stroke item}\n */\nexport type TJIIXStrokeItem = {\n  type: \"stroke\"\n  id: string\n  \"full-id\"?: string\n  timestamp?: string\n  X?: number[]\n  Y?: number[]\n  F?: number[]\n  T?: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXBase = {\n  \"bounding-box\"?: TBox\n  items?: TJIIXStrokeItem[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXElementBase<T = string> = TJIIXBase & {\n  id: string\n  type: T\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#word-object | Word object}\n */\nexport type TJIIXWord = TJIIXBase & {\n  id?: string\n  label: string\n  candidates?: string[]\n  \"first-char\"?: number\n  \"last-char\"?: number\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#character-object | Character object}\n */\nexport type TJIIXChar = TJIIXBase & {\n  label: string\n  candidates?: string[]\n  word: number\n  grid: TPoint[]\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#text-interpretation | Text Element }\n */\nexport type TJIIXLine = {\n  \"baseline-y\": number\n  \"first-char\"?: number\n  \"last-char\"?: number\n  \"x-height\": number\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#text-interpretation | Text Element }\n */\nexport type TJIIXTextElement = TJIIXElementBase<JIIXELementType.Text> & {\n  id: string\n  \"bounding-box\"?: TBox\n  label: string\n  words?: TJIIXWord[]\n  chars?: TJIIXChar[]\n  lines?: TJIIXLine[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeElementBase<K = string> = TJIIXElementBase<JIIXELementType.Node> & {\n  id: string\n  kind: K\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeCircle = TJIIXNodeElementBase<JIIXNodeKind.Circle> & {\n  id: string\n  cx: number\n  cy: number\n  r: number\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeEllipse = TJIIXNodeElementBase<JIIXNodeKind.Ellipse> & {\n  id: string\n  cx: number\n  cy: number\n  rx: number\n  ry: number\n  orientation: number\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeRectangle = TJIIXNodeElementBase<JIIXNodeKind.Rectangle> & {\n  id: string\n  height: number\n  width: number\n  x: number\n  y: number\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeTriangle = TJIIXNodeElementBase<JIIXNodeKind.Triangle> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeParrallelogram = TJIIXNodeElementBase<JIIXNodeKind.Parallelogram> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodePolygon = TJIIXNodeElementBase<JIIXNodeKind.Polygon> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeRhombus = TJIIXNodeElementBase<JIIXNodeKind.Rhombus> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeElement =\n  TJIIXNodeCircle |\n  TJIIXNodeEllipse |\n  TJIIXNodeRectangle |\n  TJIIXNodeTriangle |\n  TJIIXNodeParrallelogram |\n  TJIIXNodePolygon |\n  TJIIXNodeRhombus\n\n/**\n * @group Exports\n */\nexport type TJIIXEdgeElementBase<K = string> = TJIIXElementBase<JIIXELementType.Edge> & {\n  kind: K\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#line-item | Element line}\n */\nexport type TJIIXEdgeLine = TJIIXEdgeElementBase<JIIXEdgeKind.Line> & {\n  x1: number\n  x2: number\n  y1: number\n  y2: number\n  p1Decoration?: EdgeDecoration\n  p2Decoration?: EdgeDecoration\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXEdgePolyEdge = TJIIXEdgeElementBase<JIIXEdgeKind.PolyEdge> & {\n  edges: TJIIXEdgeLine[]\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#arc-item | Element arc}\n */\nexport type TJIIXEdgeArc = TJIIXEdgeElementBase<JIIXEdgeKind.Arc> & {\n  cx: number,\n  cy: number,\n  rx: number,\n  ry: number,\n  phi: number,\n  startAngle: number,\n  sweepAngle: number\n  startDecoration?: EdgeDecoration\n  endDecoration?: EdgeDecoration\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXEdgeElement =\n  TJIIXEdgeLine |\n  TJIIXEdgePolyEdge |\n  TJIIXEdgeArc\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/web/jiix | Exports}\n */\nexport type TJIIXElement =\n  TJIIXTextElement |\n  TJIIXNodeElement |\n  TJIIXEdgeElement\n\n/**\n * @group Exports\n */\nexport type TJIIXExport = {\n  type: string\n  id: string\n  \"bounding-box\"?: TBox\n  version: string\n  elements?: TJIIXElement[]\n  label?: string\n  words?: TJIIXWord[]\n  chars?: TJIIXChar[]\n}\n\n/**\n * @group Exports\n * @remarks\n * List all supported MIME types for export.\n *\n * Attention the MIME types supported depend on the {@link TRecognitionType | type of recognition}\n *\n * {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix | Documentation}\n */\nexport type TExport = {\n  /** @hidden */\n  [key: string]: unknown\n  /**\n   * @remarks vnd.myscript.jiix is used for text and raw-content exports\n   */\n  \"application/vnd.myscript.jiix\"?: TJIIXExport\n  /**\n   * @remarks text/plain is only use for text export\n   */\n  \"text/plain\"?: string\n  /**\n   * @remarks x-latex is only use for math export\n   * @see {@link https://katex.org/docs/browser.html | katex} to render\n   */\n  \"application/x-latex\"?: string\n  /**\n   * @remarks mathml+xml is only use for math export\n   * @see {@link https://www.w3.org/Math/whatIsMathML.html | Mathematical Markup Language}\n   */\n  \"application/mathml+xml\"?: string\n  /**\n   * @remarks svg+xml is only use for diagram export\n   */\n  \"image/svg+xml\"?: string\n  /**\n   * @remarks vnd.openxmlformats-officedocument.presentationml.presentation is only use for diagram export\n   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/Blob | Blob}\n   */\n  \"application/vnd.openxmlformats-officedocument.presentationml.presentation\"?: Blob\n}\n","import { TRecognitionV2Type } from \"../recognizer\"\nimport { TJIIXBase, TJIIXWord } from \"./Export\"\n\n/**\n * @group Exports\n * @remarks List all supported MIME types for export in RecognizersV2. Please note, the MIME types supported depend on the recognition type configured\n */\nexport enum ExportV2Type {\n  JIIX = \"application/vnd.myscript.jiix\",\n  TEXT = \"text/plain\",\n  LATEX = \"application/x-latex\",\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix  Element type}\n */\n\n\n/**\n * @group Exports\n*/\nexport type JIIXV2RangeItem = {\n  from: { stroke: number }\n  to: { stroke: number }\n}\n\n/**\n * @group Exports\n * @remarks Only in InkRecognizer () activated with recognition.export.JIIXV2.range = true\n */\nexport type JIIXV2Range = JIIXV2RangeItem[]\n\n/**\n * @group Exports\n */\nexport type JIIXV2Base = TJIIXBase & {\n  range?: JIIXV2Range\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ElementBase<T = TRecognitionV2Type> = JIIXV2Base & {\n  id: string\n  type: T\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2LineSpan = {\n  type: string\n  range: JIIXV2RangeItem[]\n  label: string\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2Line = {\n  type: string\n  range: JIIXV2RangeItem[]\n  label: string\n  spans: JIIXV2LineSpan[]\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#word-object | Word object}\n */\nexport type JIIXV2Expression = JIIXV2Base & TJIIXWord & {\n  lines: JIIXV2Line[]\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix#text-interpretation | Text Element }\n */\nexport type JIIXV2TextElement = JIIXV2ElementBase<\"Text\"> & JIIXV2Expression\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix#text-interpretation | Math Element }\n */\nexport type JIIXV2MathElement = JIIXV2ElementBase<\"Math\"> & JIIXV2Expression\n\n/** @group Exports\n */\nexport type JIIXV2DrawingElement = JIIXV2ElementBase<\"Drawing\"> & JIIXV2Expression\n\n/**\n * @group Exports\n */\nexport enum JIIXV2ShapeKind {\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Rectangle = \"rectangle\",\n  Triangle = \"triangle\",\n  IsoscelesTriangle = \"isosceles triangle\",\n  RightTriangle = \"right triangle\",\n  RightIsoscelesTriangle = \"right isosceles triangle\",\n  EquilateralTriangle = \"equilateral triangle\",\n  Quadrilateral = \"quadrilateral\",\n  Trapezoid = \"trapezoid\",\n  Square = \"square\",\n  Parallelogram = \"parallelogram\",\n  Polygon = \"polygon\",\n  Rhombus = \"rhombus\",\n  Line = \"line\",\n  ArcOfEllipse = \"arc of ellipse\",\n  ArcOfCircle = \"arc of circle\",\n  PolyLine = \"polyline\",\n  Arrow = \"arrow\",\n  CurvedDoubleArrow = \"curved double arrow\",\n  CurvedArrow = \"curved arrow\",\n  PolylineArrow = \"polyline arrow\",\n  PolylineDoubleArrow = \"polyline double arrow\",\n  DoubleArrow = \"double arrow\",\n}\n\n/**\n   * @group Exports\n   */\nexport type JIIXV2PolygonType = \"triangle\" | \"isosceles triangle\" | \"right triangle\" | \"right isosceles triangle\" | \"equilateral triangle\" | \"quadrilateral\" | \"trapezoid\" | \"parallelogram\" | \"rhombus\" | \"rectangle\" | \"square\"\n\n/**\n   * @group Exports\n   */\nexport type JIIXV2ShapeItemBase<K = JIIXV2ShapeKind> = JIIXV2ElementBase<K> & {\n  kind: K\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2EllipseBase<K = JIIXV2ShapeKind.Ellipse | JIIXV2ShapeKind.Circle> = JIIXV2ShapeItemBase<JIIXV2ShapeKind.Ellipse | JIIXV2ShapeKind.Circle> & {\n  kind: K\n  id: string\n  cx: number\n  cy: number\n  rx: number\n  ry: number\n  orientation: number\n  type: string\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2Circle = JIIXV2EllipseBase<JIIXV2ShapeKind.Circle>\n\n/**\n * @group Exports\n */\nexport type JIIXV2Ellipse = JIIXV2EllipseBase<JIIXV2ShapeKind.Ellipse>\n\n/**\n * @group Exports\n */\nexport type JIIXV2PrimitiveArc = {\n  type: \"arc\"\n  cx: number,\n  cy: number,\n  rx: number,\n  ry: number,\n  phi: number,\n  startAngle: number,\n  sweepAngle: number\n  startDecoration?: string\n  endDecoration?: string\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2PrimitiveLine = {\n  type: \"line\"\n  x1: number\n  y1: number\n  x2: number\n  y2: number\n  startDecoration?: string\n  endDecoration?: string\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2PolygonBase<K = JIIXV2PolygonType> = JIIXV2ShapeItemBase<K> & {\n  kind: K\n  primitives: JIIXV2PrimitiveLine[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygon = JIIXV2PolygonBase<JIIXV2ShapeKind.Polygon>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonTriangle = JIIXV2PolygonBase<JIIXV2ShapeKind.Triangle>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonIsoscelesTriangle = JIIXV2PolygonBase<JIIXV2ShapeKind.IsoscelesTriangle>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonRightTriangle = JIIXV2PolygonBase<JIIXV2ShapeKind.RightTriangle>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonRightIsoscelesTriangle = JIIXV2PolygonBase<JIIXV2ShapeKind.RightIsoscelesTriangle>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonEquilateralTriangle = JIIXV2PolygonBase<JIIXV2ShapeKind.EquilateralTriangle>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonQuadrilateral = JIIXV2PolygonBase<JIIXV2ShapeKind.Quadrilateral>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonTrapezoid = JIIXV2PolygonBase<JIIXV2ShapeKind.Trapezoid>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonParallelogram = JIIXV2PolygonBase<JIIXV2ShapeKind.Parallelogram>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonRhombus = JIIXV2PolygonBase<JIIXV2ShapeKind.Rhombus>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonRectangle = JIIXV2PolygonBase<JIIXV2ShapeKind.Rectangle>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonSquare = JIIXV2PolygonBase<JIIXV2ShapeKind.Square>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeLine = JIIXV2ShapeItemBase<JIIXV2ShapeKind.Line> & {\n  primitives: JIIXV2PrimitiveLine[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeLineArrow = JIIXV2ShapeItemBase<JIIXV2ShapeKind.Arrow> & {\n  primitives: JIIXV2PrimitiveLine[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeLineDoubleArrow = JIIXV2ShapeItemBase<JIIXV2ShapeKind.DoubleArrow> & {\n  primitives: JIIXV2PrimitiveLine[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeLinePolyline = JIIXV2ShapeItemBase<JIIXV2ShapeKind.PolyLine> & {\n  primitives: JIIXV2PrimitiveLine[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeLinePolylineArrow = JIIXV2ShapeItemBase<JIIXV2ShapeKind.PolylineArrow> & {\n  primitives: JIIXV2PrimitiveLine[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeLinePolylineDoubleArrow = JIIXV2ShapeItemBase<JIIXV2ShapeKind.PolylineDoubleArrow> & {\n  primitives: JIIXV2PrimitiveLine[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeCurvedDoubleArrow = JIIXV2ShapeItemBase<JIIXV2ShapeKind.CurvedDoubleArrow> & {\n  primitives: JIIXV2PrimitiveArc[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeCurvedArrow = JIIXV2ShapeItemBase<JIIXV2ShapeKind.CurvedArrow> & {\n  primitives: JIIXV2PrimitiveArc[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeArcOfEllipse = JIIXV2ShapeItemBase<JIIXV2ShapeKind.ArcOfEllipse> & {\n  primitives: JIIXV2PrimitiveArc[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeArcOfCircle = JIIXV2ShapeItemBase<JIIXV2ShapeKind.ArcOfCircle> & {\n  primitives: JIIXV2PrimitiveArc[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeElement = JIIXV2Circle | JIIXV2Ellipse | JIIXV2ShapePolygon | JIIXV2ShapePolygonTriangle | JIIXV2ShapePolygonIsoscelesTriangle | JIIXV2ShapePolygonRightTriangle | JIIXV2ShapePolygonRightIsoscelesTriangle | JIIXV2ShapePolygonEquilateralTriangle | JIIXV2ShapePolygonQuadrilateral | JIIXV2ShapePolygonTrapezoid | JIIXV2ShapePolygonParallelogram | JIIXV2ShapePolygonRhombus | JIIXV2ShapePolygonRectangle | JIIXV2ShapePolygonSquare | JIIXV2ShapeLineArrow | JIIXV2ShapeLineDoubleArrow | JIIXV2ShapeLinePolyline | JIIXV2ShapeLinePolylineArrow | JIIXV2ShapeLinePolylineDoubleArrow | JIIXV2ShapeCurvedDoubleArrow | JIIXV2ShapeCurvedArrow | JIIXV2ShapeArcOfEllipse | JIIXV2ShapeArcOfCircle | JIIXV2ShapeLine\n\n/**\n * @group Exports\n * @remarks Only in InkRecognizer () activated with recognition.export.JIIXV2.range = true\n */\nexport type JIIXV2RawContentBase<T = TRecognitionV2Type> = {\n  type: T\n  range?: JIIXV2Range\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2RawContentItemText = JIIXV2RawContentBase<\"Text\"> & JIIXV2Expression\n\n/**\n * @group Exports\n */\nexport type JIIXV2RawContentTextLine = {\n  type: \"Line\"\n  label: string\n  range?: JIIXV2RangeItem\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2RawContentShape = JIIXV2RawContentBase<\"Shape\"> & {\n  label: string\n  shape: JIIXV2RawContentItemShape[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2RawContentItemShape = JIIXV2RawContentBase<\"Shape\"> & {\n  range: JIIXV2RangeItem[]\n  elements: JIIXV2ShapeElement[]\n}\n\nexport type JIIXV2RawContentElement = JIIXV2RawContentItemText | JIIXV2RawContentItemShape\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/web/JIIXV2 | Exports}\n */\nexport type JIIXV2Element =\n  JIIXV2TextElement |\n  JIIXV2ShapeElement |\n  JIIXV2MathElement |\n  JIIXV2DrawingElement |\n  JIIXV2RawContentElement\n\n/**\n * @group Exports\n */\nexport type JIIXV2Export = JIIXV2Base & {\n  type: string\n  id: string\n  version: string\n  elements?: JIIXV2Element[]\n  label?: string\n  words?: JIIXV2Expression[]\n}\n\n/**\n * @group Exports\n * @remarks\n * List all supported MIME types for export.\n *\n * Attention the MIME types supported depend on the {@link TRecognitionType | type of recognition}\n *\n * {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/JIIXV2 | Documentation}\n */\nexport type TExportV2 = {\n  /** @hidden */\n  [key: string]: unknown\n  /**\n   * @remarks vnd.myscript.jiix is used for text and raw-content exports\n   */\n  \"application/vnd.myscript.jiix\"?: JIIXV2Export\n  /**\n   * @remarks text/plain is only use for text export\n   */\n  \"text/plain\"?: string\n  /**\n   * @remarks x-latex is only use for math export\n   * @see {@link https://katex.org/docs/browser.html | katex} to render\n   */\n  \"application/x-latex\"?: string\n}\n","\nimport style from \"../iink.css\"\n/**\n * @group Editor\n */\nexport type EditorLayerUIInfoModal = {\n  root: HTMLDivElement,\n  text: HTMLParagraphElement\n}\n\n/**\n * @group Editor\n */\nexport type EditorLayerUIMessage = {\n  root: HTMLDivElement\n  overlay: HTMLDivElement\n  modal: EditorLayerUIInfoModal\n}\n\n/**\n * @group Editor\n */\nexport type EditorLayerUIState = {\n  root: HTMLDivElement\n  busy: HTMLDivElement\n}\n\n/**\n * @group Editor\n */\nexport type EditorLayerUI = {\n  root: HTMLDivElement\n  loader: HTMLDivElement\n  message: EditorLayerUIMessage\n  state: EditorLayerUIState\n}\n\n/**\n * @group Editor\n */\nexport class EditorLayer\n{\n  root: HTMLElement\n  ui: EditorLayerUI\n  rendering: HTMLElement\n\n  onCloseModal?: (inError?: boolean) => void\n\n  constructor(root: HTMLElement, rootClassCss: string = \"ms-editor\")\n  {\n    this.root = root\n    this.root.classList.add(rootClassCss)\n    this.rendering = this.createLayerRender()\n    this.ui = this.createLayerUI()\n  }\n\n  render(): void\n  {\n    const styleElement = document.createElement(\"style\")\n    styleElement.appendChild(document.createTextNode(style as string))\n    this.root.prepend(styleElement)\n\n    this.root.appendChild(this.rendering)\n    this.root.appendChild(this.ui.root)\n  }\n\n  createLoader(): HTMLDivElement\n  {\n    const loaderHTML = document.createElement(\"div\")\n    loaderHTML.classList.add(\"loader\")\n    loaderHTML.style.display = \"none\"\n    return loaderHTML\n  }\n  showLoader(): void\n  {\n    this.ui.loader.style.display = \"block\"\n  }\n  hideLoader(): void\n  {\n    this.ui.loader.style.display = \"none\"\n  }\n\n  createMessageOverlay(): HTMLDivElement\n  {\n    const overlay = document.createElement(\"div\")\n    overlay.classList.add(\"message-overlay\")\n    return overlay\n  }\n  closeMessageModal(): void\n  {\n    this.onCloseModal?.(this.ui.message.modal.root.classList.contains(\"error-msg\"))\n    this.hideMessageModal()\n  }\n\n  hideMessageModal(): void\n  {\n    this.ui.message.root.style.display = \"none\"\n    this.ui.message.modal.text.innerText = \"\"\n    this.ui.message.modal.root.classList.remove(\"error-msg\")\n    this.ui.message.modal.root.classList.remove(\"info-msg\")\n  }\n  createMessageModal(): EditorLayerUIInfoModal\n  {\n    const element = document.createElement(\"div\")\n    element.classList.add(\"message-modal\")\n\n    const closeBtn = document.createElement(\"button\")\n    closeBtn.classList.add(\"ms-button\", \"close\")\n    closeBtn.addEventListener(\"pointerup\", this.closeMessageModal.bind(this))\n    element.appendChild(closeBtn)\n\n    const text = document.createElement(\"p\")\n    element.appendChild(text)\n    return { root: element, text }\n  }\n  createMessage(): EditorLayerUIMessage\n  {\n    const root = document.createElement(\"div\")\n    root.classList.add(\"message-container\")\n    root.style.display = \"none\"\n\n    const overlay = this.createMessageOverlay()\n    root.appendChild(overlay)\n\n    const modal = this.createMessageModal()\n    root.appendChild(modal.root)\n\n    return {\n      root,\n      overlay,\n      modal\n    }\n  }\n  showMessageInfo(notif: { message: string, timeout?: number })\n  {\n    this.ui.message.modal.root.classList.add(\"info-msg\")\n    this.ui.message.modal.root.classList.remove(\"error-msg\")\n    this.ui.message.root.style.display = \"block\"\n    this.ui.message.modal.text.innerText = notif.message\n    setTimeout(() =>\n    {\n      this.closeMessageModal()\n    }, notif.timeout || 2500)\n  }\n  showMessageError(err: Error | string)\n  {\n    this.ui.message.modal.root.classList.add(\"error-msg\")\n    this.ui.message.modal.root.classList.remove(\"info-msg\")\n    this.ui.message.root.style.display = \"block\"\n    this.ui.message.modal.text.innerText = typeof err === \"string\" ? err : err.message\n  }\n\n  createBusy(): HTMLDivElement\n  {\n    const busy = document.createElement(\"div\")\n    busy.classList.add(\"busy\")\n    return busy\n  }\n  createState(): EditorLayerUIState\n  {\n    const root = document.createElement(\"div\")\n    root.classList.add(\"state\")\n    root.style.display = \"none\"\n\n    const busy = this.createBusy()\n    root.appendChild(busy)\n\n    return {\n      root,\n      busy\n    }\n  }\n  showState(): void\n  {\n    this.ui.state.root.style.display = \"block\"\n  }\n  hideState(): void\n  {\n    this.ui.state.root.style.display = \"none\"\n  }\n  updateState(idle: boolean): void\n  {\n    if (idle) {\n      this.hideState()\n    }\n    else {\n      this.showState()\n    }\n  }\n\n  createLayerUI(): EditorLayerUI\n  {\n    const root = document.createElement(\"div\")\n    root.classList.add(\"ms-layer-ui\")\n\n    const loader = this.createLoader()\n    root.appendChild(loader)\n\n    const message = this.createMessage()\n    root.appendChild(message.root)\n\n    const state = this.createState()\n    root.appendChild(state.root)\n\n    return {\n      root,\n      loader,\n      message,\n      state\n    }\n  }\n\n  createLayerRender(): HTMLDivElement\n  {\n    const render = document.createElement(\"div\")\n    render.classList.add(\"ms-layer-rendering\")\n    return render\n  }\n\n  destroy(): void\n  {\n    while (this.root.lastChild) {\n      this.root.removeChild(this.root.lastChild)\n    }\n  }\n}\n","import { getApiInfos, PartialDeep, TApiInfos } from \"../utils\"\nimport {\n  LoggerCategory,\n  LoggerManager,\n  DefaultLoggerConfiguration,\n  TLoggerConfiguration\n} from \"../logger\"\nimport { TServerHTTPConfiguration } from \"../recognizer\"\nimport { EditorEvent } from \"./EditorEvent\"\nimport { EditorLayer } from \"./EditorLayer\"\n\n/**\n * @hidden\n * @group Editor\n */\nexport type TEditorConfiguration = {\n  logger: TLoggerConfiguration\n}\n\n/**\n * @group Editor\n * @remarks \"INKV1\" is deprecated use \"INKV2\" instead.\n */\nexport type EditorType = \"INTERACTIVEINK\" | \"INKV1\" | \"INTERACTIVEINKSSR\" | \"INKV2\"\n\n/**\n * @hidden\n * @group Editor\n */\nexport type EditorOptionsBase = {\n  configuration: TEditorConfiguration\n  override?: {\n    cssClass?: string\n  }\n}\n\n/**\n * @hidden\n * @group Editor\n */\nexport abstract class AbstractEditor\n{\n  logger = LoggerManager.getLogger(LoggerCategory.EDITOR)\n  layers: EditorLayer\n  event: EditorEvent\n  info?: TApiInfos\n\n  #loggerConfiguration!: TLoggerConfiguration\n\n  constructor(rootElement: HTMLElement, options?: PartialDeep<EditorOptionsBase>)\n  {\n    this.loggerConfiguration = Object.assign({}, DefaultLoggerConfiguration, options?.configuration?.logger)\n    this.logger.info(\"constructor\", { rootElement, options })\n\n    this.event = new EditorEvent(rootElement)\n    this.layers = new EditorLayer(rootElement, options?.override?.cssClass || \"ms-editor\")\n\n    //@ts-ignore\n    rootElement.editor = this\n  }\n\n  get loggerConfiguration(): TLoggerConfiguration\n  {\n    return this.#loggerConfiguration\n  }\n\n  set loggerConfiguration(loggerConfig: TLoggerConfiguration)\n  {\n    this.#loggerConfiguration = Object.assign({}, DefaultLoggerConfiguration, loggerConfig)\n    LoggerManager.setLoggerLevel(this.#loggerConfiguration)\n  }\n\n  abstract initialize(): Promise<void>\n\n  abstract clear(): Promise<void>\n\n  abstract destroy(): Promise<void>\n\n  async loadInfo(server: TServerHTTPConfiguration): Promise<TApiInfos>\n  {\n    if (!this.info) {\n      this.info = await getApiInfos({ server })\n    }\n    return this.info\n  }\n}\n","import { isBetween } from \"../utils\"\nimport { TPoint, TSegment } from \"./Point\"\n\n/**\n * @group Symbol\n */\nexport type TBox = {\n  x: number,\n  y: number,\n  width: number,\n  height: number\n}\n\n/**\n * @group Symbol\n */\nexport class Box implements TBox\n{\n  x: number\n  y: number\n  width: number\n  height: number\n\n  constructor(boundindBox: TBox)\n  {\n    if (boundindBox.width < 0) throw new Error(\"width must be positive\")\n    if (boundindBox.height < 0) throw new Error(\"height must be positive\")\n    this.height = boundindBox.height\n    this.width = boundindBox.width\n    this.x = boundindBox.x\n    this.y = boundindBox.y\n  }\n\n  static createFromBoxes(boxes: TBox[]): Box\n  {\n    if (!boxes?.length) {\n      return new Box({ height: 0, width: 0, x: 0, y: 0 })\n    }\n    let minX = boxes[0].x\n    let maxX = boxes[0].x + boxes[0].width\n    let minY = boxes[0].y\n    let maxY = boxes[0].y + boxes[0].height\n    for (let i = 1; i < boxes.length; i++) {\n      const b = boxes[i]\n      if (b.x < minX) minX = b.x\n      if (b.x + b.width > maxX) maxX = b.x + b.width\n      if (b.y < minY) minY = b.y\n      if (b.y + b.height > maxY) maxY = b.y + b.height\n    }\n    return new Box({ x: minX, y: minY, width: maxX - minX, height: maxY - minY })\n  }\n\n  static createFromPoints(points: TPoint[]): Box\n  {\n    if (!points?.length) {\n      return new Box({ height: 0, width: 0, x: 0, y: 0 })\n    }\n    let minX = points[0].x\n    let maxX = points[0].x\n    let minY = points[0].y\n    let maxY = points[0].y\n    for (let i = 1; i < points.length; i++) {\n      const p = points[i]\n      if (p.x < minX) minX = p.x\n      if (p.x > maxX) maxX = p.x\n      if (p.y < minY) minY = p.y\n      if (p.y > maxY) maxY = p.y\n    }\n    return new Box({ x: minX, y: minY, width: maxX - minX, height: maxY - minY })\n  }\n\n  static getCorners(box: TBox): TPoint[]\n  {\n    return [\n      { x: box.x, y: box.y },\n      { x: box.x + box.width, y: box.y },\n      { x: box.x + box.width, y: box.y + box.height },\n      { x: box.x, y: box.y + box.height }\n    ]\n  }\n\n  static getSide(box: TBox): TPoint[]\n  {\n    return [\n      { x: box.x + box.width / 2, y: box.y },\n      { x: box.x + box.width, y: box.y + box.height / 2 },\n      { x: box.x + box.width / 2, y: box.y + box.height },\n      { x: box.x, y: box.y + box.height / 2 }\n    ];\n\n  }\n\n  static getCenter(box: TBox): TPoint\n  {\n    return { x: box.x + box.width / 2, y: box.y + box.height / 2 }\n  }\n\n  static getSides(box: TBox): TSegment[]\n  {\n    const vertices = Box.getCorners(box)\n    return vertices.map((p, i) =>\n    {\n      if (i === 3) {\n        return { p1: vertices[0], p2: p }\n      }\n      else {\n        return { p1: p, p2: vertices[i + 1] }\n      }\n    })\n  }\n\n  static isContained(box: TBox, wrapper: TBox): boolean\n  {\n    return isBetween(box.x, wrapper.x, wrapper.x + wrapper.width) &&\n      isBetween(box.x + box.width, wrapper.x, wrapper.x + wrapper.width) &&\n      isBetween(box.y, wrapper.y, wrapper.y + wrapper.height) &&\n      isBetween(box.y + box.height, wrapper.y, wrapper.y + wrapper.height)\n  }\n\n  static containsPoint(box: TBox, point: TPoint): boolean\n  {\n    return isBetween(point.x, box.x, box.x + box.width) &&\n      isBetween(point.y, box.y, box.y + box.height)\n  }\n\n  static contains(box: TBox, child: TBox): boolean\n  {\n    return isBetween(child.x, box.x, box.x + box.width) &&\n      isBetween(child.x + child.width, box.x, box.x + box.width) &&\n      isBetween(child.y, box.y, box.y + box.height) &&\n      isBetween(child.y + child.height, box.y, box.y + box.height)\n  }\n\n  static overlaps(box1: TBox, box2: TBox): boolean\n  {\n    if (box1.x > box2.x + box2.width) return false\n    if (box1.x + box1.width < box2.x) return false\n    if (box1.y > box2.y + box2.height) return false\n    if (box1.y + box1.height < box2.y) return false\n\n    return true\n  }\n\n  get xMin(): number\n  {\n    return this.x\n  }\n\n  get xMid(): number\n  {\n    return this.x + this.width / 2\n  }\n\n  get xMax(): number\n  {\n    return this.x + this.width\n  }\n\n  get yMin(): number\n  {\n    return this.y\n  }\n\n  get yMid(): number\n  {\n    return this.y + this.height / 2\n  }\n\n  get yMax(): number\n  {\n    return this.y + this.height\n  }\n\n  get corners(): TPoint[]\n  {\n    return Box.getCorners(this)\n  }\n\n  get center(): TPoint\n  {\n    return Box.getCenter(this)\n  }\n\n  get side(): TPoint[]\n  {\n    return Box.getSide(this)\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return [\n      ...this.corners,\n      this.center\n    ]\n  }\n\n  isContained(wrapper: TBox): boolean\n  {\n    return Box.isContained(this, wrapper)\n  }\n\n  contains(child: TBox): boolean\n  {\n    return Box.contains(this, child)\n  }\n\n  containsPoint(point: TPoint): boolean\n  {\n    return Box.containsPoint(this, point)\n  }\n\n  overlaps(boundaries: TBox): boolean\n  {\n    return Box.overlaps(this, boundaries)\n  }\n}\n","/**\n * @group Style\n * @property {String} color=#000000 Color (supported formats rgb() rgba() hsl() hsla() #rgb #rgba #rrggbb #rrggbbaa)\n * @property {String} width in px\n\n */\nexport type TStyle = {\n  [key: string]: string | number | undefined\n  width: number\n  color: string\n  opacity?: number\n  fill?: string\n}\n\n/**\n * @group Style\n * @source\n */\nexport const DefaultStyle: TStyle = {\n  width: 2,\n  color: \"#000000\",\n//   opacity: 1,\n//   fill: \"transparent\",\n} as const\n","import { PartialDeep } from \"../utils\"\nimport { TStyle } from \"./Style\"\n\n/**\n * @group Style\n * @property {String} -myscript-pen-width=1 Width of strokes and primitives in mm (no other unit is supported yet)\n * @property {String} -myscript-pen-fill-style=none\n * @property {String} -myscript-pen-fill-color=#FFFFFF00 Color filled inside the area delimited by strokes and primitives\n */\nexport type TPenStyle = PartialDeep<TStyle> & {\n  \"-myscript-pen-width\"?: number\n  \"-myscript-pen-fill-style\"?: string\n  \"-myscript-pen-fill-color\"?: string\n}\n\n/**\n * @group Style\n * @source\n */\nexport const DefaultPenStyle: TPenStyle = {\n}\n","import { TPenStyle } from \"./PenStyle\"\n\n/**\n * @group Style\n */\nexport type TThemeMath = {\n  \"font-family\": string\n}\n\n/**\n * @group Style\n */\nexport type TThemeMathSolved = {\n  \"font-family\": string\n  color: string\n}\n\n/**\n * @group Style\n */\nexport type TThemeText = {\n  \"font-family\": string,\n  \"font-size\": number\n}\n\n/**\n * @group Style\n */\nexport type TTheme = {\n  ink: TPenStyle\n  \".math\": TThemeMath\n  \".math-solved\": TThemeMathSolved\n  \".text\": TThemeText\n  [key: string]: unknown\n}\n\n/**\n * @group Style\n * @source\n */\nexport const DefaultTheme: TTheme = {\n  ink: {\n    color: \"#000000\",\n    width: 1,\n    \"-myscript-pen-width\": 1,\n    \"-myscript-pen-fill-style\": \"none\",\n    \"-myscript-pen-fill-color\": \"#FFFFFF00\"\n  },\n  \".math\": {\n    \"font-family\": \"STIXGeneral\"\n  },\n  \".math-solved\": {\n    \"font-family\": \"STIXGeneral\",\n    color: \"#A8A8A8FF\"\n  },\n  \".text\": {\n    \"font-family\": \"MyScriptInter\",\n    \"font-size\": 10\n  }\n}\n","!function(t,e){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define([],e):\"object\"==typeof exports?exports.JsonCSS=e():t.JsonCSS=e()}(this,function(){return function(t){function e(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,\"a\",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p=\"\",e(e.s=1)}([function(t,e,n){\"use strict\";function o(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}Object.defineProperty(e,\"__esModule\",{value:!0});var r=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t},i=function t(e){var n=this;o(this,t),this.toJSON=function(t){if(\"string\"!=typeof t)return console.error(\"Need a CSS string but given \",void 0===t?\"undefined\":r(t),t),\"Not a valid CSS..!\";var e={},o=void 0,i=void 0,u=void 0;try{t.split(\"{\").forEach(function(t){if(i=t.trim())if(-1===i.indexOf(\"}\"))e[i]={},o=i;else{i.substring(0,i.indexOf(\"}\")).split(\";\").forEach(function(t){(u=t.split(\":\"))&&2===u.length&&(e[o][u[0].trim().replace(/^\\\"|\\\"$/g,\"\")]=n._trimSemiColon(u[1].trim().replace(/^\\\"|\\\"$/g,\"\")))});try{o=i.split(\"}\")[1].trim(),o&&(e[o]={})}catch(t){}}})}catch(t){return\"Not a valid CSS..!\"}return e},this.toCSS=function(t){if(\"object\"!==(void 0===t?\"undefined\":r(t)))return console.error(\"Need a JSON object but given \",void 0===t?\"undefined\":r(t),t),\"Not a valid JSON..!\";var e=\"\";try{for(var n in t)if(t.hasOwnProperty(n)){e+=n+\" {\\n\";for(var o in t[n])t[n].hasOwnProperty(o)&&(e+=o+\": \"+t[n][o]+\";\\n\");e+=\"}\\n\"}}catch(t){return\"Not a valid JSON..!\"}return e},this._trimSemiColon=function(t){return\";\"===t.slice(-1)?t.slice(0,n.length-1):t}};e.default=i},function(t,e,n){\"use strict\";t.exports=n(0).default}])});","import JsonCSS from \"json-css\"\nimport { TTheme } from \"./Theme\"\nimport { TPenStyle } from \"./PenStyle\"\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst parser: any = new JsonCSS()\n\n/**\n * @group Style\n */\nexport const StyleHelper = {\n  themeToCSS(json: TTheme): string\n  {\n    return parser.toCSS(json) as string\n    // css = css.replace( /[\\r\\n]+/gm, \"\" )\n    // return css\n  },\n  themeToJSON(style: string): TTheme\n  {\n    const theme = parser.toJSON(style) as TTheme\n    theme[\".text\"][\"font-size\"] = Number(theme[\".text\"][\"font-size\"])\n    theme.ink[\"-myscript-pen-width\"] = Number(theme.ink[\"-myscript-pen-width\"])\n    theme.ink.width = Number(theme.ink.width)\n    return theme\n  },\n  penStyleToCSS (penStyle: TPenStyle): string {\n    let css = parser.toCSS({ css: penStyle }) as string\n    css = css.substring(6, css.length - 3)\n    return css\n  },\n  penStyleToJSON (penStyleString: string): TPenStyle {\n    const penStyle = parser.toJSON(`css {${penStyleString}}`).css as TPenStyle\n    if (penStyle.width) {\n      penStyle.width = Number(penStyle.width)\n    } else {\n      delete penStyle.width\n    }\n    if (penStyle[\"-myscript-pen-width\"]) {\n      penStyle[\"-myscript-pen-width\"] = Number(penStyle[\"-myscript-pen-width\"])\n    } else {\n      delete penStyle[\"-myscript-pen-width\"]\n    }\n    return penStyle\n  },\n\n  stringToJSON(style: string): {[key: string]: string}\n  {\n    return parser.toJSON(`css {${style}}`).css\n  },\n  JSONToString(style: {[key: string]: string}): string\n  {\n    return Object.entries(style).map(([k, v]) => `${k}:${v}`).join(\";\")\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { PartialDeep, mergeDeep } from \"../utils\"\nimport { DefaultPenStyle, TPenStyle } from \"./PenStyle\"\nimport { DefaultTheme, TTheme } from \"./Theme\"\n\n/**\n * @group Style\n */\nexport class StyleManager\n{\n  #penStyle!: TPenStyle\n  #theme!: TTheme\n  #penStyleClasses!: string\n  #currentPenStyle!: TPenStyle\n  #logger =  LoggerManager.getLogger(LoggerCategory.STYLE)\n\n  constructor(penStyle?: PartialDeep<TPenStyle>, theme?: PartialDeep<TTheme>)\n  {\n    this.#logger.info(\"constructor\", { penStyle, theme })\n    this.setTheme(theme)\n    this.setPenStyleClasses()\n    this.setPenStyle(penStyle)\n  }\n\n  get currentPenStyle(): TPenStyle\n  {\n    return this.#currentPenStyle || this.#penStyle\n  }\n\n  get penStyle(): TPenStyle\n  {\n    return this.#penStyle\n  }\n  setPenStyle(style?: PartialDeep<TPenStyle>)\n  {\n    this.#logger.info(\"setPenStyle\", { style })\n    this.#penStyle = mergeDeep(structuredClone(DefaultPenStyle), style || {}) as TPenStyle\n    this.#currentPenStyle = style || (this.theme[`.${ this.#penStyleClasses }`]) as TPenStyle\n    this.#logger.debug(\"setPenStyle\", this.#currentPenStyle)\n  }\n\n  get theme(): TTheme\n  {\n    return this.#theme\n  }\n  setTheme(theme?: PartialDeep<TTheme>)\n  {\n    this.#logger.info(\"setTheme\", { theme })\n    this.#theme = mergeDeep(structuredClone(DefaultTheme), theme || {}) as TTheme\n    this.#logger.debug(\"setTheme\", this.#theme)\n  }\n\n  get penStyleClasses(): string\n  {\n    return this.#penStyleClasses\n  }\n  setPenStyleClasses(penStyleClass = \"\")\n  {\n    this.#logger.info(\"setPenStyleClasses\", { penStyleClass })\n    this.#penStyleClasses = penStyleClass\n    this.#currentPenStyle = (this.theme[`.${ this.#penStyleClasses }`]) as TPenStyle\n    this.#logger.debug(\"setPenStyleClasses\", this.#currentPenStyle)\n  }\n\n}\n","import { createUUID, mergeDeep, PartialDeep } from \"../utils\"\nimport { DefaultStyle, TStyle } from \"../style\"\n\n/**\n * @group Symbol\n */\nexport enum DecoratorKind\n{\n  Highlight = \"highlight\",\n  Surround = \"surround\",\n  Underline = \"underline\",\n  Strikethrough = \"strikethrough\",\n}\n\n/**\n * @group Symbol\n */\nexport class IIDecorator\n{\n  id: string\n  kind: DecoratorKind\n  style: TStyle\n\n  constructor(kind: DecoratorKind, style: PartialDeep<TStyle>)\n  {\n    this.id = `${ kind }-${ createUUID() }`\n    this.style = structuredClone(mergeDeep({}, DefaultStyle ,style))\n    this.kind = kind\n  }\n\n  clone(): IIDecorator\n  {\n    const clone = new IIDecorator(this.kind, structuredClone(this.style))\n    clone.id = this.id\n    return clone\n  }\n\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep } from \"../utils\"\n\n/**\n * @group Symbol\n */\nexport enum SymbolType\n{\n  Stroke = \"stroke\",\n  Group = \"group\",\n  Shape = \"shape\",\n  Edge = \"edge\",\n  Text = \"text\",\n  Eraser = \"eraser\",\n  Recognized = \"recognized\"\n}\n\n/**\n * @group Symbol\n */\nexport interface TSymbol {\n  id: string\n  creationTime: number\n  modificationDate: number\n  type: string\n  style: PartialDeep<TStyle>\n}\n","import { SELECTION_MARGIN } from \"../../Constants\"\nimport { TStyle } from \"../../style\"\nimport { findIntersectionBetween2Segment, PartialDeep } from \"../../utils\"\nimport { Box, TBox } from \"../Box\"\nimport { IISymbolBase } from \"../IISymbolBase\"\nimport { TPoint } from \"../Point\"\nimport { SymbolType } from \"../Symbol\"\n\n/**\n * @group Symbol\n */\nexport enum EdgeKind\n{\n  Line = \"line\",\n  PolyEdge = \"polyedge\",\n  Arc = \"arc\",\n}\n\n/**\n * @group Symbol\n */\nexport enum EdgeDecoration\n{\n  Arrow = \"arrow-head\"\n}\n\n/**\n * @group Symbol\n */\nexport abstract class OIEdgeBase<K = EdgeKind> extends IISymbolBase<SymbolType.Edge>\n{\n  readonly kind: K\n  readonly isClosed = false\n\n  startDecoration?: EdgeDecoration\n  endDecoration?: EdgeDecoration\n\n  constructor(\n    kind: K,\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(SymbolType.Edge, style)\n    this.kind = kind\n\n    this.startDecoration = startDecoration\n    this.endDecoration = endDecoration\n  }\n\n  abstract get vertices(): TPoint[]\n\n  get bounds(): Box\n  {\n    const bb = Box.createFromPoints(this.vertices)\n    bb.x -= SELECTION_MARGIN / 2\n    bb.y -= SELECTION_MARGIN / 2\n    bb.height += SELECTION_MARGIN\n    bb.width += SELECTION_MARGIN\n    if (this.startDecoration || this.endDecoration) {\n      bb.x -= ((this.style.width || 1) * 2.5)\n      bb.y -= ((this.style.width || 1) * 2.5)\n      bb.height += ((this.style.width || 1) * 5)\n      bb.width += ((this.style.width || 1) * 5)\n    }\n    return bb\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.vertices\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.bounds.isContained(box) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n\n  abstract clone(): OIEdgeBase\n}\n","import { TStyle } from \"../../style\"\nimport { findIntersectionBetween2Segment, PartialDeep } from \"../../utils\"\nimport { Box, TBox } from \"../Box\"\nimport { IISymbolBase } from \"../IISymbolBase\"\nimport { TPoint } from \"../Point\"\nimport { SymbolType } from \"../Symbol\"\n\n/**\n * @group Symbol\n */\nexport enum ShapeKind\n{\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Polygon = \"polygon\",\n  Table = \"table\"\n}\n\n/**\n * @group Symbol\n */\nexport abstract class OIShapeBase<K = ShapeKind> extends IISymbolBase<SymbolType.Shape>\n{\n  readonly kind: K\n  readonly isClosed = true\n\n  constructor(kind: K, style?: PartialDeep<TStyle>)\n  {\n    super(SymbolType.Shape, style)\n    this.kind = kind\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.bounds.snapPoints\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.bounds.isContained(box) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { Box, TBox } from \"../Box\"\nimport { IIStroke } from \"../IIStroke\"\nimport { IISymbolBase } from \"../IISymbolBase\"\nimport { TPoint } from \"../Point\"\nimport { SymbolType } from \"../Symbol\"\n\n/**\n * @group Symbol\n */\nexport enum RecognizedKind\n{\n  Text = \"text\",\n  Line = \"line\",\n  PolyEdge = \"polyedge\",\n  Arc = \"arc\",\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Polygone = \"polygone\",\n}\n\n/**\n * @group Symbol\n */\nexport abstract class IIRecognizedBase<K = RecognizedKind> extends IISymbolBase<SymbolType.Recognized>\n{\n  readonly kind: K\n\n  strokes: IIStroke[]\n\n  constructor(\n    kind: K,\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(SymbolType.Recognized, style)\n    this.kind = kind\n    this.strokes = strokes\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.strokes.flatMap(s => s.vertices)\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromBoxes(this.strokes.map(c => c.bounds))\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.bounds.snapPoints\n  }\n\n  updateChildrenStyle(): void\n  {\n    this.strokes.forEach(child => child.style = Object.assign({}, child.style, this.style))\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.strokes.some(s => s.overlaps(box))\n  }\n\n  containsStroke(strokeId: string): boolean\n  {\n    return this.strokes.some(s => s.id === strokeId)\n  }\n\n  removeStrokes(strokeIds: string[]): IIStroke[]\n  {\n    const strokeRemoved = this.strokes.filter(s => strokeIds.includes(s.id))\n    this.strokes = this.strokes.filter(s => !strokeIds.includes(s.id))\n    return strokeRemoved\n  }\n}\n","import { TPoint } from \"../symbol\"\n\n/**\n * @group Transform\n * @remarks Represents a 2D affine transform, defined as a 3x3 matrix with an implicit third raw of <code>[ 0 0 1 ]</code>\n */\nexport type TMatrixTransform = {\n  /**\n   * @remarks scaling x\n   */\n  xx: number,\n  /**\n   * @remarks shearing x\n   */\n  yx: number,\n  /**\n   * @remarks translation x\n   */\n  tx: number,\n  /**\n   * @remarks shearing y\n   */\n  xy: number,\n  /**\n   * @remarks scaling y\n   */\n  yy: number,\n  /**\n   * @remarks translation y\n   */\n  ty: number,\n}\n\n/**\n * @group Transform\n * @remarks Represents a 2D affine transform, defined as a 3x3 matrix with an implicit third raw of <code>[ 0 0 1 ]</code>\n */\nexport class MatrixTransform implements TMatrixTransform\n{\n  xx: number\n  yx: number\n  xy: number\n  yy: number\n  tx: number\n  ty: number\n\n  constructor(xx: number, yx: number, xy: number, yy: number, tx: number, ty: number)\n  {\n    this.xx = xx\n    this.yx = yx\n    this.xy = xy\n    this.yy = yy\n    this.tx = tx\n    this.ty = ty\n  }\n\n  static identity(): MatrixTransform\n  {\n    return new MatrixTransform(1, 0, 0, 1, 0, 0)\n  }\n\n  static applyToPoint(mat: TMatrixTransform, point: TPoint): TPoint\n  {\n    return {\n      x: mat.xx * point.x + mat.xy * point.y + mat.tx,\n      y: mat.yx * point.x + mat.yy * point.y + mat.ty,\n    }\n  }\n\n  static rotation(mat: TMatrixTransform): number\n  {\n    let rotation\n\n    if (mat.xx !== 0 || mat.xy !== 0) {\n      const hypotAc = Math.hypot(mat.xx, mat.xy)\n      rotation = Math.acos(mat.xx / hypotAc) * (mat.xy > 0 ? -1 : 1)\n    } else if (mat.yx !== 0 || mat.yy !== 0) {\n      const hypotBd = Math.hypot(mat.yx, mat.yy)\n      rotation = Math.PI / 2 + Math.acos(mat.yx / hypotBd) * (mat.yy > 0 ? -1 : 1)\n    } else {\n      rotation = 0\n    }\n\n    return rotation\n  }\n\n  static toCssString(matrix: TMatrixTransform): string\n  {\n    return `matrix(${ matrix.xx }, ${ matrix.yx }, ${ matrix.xy }, ${ matrix.yy }, ${ matrix.tx }, ${ matrix.ty })`\n  }\n\n\tinvert() {\n\t\tconst { xx, yx, xy, yy, tx, ty } = this\n\t\tconst denom = xx * yy - yx * xy\n\t\tthis.xx = yy / denom\n\t\tthis.yx = yx / -denom\n\t\tthis.xy = xy / -denom\n\t\tthis.yy = xx / denom\n\t\tthis.tx = (yy * tx - xy * ty) / -denom\n\t\tthis.ty = (yx * tx - xx * ty) / denom\n\t\treturn this\n\t}\n\n  multiply(m: TMatrixTransform): MatrixTransform\n  {\n    const { xx, yx, xy, yy, tx, ty } = this\n    this.xx = xx * m.xx + xy * m.yx\n    this.yx = yx * m.xx + yy * m.yx\n    this.xy = xx * m.xy + xy * m.yy\n    this.yy = yx * m.xy + yy * m.yy\n    this.tx = xx * m.tx + xy * m.ty + tx\n    this.ty = yx * m.tx + yy * m.ty + ty\n    return this\n  }\n\n  translate(tx: number, ty: number): MatrixTransform\n  {\n    return this.multiply({ xx: 1, yx: 0, xy: 0, yy: 1, tx, ty })\n  }\n\n  rotate(radian: number, center?: TPoint): MatrixTransform\n  {\n    if (center) {\n      this.translate(center.x, center.y)\n    }\n    const cosAngle = Math.round(Math.cos(radian) * 1000) / 1000\n    const sinAngle = Math.round(Math.sin(radian) * 1000) / 1000\n    this.multiply({\n      xx: cosAngle,\n      yx: sinAngle,\n      xy: -sinAngle,\n      yy: cosAngle,\n      tx: 0,\n      ty: 0\n    })\n    if (center) {\n      this.translate(-center.x, -center.y)\n    }\n    return this\n  }\n\n  scale(x: number, y: number, center?: TPoint): MatrixTransform\n  {\n    if (center) {\n      this.translate(center.x, center.y)\n    }\n    this.multiply({\n      xx: x,\n      yx: 0,\n      xy: 0,\n      yy: y,\n      tx: 0,\n      ty: 0\n    })\n    if (center) {\n      this.translate(-center.x, -center.y)\n    }\n    return this\n  }\n\n  applyToPoint(point: TPoint): TPoint\n  {\n    return MatrixTransform.applyToPoint(this, point)\n  }\n\n  clone(): MatrixTransform\n  {\n    return new MatrixTransform(this.xx, this.yx, this.xy, this.yy, this.tx, this.ty)\n  }\n\n  toCssString(): string\n  {\n    return MatrixTransform.toCssString(this)\n  }\n\n}\n","import { PartialDeep, createUUID, findIntersectionBetween2Segment } from \"../utils\"\nimport { TBox } from \"./Box\"\nimport { TPoint, TSegment } from \"./Point\"\nimport { SymbolType, TSymbol } from \"./Symbol\"\nimport { DefaultStyle, TStyle } from \"../style\"\nimport { MatrixTransform } from \"../transform\"\n\n/**\n * @group Symbol\n */\nexport abstract class IISymbolBase<T extends string = SymbolType> implements TSymbol\n{\n  readonly type: T\n  abstract readonly isClosed: boolean\n  style: TStyle\n\n  id: string\n  creationTime: number\n  modificationDate: number\n  selected: boolean\n  deleting: boolean\n  transform: MatrixTransform\n\n  constructor(type: T, style?: PartialDeep<TStyle>)\n  {\n    this.type = type\n    this.id = `${ this.type }-${ createUUID() }`\n\n    this.creationTime = Date.now()\n    this.modificationDate = this.creationTime\n    this.selected = false\n    this.deleting = false\n\n    this.transform = MatrixTransform.identity()\n\n    this.style = Object.assign({}, DefaultStyle, style)\n    if (this.style.opacity) {\n      this.style.opacity = +this.style.opacity\n    }\n    this.style.width = +this.style.width\n  }\n\n  abstract get vertices(): TPoint[]\n\n  abstract get snapPoints(): TPoint[]\n\n  get edges(): TSegment[]\n  {\n    if (this.isClosed) {\n      return this.vertices.map((p, i) =>\n      {\n        if (i === this.vertices.length - 1) {\n          return { p1: p, p2: this.vertices[0] }\n        }\n        else {\n          return { p1: p, p2: this.vertices[i + 1] }\n        }\n      })\n    }\n    else {\n      return this.vertices.slice(0, -1).map((p, i) =>\n      {\n        return { p1: p, p2: this.vertices[i + 1] }\n      })\n    }\n  }\n\n  abstract overlaps(box: TBox): boolean\n\n  abstract clone(): IISymbolBase\n\n  abstract toJSON(): PartialDeep<IISymbolBase>\n\n  isIntersected(seg: TSegment): boolean\n  {\n    return this.edges.some(edge =>\n    {\n      return findIntersectionBetween2Segment(edge, seg)\n    })\n  }\n}\n","import { PartialDeep, isValidNumber } from \"../utils\"\n\n/**\n * @group Symbol\n */\nexport type TPoint = {\n  x: number\n  y: number\n}\n\n/**\n * @group Symbol\n */\nexport type TPointer = TPoint & {\n  t: number\n  p: number\n}\n\n/**\n * @group Symbol\n */\nexport type TSegment = {\n  p1: TPoint\n  p2: TPoint\n}\n\n/**\n * @group Symbol\n */\nexport function isValidPoint(p?: PartialDeep<TPoint>): boolean\n{\n  if (!p) return false\n  if (!isValidNumber(p.x)) return false\n  if (!isValidNumber(p.y)) return false\n  return true\n}\n","import { SELECTION_MARGIN } from \"../../Constants\"\nimport { TStyle } from \"../../style\"\nimport { PartialDeep, computePointOnEllipse, isValidNumber } from \"../../utils\"\nimport { EdgeDecoration, EdgeKind, OIEdgeBase } from \"./IIEdge\"\nimport { TPoint, isValidPoint } from \"../Point\"\n\n/**\n * @group Symbol\n */\nexport class IIEdgeArc extends OIEdgeBase<EdgeKind.Arc>\n{\n  center: TPoint\n  startAngle: number\n  sweepAngle: number\n  radiusX: number\n  radiusY: number\n  phi: number\n  protected _vertices: Map<string, TPoint[]>\n\n  constructor(\n    center: TPoint,\n    startAngle: number,\n    sweepAngle: number,\n    radiusX: number,\n    radiusY: number,\n    phi: number,\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>,\n  )\n  {\n    super(EdgeKind.Arc, startDecoration, endDecoration, style)\n    this.center = center\n    this.startAngle = startAngle\n    this.sweepAngle = sweepAngle\n    this.radiusX = radiusX\n    this.radiusY = radiusY\n    this.phi = phi\n    this._vertices = new Map<string, TPoint[]>()\n    this._vertices.set(this.verticesId, this.computedVertices())\n  }\n\n  protected get verticesId(): string\n  {\n    return `${ this.center.x }-${ this.center.y }-${ this.startAngle }-${ this.sweepAngle }-${ this.radiusX }-${ this.radiusY }-${ this.phi }`\n  }\n\n  protected computedVertices(): TPoint[]\n  {\n    const length = Math.abs(this.sweepAngle) * Math.sqrt((Math.pow(this.radiusX, 2) + Math.pow(this.radiusY, 2)) / 2)\n    const nbVertices = Math.max(8, Math.round(length / SELECTION_MARGIN))\n    const angleStep = this.sweepAngle / nbVertices\n    const v: TPoint[] = []\n    const endAngle = this.startAngle + this.sweepAngle\n    if (this.sweepAngle > 0) {\n      for (let angle = this.startAngle; angle < endAngle; angle += angleStep) {\n        v.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.phi, angle))\n      }\n    } else {\n      for (let angle = this.startAngle; angle > endAngle; angle += angleStep) {\n        v.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.phi, angle))\n      }\n    }\n    v.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.phi, endAngle))\n    return v\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (!this._vertices.has(this.verticesId)) {\n      this._vertices.set(this.verticesId, this.computedVertices())\n    }\n    return this._vertices.get(this.verticesId)!\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return [\n      this.vertices[0],\n      this.vertices.at(-1)!\n    ]\n  }\n\n  clone(): IIEdgeArc\n  {\n    const clone = new IIEdgeArc(\n      structuredClone(this.center),\n      this.startAngle,\n      this.sweepAngle,\n      this.radiusX,\n      this.radiusY,\n      this.phi,\n      this.startDecoration,\n      this.endDecoration,\n      structuredClone(this.style)\n    )\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIEdgeArc>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      center: this.center,\n      startAngle: this.startAngle,\n      sweepAngle: this.sweepAngle,\n      radiusX: this.radiusX,\n      radiusY: this.radiusY,\n      phi: this.phi,\n      startDecoration: this.startDecoration,\n      style: this.style,\n      endDecoration: this.endDecoration,\n    }\n  }\n\n  static create(partial: PartialDeep<IIEdgeArc>): IIEdgeArc\n  {\n    if (!isValidPoint(partial?.center)) throw new Error(`Unable to create a arc, center point is invalid`)\n    if (!isValidNumber(partial?.startAngle)) throw new Error(`Unable to create a arc, startAngle is invalid`)\n    if (!isValidNumber(partial?.sweepAngle)) throw new Error(`Unable to create a arc, sweepAngle is invalid`)\n    if (!isValidNumber(partial?.radiusX)) throw new Error(`Unable to create a arc, radiusX is invalid`)\n    if (!isValidNumber(partial?.radiusY)) throw new Error(`Unable to create a arc, radiusY is invalid`)\n    const arc = new IIEdgeArc(\n      partial?.center as TPoint,\n      partial.startAngle!,\n      partial.sweepAngle!,\n      partial.radiusX!,\n      partial.radiusY!,\n      partial.phi || 0,\n      partial.startDecoration,\n      partial.endDecoration,\n      partial.style\n    )\n    if (partial.id) {\n      arc.id = partial.id\n    }\n    return arc\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { EdgeDecoration, EdgeKind, OIEdgeBase } from \"./IIEdge\"\nimport { TPoint, isValidPoint } from \"../Point\"\n\n/**\n * @group Symbol\n */\nexport class IIEdgeLine extends OIEdgeBase<EdgeKind.Line>\n{\n  start: TPoint\n  end: TPoint\n\n  constructor(\n    start: TPoint,\n    end: TPoint,\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(EdgeKind.Line, startDecoration, endDecoration, style)\n    this.start = start\n    this.end = end\n  }\n\n  get vertices(): TPoint[]\n  {\n    return [\n      this.start,\n      this.end\n    ]\n  }\n\n  clone(): IIEdgeLine\n  {\n    const clone = new IIEdgeLine(structuredClone(this.start), structuredClone(this.end), this.startDecoration, this.endDecoration, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIEdgeLine>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      start: this.start,\n      end: this.end,\n      style: this.style,\n      startDecoration: this.startDecoration,\n      endDecoration: this.endDecoration,\n    }\n  }\n\n  static create(partial: PartialDeep<IIEdgeLine>): IIEdgeLine\n  {\n    if (!isValidPoint(partial?.start)) throw new Error(`Unable to create a arc, start point is invalid`)\n    if (!isValidPoint(partial?.end)) throw new Error(`Unable to create a arc, end point is invalid`)\n    const line = new IIEdgeLine(partial?.start as TPoint, partial?.end as TPoint, partial.startDecoration, partial.endDecoration, partial.style)\n    if (partial.id) {\n      line.id = partial.id\n    }\n    return line\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { EdgeDecoration, EdgeKind, OIEdgeBase } from \"./IIEdge\"\nimport { TPoint, isValidPoint } from \"../Point\"\n\n/**\n * @group Symbol\n */\nexport class IIEdgePolyLine extends OIEdgeBase<EdgeKind.PolyEdge>\n{\n  points: TPoint[]\n\n  constructor(\n    points: TPoint[],\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(EdgeKind.PolyEdge, startDecoration, endDecoration, style)\n    this.points = points\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.points\n  }\n\n  clone(): IIEdgePolyLine\n  {\n    const clone = new IIEdgePolyLine(structuredClone(this.points),this.startDecoration, this.endDecoration, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIEdgePolyLine>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      points: this.points,\n      style: this.style,\n      startDecoration: this.startDecoration,\n      endDecoration: this.endDecoration,\n    }\n  }\n\n  static create(partial: PartialDeep<IIEdgePolyLine>): IIEdgePolyLine\n  {\n    if (!partial?.points?.map(p => isValidPoint(p))) throw new Error(`Unable to create a PolyLine, points are invalid`)\n    const polyline = new IIEdgePolyLine(partial?.points as TPoint[], partial.startDecoration, partial.endDecoration, partial.style)\n    if (partial.id) {\n      polyline.id = partial.id\n    }\n    return polyline\n  }\n}\n","import { SELECTION_MARGIN } from \"../../Constants\"\nimport { TStyle } from \"../../style\"\nimport { PartialDeep, findIntersectBetweenSegmentAndCircle, isValidNumber, computeRotatedPoint } from \"../../utils\"\nimport { TPoint, isValidPoint } from \"../Point\"\nimport { OIShapeBase, ShapeKind } from \"./IIShape\"\nimport { Box, TBox } from \"../Box\"\n\n/**\n * @group Symbol\n */\nexport class IIShapeCircle extends OIShapeBase<ShapeKind.Circle>\n{\n  center: TPoint\n  radius: number\n  protected _vertices: Map<string, TPoint[]>\n  protected _bounds: Map<string, Box>\n\n  constructor(\n    center: TPoint,\n    radius: number,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(ShapeKind.Circle, style)\n    this.center = center\n    this.radius = radius\n    this._vertices = new Map<string, TPoint[]>()\n    this._vertices.set(this.verticesId, this.computedVertices())\n    this._bounds = new Map<string, Box>()\n    this._bounds.set(this.verticesId, this.computedBondingBox())\n  }\n\n  protected get verticesId(): string\n  {\n    return `${ this.center.x }-${ this.center.y }-${ this.radius }`\n  }\n\n  protected computedVertices(): TPoint[]\n  {\n    const firstPoint: TPoint = {\n      x: this.center.x,\n      y: this.radius + this.center.y\n    }\n    const perimeter = 2 * Math.PI * this.radius\n    const nbPoint = Math.max(8, Math.round(perimeter / SELECTION_MARGIN))\n    const points: TPoint[] = []\n    for (let i = 0; i < nbPoint; i++) {\n      const rad = 2 * Math.PI * (i / nbPoint)\n      points.push(computeRotatedPoint(firstPoint, this.center, rad))\n    }\n    return points\n  }\n\n  protected computedBondingBox(): Box\n  {\n    const boundingBox: TBox = {\n      x: this.center.x - this.radius,\n      y: this.center.y - this.radius,\n      height: this.radius * 2,\n      width: this.radius * 2\n    }\n    return new Box(boundingBox)\n  }\n\n  get bounds(): Box\n  {\n    if (!this._bounds.has(this.verticesId)) {\n      this._bounds.set(this.verticesId, this.computedBondingBox())\n    }\n    return this._bounds.get(this.verticesId)!\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (!this._vertices.has(this.verticesId)) {\n      this._vertices.set(this.verticesId, this.computedVertices())\n    }\n    return this._vertices.get(this.verticesId)!\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.bounds.isContained(box) ||\n      Box.getSides(box).some(seg => findIntersectBetweenSegmentAndCircle(seg, this.center, this.radius).length)\n  }\n\n  clone(): IIShapeCircle\n  {\n    const clone = new IIShapeCircle(structuredClone(this.center), this.radius, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIShapeCircle>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      center: this.center,\n      radius: this.radius,\n      style: this.style,\n    }\n  }\n\n  static createBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapeCircle\n  {\n    const center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n\n    const width = Math.abs(origin.x - target.x)\n    const height = Math.abs(origin.y - target.y)\n    const radius = Math.min(width, height) / 2\n    return new IIShapeCircle(center, radius, style)\n  }\n\n  static updateBetweenPoints(circle: IIShapeCircle, origin: TPoint, target: TPoint): IIShapeCircle\n  {\n    circle.center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n    const width = Math.abs(origin.x - target.x)\n    const height = Math.abs(origin.y - target.y)\n    circle.radius = Math.min(width, height) / 2\n    return circle\n  }\n\n  static create(partial: PartialDeep<IIShapeCircle>): IIShapeCircle\n  {\n    if (!isValidPoint(partial.center)) throw new Error(`Unable to create circle, center is invalid`)\n    if (!isValidNumber(partial.radius)) throw new Error(`Unable to create circle, radius is undefined`)\n    const circle = new IIShapeCircle(partial.center as TPoint, partial.radius!, partial.style)\n    if (partial.id) {\n      circle.id = partial.id\n    }\n    return circle\n  }\n}\n","import { SELECTION_MARGIN } from \"../../Constants\"\nimport { TStyle } from \"../../style\"\nimport { PartialDeep, computePointOnEllipse, findIntersectionBetween2Segment, isValidNumber, } from \"../../utils\"\nimport { TPoint, isValidPoint } from \"../Point\"\nimport { OIShapeBase, ShapeKind } from \"./IIShape\"\nimport { Box, TBox } from \"../Box\"\n\n/**\n * @group Symbol\n */\nexport class IIShapeEllipse extends OIShapeBase<ShapeKind.Ellipse>\n{\n  center: TPoint\n  radiusX: number\n  radiusY: number\n  orientation: number\n  protected _vertices: Map<string, TPoint[]>\n\n  constructor(\n    center: TPoint,\n    radiusX: number,\n    radiusY: number,\n    orientation: number,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(ShapeKind.Ellipse, style)\n    this.center = center\n    this.radiusX = radiusX\n    this.radiusY = radiusY\n    this.orientation = orientation\n    this._vertices = new Map<string, TPoint[]>()\n  }\n\n  protected get verticesId(): string\n  {\n    return `${ this.center.x }-${ this.center.y }-${ this.radiusX }-${ this.radiusY }-${ this.orientation }`\n  }\n\n  protected computedVertices(): TPoint[]\n  {\n    const points: TPoint[] = []\n    const perimeter = 2 * Math.PI * Math.sqrt((Math.pow(this.radiusX, 2) + Math.pow(this.radiusY, 2)) / 2)\n    const nbPoint = Math.max(8, Math.round(perimeter / SELECTION_MARGIN))\n    for (let i = 0; i < nbPoint; i++) {\n      const theta = 2 * Math.PI * (i / nbPoint)\n      points.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.orientation, theta))\n    }\n\n    return points\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (!this._vertices.has(this.verticesId)) {\n      this._vertices.set(this.verticesId, this.computedVertices())\n    }\n    return this._vertices.get(this.verticesId)!\n  }\n\n  overlaps(box: TBox): boolean\n  {\n\n    return this.bounds.isContained(box) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n\n  clone(): IIShapeEllipse\n  {\n    const clone = new IIShapeEllipse(structuredClone(this.center), this.radiusX, this.radiusY, this.orientation, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIShapeEllipse>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      center: this.center,\n      orientation: this.orientation,\n      radiusX: this.radiusX,\n      radiusY: this.radiusY,\n      style: this.style,\n    }\n  }\n\n  static createBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapeEllipse\n  {\n    const center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n    const radiusX = Math.abs(origin.x - target.x) / 2\n    const radiusY = Math.abs(origin.y - target.y) / 2\n    return new IIShapeEllipse(center, radiusX, radiusY, 0, style)\n  }\n\n  static updateBetweenPoints(ellipse: IIShapeEllipse, origin: TPoint, target: TPoint): IIShapeEllipse\n  {\n    ellipse.center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n    ellipse.radiusX = Math.abs(origin.x - target.x) / 2\n    ellipse.radiusY = Math.abs(origin.y - target.y) / 2\n    return ellipse\n  }\n\n  static create(partial: PartialDeep<IIShapeEllipse>): IIShapeEllipse\n  {\n    if (!isValidPoint(partial.center)) throw new Error(`Unable to create ellipse, center is undefined`)\n    if (!isValidNumber(partial.radiusX)) throw new Error(`Unable to create ellipse, radiusX is undefined`)\n    if (!isValidNumber(partial.radiusY)) throw new Error(`Unable to create ellipse, radiusY is undefined`)\n    const ellipse = new IIShapeEllipse(partial.center as TPoint, partial.radiusX!, partial.radiusY!, partial.orientation || 0, partial.style)\n    if (partial.id) {\n      ellipse.id = partial.id\n    }\n    return ellipse\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { TPoint, isValidPoint } from \"../Point\"\nimport { OIShapeBase, ShapeKind } from \"./IIShape\"\nimport { Box } from \"../Box\"\nimport { PartialDeep } from \"../../utils\"\n\n/**\n * @group Symbol\n */\nexport class IIShapePolygon extends OIShapeBase<ShapeKind.Polygon>\n{\n  points: TPoint[]\n\n  constructor(points: TPoint[], style?: PartialDeep<TStyle>)\n  {\n    super(ShapeKind.Polygon, style)\n    this.points = points\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.points\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  clone(): IIShapePolygon\n  {\n    const clone = new IIShapePolygon(structuredClone(this.points), structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIShapePolygon>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      points: this.points,\n      style: this.style,\n    }\n  }\n\n  static create(partial: PartialDeep<IIShapePolygon>): IIShapePolygon\n  {\n    if (!partial?.points || partial?.points?.length < 3) throw new Error(`Unable to create polygon at least 3 points required`)\n    if (partial?.points?.some(p => !isValidPoint(p))) throw new Error(`Unable to create a polygon, one or more points are invalid`)\n    const polygon = new IIShapePolygon(partial.points as TPoint[], partial.style)\n    if (partial.id) {\n      polygon.id = partial.id\n    }\n    return polygon\n  }\n\n  static createTriangleBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapePolygon\n  {\n    const points: TPoint[] = [\n      { x: origin.x, y: origin.y },\n      { x: target.x, y: origin.y },\n      { x: (origin.x + target.x) / 2, y: target.y }\n    ]\n    return new IIShapePolygon(points, style)\n  }\n  static updateTriangleBetweenPoints(poly: IIShapePolygon, origin: TPoint, target: TPoint): IIShapePolygon\n  {\n    poly.points = [\n      { x: origin.x, y: origin.y },\n      { x: target.x, y: origin.y },\n      { x: (origin.x + target.x) / 2, y: target.y }\n    ]\n    poly.modificationDate = Date.now()\n    return poly\n  }\n\n  static createParallelogramBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapePolygon\n  {\n    const points: TPoint[] = [\n      { x: origin.x, y: origin.y },\n      { x: origin.x + (target.x - origin.x) * 0.75, y: origin.y },\n      { x: target.x, y: target.y },\n      { x: origin.x + (target.x - origin.x) * 0.25, y: target.y },\n    ]\n    return new IIShapePolygon(points, style)\n  }\n  static updateParallelogramBetweenPoints(poly: IIShapePolygon, origin: TPoint, target: TPoint): IIShapePolygon\n  {\n    const points: TPoint[] = [\n      { x: origin.x, y: origin.y },\n      { x: origin.x + (target.x - origin.x) * 0.75, y: origin.y },\n      { x: target.x, y: target.y },\n      { x: origin.x + (target.x - origin.x) * 0.25, y: target.y },\n    ]\n    poly.points = points\n    poly.modificationDate = Date.now()\n    return poly\n  }\n\n  static createRectangleBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMin, y: box.yMin },\n      { x: box.xMax, y: box.yMin },\n      { x: box.xMax, y: box.yMax },\n      { x: box.xMin, y: box.yMax },\n    ]\n    return new IIShapePolygon(points, style)\n  }\n  static updateRectangleBetweenPoints(poly: IIShapePolygon, origin: TPoint, target: TPoint): IIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMin, y: box.yMin },\n      { x: box.xMax, y: box.yMin },\n      { x: box.xMax, y: box.yMax },\n      { x: box.xMin, y: box.yMax },\n    ]\n    poly.points = points\n    poly.modificationDate = Date.now()\n    return poly\n  }\n\n  static createRhombusBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMid, y: box.yMin },\n      { x: box.xMax, y: box.yMid },\n      { x: box.xMid, y: box.yMax },\n      { x: box.xMin, y: box.yMid },\n    ]\n    return new IIShapePolygon(points, style)\n  }\n\n  static updateRhombusBetweenPoints(poly: IIShapePolygon, origin: TPoint, target: TPoint): IIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMid, y: box.yMin },\n      { x: box.xMax, y: box.yMid },\n      { x: box.xMid, y: box.yMax },\n      { x: box.xMin, y: box.yMid },\n    ]\n    poly.points = points\n    poly.modificationDate = Date.now()\n    return poly\n  }\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep, computeDistance, getClosestPoint } from \"../utils\"\nimport { TStroke, TStrokeToSend } from \"./Stroke\"\nimport { TPoint, TPointer } from \"./Point\"\nimport { Box, TBox } from \"./Box\"\nimport { SymbolType } from \"./Symbol\"\nimport { IIDecorator } from \"./IIDecorator\"\nimport { IISymbolBase } from \"./IISymbolBase\"\n\n/**\n * @group Symbol\n */\nexport class IIStroke extends IISymbolBase<SymbolType.Stroke>\n{\n  readonly isClosed = false\n\n  pointerType: string\n  length: number\n  decorators: IIDecorator[]\n  pointers: Array<TPointer>\n\n  constructor(style?: PartialDeep<TStyle>, pointerType = \"pen\")\n  {\n    super(SymbolType.Stroke, style)\n\n    this.pointerType = pointerType\n    this.pointers = []\n    this.decorators = []\n    this.length = 0\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  static split(strokeToSplit: IIStroke, i: number): { before: IIStroke, after: IIStroke }\n  {\n    const before = new IIStroke(strokeToSplit.style, strokeToSplit.pointerType)\n    before.pointers = strokeToSplit.pointers.slice(0, i)\n\n    const after = new IIStroke(strokeToSplit.style, strokeToSplit.pointerType)\n    after.pointers = strokeToSplit.pointers.slice(i)\n\n    return { before, after }\n  }\n\n  static substract(stroke: IIStroke, partStroke: IIStroke): { before?: IIStroke, after?: IIStroke }\n  {\n    if (!partStroke.length) return { before: stroke }\n    const result: { before?: IIStroke, after?: IIStroke } = {}\n    const lastPointBeforeStroke = {\n      x: partStroke.pointers[0].x as number,\n      y: partStroke.pointers[0].y as number\n    }\n    const closestLastPointBeforeStroke = getClosestPoint(stroke.pointers, lastPointBeforeStroke)\n    if (closestLastPointBeforeStroke.index > -1) {\n      const newStrokes = IIStroke.split(stroke, closestLastPointBeforeStroke.index)\n      result.before = newStrokes.before\n      result.after = newStrokes.after\n    }\n    const strokeAfter = result.after || stroke\n    const firstPointAfterStroke = {\n      x: partStroke.pointers.at(-1)!.x as number,\n      y: partStroke.pointers.at(-1)!.y as number\n    }\n    const closestFirstPointStrokeAfter = getClosestPoint(strokeAfter.pointers, firstPointAfterStroke)\n    if (closestFirstPointStrokeAfter.index > -1) {\n      const newStrokes = IIStroke.split(strokeAfter, closestFirstPointStrokeAfter.index)\n      result.after = newStrokes.after\n    }\n    if (!result.before?.pointers.length) result.before = undefined\n    if (!result.after?.pointers.length) result.after = undefined\n    return result\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.bounds.snapPoints\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.pointers\n  }\n\n  protected computePressure(distance: number): number\n  {\n    let ratio = 1.0\n    if (distance === this.length) {\n      ratio = 1.0\n    } else if (distance < 10) {\n      ratio = 0.2 + Math.pow(0.1 * distance, 0.4)\n    } else if (distance > this.length - 10) {\n      ratio = 0.2 + Math.pow(0.1 * (this.length - distance), 0.4)\n    }\n    const pressure = ratio * Math.max(0.1, 1.0 - (0.1 * Math.sqrt(distance)))\n    return isNaN(pressure) ? 0.5 : Math.round(pressure * 100) / 100\n  }\n\n  protected filterPointByAcquisitionDelta(point: TPointer): boolean\n  {\n    const lastPointer = this.pointers.at(-1)\n    const delta: number = (2 + ((this.style.width || 1) / 4))\n    return !lastPointer ||\n      Math.abs(lastPointer.x - point.x) >= delta ||\n      Math.abs(lastPointer.y - point.y) >= delta\n  }\n\n  addPointer(pointer: TPointer): void\n  {\n    if (this.filterPointByAcquisitionDelta(pointer)) {\n      const lastPointer = this.pointers.at(-1)\n      const distance = lastPointer ? computeDistance(pointer, lastPointer) : 0\n      this.length += distance\n      pointer.p = this.computePressure(distance)\n      this.pointers.push(pointer)\n      this.modificationDate = Date.now()\n    }\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.pointers.some(p =>\n    {\n      return p.x >= box.x && p.x <= box.x + box.width\n        && p.y >= box.y && p.y <= box.y + box.height\n    })\n  }\n\n  clone(): IIStroke\n  {\n    const clone = new IIStroke(this.style, this.pointerType)\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.pointers = structuredClone(this.pointers)\n    clone.decorators = this.decorators.map(d => d.clone())\n    clone.length = this.length\n    return clone\n  }\n\n  formatToSend(): TStrokeToSend\n  {\n    const json: TStrokeToSend = {\n      id: this.id,\n      pointerType: this.pointerType,\n      p: [],\n      t: [],\n      x: [],\n      y: []\n    }\n    this.pointers.forEach(p =>\n    {\n      json.p.push(p.p)\n      json.t.push(p.t)\n      json.x.push(p.x)\n      json.y.push(p.y)\n    })\n    return json\n  }\n\n  toJSON(): PartialDeep<IIStroke>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      pointers: this.pointers,\n      style: this.style,\n      decorators: this.decorators.length ? this.decorators : undefined\n    }\n  }\n\n  static create(partial: PartialDeep<IIStroke>): IIStroke\n  {\n    if (!partial.pointers?.length) {\n      throw new Error(`not pointers`)\n    }\n    const stroke = new IIStroke(partial.style, partial.pointerType)\n    if (partial.id) {\n      stroke.id = partial.id\n    }\n    const errors: string[] = []\n    let flag = true\n    partial.pointers?.forEach((pp, pIndex) =>\n    {\n      if (!pp) {\n        errors.push(`no pointer at ${ pIndex }`)\n        flag = false\n        return\n      }\n      const pointer: TPointer = {\n        p: pp.p || 1,\n        t: pp.t || pIndex,\n        x: 0,\n        y: 0\n      }\n      if (pp?.x == undefined || pp?.x == null) {\n        errors.push(`no x at pointer at ${ pIndex }`)\n        flag = false\n        return\n      }\n      else {\n        pointer.x = pp.x\n      }\n      if (pp?.y == undefined || pp?.y == null) {\n        errors.push(`no y at pointer at ${ pIndex }`)\n        flag = false\n        return\n      }\n      else {\n        pointer.y = pp.y\n      }\n      if (flag) {\n        stroke.addPointer(pointer)\n      }\n    })\n\n    if (errors.length) {\n      throw new Error(errors.join(\" and \"))\n    }\n    if (partial.decorators?.length) {\n      partial.decorators.forEach(d => {\n        if(d?.kind) {\n          stroke.decorators.push(new IIDecorator(d.kind, Object.assign({}, stroke.style, d.style)))\n        }\n      })\n    }\n    return stroke\n  }\n}\n\n/**\n * @group Symbol\n * @group Utils\n */\nexport function convertPartialStrokesToOIStrokes(json: PartialDeep<TStroke>[]): IIStroke[]\n{\n  const errors: string[] = []\n  const strokes: IIStroke[] = []\n  json.forEach((j, i) =>\n  {\n    try {\n      strokes.push(IIStroke.create(j as PartialDeep<IIStroke>))\n    } catch (e) {\n      errors.push(`stroke ${ i + 1 } has ${ (e as Error).message }`)\n    }\n  })\n\n  if (errors.length) {\n    throw new Error(errors.join(\"\\n\"))\n  }\n\n  return strokes\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedArc extends IIRecognizedBase<RecognizedKind.Arc>\n{\n  readonly isClosed = false\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Arc, strokes, style)\n  }\n\n  clone(): IIRecognizedArc\n  {\n    const clone = new IIRecognizedArc(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedArc>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: structuredClone(this.strokes),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedArc>): IIRecognizedArc\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n    const ws = new IIRecognizedArc(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedCircle extends IIRecognizedBase<RecognizedKind.Circle>\n{\n  readonly isClosed = true\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Circle, strokes, style)\n  }\n\n  clone(): IIRecognizedCircle\n  {\n    const clone = new IIRecognizedCircle(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedCircle>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: structuredClone(this.strokes),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedCircle>): IIRecognizedCircle\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n\n    const ws = new IIRecognizedCircle(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedEllipse extends IIRecognizedBase<RecognizedKind.Ellipse>\n{\n  readonly isClosed = true\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Ellipse, strokes, style)\n  }\n\n  clone(): IIRecognizedEllipse\n  {\n    const clone = new IIRecognizedEllipse(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedEllipse>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: structuredClone(this.strokes),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedEllipse>): IIRecognizedEllipse\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n\n    const ws = new IIRecognizedEllipse(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedLine extends IIRecognizedBase<RecognizedKind.Line>\n{\n  readonly isClosed = false\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Line, strokes, style)\n  }\n\n  clone(): IIRecognizedLine\n  {\n    const clone = new IIRecognizedLine(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedLine>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: structuredClone(this.strokes),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedLine>): IIRecognizedLine\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n\n    const ws = new IIRecognizedLine(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedPolyLine extends IIRecognizedBase<RecognizedKind.PolyEdge>\n{\n  readonly isClosed = false\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.PolyEdge, strokes, style)\n  }\n\n  clone(): IIRecognizedPolyLine\n  {\n    const clone = new IIRecognizedPolyLine(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedPolyLine>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: structuredClone(this.strokes),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedPolyLine>): IIRecognizedPolyLine\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n\n    const ws = new IIRecognizedPolyLine(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedPolygon extends IIRecognizedBase<RecognizedKind.Polygone>\n{\n  readonly isClosed = true\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Polygone, strokes, style)\n  }\n\n  clone(): IIRecognizedPolygon\n  {\n    const clone = new IIRecognizedPolygon(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedPolygon>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: structuredClone(this.strokes),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedPolygon>): IIRecognizedPolygon\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n\n    const ws = new IIRecognizedPolygon(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIDecorator } from \"../IIDecorator\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedText extends IIRecognizedBase<RecognizedKind.Text>\n{\n  readonly isClosed = false\n\n  decorators: IIDecorator[]\n\n  baseline: number\n  xHeight: number\n  label?: string\n\n  constructor(\n    strokes: IIStroke[],\n    lines: { baseline: number, xHeight: number },\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Text, strokes, style)\n    this.baseline = lines.baseline\n    this.xHeight = lines.xHeight\n    this.decorators = []\n  }\n\n  clone(): IIRecognizedText\n  {\n    const clone = new IIRecognizedText(this.strokes.map(s => s.clone()), { baseline: this.baseline, xHeight: this.xHeight }, structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.label = this.label\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.decorators = this.decorators.map(d => d.clone())\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedText>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      label: this.label,\n      baseline: this.baseline,\n      xHeight: this.xHeight,\n      strokes: structuredClone(this.strokes),\n      decorators: this.decorators.length ? structuredClone(this.decorators) : undefined\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedText>): IIRecognizedText\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n    const line = {\n      baseline: partial.baseline || 0,\n      xHeight: partial.xHeight || 0\n    }\n    const ws = new IIRecognizedText(strokes, line, partial.style)\n\n    if (partial.decorators?.length) {\n      partial.decorators.forEach(d =>\n      {\n        if (d?.kind) {\n          ws.decorators.push(new IIDecorator(d.kind, Object.assign({}, ws.style, d.style)))\n        }\n      })\n    }\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep } from \"../utils\"\nimport { TPoint } from \"./Point\"\nimport { Box, TBox } from \"./Box\"\nimport { SymbolType } from \"./Symbol\"\nimport { IIDecorator } from \"./IIDecorator\"\nimport { IISymbolBase } from \"./IISymbolBase\"\nimport { IIStroke } from \"./IIStroke\"\nimport { IIText } from \"./IIText\"\nimport { TIISymbol } from \".\"\n\n/**\n * @group Symbol\n */\nexport class IISymbolGroup extends IISymbolBase<SymbolType.Group>\n{\n  readonly isClosed = false\n\n  children: TIISymbol[]\n  decorators: IIDecorator[]\n\n  constructor(\n    children: TIISymbol[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(SymbolType.Group, style)\n    this.children = children\n    this.decorators = []\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.bounds.snapPoints\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.children.flatMap(s => s.vertices)\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromBoxes(this.children.map(c => c.bounds))\n  }\n\n  updateChildrenStyle(): void\n  {\n    this.children.forEach(child => {\n      child.style = Object.assign({}, child.style, this.style)\n      switch (child.type) {\n        case SymbolType.Group:\n          child.updateChildrenStyle()\n          break\n        case SymbolType.Text:\n          child.chars.forEach(c =>\n          {\n            if (child.style.color) {\n              c.color = child.style.color\n            }\n          })\n          break\n        case SymbolType.Recognized:\n          child.updateChildrenStyle()\n          break\n      }\n\n    })\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.children.some(s => s.overlaps(box))\n  }\n\n  containsSymbol(strokeId: string): boolean\n  {\n    return IISymbolGroup.containsSymbol(this, strokeId)\n  }\n\n  containsOnlyStroke(): boolean\n  {\n    return IISymbolGroup.containsOnlyStroke(this)\n  }\n\n  extractText(): IIText[]\n  {\n    return IISymbolGroup.extractText(this)\n  }\n\n  extractStrokes(): IIStroke[]\n  {\n    return IISymbolGroup.extractStrokes(this)\n  }\n\n  removeChilds(symbolIds: string[]): IISymbolGroup\n  {\n    return IISymbolGroup.removeChilds(this, symbolIds)\n  }\n\n  static containsOnlyStroke(group: IISymbolGroup): boolean\n  {\n    return group.children.every(s =>\n    {\n      if (s.type === SymbolType.Group) {\n        return IISymbolGroup.containsOnlyStroke(s as IISymbolGroup)\n      }\n      if (s.type === SymbolType.Stroke) {\n        return true\n      }\n      return false\n    })\n  }\n\n  static extractText(group: IISymbolGroup): IIText[]\n  {\n    const texts: IIText[] = []\n    group.children.forEach(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Text:\n          texts.push(s)\n          break;\n        case SymbolType.Group:\n          texts.push(...IISymbolGroup.extractText(s))\n          break;\n      }\n    })\n    return texts\n  }\n\n  static extractStrokes(group: IISymbolGroup): IIStroke[]\n  {\n    const strokes: IIStroke[] = []\n    group.children.forEach(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Stroke:\n          strokes.push(s)\n          break;\n        case SymbolType.Recognized:\n          strokes.push(...s.strokes)\n          break;\n        case SymbolType.Group:\n          strokes.push(...IISymbolGroup.extractStrokes(s))\n          break;\n      }\n    })\n    return strokes\n  }\n\n  static containsSymbol(group: IISymbolGroup, symbolId: string): boolean\n  {\n    return group.children.some(symbol =>\n    {\n      if (symbol.id === symbolId) return true\n      if (symbol.type === SymbolType.Group) {\n        return IISymbolGroup.containsSymbol(symbol, symbolId)\n      }\n      else if (symbol.type === SymbolType.Recognized) {\n        return symbol.containsStroke(symbolId)\n      }\n      return false\n    })\n  }\n\n  static removeChilds(group: IISymbolGroup, symbolIds: string[]): IISymbolGroup\n  {\n    group.children = group.children.filter(s => !symbolIds.includes(s.id))\n    const symbolsToRemove = group.children.slice()\n    symbolsToRemove.forEach(s =>\n    {\n      if (s.type === SymbolType.Group) {\n        if (!s.removeChilds(symbolIds).children.length) {\n          group.children = group.children.filter(s1 => s1.id !== s.id)\n        }\n      }\n      else if (s.type === SymbolType.Recognized) {\n        s.removeStrokes(symbolIds)\n        if (!s.strokes.length) {\n          group.removeChilds([s.id])\n        }\n      }\n    })\n    return group\n  }\n\n  clone(): IISymbolGroup\n  {\n    const clone = new IISymbolGroup(this.children.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.decorators = this.decorators.map(d => d.clone())\n    return clone\n  }\n\n  toJSON(): PartialDeep<IISymbolGroup>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      children: structuredClone(this.children),\n      decorators: this.decorators.length ? structuredClone(this.decorators) : undefined\n    }\n  }\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep, convertDegreeToRadian, findIntersectionBetween2Segment, isPointInsidePolygon, computeRotatedPoint } from \"../utils\"\nimport { TPoint, isValidPoint } from \"./Point\"\nimport { SymbolType } from \"./Symbol\"\nimport { Box, TBox } from \"./Box\"\nimport { IIDecorator } from \"./IIDecorator\"\nimport { IISymbolBase } from \"./IISymbolBase\"\n\n/**\n * @group Symbol\n */\nexport type TIISymbolChar = {\n  id: string\n  label: string\n  fontSize: number\n  fontWeight: \"normal\" | \"bold\"\n  color: string\n  bounds: TBox\n}\n\n/**\n * @group Symbol\n */\nexport class IIText extends IISymbolBase<SymbolType.Text>\n{\n  readonly isClosed = true\n\n  point: TPoint\n  chars: TIISymbolChar[]\n  decorators: IIDecorator[]\n  bounds: Box\n  rotation?: {\n    degree: number,\n    center: TPoint\n  }\n\n  constructor(\n    chars: TIISymbolChar[],\n    point: TPoint,\n    bounds: TBox,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(SymbolType.Text, style)\n    this.point = point\n    this.bounds = new Box(bounds)\n    this.chars = chars\n    this.decorators = []\n  }\n\n  get label(): string\n  {\n    return this.chars.map(c => c.label).join(\"\")\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (this.rotation) {\n      const center = this.rotation.center\n      const rad = convertDegreeToRadian(-this.rotation.degree)\n      return this.bounds.corners\n        .map(p =>\n        {\n          return computeRotatedPoint(p, center, rad)\n        })\n    }\n    else {\n      return this.bounds.corners\n    }\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    const offsetY = this.bounds.yMax - this.point.y\n    const points = [\n      { x: this.bounds.x, y: this.bounds.yMin + offsetY },\n      { x: this.bounds.xMax, y: this.bounds.yMin + offsetY },\n      { x: this.bounds.xMax, y: this.bounds.yMax - offsetY },\n      { x: this.bounds.x, y: this.bounds.yMax - offsetY },\n      this.bounds.center\n    ]\n    if (this.rotation) {\n      const center = this.rotation.center\n      const rad = convertDegreeToRadian(-this.rotation.degree)\n      return points\n        .map(p =>\n        {\n          return computeRotatedPoint(p, center, rad)\n        })\n    }\n    return points\n  }\n\n  protected getCharCorners(char: TIISymbolChar): TPoint[]\n  {\n    const boxBox = new Box(char.bounds)\n    if (this.rotation) {\n      const center = this.rotation.center\n      const rad = convertDegreeToRadian(-this.rotation.degree)\n      return boxBox.corners\n        .map(p =>\n        {\n          return computeRotatedPoint(p, center, rad)\n        })\n    }\n    return boxBox.corners\n  }\n\n  updateChildrenStyle(): void\n  {\n    this.chars.forEach(c => {\n      if (this.style.color) {\n        c.color = this.style.color\n      }\n    })\n    this.modificationDate = Date.now()\n  }\n\n  updateChildrenFont( { fontSize, fontWeight }: { fontSize?: number, fontWeight?: \"normal\" | \"bold\" }): void\n  {\n    this.chars.forEach(c => {\n      if (fontSize) {\n        c.fontSize = fontSize\n      }\n      if (fontWeight) {\n        c.fontWeight = fontWeight\n      }\n    })\n    this.modificationDate = Date.now()\n  }\n\n  getCharsOverlaps(points: TPoint[]): TIISymbolChar[]\n  {\n    return this.chars.filter(c =>\n    {\n      const charCorners = this.getCharCorners(c)\n      return points.some(p => isPointInsidePolygon(p, charCorners))\n    })\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.vertices.some(p => Box.containsPoint(box, p)) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n\n  clone(): IIText\n  {\n    const clone = new IIText(structuredClone(this.chars), structuredClone(this.point), this.bounds, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.decorators = this.decorators.map(d => d.clone())\n    clone.rotation = this.rotation ? structuredClone(this.rotation) : undefined\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIText>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      point: this.point,\n      chars: this.chars,\n      style: this.style,\n      rotation: this.rotation,\n      bounds: this.bounds,\n      decorators: this.decorators.length ? this.decorators : undefined\n    }\n  }\n\n  static create(partial: PartialDeep<IIText>): IIText\n  {\n    if (!isValidPoint(partial?.point)) throw new Error(`Unable to create a IIText, point are invalid`)\n    if (!partial.chars?.length) throw new Error(`Unable to create a IIText, no chars`)\n    if (!partial.bounds) throw new Error(`Unable to create a IIText, no boundingBox`)\n    const text = new IIText(partial.chars as TIISymbolChar[], partial.point as TPoint, partial.bounds as TBox, partial.style)\n    if (partial.id) text.id = partial.id\n    if (partial.decorators?.length) {\n      partial.decorators.forEach(d => {\n        if(d?.kind) {\n          text.decorators.push(new IIDecorator(d.kind, Object.assign({}, text.style, d.style)))\n        }\n      })\n    }\n    return text\n  }\n}\n","import { createUUID, PartialDeep } from \"../utils\"\nimport { TPoint, TPointer } from \"./Point\"\nimport { Box, TBox } from \"./Box\"\nimport { SymbolType } from \"./Symbol\"\nimport { IISymbolBase } from \"./IISymbolBase\"\nimport { TStyle } from \"../style\"\n\nconst style: TStyle = {\n  color: \"grey\",\n  fill: \"none\",\n  width: 12,\n  opacity: 0.2\n}\n\n/**\n * @group Symbol\n */\nexport class IIEraser extends IISymbolBase<SymbolType.Eraser>\n{\n  readonly isClosed = false\n  pointers: TPointer[]\n\n  constructor()\n  {\n    super(SymbolType.Eraser, style)\n    this.id = `${ this.type }-${ createUUID() }`\n    this.creationTime = Date.now()\n    this.modificationDate = this.creationTime\n    this.pointers = []\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.pointers\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return []\n  }\n\n  clone(): IISymbolBase\n  {\n    const clone = new IIEraser()\n    clone.id = this.id\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.pointers = structuredClone(this.pointers)\n    return clone\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.pointers.some(p =>\n    {\n      return p.x >= box.x && p.x <= box.x + box.width\n        && p.y >= box.y && p.y <= box.y + box.height\n    })\n  }\n\n  toJSON(): PartialDeep<IIEraser>\n  {\n    return {\n      id: this.id,\n      pointers: this.pointers,\n      style: this.style\n    }\n  }\n}\n","import { DefaultPenStyle, TPenStyle } from \"../style\"\nimport { PartialDeep, createUUID } from \"../utils\"\nimport { TPointer } from \"./Point\"\nimport { SymbolType, TSymbol } from \"./Symbol\"\n\n/**\n * @group Symbol\n */\nexport type TStrokeToSend = {\n  id: string\n  pointerType: string\n  x: number[]\n  y: number[]\n  t: number[]\n  p: number[]\n}\n\n/**\n * @group Symbol\n */\nexport type TStrokeGroupToSend = {\n  penStyle?: string\n  strokes: TStrokeToSend[]\n}\n\n/**\n * @group Symbol\n */\nexport type TStroke = TSymbol & {\n  style: TPenStyle\n  pointerType: string\n  pointers: TPointer[]\n  length: number\n}\n\n/**\n * @group Symbol\n */\nexport type TStrokeGroup = {\n  penStyle: TPenStyle\n  strokes: Stroke[]\n}\n\n/**\n * @group Symbol\n */\nexport class Stroke implements TStroke\n{\n  type = SymbolType.Stroke\n  id: string\n  creationTime: number\n  modificationDate: number\n  style: TPenStyle\n  pointerType: string\n  pointers: TPointer[]\n  length: number\n\n  constructor(style: TPenStyle, pointerType = \"pen\")\n  {\n    this.id = `${this.type}-${createUUID()}`\n    this.creationTime = Date.now()\n    this.modificationDate = this.creationTime\n    this.style = style\n    this.pointerType = pointerType\n    this.pointers = []\n    this.length = 0\n  }\n\n  clone(): Stroke\n  {\n    const clone = new Stroke(this.style, this.pointerType)\n    clone.id = this.id\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.pointers = structuredClone(this.pointers)\n    clone.length = this.length\n    return clone\n  }\n\n  formatToSend(): TStrokeToSend\n  {\n    const json: TStrokeToSend = {\n      id: this.id,\n      pointerType: this.pointerType,\n      p: [],\n      t: [],\n      x: [],\n      y: []\n    }\n    this.pointers.forEach(p => {\n      json.p.push(p.p)\n      json.t.push(p.t)\n      json.x.push(p.x)\n      json.y.push(p.y)\n    })\n    return json\n  }\n}\n\n/**\n * @group Symbol\n * @group Utils\n */\nexport function convertPartialStrokesToStrokes(json: PartialDeep<TStroke>[]): Stroke[]\n{\n  const errors: string[] = []\n  const strokes: Stroke[] = []\n  json.forEach((j, ji) => {\n    let flag = true\n    const stroke = new Stroke(j.style || DefaultPenStyle, j.pointerType)\n    if (j.id) stroke.id = j.id\n    if (!j.pointers?.length) {\n      errors.push(`stroke ${ji + 1} has not pointers`)\n      flag = false\n      return\n    }\n    j.pointers?.forEach((pp, pIndex) => {\n      if (!pp) {\n        errors.push(`stroke ${ji + 1} has no pointer at ${pIndex}`)\n        flag = false\n        return\n      }\n      const pointer: TPointer = {\n        p: pp.p || 1,\n        t: pp.t || pIndex,\n        x: 0,\n        y: 0\n      }\n      if (pp?.x == undefined || pp?.x == null) {\n        errors.push(`stroke ${ji + 1} has no x at pointer at ${pIndex}`)\n        flag = false\n        return\n      }\n      else {\n        pointer.x = pp.x\n      }\n      if (pp?.y == undefined || pp?.y == null) {\n        errors.push(`stroke ${ji + 1} has no y at pointer at ${pIndex}`)\n        flag = false\n        return\n      }\n      else {\n        pointer.y = pp.y\n      }\n      if (flag) {\n        stroke.pointers.push(pointer)\n      }\n    })\n    if (flag) {\n      strokes.push(stroke)\n    }\n  })\n\n  if (errors.length) {\n    throw new Error(errors.join(\"\\n\"))\n  }\n\n  return strokes\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { TPenStyle } from \"../style\"\nimport { computeDistance } from \"../utils\"\nimport { TExport } from \"./Export\"\nimport { Stroke, TPoint, TPointer } from \"../symbol\"\n\n/**\n * @group Model\n */\nexport type TRecognitionPositions = {\n  lastSentPosition: number\n  lastReceivedPosition: number\n}\n\n/**\n * @group Model\n */\nexport class Model\n{\n  readonly creationTime: number\n  modificationDate: number\n  positions: TRecognitionPositions\n  currentSymbol?: Stroke\n  symbols: Stroke[]\n  exports?: TExport\n  converts?: TExport\n  width: number\n  height: number\n  rowHeight: number\n  idle: boolean\n  #logger = LoggerManager.getLogger(LoggerCategory.MODEL)\n\n  constructor(width = 100, height = 100, rowHeight = 0, creationDate = Date.now())\n  {\n    this.#logger.info(\"constructor\", { width, height, creationDate })\n    this.creationTime = creationDate\n    this.modificationDate = creationDate\n    this.width = width\n    this.height = height\n    this.rowHeight = rowHeight\n    this.symbols = []\n    this.positions = {\n      lastSentPosition: 0,\n      lastReceivedPosition: 0\n    }\n    this.idle = true\n  }\n\n  protected computePressure(distance: number, globalDistance: number): number\n  {\n    let ratio = 1.0\n    if (distance === globalDistance) {\n      ratio = 1.0\n    } else if (distance < 10) {\n      ratio = 0.2 + Math.pow(0.1 * distance, 0.4)\n    } else if (distance > globalDistance - 10) {\n      ratio = 0.2 + Math.pow(0.1 * (globalDistance - distance), 0.4)\n    }\n    const pressure = ratio * Math.max(0.1, 1.0 - (0.1 * Math.sqrt(distance)))\n    return isNaN(pressure) ? 0.5 : Math.round(pressure * 100) / 100\n  }\n\n  protected filterPointByAcquisitionDelta(stroke: Stroke, point: TPointer, lastPointer?: TPointer): boolean\n  {\n    const delta: number = (2 + ((stroke.style[\"-myscript-pen-width\"] || 0) / 4))\n    return !lastPointer ||\n      stroke.pointers.length === 0 ||\n      Math.abs(lastPointer.x - point.x) >= delta ||\n      Math.abs(lastPointer.y - point.y) >= delta\n  }\n\n  getStrokeFromPoint(point: TPoint): Stroke[]\n  {\n    this.#logger.info(\"getStrokeFromPoint\", { point })\n    const isBetween = (val: number, min: number, max: number): boolean => (val >= min && val <= max)\n\n    const _strokeList: Stroke[] = []\n    this.symbols.forEach((stroke) =>\n    {\n      for (let i = 0; i < stroke.pointers.length; i++) {\n        const strokePointer = stroke.pointers[i]\n        if (\n          isBetween(strokePointer.x, point.x - 5, point.x + 5) &&\n          isBetween(strokePointer.y, point.y - 5, point.y + 5)\n        ) {\n          _strokeList.push(stroke)\n          break\n        }\n        else {\n          if (computeDistance(point, strokePointer) < 10) {\n            _strokeList.push(stroke)\n            break\n          }\n        }\n      }\n    })\n    this.#logger.debug(\"getStrokeFromPoint\", { strokes: _strokeList })\n    return _strokeList\n  }\n\n  addPoint(stroke: Stroke, pointer: TPointer): void\n  {\n    this.#logger.debug(\"addPoint\", { stroke, pointer })\n    const lastPointer = stroke.pointers.at(-1)\n    if (this.filterPointByAcquisitionDelta(stroke, pointer, lastPointer)) {\n      const distance = lastPointer ? computeDistance(pointer, lastPointer) : 0\n      stroke.length += distance\n      pointer.p = this.computePressure(distance, stroke.length)\n      stroke.pointers.push(pointer)\n      stroke.modificationDate = Date.now()\n    }\n  }\n\n  addStroke(stroke: Stroke): void\n  {\n    this.#logger.info(\"addStroke\", { stroke })\n    this.symbols.push(stroke)\n    this.modificationDate = Date.now()\n    this.converts = undefined\n    this.exports = undefined\n  }\n\n  updateStroke(updatedStroke: Stroke): void\n  {\n    this.#logger.info(\"updateStroke\", { updatedStroke })\n    const strokeIndex = this.symbols.findIndex((s: Stroke): boolean => s.id === updatedStroke.id)\n    if (strokeIndex !== -1) {\n      updatedStroke.modificationDate = Date.now()\n      this.symbols.splice(strokeIndex, 1, updatedStroke)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"updateStroke\", this.symbols)\n  }\n\n  removeStroke(id: string): void\n  {\n    this.#logger.info(\"removeStroke\", { id })\n    const strokeIndex = this.symbols.findIndex(s => s.id === id)\n    if (strokeIndex !== -1) {\n      this.positions.lastSentPosition--\n      this.positions.lastReceivedPosition--\n      this.symbols.splice(strokeIndex, 1)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"removeStroke\", this.symbols)\n  }\n\n  removeStrokesFromPoint(point: TPoint): string[]\n  {\n    this.#logger.info(\"removeStrokesFromPoint\", { point })\n    const strokes = this.getStrokeFromPoint(point)\n    strokes.forEach(strokeToRemove =>\n    {\n      this.removeStroke(strokeToRemove.id)\n    })\n    this.#logger.debug(\"removeStrokesFromPoint\", strokes.map(s => s.id))\n    return strokes.map(s => s.id)\n  }\n\n  extractUnsentStrokes(): Stroke[]\n  {\n    return this.symbols.slice(this.positions.lastSentPosition)\n  }\n\n  initCurrentStroke(point: TPointer, pointerType: string, style: TPenStyle, dpi = 96): void\n  {\n    this.#logger.info(\"initCurrentStroke\", { point, pointerType, style, dpi })\n    if (style[\"-myscript-pen-width\"]) {\n      const pxWidth = (style[\"-myscript-pen-width\"] * dpi) / 25.4\n      style.width = pxWidth / 2\n    }\n    this.modificationDate = Date.now()\n    this.exports = undefined\n    this.currentSymbol = new Stroke(style, pointerType)\n    this.#logger.debug(\"initCurrentStroke\", this.currentSymbol)\n    this.addPoint(this.currentSymbol, point)\n  }\n\n  appendToCurrentStroke(point: TPointer): void\n  {\n    this.#logger.info(\"appendToCurrentStroke\", { point })\n    if (this.currentSymbol) {\n      this.addPoint(this.currentSymbol, point)\n    }\n    this.#logger.debug(\"appendToCurrentStroke\", this.currentSymbol)\n  }\n\n  endCurrentStroke(point: TPointer): void\n  {\n    this.#logger.info(\"endCurrentStroke\", { point })\n    if (this.currentSymbol) {\n      this.addPoint(this.currentSymbol, point)\n      this.addStroke(this.currentSymbol)\n      this.currentSymbol = undefined\n    }\n    this.#logger.debug(\"endCurrentStroke\", this.currentSymbol)\n  }\n\n  updatePositionSent(position: number = this.symbols.length): void\n  {\n    this.#logger.info(\"updatePositionSent\", { position })\n    this.positions.lastSentPosition = position\n    this.#logger.debug(\"updatePositionSent\", this.positions.lastSentPosition)\n  }\n\n  updatePositionReceived(): void\n  {\n    this.#logger.info(\"updatePositionReceived\")\n    this.positions.lastReceivedPosition = this.positions.lastSentPosition\n    this.#logger.debug(\"updatePositionReceived\", this.positions.lastReceivedPosition)\n  }\n\n  mergeExport(exports: TExport)\n  {\n    this.#logger.info(\"mergeExport\", { exports })\n    if (this.exports) {\n      Object.assign(this.exports, exports)\n    } else {\n      this.exports = exports\n    }\n    this.#logger.debug(\"mergeExport\", this.exports)\n  }\n\n  mergeConvert(converts: TExport)\n  {\n    this.#logger.info(\"mergeConvert\", { converts })\n    if (this.converts) {\n      Object.assign(this.converts, converts)\n    } else {\n      this.converts = converts\n    }\n    this.#logger.debug(\"mergeConvert\", this.converts)\n  }\n\n  clone(): Model\n  {\n    this.#logger.info(\"clone\")\n    const clonedModel = new Model(this.width, this.height, this.rowHeight, this.creationTime)\n    clonedModel.modificationDate = structuredClone(this.modificationDate)\n    clonedModel.currentSymbol = this.currentSymbol ? this.currentSymbol.clone() : undefined\n    clonedModel.symbols = this.symbols.map(s => s.clone())\n    clonedModel.positions = structuredClone(this.positions)\n    clonedModel.exports = this.exports ? structuredClone(this.exports) : undefined\n    clonedModel.converts = this.converts ? structuredClone(this.converts) : undefined\n    clonedModel.idle = this.idle\n    this.#logger.debug(\"clone\", { clonedModel })\n    return clonedModel\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    this.modificationDate = Date.now()\n    this.currentSymbol = undefined\n    this.symbols = []\n    this.positions.lastSentPosition = 0\n    this.positions.lastReceivedPosition = 0\n    this.exports = undefined\n    this.converts = undefined\n    this.idle = true\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport\n{\n  RecognizedKind,\n  SymbolType,\n  TIISymbol,\n} from \"../symbol\"\nimport { TExport } from \"./Export\"\n\n/**\n * @group Model\n */\nexport class IIModel\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MODEL)\n  #symbolsMap = new Map<string, TIISymbol>()\n  readonly creationTime: number\n  modificationDate: number\n  currentSymbol?: TIISymbol\n  symbols: TIISymbol[]\n  exports?: TExport\n  converts?: TExport\n  width: number\n  height: number\n  rowHeight: number\n  idle: boolean\n\n  constructor(width = 100, height = 100, rowHeight = 0, creationDate = Date.now())\n  {\n    this.creationTime = creationDate\n    this.modificationDate = creationDate\n    this.width = width\n    this.height = height\n    this.rowHeight = rowHeight\n    this.symbols = []\n    this.exports = undefined\n    this.converts = undefined\n    this.idle = true\n  }\n\n  /**\n   * Synchronize the internal Map with the symbols array\n   * Useful when symbols are modified directly (e.g., in tests)\n   */\n  #syncMap(): void\n  {\n    if (this.#symbolsMap.size !== this.symbols.length) {\n      this.#symbolsMap.clear()\n      this.symbols.forEach(s => this.#symbolsMap.set(s.id, s))\n    }\n  }\n\n  get symbolsSelected(): TIISymbol[]\n  {\n    return this.symbols.filter(s => s.selected)\n  }\n\n  get symbolsToDelete(): TIISymbol[]\n  {\n    return this.symbols.filter(s => s.deleting)\n  }\n\n  selectSymbol(id: string): void\n  {\n    this.#syncMap()\n    let symbol = this.#symbolsMap.get(id)\n    if (!symbol) {\n      symbol = this.symbols.find(s => s.type === SymbolType.Group && s.containsSymbol(id))\n    }\n    if (symbol) {\n      symbol.selected = true\n    }\n  }\n\n  unselectSymbol(id: string): void\n  {\n    this.#syncMap()\n    const symbol = this.#symbolsMap.get(id)\n    if (symbol) {\n      symbol.selected = false\n    }\n  }\n\n  resetSelection(): void\n  {\n    this.symbols.forEach(s => s.selected = false)\n  }\n\n  getRootSymbol(id: string): TIISymbol | undefined\n  {\n    this.#syncMap()\n    const directMatch = this.#symbolsMap.get(id)\n    if (directMatch) return directMatch\n\n    return this.symbols.find(s =>\n    {\n      if (s.type === SymbolType.Group && s.containsSymbol(id)) {\n        return s\n      }\n      if (s.type === SymbolType.Recognized && s.containsStroke(id)) {\n        return s\n      }\n      return\n    })\n  }\n\n  getSymbolRowIndex(symbol: TIISymbol): number\n  {\n    return Math.round((symbol.type === SymbolType.Recognized && symbol.kind === RecognizedKind.Text ? symbol.baseline : symbol.bounds.yMid) / this.rowHeight)\n  }\n\n  getSymbolsByRowOrdered(): { rowIndex: number, symbols: TIISymbol[] }[]\n  {\n    const rowsMap = new Map<number, TIISymbol[]>()\n\n    for (const s of this.symbols) {\n      const rowIndex = this.getSymbolRowIndex(s)\n      const row = rowsMap.get(rowIndex)\n      if (row) {\n        row.push(s)\n      } else {\n        rowsMap.set(rowIndex, [s])\n      }\n    }\n\n    const rows: { rowIndex: number, symbols: TIISymbol[] }[] = []\n    rowsMap.forEach((symbols, rowIndex) => {\n      symbols.sort((s1, s2) => s1.bounds.xMid - s2.bounds.xMid)\n      rows.push({ rowIndex, symbols })\n    })\n\n    return rows.sort((r1, r2) => r1.rowIndex - r2.rowIndex)\n  }\n\n  roundToLineGuide(y: number): number\n  {\n    return Math.round(y / this.rowHeight) * this.rowHeight\n  }\n\n  isSymbolAbove(source: TIISymbol, target: TIISymbol): boolean\n  {\n    return this.getSymbolRowIndex(source) > this.getSymbolRowIndex(target)\n  }\n\n  isSymbolInRow(source: TIISymbol, target: TIISymbol): boolean\n  {\n    return this.getSymbolRowIndex(source) === this.getSymbolRowIndex(target)\n  }\n\n  isSymbolBelow(source: TIISymbol, target: TIISymbol): boolean\n  {\n    return this.getSymbolRowIndex(source) < this.getSymbolRowIndex(target)\n  }\n\n  getFirstSymbol(symbols: TIISymbol[]): TIISymbol | undefined\n  {\n    if (!symbols.length) return\n    return symbols.reduce((previous, current) =>\n    {\n      if (previous) {\n        if (this.getSymbolRowIndex(previous) < this.getSymbolRowIndex(current)) {\n          return previous\n        }\n        else if (this.getSymbolRowIndex(previous) == this.getSymbolRowIndex(current) && previous.bounds.xMid < current.bounds.xMid) {\n          return previous\n        }\n      }\n      return current\n    })\n  }\n\n  getLastSymbol(symbols: TIISymbol[]): TIISymbol | undefined\n  {\n    if (!symbols.length) return\n    return symbols.reduce((previous, current) =>\n    {\n      if (previous) {\n        if (this.getSymbolRowIndex(previous) > this.getSymbolRowIndex(current)) {\n          return previous\n        }\n        if (this.getSymbolRowIndex(previous) < this.getSymbolRowIndex(current)) {\n          return current\n        }\n        else if (previous.bounds.xMid > current.bounds.xMid) {\n          return previous\n        }\n      }\n      return current\n    })\n  }\n\n  addSymbol(symbol: TIISymbol): void\n  {\n    this.#logger.info(\"addSymbol\", { symbol })\n    if (this.#symbolsMap.has(symbol.id)) {\n      throw new Error(`Symbol id already exist: ${ symbol.id }`)\n    }\n    this.symbols.push(symbol)\n    this.#symbolsMap.set(symbol.id, symbol)\n    this.modificationDate = Date.now()\n    this.converts = undefined\n    this.exports = undefined\n    this.#logger.debug(\"addSymbol\", this.symbols)\n  }\n\n  updateSymbol(updatedSymbol: TIISymbol): void\n  {\n    this.#logger.info(\"updateSymbol\", { updatedSymbol })\n    const sIndex = this.symbols.findIndex(s => s.id === updatedSymbol.id)\n    if (sIndex !== -1) {\n      updatedSymbol.modificationDate = Date.now()\n      this.symbols.splice(sIndex, 1, updatedSymbol)\n      this.#symbolsMap.set(updatedSymbol.id, updatedSymbol)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"updateSymbol\", this.symbols)\n  }\n\n  replaceSymbol(id: string, symbols: TIISymbol[]): void\n  {\n    const sIndex = this.symbols.findIndex(s => s.id === id)\n    if (sIndex !== -1) {\n      this.symbols.splice(sIndex, 1, ...symbols)\n      this.#symbolsMap.delete(id)\n      symbols.forEach(s => this.#symbolsMap.set(s.id, s))\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n  }\n\n  changeOrderSymbol(id: string, position: \"first\" | \"last\" | \"forward\" | \"backward\")\n  {\n    const fromIndex = this.symbols.findIndex(s => s.id === id)\n    if (fromIndex > -1) {\n      let toIndex = fromIndex\n      switch (position) {\n        case \"first\":\n          toIndex = 0\n          break\n        case \"last\":\n          toIndex = this.symbols.length - 1\n          break\n        case \"forward\":\n          toIndex = Math.min(toIndex + 1, this.symbols.length - 1)\n          break\n        case \"backward\":\n          toIndex = Math.max(toIndex - 1, 0)\n          break\n      }\n      const sym = this.symbols.splice(fromIndex, 1)[0]\n      this.symbols.splice(toIndex, 0, sym)\n    }\n  }\n\n  removeSymbol(id: string): void\n  {\n    this.#logger.info(\"removeSymbol\", { id })\n    this.#syncMap()\n    const symbolIndex = this.symbols.findIndex(s => s.id === id)\n    if (symbolIndex !== -1) {\n      this.symbols.splice(symbolIndex, 1)\n      this.#symbolsMap.delete(id)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"removeSymbol\", this.symbols)\n  }\n\n  extractDifferenceSymbols(model: IIModel): { added: TIISymbol[], removed: TIISymbol[] }\n  {\n    const modelKeys = new Set(model.symbols.map(s => `${s.id}:${s.modificationDate}`))\n    const thisKeys = new Set(this.symbols.map(s => `${s.id}:${s.modificationDate}`))\n\n    return {\n      added: this.symbols.filter(s => !modelKeys.has(`${s.id}:${s.modificationDate}`)),\n      removed: model.symbols.filter(s => !thisKeys.has(`${s.id}:${s.modificationDate}`))\n    }\n  }\n\n  mergeExport(exports: TExport)\n  {\n    this.#logger.info(\"mergeExport\", { exports })\n    if (this.exports) {\n      Object.assign(this.exports, exports)\n    } else {\n      this.exports = exports\n    }\n    this.#logger.debug(\"mergeExport\", this.exports)\n  }\n\n  clone(): IIModel\n  {\n    this.#logger.info(\"clone\")\n    const clonedModel = new IIModel(this.width, this.height, this.rowHeight, this.creationTime)\n    clonedModel.modificationDate = this.modificationDate\n    clonedModel.symbols = this.symbols.map(s =>\n    {\n      const c = s.clone()\n      c.selected = false\n      clonedModel.#symbolsMap.set(c.id, c)\n      return c\n    })\n    clonedModel.exports = structuredClone(this.exports)\n    clonedModel.idle = this.idle\n    this.#logger.debug(\"clone\", { clonedModel })\n    return clonedModel\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    this.modificationDate = Date.now()\n    this.symbols = []\n    this.#symbolsMap.clear()\n    this.currentSymbol = undefined\n    this.exports = undefined\n    this.converts = undefined\n    this.idle = true\n\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIStroke } from \"../symbol\"\nimport { TExportV2 } from \"./ExportV2\"\n\n/**\n * @group Model\n */\nexport class IModel\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MODEL)\n  readonly creationTime: number\n  modificationDate: number\n  currentStroke?: IIStroke\n  strokes: IIStroke[]\n  exports?: TExportV2\n  converts?: TExportV2\n  width: number\n  height: number\n  rowHeight: number\n  idle: boolean\n\n  constructor(width = 100, height = 100, rowHeight = 0, creationDate = Date.now())\n  {\n    this.creationTime = creationDate\n    this.modificationDate = creationDate\n    this.width = width\n    this.height = height\n    this.rowHeight = rowHeight\n    this.strokes = []\n    this.exports = undefined\n    this.converts = undefined\n    this.idle = true\n  }\n\n  get strokesToDelete(): IIStroke[]\n  {\n    return this.strokes.filter(s => s.deleting)\n  }\n\n  addStroke(stroke: IIStroke): void\n  {\n    this.#logger.info(\"addStroke\", { stroke })\n    const sIndex = this.strokes.findIndex(s => s.id === stroke.id)\n    if (sIndex > -1) {\n      throw new Error(`Stroke id already exist: ${ stroke.id }`)\n    }\n    this.strokes.push(stroke)\n    this.modificationDate = Date.now()\n    this.converts = undefined\n    this.exports = undefined\n    this.#logger.debug(\"addStroke\", this.strokes)\n  }\n\n  updateStroke(updatedStroke: IIStroke): void\n  {\n    this.#logger.info(\"updateStroke\", { updatedStroke })\n    const sIndex = this.strokes.findIndex(s => s.id === updatedStroke.id)\n    if (sIndex !== -1) {\n      updatedStroke.modificationDate = Date.now()\n      this.strokes.splice(sIndex, 1, updatedStroke)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"updateStroke\", this.strokes)\n  }\n\n  removeStroke(id: string): void\n  {\n    this.#logger.info(\"removeSymbol\", { id })\n    const strokeIndex = this.strokes.findIndex(s => s.id === id)\n    if (strokeIndex !== -1) {\n      this.strokes.splice(strokeIndex, 1)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"removeSymbol\", this.strokes)\n  }\n\n  extractDifferenceStrokes(model: IModel): { added: IIStroke[], removed: IIStroke[] }\n  {\n    const modelStrokeKeys = new Set(model.strokes.map(s => `${s.id}-${s.modificationDate}`))\n    const thisStrokeKeys = new Set(this.strokes.map(s => `${s.id}-${s.modificationDate}`))\n\n    return {\n      added: this.strokes.filter(s => !modelStrokeKeys.has(`${s.id}-${s.modificationDate}`)),\n      removed: model.strokes.filter(s => !thisStrokeKeys.has(`${s.id}-${s.modificationDate}`))\n    }\n  }\n\n  mergeExport(exports: TExportV2)\n  {\n    this.#logger.info(\"mergeExport\", { exports })\n    if (this.exports) {\n      Object.assign(this.exports, exports)\n    } else {\n      this.exports = exports\n    }\n    this.#logger.debug(\"mergeExport\", this.exports)\n  }\n\n  clone(): IModel\n  {\n    this.#logger.info(\"clone\")\n    const clonedModel = new IModel(this.width, this.height, this.rowHeight, this.creationTime)\n    clonedModel.modificationDate = this.modificationDate\n    clonedModel.strokes = this.strokes.map(s =>\n    {\n      const c = s.clone()\n      c.selected = false\n      return c\n    })\n    clonedModel.exports = structuredClone(this.exports)\n    clonedModel.idle = this.idle\n    this.#logger.debug(\"clone\", { clonedModel })\n    return clonedModel\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    this.modificationDate = Date.now()\n    this.strokes = []\n    this.exports = undefined\n    this.converts = undefined\n    this.currentStroke = undefined\n    this.idle = true\n\n  }\n}\n","/**\n * @group Recognizer\n */\nexport type TScheme = \"https\" | \"http\"\n\n/**\n * @group Recognizer\n */\nexport type TServerHTTPConfiguration = {\n  scheme: TScheme,\n  host: string\n  applicationKey: string\n  hmacKey: string | ((applicationKey: string) => Promise<string>)\n  version?: string\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultServerHTTPConfiguration: TServerHTTPConfiguration = {\n  scheme: \"https\",\n  host: \"cloud.myscript.com\",\n  applicationKey: \"\",\n  hmacKey: \"\",\n  version: \"\"\n}\n\n/**\n * @group Recognizer\n */\nexport type TServerWebsocketConfiguration = TServerHTTPConfiguration & {\n  websocket: {\n    pingEnabled: boolean\n    pingDelay: number\n    maxPingLostCount: number\n    autoReconnect: boolean\n    maxRetryCount: number\n    fileChunkSize: number\n  }\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultServerWebsocketConfiguration: TServerWebsocketConfiguration = {\n  ...DefaultServerHTTPConfiguration,\n  websocket: {\n    pingEnabled: true,\n    pingDelay: 15000,\n    maxPingLostCount: 20,\n    autoReconnect: true,\n    maxRetryCount: 2,\n    fileChunkSize: 300000\n  }\n}\n","\n/**\n * @group Recognizer\n */\nexport type TEraserConfiguration = {\n  \"erase-precisely\": boolean\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultEraserConfiguration: TEraserConfiguration = {\n  \"erase-precisely\": false\n}\n","\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\nimport { TTextConfConfiguration } from \"./TextConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TDiagramConvertConfiguration = {\n  types?: (\"text\" | \"shape\")[]\n  \"match-text-size\"?: boolean\n}\n\n/**\n * @group Recognizer\n */\nexport type TDiagramConfiguration = {\n  mimeTypes: (\"application/vnd.myscript.jiix\" | \"application/vnd.openxmlformats-officedocument.presentationml.presentation\" | \"image/svg+xml\")[]\n  \"enable-sub-blocks\"?: boolean\n  text?: TTextConfConfiguration\n  convert?: TDiagramConvertConfiguration\n  \"session-time\"?: number\n  eraser?: TEraserConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultDiagramConvertConfiguration: TDiagramConvertConfiguration = {\n  types: [\"text\", \"shape\"],\n  \"match-text-size\": true\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultDiagramConfiguration: TDiagramConfiguration = {\n  convert: DefaultDiagramConvertConfiguration,\n  eraser: DefaultEraserConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n}\n","\n/**\n * @group Recognizer\n */\nexport type TImageViewportConfiguration = {\n  x: number\n  y: number\n  width: number\n  height: number\n}\n\n/**\n * @group Recognizer\n */\nexport type TImageConfiguration = {\n  guides: boolean\n  viewport: TImageViewportConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport type TJiixConfiguration = {\n  \"bounding-box\": boolean\n  strokes: boolean\n  ids: boolean\n  \"full-stroke-ids\": boolean\n  text: {\n    chars: boolean\n    words: boolean\n    lines?: boolean\n  }\n  style?: boolean\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultJiixConfiguration: TJiixConfiguration = {\n  \"bounding-box\": false,\n  strokes: false,\n  ids: false,\n  \"full-stroke-ids\": false,\n  text: {\n    chars: false,\n    words: true,\n    lines: false\n  },\n}\n\n/**\n * @group Recognizer\n */\nexport type TMathMLFlavor = {\n  name: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TMathMLExport = {\n  flavor: TMathMLFlavor\n}\n\n/**\n * @group Recognizer\n */\nexport type TExportConfiguration = {\n  \"image-resolution\"?: number\n  image?: TImageConfiguration\n  jiix: TJiixConfiguration\n  mathml?: TMathMLExport\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultExportConfiguration: TExportConfiguration = {\n  \"image-resolution\": 300,\n  jiix: DefaultJiixConfiguration\n}\n","\n/**\n * @group Recognizer\n */\nexport type TMarginConfiguration = {\n  bottom: number\n  left: number\n  right: number\n  top: number\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultMarginConfiguration: TMarginConfiguration = {\n  top: 20,\n  left: 10,\n  right: 10,\n  bottom: 10\n}\n","import { DefaultMarginConfiguration, TMarginConfiguration } from \"./MarginConfiguration\"\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRoundingMode = \"half up\" | \"truncate\"\n\n/**\n * @group Recognizer\n */\nexport type TAngleUnit = \"deg\" | \"rad\"\n\n/**\n * @group Recognizer\n */\nexport type TSolverOptions = \"algebraic\" | \"numeric\"\n\n/**\n * @group Recognizer\n */\nexport type TSolverConfiguration = {\n  enable?: boolean\n  \"fractional-part-digits\"?: number\n  \"decimal-separator\"?: string\n  \"rounding-mode\"?: TRoundingMode\n  \"angle-unit\"?: TAngleUnit\n  options?: TSolverOptions\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultSolverConfiguration: TSolverConfiguration = {\n  enable: true,\n  \"fractional-part-digits\": 3,\n  \"decimal-separator\": \".\",\n  \"rounding-mode\": \"half up\",\n  \"angle-unit\": \"deg\"\n}\n\n/**\n * @group Recognizer\n */\nexport type TUndoRedoMode = \"stroke\" | \"session\"\n\n/**\n * @group Recognizer\n */\nexport type TMathUndoRedoConfiguration = {\n  mode: TUndoRedoMode\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultMathUndoRedoConfiguration: TMathUndoRedoConfiguration = {\n  mode: \"stroke\"\n}\n\n/**\n * @group Recognizer\n */\nexport type TMathConfiguration = {\n  mimeTypes: (\"application/x-latex\" | \"application/mathml+xml\" | \"application/vnd.myscript.jiix\")[]\n  solver?: TSolverConfiguration\n  margin: TMarginConfiguration\n  \"undo-redo\"?: TMathUndoRedoConfiguration\n  customGrammar?: string\n  customGrammarId?: string\n  customGrammarContent?: string\n  eraser?: TEraserConfiguration\n  \"session-time\"?: number\n  \"recognition-timeout\"?: number\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultMathConfiguration: TMathConfiguration = {\n  solver: DefaultSolverConfiguration,\n  margin: DefaultMarginConfiguration,\n  eraser: DefaultEraserConfiguration,\n  \"undo-redo\": DefaultMathUndoRedoConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n}\n","\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\nimport { TTextConfConfiguration } from \"./TextConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRawContentConfiguration = {\n  text?: TTextConfConfiguration\n  \"session-time\"?: number\n  recognition: {\n    types: (\"text\" | \"shape\" | \"math\" | \"decoration\")[]\n  }\n  classification: {\n    types: (\"text\" | \"shape\" | \"math\" | \"decoration\" | \"drawing\")[]\n  }\n  eraser?: TEraserConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRawContentConfiguration: TRawContentConfiguration = {\n  recognition: {\n    types: [ \"text\", \"math\", \"shape\", \"decoration\"]\n  },\n  classification: {\n    types: [ \"text\", \"math\", \"shape\", \"decoration\", \"drawing\"]\n  },\n  eraser: DefaultEraserConfiguration,\n}\n","\n/**\n * @group Recognizer\n */\nexport type TRecognitionRendererDebugConfiguration = {\n  \"draw-text-boxes\": boolean\n  \"draw-image-boxes\": boolean\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultDebugConfiguration: TRecognitionRendererDebugConfiguration = {\n  \"draw-text-boxes\": false,\n  \"draw-image-boxes\": false\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognitionRendererConfiguration = {\n  debug: TRecognitionRendererDebugConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognitionRendererConfiguration: TRecognitionRendererConfiguration = {\n  debug: DefaultDebugConfiguration\n}\n","import { DefaultMarginConfiguration, TMarginConfiguration } from \"./MarginConfiguration\"\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TTextGuidesConfiguration = {\n  enable: boolean\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultTextGuidesConfiguration: TTextGuidesConfiguration = {\n  enable: true\n}\n\n/**\n * @group Recognizer\n */\nexport type TTextConfConfiguration = {\n  customResources?: string[]\n  customLexicon?: string[]\n  addLKText?: boolean\n}\n\n/**\n * @group Recognizer\n */\nexport type TTextConfiguration = {\n  text?: boolean\n  mimeTypes: (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n  margin: TMarginConfiguration\n  guides?: TTextGuidesConfiguration\n  configuration?: TTextConfConfiguration\n  eraser?: TEraserConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultTextConfiguration: TTextConfiguration = {\n  guides: DefaultTextGuidesConfiguration,\n  eraser: DefaultEraserConfiguration,\n  margin: DefaultMarginConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n}\n","import { DefaultMarginConfiguration, TMarginConfiguration } from \"./MarginConfiguration\"\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TTextGuidesConfigurationV2 = {\n  enable: boolean,\n  \"line-gap-mm\"?: number,\n  \"origin-y-mm\"?: number,\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultTextGuidesConfigurationV2: TTextGuidesConfigurationV2 = {\n  enable: true,\n  \"line-gap-mm\": 100,\n  \"origin-y-mm\": 0,\n}\n\n/**\n * @group Recognizer\n */\nexport type TTextRecognizerHTTPV2ConfConfiguration = {\n  customResources?: string[]\n  customLexicon?: string[]\n  addLKText?: boolean\n}\n\n/**\n * @group Recognizer\n */\nexport type TTextRecognizerHTTPV2Configuration = {\n  text?: boolean\n  mimeTypes: (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n  margin: TMarginConfiguration\n  guides: TTextGuidesConfigurationV2\n  configuration?: TTextRecognizerHTTPV2ConfConfiguration\n  eraser?: TEraserConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultTexConfigurationV2: TTextRecognizerHTTPV2Configuration = {\n  guides: DefaultTextGuidesConfigurationV2,\n  eraser: DefaultEraserConfiguration,\n  margin: DefaultMarginConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n}\n","\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TShapeConvertConfiguration = {\n  types?: (\"shape\")[]\n  \"match-text-size\"?: boolean\n}\n\nexport type TShapeBeautificationConfiguration = {\n    enable?: true\n}\n/**\n * @group Recognizer\n */\nexport type TShapeConfiguration = {\n  mimeTypes: (\"application/vnd.myscript.jiix\" | \"application/vnd.openxmlformats-officedocument.presentationml.presentation\" | \"image/svg+xml\")[]\n  \"enable-sub-blocks\"?: boolean\n  convert?: TShapeConvertConfiguration\n  \"session-time\"?: number\n  eraser?: TEraserConfiguration\n  beautification?: TShapeBeautificationConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultShapeConvertConfiguration: TShapeConvertConfiguration = {\n  types: [\"shape\"],\n  \"match-text-size\": true\n}\n\nexport const DefaultShapeBeautificationConfiguration: TShapeBeautificationConfiguration = {\n    enable: true\n  }\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultShapeConfiguration: TShapeConfiguration = {\n  convert: DefaultShapeConvertConfiguration,\n  eraser: DefaultEraserConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n  beautification: DefaultShapeBeautificationConfiguration\n}\n","import { DefaultEraserConfiguration } from \"./EraserConfiguration\";\nimport { DefaultMarginConfiguration } from \"./MarginConfiguration\";\nimport { DefaultMathUndoRedoConfiguration, DefaultSolverConfiguration, TMathConfiguration } from \"./MathConfiguration\";\n\nexport const DefaultMathV2Configuration: TMathConfiguration = {\n  solver: DefaultSolverConfiguration,\n  margin: DefaultMarginConfiguration,\n  eraser: DefaultEraserConfiguration,\n  \"undo-redo\": DefaultMathUndoRedoConfiguration,\n  mimeTypes: [\"application/x-latex\"],\n}","import { DefaultEraserConfiguration } from \"./EraserConfiguration\";\nimport { TRawContentConfiguration } from \"./RawContentConfiguration\";\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRawContentV2Configuration: TRawContentConfiguration = {\n  recognition: {\n    types: [ \"text\", \"math\", \"shape\"]\n  },\n  classification: {\n    types: [ \"text\", \"math\", \"shape\", \"decoration\", \"drawing\"]\n  },\n  eraser: DefaultEraserConfiguration,\n}\n","import { THistoryContext } from \"../history\"\nimport { TExport } from \"../model\"\nimport { TRecognizerWebSocketSSRMessageSVGPatch } from \"./RecognizerWebSocketSSRMessage\"\n\n/**\n * @group Recognizer\n * @summary\n * Lists all events that can be listened to on the editor or DOM element\n * @example\n * You can run code on \"RecognizerEventName\" raised by using\n * ```ts\n * recognizer.events.addEventListener(RecognizerEventName.CONTENT_CHANGED, (evt) => console.log(evt.detail))\n * ```\n */\nexport enum RecognizerEventName\n{\n  /**\n   * @summary event emitted at the start of connection initialization\n   */\n  START_INITIALIZATION = \"start-initialization\",\n  /**\n   * @summary event emitted after full recognizer initialization\n   */\n  END_INITIALIZATION = \"end-initialization\",\n  /**\n   * @summary event emitted after receiving an \"contentChanged\" message\n   */\n  CONTENT_CHANGED = \"content-changed\",\n  /**\n   * @summary event emitted after receiving an \"idle\" message\n   */\n  IDLE = \"idle\",\n  /**\n   * @summary event emitted after receiving an \"exported\" message\n   */\n  EXPORTED = \"exported\",\n  /**\n   * @summary event emitted when the recognizer encounters an error\n   */\n  ERROR = \"error\",\n  /**\n   * @remarks event emitted after connection closed\n   */\n  CONNECTION_CLOSE = \"connection-close\",\n  /**\n   * @summary\n   * event emitted after receiving an \"svgPatch\" message\n   * @remarks\n   * only usable in the case of websocket\n   */\n  SVG_PATCH = \"svg-patch\",\n  /**\n   * @summary event emitted session opened\n   */\n  SESSION_OPENED = \"session-opened\",\n\n}\n\n/**\n * @group Recognizer\n */\nexport class RecognizerEvent extends EventTarget\n{\n  protected abortController: AbortController\n\n  constructor()\n  {\n    super()\n    this.abortController = new AbortController()\n  }\n\n  removeAllListeners(): void\n  {\n    this.abortController.abort()\n    this.abortController = new AbortController()\n  }\n\n  protected emit(type: string, data?: unknown): void\n  {\n    const evt = new CustomEvent(type, Object.assign({ bubbles: true, composed: true }, data ? { detail: data } : undefined))\n    this.dispatchEvent(evt)\n  }\n\n  emitStartInitialization(): void\n  {\n    this.emit(RecognizerEventName.START_INITIALIZATION)\n  }\n  addStartInitialization(callback: () => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.START_INITIALIZATION,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitEndtInitialization(): void\n  {\n    this.emit(RecognizerEventName.END_INITIALIZATION)\n  }\n  addEndInitialization(callback: () => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.END_INITIALIZATION,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitSessionOpened(sessionId: string): void\n  {\n    this.emit(RecognizerEventName.SESSION_OPENED, sessionId)\n  }\n  addSessionOpenedListener(callback: (sessionId: string) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.SESSION_OPENED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as string),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitContentChanged(undoRedoContext: THistoryContext): void\n  {\n    this.emit(RecognizerEventName.CONTENT_CHANGED, {\n      ...undoRedoContext,\n      canClear: !undoRedoContext.empty\n    })\n  }\n  addContentChangedListener(callback: (context: THistoryContext) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.CONTENT_CHANGED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as THistoryContext),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitIdle(idle: boolean): void\n  {\n    this.emit(RecognizerEventName.IDLE, idle)\n  }\n  addIdleListener(callback: (idle: boolean) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.IDLE,\n      (evt: unknown) => callback((evt as CustomEvent).detail as boolean),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitExported(exports: TExport): void\n  {\n    this.emit(RecognizerEventName.EXPORTED, exports)\n  }\n  addExportedListener(callback: (exports: TExport) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.EXPORTED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TExport),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitError(err: Error): void\n  {\n    this.emit(RecognizerEventName.ERROR, err)\n  }\n  addErrorListener(callback: (err: Error) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.ERROR,\n      (evt: unknown) => callback((evt as CustomEvent).detail as Error),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitConnectionClose({ code, message }: { code: number, message?: string }): void\n  {\n    this.emit(RecognizerEventName.CONNECTION_CLOSE, { code, message })\n  }\n  addConnectionCloseListener(callback: ({ code, message }: { code: number, message?: string }) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.CONNECTION_CLOSE,\n      (evt: unknown) => callback((evt as CustomEvent).detail as { code: number, message?: string }),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  /**\n   * @remarks only use in the case of websocket\n   */\n  emitSVGPatch(svgPatch: TRecognizerWebSocketSSRMessageSVGPatch): void\n  {\n    this.emit(RecognizerEventName.SVG_PATCH, svgPatch)\n  }\n  /**\n   * @remarks only usable in the case of websocket\n   */\n  addSVGPatchListener(callback:  (svgPatch: TRecognizerWebSocketSSRMessageSVGPatch) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.SVG_PATCH,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TRecognizerWebSocketSSRMessageSVGPatch),\n      { signal: this.abortController.signal }\n    )\n  }\n}\n","/**\n * @group Recognizer\n * @remarks List all errors generated by the backend with their descriptions\n */\nexport enum RecognizerError {\n  NO_ACTIVITY = \"Session closed due to no activity. Without a connection on your part, it will be permanently lost after an hour.\",\n  WRONG_CREDENTIALS = \"Application credentials are invalid. Please check or regenerate your application key and hmackey.\",\n  TOO_OLD = \"Session is too old. Max Session Duration Reached.\",\n  NO_SESSION_FOUND = \"No sessions found. Without activation for 1 hour, sessions are deleted from the server. To avoid losing your work, use the json export, then import it this will create a new session.\",\n  UNKNOW = \"An unknown error has occurred.\",\n  ABNORMAL_CLOSURE = \"MyScript recognition server is not reachable.\",\n  CANT_ESTABLISH = \"Unable to establish a connection to MyScript recognition server. Check the host and your connectivity.\",\n  GOING_AWAY = \"MyScript recognition server is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection.\",\n  PROTOCOL_ERROR = \"MyScript recognition server terminated the connection due to a protocol error.\",\n  UNSUPPORTED_DATA = \"MyScript recognition server terminated the connection because the endpoint received data of a type it cannot accept. (For example, a text-only endpoint received binary data.)\",\n  INVALID_FRAME_PAYLOAD = \"MyScript recognition server terminated the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message).\",\n  POLICY_VIOLATION = \"MyScript recognition server terminated the connection because it received a message that violates its policy.\",\n  MESSAGE_TOO_BIG = \"MyScript recognition server terminated the connection because a data frame was received that is too large.\",\n  INTERNAL_ERROR = \"MyScript recognition server terminated the connection because it encountered an unexpected condition that prevented it from fulfilling the request.\",\n  SERVICE_RESTART = \"MyScript recognition server terminated the connection because it is restarting.\",\n  TRY_AGAIN = \"MyScript recognition server terminated the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients.\",\n  BAD_GATEWAY = \"MyScript recognition server was acting as a gateway or proxy and received an invalid response from the upstream server.\",\n  TLS_HANDSHAKE = \"MyScript recognition server connection was closed due to a failure to perform a TLS handshake\",\n}\n","import { isVersionSuperiorOrEqual, mergeDeep, PartialDeep } from \"../utils\"\nimport {\n  DefaultDiagramConfiguration,\n  DefaultExportConfiguration,\n  DefaultMathConfiguration,\n  DefaultRawContentConfiguration,\n  DefaultRecognitionRendererConfiguration,\n  DefaultTextConfiguration,\n  TConvertionConfiguration,\n  TDiagramConfiguration,\n  TExportConfiguration,\n  TMathConfiguration,\n  TRawContentConfiguration,\n  TRecognitionRendererConfiguration,\n  TTextConfiguration\n} from \"./recognition\"\nimport { TRecognitionType } from \"./RecognitionConfiguration\"\nimport { DefaultServerHTTPConfiguration, TServerHTTPConfiguration } from \"./ServerConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRecognitionHTTPV1Configuration = {\n  type: TRecognitionType\n  lang: string\n  math: TMathConfiguration\n  text: TTextConfiguration\n  diagram: TDiagramConfiguration\n  \"raw-content\": TRawContentConfiguration\n  renderer: TRecognitionRendererConfiguration\n  export: TExportConfiguration\n  convert?: TConvertionConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaulRecognitionHTTPV1ConfigurationConfiguration: TRecognitionHTTPV1Configuration = {\n  export: DefaultExportConfiguration,\n  math: DefaultMathConfiguration,\n  diagram: DefaultDiagramConfiguration,\n  \"raw-content\": DefaultRawContentConfiguration,\n  renderer: DefaultRecognitionRendererConfiguration,\n  text: DefaultTextConfiguration,\n  type: \"TEXT\",\n  lang: \"en_US\",\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV1Configuration = {\n  server: TServerHTTPConfiguration\n  recognition: TRecognitionHTTPV1Configuration\n}\n\n/**\n * @group Recognizer\n */\nexport const DefaultRecognizerHTTPV1Configuration: TRecognizerHTTPV1Configuration =\n{\n  server: DefaultServerHTTPConfiguration,\n  recognition: DefaulRecognitionHTTPV1ConfigurationConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport class RecognizerHTTPV1Configuration implements TRecognizerHTTPV1Configuration {\n  recognition: TRecognitionHTTPV1Configuration\n  server: TServerHTTPConfiguration\n\n  constructor(configuration?: PartialDeep<TRecognizerHTTPV1Configuration>)\n  {\n    this.server = mergeDeep({}, DefaultRecognizerHTTPV1Configuration.server, configuration?.server)\n    this.recognition = mergeDeep({}, DefaultRecognizerHTTPV1Configuration.recognition, configuration?.recognition)\n\n    if (configuration?.recognition?.text?.mimeTypes) {\n      this.recognition.text.mimeTypes = configuration.recognition.text.mimeTypes as (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n    }\n    this.recognition.text.mimeTypes = [...new Set(this.recognition.text.mimeTypes)]\n\n    if (configuration?.recognition?.math?.mimeTypes) {\n      this.recognition.math.mimeTypes = configuration.recognition.math.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/x-latex\" | \"application/mathml+xml\")[]\n    }\n    this.recognition.math.mimeTypes = [...new Set(this.recognition.math.mimeTypes)]\n\n    if (configuration?.recognition?.diagram?.mimeTypes) {\n      this.recognition.diagram.mimeTypes = configuration.recognition.diagram.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/vnd.openxmlformats-officedocument.presentationml.presentation\" | \"image/svg+xml\")[]\n    }\n    this.recognition.diagram.mimeTypes = [...new Set(this.recognition.diagram.mimeTypes)]\n\n    if (configuration?.recognition?.diagram?.convert?.types) {\n      this.recognition.diagram.convert!.types = configuration.recognition.diagram.convert.types as (\"text\" | \"shape\")[]\n    }\n\n    if (configuration?.recognition?.[\"raw-content\"]?.recognition?.types) {\n      this.recognition[\"raw-content\"].recognition!.types = configuration?.recognition?.[\"raw-content\"]?.recognition?.types as (\"text\" | \"shape\")[]\n    }\n    this.recognition[\"raw-content\"].recognition.types = [...new Set(this.recognition[\"raw-content\"].recognition.types.filter((type) => type !== \"decoration\"))]\n\n    if (configuration?.recognition?.[\"raw-content\"]?.classification?.types) {\n      this.recognition[\"raw-content\"].classification!.types = configuration?.recognition?.[\"raw-content\"]?.classification?.types as (\"text\" | \"shape\")[]\n    }\n\n    if (this.server.version) {\n      if (!isVersionSuperiorOrEqual(this.server.version, \"2.3.0\")) {\n        delete this.recognition.convert\n      }\n      if (!isVersionSuperiorOrEqual(this.server.version, \"3.2.0\")) {\n        delete this.recognition.export.jiix.text.lines\n      }\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { Model, TExport, TJIIXExport } from \"../model\"\nimport { TStrokeGroup, TStrokeGroupToSend } from \"../symbol\"\nimport { StyleHelper, TPenStyle } from \"../style\"\nimport { computeHmac, getApiInfos, isVersionSuperiorOrEqual, PartialDeep } from \"../utils\"\nimport { RecognizerError } from \"./RecognizerError\"\nimport { RecognizerHTTPV1Configuration, TRecognizerHTTPV1Configuration } from \"./RecognizerHTTPV1Configuration\"\nimport { TConverstionState } from \"./RecognitionConfiguration\"\nimport { TDiagramConfiguration, TExportConfiguration, TMathConfiguration, TRawContentConfiguration, TTextConfiguration } from \"./recognition\"\n\ntype ApiError = {\n  code?: string\n  message: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV1PostConfiguration = {\n  lang: string,\n  diagram?: TDiagramConfiguration,\n  math?: TMathConfiguration,\n  \"raw-content\"?: TRawContentConfiguration,\n  text?: TTextConfiguration,\n  export: TExportConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV1PostData = {\n  configuration: TRecognizerHTTPV1PostConfiguration,\n  xDPI: number,\n  yDPI: number,\n  contentType: string,\n  conversionState?: TConverstionState\n  height: number,\n  width: number,\n  strokeGroups: TStrokeGroupToSend[]\n}\n\n/**\n * @deprecated Use {@link RecognizerHTTPV2} instead.\n * @group Recognizer\n */\nexport class RecognizerHTTPV1\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RECOGNIZER)\n\n  configuration: RecognizerHTTPV1Configuration\n\n  constructor(config: PartialDeep<TRecognizerHTTPV1Configuration>)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.configuration = new RecognizerHTTPV1Configuration(config)\n  }\n\n  get url()\n  {\n    return `${ this.configuration.server.scheme }://${ this.configuration.server.host }/api/v4.0/iink/batch`\n  }\n\n  get postConfig(): TRecognizerHTTPV1PostConfiguration\n  {\n    switch (this.configuration.recognition.type) {\n      case \"DIAGRAM\":\n        return {\n          lang: this.configuration.recognition.lang,\n          diagram: this.configuration.recognition.diagram,\n          export: this.configuration.recognition.export\n        }\n      case \"MATH\":\n        return {\n          lang: this.configuration.recognition.lang,\n          math: this.configuration.recognition.math,\n          export: this.configuration.recognition.export\n        }\n      case \"Raw Content\":\n        return {\n          lang: this.configuration.recognition.lang,\n          \"raw-content\": this.configuration.recognition[\"raw-content\"],\n          export: this.configuration.recognition.export\n        }\n      case \"TEXT\":\n        return {\n          lang: this.configuration.recognition.lang,\n          text: this.configuration.recognition.text,\n          export: this.configuration.recognition.export\n        }\n      default:\n        throw new Error(`get postConfig error Recognition type unkow \"${ this.configuration.recognition.type }\"`)\n        break\n    }\n  }\n\n  protected buildData(model: Model): TRecognizerHTTPV1PostData\n  {\n    this.#logger.info(\"buildData\", { model })\n    const isPenStyleEqual = (ps1: TPenStyle, ps2: TPenStyle) =>\n    {\n      return ps1 && ps2 && ps1[\"-myscript-pen-fill-color\"] === ps2[\"-myscript-pen-fill-color\"] &&\n        ps1[\"-myscript-pen-fill-style\"] === ps2[\"-myscript-pen-fill-style\"] &&\n        ps1[\"-myscript-pen-width\"] === ps2[\"-myscript-pen-width\"] &&\n        ps1.color === ps2.color &&\n        ps1.width === ps2.width\n    }\n\n    const strokeGroupByPenStyle: TStrokeGroup[] = []\n    model.symbols.forEach((s) =>\n    {\n      const groupIndex = strokeGroupByPenStyle.findIndex(sg => isPenStyleEqual(sg.penStyle, s.style))\n      if (groupIndex > -1) {\n        strokeGroupByPenStyle[groupIndex].strokes.push(s)\n      } else {\n        strokeGroupByPenStyle.push({\n          penStyle: s.style,\n          strokes: [s]\n        })\n      }\n    })\n\n    const strokeGroupsToSend: TStrokeGroupToSend[] = []\n    strokeGroupByPenStyle.forEach((group: TStrokeGroup) =>\n    {\n      const newPenStyle = JSON.stringify(group.penStyle) === \"{}\" ? undefined : StyleHelper.penStyleToCSS(group.penStyle as TPenStyle)\n      const newGroup = {\n        penStyle: newPenStyle,\n        strokes: group.strokes.map(s => s.formatToSend())\n      }\n      strokeGroupsToSend.push(newGroup)\n    })\n\n    const contentType: string = this.configuration.recognition.type === \"Raw Content\" ?\n      \"Raw Content\" :\n      this.configuration.recognition.type.charAt(0).toUpperCase() + this.configuration.recognition.type.slice(1).toLowerCase()\n\n    const data = {\n      configuration: this.postConfig,\n      xDPI: 96,\n      yDPI: 96,\n      contentType,\n      height: model.height,\n      width: model.width,\n      strokeGroups: strokeGroupsToSend\n    }\n    this.#logger.debug(\"buildData\", { data })\n    return data\n  }\n\n  protected async post(data: unknown, mimeType: string): Promise<unknown>\n  {\n    this.#logger.info(\"post\", { data, mimeType })\n    const headers = new Headers()\n    headers.append(\"Accept\", \"application/json,\" + mimeType)\n    headers.append(\"applicationKey\", this.configuration.server.applicationKey)\n    try {\n      let hmacKey: string\n      if (typeof this.configuration.server.hmacKey == \"string\") {\n        hmacKey = this.configuration.server.hmacKey\n      } else if (typeof this.configuration.server.hmacKey == \"function\") {\n        hmacKey = await this.configuration.server.hmacKey(this.configuration.server.applicationKey)\n      }\n      else {\n        throw new Error(\"HMAC key is not a string nor a function\")\n      }\n      if (hmacKey) {\n        const hmac = await computeHmac(JSON.stringify(data), this.configuration.server.applicationKey, hmacKey)\n        headers.append(\"hmac\", hmac)\n      }\n    } catch (error) {\n      this.#logger.error(\"post.computeHmac\", error)\n    }\n    headers.append(\"Content-Type\", \"application/json\")\n\n    if (!this.configuration.server.version) {\n      this.configuration.server.version = (await getApiInfos(this.configuration)).version\n    }\n    if (isVersionSuperiorOrEqual(this.configuration.server.version!, \"2.0.4\")) {\n      headers.append(\"myscript-client-name\", \"iink-ts\")\n      headers.append(\"myscript-client-version\", \"1.0.0-buildVersion\")\n    }\n    if (!isVersionSuperiorOrEqual(this.configuration.server.version!, \"2.3.0\")) {\n      delete this.configuration.recognition.convert\n    }\n    if (!isVersionSuperiorOrEqual(this.configuration.server.version!, \"3.2.0\")) {\n      delete this.configuration.recognition.export.jiix.text.lines\n    }\n\n    const reqInit: RequestInit = {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify(data),\n      credentials: \"omit\"\n    }\n    const request = new Request(this.url, reqInit)\n    const response: Response = await fetch(request)\n    if (response.ok) {\n      const contentType = response.headers.get(\"content-type\")\n      let result: unknown\n      switch (contentType) {\n        case \"application/vnd.openxmlformats-officedocument.presentationml.presentation\":\n        case \"image/png\":\n        case \"image/jpeg\":\n          result = await response.blob()\n          break\n        case \"application/json\":\n          result = await response.json()\n          break\n        case \"application/vnd.myscript.jiix\":\n          result = await response.clone().json().catch(async () => await response.text())\n          break\n        default:\n          result = await response.text()\n          break\n      }\n      this.#logger.debug(\"post\", { result })\n      return result\n    } else {\n      const err = await response.json() as ApiError\n      this.#logger.error(\"post\", { err })\n      throw err\n    }\n  }\n\n  protected async tryFetch(data: TRecognizerHTTPV1PostData, mimeType: string): Promise<TExport | never>\n  {\n    this.#logger.debug(\"tryFetch\", { data, mimeType })\n    return this.post(data, mimeType)\n      .then((res) =>\n      {\n        const exports: TExport = {}\n        exports[mimeType] = res as TJIIXExport | string | Blob\n        this.#logger.debug(\"tryFetch\", { exports })\n        return exports\n      })\n      .catch((err) =>\n      {\n        this.#logger.error(\"tryFetch\", { data, mimeType, err })\n        let message = err.message || RecognizerError.UNKNOW\n        if (!err.code) {\n          message = RecognizerError.CANT_ESTABLISH\n        } else if (err.code === \"access.not.granted\") {\n          message = RecognizerError.WRONG_CREDENTIALS\n        }\n        const error = new Error(message)\n        throw error\n      })\n  }\n\n  protected getMimeTypes(requestedMimeTypes?: string[]): string[]\n  {\n    this.#logger.info(\"getMimeTypes\", { requestedMimeTypes })\n    let mimeTypes: string[] = requestedMimeTypes || []\n    if (!mimeTypes.length) {\n      switch (this.configuration.recognition.type) {\n        case \"DIAGRAM\":\n          mimeTypes = this.configuration.recognition.diagram.mimeTypes\n          break\n        case \"MATH\":\n          mimeTypes = this.configuration.recognition.math.mimeTypes\n          break\n        case \"Raw Content\":\n          mimeTypes = [\"application/vnd.myscript.jiix\"]\n          break\n        case \"TEXT\":\n          mimeTypes = this.configuration.recognition.text.mimeTypes\n          break\n        default:\n          throw new Error(`Recognition type \"${ this.configuration.recognition.type }\" is unknown.\\n Possible types are:\\n -DIAGRAM\\n -MATH\\n -Raw Content\\n -TEXT`)\n          break\n      }\n    }\n    return mimeTypes\n  }\n\n  async convert(model: Model, conversionState?: TConverstionState, requestedMimeTypes?: string[]): Promise<Model>\n  {\n    this.#logger.info(\"convert\", { model, conversionState, requestedMimeTypes })\n    const myModel = model.clone()\n    const mimeTypes = this.getMimeTypes(requestedMimeTypes)\n    const dataToConcert = this.buildData(myModel)\n    dataToConcert.conversionState = conversionState\n    const promises = mimeTypes.map(mt => this.tryFetch(dataToConcert, mt))\n    const exports: TExport[] = await Promise.all(promises)\n    exports.forEach(e =>\n    {\n      myModel.mergeConvert(e)\n    })\n    this.#logger.debug(\"convert\", { model: myModel })\n    return myModel\n  }\n\n  async export(model: Model, requestedMimeTypes?: string[]): Promise<Model>\n  {\n    this.#logger.info(\"export\", { model, requestedMimeTypes })\n    const myModel = model.clone()\n    if (myModel.symbols.length === 0) {\n      return Promise.resolve(myModel)\n    }\n    const mimeTypes = this.getMimeTypes(requestedMimeTypes)\n    if (!mimeTypes.length) {\n      this.#logger.error(\"export\", { model, requestedMimeTypes, \"Export failed, no mimeTypes define in recognition configuration\": String })\n      return Promise.reject(new Error(\"Export failed, no mimeTypes define in recognition configuration\"))\n    }\n    const mimeTypesRequiringExport: string[] = mimeTypes.filter(m => !myModel.exports || !myModel.exports[m])\n    const data = this.buildData(model)\n    const exports: TExport[] = await Promise.all(mimeTypesRequiringExport.map(mimeType => this.tryFetch(data, mimeType)))\n    exports.forEach(e =>\n    {\n      myModel.mergeExport(e)\n    })\n    this.#logger.debug(\"export\", { model: myModel })\n    return myModel\n  }\n\n  async resize(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"resize\", { model })\n    return this.export(model)\n  }\n\n}\n","import { mergeDeep, isVersionSuperiorOrEqual, PartialDeep } from \"../utils\"\nimport {\n  DefaultShapeConfiguration,\n  DefaultExportConfiguration,\n  DefaultMathV2Configuration,\n  DefaultRawContentV2Configuration,\n  DefaultTexConfigurationV2,\n  TConvertionConfiguration,\n  TShapeConfiguration,\n  TExportConfiguration,\n  TMathConfiguration,\n  TRawContentConfiguration,\n  TTextRecognizerHTTPV2Configuration\n} from \"./recognition\"\nimport { TRecognitionV2Type } from \"./RecognitionConfiguration\"\nimport { DefaultServerHTTPConfiguration, TServerHTTPConfiguration } from \"./ServerConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV2RecognitionConfiguration = {\n  type: TRecognitionV2Type\n  lang: string\n  math: TMathConfiguration\n  text: TTextRecognizerHTTPV2Configuration\n  shape: TShapeConfiguration\n  \"raw-content\": TRawContentConfiguration\n  export: TExportConfiguration\n  convert?: TConvertionConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognizerHTTPV2RecognitionConfiguration: TRecognizerHTTPV2RecognitionConfiguration = {\n  export: DefaultExportConfiguration,\n  math: DefaultMathV2Configuration,\n  shape: DefaultShapeConfiguration,\n  \"raw-content\": DefaultRawContentV2Configuration,\n  text: DefaultTexConfigurationV2,\n  type: \"TEXT\",\n  lang: \"en_US\",\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV2Configuration = {\n  server: TServerHTTPConfiguration\n  recognition: TRecognizerHTTPV2RecognitionConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport const DefaultRecognizerHTTPV2Configuration: TRecognizerHTTPV2Configuration =\n{\n  server: DefaultServerHTTPConfiguration,\n  recognition: DefaultRecognizerHTTPV2RecognitionConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport class RecognizerHTTPV2Configuration implements TRecognizerHTTPV2Configuration {\n  recognition: TRecognizerHTTPV2RecognitionConfiguration\n  server: TServerHTTPConfiguration\n\n  constructor(configuration?: PartialDeep<TRecognizerHTTPV2Configuration>)\n  {\n    this.server = mergeDeep({}, DefaultRecognizerHTTPV2Configuration.server, configuration?.server)\n    this.recognition = mergeDeep({}, DefaultRecognizerHTTPV2Configuration.recognition, configuration?.recognition)\n\n    if (configuration?.recognition?.text?.mimeTypes) {\n      this.recognition.text.mimeTypes = configuration.recognition.text.mimeTypes as (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n    }\n    this.recognition.text.mimeTypes = [...new Set(this.recognition.text.mimeTypes)]\n\n    if (configuration?.recognition?.math?.mimeTypes) {\n      this.recognition.math.mimeTypes = configuration.recognition.math.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/x-latex\" | \"application/mathml+xml\")[]\n    }\n    this.recognition.math.mimeTypes = [...new Set(this.recognition.math.mimeTypes)]\n\n    if (configuration?.recognition?.shape?.mimeTypes) {\n      this.recognition.shape.mimeTypes = configuration.recognition.shape.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/vnd.openxmlformats-officedocument.presentationml.presentation\" | \"image/svg+xml\")[]\n    }\n    this.recognition.shape.mimeTypes = [...new Set(this.recognition.shape.mimeTypes)]\n\n    if (configuration?.recognition?.[\"raw-content\"]?.recognition?.types) {\n      this.recognition[\"raw-content\"].recognition!.types = configuration?.recognition?.[\"raw-content\"]?.recognition?.types as (\"text\" | \"shape\")[]\n    }\n    if (configuration?.recognition?.[\"raw-content\"]?.classification?.types) {\n      this.recognition[\"raw-content\"].classification!.types = configuration?.recognition?.[\"raw-content\"]?.classification?.types as (\"text\" | \"shape\")[]\n    }\n\n    if (this.server.version) {\n      if (!isVersionSuperiorOrEqual(this.server.version, \"2.3.0\")) {\n        delete this.recognition.convert\n      }\n      if (!isVersionSuperiorOrEqual(this.server.version, \"3.2.0\")) {\n        delete this.recognition.export.jiix.text.lines\n      }\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { TExportV2, TJIIXExport } from \"../model\"\nimport { TStroke, TStrokeToSend } from \"../symbol\"\nimport { computeHmac, getApiInfos, isVersionSuperiorOrEqual, PartialDeep } from \"../utils\"\nimport { RecognizerError } from \"./RecognizerError\"\nimport { RecognizerHTTPV2Configuration, TRecognizerHTTPV2Configuration } from \"./RecognizerHTTPV2Configuration\"\nimport { TDiagramConfiguration, TExportConfiguration, TMathConfiguration, TRawContentConfiguration, TTextConfiguration } from \"./recognition\"\n\ntype ApiError = {\n  code?: string\n  message: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV2PostConfiguration = {\n  lang: string,\n  diagram?: TDiagramConfiguration,\n  math?: TMathConfiguration,\n  \"raw-content\"?: TRawContentConfiguration,\n  text?: TTextConfiguration,\n  export: TExportConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV2PostData = {\n  scaleX: number,\n  scaleY: number,\n  configuration: TRecognizerHTTPV2PostConfiguration,\n  contentType: string,\n  strokes: TStrokeToSend[]\n}\n\n/**\n * @group Recognizer\n */\nexport class RecognizerHTTPV2 {\n  #logger = LoggerManager.getLogger(LoggerCategory.RECOGNIZER)\n\n  configuration: RecognizerHTTPV2Configuration\n\n  constructor(config: PartialDeep<TRecognizerHTTPV2Configuration>) {\n    this.#logger.info(\"constructor\", { config })\n    this.configuration = new RecognizerHTTPV2Configuration(config)\n  }\n\n  get url() {\n    return `${this.configuration.server.scheme}://${this.configuration.server.host}/api/v4.0/iink/recognize`\n  }\n\n  get postConfig(): TRecognizerHTTPV2PostConfiguration {\n    switch (this.configuration.recognition.type) {\n      case \"SHAPE\":\n        return {\n          lang: this.configuration.recognition.lang,\n          diagram: this.configuration.recognition.shape,\n          export: this.configuration.recognition.export\n        }\n      case \"MATH\":\n        return {\n          lang: this.configuration.recognition.lang,\n          math: this.configuration.recognition.math,\n          export: this.configuration.recognition.export\n        }\n      case \"Raw Content\":\n        return {\n          lang: this.configuration.recognition.lang,\n          \"raw-content\": this.configuration.recognition[\"raw-content\"],\n          export: this.configuration.recognition.export\n        }\n      case \"TEXT\":\n        return {\n          lang: this.configuration.recognition.lang,\n          text: this.configuration.recognition.text,\n          export: this.configuration.recognition.export\n        }\n      default:\n        throw new Error(`get postConfig error Recognition type unkow \"${this.configuration.recognition.type}\"`)\n        break\n    }\n  }\n\n  protected formatStrokes(strokes: TStroke[]): TStrokeToSend[] {\n    return strokes.map(s => {\n      return {\n        id: s.id,\n        pointerType: s.pointerType,\n        p: s.pointers.map(p => p.p),\n        t: s.pointers.map(p => p.t),\n        x: s.pointers.map(p => p.x),\n        y: s.pointers.map(p => p.y)\n      }\n    })\n  }\n\n  protected buildData(strokes: TStroke[]): TRecognizerHTTPV2PostData {\n    this.#logger.info(\"buildData\", { strokes })\n\n    const contentType: string = this.configuration.recognition.type === \"Raw Content\" ?\n      \"Raw Content\" :\n      this.configuration.recognition.type.charAt(0).toUpperCase() + this.configuration.recognition.type.slice(1).toLowerCase()\n\n    const data = {\n      configuration: this.postConfig,\n      scaleX: 0.265,\n      scaleY: 0.265,\n      contentType,\n      strokes: this.formatStrokes(strokes)\n    }\n    this.#logger.debug(\"buildData\", { data })\n    return data\n  }\n\n  protected async post(data: unknown, mimeType: string): Promise<unknown> {\n    this.#logger.info(\"post\", { data, mimeType })\n    const headers = new Headers()\n    headers.append(\"Accept\", mimeType)\n    headers.append(\"applicationKey\", this.configuration.server.applicationKey)\n    try {\n      let hmacKey: string\n      if (typeof this.configuration.server.hmacKey == \"string\") {\n        hmacKey = this.configuration.server.hmacKey\n      } else if (typeof this.configuration.server.hmacKey == \"function\") {\n        hmacKey = await this.configuration.server.hmacKey(this.configuration.server.applicationKey)\n      }\n      else {\n        throw new Error(\"HMAC key is not a string nor a function\")\n      }\n      if (hmacKey) {\n        const hmac = await computeHmac(JSON.stringify(data), this.configuration.server.applicationKey, hmacKey)\n        headers.append(\"hmac\", hmac)\n      }\n    } catch (error) {\n      this.#logger.error(\"post.computeHmac\", error)\n    }\n    headers.append(\"Content-Type\", \"application/json\")\n\n    if (!this.configuration.server.version) {\n      this.configuration.server.version = (await getApiInfos(this.configuration)).version\n    }\n\n    if (this.configuration.server.version && isVersionSuperiorOrEqual(this.configuration.server.version, \"2.0.4\")) {\n      headers.append(\"myscript-client-name\", \"iink-ts\")\n      headers.append(\"myscript-client-version\", \"1.0.0-buildVersion\")\n    }\n\n    const reqInit: RequestInit = {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify(data),\n      credentials: \"omit\"\n    }\n    const request = new Request(this.url, reqInit)\n    const response: Response = await fetch(request)\n    if (response.ok) {\n      const contentType = response.headers.get(\"content-type\")\n      let result: unknown\n      switch (contentType) {\n        case \"application/vnd.openxmlformats-officedocument.presentationml.presentation\":\n        case \"image/png\":\n        case \"image/jpeg\":\n          result = await response.blob()\n          break\n        case \"application/json\":\n          result = await response.json()\n          break\n        case \"application/vnd.myscript.jiix\":\n          result = await response.clone().json().catch(async () => await response.text())\n          break\n        default:\n          result = await response.text()\n          break\n      }\n      this.#logger.debug(\"post\", { result })\n      return result\n    } else {\n      const err = await response.json() as ApiError\n      this.#logger.error(\"post\", { err })\n      throw err\n    }\n  }\n\n  protected async tryFetch(data: TRecognizerHTTPV2PostData, mimeType: string): Promise<TExportV2 | never> {\n    this.#logger.debug(\"tryFetch\", { data, mimeType })\n    return this.post(data, mimeType)\n      .then((res) => {\n        const exports: TExportV2 = {}\n        exports[mimeType] = res as TJIIXExport | string | Blob\n        this.#logger.debug(\"tryFetch\", { exports })\n        return exports\n      })\n      .catch((err) => {\n        this.#logger.error(\"tryFetch\", { data, mimeType, err })\n        let message = err.message || RecognizerError.UNKNOW\n        if (!err.code) {\n          message = RecognizerError.CANT_ESTABLISH\n        } else if (err.code === \"access.not.granted\") {\n          message = RecognizerError.WRONG_CREDENTIALS\n        }\n        const error = new Error(message)\n        throw error\n      })\n  }\n\n  protected getMimeTypes(requestedMimeTypes?: string[]): string[] {\n    this.#logger.info(\"getMimeTypes\", { requestedMimeTypes })\n    let mimeTypes: string[] = requestedMimeTypes || []\n    if (!mimeTypes.length) {\n      switch (this.configuration.recognition.type) {\n        case \"SHAPE\":\n          mimeTypes = this.configuration.recognition.shape.mimeTypes\n          break\n        case \"MATH\":\n          mimeTypes = this.configuration.recognition.math.mimeTypes\n          break\n        case \"Raw Content\":\n          mimeTypes = [\"application/vnd.myscript.jiix\"]\n          break\n        case \"TEXT\":\n          mimeTypes = this.configuration.recognition.text.mimeTypes\n          break\n        default:\n          throw new Error(`Recognition type \"${this.configuration.recognition.type}\" is unknown.\\n Possible types are:\\n -DIAGRAM\\n -MATH\\n -Raw Content\\n -TEXT\\n -SHAPE`)\n          break\n      }\n    }\n    return mimeTypes\n  }\n\n  async send(strokes: TStroke[], requestedMimeTypes?: string[]): Promise<TExportV2> {\n    this.#logger.info(\"send\", strokes)\n\n    const recognition: TExportV2 = {}\n    if (strokes.length === 0) {\n      return Promise.resolve(recognition)\n    }\n    const mimeTypes = requestedMimeTypes || this.getMimeTypes()\n\n    const data = this.buildData(strokes)\n    const exports: TExportV2[] = await Promise.all(mimeTypes.map(mimeType => this.tryFetch(data, mimeType)))\n      exports.forEach(e => {\n        Object.assign(recognition, e)\n      })\n\n    this.#logger.debug(\"send\", recognition)\n    return recognition\n  }\n}\n","import { TGesture } from \"../gesture\"\nimport { TExport } from \"../model\"\n\n/**\n * @group Recognizer\n */\nexport enum TRecognizerWebSocketMessageType\n{\n  HMAC_Challenge = \"hmacChallenge\",\n  Authenticated = \"authenticated\",\n  SessionDescription = \"sessionDescription\",\n  NewPart = \"newPart\",\n  PartChanged = \"partChanged\",\n  ContentChanged = \"contentChanged\",\n  Idle = \"idle\",\n  Pong = \"pong\",\n  Exported = \"exported\",\n  GestureDetected = \"gestureDetected\",\n  ContextlessGesture = \"contextlessGesture\",\n  Error = \"error\",\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessage<T = string> = {\n  type: T\n  [key: string]: unknown\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageAuthenticated = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.Authenticated>\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageHMACChallenge = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.HMAC_Challenge> & {\n  hmacChallenge: string\n  iinkSessionId: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TInteractiveInkSessionDescriptionMessage = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.SessionDescription> & {\n  contentPartCount: number\n  iinkSessionId: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageNewPart = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.NewPart> & {\n  id: string\n  idx: null\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessagePartChange = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.PartChanged> & {\n  partIdx: number\n  partId: string\n  partCount: number\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageContentChange = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.ContentChanged> & {\n  partId: string\n  canUndo: boolean\n  canRedo: boolean\n  empty: boolean\n  undoStackIndex: number\n  possibleUndoCount: number\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageExport = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.Exported> & {\n  partId: string\n  exports: TExport\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageGesture = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.GestureDetected> & TGesture\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageContextlessGesture = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.ContextlessGesture> & {\n  gestureType: \"none\" | \"scratch\" | \"left-right\" | \"right-left\" | \"bottom-top\" | \"top-bottom\" | \"surround\",\n  strokeId: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessagePong = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.Pong>\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageIdle = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.Idle>\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageError = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.Error> & {\n  code?: number | string\n  message?: string\n  data?: {\n    code: number | string\n    message: string\n  }\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageReceived =\n  TRecognizerWebSocketMessageAuthenticated |\n  TRecognizerWebSocketMessageHMACChallenge |\n  TInteractiveInkSessionDescriptionMessage |\n  TRecognizerWebSocketMessageNewPart |\n  TRecognizerWebSocketMessagePartChange |\n  TRecognizerWebSocketMessageContentChange |\n  TRecognizerWebSocketMessageExport |\n  TRecognizerWebSocketMessageGesture |\n  TRecognizerWebSocketMessageContextlessGesture |\n  TRecognizerWebSocketMessagePong |\n  TRecognizerWebSocketMessageIdle |\n  TRecognizerWebSocketMessageError\n","import { mergeDeep, isVersionSuperiorOrEqual, PartialDeep } from \"../utils\"\nimport { TExportConfiguration, TTextConfConfiguration } from \"./recognition\"\nimport { DefaultServerWebsocketConfiguration, TServerWebsocketConfiguration } from \"./ServerConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRecognitionWebSocketConfiguration = {\n  lang: string\n  export: TExportConfiguration\n  \"raw-content\": {\n    text?: TTextConfConfiguration\n    \"session-time\"?: number\n    recognition?: {\n      types: (\"text\" | \"shape\")[]\n    }\n    classification?: {\n      types: (\"text\" | \"shape\")[]\n    }\n    gestures?: (\"underline\" | \"scratch-out\" | \"join\" | \"insert\" | \"strike-through\" | \"surround\")[]\n  }\n  gesture: {\n    enable: boolean,\n    ignoreGestureStrokes: boolean\n  }\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognitionWebSocketConfiguration: TRecognitionWebSocketConfiguration = {\n  export: {\n    jiix: {\n      \"bounding-box\": true,\n      \"full-stroke-ids\": true,\n      ids: true,\n      strokes: false,\n      text: {\n        chars: true,\n        words: true,\n        lines: true\n      }\n    }\n  },\n  \"raw-content\": {\n    recognition: {\n      types: [\"text\", \"shape\"]\n    },\n    classification: {\n      types: [\"text\", \"shape\"]\n    },\n    gestures: [\"underline\", \"scratch-out\", \"join\", \"insert\", \"strike-through\", \"surround\"]\n  },\n  lang: \"en_US\",\n  gesture: {\n    enable: true,\n    ignoreGestureStrokes: false,\n  }\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketConfiguration = {\n  server: TServerWebsocketConfiguration\n  recognition: TRecognitionWebSocketConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognizerWebSocketConfiguration: TRecognizerWebSocketConfiguration =\n{\n  server: DefaultServerWebsocketConfiguration,\n  recognition: DefaultRecognitionWebSocketConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport class RecognizerWebSocketConfiguration implements TRecognizerWebSocketConfiguration\n{\n  server: TServerWebsocketConfiguration\n  recognition: TRecognitionWebSocketConfiguration\n\n  constructor(configuration?: PartialDeep<TRecognizerWebSocketConfiguration>)\n  {\n    this.server = mergeDeep({}, DefaultRecognizerWebSocketConfiguration.server, configuration?.server)\n\n    this.recognition = mergeDeep({}, DefaultRecognizerWebSocketConfiguration.recognition, configuration?.recognition)\n    this.recognition.export.jiix[\"full-stroke-ids\"] = true\n    this.recognition.export.jiix.ids = true\n    this.recognition.export.jiix.text.words = true\n    this.recognition.export.jiix.text.chars = true\n    this.recognition.export.jiix.text.lines = true\n    this.recognition.export.jiix[\"bounding-box\"] = true\n    if (configuration?.recognition?.[\"raw-content\"]?.recognition?.types) {\n      this.recognition[\"raw-content\"].recognition!.types = configuration.recognition[\"raw-content\"].recognition.types as (\"text\" | \"shape\")[]\n    }\n    if (configuration?.recognition?.[\"raw-content\"]?.classification?.types) {\n      this.recognition[\"raw-content\"].classification!.types = configuration.recognition[\"raw-content\"].classification.types as (\"text\" | \"shape\")[]\n    }\n    if (configuration?.recognition?.[\"raw-content\"]?.gestures) {\n      this.recognition[\"raw-content\"].gestures = configuration.recognition[\"raw-content\"].gestures as (\"underline\" | \"scratch-out\" | \"join\" | \"insert\" | \"strike-through\" | \"surround\")[]\n    }\n    if (this.server.version && !isVersionSuperiorOrEqual(this.server.version, \"3.2.0\")) {\n      delete this.recognition.export.jiix.text.lines\n      delete this.recognition[\"raw-content\"].classification\n    }\n  }\n}\n","import { TIIHistoryBackendChanges, THistoryContext } from \"../history\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { TExport, TJIIXExport } from \"../model\"\nimport { IIStroke } from \"../symbol\"\nimport { TMatrixTransform } from \"../transform\"\nimport { computeHmac, mergeDeep, DeferredPromise, PartialDeep, isVersionSuperiorOrEqual, getApiInfos } from \"../utils\"\nimport\n{\n  TRecognizerWebSocketMessage,\n  TRecognizerWebSocketMessageContentChange,\n  TRecognizerWebSocketMessageContextlessGesture,\n  TRecognizerWebSocketMessageError,\n  TRecognizerWebSocketMessageExport,\n  TRecognizerWebSocketMessageGesture,\n  TRecognizerWebSocketMessageHMACChallenge,\n  TRecognizerWebSocketMessageNewPart,\n  TRecognizerWebSocketMessagePartChange,\n  TRecognizerWebSocketMessageReceived,\n  TRecognizerWebSocketMessageType,\n  TInteractiveInkSessionDescriptionMessage\n} from \"./RecognizerWebSocketMessage\"\nimport { RecognizerError } from \"./RecognizerError\"\nimport PingWorker from \"web-worker:../worker/ping.worker.ts\"\nimport { RecognizerEvent } from \"./RecognizerEvent\"\nimport { RecognizerWebSocketConfiguration, TRecognizerWebSocketConfiguration } from \"./RecognizerWebSocketConfiguration\"\n\n/**\n * A websocket dialog have this sequence :\n * --------------- Client --------------------------------------------------------------- Server ---------------\n * { type: \"authenticate\" }                           ==================>\n *                                                    <==================       { type: \"hmacChallenge\" }\n * { type: \"hmac\" }                                   ==================>\n *                                                    <==================       { type: \"authenticated\" }\n * { type: \"initSession\" | \"restoreSession\" }         ==================>\n *                                                    <==================       { type: \"sessionDescription\" }\n * { type: \"newContentPart\" | \"openContentPart\" }     ==================>\n *                                                    <==================       { type: \"partChanged\" }\n * { type: \"addStrokes\" }                             ==================>\n *                                                    <==================       { type: \"contentChanged\" }\n * { type: \"transform\" }                              ==================>\n *                                                    <==================       { type: \"contentChanged\" }\n * { type: \"eraseStrokes\" }                           ==================>\n *                                                    <==================       { type: \"contentChanged\" }\n */\n\n/**\n * @group Recognizer\n */\nexport class RecognizerWebSocket\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RECOGNIZER)\n\n  protected socket!: WebSocket\n  protected pingWorker?: Worker\n  protected pingCount = 0\n  protected reconnectionCount = 0\n  protected sessionId?: string\n  protected currentPartId?: string\n  protected currentErrorCode?: string | number\n\n  protected addStrokeDeferred?: DeferredPromise<TRecognizerWebSocketMessageGesture | undefined>\n  protected contextlessGestureDeferred: Map<string, DeferredPromise<TRecognizerWebSocketMessageContextlessGesture>>\n  protected transformStrokeDeferred?: DeferredPromise<void>\n  protected eraseStrokeDeferred?: DeferredPromise<void>\n  protected replaceStrokeDeferred?: DeferredPromise<void>\n  protected exportDeferredMap: Map<string, DeferredPromise<TExport>>\n  protected closeDeferred?: DeferredPromise<void>\n  protected waitForIdleDeferred?: DeferredPromise<void>\n  protected undoDeferred?: DeferredPromise<void>\n  protected redoDeferred?: DeferredPromise<void>\n  protected clearDeferred?: DeferredPromise<void>\n\n  configuration: RecognizerWebSocketConfiguration\n  initialized: DeferredPromise<void>\n  url: string\n  event: RecognizerEvent\n\n  constructor(config: PartialDeep<TRecognizerWebSocketConfiguration>, event?: RecognizerEvent)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.configuration = new RecognizerWebSocketConfiguration(config)\n    const scheme = (this.configuration.server.scheme === \"https\") ? \"wss\" : \"ws\"\n    this.url = `${ scheme }://${ this.configuration.server.host }/api/v4.0/iink/offscreen?applicationKey=${ this.configuration.server.applicationKey }`\n\n    this.event = event || new RecognizerEvent()\n    this.initialized = new DeferredPromise<void>()\n    this.exportDeferredMap = new Map()\n    this.contextlessGestureDeferred = new Map()\n  }\n\n  get mimeTypes(): string[]\n  {\n    return [\"application/vnd.myscript.jiix\"]\n  }\n\n  async #send(message: TRecognizerWebSocketMessage): Promise<void>\n  {\n    if (!this.socket) {\n      throw new Error(\"Recognizer must be initilized\")\n    }\n    if (this.socket.readyState === this.socket.OPEN) {\n      this.socket.send(JSON.stringify(message))\n    }\n    else {\n      throw new Error(`Can not send message: ${message.type}, connection not ready, state: ${ this.socket.readyState }`)\n    }\n  }\n\n  protected rejectDeferredPending(error: Error | string): void\n  {\n    this.initialized.reject(error)\n    this.addStrokeDeferred?.reject(error)\n    this.transformStrokeDeferred?.reject(error)\n    this.eraseStrokeDeferred?.reject(error)\n    this.replaceStrokeDeferred?.reject(error)\n    this.undoDeferred?.reject(error)\n    this.redoDeferred?.reject(error)\n    this.clearDeferred?.reject(error)\n    Array.from(this.contextlessGestureDeferred.values())\n      .forEach(v =>\n      {\n        v.reject(error)\n      })\n    Array.from(this.exportDeferredMap.values())\n      .forEach(v =>\n      {\n        v.reject(error)\n      })\n    this.waitForIdleDeferred?.reject(error)\n  }\n\n  protected resetAllDeferred(): void\n  {\n    this.initialized = new DeferredPromise<void>()\n    this.addStrokeDeferred = undefined\n    this.contextlessGestureDeferred.clear()\n    this.transformStrokeDeferred = undefined\n    this.eraseStrokeDeferred = undefined\n    this.replaceStrokeDeferred = undefined\n    this.exportDeferredMap.clear()\n    this.waitForIdleDeferred = undefined\n    this.closeDeferred = undefined\n  }\n\n  protected clearSocketListener(): void\n  {\n    this.socket.removeEventListener(\"open\", this.openCallback.bind(this))\n    this.socket.removeEventListener(\"close\", this.closeCallback.bind(this))\n    this.socket.removeEventListener(\"message\", this.messageCallback.bind(this))\n  }\n\n  protected closeCallback(evt: CloseEvent): void\n  {\n    this.#logger.info(\"closeCallback\", { evt })\n    let message = evt.reason\n    if (!this.currentErrorCode) {\n      switch (evt.code) {\n        case 1000:\n          // Normal Closure\n          break\n        case 1001:\n          message = RecognizerError.GOING_AWAY\n          break\n        case 1002:\n          message = RecognizerError.PROTOCOL_ERROR\n          break\n        case 1003:\n          message = RecognizerError.UNSUPPORTED_DATA\n          break\n        case 1006:\n          message = RecognizerError.ABNORMAL_CLOSURE\n          break\n        case 1007:\n          message = RecognizerError.INVALID_FRAME_PAYLOAD\n          break\n        case 1008:\n          message = RecognizerError.POLICY_VIOLATION\n          break\n        case 1009:\n          message = RecognizerError.MESSAGE_TOO_BIG\n          break\n        case 1011:\n          message = RecognizerError.INTERNAL_ERROR\n          break\n        case 1012:\n          message = RecognizerError.SERVICE_RESTART\n          break\n        case 1013:\n          message = RecognizerError.TRY_AGAIN\n          break\n        case 1014:\n          message = RecognizerError.BAD_GATEWAY\n          break\n        case 1015:\n          message = RecognizerError.TLS_HANDSHAKE\n          break\n        default:\n          message = RecognizerError.CANT_ESTABLISH\n          break\n      }\n    }\n\n    this.clearSocketListener()\n    this.closeDeferred?.resolve()\n    if (!this.currentErrorCode && evt.code !== 1000) {\n      const error = new Error(message)\n      this.event.emitError(error)\n      this.rejectDeferredPending(message)\n    }\n    this.pingWorker?.terminate()\n    this.resetAllDeferred()\n  }\n\n  protected openCallback(): void\n  {\n    this.reconnectionCount = 0\n    this.#send({\n      type: \"authenticate\",\n      \"myscript-client-name\": \"iink-ts\",\n      \"myscript-client-version\": \"1.0.0-buildVersion\",\n    })\n  }\n\n  protected async manageHMACChallenge(hmacChallengeMessage: TRecognizerWebSocketMessageHMACChallenge): Promise<void>\n  {\n    let hmacKey: string\n    if (typeof this.configuration.server.hmacKey == \"string\") {\n      hmacKey = this.configuration.server.hmacKey\n    } else if (typeof this.configuration.server.hmacKey == \"function\") {\n      hmacKey = await this.configuration.server.hmacKey(this.configuration.server.applicationKey)\n    }\n    else {\n      return this.initialized.reject(new Error(\"HMAC key is not a string nor a function\"))\n    }\n    if (!hmacKey) {\n      return this.initialized.reject(new Error(\"HMAC key is required\"))\n    }\n    this.#send({\n      type: \"hmac\",\n      hmac: await computeHmac(hmacChallengeMessage.hmacChallenge, this.configuration.server.applicationKey, hmacKey)\n    })\n  }\n\n  protected initPing(): void\n  {\n    this.pingWorker = new PingWorker()\n    this.pingWorker.postMessage({\n      pingDelay: this.configuration.server.websocket.pingDelay,\n    })\n    this.pingWorker.onmessage = () =>\n    {\n      if (this.socket.readyState <= 1) {\n        if (this.pingCount < this.configuration.server.websocket.maxPingLostCount) {\n          this.send({ type: \"ping\" })\n        }\n        else {\n          this.close(1000, \"MAXIMUM_PING_REACHED\")\n          this.pingWorker?.terminate()\n        }\n        this.pingCount++\n      }\n    }\n  }\n\n  protected manageAuthenticated(): void\n  {\n    if (!isVersionSuperiorOrEqual(this.configuration.server.version!, \"3.2.0\")) {\n      delete this.configuration.recognition.export.jiix.text.lines\n      delete this.configuration.recognition[\"raw-content\"].classification\n    }\n    const pixelTomm = 25.4 / 96\n    this.#send({\n      type: this.sessionId ? \"restoreSession\" : \"initSession\",\n      iinkSessionId: this.sessionId,\n      scaleX: pixelTomm,\n      scaleY: pixelTomm,\n      configuration: this.configuration.recognition\n    })\n  }\n\n  protected manageSessionDescriptionMessage(sessionDescriptionMessage: TInteractiveInkSessionDescriptionMessage): void\n  {\n    if (sessionDescriptionMessage.iinkSessionId) {\n      this.sessionId = sessionDescriptionMessage.iinkSessionId\n      this.event.emitSessionOpened(this.sessionId)\n    }\n    if (this.currentPartId) {\n      this.#send({ type: \"openContentPart\", id: this.currentPartId })\n    }\n    else {\n      this.#send({ type: \"newContentPart\", contentType: \"Raw Content\", mimeTypes: this.mimeTypes })\n    }\n  }\n\n  protected manageNewPartMessage(newPartMessage: TRecognizerWebSocketMessageNewPart): void\n  {\n    this.initialized.resolve()\n    this.currentPartId = newPartMessage.id\n  }\n\n  protected managePartChangeMessage(partChangeMessage: TRecognizerWebSocketMessagePartChange): void\n  {\n    this.initialized.resolve()\n    this.currentPartId = partChangeMessage.partId\n  }\n\n  protected manageContentChangedMessage(contentChangeMessage: TRecognizerWebSocketMessageContentChange): void\n  {\n    this.initialized.resolve()\n    this.replaceStrokeDeferred?.resolve()\n    this.transformStrokeDeferred?.resolve()\n    this.eraseStrokeDeferred?.resolve()\n    this.undoDeferred?.resolve()\n    this.redoDeferred?.resolve()\n    this.clearDeferred?.resolve()\n    this.event.emitContentChanged({\n      canRedo: contentChangeMessage.canRedo,\n      canUndo: contentChangeMessage.canRedo,\n    } as THistoryContext)\n  }\n\n  protected manageExportMessage(exportMessage: TRecognizerWebSocketMessageExport): void\n  {\n    if (exportMessage.exports[\"application/vnd.myscript.jiix\"]) {\n      exportMessage.exports[\"application/vnd.myscript.jiix\"] = JSON.parse(exportMessage.exports[\"application/vnd.myscript.jiix\"].toString()) as TJIIXExport\n    }\n\n    Object.keys(exportMessage.exports)\n      .forEach(key =>\n      {\n        if (this.exportDeferredMap.has(key)) {\n          this.exportDeferredMap.get(key)!.resolve(exportMessage.exports)\n        }\n      })\n    this.event.emitExported(exportMessage.exports)\n  }\n\n  protected manageWaitForIdle(): void\n  {\n    this.waitForIdleDeferred?.resolve()\n    this.event.emitIdle(true)\n  }\n\n  protected manageErrorMessage(errorMessage: TRecognizerWebSocketMessageError): void\n  {\n    this.currentErrorCode = errorMessage.data?.code || errorMessage.code\n    let message = errorMessage.data?.message || errorMessage.message || RecognizerError.UNKNOW\n\n    if (this.currentErrorCode === \"no.activity\") {\n      this.rejectDeferredPending(message)\n      this.event.emitConnectionClose({ code: 1000,  message: RecognizerError.NO_ACTIVITY })\n    }\n    else {\n      switch (this.currentErrorCode) {\n        case \"access.not.granted\":\n          message = RecognizerError.WRONG_CREDENTIALS\n          break\n        case \"session.too.old\":\n          message = RecognizerError.TOO_OLD\n          break\n        case \"restore.session.not.found\":\n          message = RecognizerError.NO_SESSION_FOUND\n          break\n      }\n      this.rejectDeferredPending(message)\n      this.event.emitError(new Error(message))\n    }\n  }\n\n  protected manageGestureDetected(gestureMessage: TRecognizerWebSocketMessageGesture): void\n  {\n    this.addStrokeDeferred?.resolve(gestureMessage)\n  }\n\n  protected manageContextlessGesture(gestureMessage: TRecognizerWebSocketMessageContextlessGesture): void\n  {\n    this.contextlessGestureDeferred.get(gestureMessage.strokeId)?.resolve(gestureMessage)\n  }\n\n  protected messageCallback(message: MessageEvent<string>): void\n  {\n    this.currentErrorCode = undefined\n    try {\n      const websocketMessage: TRecognizerWebSocketMessageReceived = JSON.parse(message.data)\n      if (websocketMessage.type === TRecognizerWebSocketMessageType.Pong) {\n        return\n      }\n      this.pingCount = 0\n      switch (websocketMessage.type) {\n        case TRecognizerWebSocketMessageType.HMAC_Challenge:\n          this.manageHMACChallenge(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.Authenticated:\n          this.manageAuthenticated()\n          break\n        case TRecognizerWebSocketMessageType.SessionDescription:\n          this.manageSessionDescriptionMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.NewPart:\n          this.manageNewPartMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.PartChanged:\n          this.managePartChangeMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.ContentChanged:\n          this.manageContentChangedMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.Exported:\n          this.manageExportMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.GestureDetected:\n          this.manageGestureDetected(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.ContextlessGesture:\n          this.manageContextlessGesture(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.Error:\n          this.manageErrorMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.Idle:\n          this.manageWaitForIdle()\n          break\n        default:\n          this.#logger.warn(\"messageCallback\", `Message type unknow: \"${ websocketMessage }\".`)\n          break\n      }\n    }\n    catch {\n      this.event.emitError(new Error(message.data))\n    }\n  }\n\n  async newSession(config: PartialDeep<TRecognizerWebSocketConfiguration>): Promise<void>\n  {\n    await this.close(1000, \"new-session\")\n    this.configuration = mergeDeep({}, this.configuration, config)\n    this.sessionId = undefined\n    this.currentPartId = undefined\n    await this.init()\n  }\n\n  async init(): Promise<void>\n  {\n    this.event.emitStartInitialization()\n    if (this.currentErrorCode === \"restore.session.not.found\") {\n      this.currentErrorCode = undefined\n      this.sessionId = undefined\n      this.currentPartId = undefined\n    }\n    if (!this.configuration.server.version) {\n      this.configuration.server.version = (await getApiInfos(this.configuration)).version\n    }\n    this.socket = new WebSocket(this.url)\n    this.clearSocketListener()\n    this.socket.addEventListener(\"open\", this.openCallback.bind(this))\n    this.socket.addEventListener(\"close\", this.closeCallback.bind(this))\n    this.socket.addEventListener(\"message\", this.messageCallback.bind(this))\n    await this.initialized.promise\n    if (this.configuration.server.websocket.pingEnabled) {\n      this.pingCount = 0\n      this.initPing()\n    }\n    this.event.emitEndtInitialization()\n    return this.initialized.promise\n  }\n\n  async send(message: TRecognizerWebSocketMessage): Promise<void>\n  {\n    if (!this.socket) {\n      return Promise.reject(new Error(\"Recognizer must be initilized\"))\n    }\n\n    switch (this.socket.readyState) {\n      case this.socket.CONNECTING:\n      case this.socket.OPEN:\n        await this.initialized.promise\n        this.#send(message)\n        return Promise.resolve()\n      case this.socket.CLOSING:\n      case this.socket.CLOSED:\n        if (this.configuration.server.websocket.autoReconnect) {\n          this.reconnectionCount++\n          if (this.configuration.server.websocket.maxRetryCount > this.reconnectionCount) {\n            await this.init()\n            await this.waitForIdle()\n            return this.#send(message)\n          }\n          else {\n            return Promise.reject(new Error(\"Unable to send message. The maximum number of connection attempts has been reached.\"))\n          }\n        }\n        else {\n          return Promise.reject(new Error(\"Unable to send message. Connection closed and automatic reconnection disabled\"))\n        }\n        break\n    }\n  }\n\n  protected buildAddStrokesMessage(strokes: IIStroke[], processGestures = true): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"addStrokes\",\n      processGestures,\n      strokes: strokes.map(s => s.formatToSend())\n    }\n  }\n  async addStrokes(strokes: IIStroke[], processGestures = true): Promise<TRecognizerWebSocketMessageGesture | undefined>\n  {\n    this.addStrokeDeferred = new DeferredPromise<TRecognizerWebSocketMessageGesture | undefined>()\n    if (strokes.length === 0) {\n      this.addStrokeDeferred.resolve(undefined)\n      return this.addStrokeDeferred?.promise\n    }\n    await this.send(this.buildAddStrokesMessage(strokes, processGestures))\n    return this.addStrokeDeferred?.promise\n  }\n\n  protected buildReplaceStrokesMessage(oldStrokeIds: string[], newStrokes: IIStroke[]): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"replaceStrokes\",\n      oldStrokeIds,\n      newStrokes: newStrokes.map(s => s.formatToSend())\n    }\n  }\n  async replaceStrokes(oldStrokeIds: string[], newStrokes: IIStroke[]): Promise<void>\n  {\n    this.replaceStrokeDeferred = new DeferredPromise<void>()\n    if (oldStrokeIds.length === 0) {\n      this.replaceStrokeDeferred.resolve()\n      return this.replaceStrokeDeferred?.promise\n    }\n    await this.send(this.buildReplaceStrokesMessage(oldStrokeIds, newStrokes))\n    return this.replaceStrokeDeferred?.promise\n  }\n\n  protected buildTransformTranslateMessage(strokeIds: string[], tx: number, ty: number): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"TRANSLATE\",\n      strokeIds,\n      tx,\n      ty\n    }\n  }\n  async transformTranslate(strokeIds: string[], tx: number, ty: number): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformTranslateMessage(strokeIds, tx, ty))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildTransformRotateMessage(strokeIds: string[], angle: number, x0: number = 0, y0: number = 0): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"ROTATE\",\n      strokeIds,\n      angle,\n      x0,\n      y0\n    }\n  }\n  async transformRotate(strokeIds: string[], angle: number, x0: number = 0, y0: number = 0): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformRotateMessage(strokeIds, angle, x0, y0))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildTransformScaleMessage(strokeIds: string[], scaleX: number, scaleY: number, x0: number = 0, y0: number = 0): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"SCALE\",\n      strokeIds,\n      scaleX,\n      scaleY,\n      x0,\n      y0\n    }\n  }\n  async transformScale(strokeIds: string[], scaleX: number, scaleY: number, x0: number = 0, y0: number = 0): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformScaleMessage(strokeIds, scaleX, scaleY, x0, y0))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildTransformMatrixMessage(strokeIds: string[], matrix: TMatrixTransform): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"MATRIX\",\n      strokeIds,\n      ...matrix\n    }\n  }\n  async transformMatrix(strokeIds: string[], matrix: TMatrixTransform): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformMatrixMessage(strokeIds, matrix))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildEraseStrokesMessage(strokeIds: string[]): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"eraseStrokes\",\n      strokeIds\n    }\n  }\n  async eraseStrokes(strokeIds: string[]): Promise<void>\n  {\n    this.eraseStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.eraseStrokeDeferred.resolve()\n      return this.eraseStrokeDeferred?.promise\n    }\n    await this.send(this.buildEraseStrokesMessage(strokeIds))\n    return this.eraseStrokeDeferred?.promise\n  }\n\n  async recognizeGesture(stroke: IIStroke): Promise<TRecognizerWebSocketMessageContextlessGesture | undefined>\n  {\n    if (!stroke) {\n      return\n    }\n    this.contextlessGestureDeferred.set(stroke.id, new DeferredPromise<TRecognizerWebSocketMessageContextlessGesture>())\n    const pixelTomm = 25.4 / 96\n    await this.send({\n      type: \"contextlessGesture\",\n      scaleX: pixelTomm,\n      scaleY: pixelTomm,\n      stroke: stroke.formatToSend()\n    })\n    return this.contextlessGestureDeferred.get(stroke.id)!.promise\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    if (!this.waitForIdleDeferred || this.waitForIdleDeferred.isFullFilled) {\n      this.waitForIdleDeferred = new DeferredPromise<void>()\n    }\n    const message: TRecognizerWebSocketMessage = {\n      type: \"waitForIdle\",\n    }\n    await this.send(message)\n    return this.waitForIdleDeferred?.promise\n  }\n\n  protected buildUndoRedoChanges(changes: TIIHistoryBackendChanges): TRecognizerWebSocketMessage[]\n  {\n    const changesMessages: TRecognizerWebSocketMessage[] = []\n    if (changes.added?.length) {\n      changesMessages.push(this.buildAddStrokesMessage(changes.added, false))\n    }\n    if (changes.erased?.length) {\n      changesMessages.push(this.buildEraseStrokesMessage(changes.erased.map(s => s.id)))\n    }\n    if (changes.replaced?.newStrokes.length) {\n      changesMessages.push(this.buildReplaceStrokesMessage(changes.replaced.oldStrokes.map(s => s.id), changes.replaced.newStrokes))\n    }\n    if (changes.matrix?.strokes.length) {\n      changesMessages.push(this.buildTransformMatrixMessage(changes.matrix.strokes.map(s => s.id), changes.matrix.matrix))\n    }\n    if (changes.translate?.length) {\n      changes.translate.forEach(tr =>\n      {\n        changesMessages.push(this.buildTransformTranslateMessage(tr.strokes.map(s => s.id), tr.tx, tr.ty))\n      })\n    }\n    if (changes.rotate?.length) {\n      changes.rotate.forEach(tr =>\n      {\n        changesMessages.push(this.buildTransformRotateMessage(tr.strokes.map(s => s.id), tr.angle, tr.center.x, tr.center.y))\n      })\n    }\n    if (changes.scale?.length) {\n      changes.scale.forEach(tr =>\n      {\n        changesMessages.push(this.buildTransformScaleMessage(tr.strokes.map(s => s.id), tr.scaleX, tr.scaleY, tr.origin.x, tr.origin.y))\n      })\n    }\n    return changesMessages\n  }\n\n  async undo(actions: TIIHistoryBackendChanges): Promise<void>\n  {\n    const changes = this.buildUndoRedoChanges(actions)\n    if (changes.length === 0) {\n      return\n    }\n    this.undoDeferred = new DeferredPromise<void>()\n    const message: TRecognizerWebSocketMessage = {\n      type: \"undo\",\n      changes\n    }\n    await this.send(message)\n    return this.undoDeferred?.promise\n  }\n\n  async redo(actions: TIIHistoryBackendChanges): Promise<void>\n  {\n    const changes = this.buildUndoRedoChanges(actions)\n    if (changes.length === 0) {\n      return\n    }\n    this.redoDeferred = new DeferredPromise<void>()\n\n    const message: TRecognizerWebSocketMessage = {\n      type: \"redo\",\n      changes\n    }\n    await this.send(message)\n    return this.redoDeferred?.promise\n  }\n\n  async export(requestedMimeTypes?: string[]): Promise<TExport>\n  {\n    const mimeTypes: string[] = requestedMimeTypes || this.mimeTypes.slice()\n    await Promise.all(mimeTypes.map(mt => this.exportDeferredMap.get(mt)?.promise))\n    mimeTypes.forEach(mt =>\n    {\n      this.exportDeferredMap.set(mt, new DeferredPromise<TExport>())\n    })\n\n    const message: TRecognizerWebSocketMessage = {\n      type: \"export\",\n      partId: this.currentPartId,\n      mimeTypes\n    }\n    await this.send(message)\n    const exports = await Promise.all(mimeTypes.map(mt => this.exportDeferredMap.get(mt)!.promise))\n    return Object.assign({}, ...exports)\n  }\n\n  async clear(): Promise<void>\n  {\n    this.clearDeferred = new DeferredPromise<void>()\n    await this.send({\n      type: \"clear\"\n    })\n    return this.clearDeferred?.promise\n  }\n\n  async close(code: number, reason: string): Promise<void>\n  {\n    this.resetAllDeferred()\n    this.closeDeferred = new DeferredPromise<void>()\n    if (this.socket.readyState === this.socket.OPEN || this.socket.readyState === this.socket.CONNECTING) {\n      this.socket.close(code, reason)\n    }\n    else {\n      this.closeDeferred.resolve()\n    }\n    await this.closeDeferred.promise\n  }\n\n  async destroy(): Promise<void>\n  {\n    if (this.socket) {\n      await this.close(1000, \"Recognizer destroyed\")\n    }\n  }\n}\n","import { isVersionSuperiorOrEqual, mergeDeep, PartialDeep } from \"../utils\"\nimport {\n  DefaultExportConfiguration,\n  DefaultMathConfiguration,\n  DefaultRecognitionRendererConfiguration,\n  DefaultTextConfiguration,\n  TConvertionConfiguration,\n  TExportConfiguration,\n  TMathConfiguration,\n  TRecognitionRendererConfiguration,\n  TTextConfiguration\n} from \"./recognition\"\nimport { TRecognitionType } from \"./RecognitionConfiguration\"\nimport { DefaultServerWebsocketConfiguration, TServerWebsocketConfiguration } from \"./ServerConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketSSRRecognitionConfiguration = {\n  type: Omit<TRecognitionType, \"DIAGRAM\" | \"Raw Content\">\n  lang: string\n  math: TMathConfiguration\n  text: TTextConfiguration\n  renderer: TRecognitionRendererConfiguration\n  export: TExportConfiguration\n  convert?: TConvertionConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognizerWebSocketSSRRecognitionConfiguration: TRecognizerWebSocketSSRRecognitionConfiguration = {\n  export: DefaultExportConfiguration,\n  math: DefaultMathConfiguration,\n  renderer: DefaultRecognitionRendererConfiguration,\n  text: DefaultTextConfiguration,\n  type: \"TEXT\",\n  lang: \"en_US\",\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketSSRConfiguration = {\n  server: TServerWebsocketConfiguration\n  recognition: TRecognizerWebSocketSSRRecognitionConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognizerWebSocketSSRConfiguration: TRecognizerWebSocketSSRConfiguration =\n{\n  server: DefaultServerWebsocketConfiguration,\n  recognition: DefaultRecognizerWebSocketSSRRecognitionConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport class RecognizerWebSocketSSRConfiguration implements TRecognizerWebSocketSSRConfiguration\n{\n  recognition: TRecognizerWebSocketSSRRecognitionConfiguration\n  server: TServerWebsocketConfiguration\n\n  constructor(configuration?: PartialDeep<TRecognizerWebSocketSSRConfiguration>) {\n    this.server = mergeDeep({}, DefaultRecognizerWebSocketSSRConfiguration.server, configuration?.server)\n    this.recognition = mergeDeep({}, DefaultRecognizerWebSocketSSRConfiguration.recognition, configuration?.recognition)\n\n    if (configuration?.recognition?.text?.mimeTypes) {\n      this.recognition.text.mimeTypes = configuration.recognition.text.mimeTypes as (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n    }\n    this.recognition.text.mimeTypes = [...new Set(this.recognition.text.mimeTypes)]\n\n    if (configuration?.recognition?.math?.mimeTypes) {\n      this.recognition.math.mimeTypes = configuration.recognition.math.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/x-latex\" | \"application/mathml+xml\")[]\n    }\n    this.recognition.math.mimeTypes = [...new Set(this.recognition.math.mimeTypes)]\n\n    if (this.server.version) {\n      if (!isVersionSuperiorOrEqual(this.server.version, \"2.3.0\")) {\n        delete this.recognition.convert\n      }\n      if (!isVersionSuperiorOrEqual(this.server.version, \"3.2.0\")) {\n        delete this.recognition.export.jiix.text.lines\n      }\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { Model, TExport, TJIIXExport } from \"../model\"\nimport { Stroke } from \"../symbol\"\nimport { StyleHelper, TPenStyle, TTheme } from \"../style\"\nimport { THistoryContext } from \"../history\"\nimport { DeferredPromise, PartialDeep, computeHmac, getApiInfos, isVersionSuperiorOrEqual } from \"../utils\"\nimport\n{\n  TRecognizerWebSocketSSRMessage,\n  TRecognizerWebSocketSSRMessageContentChange,\n  TRecognizerWebSocketSSRMessageError,\n  TRecognizerWebSocketSSRMessageExport,\n  TRecognizerWebSocketSSRMessageHMACChallenge,\n  TRecognizerWebSocketSSRMessagePartChange,\n  TRecognizerWebSocketSSRMessageSVGPatch\n} from \"./RecognizerWebSocketSSRMessage\"\nimport { RecognizerError } from \"./RecognizerError\"\nimport { RecognizerEvent } from \"./RecognizerEvent\"\nimport { TRecognizerWebSocketSSRConfiguration, RecognizerWebSocketSSRConfiguration } from \"./RecognizerWebSocketSSRConfiguration\"\nimport { TConverstionState } from \"./RecognitionConfiguration\"\n\n/**\n * A websocket dialog have this sequence :\n * --------------------------- Client --------------------------------------------------- Server ----------------------------------\n * init: send newContentPackage or restoreIInkSession           ==================>\n *                                                              <==================       ack\n * answer ack:\n *  send the hmac (if enable)                                   ==================>\n *  send the configuration                                      ==================>\n *                                                              <==================       contentPackageDescription\n * answer contentPackageDescription:\n *  send newContentPart or openContentPart                      ==================>\n *                                                              <==================        partChanged\n *                                                              <==================        contentChanged\n *                                                              <==================        newPart\n *                                                              <==================        svgPatch\n *\n * setPenStyle (send the parameters)                            ==================>\n * setTheme (send the parameters)                               ==================>\n * setPenStyleClasses (send the parameters)                     ==================>\n *                                                              <==================        svgPatch\n * addStrokes (send the strokes ) ============>\n *                                                              <==================        update\n */\n\n/**\n * @group Recognizer\n */\nexport class RecognizerWebSocketSSR\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RECOGNIZER)\n\n  protected socket!: WebSocket\n  protected pingCount = 0\n  protected reconnectionCount = 0\n  protected viewSizeHeight!: number\n  protected viewSizeWidth!: number\n  protected sessionId?: string\n  currentPartId?: string\n  protected currentErrorCode?: string | number\n\n  protected penStyle?: TPenStyle\n  protected penStyleClasses?: string\n  protected theme?: TTheme\n\n  protected connected?: DeferredPromise<void>\n  protected ackDeferred?: DeferredPromise<void>\n  protected addStrokeDeferred?: DeferredPromise<TExport>\n  protected exportDeferred?: DeferredPromise<TExport>\n  protected convertDeferred?: DeferredPromise<TExport>\n  protected importDeferred?: DeferredPromise<TExport>\n  protected resizeDeferred?: DeferredPromise<void>\n  protected undoDeferred?: DeferredPromise<TExport>\n  protected redoDeferred?: DeferredPromise<TExport>\n  protected clearDeferred?: DeferredPromise<TExport>\n  protected importPointEventsDeferred?: DeferredPromise<TExport>\n  protected waitForIdleDeferred?: DeferredPromise<void>\n\n  configuration: TRecognizerWebSocketSSRConfiguration\n  initialized: DeferredPromise<void>\n  url: string\n  event: RecognizerEvent\n\n  constructor(config?: PartialDeep<TRecognizerWebSocketSSRConfiguration>)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.configuration = new RecognizerWebSocketSSRConfiguration(config)\n    const scheme = (this.configuration.server.scheme === \"https\") ? \"wss\" : \"ws\"\n    this.url = `${ scheme }://${ this.configuration.server.host }/api/v4.0/iink/document?applicationKey=${ this.configuration.server.applicationKey }`\n    this.event = new RecognizerEvent()\n    this.initialized = new DeferredPromise<void>()\n  }\n\n  get mimeTypes(): string[]\n  {\n    switch (this.configuration.recognition.type.toLocaleLowerCase()) {\n      case \"text\":\n        return this.configuration.recognition.text.mimeTypes\n      case \"math\":\n        return this.configuration.recognition.math.mimeTypes\n      default:\n        throw new Error(`Unauthorized recognition type: \"${ this.configuration.recognition.type }\"`)\n    }\n  }\n\n  protected infinitePing(): void\n  {\n    this.pingCount++\n    if (this.configuration.server.websocket.maxPingLostCount < this.pingCount) {\n      this.socket.close(1000, \"MAXIMUM_PING_REACHED\")\n    } else if (this.socket.readyState <= 1) {\n      setTimeout(() =>\n      {\n        if (this.socket.readyState <= 1) {\n          this.socket.send(JSON.stringify({ type: \"ping\" }))\n          this.infinitePing()\n        }\n      }, this.configuration.server.websocket.pingDelay)\n    }\n  }\n\n  protected openCallback(): void\n  {\n    this.connected?.resolve()\n    const params: TRecognizerWebSocketSSRMessage = {\n      type: this.sessionId ? \"restoreIInkSession\" : \"newContentPackage\",\n      iinkSessionId: this.sessionId,\n      applicationKey: this.configuration.server.applicationKey,\n      xDpi: 96,\n      yDpi: 96,\n      viewSizeHeight: this.viewSizeHeight,\n      viewSizeWidth: this.viewSizeWidth\n    }\n    if (isVersionSuperiorOrEqual(this.configuration.server.version!, \"2.0.4\")) {\n      params[\"myscript-client-name\"] = \"iink-ts\"\n      params[\"myscript-client-version\"] = \"1.0.0-buildVersion\"\n    }\n    this.send(params)\n  }\n\n  protected rejectDeferredPending(error: Error): void\n  {\n    if (this.connected?.isPending) {\n      this.connected?.reject(error)\n    }\n    if (this.initialized.isPending) {\n      this.initialized.reject(error)\n    }\n    if (this.addStrokeDeferred?.isPending) {\n      this.addStrokeDeferred?.reject(error)\n    }\n    if (this.exportDeferred?.isPending) {\n      this.exportDeferred?.reject(error)\n    }\n    if (this.importPointEventsDeferred?.isPending) {\n      this.importPointEventsDeferred?.reject(error)\n    }\n    if (this.convertDeferred?.isPending) {\n      this.convertDeferred?.reject(error)\n    }\n    if (this.importDeferred?.isPending) {\n      this.importDeferred?.reject(error)\n    }\n    if (this.resizeDeferred?.isPending) {\n      this.resizeDeferred?.reject(error)\n    }\n    if (this.waitForIdleDeferred?.isPending) {\n      this.waitForIdleDeferred?.reject(error)\n    }\n    if (this.undoDeferred?.isPending) {\n      this.undoDeferred?.reject(error)\n    }\n    if (this.redoDeferred?.isPending) {\n      this.redoDeferred?.reject(error)\n    }\n    if (this.clearDeferred?.isPending) {\n      this.clearDeferred.reject(error)\n    }\n    if (this.waitForIdleDeferred?.isPending) {\n      this.waitForIdleDeferred.reject(error)\n    }\n  }\n\n  protected closeCallback(evt: CloseEvent): void\n  {\n    let message = \"\"\n    if (!this.currentErrorCode) {\n      switch (evt.code) {\n        case 1000:\n          // Normal Closure\n          break\n        case 1001:\n          message = RecognizerError.GOING_AWAY\n          break\n        case 1002:\n          message = RecognizerError.PROTOCOL_ERROR\n          break\n        case 1003:\n          message = RecognizerError.UNSUPPORTED_DATA\n          break\n        case 1006:\n          message = RecognizerError.ABNORMAL_CLOSURE\n          break\n        case 1007:\n          message = RecognizerError.INVALID_FRAME_PAYLOAD\n          break\n        case 1008:\n          message = RecognizerError.POLICY_VIOLATION\n          break\n        case 1009:\n          message = RecognizerError.MESSAGE_TOO_BIG\n          break\n        case 1011:\n          message = RecognizerError.INTERNAL_ERROR\n          break\n        case 1012:\n          message = RecognizerError.SERVICE_RESTART\n          break\n        case 1013:\n          message = RecognizerError.TRY_AGAIN\n          break\n        case 1014:\n          message = RecognizerError.BAD_GATEWAY\n          break\n        case 1015:\n          message = RecognizerError.TLS_HANDSHAKE\n          break\n        default:\n          this.#logger.warn(\"closeCallback\", \"unknow CloseEvent.code\", { evt })\n          message = RecognizerError.CANT_ESTABLISH\n          break\n      }\n    }\n\n    if (!this.currentErrorCode && evt.code !== 1000) {\n      const error = new Error(message || evt.reason)\n      this.rejectDeferredPending(error)\n      this.event.emitError(error)\n    }\n  }\n\n  protected async manageAckMessage(websocketMessage: TRecognizerWebSocketSSRMessage): Promise<void>\n  {\n    this.#logger.info(\"manageAckMessage\", { websocketMessage })\n    const hmacChallengeMessage = websocketMessage as TRecognizerWebSocketSSRMessageHMACChallenge\n    if (hmacChallengeMessage.hmacChallenge) {\n      let hmacKey: string\n      if (typeof this.configuration.server.hmacKey == \"string\") {\n        if (this.configuration.server.hmacKey.length === 0) {\n          return this.ackDeferred?.reject(\"HMAC key is empty\")\n        }\n        hmacKey = this.configuration.server.hmacKey\n      } else if (typeof this.configuration.server.hmacKey == \"function\") {\n        hmacKey = await this.configuration.server.hmacKey(this.configuration.server.applicationKey)\n      }\n      else {\n        this.ackDeferred?.reject(\"HMAC key is not a string nor a function\")\n        return this.initialized.reject(new Error(\"HMAC key is not a string nor a function\"))\n      }\n      if (!hmacKey) {\n        this.ackDeferred?.reject(\"HMAC key is undefined\")\n        return this.initialized.reject(new Error(\"HMAC key is undefined\"))\n      }\n      this.send({\n        type: \"hmac\",\n        hmac: await computeHmac(hmacChallengeMessage.hmacChallenge, this.configuration.server.applicationKey, hmacKey)\n      })\n    }\n    if (hmacChallengeMessage.iinkSessionId) {\n      this.sessionId = hmacChallengeMessage.iinkSessionId\n    }\n    if (!isVersionSuperiorOrEqual(this.configuration.server.version!, \"2.3.0\")) {\n      delete this.configuration.recognition.convert\n    }\n    if (!isVersionSuperiorOrEqual(this.configuration.server.version!, \"3.2.0\")) {\n      delete this.configuration.recognition.export.jiix.text.lines\n    }\n    this.send({ ...this.configuration.recognition, type: \"configuration\" })\n    this.ackDeferred?.resolve()\n  }\n\n  protected async manageContentPackageDescriptionMessage(): Promise<void>\n  {\n    this.reconnectionCount = 0\n    await this.ackDeferred?.promise\n    this.#logger.info(\"manageContentPackageDescriptionMessage\")\n    if (this.currentPartId) {\n      this.send({ type: \"openContentPart\", id: this.currentPartId, mimeTypes: this.mimeTypes })\n    }\n    else {\n      this.send({ type: \"newContentPart\", contentType: this.configuration.recognition.type, mimeTypes: this.mimeTypes })\n    }\n  }\n\n  protected managePartChangeMessage(websocketMessage: TRecognizerWebSocketSSRMessage): void\n  {\n    this.#logger.info(\"managePartChangeMessage\", { websocketMessage })\n    const partChangeMessage = websocketMessage as TRecognizerWebSocketSSRMessagePartChange\n    this.currentPartId = partChangeMessage.partId\n    this.initialized.resolve()\n  }\n\n  protected manageExportMessage(websocketMessage: TRecognizerWebSocketSSRMessage): void\n  {\n    this.#logger.info(\"manageExportMessage\", { websocketMessage })\n    const exportMessage = websocketMessage as TRecognizerWebSocketSSRMessageExport\n    if (exportMessage.exports[\"application/vnd.myscript.jiix\"]) {\n      exportMessage.exports[\"application/vnd.myscript.jiix\"] = JSON.parse(exportMessage.exports[\"application/vnd.myscript.jiix\"].toString()) as TJIIXExport\n    }\n    this.initialized.resolve()\n    this.addStrokeDeferred?.resolve(exportMessage.exports)\n    this.exportDeferred?.resolve(exportMessage.exports)\n    this.convertDeferred?.resolve(exportMessage.exports)\n    this.importDeferred?.resolve(exportMessage.exports)\n    this.undoDeferred?.resolve(exportMessage.exports)\n    this.redoDeferred?.resolve(exportMessage.exports)\n    this.clearDeferred?.resolve(exportMessage.exports)\n    this.importPointEventsDeferred?.resolve(exportMessage.exports)\n    this.event.emitExported(exportMessage.exports)\n  }\n\n  protected async manageWaitForIdle(): Promise<void>\n  {\n    this.event.emitIdle(true)\n    this.waitForIdleDeferred?.resolve()\n  }\n\n  protected manageErrorMessage(websocketMessage: TRecognizerWebSocketSSRMessage): void\n  {\n    const err = websocketMessage as TRecognizerWebSocketSSRMessageError\n    this.currentErrorCode = err.data?.code || err.code\n    let message = err.data?.message || err.message || RecognizerError.UNKNOW\n\n    switch (this.currentErrorCode) {\n      case \"no.activity\":\n        message = RecognizerError.NO_ACTIVITY\n        break\n      case \"access.not.granted\":\n        message = RecognizerError.WRONG_CREDENTIALS\n        break\n      case \"session.too.old\":\n        message = RecognizerError.TOO_OLD\n        break\n    }\n    const error = new Error(message)\n    this.rejectDeferredPending(error)\n    this.event.emitError(error)\n  }\n\n  protected manageContentChangeMessage(websocketMessage: TRecognizerWebSocketSSRMessage): void\n  {\n    this.#logger.info(\"manageContentChangeMessage\", { websocketMessage })\n    const contentChangeMessage = websocketMessage as TRecognizerWebSocketSSRMessageContentChange\n    const context: THistoryContext = {\n      canRedo: contentChangeMessage.canRedo,\n      canUndo: contentChangeMessage.canUndo,\n      empty: contentChangeMessage.empty,\n      stackIndex: contentChangeMessage.undoStackIndex,\n      possibleUndoCount: contentChangeMessage.possibleUndoCount,\n    }\n    this.event.emitContentChanged(context)\n  }\n\n  protected manageSVGPatchMessage(websocketMessage: TRecognizerWebSocketSSRMessage): void\n  {\n    this.#logger.info(\"manageSVGPatchMessage\", { websocketMessage })\n    this.resizeDeferred?.resolve()\n    const svgPatchMessage = websocketMessage as TRecognizerWebSocketSSRMessageSVGPatch\n    this.event.emitSVGPatch(svgPatchMessage)\n  }\n\n  protected messageCallback(message: MessageEvent<string>): void\n  {\n    this.#logger.debug(\"messageCallback\", { message })\n    this.currentErrorCode = undefined\n    const websocketMessage: TRecognizerWebSocketSSRMessage = JSON.parse(message.data)\n    if (websocketMessage.type !== \"pong\") {\n      this.pingCount = 0\n      switch (websocketMessage.type) {\n        case \"ack\":\n          this.manageAckMessage(websocketMessage)\n          break\n        case \"contentPackageDescription\":\n          this.manageContentPackageDescriptionMessage()\n          break\n        case \"partChanged\":\n          this.managePartChangeMessage(websocketMessage)\n          break\n        case \"newPart\":\n          this.initialized.resolve()\n          break\n        case \"contentChanged\":\n          this.manageContentChangeMessage(websocketMessage)\n          break\n        case \"exported\":\n          this.manageExportMessage(websocketMessage)\n          break\n        case \"svgPatch\":\n          this.manageSVGPatchMessage(websocketMessage)\n          break\n        case \"error\":\n          this.manageErrorMessage(websocketMessage)\n          break\n        case \"idle\":\n          this.manageWaitForIdle()\n          break\n        default:\n          this.#logger.warn(\"messageCallback\", `Message type unknow: \"${ websocketMessage.type }\".`)\n      }\n    }\n  }\n\n  async init(height: number, width: number): Promise<void>\n  {\n    try {\n      this.event.emitStartInitialization()\n      this.#logger.info(\"init\", { height, width })\n      this.destroy()\n\n      if (!this.configuration.server.version) {\n        this.configuration.server.version = (await getApiInfos(this.configuration)).version\n      }\n      this.connected = new DeferredPromise<void>()\n      this.initialized = new DeferredPromise<void>()\n      this.ackDeferred = new DeferredPromise<void>()\n      this.viewSizeHeight = height\n      this.viewSizeWidth = width\n      this.pingCount = 0\n      this.socket = new WebSocket(this.url)\n\n      if (this.configuration.server.websocket.pingEnabled) {\n        this.infinitePing()\n      }\n\n      this.socket.addEventListener(\"open\", this.openCallback.bind(this))\n      this.socket.addEventListener(\"close\", this.closeCallback.bind(this))\n      this.socket.addEventListener(\"message\", this.messageCallback.bind(this))\n      this.event.emitEndtInitialization()\n      await this.connected.promise\n      await this.initialized.promise\n    } catch (err: unknown) {\n      this.rejectDeferredPending(err as Error)\n      return this.initialized.promise\n    }\n  }\n\n  async send(message: TRecognizerWebSocketSSRMessage): Promise<void>\n  {\n    if (!this.socket) {\n      return Promise.reject(new Error(\"Recognizer must be initilized\"))\n    }\n    await this.connected?.promise\n    if (this.socket.readyState === this.socket.OPEN) {\n      this.#logger.debug(\"send\", { message })\n      this.socket.send(JSON.stringify(message))\n      return Promise.resolve()\n    } else {\n      if (this.socket.readyState != this.socket.CONNECTING && this.configuration.server.websocket.autoReconnect) {\n        this.reconnectionCount++\n        if (this.configuration.server.websocket.maxRetryCount >= this.reconnectionCount) {\n          this.#logger.debug(\"send\", `try to reconnect number: ${ this.reconnectionCount }.`)\n          await this.init(this.viewSizeHeight, this.viewSizeWidth)\n          await this.setPenStyle(this.penStyle as TPenStyle)\n          await this.setPenStyleClasses(this.penStyleClasses as string)\n          await this.setTheme(this.theme as TTheme)\n          return this.send(message)\n        }\n        else {\n          return Promise.reject(new Error(\"Unable to send message. The maximum number of connection attempts has been reached.\"))\n        }\n      }\n    }\n  }\n\n  async addStrokes(strokes: Stroke[]): Promise<TExport>\n  {\n    this.#logger.info(\"addStrokes\", { strokes })\n    await this.initialized.promise\n    this.addStrokeDeferred = new DeferredPromise<TExport>()\n    if (strokes.length === 0) {\n      this.addStrokeDeferred.resolve({} as TExport)\n    }\n    else {\n      await this.send({\n        type: \"addStrokes\",\n        strokes: strokes.map(s => s.formatToSend())\n      })\n    }\n    return this.addStrokeDeferred?.promise\n  }\n\n  async setPenStyle(penStyle: TPenStyle): Promise<void>\n  {\n    this.#logger.info(\"setPenStyle\", { penStyle })\n    await this.initialized.promise\n    this.penStyle = penStyle\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"setPenStyle\",\n      style: StyleHelper.penStyleToCSS(penStyle)\n    }\n    return this.send(message)\n  }\n\n  async setPenStyleClasses(penStyleClasses: string): Promise<void>\n  {\n    await this.initialized.promise\n    this.penStyleClasses = penStyleClasses\n    this.#logger.info(\"setPenStyleClasses\", { penStyleClasses })\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"setPenStyleClasses\",\n      styleClasses: penStyleClasses\n    }\n    return this.send(message)\n  }\n\n  async setTheme(theme: TTheme): Promise<void>\n  {\n    this.#logger.info(\"setTheme\", { theme })\n    await this.initialized.promise\n    this.theme = theme\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"setTheme\",\n      theme: StyleHelper.themeToCSS(theme)\n    }\n    return this.send(message)\n  }\n\n  async export(model: Model, requestedMimeTypes?: string[]): Promise<Model>\n  {\n    this.#logger.info(\"export\", { model, requestedMimeTypes })\n    await this.initialized.promise\n    this.exportDeferred = new DeferredPromise<TExport>()\n    const localModel = model.clone()\n    let mimeTypes: string[] = requestedMimeTypes || []\n    if (!mimeTypes.length) {\n      switch (this.configuration.recognition.type) {\n        case \"MATH\":\n          mimeTypes = this.configuration.recognition.math.mimeTypes\n          break\n        case \"TEXT\":\n          mimeTypes = this.configuration.recognition.text.mimeTypes\n          break\n        default:\n          throw new Error(`Recognition type \"${ this.configuration.recognition.type }\" is unknown.\\n Possible types are:\\n -MATH\\n -TEXT`)\n      }\n    }\n\n    if (!mimeTypes.length) {\n      return Promise.reject(new Error(`Export failed, no mimeTypes define in recognition ${ this.configuration.recognition.type } configuration`))\n    }\n\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"export\",\n      partId: this.currentPartId,\n      mimeTypes\n    }\n    await this.send(message)\n    const exports: TExport = await this.exportDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(exports)\n    this.#logger.debug(\"export\", { model: localModel })\n    return localModel\n  }\n\n  async import(model: Model, data: Blob, mimeType?: string): Promise<Model>\n  {\n    this.#logger.info(\"import\", { data, mimeType })\n    await this.initialized.promise\n    const localModel = model.clone()\n    const chunkSize = this.configuration.server.websocket.fileChunkSize\n    const importFileId = Math.random().toString(10).substring(2, 6)\n    this.importDeferred = new DeferredPromise<TExport>()\n    const readBlob = (blob: Blob): Promise<string | never> =>\n    {\n      const fileReader = new FileReader()\n      return new Promise((resolve, reject) =>\n      {\n        fileReader.onloadend = (ev) => resolve(ev.target?.result as string)\n        fileReader.onerror = () => reject()\n        fileReader.readAsText(blob)\n      })\n    }\n\n    const importFileMessage: TRecognizerWebSocketSSRMessage = {\n      type: \"importFile\",\n      importFileId,\n      mimeType\n    }\n    await this.send(importFileMessage)\n    for (let i = 0; i < data.size; i += chunkSize) {\n      const blobPart = data.slice(i, i + chunkSize, data.type)\n      const partFileString = await readBlob(blobPart)\n      const fileChuckMessage: TRecognizerWebSocketSSRMessage = {\n        type: \"fileChunk\",\n        importFileId,\n        data: partFileString,\n        lastChunk: i + chunkSize > data.size\n      }\n      await this.send(fileChuckMessage)\n    }\n    const exports = await this.importDeferred?.promise\n    this.importDeferred = undefined\n    localModel.mergeExport(exports)\n    return localModel\n  }\n\n  async resize(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"resize\", { model })\n    await this.initialized.promise\n    this.resizeDeferred = new DeferredPromise<void>()\n    const localModel = model.clone()\n    this.viewSizeHeight = localModel.height\n    this.viewSizeWidth = localModel.width\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"changeViewSize\",\n      height: this.viewSizeHeight,\n      width: this.viewSizeWidth,\n    }\n    await this.send(message)\n    await this.resizeDeferred?.promise\n    return localModel\n  }\n\n  async importPointEvents(strokes: Stroke[]): Promise<TExport>\n  {\n    this.#logger.info(\"importPointsEvents\", { strokes })\n    await this.initialized.promise\n    this.importPointEventsDeferred = new DeferredPromise<TExport>()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"pointerEvents\",\n      events: strokes.map(s => s.formatToSend())\n    }\n    await this.send(message)\n    return this.importPointEventsDeferred?.promise\n  }\n\n  async convert(model: Model, conversionState?: TConverstionState): Promise<Model>\n  {\n    this.#logger.info(\"convert\", { model, conversionState })\n    await this.initialized.promise\n    this.convertDeferred = new DeferredPromise<TExport>()\n    const localModel = model.clone()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"convert\",\n      conversionState\n    }\n    await this.send(message)\n    const myExportConverted: TExport = await this.convertDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeConvert(myExportConverted)\n    this.#logger.debug(\"convert\", { model: localModel })\n    return localModel\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    await this.initialized.promise\n    this.waitForIdleDeferred = new DeferredPromise<void>()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"waitForIdle\",\n    }\n    await this.send(message)\n    return this.waitForIdleDeferred?.promise\n  }\n\n  async undo(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"undo\", { model })\n    await this.initialized.promise\n    const localModel = model.clone()\n    this.undoDeferred = new DeferredPromise<TExport>()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"undo\",\n    }\n    await this.send(message)\n    const undoExports = await this.undoDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(undoExports)\n    this.#logger.debug(\"undo\", { model: localModel })\n    this.undoDeferred = undefined\n    return localModel\n  }\n\n  async redo(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"redo\", { model })\n    await this.initialized.promise\n    const localModel = model.clone()\n    this.redoDeferred = new DeferredPromise<TExport>()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"redo\",\n    }\n    await this.send(message)\n    const redoExports = await this.redoDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(redoExports)\n    this.#logger.debug(\"redo\", { model: redoExports })\n    this.redoDeferred = undefined\n    return localModel\n  }\n\n  async clear(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"clear\", { model })\n    await this.initialized.promise\n    const localModel = model.clone()\n    localModel.modificationDate = Date.now()\n    this.clearDeferred = new DeferredPromise<TExport>()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"clear\",\n    }\n    await this.send(message)\n    const clearExports = await this.clearDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(clearExports)\n    this.clearDeferred = undefined\n    this.#logger.info(\"clear\", { model: localModel })\n    return localModel\n  }\n\n  close(code: number, reason: string): void\n  {\n    if (this.socket.readyState === this.socket.OPEN || this.socket.readyState === this.socket.CONNECTING) {\n      this.#logger.info(\"close\", { code, reason })\n      this.socket.removeEventListener(\"close\", this.closeCallback)\n      this.socket.removeEventListener(\"message\", this.messageCallback)\n      this.socket.removeEventListener(\"open\", this.openCallback)\n      this.socket.close(code, reason)\n    }\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\")\n    this.connected = undefined\n    this.ackDeferred = undefined\n    this.addStrokeDeferred = undefined\n    this.exportDeferred = undefined\n    this.convertDeferred = undefined\n    this.importDeferred = undefined\n    this.importPointEventsDeferred = undefined\n    this.waitForIdleDeferred = undefined\n    this.resizeDeferred = undefined\n    this.undoDeferred = undefined\n    this.redoDeferred = undefined\n    this.clearDeferred = undefined\n    if (this.socket) {\n      this.socket.removeEventListener(\"close\", this.closeCallback)\n      this.socket.removeEventListener(\"message\", this.messageCallback)\n      this.socket.removeEventListener(\"open\", this.openCallback)\n      this.close(1000, \"Recognizer destroyed\")\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { TPoint, TCanvasShapeEllipseSymbol, TCanvasShapeLineSymbol, TCanvasShapeTableSymbol, TSymbol } from \"../../symbol\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRendererShape\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n\n  symbols = {\n    table: \"table\",\n    ellipse: \"ellipse\",\n    line: \"line\"\n  }\n\n  protected phi(angle: number): number\n  {\n    let returnedAngle = ((angle + Math.PI) % (Math.PI * 2)) - Math.PI\n    if (returnedAngle < -Math.PI) {\n      returnedAngle += Math.PI * 2\n    }\n    this.#logger.debug(\"phi\", { angle, returnedAngle })\n    return returnedAngle\n  }\n\n  protected drawEllipseArc(context2D: CanvasRenderingContext2D, shapeEllipse: TCanvasShapeEllipseSymbol): TPoint[]\n  {\n    this.#logger.debug(\"drawEllipseArc\", { context2D, shapeEllipse })\n    const { centerPoint, maxRadius, minRadius, orientation, startAngle, sweepAngle } = shapeEllipse\n    const angleStep = 0.02\n    const z1 = Math.cos(orientation) * maxRadius\n    const z2 = Math.cos(orientation) * minRadius\n    const z3 = Math.sin(orientation) * maxRadius\n    const z4 = Math.sin(orientation) * minRadius\n    const n = Math.floor(Math.abs(sweepAngle) / angleStep)\n    const boundariesPoints = []\n    context2D.save()\n    try {\n      context2D.beginPath()\n      for (let i = 0; i <= n; i++) {\n        const angle = startAngle + ((i / n) * sweepAngle)\n        const alpha = Math.atan2(Math.sin(angle) / minRadius, Math.cos(angle) / maxRadius)\n        const cosAlpha = Math.cos(alpha)\n        const sinAlpha = Math.sin(alpha)\n        const x = (centerPoint.x + (z1 * cosAlpha)) - (z4 * sinAlpha)\n        const y = (centerPoint.y + (z2 * sinAlpha)) + (z3 * cosAlpha)\n        if (i === 0) {\n          context2D.moveTo(x, y)\n        } else {\n          context2D.lineTo(x, y)\n        }\n        if (i === 0 || i === n) {\n          boundariesPoints.push({ x, y })\n        }\n      }\n      context2D.stroke()\n    } catch(error) {\n      this.#logger.error(\"drawEllipseArc\", { error })\n    } finally {\n      context2D.restore()\n    }\n    return boundariesPoints\n  }\n\n  protected drawLine(context2D: CanvasRenderingContext2D, p1: TPoint, p2: TPoint)\n  {\n    this.#logger.debug(\"drawLine\", { context2D, p1, p2 })\n    context2D.save()\n    try {\n      context2D.beginPath()\n      context2D.moveTo(p1.x, p1.y)\n      context2D.lineTo(p2.x, p2.y)\n      context2D.stroke()\n    } catch(error) {\n      this.#logger.error(\"drawLine\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawArrowHead(context2D: CanvasRenderingContext2D, headPoint: TPoint, angle: number, length: number)\n  {\n    this.#logger.debug(\"drawArrowHead\", { context2D, headPoint, angle, length })\n    const alpha = this.phi(angle + (Math.PI * (7 / 8)))\n    const beta = this.phi(angle - (Math.PI * (7 / 8)))\n    context2D.save()\n    try {\n      context2D.fillStyle = context2D.strokeStyle\n\n      context2D.moveTo(headPoint.x, headPoint.y)\n      context2D.beginPath()\n      context2D.lineTo(headPoint.x + (length * Math.cos(alpha)), headPoint.y + (length * Math.sin(alpha)))\n      context2D.lineTo(headPoint.x + (length * Math.cos(beta)), headPoint.y + (length * Math.sin(beta)))\n      context2D.lineTo(headPoint.x, headPoint.y)\n      context2D.fill()\n    } catch(error) {\n      this.#logger.error(\"drawArrowHead\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawShapeEllipse(context2D: CanvasRenderingContext2D, shapeEllipse: TCanvasShapeEllipseSymbol)\n  {\n    this.#logger.debug(\"drawShapeEllipse\", { context2D, shapeEllipse })\n    const points = this.drawEllipseArc(context2D, shapeEllipse)\n\n    if (shapeEllipse?.beginDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, points[0], shapeEllipse.beginTangentAngle, 12.0)\n    }\n    if (shapeEllipse?.endDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, points[1], shapeEllipse.endTangentAngle, 12.0)\n    }\n  }\n\n  protected drawShapeLine(context2D: CanvasRenderingContext2D, shapeLine: TCanvasShapeLineSymbol)\n  {\n    this.#logger.debug(\"drawShapeLine\", { context2D, shapeLine })\n    this.drawLine(context2D, shapeLine.firstPoint, shapeLine.lastPoint)\n    if (shapeLine.beginDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, shapeLine.firstPoint, shapeLine.beginTangentAngle, 12.0)\n    }\n    if (shapeLine.endDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, shapeLine.lastPoint, shapeLine.endTangentAngle, 12.0)\n    }\n  }\n\n  draw(context2D: CanvasRenderingContext2D, symbol: TSymbol)\n  {\n    this.#logger.info(\"draw\", { context2D, symbol })\n    context2D.save()\n    context2D.lineWidth = symbol.style.width as number\n    context2D.strokeStyle = symbol.style.color as string\n\n    switch (symbol.type) {\n      case this.symbols.table: {\n        const tableSymbols = symbol as TCanvasShapeTableSymbol\n        tableSymbols.lines.forEach(line => this.drawLine(context2D, line.p1, line.p2))\n        break\n      }\n      case this.symbols.ellipse: {\n        this.drawShapeEllipse(context2D, symbol as TCanvasShapeEllipseSymbol)\n        break\n      }\n      case this.symbols.line: {\n        this.drawShapeLine(context2D, symbol as TCanvasShapeLineSymbol)\n        break\n      }\n      default:\n        this.#logger.warn(\"draw\", `${ symbol.type } not implemented`)\n        break\n    }\n  }\n\n}\n","import { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { Stroke, TPointer } from \"../../symbol\"\nimport { computeAngleAxeRadian, computeLinksPointers, computeMiddlePointer } from \"../../utils\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRendererStroke\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n\n  protected renderArc(context2d: CanvasRenderingContext2D, center: TPointer, radius: number): void\n  {\n    this.#logger.debug(\"renderArc\", { context2d, center, radius })\n    context2d.arc(center.x, center.y, radius, 0, Math.PI * 2, true)\n  }\n\n  protected renderLine(context2d: CanvasRenderingContext2D, begin: TPointer, end: TPointer, width: number): void\n  {\n    this.#logger.debug(\"renderLine\", { context2d, begin, end, width })\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, end), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(begin, end), width)\n\n    context2d.moveTo(linkPoints1[0].x, linkPoints1[0].y)\n    context2d.lineTo(linkPoints2[0].x, linkPoints2[0].y)\n    context2d.lineTo(linkPoints2[1].x, linkPoints2[1].y)\n    context2d.lineTo(linkPoints1[1].x, linkPoints1[1].y)\n  }\n\n  protected renderFinal(context2d: CanvasRenderingContext2D, begin: TPointer, end: TPointer, width: number): void\n  {\n    this.#logger.debug(\"renderFinal\", { context2d, begin, end, width })\n    const ARCSPLIT = 6\n    const angle = computeAngleAxeRadian(begin, end)\n    const linkPoints = computeLinksPointers(end, angle, width)\n    context2d.moveTo(linkPoints[0].x, linkPoints[0].y)\n    for (let i = 1; i <= ARCSPLIT; i++) {\n      const newAngle = angle - ((i * Math.PI) / ARCSPLIT)\n      context2d.lineTo(end.x - ((end.p * width) * Math.sin(newAngle)), end.y + (end.p * width * Math.cos(newAngle)))\n    }\n  }\n\n  protected renderQuadratic(context2d: CanvasRenderingContext2D, begin: TPointer, end: TPointer, ctrl: TPointer, width: number): void\n  {\n    this.#logger.debug(\"renderQuadratic\", { context2d, begin, end, ctrl, width })\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, ctrl), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(ctrl, end), width)\n    const linkPoints3 = computeLinksPointers(ctrl, computeAngleAxeRadian(begin, end), width)\n\n    context2d.moveTo(linkPoints1[0].x, linkPoints1[0].y)\n    context2d.quadraticCurveTo(linkPoints3[0].x, linkPoints3[0].y, linkPoints2[0].x, linkPoints2[0].y)\n    context2d.lineTo(linkPoints2[1].x, linkPoints2[1].y)\n    context2d.quadraticCurveTo(linkPoints3[1].x, linkPoints3[1].y, linkPoints1[1].x, linkPoints1[1].y)\n  }\n\n  draw(context2d: CanvasRenderingContext2D, stroke: Stroke): void\n  {\n    this.#logger.info(\"draw\", { context2d, stroke })\n    const NUMBER_POINTS = stroke.pointers.length\n    const NUMBER_QUADRATICS = NUMBER_POINTS - 2\n    const width = (stroke.style.width as number) > 0 ? (stroke.style.width as number) : context2d.lineWidth\n    const color = (stroke.style.color as string) ? (stroke.style.color as string) : context2d.strokeStyle\n    const firstPoint = stroke.pointers[0] as TPointer\n\n    context2d.save()\n    try {\n      context2d.beginPath()\n      if (NUMBER_POINTS < 3) {\n        this.renderArc(context2d, firstPoint, width * 0.6)\n      } else {\n        this.renderArc(context2d, firstPoint, width * firstPoint.p)\n        const secondPoint: TPointer = computeMiddlePointer(firstPoint, stroke.pointers[1])\n        this.renderLine(context2d, firstPoint, secondPoint, width)\n\n        for (let i = 0; i < NUMBER_QUADRATICS; i++) {\n          const begin: TPointer = computeMiddlePointer(stroke.pointers[i], stroke.pointers[i + 1])\n          const end: TPointer = computeMiddlePointer(stroke.pointers[i + 1], stroke.pointers[i + 2])\n          const ctrl: TPointer = stroke.pointers[i + 1]\n          this.renderQuadratic(context2d, begin, end, ctrl, width)\n        }\n        const beginLine: TPointer = computeMiddlePointer(stroke.pointers[NUMBER_POINTS - 2], stroke.pointers[NUMBER_POINTS - 1])\n        const endLine: TPointer = stroke.pointers[NUMBER_POINTS - 1]\n        this.renderLine(context2d, beginLine, endLine, width)\n\n        const beginFinal: TPointer = stroke.pointers[NUMBER_POINTS - 2]\n        const endFinal: TPointer = stroke.pointers[NUMBER_POINTS - 1]\n        this.renderFinal(context2d, beginFinal, endFinal, width)\n      }\n      context2d.closePath()\n      if (color !== undefined) {\n        context2d.fillStyle = color\n        context2d.fill()\n      }\n      context2d.save()\n    }\n    catch (error) {\n      this.#logger.error(\"draw\", { error })\n    }\n    finally {\n      context2d.restore()\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { TSymbol, TCanvasTextSymbol, TCanvasTextUnderlineSymbol, TCanvasUnderLineSymbol, TPoint } from \"../../symbol\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRendererText\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n\n  symbols = {\n    char: \"char\",\n    string: \"string\",\n    textLine: \"textLine\"\n  }\n\n  protected drawUnderline(context2D: CanvasRenderingContext2D, textUnderline: TCanvasTextUnderlineSymbol, underline: TCanvasUnderLineSymbol)\n  {\n    this.#logger.debug(\"#drawUnderline\", { context2D, textUnderline, underline })\n    context2D.save()\n    try {\n      const delta = textUnderline.data.width / textUnderline.label.length\n      const p1: TPoint = {\n        x: textUnderline.data.topLeftPoint.x + (underline.data.firstCharacter * delta),\n        y: textUnderline.data.topLeftPoint.y + textUnderline.data.height\n      }\n      const p2: TPoint = {\n        x: textUnderline.data.topLeftPoint.x + (underline.data.lastCharacter * delta),\n        y: textUnderline.data.topLeftPoint.y + textUnderline.data.height\n      }\n      context2D.beginPath()\n      context2D.moveTo(p1.x, p1.y)\n      context2D.lineTo(p2.x, p2.y)\n      context2D.stroke()\n    } catch(error) {\n      this.#logger.error(\"#drawUnderline\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawText(context2D: CanvasRenderingContext2D, text: TCanvasTextSymbol)\n  {\n    this.#logger.debug(\"#drawText\", { context2D, text })\n    context2D.save()\n    try {\n      context2D.font = `${ text.data.textHeight }px serif`\n      context2D.textAlign = (text.data.justificationType === \"CENTER\") ? \"center\" : \"left\"\n      context2D.textBaseline = \"bottom\"\n      context2D.fillStyle = context2D.strokeStyle\n      context2D.fillText(text.label, text.data.topLeftPoint.x, (text.data.topLeftPoint.y + text.data.height))\n    } catch(error) {\n      this.#logger.error(\"#drawText\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawTextLine(context2D: CanvasRenderingContext2D, textUnderline: TCanvasTextUnderlineSymbol)\n  {\n    this.#logger.debug(\"#drawTextLine\", { context2D, textUnderline })\n    this.drawText(context2D, textUnderline)\n    textUnderline.underlineList.forEach((underline) =>\n    {\n      this.drawUnderline(context2D, textUnderline, underline)\n    })\n  }\n\n  draw(context2D: CanvasRenderingContext2D, symbol: TSymbol)\n  {\n    this.#logger.info(\"draw\", { context2D, symbol })\n    context2D.lineWidth = (symbol.style.width as number)\n    context2D.strokeStyle = (symbol.style.color as string)\n    switch (symbol.type) {\n      case this.symbols.char:\n      case this.symbols.string:\n        this.drawText(context2D, symbol as TCanvasTextSymbol)\n        break\n      case this.symbols.textLine:\n        this.drawTextLine(context2D, symbol as TCanvasTextUnderlineSymbol)\n        break\n      default:\n        this.#logger.warn(\"draw\", `${symbol.type} not implemented`)\n        break\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { Model } from \"../../model\"\nimport { Stroke, TSymbol } from \"../../symbol\"\nimport { TRendererConfiguration } from \"../RendererConfiguration\"\nimport { CanvasRendererShape } from \"./CanvasRendererShape\"\nimport { CanvasRendererStroke } from \"./CanvasRendererStroke\"\nimport { CanvasRendererText } from \"./CanvasRendererText\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRenderer\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n  configuration: Omit<TRendererConfiguration, \"guides\">\n  strokeRenderer: CanvasRendererStroke\n  shapeRenderer: CanvasRendererShape\n  textRenderer: CanvasRendererText\n  context!: {\n    parent: HTMLElement\n    renderingCanvas: HTMLCanvasElement\n    renderingCanvasContext: CanvasRenderingContext2D\n    capturingCanvas: HTMLCanvasElement\n    capturingCanvasContext: CanvasRenderingContext2D\n  }\n\n  constructor(config: Omit<TRendererConfiguration, \"guides\">)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.configuration = config\n    this.strokeRenderer = new CanvasRendererStroke()\n    this.shapeRenderer = new CanvasRendererShape()\n    this.textRenderer = new CanvasRendererText()\n  }\n\n  protected createCanvas(type: string): HTMLCanvasElement\n  {\n    this.#logger.debug(\"createCanvas\", { type })\n    const canvas: HTMLCanvasElement = document.createElement(\"canvas\")\n    canvas.id = type\n    canvas.classList.add(type)\n    canvas.classList.add(\"ms-canvas\")\n    return canvas\n  }\n\n  protected resizeContent(): void\n  {\n    const pixelRatio: number = window.devicePixelRatio\n    const elements: HTMLCanvasElement[] = [this.context.renderingCanvas, this.context.capturingCanvas]\n    elements.forEach((canvas) =>\n    {\n      const domElement = canvas.parentNode as HTMLElement\n      const width = Math.max(this.configuration.minWidth, domElement.clientWidth)\n      const height = Math.max(this.configuration.minHeight, domElement.clientHeight)\n      canvas.width = width * pixelRatio\n      canvas.height = height * pixelRatio\n      canvas.getContext(\"2d\")?.scale(pixelRatio, pixelRatio)\n      canvas.style.width = `${ width }px`\n      canvas.style.height = `${ height }px`\n    })\n  }\n\n  protected drawSymbol(context2D: CanvasRenderingContext2D, symbol: TSymbol)\n  {\n    this.#logger.debug(\"drawSymbol\", { symbol })\n    if (symbol.type === \"stroke\") {\n      const stroke = symbol as Stroke\n      if (stroke.pointerType !== \"eraser\") {\n        this.strokeRenderer.draw(context2D, stroke)\n      }\n    } else if (Object.keys(this.textRenderer.symbols).includes(symbol.type)) {\n      this.textRenderer.draw(context2D, symbol)\n    } else if (Object.keys(this.shapeRenderer.symbols).includes(symbol.type)) {\n      this.shapeRenderer.draw(context2D, symbol)\n    } else {\n      this.#logger.warn(\"drawSymbol\", `symbol type unknow: ${symbol.type}`)\n    }\n  }\n\n  init(element: HTMLElement, guide?: { x?: number, y?: number } ): void\n  {\n    this.#logger.info(\"init\", { element })\n    const renderingCanvas: HTMLCanvasElement = this.createCanvas(\"ms-rendering-canvas\")\n    renderingCanvas.setAttribute(\"data-layer\", \"MODEL\")\n    if (guide) {\n      renderingCanvas.style.backgroundSize = `${guide.x || 1}px ${guide.y || 1}px`\n    }\n    element.appendChild(renderingCanvas)\n\n    const capturingCanvas: HTMLCanvasElement = this.createCanvas(\"ms-capture-canvas\")\n    capturingCanvas.setAttribute(\"data-layer\", \"CAPTURE\")\n    element.appendChild(capturingCanvas)\n\n    this.context = {\n      parent: element,\n      renderingCanvas,\n      renderingCanvasContext: renderingCanvas.getContext(\"2d\") as CanvasRenderingContext2D,\n      capturingCanvas,\n      capturingCanvasContext: capturingCanvas.getContext(\"2d\") as CanvasRenderingContext2D\n    }\n\n    this.resizeContent()\n  }\n\n  drawModel(model: Model): void\n  {\n    this.#logger.info(\"drawModel\", { model })\n    this.context.renderingCanvasContext?.clearRect(0, 0, this.context.renderingCanvas.width, this.context.renderingCanvas.height)\n    model.symbols.forEach(symbol => this.drawSymbol(this.context.renderingCanvasContext, symbol))\n    this.context.capturingCanvasContext.clearRect(0, 0, this.context.capturingCanvas.width, this.context.capturingCanvas.height)\n  }\n\n  drawPendingStroke(stroke: Stroke | undefined): void\n  {\n    this.#logger.info(\"drawPendingStroke\", { stroke })\n    this.context.capturingCanvasContext.clearRect(0, 0, this.context.capturingCanvas.width, this.context.capturingCanvas.height)\n    if (stroke && stroke?.pointerType !== \"eraser\") {\n      this.strokeRenderer.draw(this.context.capturingCanvasContext, stroke)\n    }\n  }\n\n  resize(model: Model): void\n  {\n    this.#logger.info(\"resize\", { model })\n    this.resizeContent()\n    this.drawModel(model)\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\")\n    if (this.context.parent) {\n      this.context.parent.innerHTML = \"\"\n    }\n  }\n}\n","\n/**\n * @group Renderer\n */\nexport const SVGRendererConst =\n{\n  arrowHeadStartMarker: \"arrow-head-start\",\n  arrowHeadEndMaker: \"arrow-head-end\",\n  selectionFilterId: \"selection-filter\",\n  removalFilterId: \"removal-filter\",\n  crossMarker: \"cross-marker\",\n  noSelection: \"pointer-events: none; -webkit-touch-callout: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;\",\n}","import { TBox, TPoint } from \"../../symbol\"\n\nconst XMLNS = \"http://www.w3.org/2000/svg\"\n/**\n * @group Renderer\n */\nexport class SVGBuilder\n{\n  static createLayer(boundingBox: TBox, attrs: { [key: string]: string } = {}): SVGSVGElement\n  {\n    const svgEl = document.createElementNS(XMLNS, \"svg\")\n    svgEl.setAttribute(\"width\", `${ boundingBox.width }px`)\n    svgEl.setAttribute(\"height\", `${ boundingBox.height }px`)\n    svgEl.setAttribute(\"viewBox\", `${boundingBox.x}, ${boundingBox.y}, ${boundingBox. width }, ${ boundingBox.height }`)\n    for (const k in attrs) {\n      svgEl.setAttribute(k, attrs[k])\n    }\n    return svgEl\n  }\n\n  static createFilter(id: string, attrs: { [key: string]: string } = {}): SVGFilterElement\n  {\n    const filter = document.createElementNS(XMLNS, \"filter\")\n    filter.id = id\n    for (const k in attrs) {\n      filter.setAttribute(k, attrs[k])\n    }\n    return filter\n  }\n\n  static createDefs(): SVGDefsElement\n  {\n    return document.createElementNS(XMLNS, \"defs\")\n  }\n\n  static createMarker(id: string, attrs: { [key: string]: string } = {}): SVGMarkerElement\n  {\n    const marker = document.createElementNS(XMLNS, \"marker\")\n    marker.setAttribute(\"id\", id)\n    for (const k in attrs) {\n      marker.setAttribute(k, attrs[k])\n    }\n    return marker\n  }\n\n  static createComponentTransfert(): SVGFEComponentTransferElement\n  {\n    return document.createElementNS(XMLNS, \"feComponentTransfer\")\n  }\n\n  static createDropShadow({ dx = 0, dy = 0, deviation = 0, color = \"#3e68ff\", opacity = 1 }): SVGFEDropShadowElement\n  {\n    const shadow = document.createElementNS(XMLNS, \"feDropShadow\")\n    shadow.setAttribute(\"dx\", dx.toString())\n    shadow.setAttribute(\"dy\", dy.toString())\n    shadow.setAttribute(\"stdDeviation\", deviation.toString())\n    shadow.setAttribute(\"flood-color\", color)\n    shadow.setAttribute(\"flood-opacity\", opacity.toString())\n    return shadow\n  }\n\n  static createTransfertFunctionTable(type: \"feFuncA\" | \"feFuncB\" | \"feFuncG\" | \"feFuncR\", values: string): SVGFEFuncAElement\n  {\n    const feFunc = document.createElementNS(XMLNS, type)\n    feFunc.setAttribute(\"type\", \"table\")\n    feFunc.setAttribute(\"tableValues\", values)\n    return feFunc\n  }\n\n  static createGroup(attrs: { [key: string]: string } = {}): SVGGElement\n  {\n    const groupEl = document.createElementNS(XMLNS, \"g\")\n    for (const k in attrs) {\n      groupEl.setAttribute(k, attrs[k])\n    }\n    return groupEl\n  }\n\n  static createLine(p1: TPoint, p2: TPoint, attrs: { [key: string]: string } = {}): SVGLineElement\n  {\n    const lineEl = document.createElementNS(XMLNS, \"line\")\n    lineEl.setAttribute(\"x1\", p1.x.toString())\n    lineEl.setAttribute(\"y1\", p1.y.toString())\n    lineEl.setAttribute(\"x2\", p2.x.toString())\n    lineEl.setAttribute(\"y2\", p2.y.toString())\n    for (const k in attrs) {\n      lineEl.setAttribute(k, attrs[k])\n    }\n    return lineEl\n  }\n\n  static createCircle(p: TPoint, r: number, attrs: { [key: string]: string } = {}): SVGCircleElement\n  {\n    const circleEl = document.createElementNS(XMLNS, \"circle\")\n    circleEl.setAttribute(\"cx\", p.x.toString())\n    circleEl.setAttribute(\"cy\", p.y.toString())\n    circleEl.setAttribute(\"r\", r.toString())\n    for (const k in attrs) {\n      circleEl.setAttribute(k, attrs[k])\n    }\n    return circleEl\n  }\n\n  static createPath(attrs: { [key: string]: string } = {}): SVGPathElement\n  {\n    const pathEl = document.createElementNS(XMLNS, \"path\")\n    for (const k in attrs) {\n      pathEl.setAttribute(k, attrs[k])\n    }\n    return pathEl\n  }\n\n  static createPolygon(points: number[], attrs: { [key: string]: string } = {}): SVGPolylineElement\n  {\n    const polygonEl = document.createElementNS(XMLNS, \"polygon\")\n    polygonEl.setAttribute(\"points\", points.join(\",\"))\n    for (const k in attrs) {\n      polygonEl.setAttribute(k, attrs[k])\n    }\n    return polygonEl\n  }\n\n  static createRect(box: TBox, attrs: { [key: string]: string } = {}): SVGRectElement\n  {\n    const rectEl = document.createElementNS(XMLNS, \"rect\")\n    rectEl.setAttribute(\"x\", box.x.toString())\n    rectEl.setAttribute(\"y\", box.y.toString())\n    rectEl.setAttribute(\"width\", box.width.toString())\n    rectEl.setAttribute(\"height\", box.height.toString())\n    for (const k in attrs) {\n      rectEl.setAttribute(k, attrs[k])\n    }\n    return rectEl\n  }\n\n  static createTSpan(text: string, attrs: { [key: string]: string } = {}): SVGTSpanElement\n  {\n    const tSpanEl = document.createElementNS(XMLNS, \"tspan\")\n    tSpanEl.textContent = text\n    for (const k in attrs) {\n      tSpanEl.setAttribute(k, attrs[k])\n    }\n    return tSpanEl\n  }\n\n  static createForeignObject(box: TBox, node: HTMLElement, attrs: { [key: string]: string } = {}): SVGForeignObjectElement\n  {\n    const objEl = document.createElementNS(XMLNS, \"foreignObject\")\n    objEl.setAttribute(\"x\", box.x.toString())\n    objEl.setAttribute(\"y\", box.y.toString())\n    objEl.setAttribute(\"width\", box.width.toString())\n    objEl.setAttribute(\"height\", box.height.toString())\n    for (const k in attrs) {\n      objEl.setAttribute(k, attrs[k])\n    }\n    objEl.appendChild(node)\n    return objEl\n  }\n\n  static createText(p: TPoint, text: string, attrs: { [key: string]: string } = {}): SVGTextElement\n  {\n    const textEl = document.createElementNS(XMLNS, \"text\")\n    textEl.textContent = text\n    textEl.setAttribute(\"x\", p.x.toString())\n    textEl.setAttribute(\"y\", p.y.toString())\n    for (const k in attrs) {\n      textEl.setAttribute(k, attrs[k])\n    }\n    return textEl\n  }\n}\n","import { EdgeDecoration, EdgeKind, IIEdgeArc, IIEdgeLine, IIEdgePolyLine, TIIEdge } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { SVGRendererConst } from \"./SVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererEdgeUtil\n{\n  static getLinePath(line: IIEdgeLine): string\n  {\n    return `M ${ line.start.x } ${ line.start.y } L ${ line.end.x } ${ line.end.y }`\n  }\n\n  static getPolyLinePath(line: IIEdgePolyLine): string\n  {\n    let path = `M ${ line.vertices[0].x } ${ line.vertices[0].y }`\n    for (let i = 0; i < line.vertices.length; i++) {\n      path += ` L ${ line.vertices[i].x } ${ line.vertices[i].y }`\n    }\n    return path\n  }\n\n  static getArcPath(arc: IIEdgeArc): string\n  {\n    let path = `M ${ arc.vertices[0].x } ${ arc.vertices[0].y } Q`\n    for (let i = 0; i < arc.vertices.length; i++) {\n      path += ` ${ arc.vertices[i].x } ${ arc.vertices[i].y }`\n    }\n    return path\n  }\n\n  static getSVGPath(edge: TIIEdge): string\n  {\n    switch (edge.kind) {\n      case EdgeKind.Line:\n        return SVGRendererEdgeUtil.getLinePath(edge)\n      case EdgeKind.PolyEdge:\n        return SVGRendererEdgeUtil.getPolyLinePath(edge)\n      case EdgeKind.Arc:\n        return SVGRendererEdgeUtil.getArcPath(edge)\n      default:\n        throw new Error(`Can't getSVGPath for edge cause kind is unknow: \"${ JSON.stringify(edge) }\"`)\n    }\n  }\n\n  static getSVGElement(edge: TIIEdge): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": edge.id,\n      \"type\": edge.type,\n      \"kind\": edge.kind,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    if (edge.selected) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.selectionFilterId })`\n    }\n    if (edge.deleting) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.removalFilterId })`\n    }\n    const group = SVGBuilder.createGroup(attrs)\n\n    const pathAttrs: { [key: string]: string } = {\n      \"fill\": \"transparent\",\n      \"stroke\": edge.style.color || DefaultStyle.color!,\n      \"stroke-width\": (edge.style.width || DefaultStyle.width).toString(),\n      \"d\": SVGRendererEdgeUtil.getSVGPath(edge),\n    }\n    if (edge.style.opacity) {\n      pathAttrs[\"opacity\"] = edge.style.opacity.toString()\n    }\n\n    if (edge.startDecoration === EdgeDecoration.Arrow) {\n      pathAttrs[\"marker-start\"] = `url(#${ SVGRendererConst.arrowHeadStartMarker })`\n    }\n    if (edge.endDecoration === EdgeDecoration.Arrow) {\n      pathAttrs[\"marker-end\"] = `url(#${ SVGRendererConst.arrowHeadEndMaker })`\n    }\n    group.appendChild(SVGBuilder.createPath(pathAttrs))\n    return group\n  }\n\n\n}\n","import { IIEraser, TPointer } from \"../../symbol\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererEraserUtil\n{\n  static getSVGPath(eraser: IIEraser): string\n  {\n    if (eraser.pointers.length < 1) return \"\"\n\n    const firstPoint = eraser.pointers.at(0) as TPointer\n\n    const startPath = `M ${ firstPoint.x } ${ firstPoint.y }`\n\n    if (eraser.pointers.length === 1) {\n      const strokeWith = eraser.style.width || 4\n      return `${startPath} L ${ firstPoint.x  + strokeWith / 2 } ${ firstPoint.y }`\n    }\n\n    const middlePoints = eraser.pointers.slice(1)\n\n    return middlePoints.reduce((acc, point) => {\n      return `${ acc } L ${ point.x } ${ point.y }`\n    }, startPath)\n  }\n\n  static getSVGElement(eraser: IIEraser): SVGPathElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": eraser.id,\n      \"type\": \"eraser\",\n      \"stroke-width\": \"12\",\n      \"stroke\": \"grey\",\n      \"opacity\": \"0.2\",\n      \"shadowBlur\": \"5\",\n      \"stroke-linecap\": \"round\",\n      \"fill\": \"transparent\",\n      \"d\": SVGRendererEraserUtil.getSVGPath(eraser)\n    }\n    return SVGBuilder.createPath(attrs)\n  }\n\n}","import { DecoratorKind, IIDecorator, RecognizedKind, SymbolType, TBox, TIISymbol } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererDecoratorUtil\n{\n  static getSVGElement(decorator: IIDecorator, symbol: TIISymbol): SVGGeometryElement | undefined\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": decorator.id,\n      \"type\": \"decorator\",\n      \"kind\": decorator.kind,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    if (decorator.style.opacity) {\n      attrs[\"opacity\"] = decorator.style.opacity.toString()\n    }\n    if (symbol.deleting) {\n      attrs[\"opacity\"] = ((decorator.style.opacity || 1) * 0.5).toString()\n    }\n\n    let element: SVGGeometryElement | undefined\n\n    switch (decorator.kind) {\n      case DecoratorKind.Highlight: {\n        attrs[\"opacity\"] = symbol.deleting ? \"0.25\" : \"0.5\"\n        attrs[\"stroke\"] = \"transparent\"\n        attrs[\"fill\"] = decorator.style.color || DefaultStyle.color!\n        const boundingBox: TBox = {\n          x: symbol.bounds.x - +(symbol.style.width || DefaultStyle.width),\n          y: symbol.bounds.y - +(symbol.style.width || DefaultStyle.width),\n          height: symbol.bounds.height + +(symbol.style.width || DefaultStyle.width) * 2,\n          width: symbol.bounds.width + +(symbol.style.width || DefaultStyle.width) * 2,\n        }\n        element = SVGBuilder.createRect(boundingBox, attrs)\n        break\n      }\n      case DecoratorKind.Surround: {\n        attrs[\"fill\"] = \"transparent\"\n        attrs[\"stroke\"] = decorator.style.color || DefaultStyle.color!\n        attrs[\"stroke-width\"] = (decorator.style.width || DefaultStyle.width).toString()\n        const boundingBox: TBox = {\n          x: symbol.bounds.x - +(symbol.style.width || DefaultStyle.width),\n          y: symbol.bounds.y - +(symbol.style.width || DefaultStyle.width),\n          height: symbol.bounds.height + +(symbol.style.width || DefaultStyle.width) * 2,\n          width: symbol.bounds.width + +(symbol.style.width || DefaultStyle.width) * 2,\n        }\n        element = SVGBuilder.createRect(boundingBox, attrs)\n        break\n      }\n      case DecoratorKind.Strikethrough: {\n        attrs[\"fill\"] = \"transparent\"\n        attrs[\"stroke\"] = decorator.style.color || DefaultStyle.color!\n        attrs[\"stroke-width\"] = (decorator.style.width || DefaultStyle.width).toString()\n        const p1 = {\n          x: symbol.bounds.xMin,\n          y: symbol.bounds.yMid\n        }\n        const p2 = {\n          x: symbol.bounds.xMax,\n          y: symbol.bounds.yMid\n        }\n        if (symbol.type === SymbolType.Recognized && symbol.kind === RecognizedKind.Text) {\n          p1.y = symbol.baseline - symbol.xHeight / 2\n          p2.y = symbol.baseline - symbol.xHeight / 2\n        }\n        element = SVGBuilder.createLine(p1, p2, attrs)\n        break\n      }\n      case DecoratorKind.Underline: {\n        attrs[\"fill\"] = \"transparent\"\n        attrs[\"stroke\"] = decorator.style.color || DefaultStyle.color!\n        attrs[\"stroke-width\"] = (decorator.style.width || DefaultStyle.width).toString()\n        const p1 = {\n          x: symbol.bounds.xMin,\n          y: symbol.bounds.yMax + +(symbol.style.width || DefaultStyle.width)\n        }\n        const p2 = {\n          x: symbol.bounds.xMax,\n          y: symbol.bounds.yMax + +(symbol.style.width || DefaultStyle.width)\n        }\n        if (symbol.type === SymbolType.Recognized && symbol.kind === RecognizedKind.Text) {\n          p1.y = symbol.baseline + symbol.xHeight / 2\n          p2.y = symbol.baseline + symbol.xHeight / 2\n        }\n        element = SVGBuilder.createLine(p1, p2, attrs)\n        break\n      }\n    }\n\n    return element\n  }\n}","import { IIShapeCircle, IIShapeEllipse, IIShapePolygon, ShapeKind, TIIShape } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { convertRadianToDegree } from \"../../utils\"\nimport { SVGRendererConst } from \"./SVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererShapeUtil\n{\n  static getPolygonePath(polygon: IIShapePolygon): string\n  {\n    let path = `M ${polygon.points[0].x} ${polygon.points[0].y}`\n    for (let i = 1; i < polygon.points.length; i++) {\n      path += ` L ${polygon.points[i].x} ${polygon.points[i].y}`\n    }\n    return path + \" Z\"\n  }\n\n  static getCirclePath(circle: IIShapeCircle): string\n  {\n    return `M ${circle.center.x - circle.radius} ${circle.center.y} a ${circle.radius} ${circle.radius} 0 1 1 ${circle.radius * 2} 0 a ${circle.radius} ${circle.radius} 0 1 1 -${circle.radius * 2} 0 Z`\n  }\n\n  static getEllipsePath(ellipse: IIShapeEllipse): string\n  {\n    return `M ${ellipse.center.x - ellipse.radiusX} ${ellipse.center.y} a ${ellipse.radiusX} ${ellipse.radiusY} 0 1 1 ${ellipse.radiusX * 2} 0 a ${ellipse.radiusX} ${ellipse.radiusY} 0 1 1 -${ellipse.radiusX * 2} 0 Z`\n  }\n\n  static getSVGPath(shape: TIIShape): string\n  {\n    switch(shape.kind) {\n      case ShapeKind.Polygon:\n        return SVGRendererShapeUtil.getPolygonePath(shape as IIShapePolygon)\n      case ShapeKind.Circle:\n        return SVGRendererShapeUtil.getCirclePath(shape as IIShapeCircle)\n      case ShapeKind.Ellipse:\n        return SVGRendererShapeUtil.getEllipsePath(shape as IIShapeEllipse)\n      default:\n        throw new Error(`Can't getSVGPath for shape cause kind is unknow: \"${ JSON.stringify(shape) }\"`)\n    }\n  }\n\n  static getSVGElement(shape: TIIShape): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": shape.id,\n      \"type\": shape.type,\n      \"kind\": shape.kind,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    if (shape.selected) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.selectionFilterId })`\n    }\n    if (shape.deleting) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.removalFilterId })`\n    }\n\n    const group = SVGBuilder.createGroup(attrs)\n\n    const pathAttrs: { [key: string]: string } = {\n      \"fill\": shape.style.fill || \"transparent\",\n      \"stroke\": shape.style.color || DefaultStyle.color!,\n      \"stroke-width\": (shape.style.width || DefaultStyle.width).toString(),\n      \"d\": SVGRendererShapeUtil.getSVGPath(shape),\n    }\n    if (shape.style.opacity) {\n      pathAttrs[\"opacity\"] = shape.style.opacity.toString()\n    }\n    if (shape.kind === ShapeKind.Ellipse) {\n      pathAttrs.transform = `rotate(${ convertRadianToDegree(shape.orientation) }, ${shape.center.x}, ${shape.center.y})`\n    }\n\n    group.appendChild(SVGBuilder.createPath(pathAttrs))\n\n    return group\n  }\n}\n","import { DecoratorKind, IIStroke, TPointer } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { computeAngleAxeRadian, computeLinksPointers, computeMiddlePointer } from \"../../utils\"\nimport { SVGRendererDecoratorUtil } from \"./SVGRendererDecoratorUtil\"\nimport { SVGRendererConst } from \"./SVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererStrokeUtil\n{\n\n  protected static getArcPath(center: TPointer, radius: number): string\n  {\n    const svgPath = [\n      `M ${ center.x } ${ center.y }`,\n      `m ${ -radius } 0`,\n      `a ${ radius } ${ radius } 0 1 0 ${ radius * 2 } 0`,\n      `a ${ radius } ${ radius } 0 1 0 ${ -(radius * 2) } 0`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected static getLinePath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, end), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x } ${ linkPoints1[0].y }`,\n      `L ${ linkPoints2[0].x } ${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x } ${ linkPoints2[1].y }`,\n      `L ${ linkPoints1[1].x } ${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected static getFinalPath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const ARCSPLIT = 6\n    const angle = computeAngleAxeRadian(begin, end)\n    const linkPoints = computeLinksPointers(end, angle, width)\n    const parts = [`M ${ linkPoints[0].x } ${ linkPoints[0].y }`]\n    for (let i = 1; i <= ARCSPLIT; i++) {\n      const newAngle = angle - (i * (Math.PI / ARCSPLIT))\n      const x = +(end.x - (end.p * width * Math.sin(newAngle))).toFixed(3)\n      const y = +(end.y + (end.p * width * Math.cos(newAngle))).toFixed(3)\n      parts.push(`L ${ x } ${ y }`)\n    }\n    const svgPath = parts.join(\" \")\n    return svgPath\n  }\n\n  protected static getQuadraticPath(begin: TPointer, end: TPointer, central: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, central), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(central, end), width)\n    const linkPoints3 = computeLinksPointers(central, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x } ${ linkPoints1[0].y }`,\n      `Q ${ linkPoints3[0].x } ${ linkPoints3[0].y } ${ linkPoints2[0].x } ${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x } ${ linkPoints2[1].y }`,\n      `Q ${ linkPoints3[1].x } ${ linkPoints3[1].y } ${ linkPoints1[1].x } ${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  static getSVGPath(stroke: IIStroke): string\n  {\n    const STROKE_LENGTH = stroke.pointers.length\n    if (!STROKE_LENGTH) return \"\"\n    const STROKE_WIDTH = (stroke.style.width as number)\n    const NB_QUADRATICS = STROKE_LENGTH - 2\n    const firstPoint = stroke.pointers[0]\n\n    const parts = []\n    if (STROKE_LENGTH < 3) {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * 0.6))\n    } else {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * firstPoint.p))\n      parts.push(this.getLinePath(firstPoint, computeMiddlePointer(firstPoint, stroke.pointers[1]), STROKE_WIDTH))\n\n      for (let i = 0; i < NB_QUADRATICS; i++) {\n        const begin = computeMiddlePointer(stroke.pointers[i], stroke.pointers[i + 1])\n        const end = computeMiddlePointer(stroke.pointers[i + 1], stroke.pointers[i + 2])\n        const central = stroke.pointers[i + 1]\n        parts.push(this.getQuadraticPath(begin, end, central, STROKE_WIDTH)\n        )\n      }\n      const beforeLastPoint = stroke.pointers[STROKE_LENGTH - 2]\n      const lastPoint = stroke.pointers[STROKE_LENGTH - 1]\n      parts.push(this.getLinePath(computeMiddlePointer(beforeLastPoint, lastPoint), lastPoint, STROKE_WIDTH))\n      parts.push(this.getFinalPath(beforeLastPoint, lastPoint, STROKE_WIDTH))\n    }\n    return parts.join(\" \")\n  }\n\n  static getSVGElement(stroke: IIStroke): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": stroke.id,\n      \"type\": \"stroke\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    if (stroke.selected) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.selectionFilterId })`\n    }\n    if (stroke.deleting) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.removalFilterId })`\n    }\n\n    const strokeGroup = SVGBuilder.createGroup(attrs)\n\n    const strokeAttrs: { [key: string]: string } = {\n      \"fill\": stroke.style.color || DefaultStyle.color!,\n      \"stroke-width\": stroke.style.width.toString(),\n      \"d\": SVGRendererStrokeUtil.getSVGPath(stroke)\n    }\n    if (stroke.style.opacity) {\n      strokeAttrs.opacity = stroke.style.opacity.toString()\n    }\n    strokeGroup.append(SVGBuilder.createPath(strokeAttrs))\n\n    stroke.decorators.forEach(d =>\n    {\n      const deco = SVGRendererDecoratorUtil.getSVGElement(d, stroke)\n      if (deco) {\n        if (d.kind === DecoratorKind.Highlight) {\n          strokeGroup.prepend(deco)\n        }\n        else {\n          strokeGroup.append(deco)\n        }\n      }\n    })\n\n    return strokeGroup\n  }\n\n}","import { DecoratorKind, IIText } from \"../../symbol\"\nimport { SVGRendererDecoratorUtil } from \"./SVGRendererDecoratorUtil\"\nimport { SVGRendererConst } from \"./SVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererTextUtil\n{\n  static getSVGElement(text: IIText): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": text.id,\n      \"type\": text.type,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n      \"style\": SVGRendererConst.noSelection,\n    }\n    if (text.style.opacity) {\n      attrs.opacity = text.style.opacity.toString()\n    }\n    if (text.rotation) {\n      attrs.transform = `rotate(${ text.rotation.degree }, ${ text.rotation.center.x }, ${ text.rotation.center.y })`\n    }\n    if (text.selected) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.selectionFilterId })`\n    }\n    if (text.deleting) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.removalFilterId })`\n    }\n\n    const textGroup = SVGBuilder.createGroup(attrs)\n\n    const textElement = SVGBuilder.createText(text.point, \"\")\n\n    text.chars.forEach(c =>\n    {\n      const attrs: { [key: string]: string } = {\n        id: c.id,\n        fill: c.color,\n        \"font-size\": `${ c.fontSize }px`,\n        \"font-weight\": c.fontWeight.toString(),\n      }\n      textElement.appendChild(SVGBuilder.createTSpan(c.label, attrs))\n    })\n    textGroup.append(textElement)\n\n    text.decorators.forEach(d =>\n    {\n      const deco = SVGRendererDecoratorUtil.getSVGElement(d, text)\n      if (deco) {\n        if (d.kind === DecoratorKind.Highlight) {\n          textGroup.prepend(deco)\n        }\n        else {\n          textGroup.append(deco)\n        }\n      }\n    })\n\n    return textGroup\n  }\n}","import { DecoratorKind, RecognizedKind, TIIRecognized } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { SVGRendererDecoratorUtil } from \"./SVGRendererDecoratorUtil\"\nimport { SVGRendererStrokeUtil } from \"./SVGRendererStrokeUtil\"\nimport { SVGRendererConst } from \"./SVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererRecognizedUtil\n{\n  static getSVGElement(recognizedSymbol: TIIRecognized): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": recognizedSymbol.id,\n      \"type\": recognizedSymbol.type,\n      \"kind\": recognizedSymbol.kind,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n      \"fill\": recognizedSymbol.style.color || DefaultStyle.color,\n      \"stroke-width\": (recognizedSymbol.style.width || DefaultStyle.width).toString(),\n    }\n    if (recognizedSymbol.style.opacity) {\n      attrs[\"opacity\"] = recognizedSymbol.style.opacity.toString()\n    }\n    if (recognizedSymbol.selected) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.selectionFilterId })`\n    }\n    if (recognizedSymbol.deleting) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.removalFilterId })`\n    }\n\n    const groupEl = SVGBuilder.createGroup(attrs)\n\n    recognizedSymbol.strokes.forEach(s =>\n    {\n      groupEl.append(SVGRendererStrokeUtil.getSVGElement(s))\n    })\n\n    if (recognizedSymbol.kind === RecognizedKind.Text) {\n      recognizedSymbol.decorators.forEach(d =>\n      {\n        const deco = SVGRendererDecoratorUtil.getSVGElement(d, recognizedSymbol)\n        if (deco) {\n          if (d.kind === DecoratorKind.Highlight) {\n            groupEl.prepend(deco)\n          }\n          else {\n            groupEl.append(deco)\n          }\n        }\n      })\n    }\n\n    return groupEl\n  }\n\n}","import { DecoratorKind, IIEraser, IISymbolGroup, SymbolType, TIISymbol } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { SVGRendererDecoratorUtil } from \"./SVGRendererDecoratorUtil\"\nimport { SVGRendererEdgeUtil } from \"./SVGRendererEdgeUtil\"\nimport { SVGRendererShapeUtil } from \"./SVGRendererShapeUtil\"\nimport { SVGRendererStrokeUtil } from \"./SVGRendererStrokeUtil\"\nimport { SVGRendererConst } from \"./SVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\nimport { SVGRendererTextUtil } from \"./SVGRendererTextUtil\"\nimport { SVGRendererRecognizedUtil } from \"./SVGRendererRecognizedUtil\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererGroupUtil\n{\n\n  static getChildElement(symbol: TIISymbol | IIEraser): SVGGraphicsElement | undefined\n  {\n    let element: SVGGraphicsElement | undefined\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        element = SVGRendererStrokeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Shape:\n        element = SVGRendererShapeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Edge:\n        element = SVGRendererEdgeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Text:\n        element = SVGRendererTextUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Group:\n        element = SVGRendererGroupUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Recognized:\n        element = SVGRendererRecognizedUtil.getSVGElement(symbol)\n        break\n    }\n    return element\n  }\n\n  static getSVGElement(symbolGroup: IISymbolGroup): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": symbolGroup.id,\n      \"type\": \"group\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n      \"fill\": symbolGroup.style.color || DefaultStyle.color!,\n      \"stroke-width\": (symbolGroup.style.width || DefaultStyle.width).toString(),\n    }\n    if (symbolGroup.style.opacity) {\n      attrs[\"opacity\"] = symbolGroup.style.opacity.toString()\n    }\n    if (symbolGroup.selected) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.selectionFilterId })`\n    }\n    if (symbolGroup.deleting) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.removalFilterId })`\n    }\n\n    const groupEl = SVGBuilder.createGroup(attrs)\n\n    symbolGroup.children.forEach(sym =>\n    {\n      groupEl.append(SVGRendererGroupUtil.getChildElement(sym)!)\n    })\n\n    symbolGroup.decorators.forEach(d =>\n    {\n      const deco = SVGRendererDecoratorUtil.getSVGElement(d, symbolGroup)\n      if (deco) {\n        if (d.kind === DecoratorKind.Highlight) {\n          groupEl.prepend(deco)\n        }\n        else {\n          groupEl.append(deco)\n        }\n      }\n    })\n\n    return groupEl\n  }\n\n}","import { SvgElementRole } from \"../../Constants\"\nimport { getClosestPoints } from \"../../utils\"\nimport { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { TIISymbol, TPoint, TBox, Box, IIEraser, SymbolType } from \"../../symbol\"\nimport { TIIRendererConfiguration } from \"../RendererConfiguration\"\nimport { SVGRendererConst } from \"./SVGRendererConst\"\nimport { SVGRendererEdgeUtil } from \"./SVGRendererEdgeUtil\"\nimport { SVGRendererEraserUtil } from \"./SVGRendererEraserUtil\"\nimport { SVGRendererGroupUtil } from \"./SVGRendererGroupUtil\"\nimport { SVGRendererShapeUtil } from \"./SVGRendererShapeUtil\"\nimport { SVGRendererStrokeUtil } from \"./SVGRendererStrokeUtil\"\nimport { SVGRendererTextUtil } from \"./SVGRendererTextUtil\"\nimport { SVGRendererRecognizedUtil } from \"./SVGRendererRecognizedUtil\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRenderer {\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n  groupGuidesId = \"guides-wrapper\"\n\n  configuration: TIIRendererConfiguration\n  parent!: HTMLElement\n  layer!: SVGSVGElement\n  definitionGroup!: SVGGElement\n\n  verticalGuides: number[] = []\n  horizontalGuides: number[] = []\n\n  constructor(configuration: TIIRendererConfiguration) {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n  }\n\n  protected initLayer(): void {\n    const width = Math.max(this.configuration.minWidth, this.parent.clientWidth)\n    const height = Math.max(this.configuration.minHeight, this.parent.clientHeight)\n    this.layer = SVGBuilder.createLayer({ x: 0, y: 0, width, height })\n    this.layer.style.setProperty(\"height\", \"auto\")\n    this.layer.style.setProperty(\"width\", \"auto\")\n    this.layer.appendChild(this.createSVGTools())\n    this.parent.style.setProperty(\"overflow\", \"auto\")\n    this.parent.appendChild(this.layer)\n  }\n\n  protected createDefs(): SVGDefsElement {\n    const defs = SVGBuilder.createDefs()\n\n    const SIZE = 5\n    const REFX = SIZE - 1, REFY = SIZE / 2\n    const arrowHeadMarkerAttrs = {\n      style: SVGRendererConst.noSelection,\n      fill: \"context-stroke\",\n      markerWidth: SIZE.toString(),\n      markerHeight: SIZE.toString(),\n      refX: REFX.toString(),\n      refY: REFY.toString(),\n    }\n\n    const arrowHeadStart = SVGBuilder.createMarker(SVGRendererConst.arrowHeadStartMarker, { ...arrowHeadMarkerAttrs, orient: \"auto-start-reverse\" })\n    arrowHeadStart.appendChild(SVGBuilder.createPolygon([0, 0, SIZE, REFY, 0, SIZE], arrowHeadMarkerAttrs))\n    defs.appendChild(arrowHeadStart)\n\n    const arrowHeadEnd = SVGBuilder.createMarker(SVGRendererConst.arrowHeadEndMaker, { ...arrowHeadMarkerAttrs, orient: \"auto\" })\n    arrowHeadEnd.appendChild(SVGBuilder.createPolygon([0, 0, SIZE, REFY, 0, SIZE], arrowHeadMarkerAttrs))\n    defs.appendChild(arrowHeadEnd)\n\n    const crossMarkerAttrs = {\n      style: SVGRendererConst.noSelection,\n      markerWidth: \"5\",\n      markerHeight: \"5\",\n      refX: \"0\",\n      refY: \"0\",\n      viewBox: \"-5 -5 10 10\"\n    }\n    const cross = SVGBuilder.createMarker(SVGRendererConst.crossMarker, crossMarkerAttrs)\n    cross.appendChild(SVGBuilder.createPath({ d: \"M -4,-4 L 4,4 M -4,4 L 4,-4\", stroke: \"white\", \"stroke-width\": \"3\" }))\n    cross.appendChild(SVGBuilder.createPath({ d: \"M -4,-4 L 4,4 M -4,4 L 4,-4\", stroke: \"context-stroke\", \"stroke-width\": \"2\" }))\n    defs.appendChild(cross)\n\n    return defs\n  }\n\n  protected createFilters(): SVGGElement {\n    const filtersGroup = SVGBuilder.createGroup({ id: \"definition-group\" })\n    const removalFilter = SVGBuilder.createFilter(SVGRendererConst.removalFilterId, { filterUnits: \"userSpaceOnUse\" })\n    const bfeComponentTransfer = SVGBuilder.createComponentTransfert()\n    const bfeFuncA = SVGBuilder.createTransfertFunctionTable(\"feFuncA\", \"0 0.25\")\n    bfeComponentTransfer.appendChild(bfeFuncA)\n    removalFilter.appendChild(bfeComponentTransfer)\n    filtersGroup.appendChild(removalFilter)\n\n    const selectionFilter = SVGBuilder.createFilter(SVGRendererConst.selectionFilterId, { filterUnits: \"userSpaceOnUse\" })\n    selectionFilter.appendChild(SVGBuilder.createDropShadow({ dx: -1, dy: -1, deviation: 1 }))\n    filtersGroup.appendChild(selectionFilter)\n\n    return filtersGroup\n  }\n\n  protected drawGuides(): void {\n    this.verticalGuides = []\n    this.horizontalGuides = []\n    const height = Number(this.layer.getAttribute(\"height\")?.replace(\"px\", \"\"))\n    const width = Number(this.layer.getAttribute(\"width\")?.replace(\"px\", \"\"))\n    const offSet = this.configuration.guides.gap\n    const subOffSet = this.configuration.guides.gap / 5\n    const attrs = {\n      id: this.groupGuidesId,\n      stroke: \"grey\",\n      opacity: \"0.5\",\n      style: SVGRendererConst.noSelection,\n      role: SvgElementRole.Guide\n    }\n    const guidesGroup = SVGBuilder.createGroup(attrs)\n    switch (this.configuration.guides.type) {\n      case \"line\":\n        for (let y = offSet; y < height; y += offSet) {\n          const begin: TPoint = { x: offSet, y }\n          const end: TPoint = { x: width - offSet, y }\n          this.horizontalGuides.push(y)\n          const svgLine = SVGBuilder.createLine(begin, end, { \"stroke-width\": \"1\", style: SVGRendererConst.noSelection })\n          guidesGroup.appendChild(svgLine)\n        }\n        break\n      case \"grid\":\n        for (let y = 0; y < height; y += offSet) {\n          const begin: TPoint = { x: 0, y }\n          const end: TPoint = { x: width, y }\n          const svgLine = SVGBuilder.createLine(begin, end, { \"stroke-width\": \"1\", style: SVGRendererConst.noSelection })\n          guidesGroup.appendChild(svgLine)\n          this.horizontalGuides.push(y)\n          for (let subY = y + subOffSet; subY < y + offSet; subY += subOffSet) {\n            this.horizontalGuides.push(subY)\n            const svgLine = SVGBuilder.createLine({ x: 0, y: subY }, { x: width, y: subY }, { \"stroke-width\": \"0.25\", style: SVGRendererConst.noSelection })\n            guidesGroup.appendChild(svgLine)\n          }\n        }\n        for (let x = 0; x < width; x += offSet) {\n          const begin: TPoint = { x, y: 0 }\n          const end: TPoint = { x, y: height }\n          const svgLine = SVGBuilder.createLine(begin, end, { \"stroke-width\": \"1\", style: SVGRendererConst.noSelection })\n          guidesGroup.appendChild(svgLine)\n          this.verticalGuides.push(x)\n          for (let subX = x + subOffSet; subX < x + offSet; subX += subOffSet) {\n            this.verticalGuides.push(subX)\n            const svgLine = SVGBuilder.createLine({ x: subX, y: 0 }, { x: subX, y: height }, { \"stroke-width\": \"0.25\", style: SVGRendererConst.noSelection })\n            guidesGroup.appendChild(svgLine)\n          }\n        }\n        break\n      case \"point\":\n        for (let x = offSet; x < width; x += offSet) {\n          this.verticalGuides.push(x)\n          for (let y = offSet; y < height; y += offSet) {\n            this.horizontalGuides.push(y)\n            const svgPoint = SVGBuilder.createCircle({ x, y }, 1)\n            guidesGroup.appendChild(svgPoint)\n          }\n        }\n        break\n      default:\n        this.#logger.error(\"drawGuides\", `Guide type unknown: ${this.configuration.guides.type}`)\n        break\n    }\n    this.horizontalGuides = [...new Set(this.horizontalGuides)]\n    this.verticalGuides = [...new Set(this.verticalGuides)]\n    this.definitionGroup.appendChild(guidesGroup)\n  }\n\n  protected removeGuides(): void {\n    this.verticalGuides = []\n    this.horizontalGuides = []\n    this.layer.querySelector(`#${this.groupGuidesId}`)?.remove()\n  }\n\n  protected createSVGTools(): SVGGElement {\n    this.definitionGroup = SVGBuilder.createGroup({ id: \"definition-group\" })\n    this.definitionGroup.appendChild(this.createDefs())\n    this.definitionGroup.appendChild(this.createFilters())\n    if (this.configuration.guides.enable) {\n      this.drawGuides()\n    }\n    return this.definitionGroup\n  }\n\n  init(element: HTMLElement): void {\n    this.#logger.info(\"init\", { element })\n    this.parent = element\n    this.parent.oncontextmenu = () => false\n    this.initLayer()\n  }\n\n  getAttribute(id: string, name: string): string | undefined | null {\n    const element = this.layer.querySelector(`#${id}`) as HTMLElement | null\n    return element?.getAttribute(name)\n  }\n\n  setAttribute(id: string, name: string, value: string): void {\n    const element = this.layer.querySelector(`#${id}`) as HTMLElement | null\n    element?.setAttribute(name, value)\n  }\n\n  buildElementFromSymbol(symbol: TIISymbol | IIEraser): SVGGraphicsElement | undefined {\n    let element: SVGGraphicsElement | undefined\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        element = SVGRendererStrokeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Eraser:\n        element = SVGRendererEraserUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Shape:\n        element = SVGRendererShapeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Edge:\n        element = SVGRendererEdgeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Text:\n        element = SVGRendererTextUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Group:\n        element = SVGRendererGroupUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Recognized:\n        element = SVGRendererRecognizedUtil.getSVGElement(symbol)\n        break\n      default:\n        this.#logger.error(\"buildElementFromSymbol\", `symbol unknow: \"${JSON.stringify(symbol)}\"`)\n    }\n    return element\n  }\n\n  prependElement(el: Element): void {\n    this.layer.prepend(el)\n  }\n\n  changeOrderSymbol(symbolToMove: TIISymbol, position: \"first\" | \"last\" | \"forward\" | \"backward\"): void {\n    const moveEl = this.layer.querySelector(`#${symbolToMove.id}`)\n    if (!moveEl) return\n    switch (position) {\n      case \"first\":\n        this.definitionGroup.insertAdjacentElement(\"afterend\", moveEl)\n        break\n      case \"last\":\n        this.layer.insertAdjacentElement(\"beforeend\", moveEl)\n        break\n      case \"forward\":\n        moveEl.nextElementSibling?.insertAdjacentElement(\"afterend\", moveEl)\n        break\n      case \"backward\":\n        if (moveEl.previousElementSibling !== this.definitionGroup) {\n          moveEl.previousElementSibling?.insertAdjacentElement(\"beforebegin\", moveEl)\n        }\n        break\n    }\n  }\n\n  appendElement(el: Element): void {\n    this.layer.appendChild(el)\n  }\n\n  removeElement(id: string): void {\n    this.#logger.debug(\"Element\", { id })\n    const oldStroke = this.layer.querySelector(`#${id}`)\n    if (oldStroke) {\n      oldStroke.remove()\n    }\n  }\n\n  drawSymbol(symbol: TIISymbol | IIEraser): SVGGraphicsElement | undefined {\n    this.#logger.debug(\"drawSymbol\", { symbol })\n    const oldNode = this.layer.querySelector(`#${symbol?.id}`)\n    const svgEl = this.buildElementFromSymbol(symbol)\n\n    if (svgEl) {\n      if (oldNode) {\n        oldNode.replaceWith(svgEl)\n      }\n      else {\n        this.layer.appendChild(svgEl)\n      }\n    }\n    return svgEl\n  }\n\n  replaceSymbol(id: string, symbols: TIISymbol[]): SVGGraphicsElement[] | undefined {\n    this.#logger.debug(\"drawSymbol\", { symbols })\n    const oldNode = this.layer.querySelector(`#${id}`)\n    const elements = symbols.map(s => this.buildElementFromSymbol(s)).filter(x => !!x) as SVGGraphicsElement[]\n\n    if (elements.length) {\n      if (oldNode) {\n        elements.forEach(e => oldNode.insertAdjacentElement(\"beforebegin\", e))\n        oldNode.remove()\n      }\n      else {\n        elements.forEach(e => this.layer.appendChild(e))\n      }\n    }\n    return elements\n  }\n\n  removeSymbol(id: string): void {\n    this.#logger.debug(\"removeSymbol\", { id })\n    this.removeElement(id)\n  }\n\n  drawCircle(point: TPoint, radius: number, attrs: { [key: string]: string } = {}): void {\n    this.#logger.info(\"drawCircle\", { point, radius, attrs })\n    this.layer.appendChild(SVGBuilder.createCircle(point, radius, attrs))\n  }\n\n  drawRect(box: TBox, attrs: { [key: string]: string } = {}): void {\n    this.#logger.info(\"drawRect\", { box, attrs })\n    this.layer.appendChild(SVGBuilder.createRect(box, attrs))\n  }\n\n  drawLine(p1: TPoint, p2: TPoint, attrs: { [key: string]: string } = {}): void {\n    this.#logger.info(\"drawLine\", { p1, p2, attrs })\n    this.layer.appendChild(SVGBuilder.createLine(p1, p2, attrs))\n  }\n\n  drawConnectionBetweenBox(id: string, box1: TBox, box2: TBox, position: \"corners\" | \"sides\", attrs?: { [key: string]: string }): void {\n    let points1: TPoint[] = new Box(box1).corners\n    let points2: TPoint[] = new Box(box2).corners\n    if (position === \"sides\") {\n      points1 = new Box(box1).side\n      points2 = new Box(box2).side\n    }\n    const { p1, p2 } = getClosestPoints(points1, points2)\n    const attrsLine = {\n      id,\n      fill: \"transparent\",\n      style: SVGRendererConst.noSelection,\n      ...attrs\n    }\n    this.drawLine(p1, p2, attrsLine)\n  }\n\n  resize(height: number, width: number): void {\n    this.#logger.info(\"resize\", { height, width })\n    this.layer.setAttribute(\"width\", `${width}px`)\n    this.layer.setAttribute(\"height\", `${height}px`)\n    this.layer.setAttribute(\"viewBox\", `0, 0, ${width}, ${height}`)\n    this.removeGuides()\n    if (this.configuration.guides.enable) {\n      this.drawGuides()\n    }\n  }\n\n  getElementById(id: string): SVGGraphicsElement | null {\n    return this.layer.querySelector(`#${id}`) as SVGGraphicsElement | null\n  }\n\n  getElements({ tagName, attrs }: { tagName?: string, attrs?: { [key: string]: string } }): NodeListOf<Element> {\n    this.#logger.info(\"getElements\", { tagName, attrs })\n    let query = tagName || \"*\"\n    if (attrs) {\n      for (const k in attrs) {\n        query += `[${k}=${attrs[k]}]`\n      }\n    }\n    return this.layer.querySelectorAll(query)\n  }\n\n  clearElements({ tagName, attrs }: { tagName?: string, attrs?: { [key: string]: string } }): void {\n    this.#logger.info(\"clearElements\", { tagName, attrs })\n    this.getElements({ tagName, attrs })\n      .forEach(e => e.remove())\n  }\n\n  clear(): void {\n    this.#logger.info(\"clear\")\n    if (this.layer) {\n      while (this.layer.firstChild) {\n        this.layer.firstChild.remove()\n      }\n      this.layer.appendChild(this.createSVGTools())\n    }\n  }\n\n  destroy(): void {\n    if (this.layer) {\n      this.layer.remove()\n    }\n  }\n}","import { TPointer, TStroke } from \"../../symbol\"\nimport { computeAngleAxeRadian, computeLinksPointers, computeMiddlePointer } from \"../../utils\"\n\n/**\n * @group Renderer\n */\nexport class SVGStroker\n{\n\n  protected getArcPath(center: TPointer, radius: number): string\n  {\n    const svgPath = [\n      `M ${ center.x },${ center.y }`,\n      `m ${ -radius },0`,\n      `a ${ radius },${ radius } 0 1 0 ${ radius * 2 },0`,\n      `a ${ radius },${ radius } 0 1 0 ${ -(radius * 2) },0`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected getLinePath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, end), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x },${ linkPoints1[0].y }`,\n      `L ${ linkPoints2[0].x },${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x },${ linkPoints2[1].y }`,\n      `L ${ linkPoints1[1].x },${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected getFinalPath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const ARCSPLIT = 6\n    const angle = computeAngleAxeRadian(begin, end)\n    const linkPoints = computeLinksPointers(end, angle, width)\n    const parts = [`M ${ linkPoints[0].x },${ linkPoints[0].y }`]\n    for (let i = 1; i <= ARCSPLIT; i++) {\n      const newAngle = angle - (i * (Math.PI / ARCSPLIT))\n      parts.push(`L ${ end.x - (end.p * width * Math.sin(newAngle)) },${ end.y + (end.p * width * Math.cos(newAngle)) }`)\n    }\n    const svgPath = parts.join(\" \")\n    return svgPath\n  }\n\n  protected getQuadraticPath(begin: TPointer, end: TPointer, central: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, central), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(central, end), width)\n    const linkPoints3 = computeLinksPointers(central, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x },${ linkPoints1[0].y }`,\n      `Q ${ linkPoints3[0].x },${ linkPoints3[0].y } ${ linkPoints2[0].x },${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x },${ linkPoints2[1].y }`,\n      `Q ${ linkPoints3[1].x },${ linkPoints3[1].y } ${ linkPoints1[1].x },${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected buildSVGPath(stroke: TStroke): string\n  {\n    const STROKE_LENGTH = stroke.pointers.length\n    const STROKE_WIDTH = (stroke.style.width as number)\n    const NB_QUADRATICS = STROKE_LENGTH - 2\n    const firstPoint = stroke.pointers[0]\n\n    const parts = []\n    if (STROKE_LENGTH < 3) {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * 0.6))\n    } else {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * firstPoint.p))\n      parts.push(this.getLinePath(firstPoint, computeMiddlePointer(firstPoint, stroke.pointers[1]), STROKE_WIDTH))\n\n      for (let i = 0; i < NB_QUADRATICS; i++) {\n        const begin = computeMiddlePointer(stroke.pointers[i], stroke.pointers[i + 1])\n        const end = computeMiddlePointer(stroke.pointers[i + 1], stroke.pointers[i + 2])\n        const central = stroke.pointers[i + 1]\n        parts.push(this.getQuadraticPath(begin, end, central, STROKE_WIDTH)\n        )\n      }\n      const beforeLastPoint = stroke.pointers[STROKE_LENGTH - 2]\n      const lastPoint = stroke.pointers[STROKE_LENGTH - 1]\n      parts.push(this.getLinePath(computeMiddlePointer(beforeLastPoint, lastPoint), lastPoint, STROKE_WIDTH))\n      parts.push(this.getFinalPath(beforeLastPoint, lastPoint, STROKE_WIDTH))\n    }\n    return parts.join(\" \")\n  }\n\n  drawStroke(svgElement: SVGElement, stroke: TStroke, attrs?: { name: string, value: string }[]): void\n  {\n    const svgPathElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\")\n    svgPathElement.classList.add(\"pending-stroke\")\n    svgPathElement.setAttribute(\"id\", stroke.id)\n    svgPathElement.setAttribute(\"type\", stroke.pointerType)\n    attrs?.forEach(a =>\n    {\n      svgPathElement.setAttribute(a.name, a.value)\n    })\n    const svgPath = this.buildSVGPath(stroke)\n    svgPathElement.setAttribute(\"d\", `${ svgPath }Z`)\n    svgElement.appendChild(svgPathElement)\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { Model } from \"../../model\"\nimport { TStroke } from \"../../symbol\"\nimport { TRendererConfiguration } from \"../RendererConfiguration\"\nimport { TUpdatePatch, TUpdatePatchAppendChild, TUpdatePatchInsertBefore, TUpdatePatchRemoveAttribut, TUpdatePatchRemoveChild, TUpdatePatchRemoveElement, TUpdatePatchReplaceAll, TUpdatePatchReplaceELement, TUpdatePatchSetAttribut } from \"../../recognizer\"\nimport { SVGStroker } from \"./SVGStroker\"\n\n/**\n * @group Renderer\n */\nexport class InteractiveInkSSRSVGRenderer\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n\n  config: TRendererConfiguration\n  stroker: SVGStroker\n  context!: {\n    parent: HTMLElement\n  }\n\n  constructor(config: TRendererConfiguration)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.config = config\n    this.stroker = new SVGStroker()\n  }\n\n  init(element: HTMLElement): void\n  {\n    this.#logger.info(\"init\", { element })\n    element.style.fontSize = \"10px\"\n    this.context = {\n      parent: element\n    }\n  }\n\n  protected drawStroke(svgElement: SVGElement, stroke: TStroke)\n  {\n    let style: string\n    if (stroke.pointerType === \"eraser\") {\n      stroke.style.width = 12\n      style = \"fill:grey;stroke:transparent;shadowBlur:5;opacity:0.2;\"\n    } else {\n      style = `fill:${ stroke.style.color };stroke:transparent;`\n    }\n    this.stroker.drawStroke(svgElement, stroke, [{ name: \"style\", value: style }])\n  }\n\n  protected replaceAll(layerName: string, update: TUpdatePatchReplaceAll): void\n  {\n    const oldLayer = this.context.parent.querySelector(`svg[data-layer=\"${ layerName }\"]`) as SVGElement | null\n    oldLayer?.remove()\n    this.context.parent.insertAdjacentHTML(\"beforeend\", update.svg)\n    const layer = this.context.parent.querySelector(`svg[data-layer=\"${ layerName }\"]`) as SVGElement\n    if (layerName === \"MODEL\") {\n      const pendingStrokesGroup = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\")\n      pendingStrokesGroup.id = \"pendingStrokes\"\n      layer.appendChild(pendingStrokesGroup)\n    }\n  }\n\n  protected replaceElement(update: TUpdatePatchReplaceELement): void\n  {\n    const elementToRemove = this.context.parent.querySelector(`#${ update.id }`) as HTMLElement | null\n    if (elementToRemove) {\n      const parent = elementToRemove.parentNode as HTMLElement | null | undefined\n      elementToRemove?.remove()\n      parent?.insertAdjacentHTML(\"beforeend\", update.svg)\n    }\n  }\n\n  protected appendChild(layerName: string, update: TUpdatePatchAppendChild): void\n  {\n    const parentSelector = update.parentId ? `#${ update.parentId }` : `svg[data-layer=\"${ layerName }\"]`\n    const parent = this.context.parent.querySelector(parentSelector) as HTMLElement\n    parent?.insertAdjacentHTML(\"beforeend\", update.svg)\n  }\n\n  protected removeChild(update: TUpdatePatchRemoveChild): void\n  {\n    this.context.parent.querySelector(`#${ update.parentId } > *:nth-child(${ update.index + 1 })`)?.remove()\n  }\n\n  protected removeElement(update: TUpdatePatchRemoveElement): void\n  {\n    const elementToRemove = this.context.parent.querySelector(`#${ update.id }`)\n    if (elementToRemove) {\n      if (update.id.includes(\"s\") || update.id.includes(\"MODEL\")) {\n        elementToRemove.remove()\n      } else {\n        elementToRemove.setAttribute(\"class\", \"removed-stroke\")\n        setTimeout(() =>\n        {\n          elementToRemove?.remove()\n        }, 100)\n      }\n    }\n  }\n\n  protected insertBefore(update: TUpdatePatchInsertBefore): void\n  {\n    const parent = this.context.parent.querySelector(`#${ update.refId }`) as HTMLElement | null\n    parent?.insertAdjacentHTML(\"beforebegin\", update.svg)\n  }\n\n  protected setAttribute(update: TUpdatePatchSetAttribut): void\n  {\n    const selector = update.id ? `#${ update.id }` : \"svg\"\n    const element = this.context.parent.querySelector(selector) as HTMLElement | null\n    element?.setAttribute(update.name, update.value)\n  }\n\n  protected removeAttribute(update: TUpdatePatchRemoveAttribut): void\n  {\n    const selector = update.id ? `#${ update.id }` : \"svg\"\n    const element = this.context.parent.querySelector(selector) as HTMLElement | null\n    element?.removeAttribute(update.name)\n  }\n\n  updateLayer(layerName: string, update: TUpdatePatch): void\n  {\n    this.#logger.info(\"updateLayer\", { layerName, update })\n    switch (update.type) {\n      case \"REPLACE_ALL\":\n        this.replaceAll(layerName, update as TUpdatePatchReplaceAll)\n        break\n      case \"REPLACE_ELEMENT\":\n        this.replaceElement(update as TUpdatePatchReplaceELement)\n        break\n      case \"APPEND_CHILD\":\n        this.appendChild(layerName, update as TUpdatePatchAppendChild)\n        break\n      case \"REMOVE_ELEMENT\":\n        this.removeElement(update as TUpdatePatchRemoveElement)\n        break\n      case \"REMOVE_CHILD\":\n        this.removeChild(update as TUpdatePatchRemoveChild)\n        break\n      case \"INSERT_BEFORE\":\n        this.insertBefore(update as TUpdatePatchInsertBefore)\n        break\n      case \"SET_ATTRIBUTE\":\n        this.setAttribute(update as TUpdatePatchSetAttribut)\n        break\n      case \"REMOVE_ATTRIBUTE\":\n        this.removeAttribute(update as TUpdatePatchRemoveAttribut)\n        break\n      default:\n        this.#logger.warn(\"updateLayer\", `update.type unknow ${update.type}`)\n        break\n    }\n  }\n\n  updatesLayer(layerName: string, updates: TUpdatePatch[]): void\n  {\n    this.#logger.info(\"updatesLayer\", { layerName, updates })\n    updates.forEach(u => this.updateLayer(layerName, u))\n    this.clearPendingStroke()\n  }\n\n  clearPendingStroke(): void\n  {\n    this.#logger.info(\"clearPendingStroke\")\n    const pendingStrokeGroup = this.context.parent.querySelector(\"#pendingStrokes\") as SVGElement\n    if (pendingStrokeGroup) {\n      pendingStrokeGroup.innerHTML = \"\"\n    }\n  }\n\n  drawPendingStroke(stroke: TStroke): void\n  {\n    this.#logger.info(\"drawPendingStroke\", { stroke })\n    if (stroke) {\n      const pendingStrokeGroup = this.context.parent.querySelector(\"#pendingStrokes\") as SVGElement\n      if (pendingStrokeGroup) {\n        const oldStroke = pendingStrokeGroup.querySelector(`#${ stroke?.id }`)\n        if (oldStroke) {\n          oldStroke.remove()\n        }\n        this.drawStroke(pendingStrokeGroup, stroke)\n      }\n    }\n  }\n\n  clearErasingStrokes(): void\n  {\n    const erasingStrokeList = this.context.parent.querySelectorAll(\"[type=eraser]\") as NodeListOf<SVGElement>\n    erasingStrokeList.forEach(erasingStroke => {\n      erasingStroke.remove()\n    })\n  }\n\n  resize(model: Model): void\n  {\n    this.#logger.info(\"resize\", { model })\n    const rect = this.context.parent.getBoundingClientRect()\n    const svgList = this.context.parent.querySelectorAll(\"svg\")\n    const width = Math.max(rect.width, model.width)\n    const height = Math.max(rect.height, model.height)\n    svgList.forEach(svg =>\n    {\n      svg.setAttribute(\"viewBox\", `0 0 ${ width }, ${ height }`)\n      svg.setAttribute(\"width\", `${ width }px`)\n      svg.setAttribute(\"height\", `${ height }px`)\n    })\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\", { context: this.context })\n    if (this.context?.parent) {\n      this.context.parent.querySelectorAll(\"svg\").forEach(n => n.remove())\n    }\n  }\n}","\n/**\n * @group Renderer\n */\nexport type TGuidesConfiguration = {\n  enable: boolean,\n  gap: number\n}\n\n/**\n * @group Renderer\n * @source\n */\nexport const DefaultGuidesConfiguration: TGuidesConfiguration = {\n  enable: true,\n  gap: 50,\n}\n\n/**\n * @group Renderer\n */\nexport type TRendererConfiguration = {\n  minHeight: number\n  minWidth: number\n  guides: TGuidesConfiguration\n}\n\n/**\n * @group Renderer\n * @source\n */\nexport const DefaultRendererConfiguration: TRendererConfiguration = {\n  guides: DefaultGuidesConfiguration,\n  minHeight: 100,\n  minWidth: 100,\n}\n\n/**\n * @group Renderer\n */\nexport type TIIRendererConfiguration = TRendererConfiguration & {\n  guides: TGuidesConfiguration & {\n    type: \"line\" | \"grid\" | \"point\"\n  },\n}\n\n/**\n * @group Renderer\n * @source\n */\nexport const DefaultIIRendererConfiguration: TIIRendererConfiguration = {\n  guides: {\n    enable: true,\n    gap: 50,\n    type: \"point\"\n  },\n  minHeight: 100,\n  minWidth: 100,\n}\n","\n/**\n * @group Grabber\n */\nexport type TListenerConfiguration = {\n  capture: boolean\n  passive: boolean\n}\n\n/**\n * @group Grabber\n * @source\n */\nexport const DefaultListenerConfiguration: TListenerConfiguration = {\n  capture: false,\n  passive: true\n}\n\n/**\n * @group Grabber\n */\nexport type TGrabberConfiguration = {\n  listenerOptions: TListenerConfiguration\n  xyFloatPrecision: number\n  timestampFloatPrecision: number\n  delayLongTouch: number\n}\n\n/**\n * @group Grabber\n * @source\n */\nexport const DefaultGrabberConfiguration: TGrabberConfiguration = {\n  listenerOptions: DefaultListenerConfiguration,\n  xyFloatPrecision: 0,\n  timestampFloatPrecision: 0,\n  delayLongTouch: 500\n}\n","import { TGrabberConfiguration } from \"./GrabberConfiguration\"\nimport { LoggerCategory, LoggerLevel, LoggerManager } from \"../logger\"\nimport { TPointer } from \"../symbol\"\n\nexport type PointerInfo = {\n  clientX: number,\n  clientY: number,\n  isPrimary: boolean,\n  type: string,\n  pointerType: string,\n  target: HTMLElement,\n  pointer: TPointer,\n  button: number,\n  buttons: number\n}\n\n/**\n * @group Grabber\n */\nexport class PointerEventGrabber\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.GRABBER)\n\n  protected configuration: TGrabberConfiguration\n  protected layerCapture!: HTMLElement\n  protected capturing: boolean = false\n  protected pointerType?: string\n  protected prevent = (e: Event) => e.preventDefault()\n\n  onPointerDown?: (info: PointerInfo) => void\n  onPointerMove?: (info: PointerInfo) => void\n  onPointerUp?: (info: PointerInfo) => void\n  onContextMenu?: (info: PointerInfo) => void\n\n  constructor(configuration: TGrabberConfiguration)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n  }\n\n  protected roundFloat(oneFloat: number, requestedFloatPrecision: number): number\n  {\n    if (requestedFloatPrecision >= 0) {\n      const floatPrecision: number = Math.pow(10, requestedFloatPrecision)\n      return Math.round(oneFloat / floatPrecision) * floatPrecision\n    }\n    this.#logger.debug(\"roundFloat\", { oneFloat, requestedFloatPrecision })\n    return oneFloat\n  }\n\n  protected extractPointer(event: MouseEvent | TouchEvent): TPointer\n  {\n    let clientX: number, clientY: number\n    if (\"changedTouches\" in event) {\n      ({ clientX, clientY } = event.changedTouches[0])\n    } else {\n      ({ clientX, clientY } = event)\n    }\n    const rect: DOMRect = this.layerCapture.getBoundingClientRect()\n    const pointer = {\n      x: this.roundFloat(clientX - rect.left - this.layerCapture.clientLeft + this.layerCapture.scrollLeft, this.configuration.xyFloatPrecision),\n      y: this.roundFloat(clientY - rect.top - this.layerCapture.clientTop + this.layerCapture.scrollTop, this.configuration.xyFloatPrecision),\n      t: this.roundFloat(Date.now(), this.configuration.timestampFloatPrecision),\n      p: (event as PointerEvent).pressure,\n    }\n    this.#logger.debug(\"extractPointer\", { event, pointer })\n    return pointer\n  }\n\n  protected getPointerInfos(evt: PointerEvent): PointerInfo\n  {\n    return {\n      clientX: evt.clientX,\n      clientY: evt.clientY,\n      isPrimary: evt.isPrimary,\n      type: evt.type,\n      target: evt.target as HTMLElement,\n      pointerType: evt.pointerType,\n      pointer: this.extractPointer(evt),\n      button: evt.button,\n      buttons: evt.buttons\n    }\n  }\n\n  protected pointerDownHandler = (evt: PointerEvent) =>\n  {\n    const pointerInfo = this.getPointerInfos(evt)\n    this.#logger.debug(\"pointerDownHandler\", pointerInfo)\n\n    // exit if not a left click or multi-touch\n    if (pointerInfo.button !== 0 || evt.buttons !== 1) {\n      return\n    }\n    this.capturing = true\n    this.pointerType = evt.pointerType\n\n    if (this.#logger.level === LoggerLevel.INFO) {\n      this.#logger.info(\"pointerDownHandler\", pointerInfo)\n    }\n\n    if (this.onPointerDown) {\n      this.onPointerDown(pointerInfo)\n    }\n  }\n\n  protected pointerMoveHandler = (evt: PointerEvent) =>\n  {\n    const pointerInfo = this.getPointerInfos(evt)\n    this.#logger.debug(\"pointerMoveHandler\", pointerInfo)\n    if (this.capturing && this.pointerType === evt.pointerType) {\n      if (this.#logger.level === LoggerLevel.INFO) {\n        this.#logger.info(\"pointerMoveHandler\", pointerInfo)\n      }\n      if (this.onPointerMove) {\n        this.onPointerMove(pointerInfo)\n      }\n    }\n  }\n\n  protected pointerUpHandler = (evt: PointerEvent) =>\n  {\n    const pointerInfo = this.getPointerInfos(evt)\n    this.#logger.debug(\"pointerUpHandler\", pointerInfo)\n    if (this.capturing && this.pointerType === evt.pointerType) {\n      if (this.#logger.level === LoggerLevel.INFO) {\n        this.#logger.info(\"pointerUpHandler\", pointerInfo)\n      }\n      this.pointerType = undefined\n      this.capturing = false\n      if (this.onPointerUp) {\n        this.onPointerUp(pointerInfo)\n      }\n    }\n  }\n\n  protected pointerOutHandler = (evt: PointerEvent) =>\n  {\n    const pointerInfo = this.getPointerInfos(evt)\n    this.#logger.debug(\"pointerOutHandler\", pointerInfo)\n    if (this.capturing && this.pointerType === evt.pointerType && !this.layerCapture.contains(evt.target as HTMLElement)) {\n      if (this.#logger.level === LoggerLevel.INFO) {\n        this.#logger.info(\"pointerOutHandler\", pointerInfo)\n      }\n      this.pointerType = undefined\n      this.capturing = false\n      if (this.onPointerUp) {\n        this.onPointerUp(pointerInfo)\n      }\n    }\n  }\n\n  protected contextMenuHandler = (evt: MouseEvent) =>\n  {\n    const pointerInfo = this.getPointerInfos(evt as PointerEvent)\n    this.#logger.debug(\"contextMenuHandler\", pointerInfo)\n    if (evt.target && this.onContextMenu){\n      if (this.#logger.level === LoggerLevel.INFO) {\n        this.#logger.info(\"contextMenuHandler\", pointerInfo)\n      }\n      this.onContextMenu(pointerInfo)\n    }\n  }\n\n  stopPointerEvent(): void\n  {\n    this.capturing = false\n    this.pointerType = undefined\n  }\n\n  attach(layerCapture: HTMLElement)\n  {\n    this.#logger.info(\"attach\", { domElement: layerCapture })\n    if (this.layerCapture) {\n      this.detach()\n    }\n    this.layerCapture = layerCapture\n    // The touch-action CSS property prevents the input from continuing.\n    // https://developer.mozilla.org/en-US/docs/Web/API/Element/pointercancel_event\n    this.layerCapture.style.setProperty(\"touch-action\", \"none\")\n    this.layerCapture.addEventListener(\"pointerdown\", this.pointerDownHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"pointermove\", this.pointerMoveHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"pointerup\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"pointercancel\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"pointerleave\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"pointerout\", this.pointerOutHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"contextmenu\", this.contextMenuHandler)\n  }\n\n  detach()\n  {\n    this.#logger.info(\"detach\")\n    this.layerCapture?.style.removeProperty(\"touch-action\")\n    this.layerCapture?.removeEventListener(\"pointerdown\", this.pointerDownHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"pointermove\", this.pointerMoveHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"pointerup\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"pointerleave\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"pointercancel\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"pointerout\", this.pointerOutHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"contextmenu\", this.contextMenuHandler)\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport\n{\n  TIISymbol,\n  TPointer,\n} from \"../symbol\"\nimport { SVGRenderer } from \"../renderer\"\nimport { TStyle } from \"../style\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\nimport { InkEditor } from \"../editor\"\n\n\n/**\n * @group Manager\n */\nexport abstract class AbstractWriterManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.WRITE)\n  grabber: PointerEventGrabber\n  editor: InteractiveInkEditor | InkEditor\n  currentSymbol?: TIISymbol\n\n  detectGesture: boolean = true\n\n  constructor(editor: InteractiveInkEditor | InkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.grabber = new PointerEventGrabber(editor.configuration.grabber)\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  attach(layer: HTMLElement): void\n  {\n    this.grabber.attach(layer)\n    this.grabber.onPointerDown = this.start.bind(this)\n    this.grabber.onPointerMove = this.continue.bind(this)\n    this.grabber.onPointerUp = this.end.bind(this)\n  }\n\n  detach(): void\n  {\n    this.grabber.detach()\n  }\n\n  protected abstract createCurrentSymbol(pointer: TPointer, style: TStyle, pointerType: string): TIISymbol\n  protected abstract updateCurrentSymbol(pointer: TPointer): TIISymbol\n\n  start(info: PointerInfo): void\n  {\n    this.#logger.info(\"startWriting\", { info })\n    const localPointer = info.pointer\n    this.currentSymbol = this.createCurrentSymbol(localPointer, this.editor.penStyle, info.pointerType)\n    this.renderer.drawSymbol(this.currentSymbol!)\n  }\n\n  continue(info: PointerInfo): void\n  {\n    this.#logger.info(\"continueWriting\", { info })\n    const localPointer = info.pointer\n    this.currentSymbol = this.updateCurrentSymbol(localPointer)\n    this.renderer.drawSymbol(this.currentSymbol!)\n  }\n\n  abstract end(info: PointerInfo): Promise<void>\n}\n","import { InteractiveInkEditor } from \"../editor\"\nimport { LoggerManager, LoggerCategory } from \"../logger\"\nimport\n{\n  IIModel,\n  TJIIXChar,\n  TJIIXEdgeArc,\n  TJIIXEdgeElement,\n  JIIXEdgeKind,\n  TJIIXEdgeLine,\n  TJIIXEdgePolyEdge,\n  TJIIXExport,\n  TJIIXNodeCircle,\n  TJIIXNodeElement,\n  TJIIXNodeEllipse,\n  JIIXNodeKind,\n  TJIIXNodeParrallelogram,\n  TJIIXNodePolygon,\n  TJIIXNodeRectangle,\n  TJIIXNodeRhombus,\n  TJIIXNodeTriangle,\n  TJIIXTextElement,\n  TJIIXWord\n} from \"../model\"\nimport\n{\n  Box,\n  DecoratorKind,\n  IIDecorator,\n  IIEdgeArc,\n  IIEdgeLine,\n  IIEdgePolyLine,\n  IIShapeCircle,\n  IIShapeEllipse,\n  IIShapePolygon,\n  IIStroke,\n  IIText,\n  SymbolType,\n  TIIEdge,\n  TIIShape,\n  TIISymbol,\n  TIISymbolChar,\n  TPoint\n} from \"../symbol\"\nimport { RecognizedKind } from \"../symbol\"\nimport { computeAngleAxeRadian, computeAverage, convertBoundingBoxMillimeterToPixel, convertMillimeterToPixel, createUUID } from \"../utils\"\n\n/**\n * @group Manager\n */\nexport class IIConversionManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.CONVERTER)\n  editor: InteractiveInkEditor\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get configuration(): { size: number | \"auto\", weight: \"bold\" | \"normal\" | \"auto\" } {\n    return this.editor.configuration.fontStyle\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get rowHeight(): number\n  {\n    return this.editor.configuration.rendering.guides.gap\n  }\n\n  protected computeFontSize(chars: TJIIXChar[]): number\n  {\n    if (chars.some(c => c[\"bounding-box\"])) {\n      const height = convertMillimeterToPixel(computeAverage(chars.map(c => c[\"bounding-box\"]?.height || 1)))\n      return Math.round(Math.round(height * this.rowHeight) / this.rowHeight / 2) * 2\n    }\n    return Math.round(this.rowHeight / 2)\n  }\n\n  buildChar(char: TJIIXChar, strokes: IIStroke[], fontSize: number): TIISymbolChar\n  {\n    const points = char.grid.map(p => ({\n      x: convertMillimeterToPixel(p.x),\n      y: convertMillimeterToPixel(p.y),\n    }))\n    let fontWeight = this.configuration.weight\n    if (fontWeight === \"auto\") {\n      fontWeight = (strokes[0].style.width || 1) > 2 ? \"bold\" : \"normal\"\n    }\n\n    const color = strokes[0].style.color || \"black\"\n    return {\n      id: `text-char-${ createUUID() }`,\n      label: char.label,\n      color,\n      fontSize,\n      fontWeight,\n      bounds: Box.createFromPoints(points)\n    }\n  }\n\n  buildText(word: TJIIXWord, chars: TJIIXChar[], strokes: IIStroke[], size: number | \"auto\"): IIText\n  {\n    const boundingBox = Box.createFromBoxes([convertBoundingBoxMillimeterToPixel(word[\"bounding-box\"])])\n    const charSymbols: TIISymbolChar[] = []\n    const charFontSize = size === \"auto\" ? this.computeFontSize(chars) : size\n\n    chars.forEach(char =>\n    {\n      const charStrokes = strokes.filter(s => char.items?.some(i => i[\"full-id\"] === s.id)) as IIStroke[]\n      if (charStrokes.length) {\n        charSymbols.push(this.buildChar(char, charStrokes, charFontSize))\n      }\n    })\n    const point: TPoint = {\n      x: boundingBox.xMin,\n      y: boundingBox.yMax\n    }\n    const text = new IIText(charSymbols, point, boundingBox, strokes[0].style)\n    const decorators = strokes.flatMap(s => s.decorators)\n    strokes.forEach(s =>\n    {\n      const sym = this.model.getRootSymbol(s.id)\n      if ((sym?.type === SymbolType.Recognized && sym.kind === RecognizedKind.Text) || sym?.type === SymbolType.Group) {\n        const hightlight = sym.decorators.find(d => d.kind === DecoratorKind.Highlight)\n        if (hightlight) decorators.push(hightlight)\n        const strikethrough = sym.decorators.find(d => d.kind === DecoratorKind.Strikethrough)\n        if (strikethrough) decorators.push(strikethrough)\n        const surround = sym.decorators.find(d => d.kind === DecoratorKind.Surround)\n        if (surround) decorators.push(surround)\n        const underline = sym.decorators.find(d => d.kind === DecoratorKind.Underline)\n        if (underline) decorators.push(underline)\n      }\n    })\n    if (decorators.length) {\n      const hightlight = decorators.find(d => d.kind === DecoratorKind.Highlight)\n      if (hightlight) {\n        text.decorators.push(new IIDecorator(DecoratorKind.Highlight, hightlight.style))\n      }\n      const strikethrough = decorators.find(d => d.kind === DecoratorKind.Strikethrough)\n      if (strikethrough) {\n        text.decorators.push(new IIDecorator(DecoratorKind.Strikethrough, strikethrough.style))\n      }\n      const surround = decorators.find(d => d.kind === DecoratorKind.Surround)\n      if (surround) {\n        text.decorators.push(new IIDecorator(DecoratorKind.Surround, surround.style))\n      }\n      const underline = decorators.find(d => d.kind === DecoratorKind.Underline)\n      if (underline) {\n        text.decorators.push(new IIDecorator(DecoratorKind.Underline, underline.style))\n      }\n    }\n\n    return text\n  }\n\n  convertText(text: TJIIXTextElement, strokes: IIStroke[], onlyText: boolean): { symbol: IIText, strokes: IIStroke[] }[] | undefined\n  {\n    if (!text.lines) {\n      throw new Error(\"You need to active configuration.recognition.export.jiix.text.lines = true\")\n    }\n    if (!text.words) {\n      throw new Error(\"You need to active configuration.recognition.export.jiix.text.words = true\")\n    }\n    if (!text.chars) {\n      throw new Error(\"You need to active configuration.recognition.export.jiix.text.chars = true\")\n    }\n    if (!text.chars.some(c => c.items)) {\n      throw new Error(\"You need to active configuration.recognition.export.jiix.strokes = true\")\n    }\n\n    const jiixWords = text.words as TJIIXWord[]\n    const jiixChars = text.chars as TJIIXChar[]\n\n    const result: { symbol: IIText, strokes: IIStroke[] }[] = []\n\n\n    let textFontSize = this.configuration.size\n    if (onlyText && textFontSize === \"auto\") {\n      textFontSize = Math.round(this.computeFontSize(jiixChars.filter(c => c.items?.length)) / 2) * 2\n    }\n    else if (this.configuration.size !== \"auto\") {\n      textFontSize = this.configuration.size * this.rowHeight\n    }\n\n    let isNewLine = false\n    let currentY = convertMillimeterToPixel(text.lines[0][\"baseline-y\"])\n    const leftX = convertMillimeterToPixel(text[\"bounding-box\"]?.x || 0)\n    let currentX = convertMillimeterToPixel(jiixWords[0][\"bounding-box\"]?.x || 0)\n    jiixWords.forEach(word =>\n    {\n      if (word.label === \" \") {\n        currentX += this.editor.texter.getSpaceWidth(result.at(-1)?.symbol.chars[0].fontSize|| (this.rowHeight / 2))\n        return\n      }\n      const wordStrokes = strokes.filter(s => word.items?.some(i => i[\"full-id\"] === s.id)) as IIStroke[]\n      if (wordStrokes.length) {\n        const chars = jiixChars.slice(word[\"first-char\"] as number, (word[\"last-char\"] || 0) + 1)\n        const wordSymbol = this.buildText(word, chars, wordStrokes, textFontSize)\n\n        if (onlyText) {\n          if (isNewLine) {\n            isNewLine = false\n            const nbRow = Math.round((wordSymbol.point.y - currentY) / this.rowHeight) || 1\n            currentY += nbRow * this.rowHeight\n            if (Math.abs(wordSymbol.point.x - leftX) < this.rowHeight) {\n              currentX = leftX\n            }\n            else {\n              currentX = wordSymbol.point.x\n            }\n          }\n          wordSymbol.point.x = currentX\n          wordSymbol.point.y = this.model.roundToLineGuide(currentY)\n        }\n\n        this.editor.texter.setBounds(wordSymbol)\n        currentX += wordSymbol.bounds.width\n        result.push({\n          symbol: wordSymbol,\n          strokes: wordStrokes\n        })\n      }\n      isNewLine = word.label === \"\\n\"\n    })\n\n    return result\n  }\n\n  buildCircle(circle: TJIIXNodeCircle, strokes: IIStroke[]): IIShapeCircle\n  {\n    const center: TPoint = {\n      x: convertMillimeterToPixel(circle.cx),\n      y: convertMillimeterToPixel(circle.cy)\n    }\n    return new IIShapeCircle(center, convertMillimeterToPixel(circle.r), strokes[0]?.style)\n  }\n\n  buildEllipse(ellipse: TJIIXNodeEllipse, strokes: IIStroke[]): IIShapeEllipse\n  {\n    const center: TPoint = {\n      x: convertMillimeterToPixel(ellipse.cx),\n      y: convertMillimeterToPixel(ellipse.cy),\n    }\n    return new IIShapeEllipse(center, convertMillimeterToPixel(ellipse.rx), convertMillimeterToPixel(ellipse.ry), ellipse.orientation, strokes[0]?.style)\n  }\n\n  buildRectangle(rectangle: TJIIXNodeRectangle, strokes: IIStroke[]): IIShapePolygon\n  {\n    const height = convertMillimeterToPixel(rectangle.height)\n    const width = convertMillimeterToPixel(rectangle.width)\n    const x = convertMillimeterToPixel(rectangle.x)\n    const y = convertMillimeterToPixel(rectangle.y)\n    const points: TPoint[] = [\n      { x, y },\n      { x: x + width, y },\n      { x: x + width, y: y + height },\n      { x, y: y + height }\n    ]\n    return new IIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildPolygon(polygon: TJIIXNodePolygon, strokes: IIStroke[]): IIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new IIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildRhombus(polygon: TJIIXNodeRhombus, strokes: IIStroke[]): IIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new IIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildTriangle(polygon: TJIIXNodeTriangle, strokes: IIStroke[]): IIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new IIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildParallelogram(polygon: TJIIXNodeParrallelogram, strokes: IIStroke[]): IIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new IIShapePolygon(points, strokes[0]?.style)\n  }\n\n  convertNode(node: TJIIXNodeElement, strokes: IIStroke[]): { symbol: TIIShape, strokes: IIStroke[] } | undefined\n  {\n    const associatedStroke = strokes.filter(s => node.items?.some(i => i[\"full-id\"] === s.id))\n    if (!associatedStroke.length) return\n\n    const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n\n    let shape: TIIShape\n    switch (node.kind) {\n      case JIIXNodeKind.Circle:\n        shape = this.buildCircle(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Ellipse:\n        shape = this.buildEllipse(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Rectangle:\n        shape = this.buildRectangle(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Triangle:\n        shape = this.buildTriangle(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Parallelogram:\n        shape = this.buildParallelogram(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Polygon:\n        shape = this.buildPolygon(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Rhombus:\n        shape = this.buildRhombus(node, uniqStrokes)\n        break\n      default:\n        this.#logger.warn(\"convertNode\", `Conversion of Node with kind equal to ${ JSON.stringify(node) } is unknow`)\n        return\n    }\n    return { symbol: shape, strokes: uniqStrokes }\n  }\n\n  buildLine(line: TJIIXEdgeLine, strokes: IIStroke[]): IIEdgeLine\n  {\n    const point1: TPoint = { x: convertMillimeterToPixel(line.x1), y: convertMillimeterToPixel(line.y1) }\n    const point2: TPoint = { x: convertMillimeterToPixel(line.x2), y: convertMillimeterToPixel(line.y2) }\n    const angle = computeAngleAxeRadian(point1, point2)\n\n    if (Math.abs(angle % Math.PI) < 0.1) {\n      // to adjust the line with the horizontal\n      point1.y = +((point1.y + point2.y) / 2).toFixed(3)\n      point2.y = point1.y\n    }\n    else if (Math.abs(angle % (Math.PI / 2)) < 0.1) {\n      // to adjust the line with the vertical\n      point1.x = +((point1.x + point2.x) / 2).toFixed(3)\n      point2.x = point1.x\n    }\n    return new IIEdgeLine(point1, point2, line.p1Decoration, line.p2Decoration, strokes[0]?.style)\n  }\n\n  buildPolyEdge(polyline: TJIIXEdgePolyEdge, strokes: IIStroke[]): IIEdgePolyLine\n  {\n    const start: TPoint = { x: convertMillimeterToPixel(polyline.edges[0].x1), y: convertMillimeterToPixel(polyline.edges[0].y1) }\n    const points = polyline.edges.map(e => ({ x: convertMillimeterToPixel(e.x2), y: convertMillimeterToPixel(e.y2) }))\n    points.unshift(start)\n    for (let index = 0; index < points.length - 1; index++) {\n      const p1 = points[index]\n      const p2 = points[index + 1]\n      const angle = computeAngleAxeRadian(p1, p2)\n      if (Math.abs(angle % Math.PI) < 0.1) {\n        p1.y = +((p1.y + p2.y) / 2).toFixed(3)\n        p2.y = p1.y\n      }\n      else if (Math.abs(angle % (Math.PI / 2)) < 0.1) {\n        p1.x = +((p1.x + p2.x) / 2).toFixed(3)\n        p2.x = p1.x\n      }\n    }\n\n    return new IIEdgePolyLine(points, polyline.edges[0].p1Decoration, polyline.edges.at(-1)!.p2Decoration, strokes[0]?.style)\n  }\n\n  buildArc(arc: TJIIXEdgeArc, strokes: IIStroke[]): IIEdgeArc\n  {\n    const center: TPoint = { x: convertMillimeterToPixel(arc.cx), y: convertMillimeterToPixel(arc.cy) }\n    const radiusX = convertMillimeterToPixel(arc.rx)\n    const radiusY = convertMillimeterToPixel(arc.ry)\n    return new IIEdgeArc(center, arc.startAngle, arc.sweepAngle, radiusX, radiusY, arc.phi, arc.startDecoration, arc.endDecoration, strokes[0]?.style)\n  }\n\n  convertEdge(edge: TJIIXEdgeElement, strokes: IIStroke[]): { symbol: TIIEdge, strokes: IIStroke[] } | undefined\n  {\n    switch (edge.kind) {\n      case JIIXEdgeKind.Line: {\n        const associatedStroke = strokes.filter(s => edge.items?.some(i => i[\"full-id\"] === s.id))\n        if (!associatedStroke.length) return\n        const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n        const oiEdge = this.buildLine(edge, uniqStrokes)\n        return {\n          symbol: oiEdge,\n          strokes: uniqStrokes\n        }\n      }\n      case JIIXEdgeKind.Arc: {\n        const associatedStroke = strokes.filter(s => edge.items?.some(i => i[\"full-id\"] === s.id))\n        if (!associatedStroke.length) return\n        const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n        const oiEdge = this.buildArc(edge, uniqStrokes)\n        return {\n          symbol: oiEdge,\n          strokes: uniqStrokes\n        }\n      }\n      case JIIXEdgeKind.PolyEdge: {\n        const associatedStroke = strokes.filter(s => edge.edges.flatMap(e => e.items)?.some(i => i![\"full-id\"] === s.id))\n        if (!associatedStroke.length) return\n        const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n        const oiEdge = this.buildPolyEdge(edge, uniqStrokes)\n        return {\n          symbol: oiEdge,\n          strokes: uniqStrokes\n        }\n      }\n      default:\n        this.#logger.error(\"convertEdge\", `Conversion of Edge with kind equal to ${ JSON.stringify(edge) } is unknow`)\n        return\n    }\n  }\n\n  async apply(symbols: TIISymbol[] = []): Promise<void>\n  {\n    this.#logger.info(\"convert\")\n    if (!this.model.exports?.[\"application/vnd.myscript.jiix\"]) {\n      await this.editor.export([\"application/vnd.myscript.jiix\"])\n    }\n    this.editor.selector.removeSelectedGroup()\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"] as TJIIXExport\n    if (jiix?.elements?.length) {\n      const strokesToConvert = this.editor.extractStrokesFromSymbols(symbols.length ? symbols : this.model.symbols)\n\n      const onlyText = !jiix.elements?.some(e => e.type !== \"Text\")\n      const conversionResults: { symbol: TIISymbol, strokes: IIStroke[] }[] = []\n      jiix.elements.forEach(el =>\n      {\n        switch (el.type) {\n          case \"Text\": {\n            const conversion = this.convertText(el, strokesToConvert, onlyText)\n            if (conversion) {\n              conversionResults.push(...conversion)\n            }\n            break\n          }\n          case \"Node\": {\n            const conversion = this.convertNode(el, strokesToConvert)\n            if (conversion) {\n              conversionResults.push(conversion)\n            }\n            break\n          }\n          case \"Edge\": {\n            const conversion = this.convertEdge(el, strokesToConvert)\n            if (conversion) {\n              conversionResults.push(conversion)\n            }\n            break\n          }\n          default: {\n            this.#logger.warn(\"buildConversions\", `Unknow jiix element type: ${ el.type }`)\n          }\n        }\n      })\n\n      this.editor.addSymbols(conversionResults.map(cs => cs.symbol), false)\n      this.editor.removeSymbols(conversionResults.flatMap(cs => cs.strokes.map(s => s.id)), false)\n      this.editor.history.push(this.model, { added: conversionResults.map(c => c.symbol), erased: conversionResults.flatMap(cs => cs.strokes) })\n    }\n  }\n}\n","import { ResizeDirection, SvgElementRole } from \"../Constants\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport\n{\n  Box,\n  EdgeKind,\n  IIStroke,\n  IISymbolGroup,\n  IIText,\n  ShapeKind,\n  SymbolType,\n  TIIEdge,\n  TIIShape,\n  TIISymbol,\n  TPoint,\n  TIIRecognized,\n  RecognizedKind\n} from \"../symbol\"\n\n/**\n * @group Manager\n */\nexport class IIResizeManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.TRANSFORMER)\n  editor: InteractiveInkEditor\n\n  interactElementsGroup?: SVGElement\n  direction!: ResizeDirection\n  boundingBox!: Box\n  transformOrigin!: TPoint\n  keepRatio = false\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  protected applyToStroke(stroke: IIStroke, origin: TPoint, scaleX: number, scaleY: number): IIStroke\n  {\n    this.#logger.debug(\"applyToStroke\", { stroke, origin, scaleX, scaleY })\n    stroke.pointers.forEach(p =>\n    {\n      p.x = +(origin.x + scaleX * (p.x - origin.x)).toFixed(3)\n      p.y = +(origin.y + scaleY * (p.y - origin.y)).toFixed(3)\n    })\n    return stroke\n  }\n\n  protected applyToShape(shape: TIIShape, origin: TPoint, scaleX: number, scaleY: number): TIIShape\n  {\n    this.#logger.debug(\"applyToShape\", { shape, origin, scaleX, scaleY })\n    switch (shape.kind) {\n      case ShapeKind.Ellipse: {\n        const cosPhi = Math.cos(shape.orientation)\n        const sinPhi = Math.sin(shape.orientation)\n        shape.center.x = +(shape.center.x + ((scaleX - 1) * cosPhi + (scaleY - 1) * sinPhi) * (shape.center.x - origin.x)).toFixed(3)\n        shape.center.y = +(shape.center.y + ((scaleX - 1) * -sinPhi + (scaleY - 1) * cosPhi) * (shape.center.y - origin.y)).toFixed(3)\n        shape.radiusX = +(Math.abs(shape.radiusX * (scaleX * cosPhi - scaleY * sinPhi))).toFixed(3)\n        shape.radiusY = +(Math.abs(shape.radiusY * (scaleX * sinPhi + scaleY * cosPhi))).toFixed(3)\n        return shape\n      }\n      case ShapeKind.Circle: {\n        shape.radius = +(shape.radius * (scaleX + scaleY) / 2).toFixed(3)\n        shape.center.x = +(origin.x + scaleX * (shape.center.x - origin.x)).toFixed(3)\n        shape.center.y = +(origin.y + scaleY * (shape.center.y - origin.y)).toFixed(3)\n        return shape\n      }\n      case ShapeKind.Polygon: {\n        shape.points.forEach(p =>\n        {\n          p.x = +(origin.x + scaleX * (p.x - origin.x)).toFixed(3)\n          p.y = +(origin.y + scaleY * (p.y - origin.y)).toFixed(3)\n        })\n        return shape\n      }\n      default:\n        throw new Error(`Can't apply resize on shape, kind unknow: ${ JSON.stringify(shape) }`)\n    }\n  }\n\n  protected applyToEdge(edge: TIIEdge, origin: TPoint, scaleX: number, scaleY: number): TIIEdge\n  {\n    this.#logger.debug(\"applyToEdge\", { edge, origin, scaleX, scaleY })\n    switch (edge.kind) {\n      case EdgeKind.Arc: {\n        const cosPhi = Math.cos(edge.phi)\n        const sinPhi = Math.sin(edge.phi)\n        edge.center.x = +(edge.center.x + ((scaleX - 1) * cosPhi + (scaleY - 1) * sinPhi) * (edge.center.x - origin.x)).toFixed(3)\n        edge.center.y = +(edge.center.y + ((scaleX - 1) * -sinPhi + (scaleY - 1) * cosPhi) * (edge.center.y - origin.y)).toFixed(3)\n        edge.radiusX = +(edge.radiusX * Math.abs(scaleX * cosPhi + scaleY * sinPhi)).toFixed(3)\n        edge.radiusY = +(edge.radiusY * Math.abs(scaleX * sinPhi + scaleY * cosPhi)).toFixed(3)\n\n        if (scaleX < 0) {\n          edge.startAngle = +(Math.PI - edge.startAngle).toFixed(3)\n          edge.sweepAngle *= -1\n        }\n        else if (scaleY < 0) {\n          edge.sweepAngle *= -1\n        }\n        return edge\n      }\n      case EdgeKind.Line: {\n        edge.start.x = +(origin.x + scaleX * (edge.start.x - origin.x)).toFixed(3)\n        edge.start.y = +(origin.y + scaleY * (edge.start.y - origin.y)).toFixed(3)\n        edge.end.x = +(origin.x + scaleX * (edge.end.x - origin.x)).toFixed(3)\n        edge.end.y = +(origin.y + scaleY * (edge.end.y - origin.y)).toFixed(3)\n        return edge\n      }\n      case EdgeKind.PolyEdge: {\n        edge.points.forEach(p =>\n        {\n          p.x = +(origin.x + scaleX * (p.x - origin.x)).toFixed(3)\n          p.y = +(origin.y + scaleY * (p.y - origin.y)).toFixed(3)\n          return p\n        })\n        return edge\n      }\n      default:\n        throw new Error(`Can't apply resize on edge, kind unknow: ${ JSON.stringify(edge) }`)\n    }\n  }\n\n  protected applyOnText(text: IIText, origin: TPoint, scaleX: number, scaleY: number): IIText\n  {\n    text.point.x = +(origin.x + scaleX * (text.point.x - origin.x)).toFixed(3)\n    text.point.y = +(origin.y + scaleY * (text.point.y - origin.y)).toFixed(3)\n\n    text.chars.forEach(c =>\n    {\n      c.fontSize = +(c.fontSize * (scaleX + scaleY) / 2).toFixed(3)\n    })\n    return this.editor.texter.updateBounds(text)\n  }\n\n  protected applyOnGroup(group: IISymbolGroup, origin: TPoint, scaleX: number, scaleY: number): IISymbolGroup\n  {\n    group.children.forEach(s => this.applyToSymbol(s, origin, scaleX, scaleY))\n    return group\n  }\n\n  protected applyOnRecognizedSymbol(recognizedSymbol: TIIRecognized, origin: TPoint, scaleX: number, scaleY: number): TIIRecognized\n  {\n    recognizedSymbol.strokes.forEach(s => this.applyToStroke(s, origin, scaleX, scaleY))\n    if (recognizedSymbol.kind === RecognizedKind.Text) {\n      recognizedSymbol.xHeight *= scaleY\n    }\n    return recognizedSymbol\n  }\n\n  applyToSymbol(symbol: TIISymbol, origin: TPoint, scaleX: number, scaleY: number): TIISymbol\n  {\n    this.#logger.info(\"applyToSymbol\", { symbol, scaleX, scaleY })\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        return this.applyToStroke(symbol, origin, scaleX, scaleY)\n      case SymbolType.Shape:\n        return this.applyToShape(symbol, origin, scaleX, scaleY)\n      case SymbolType.Edge:\n        return this.applyToEdge(symbol, origin, scaleX, scaleY)\n      case SymbolType.Text:\n        return this.applyOnText(symbol, origin, scaleX, scaleY)\n      case SymbolType.Group:\n        return this.applyOnGroup(symbol, origin, scaleX, scaleY)\n      case SymbolType.Recognized:\n        return this.applyOnRecognizedSymbol(symbol, origin, scaleX, scaleY)\n      default:\n        throw new Error(`Can't apply resize on symbol, type unknow: ${ JSON.stringify(symbol) }`)\n    }\n  }\n\n  setTransformOrigin(id: string, originX: number, originY: number): void\n  {\n    this.editor.renderer.setAttribute(id, \"transform-origin\", `${ originX }px ${ originY }px`)\n  }\n\n  scaleElement(id: string, sx: number, sy: number): void\n  {\n    this.#logger.info(\"scaleElement\", { id, sx, sy })\n    this.editor.renderer.setAttribute(id, \"transform\", `scale(${ sx },${ sy })`)\n  }\n\n  start(target: Element, origin: TPoint): void\n  {\n    this.#logger.info(\"start\", { target })\n    this.interactElementsGroup = (target.closest(`[role=${ SvgElementRole.InteractElementsGroup }]`) as unknown) as SVGGElement\n    this.direction = target.getAttribute(\"resize-direction\") as ResizeDirection\n\n    this.keepRatio = this.model.symbolsSelected.some(s => s.type === SymbolType.Text || (s.type === SymbolType.Shape && (s as TIIShape).kind === ShapeKind.Circle))\n\n    this.transformOrigin = origin\n    this.boundingBox = Box.createFromPoints(this.model.symbolsSelected.flatMap(s => s.vertices))\n    this.setTransformOrigin(this.interactElementsGroup!.id, this.transformOrigin.x, this.transformOrigin.y)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.setTransformOrigin(s.id, this.transformOrigin.x, this.transformOrigin.y)\n    })\n  }\n\n  continue(point: TPoint): { scaleX: number, scaleY: number }\n  {\n    this.#logger.info(\"continue\", { point })\n    if (!this.interactElementsGroup) {\n      throw new Error(\"Can't resize, you must call start before\")\n    }\n    const localPoint = point\n    const horizontalResize = [\n      ResizeDirection.East,\n      ResizeDirection.NorthEast,\n      ResizeDirection.SouthEast,\n      ResizeDirection.West,\n      ResizeDirection.NorthWest,\n      ResizeDirection.SouthWest\n    ].includes(this.direction)\n    const verticalResize = [\n      ResizeDirection.North,\n      ResizeDirection.NorthEast,\n      ResizeDirection.NorthWest,\n      ResizeDirection.South,\n      ResizeDirection.SouthEast,\n      ResizeDirection.SouthWest\n    ].includes(this.direction)\n    const { x, y } = this.editor.snaps.snapResize(point, horizontalResize, verticalResize)\n    localPoint.x = x\n    localPoint.y = y\n\n    let deltaX = 0, deltaY = 0\n    if ([ResizeDirection.East, ResizeDirection.NorthEast, ResizeDirection.SouthEast].includes(this.direction)) {\n      deltaX = localPoint.x - this.boundingBox.xMax\n    }\n    else if ([ResizeDirection.West, ResizeDirection.NorthWest, ResizeDirection.SouthWest].includes(this.direction)) {\n      deltaX = this.boundingBox.xMin - localPoint.x\n    }\n\n    if ([ResizeDirection.North, ResizeDirection.NorthEast, ResizeDirection.NorthWest].includes(this.direction)) {\n      deltaY = this.boundingBox.yMin - localPoint.y\n    }\n    else if ([ResizeDirection.South, ResizeDirection.SouthEast, ResizeDirection.SouthWest].includes(this.direction)) {\n      deltaY = localPoint.y - this.boundingBox.yMax\n    }\n\n    let scaleX = this.boundingBox.width ? 1 + (deltaX / this.boundingBox.width) : 1\n    let scaleY = this.boundingBox.height ? 1 + (deltaY / this.boundingBox.height) : 1\n\n    if (this.keepRatio) {\n      if ([ResizeDirection.North, ResizeDirection.South].includes(this.direction)) {\n        scaleX = scaleY\n      }\n      else if ([ResizeDirection.East, ResizeDirection.West].includes(this.direction)) {\n        scaleY = scaleX\n      }\n      else {\n        scaleX = Math.max(scaleX, scaleY)\n        scaleY = scaleX\n      }\n    }\n    this.scaleElement(this.interactElementsGroup.id, scaleX, scaleY)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.scaleElement(s.id, scaleX, scaleY)\n    })\n    return {\n      scaleX,\n      scaleY\n    }\n  }\n\n  async end(point: TPoint): Promise<void>\n  {\n    this.#logger.info(\"end\", { point })\n    const { scaleX, scaleY } = this.continue(point)\n    this.editor.snaps.clearSnapToElementLines()\n    const oldSymbols = this.model.symbolsSelected.map(s => s.clone())\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.applyToSymbol(s, this.transformOrigin, scaleX, scaleY)\n      this.editor.renderer.drawSymbol(s)\n      this.model.updateSymbol(s)\n    })\n\n    const strokesFromSymbols = this.editor.extractStrokesFromSymbols(this.model.symbolsSelected)\n    this.editor.recognizer.transformScale(strokesFromSymbols.map(s => s.id), scaleX, scaleY, this.transformOrigin.x, this.transformOrigin.y)\n    this.editor.history.push(this.model, { scale: [{ symbols: oldSymbols, origin: {...this.transformOrigin}, scaleX, scaleY }] })\n\n    this.interactElementsGroup = undefined\n    this.editor.svgDebugger.apply()\n  }\n}\n","import { SvgElementRole } from \"../Constants\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport\n{\n  Box,\n  EdgeKind,\n  IIStroke,\n  IISymbolGroup,\n  IIText,\n  TIIRecognized,\n  ShapeKind,\n  SymbolType,\n  TIIEdge,\n  TIIShape,\n  TIISymbol,\n  TPoint\n} from \"../symbol\"\nimport { computeAngleRadian, convertDegreeToRadian, convertRadianToDegree, computeRotatedPoint } from \"../utils\"\n\n/**\n * @group Manager\n */\nexport class IIRotationManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.TRANSFORMER)\n  editor: InteractiveInkEditor\n  interactElementsGroup?: SVGElement\n  center!: TPoint\n  origin!: TPoint\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  protected applyToStroke(stroke: IIStroke, center: TPoint, angleRad: number): IIStroke\n  {\n    stroke.pointers.forEach(p =>\n    {\n      const { x, y } = computeRotatedPoint(p, center, angleRad)\n      p.x = x\n      p.y = y\n    })\n    return stroke\n  }\n\n  protected applyToShape(shape: TIIShape, center: TPoint, angleRad: number): TIIShape\n  {\n    switch (shape.kind) {\n      case ShapeKind.Ellipse: {\n        shape.center = computeRotatedPoint(shape.center, center, angleRad)\n        shape.orientation = (shape.orientation + angleRad) % (2 * Math.PI)\n        return shape\n      }\n      case ShapeKind.Circle: {\n        shape.center = computeRotatedPoint(shape.center, center, angleRad)\n        return shape\n      }\n      case ShapeKind.Polygon: {\n        shape.points.forEach(p =>\n        {\n          const { x, y } = computeRotatedPoint(p, center, angleRad)\n          p.x = x\n          p.y = y\n        })\n        return shape\n      }\n      default:\n        throw new Error(`Can't apply rotate on shape, kind unknow: ${ JSON.stringify(shape) }`)\n    }\n  }\n\n  protected applyToEdge(edge: TIIEdge, center: TPoint, angleRad: number): TIIEdge\n  {\n    switch (edge.kind) {\n      case EdgeKind.Arc: {\n        edge.phi = (edge.phi - angleRad) % (2 * Math.PI)\n        edge.center = computeRotatedPoint(edge.center, center, angleRad)\n        return edge\n      }\n      case EdgeKind.Line: {\n        edge.start = computeRotatedPoint(edge.start, center, angleRad)\n        edge.end = computeRotatedPoint(edge.end, center, angleRad)\n        return edge\n      }\n      case EdgeKind.PolyEdge: {\n        edge.points = edge.points.map(p => computeRotatedPoint(p, center, angleRad))\n        return edge\n      }\n      default:\n        throw new Error(`Can't apply rotate on edge, kind unknow: ${ JSON.stringify(edge) }`)\n    }\n    return edge\n  }\n\n  protected applyOnText(text: IIText, center: TPoint, angleRad: number): IIText\n  {\n    text.rotation = {\n      degree: convertRadianToDegree(angleRad) + (text.rotation?.degree || 0),\n      center: center\n    }\n    return this.editor.texter.updateBounds(text)\n  }\n\n  protected applyOnGroup(group: IISymbolGroup, center: TPoint, angleRad: number): IISymbolGroup\n  {\n    group.children.forEach(s => this.applyToSymbol(s, center, angleRad))\n    return group\n  }\n\n  protected applyOnRecognizedSymbol(strokeText: TIIRecognized, center: TPoint, angleRad: number): TIIRecognized\n  {\n    strokeText.strokes.forEach(s => this.applyToStroke(s, center, angleRad))\n    return strokeText\n  }\n\n  applyToSymbol(symbol: TIISymbol, center: TPoint, angleRad: number): TIISymbol\n  {\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        return this.applyToStroke(symbol, center, angleRad)\n      case SymbolType.Shape:\n        return this.applyToShape(symbol, center, angleRad)\n      case SymbolType.Edge:\n        return this.applyToEdge(symbol, center, angleRad)\n      case SymbolType.Text:\n        return this.applyOnText(symbol, center, angleRad)\n      case SymbolType.Group:\n        return this.applyOnGroup(symbol, center, angleRad)\n      case SymbolType.Recognized:\n        return this.applyOnRecognizedSymbol(symbol, center, angleRad)\n      default:\n        throw new Error(`Can't apply rotate on symbol, type unknow: ${ JSON.stringify(symbol) }`)\n    }\n  }\n\n  setTransformOrigin(id: string, originX: number, originY: number): void\n  {\n    this.editor.renderer.setAttribute(id, \"transform-origin\", `${ originX }px ${ originY }px`)\n  }\n\n  rotateElement(id: string, degree: number): void\n  {\n    this.#logger.info(\"rotateElement\", { id, degree })\n    this.editor.renderer.setAttribute(id, \"transform\", `rotate(${ degree })`)\n  }\n\n  start(target: Element, origin: TPoint): void\n  {\n    this.#logger.info(\"start\", { target })\n    this.interactElementsGroup = (target.closest(`[role=${ SvgElementRole.InteractElementsGroup }]`) as unknown) as SVGGElement\n    const boundingBox = Box.createFromPoints(this.model.symbolsSelected.flatMap(s => s.vertices))\n\n    this.center = {\n      x: boundingBox.xMin + boundingBox.width / 2,\n      y: boundingBox.yMid\n    }\n    this.origin = origin\n    this.setTransformOrigin(this.interactElementsGroup.id, this.center.x, this.center.y)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.setTransformOrigin(s.id, this.center.x, this.center.y)\n    })\n  }\n\n  continue(point: TPoint): number\n  {\n    this.#logger.info(\"continue\", { point })\n    if (!this.interactElementsGroup) {\n      throw new Error(\"Can't rotate, you must call start before\")\n    }\n    let angleDegree = Math.round(convertRadianToDegree(computeAngleRadian(this.origin, this.center, point)))\n\n    angleDegree = this.editor.snaps.snapRotation(angleDegree)\n\n    if (point.x - this.center.x < 0) {\n      angleDegree = 360 - angleDegree\n    }\n\n    this.rotateElement(this.interactElementsGroup.id, angleDegree)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.rotateElement(s.id, angleDegree)\n    })\n    return angleDegree\n  }\n\n  async end(point: TPoint): Promise<void>\n  {\n    this.#logger.info(\"end\", { point })\n    const angleDegree = this.continue(point)\n    const angleRad = convertDegreeToRadian(angleDegree) % (2 * Math.PI)\n    const oldSymbols = this.model.symbolsSelected.map(s => s.clone())\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.applyToSymbol(s, this.center, angleRad)\n      this.editor.renderer.drawSymbol(s)\n      this.model.updateSymbol(s)\n    })\n    const strokesFromSymbols = this.editor.extractStrokesFromSymbols(this.model.symbolsSelected)\n    this.editor.recognizer.transformRotate(strokesFromSymbols.map(s => s.id), angleRad, this.center.x, this.center.y)\n    this.editor.history.push(this.model, { rotate: [{ symbols: oldSymbols, angle: angleRad, center: {...this.center}, }] })\n\n    this.interactElementsGroup = undefined\n    this.editor.svgDebugger.apply()\n  }\n}\n","import { ResizeDirection, SELECTION_MARGIN, SvgElementRole } from \"../Constants\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { Box, IIText, SymbolType, TBox, TIIEdge, TIISymbol, TPoint } from \"../symbol\"\nimport { SVGRenderer, SVGBuilder } from \"../renderer\"\nimport { IIResizeManager } from \"./IIResizeManager\"\nimport { IIRotationManager } from \"./IIRotationManager\"\nimport { IITranslateManager } from \"./IITranslateManager\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\n\n/**\n * @group Manager\n */\nexport class IISelectionManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.SELECTION)\n  grabber: PointerEventGrabber\n  editor: InteractiveInkEditor\n\n  #selectingId = \"selecting-rect\"\n  startSelectionPoint?: TPoint\n  endSelectionPoint?: TPoint\n  selectedGroup?: SVGGElement\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.grabber = new PointerEventGrabber(editor.configuration.grabber)\n    this.grabber.onPointerDown = this.start.bind(this)\n    this.grabber.onPointerMove = this.continue.bind(this)\n    this.grabber.onPointerUp = this.end.bind(this)\n    this.grabber.onContextMenu = this.onContextMenu.bind(this)\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get rotator(): IIRotationManager\n  {\n    return this.editor.rotator\n  }\n\n  get translator(): IITranslateManager\n  {\n    return this.editor.translator\n  }\n\n  get resizer(): IIResizeManager\n  {\n    return this.editor.resizer\n  }\n\n  get selectionBox(): Box | undefined\n  {\n    if (this.startSelectionPoint && this.endSelectionPoint) {\n      return Box.createFromPoints([this.startSelectionPoint, this.endSelectionPoint])\n    }\n    return\n  }\n\n  attach(layer: HTMLElement): void\n  {\n    this.removeSelectedGroup()\n    this.grabber.attach(layer)\n  }\n\n  detach(): void\n  {\n    this.removeSelectedGroup()\n    this.grabber.detach()\n  }\n\n  drawSelectingRect(box: TBox): void\n  {\n    this.clearSelectingRect()\n    const attrs = {\n      id: this.#selectingId,\n      fill: \"transparent\",\n      stroke: \"grey\",\n      opacity: \"0.25\",\n    }\n    this.renderer.appendElement(SVGBuilder.createRect(box, attrs))\n  }\n\n  clearSelectingRect(): void\n  {\n    this.renderer.clearElements({ attrs: { id: this.#selectingId } })\n  }\n\n  protected getPoint(ev: PointerEvent): TPoint\n  {\n    const { clientLeft, scrollLeft, clientTop, scrollTop } = this.renderer.parent\n    const rect: DOMRect = this.renderer.parent.getBoundingClientRect()\n    return {\n      x: ev.clientX - rect.left - clientLeft + scrollLeft,\n      y: ev.clientY - rect.top - clientTop + scrollTop,\n    }\n  }\n\n  protected createTranslateRect(box: TBox): SVGRectElement\n  {\n    const attrs = {\n      role: SvgElementRole.Translate,\n      style: \"cursor:move\",\n      fill: \"transparent\",\n      stroke: \"transparent\",\n    }\n    const boxWithMarge: TBox = {\n      height: box.height,\n      width: box.width,\n      x: box.x,\n      y: box.y\n    }\n    const translateEl = SVGBuilder.createRect(boxWithMarge, attrs)\n    const handler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.translator.continue(this.getPoint(ev))\n    }\n    const endHandler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.translator.end(this.getPoint(ev))\n      this.renderer.layer.removeEventListener(\"pointermove\", handler)\n      this.renderer.layer.removeEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerup\", endHandler)\n      this.renderer.layer.style.cursor = \"\"\n      this.resetSelectedGroup(this.model.symbolsSelected)\n    }\n\n    translateEl.addEventListener(\"pointerdown\", (ev) =>\n    {\n      if (ev.button !== 0 || ev.buttons !== 1) {\n        return\n      }\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.hideInteractElements()\n      this.translator.start(ev.target as Element, this.getPoint(ev))\n      this.renderer.layer.addEventListener(\"pointermove\", handler)\n      this.renderer.layer.addEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerup\", endHandler)\n\n      this.renderer.layer.style.cursor = \"move\"\n    })\n    return translateEl\n  }\n\n  protected createRotateGroup(box: TBox): SVGGElement\n  {\n    const group = SVGBuilder.createGroup({\n      role: SvgElementRole.Rotate,\n      \"vector-effect\": \"non-scaling-size\",\n      \"style\": \"cursor:pointer;\",\n      \"opacity\": \"1\",\n    })\n    const radius = 8\n    const center: TPoint = {\n      x: (box.x + box.width / 2),\n      y: box.y - 4 * SELECTION_MARGIN\n    }\n    const attrs1 = {\n      role: SvgElementRole.Rotate,\n      \"stroke-width\": \"2\",\n      \"stroke\": \"black\",\n      fill: \"white\",\n    }\n    group.appendChild(SVGBuilder.createCircle(center, radius, attrs1))\n\n    const attrs2 = {\n      role: SvgElementRole.Rotate,\n      fill: \"black\",\n    }\n\n    group.appendChild(SVGBuilder.createCircle(center, radius / 2, attrs2))\n    const attrs3 = {\n      role: SvgElementRole.Rotate,\n      stroke: \"black\",\n      \"stroke-width\": \"2\"\n    }\n    group.appendChild(SVGBuilder.createLine({ x: center.x, y: center.y + radius }, { x: center.x, y: box.y - SELECTION_MARGIN }, attrs3))\n\n    const handler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.rotator.continue(this.getPoint(ev))\n    }\n    const endHandler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.rotator.end(this.getPoint(ev))\n      this.renderer.layer.removeEventListener(\"pointermove\", handler)\n      this.renderer.layer.removeEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerup\", endHandler)\n      this.resetSelectedGroup(this.model.symbolsSelected)\n    }\n\n    group.addEventListener(\"pointerdown\", (ev) =>\n    {\n      if (ev.button !== 0 || ev.buttons !== 1) {\n        return\n      }\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.hideInteractElements()\n      this.rotator.start(ev.target as Element, this.getPoint(ev))\n      this.renderer.layer.addEventListener(\"pointermove\", handler)\n      this.renderer.layer.addEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerup\", endHandler)\n    })\n    return group\n  }\n\n  protected createResizeGroup(box: TBox): SVGGElement\n  {\n    const group = SVGBuilder.createGroup({\n      role: SvgElementRole.Resize,\n      \"vector-effect\": \"non-scaling-size\",\n      \"stroke-width\": \"4\",\n      \"stroke\": \"#3e68ff\",\n    })\n    const P_NW: TPoint = { x: box.x - SELECTION_MARGIN, y: box.y - SELECTION_MARGIN }\n    const P_NE: TPoint = { x: box.x + box.width + SELECTION_MARGIN, y: box.y - SELECTION_MARGIN }\n    const P_SE: TPoint = { x: box.x + box.width + SELECTION_MARGIN, y: box.y + box.height + SELECTION_MARGIN }\n    const P_SW: TPoint = { x: box.x - SELECTION_MARGIN, y: box.y + box.height + SELECTION_MARGIN }\n\n    const bindEl = (el: SVGElement, transformOrigin: TPoint, cursor: string) =>\n    {\n      const handler = (ev: PointerEvent) =>\n      {\n        ev.preventDefault()\n        ev.stopPropagation()\n        this.resizer.continue(this.getPoint(ev))\n      }\n      const endHandler = (ev: PointerEvent) =>\n      {\n        ev.preventDefault()\n        ev.stopPropagation()\n        this.resizer.end(this.getPoint(ev))\n        this.renderer.layer.removeEventListener(\"pointermove\", handler)\n        this.renderer.layer.removeEventListener(\"pointercancel\", endHandler)\n        this.renderer.layer.removeEventListener(\"pointerleave\", endHandler)\n        this.renderer.layer.removeEventListener(\"pointerup\", endHandler)\n\n        this.renderer.layer.style.cursor = \"\"\n        this.resetSelectedGroup(this.model.symbolsSelected)\n      }\n\n      el.addEventListener(\"pointerdown\", (ev) =>\n      {\n        if (ev.button !== 0 || ev.buttons !== 1) {\n          return\n        }\n        ev.preventDefault()\n        ev.stopPropagation()\n        this.hideInteractElements()\n        this.renderer.layer.style.cursor = cursor\n        this.resizer.start(ev.target as Element, transformOrigin)\n        this.renderer.layer.addEventListener(\"pointermove\", handler)\n        this.renderer.layer.addEventListener(\"pointercancel\", endHandler)\n        this.renderer.layer.addEventListener(\"pointerleave\", endHandler)\n        this.renderer.layer.addEventListener(\"pointerup\", endHandler)\n      })\n    }\n\n    const sideResizeDefs = [\n      { direction: ResizeDirection.North, p1: P_NW, p2: P_NE, transformOrigin: { x: box.x + box.width / 2, y: box.y + box.height } },\n      { direction: ResizeDirection.East, p1: P_NE, p2: P_SE, transformOrigin: { x: box.x, y: box.y + box.height / 2 } },\n      { direction: ResizeDirection.South, p1: P_SW, p2: P_SE, transformOrigin: { x: box.x + box.width / 2, y: box.y } },\n      { direction: ResizeDirection.West, p1: P_NW, p2: P_SW, transformOrigin: { x: box.x + box.width, y: box.y + box.height / 2 } },\n    ]\n    sideResizeDefs.forEach(def =>\n    {\n      const attrs = {\n        role: SvgElementRole.Resize,\n        \"resize-direction\": def.direction,\n        \"transform-origin\": JSON.stringify(def.transformOrigin),\n        style: `cursor:${ def.direction };`\n      }\n      const lineResize = SVGBuilder.createLine(def.p1, def.p2, attrs)\n      bindEl(lineResize, def.transformOrigin, def.direction)\n      group.appendChild(lineResize)\n    })\n    const cornerResizeDefs = [\n      { direction: ResizeDirection.NorthWest, p: P_NW, transformOrigin: { x: box.x + box.width, y: box.y + box.height } },\n      { direction: ResizeDirection.NorthEast, p: P_NE, transformOrigin: { x: box.x, y: box.y + box.height } },\n      { direction: ResizeDirection.SouthEast, p: P_SE, transformOrigin: { x: box.x, y: box.y } },\n      { direction: ResizeDirection.SouthWest, p: P_SW, transformOrigin: { x: box.x + box.width, y: box.y } },\n    ]\n    cornerResizeDefs.forEach(def =>\n    {\n      const attrs = {\n        \"stroke-width\": \"4\",\n        role: SvgElementRole.Resize,\n        \"resize-direction\": def.direction,\n        \"transform-origin\": JSON.stringify(def.transformOrigin),\n        transform: \"scale(1, 1)\",\n        fill: \"white\",\n        style: `cursor:${ def.direction };`\n      }\n      const cornerResize = SVGBuilder.createCircle(def.p, 5, attrs)\n      bindEl(cornerResize, def.transformOrigin, def.direction)\n      group.appendChild(cornerResize)\n    })\n    return group\n  }\n\n  protected createInteractElementsGroup(symbols: TIISymbol[]): SVGGElement | undefined\n  {\n    this.#logger.info(\"createInteractElementsGroup\", { symbols })\n\n    if (!symbols.length) return\n\n    const symbolElementMap = symbols.map(s =>\n    {\n      return {\n        symbol: s,\n        element: this.renderer.getElementById(s.id),\n      }\n    })\n\n    const box1 = Box.createFromBoxes(symbols.map(s =>\n    {\n      return {\n        x: s.bounds.x - (s.style.width || 1),\n        y: s.bounds.y - (s.style.width || 1),\n        height: s.bounds.height + (s.style.width || 1) * 2,\n        width: s.bounds.width + (s.style.width || 1) * 2,\n      }\n    }))\n\n    const box2 = Box.createFromPoints(symbols.flatMap(s => s.vertices))\n    const box = Box.createFromBoxes([box1, box2])\n\n    const attrs = {\n      id: `selected-${ Date.now() }`,\n      role: SvgElementRole.InteractElementsGroup,\n    }\n    const surroundGroup = SVGBuilder.createGroup(attrs)\n    surroundGroup.appendChild(this.createTranslateRect(box))\n    surroundGroup.appendChild(this.createResizeGroup(box))\n    surroundGroup.appendChild(this.createRotateGroup(box))\n    const SURROUND_ATTRS = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"#3e68ff\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"4\",\n      \"vector-effect\": \"non-scaling-size\",\n      transform: \"rotate(0, 0, 0)\"\n    }\n    symbolElementMap.forEach(s =>\n    {\n      if (s.element) {\n        const bounds: TBox = {\n          x: s.symbol.bounds.x - (s.symbol.style.width || 1),\n          y: s.symbol.bounds.y - (s.symbol.style.width || 1),\n          height: s.symbol.bounds.height + (s.symbol.style.width || 1) * 2,\n          width: s.symbol.bounds.width + (s.symbol.style.width || 1) * 2,\n        }\n        if (s.symbol.type === SymbolType.Text) {\n          const t = s.symbol as IIText\n          SURROUND_ATTRS.transform = `rotate(${ t.rotation?.degree || 0 }, ${ t.rotation?.center.x || 0 }, ${ t.rotation?.center.y || 0 })`\n        }\n        else {\n          SURROUND_ATTRS.transform = \"rotate(0, 0, 0)\"\n        }\n        surroundGroup.prepend(SVGBuilder.createRect(bounds, SURROUND_ATTRS))\n      }\n    })\n    return surroundGroup\n  }\n\n  protected createEdgeResizeGroup(edge: TIIEdge): SVGGElement\n  {\n    const group = SVGBuilder.createGroup({\n      role: SvgElementRole.Resize,\n      \"vector-effect\": \"non-scaling-size\",\n      \"stroke-width\": \"4\",\n      \"stroke\": \"#3e68ff\",\n    })\n\n    const radius = 5\n    const attrs = {\n      role: SvgElementRole.Resize,\n      \"stroke-width\": \"4\",\n      \"stroke\": \"#3e68ff\",\n      fill: \"white\",\n      style: `cursor:grab;`\n    }\n    const bindEl = (el: SVGCircleElement, pointIndex: number) =>\n    {\n      const handler = (ev: PointerEvent) =>\n      {\n        ev.preventDefault()\n        ev.stopPropagation()\n        const point = this.getPoint(ev)\n        const { x, y } = this.editor.snaps.snapResize(point)\n        edge.vertices[pointIndex].x = x\n        edge.vertices[pointIndex].y = y\n        this.model.updateSymbol(edge)\n        this.renderer.drawSymbol(edge)\n      }\n      const endHandler = (ev: PointerEvent) =>\n      {\n        ev.preventDefault()\n        ev.stopPropagation()\n        const point = this.getPoint(ev)\n        const { x, y } = this.editor.snaps.snapResize(point)\n        edge.vertices[pointIndex].x = x\n        edge.vertices[pointIndex].y = y\n        this.renderer.layer.style.cursor = \"\"\n        this.editor.updateSymbol(edge)\n        this.renderer.layer.removeEventListener(\"pointermove\", handler)\n        this.renderer.layer.removeEventListener(\"pointercancel\", endHandler)\n        this.renderer.layer.removeEventListener(\"pointerleave\", endHandler)\n        this.renderer.layer.removeEventListener(\"pointerup\", endHandler)\n        this.editor.snaps.clearSnapToElementLines()\n        this.resetSelectedGroup(this.model.symbolsSelected)\n      }\n\n      el.addEventListener(\"pointerdown\", (ev) =>\n      {\n        if (ev.button !== 0 || ev.buttons !== 1) {\n          return\n        }\n        this.renderer.layer.style.cursor = \"grabbing\"\n        this.hideInteractElements()\n        ev.preventDefault()\n        ev.stopPropagation()\n        this.renderer.layer.addEventListener(\"pointermove\", handler)\n        this.renderer.layer.addEventListener(\"pointercancel\", endHandler)\n        this.renderer.layer.addEventListener(\"pointerleave\", endHandler)\n        this.renderer.layer.addEventListener(\"pointerup\", endHandler)\n      })\n    }\n    edge.vertices.forEach((p, i) =>\n    {\n      const pointEl = SVGBuilder.createCircle(p, radius, attrs)\n      bindEl(pointEl, i)\n      group.appendChild(pointEl)\n    })\n\n    return group\n  }\n\n  protected createInteractEdgeGroup(edge: TIIEdge): SVGGElement | undefined\n  {\n    this.#logger.info(\"createInteractEdgeGroup\", { edge })\n    const attrs = {\n      id: `selected-${ Date.now() }`,\n      role: SvgElementRole.InteractElementsGroup,\n    }\n    const surroundGroup = SVGBuilder.createGroup(attrs)\n    surroundGroup.appendChild(this.createTranslateRect(edge.bounds))\n    surroundGroup.appendChild(this.createEdgeResizeGroup(edge.clone()))\n    return surroundGroup\n  }\n\n  drawSelectedGroup(symbols: TIISymbol[]): void\n  {\n    if (!symbols.length) return\n    if (symbols.length === 1 && symbols[0].type === SymbolType.Edge) {\n      this.selectedGroup = this.createInteractEdgeGroup(symbols[0] as TIIEdge)\n    }\n    else {\n      this.selectedGroup = this.createInteractElementsGroup(symbols)\n    }\n    if (this.selectedGroup) {\n      this.renderer.layer.appendChild(this.selectedGroup)\n      const groupBox = this.selectedGroup.getBBox()\n      this.editor.menu.context.position.x = groupBox.x + groupBox.width / 2 - this.renderer.parent.clientLeft\n      this.editor.menu.context.position.y = groupBox.y + groupBox.height - this.renderer.parent.clientTop\n      this.editor.menu.context.show()\n    }\n    this.editor.menu.update()\n  }\n\n  resetSelectedGroup(symbols: TIISymbol[]): void\n  {\n    this.#logger.info(\"resetSelectedGroup\", { symbols })\n    this.removeSelectedGroup()\n    this.drawSelectedGroup(symbols)\n  }\n\n  removeSelectedGroup(): void\n  {\n    this.#logger.info(\"removeSelectedGroup\")\n    this.editor.menu.context.hide()\n    this.selectedGroup?.remove()\n    this.selectedGroup = undefined\n  }\n\n  hideInteractElements(): void\n  {\n    this.editor.menu.context.hide()\n    const query = `[role=${ SvgElementRole.Resize }],[role=${ SvgElementRole.Rotate }],[role=${ SvgElementRole.Translate }]`\n    this.selectedGroup?.querySelectorAll(query)\n      .forEach(el =>\n      {\n        el.setAttribute(\"visibility\", \"hidden\")\n      })\n  }\n\n  start(info: PointerInfo): void\n  {\n    this.removeSelectedGroup()\n    this.startSelectionPoint = info.pointer\n    this.endSelectionPoint = info.pointer\n    this.drawSelectingRect(this.selectionBox!)\n  }\n\n  continue(info: PointerInfo): TIISymbol[]\n  {\n    if (!this.startSelectionPoint) {\n      throw new Error(\"You need to call startSelectionByBox before\")\n    }\n    this.endSelectionPoint = info.pointer\n    const updatedSymbols: TIISymbol[] = []\n    this.model.symbols.forEach(s =>\n    {\n      if (s.selected !== s.overlaps(this.selectionBox!)) {\n        s.selected = s.overlaps(this.selectionBox!)\n        updatedSymbols.push(s)\n        this.renderer.drawSymbol(s)\n      }\n    })\n    this.drawSelectingRect(this.selectionBox!)\n    return updatedSymbols\n  }\n\n  end(info: PointerInfo): TIISymbol[]\n  {\n    const updatedSymbols = this.continue(info)\n    this.startSelectionPoint = undefined\n    this.endSelectionPoint = undefined\n    this.clearSelectingRect()\n    this.drawSelectedGroup(this.model.symbolsSelected)\n    this.editor.event.emitSelected(this.model.symbolsSelected)\n    this.editor.menu.style.update()\n    return updatedSymbols\n  }\n\n  protected async onContextMenu(info: PointerInfo): Promise<void>\n  {\n    let found = false\n    let currentEl = info.target as HTMLElement | null\n    const symbolTypesAllowed = [SymbolType.Edge, SymbolType.Shape, SymbolType.Stroke, SymbolType.Text]\n    while (currentEl && currentEl.tagName !== \"svg\" && !found) {\n      if (symbolTypesAllowed.includes(currentEl.getAttribute(\"type\") as SymbolType)) {\n        found = true\n      }\n      else {\n        currentEl = currentEl.parentElement\n      }\n    }\n    this.editor.unselectAll()\n    if (currentEl?.id) {\n      this.model.selectSymbol(currentEl.id)\n      this.renderer.drawSymbol(this.model.symbolsSelected[0])\n      this.drawSelectedGroup(this.model.symbolsSelected)\n      this.editor.updateLayerUI()\n    }\n    else {\n      this.editor.menu.context.position.x = info.pointer.x + this.renderer.parent.clientLeft\n      this.editor.menu.context.position.y = info.pointer.y + this.renderer.parent.clientTop\n      this.editor.menu.context.show()\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { Box, IIText, SymbolType, TIISymbol, TIISymbolChar } from \"../symbol\"\nimport { SVGRenderer } from \"../renderer\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\n\n/**\n * @group Manager\n */\nexport class IITextManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.CONVERTER)\n  editor: InteractiveInkEditor\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get rowHeight(): number\n  {\n    return this.editor.configuration.rendering.guides.gap\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  protected drawSymbolHidden(text: IIText): SVGGElement\n  {\n    const clone = text.clone()\n    clone.id = \"text-to-measure\"\n    clone.chars.forEach(c => c.id += \"-to-measure\")\n    clone.decorators = []\n    this.renderer.layer.querySelector(`#${ clone.id }`)?.remove()\n    const el = this.renderer.buildElementFromSymbol(clone)!\n    el.setAttribute(\"visibility\", \"hidden\")\n    this.renderer.prependElement(el)\n    return el\n  }\n\n  setCharsBounds(text: IIText, textGroupEl: SVGGElement): IIText\n  {\n    const textEl = textGroupEl.querySelector(\"text\")\n    if (textEl) {\n      for (let i = 0; i < textEl.getNumberOfChars(); i++) {\n        const char = text.chars.at(i)\n        if (char) {\n          const ext = textEl.getExtentOfChar(i)\n          char.bounds = new Box(ext)\n        }\n      }\n    }\n    return text\n  }\n\n  setBounds(text: IIText): void\n  {\n    const element = this.drawSymbolHidden(text)\n    text.bounds = this.getElementBoundingBox(element)\n    this.setCharsBounds(text, element)\n  }\n\n  getElementBoundingBox(textElement: SVGElement): Box\n  {\n    return new Box(textElement.querySelector(\"text\")!.getBBox({ stroke: true, markers: true, clipped: true, fill: true }))\n  }\n\n  getBoundingBox(text: IIText): Box\n  {\n    const element = this.drawSymbolHidden(text)\n    return this.getElementBoundingBox(element)\n  }\n\n  getSpaceWidth(fontSize: number): number\n  {\n    const boundingBox = new Box({ height: 0, width: 0, x: 0, y: 0 })\n    const charSymbol: TIISymbolChar = {\n      id: `text-char-space`,\n      label: \"-\",\n      color: \"\",\n      fontSize,\n      fontWeight: \"normal\",\n      bounds: boundingBox\n    }\n    return this.getBoundingBox(new IIText([charSymbol], { x: 0, y: 0 }, boundingBox))?.width as number\n  }\n\n  updateBounds(textSymbol: IIText): IIText\n  {\n    this.setBounds(textSymbol)\n    this.model.updateSymbol(textSymbol)\n    return textSymbol\n  }\n\n  moveTextAfter(text: IIText, tx: number): TIISymbol[] | undefined\n  {\n    const row = this.model.getSymbolsByRowOrdered().find(r => r.rowIndex === this.model.getSymbolRowIndex(text))\n    if (row) {\n      const textsAfter = row.symbols.filter(s => s.type === SymbolType.Text && s.bounds.xMid > text.bounds.xMid) as IIText[]\n      textsAfter.forEach(symbol => {\n        symbol.point.x += tx\n        this.updateBounds(symbol)\n        this.model.updateSymbol(symbol)\n        this.renderer.drawSymbol(symbol)\n      })\n      return textsAfter\n    }\n    return\n  }\n}\n","import { SvgElementRole } from \"../Constants\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport\n{\n  EdgeKind,\n  IIStroke,\n  IIText,\n  IISymbolGroup,\n  ShapeKind,\n  SymbolType,\n  TIIEdge,\n  TIIShape,\n  TIISymbol,\n  TPoint,\n  TIIRecognized,\n  RecognizedKind\n} from \"../symbol\"\n\n/**\n * @group Manager\n */\nexport class IITranslateManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.TRANSFORMER)\n  editor: InteractiveInkEditor\n  interactElementsGroup?: SVGElement\n  transformOrigin!: TPoint\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  protected applyToStroke(stroke: IIStroke, tx: number, ty: number): IIStroke\n  {\n    stroke.pointers.forEach(p =>\n    {\n      p.x += tx\n      p.y += ty\n    })\n    return stroke\n  }\n\n  protected applyToShape(shape: TIIShape, tx: number, ty: number): TIIShape\n  {\n    switch (shape.kind) {\n      case ShapeKind.Ellipse:\n      case ShapeKind.Circle: {\n        shape.center.x += tx\n        shape.center.y += ty\n        return shape\n      }\n      case ShapeKind.Polygon: {\n        shape.points.forEach(p =>\n        {\n          p.x += tx\n          p.y += ty\n        })\n        return shape\n      }\n      default:\n        throw new Error(`Can't apply translate on shape, kind unknow: ${ JSON.stringify(shape) }`)\n    }\n  }\n\n  protected applyToEdge(edge: TIIEdge, tx: number, ty: number): TIIEdge\n  {\n    switch (edge.kind) {\n      case EdgeKind.Arc: {\n        edge.center.x += tx\n        edge.center.y += ty\n        return edge\n      }\n      case EdgeKind.Line: {\n        edge.start.x += tx\n        edge.start.y += ty\n        edge.end.x += tx\n        edge.end.y += ty\n        return edge\n      }\n      case EdgeKind.PolyEdge: {\n        edge.points.forEach(p =>\n        {\n          p.x += tx\n          p.y += ty\n        })\n        return edge\n      }\n    }\n\n    return edge\n  }\n\n  protected applyOnText(text: IIText, tx: number, ty: number): IIText\n  {\n    if (text.rotation) {\n      text.rotation.center = { x: text.rotation.center.x + tx, y: text.rotation.center.y + ty }\n    }\n    text.point.x += tx\n    text.point.y += ty\n    return this.editor.texter.updateBounds(text)\n  }\n\n  protected applyOnGroup(group: IISymbolGroup, tx: number, ty: number): IISymbolGroup\n  {\n    group.children.forEach(s => this.applyToSymbol(s, tx, ty))\n    return group\n  }\n\n  protected applyOnRecognizedSymbol(recognizedSymbol: TIIRecognized, tx: number, ty: number): TIIRecognized\n  {\n    recognizedSymbol.strokes.forEach(s => this.applyToStroke(s, tx, ty))\n    if (recognizedSymbol.kind === RecognizedKind.Text) {\n      recognizedSymbol.baseline += ty\n    }\n    return recognizedSymbol\n  }\n\n  applyToSymbol(symbol: TIISymbol, tx: number, ty: number): TIISymbol\n  {\n    this.#logger.info(\"applyToSymbol\", { symbol, tx, ty })\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        return this.applyToStroke(symbol, tx, ty)\n      case SymbolType.Shape:\n        return this.applyToShape(symbol, tx, ty)\n      case SymbolType.Edge:\n        return this.applyToEdge(symbol, tx, ty)\n      case SymbolType.Text:\n        return this.applyOnText(symbol, tx, ty)\n      case SymbolType.Group:\n        return this.applyOnGroup(symbol, tx, ty)\n      case SymbolType.Recognized:\n        return this.applyOnRecognizedSymbol(symbol, tx, ty)\n      default:\n        throw new Error(`Can't apply translate on symbol, type unknow: ${ JSON.stringify(symbol) }`)\n    }\n  }\n\n  translate(symbols: TIISymbol[], tx: number, ty: number, addToHistory = true): Promise<void>\n  {\n    this.#logger.info(\"translate\", { symbols, tx, ty })\n    symbols.forEach(s =>\n    {\n      this.applyToSymbol(s, tx, ty)\n      this.model.updateSymbol(s)\n      this.editor.renderer.drawSymbol(s)\n    })\n    if (addToHistory) {\n      this.editor.history.push(this.model, { translate: [{ symbols: this.model.symbolsSelected, tx, ty }] })\n    }\n    const strokes = this.editor.extractStrokesFromSymbols(symbols)\n    return this.editor.recognizer.transformTranslate(strokes.map(s => s.id), tx, ty)\n  }\n\n  translateElement(id: string, tx: number, ty: number): void\n  {\n    this.#logger.info(\"translateElement\", { id, tx, ty })\n    this.editor.renderer.setAttribute(id, \"transform\", `translate(${ tx },${ ty })`)\n  }\n\n  start(target: Element, origin: TPoint): void\n  {\n    this.#logger.info(\"start\", { origin })\n    this.interactElementsGroup = (target.closest(`[role=${ SvgElementRole.InteractElementsGroup }]`) as unknown) as SVGGElement\n    this.transformOrigin = origin\n  }\n\n  continue(point: TPoint): { tx: number, ty: number }\n  {\n    this.#logger.info(\"continue\", { point })\n    if (!this.interactElementsGroup) {\n      throw new Error(\"Can't translate, you must call start before\")\n    }\n\n    let tx = point.x - this.transformOrigin.x\n    let ty = point.y - this.transformOrigin.y\n\n    const nudge = this.editor.snaps.snapTranslate(tx, ty)\n    tx = nudge.x\n    ty = nudge.y\n\n    this.translateElement(this.interactElementsGroup.id as string, tx, ty)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.translateElement(s.id as string, tx, ty)\n    })\n    return {\n      tx,\n      ty\n    }\n  }\n\n  async end(point: TPoint): Promise<void>\n  {\n    this.#logger.info(\"end\", { point })\n    const { tx, ty } = this.continue(point)\n    this.editor.snaps.clearSnapToElementLines()\n    this.translate(this.model.symbolsSelected, tx, ty)\n\n    this.interactElementsGroup = undefined\n    this.editor.svgDebugger.apply()\n  }\n\n}\n","import { SELECTION_MARGIN, EditorWriteTool } from \"../Constants\"\nimport { TGesture } from \"../gesture\"\nimport { IIModel } from \"../model\"\nimport\n{\n  EdgeDecoration,\n  EdgeKind,\n  IIEdgeLine,\n  IIShapePolygon,\n  IIShapeCircle,\n  IIShapeEllipse,\n  IIStroke,\n  SymbolType,\n  TIIEdge,\n  TIISymbol,\n  TPoint,\n  TPointer\n} from \"../symbol\"\nimport { RecognizerWebSocket } from \"../recognizer\"\nimport { SVGRenderer } from \"../renderer\"\nimport { TStyle } from \"../style\"\nimport { IIHistoryManager } from \"../history\"\nimport { IIGestureManager } from \"../gesture/IIGestureManager\"\nimport { IISnapManager } from \"../snap/IISnapManager\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { PointerInfo } from \"../grabber\"\nimport { AbstractWriterManager } from \"./AbstractWriterManager\"\n\n\n/**\n * @group Manager\n */\nexport class IIWriterManager extends AbstractWriterManager\n{\n  #tool: EditorWriteTool = EditorWriteTool.Pencil\n  detectGesture: boolean = true\n  editor: InteractiveInkEditor\n  currentSymbolOrigin?: TPoint\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    super(editor)\n    this.editor = editor\n  }\n\n  get tool(): EditorWriteTool\n  {\n    return this.#tool\n  }\n  set tool(wt: EditorWriteTool)\n  {\n    this.#tool = wt\n    if (wt !== EditorWriteTool.Pencil) {\n      this.editor.layers.root.classList.add(\"shape\")\n    }\n    else {\n      this.editor.layers.root.classList.remove(\"shape\")\n    }\n    this.editor.unselectAll()\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get history(): IIHistoryManager\n  {\n    return this.editor.history\n  }\n\n  get gestureManager(): IIGestureManager\n  {\n    return this.editor.gesture\n  }\n\n  get snaps(): IISnapManager\n  {\n    return this.editor.snaps\n  }\n\n  get recognizer(): RecognizerWebSocket\n  {\n    return this.editor.recognizer\n  }\n\n  attach(layer: HTMLElement): void\n  {\n    this.grabber.attach(layer)\n    this.grabber.onPointerDown = this.start.bind(this)\n    this.grabber.onPointerMove = this.continue.bind(this)\n    this.grabber.onPointerUp = this.end.bind(this)\n  }\n\n  detach(): void\n  {\n    this.grabber.detach()\n  }\n\n  protected needContextLessGesture(stroke: IIStroke): boolean\n  {\n    const strokeBoundsWithMargin = this.editor.getSymbolsBounds([stroke], 2 * SELECTION_MARGIN)\n    return this.detectGesture && this.model.symbols.some(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Recognized:\n        case SymbolType.Stroke:\n          return false\n        case SymbolType.Group:\n          if (s.containsOnlyStroke()) {\n            return false\n          }\n          else {\n            return s.bounds.overlaps(strokeBoundsWithMargin)\n          }\n        default:\n          return s.bounds.overlaps(strokeBoundsWithMargin)\n      }\n    })\n  }\n\n  protected createCurrentSymbol(pointer: TPointer, style: TStyle, pointerType: string): TIISymbol\n  {\n    switch (this.tool) {\n      case EditorWriteTool.Pencil:\n        this.model.currentSymbol = new IIStroke(style, pointerType)\n        break\n      case EditorWriteTool.Rectangle:\n        this.model.currentSymbol = IIShapePolygon.createRectangleBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Triangle:\n        this.model.currentSymbol = IIShapePolygon.createTriangleBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Parallelogram:\n        this.model.currentSymbol = IIShapePolygon.createParallelogramBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Rhombus:\n        this.model.currentSymbol = IIShapePolygon.createRhombusBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Circle:\n        this.model.currentSymbol = IIShapeCircle.createBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Ellipse:\n        this.model.currentSymbol = IIShapeEllipse.createBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Line:\n      case EditorWriteTool.Arrow:\n      case EditorWriteTool.DoubleArrow: {\n        let startDecoration, endDecoration\n        if (this.tool === EditorWriteTool.Arrow) {\n          endDecoration = EdgeDecoration.Arrow\n        }\n        else if (this.tool === EditorWriteTool.DoubleArrow) {\n          startDecoration = EdgeDecoration.Arrow\n          endDecoration = EdgeDecoration.Arrow\n        }\n        this.model.currentSymbol = new IIEdgeLine(pointer, pointer, startDecoration, endDecoration, style)\n        break\n      }\n      default:\n        throw new Error(`Can't create symbol, tool is unknow: \"${ this.tool }\"`)\n    }\n    return this.updateCurrentSymbol(pointer)\n  }\n\n  protected updateCurrentSymbolShape(pointer: TPointer): void\n  {\n    switch (this.tool) {\n      case EditorWriteTool.Rectangle:\n        IIShapePolygon.updateRectangleBetweenPoints(this.model.currentSymbol as IIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case EditorWriteTool.Triangle:\n        IIShapePolygon.updateTriangleBetweenPoints(this.model.currentSymbol as IIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case EditorWriteTool.Parallelogram:\n        IIShapePolygon.updateParallelogramBetweenPoints(this.model.currentSymbol as IIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case EditorWriteTool.Rhombus:\n        IIShapePolygon.updateRhombusBetweenPoints(this.model.currentSymbol as IIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case EditorWriteTool.Circle:\n        IIShapeCircle.updateBetweenPoints(this.model.currentSymbol as IIShapeCircle, this.currentSymbolOrigin!, pointer)\n        break\n      case EditorWriteTool.Ellipse:\n        IIShapeEllipse.updateBetweenPoints(this.model.currentSymbol as IIShapeEllipse, this.currentSymbolOrigin!, pointer)\n        break\n    }\n  }\n\n  protected updateCurrentSymbolEdge(pointer: TPointer): void\n  {\n    const edge = this.model.currentSymbol as TIIEdge\n    switch (edge.kind) {\n      case EdgeKind.Line:\n        edge.end = pointer\n        break\n    }\n  }\n\n  protected updateCurrentSymbol(pointer: TPointer): TIISymbol\n  {\n    if (!this.model.currentSymbol) {\n      throw new Error(\"Can't update current symbol because currentSymbol is undefined\")\n    }\n\n    switch (this.model.currentSymbol.type) {\n      case SymbolType.Stroke:\n        this.model.currentSymbol!.addPointer(pointer)\n        break\n      case SymbolType.Shape:\n        this.updateCurrentSymbolShape(pointer)\n        break\n      case SymbolType.Edge:\n        this.updateCurrentSymbolEdge(pointer)\n        break\n    }\n    return this.model.currentSymbol\n  }\n\n  start(info: PointerInfo): void\n  {\n    const localPointer = info.pointer\n    if (this.tool !== EditorWriteTool.Pencil) {\n      const { x, y } = this.snaps.snapResize(localPointer)\n      localPointer.x = x\n      localPointer.y = y\n    }\n    this.currentSymbolOrigin = localPointer\n    this.createCurrentSymbol(localPointer, this.editor.penStyle, info.pointerType)\n    this.renderer.drawSymbol(this.model.currentSymbol!)\n  }\n\n  continue(info: PointerInfo): void\n  {\n    const localPointer = info.pointer\n    if (this.tool !== EditorWriteTool.Pencil) {\n      const { x, y } = this.snaps.snapResize(localPointer)\n      localPointer.x = x\n      localPointer.y = y\n    }\n    this.updateCurrentSymbol(localPointer)\n    this.renderer.drawSymbol(this.model.currentSymbol!)\n  }\n\n  protected async interactWithBackend(stroke: IIStroke): Promise<void>\n  {\n    const localStroke = stroke.clone()\n    let gestureFromContextLess: TGesture | undefined\n    if (this.needContextLessGesture(stroke)) {\n      gestureFromContextLess = await this.gestureManager.getGestureFromContextLess(localStroke)\n    }\n    if (gestureFromContextLess) {\n      this.history.pop()\n      this.recognizer.addStrokes([localStroke], this.detectGesture)\n      await this.gestureManager.apply(localStroke, gestureFromContextLess)\n    }\n    else {\n      const gesture = await this.recognizer.addStrokes([localStroke], this.detectGesture)\n      if (gesture) {\n        this.history.pop()\n        await this.gestureManager.apply(localStroke, gesture)\n      }\n    }\n  }\n\n  async end(info: PointerInfo): Promise<void>\n  {\n    const localPointer = info.pointer\n    if (this.tool !== EditorWriteTool.Pencil) {\n      const { x, y } = this.snaps.snapResize(localPointer)\n      localPointer.x = x\n      localPointer.y = y\n    }\n    const localSymbol = this.updateCurrentSymbol(localPointer)\n    this.model.currentSymbol = undefined\n    this.currentSymbolOrigin = undefined\n    this.snaps.clearSnapToElementLines()\n\n    this.renderer.drawSymbol(localSymbol!)\n    this.model.addSymbol(localSymbol)\n    this.history.push(this.model, { added: [localSymbol] })\n\n    if (localSymbol.type === SymbolType.Stroke) {\n      await this.interactWithBackend(localSymbol)\n    }\n  }\n}\n","import { LoggerManager, LoggerCategory } from \"../logger\"\nimport { IIModel, JIIXEdgeKind } from \"../model\"\nimport { Box, IIText, SymbolType, TBox, TIISymbol } from \"../symbol\"\nimport { SVGRenderer, SVGRendererConst, SVGBuilder } from \"../renderer\"\nimport { convertBoundingBoxMillimeterToPixel, createUUID } from \"../utils\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\n\n/**\n * @group Manager\n */\nexport class IIDebugSVGManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.SVGDEBUG)\n  #snapPointsVisibility = false\n  #verticesVisibility = false\n  #boundingBoxVisibility = false\n  #recognitionBoxVisibility = false\n  #recognitionItemBoxVisibility = false\n\n  editor: InteractiveInkEditor\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get snapPointsVisibility(): boolean\n  {\n    return this.#snapPointsVisibility\n  }\n  set snapPointsVisibility(show: boolean)\n  {\n    this.#snapPointsVisibility = show\n    this.debugSnapPoints()\n  }\n\n  get verticesVisibility(): boolean\n  {\n    return this.#verticesVisibility\n  }\n  set verticesVisibility(show: boolean)\n  {\n    this.#verticesVisibility = show\n    this.debugVertices()\n  }\n\n  get boundingBoxVisibility(): boolean\n  {\n    return this.#boundingBoxVisibility\n  }\n  set boundingBoxVisibility(show: boolean)\n  {\n    this.#boundingBoxVisibility = show\n    // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n    this.#boundingBoxVisibility ? this.showBoundingBox() : this.hideBoundingBox()\n  }\n\n  get recognitionBoxVisibility(): boolean\n  {\n    return this.#recognitionBoxVisibility\n  }\n  set recognitionBoxVisibility(show: boolean)\n  {\n    this.#recognitionBoxVisibility = show\n    this.debugRecognitionBox()\n  }\n\n  get recognitionItemBoxVisibility(): boolean\n  {\n    return this.#recognitionItemBoxVisibility\n  }\n  set recognitionItemBoxVisibility(show: boolean)\n  {\n    this.#recognitionItemBoxVisibility = show\n    this.debugRecognitionItemBox()\n  }\n\n  protected showSnapPoints(): void\n  {\n    this.#logger.info(\"showSnapPoints\")\n    if (this.model.currentSymbol) {\n      this.model.currentSymbol.snapPoints.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"blue\", \"debug\": \"snap-points\" }))\n    }\n    this.model.symbols.forEach(s => s.snapPoints.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"blue\", \"debug\": \"snap-points\" })))\n  }\n  protected hideSnapPoints(): void\n  {\n    this.#logger.info(\"hideSnapPoints\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"snap-points\" } })\n  }\n  debugSnapPoints(): void\n  {\n    this.hideSnapPoints()\n    if (this.snapPointsVisibility) {\n      this.showSnapPoints()\n    }\n  }\n\n  protected showVertices(): void\n  {\n    this.#logger.info(\"showVertices\")\n    if (this.model.currentSymbol) {\n      this.model.currentSymbol.vertices.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"red\", \"debug\": \"vertices\" }))\n    }\n    this.model.symbols.forEach(s => s.vertices.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"red\", \"debug\": \"vertices\" })))\n  }\n  protected hideVertices(): void\n  {\n    this.#logger.info(\"hideVertices\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"vertices\" } })\n  }\n  debugVertices(): void\n  {\n    this.hideVertices()\n    if (this.verticesVisibility) {\n      this.showVertices()\n    }\n  }\n\n  protected drawBoundingBox(symbols: TIISymbol[]): void\n  {\n    const symbolAttrs = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"red\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"5 5\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"debug\": \"bounding-box\"\n    }\n    const charAttrs = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"orange\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"0 5 0\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"debug\": \"bounding-box\"\n    }\n    symbols.forEach(s =>\n    {\n      const symEl = this.renderer.getElementById(s.id)\n      if (symEl) {\n        if (s.type === SymbolType.Text) {\n          const text = s as IIText\n          let transform: string = \"\"\n          if (text.rotation) {\n            transform = `rotate(${ text.rotation.degree }, ${ text.rotation.center.x }, ${ text.rotation.center.y })`\n          }\n          text.chars.forEach(c =>\n          {\n            const ca = {\n              ...charAttrs,\n              char: c.label,\n              transform\n            }\n            symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(c.bounds, ca))\n          })\n          const sa = {\n            ...symbolAttrs,\n            symbol: s.id,\n            transform\n          }\n          symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(s.bounds, sa))\n        }\n        else {\n          const sa = {\n            ...symbolAttrs,\n            symbol: s.id,\n          }\n          symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(s.bounds, sa))\n        }\n      }\n    })\n  }\n  protected showBoundingBox(): void\n  {\n    this.#logger.info(\"showBoundingBox\")\n    if (this.model.currentSymbol) {\n      this.drawBoundingBox([this.model.currentSymbol])\n    }\n    this.drawBoundingBox(this.model.symbols)\n  }\n  protected hideBoundingBox(): void\n  {\n    this.#logger.info(\"hideBoundingBox\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"bounding-box\" } })\n  }\n  debugBoundingBox(): void\n  {\n    this.hideBoundingBox()\n    if (this.boundingBoxVisibility) {\n      this.showBoundingBox()\n    }\n  }\n\n  protected drawRecognitionBox(box: TBox, infos?: string[]): void\n  {\n    const COLOR = \"green\"\n    const TEXT_HEIGHT = 20\n    const recognitionGroup = SVGBuilder.createGroup({ \"debug\": \"recognition-box\" })\n\n    const rect = SVGBuilder.createRect(box, { fill: \"transparent\", stroke: COLOR, style: SVGRendererConst.noSelection })\n    recognitionGroup.appendChild(rect)\n\n    const infosGroup = SVGBuilder.createGroup({ id: `infos-group-${ createUUID() }` })\n    const infoX = box.x + box.width\n    let infoY = box.y + TEXT_HEIGHT / 2\n    infos?.forEach(w =>\n    {\n      infosGroup.appendChild(SVGBuilder.createText({ x: infoX, y: infoY }, w, { stroke: COLOR, style: SVGRendererConst.noSelection }))\n      infoY += TEXT_HEIGHT\n    })\n    recognitionGroup.appendChild(infosGroup)\n    this.renderer.layer.appendChild(recognitionGroup)\n\n    const infosGroupBox = infosGroup.getBBox()\n    const rectBox = {\n      width: infosGroupBox.width + 10,\n      height: infosGroupBox.height + 10,\n      x: infosGroupBox.x - 5,\n      y: infosGroupBox.y - 5,\n    }\n    const rectTranslate = SVGBuilder.createRect(rectBox, { fill: \"white\", style: \"cursor:move\", stroke: COLOR })\n    infosGroup.prepend(rectTranslate)\n\n    const translateEl = (e: PointerEvent) =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      const originX = Number(this.renderer.getAttribute(infosGroup.id, \"originX\"))\n      const originY = Number(this.renderer.getAttribute(infosGroup.id, \"originY\"))\n      const tx = e.clientX - originX\n      const ty = e.clientY - originY\n      this.renderer.setAttribute(infosGroup.id, \"transform\", `translate(${ tx },${ ty })`)\n      const newRectBox = {\n        width: rectBox.width,\n        height: rectBox.height,\n        x: rectBox.x + tx,\n        y: rectBox.y + ty,\n      }\n      this.renderer.removeSymbol(`connection-${ infosGroup.id }`)\n      this.renderer.drawConnectionBetweenBox(`connection-${ infosGroup.id }`, box, newRectBox, \"corners\", { stroke: COLOR, debug: \"recognition-box-link\" })\n    }\n\n    rectTranslate.addEventListener(\"pointerdown\", e =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      if (!this.renderer.getAttribute(infosGroup.id, \"originX\")) {\n        this.renderer.setAttribute(infosGroup.id, \"originX\", e.clientX.toString())\n        this.renderer.setAttribute(infosGroup.id, \"originY\", e.clientY.toString())\n      }\n      this.renderer.layer.addEventListener(\"pointermove\", translateEl)\n      this.renderer.layer.addEventListener(\"pointerup\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n      this.renderer.layer.addEventListener(\"pointerleave\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n      this.renderer.layer.addEventListener(\"pointercancel\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n    })\n  }\n\n  protected async showRecognitionBox(): Promise<void>\n  {\n    this.#logger.info(\"showRecognitionBox\")\n    await this.editor.export([\"application/vnd.myscript.jiix\"])\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    this.#logger.debug(\"showRecognitionBox\", { jiix })\n    if (jiix) {\n      if (!jiix[\"bounding-box\"]) {\n        this.#logger.warn(\"drawRecognitionBox\", \"You must to enabled configuration.recognition.exports[\\\"bounding-box\\\"]\")\n        return\n      }\n      jiix.elements?.forEach(el =>\n      {\n        switch (el.type) {\n          case \"Node\": {\n            if (el[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              const hideProperties = [\"bounding-box\", \"items\", \"id\"]\n              const infos = Object.keys(el).filter(k => !hideProperties.includes(k)).map(k => `${ k }: ${ JSON.stringify(el[k as keyof typeof el]) }`)\n              this.drawRecognitionBox(box, infos)\n            }\n            break\n          }\n          case \"Text\": {\n            el.words?.forEach(w =>\n            {\n              if (w?.[\"bounding-box\"]) {\n                const box = convertBoundingBoxMillimeterToPixel(w[\"bounding-box\"])\n                this.drawRecognitionBox(box, [`type: ${ el.type }`, `candidates: ${ JSON.stringify(w.candidates || []) }`])\n              }\n            })\n            break\n          }\n          case \"Edge\": {\n            if (el.kind === JIIXEdgeKind.PolyEdge) {\n              const infos = [\n                `type: ${ el.type }`,\n                `kind: ${ el.kind }`,\n              ]\n              el.edges.forEach((e, i) =>\n              {\n                let inf = `edge-${ i }: [{ x1: ${ e.x1 }, y2: ${ e.y1 } },{ x2: ${ e.x2 }, y2: ${ e.y2 } }]`\n                if (e.p1Decoration) {\n                  inf += `, p1Decoration: ${ e.p1Decoration }`\n                }\n                if (e.p2Decoration) {\n                  inf += `, p2Decoration: ${ e.p2Decoration }`\n                }\n                infos.push(inf)\n              })\n              const box = convertBoundingBoxMillimeterToPixel(Box.createFromBoxes(el.edges.map(e => e[\"bounding-box\"] as TBox)))\n              this.drawRecognitionBox(box, infos)\n            }\n            else if (el[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              const hideProperties = [\"bounding-box\", \"items\", \"id\", \"ports\", \"connected\"]\n              const infos = Object.keys(el).filter(k => !hideProperties.includes(k)).map(k => `${ k }: ${ JSON.stringify(el[k as keyof typeof el]) }`)\n              this.drawRecognitionBox(box, infos)\n            }\n            break\n          }\n          default: {\n            this.#logger.warn(\"drawRecognitionBox\", `Unknow jiix element type: ${ el.type }`)\n            break\n          }\n        }\n      })\n    }\n  }\n  protected clearRecognitionBox(): void\n  {\n    this.#logger.info(\"clearRecognitionBox\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-box\" } })\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-box-link\" } })\n  }\n  async debugRecognitionBox(): Promise<void>\n  {\n    this.clearRecognitionBox()\n    if (this.#recognitionBoxVisibility) {\n      this.showRecognitionBox()\n    }\n  }\n\n  protected drawRecognitionItemBox(box: TBox, label?: string, chars?: string[]): void\n  {\n    const COLOR = \"blue\"\n    const CHAR_SIZE = 14\n\n    const recognitionItemGroup = SVGBuilder.createGroup({ \"debug\": \"recognition-item-box\" })\n    const rect = SVGBuilder.createRect(box, { fill: \"transparent\", stroke: COLOR, style: SVGRendererConst.noSelection })\n    recognitionItemGroup.appendChild(rect)\n\n    const charX = box.x\n    let charY = box.y - CHAR_SIZE\n\n    const charsGroup = SVGBuilder.createGroup({ id: `chars-group-${ createUUID() }` })\n    if (label) {\n      charsGroup.appendChild(SVGBuilder.createText({ x: charX, y: charY }, `label: ${ label }`, { fill: COLOR, \"font-size\": CHAR_SIZE.toString(), style: SVGRendererConst.noSelection }))\n    }\n    if (chars?.length) {\n      charY += CHAR_SIZE\n      charsGroup.appendChild(SVGBuilder.createText({ x: charX, y: charY }, `[${ chars.join(\", \") }]`, { fill: COLOR, \"font-size\": CHAR_SIZE.toString(), style: SVGRendererConst.noSelection }))\n    }\n\n    recognitionItemGroup.appendChild(charsGroup)\n    this.renderer.layer.appendChild(recognitionItemGroup)\n\n    const charsGroupBox = charsGroup.getBBox()\n    const rectBox = {\n      width: charsGroupBox.width + 10,\n      height: charsGroupBox.height + 10,\n      x: charsGroupBox.x - 5,\n      y: charsGroupBox.y - 5,\n    }\n    const rectTranslate = SVGBuilder.createRect(rectBox, { fill: \"white\", style: \"cursor:move\", stroke: COLOR })\n    charsGroup.prepend(rectTranslate)\n\n    const translateEl = (e: PointerEvent) =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      const originX = Number(this.renderer.getAttribute(charsGroup.id, \"originX\"))\n      const originY = Number(this.renderer.getAttribute(charsGroup.id, \"originY\"))\n      const tx = e.clientX - originX\n      const ty = e.clientY - originY\n      this.renderer.setAttribute(charsGroup.id, \"transform\", `translate(${ tx },${ ty })`)\n      const newRectBox = {\n        width: rectBox.width,\n        height: rectBox.height,\n        x: rectBox.x + tx,\n        y: rectBox.y + ty,\n      }\n      this.renderer.removeSymbol(`connection-${ charsGroup.id }`)\n      this.renderer.drawConnectionBetweenBox(`connection-${ charsGroup.id }`, box, newRectBox, \"corners\", { stroke: COLOR, debug: \"recognition-item-box-link\" })\n    }\n\n    rectTranslate.addEventListener(\"pointerdown\", e =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      if (!this.renderer.getAttribute(charsGroup.id, \"originX\")) {\n        this.renderer.setAttribute(charsGroup.id, \"originX\", e.clientX.toString())\n        this.renderer.setAttribute(charsGroup.id, \"originY\", e.clientY.toString())\n      }\n      this.renderer.layer.addEventListener(\"pointermove\", translateEl)\n    })\n    this.renderer.layer.addEventListener(\"pointerup\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n    this.renderer.layer.addEventListener(\"pointerleave\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n    this.renderer.layer.addEventListener(\"pointercancel\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n\n  }\n  protected async showRecognitionItemBox(): Promise<void>\n  {\n    this.#logger.info(\"showRecognitionBoxItem\")\n    await this.editor.export([\"application/vnd.myscript.jiix\"])\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    this.#logger.debug(\"showRecognitionBoxItem\", { jiix })\n    if (jiix) {\n      jiix.elements?.forEach(el =>\n      {\n        switch (el.type) {\n          case \"Text\": {\n            el.chars?.forEach(c =>\n            {\n              if (c?.[\"bounding-box\"]) {\n                const box = convertBoundingBoxMillimeterToPixel(c[\"bounding-box\"])\n                this.drawRecognitionItemBox(box, c.label, c.candidates)\n              }\n            })\n            break\n          }\n          case \"Node\": {\n            if (el?.[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              this.drawRecognitionItemBox(box, el.kind)\n            }\n            break\n          }\n          case \"Edge\": {\n            if (el.kind === JIIXEdgeKind.PolyEdge) {\n              el.edges.forEach(e =>\n              {\n                const box = convertBoundingBoxMillimeterToPixel(e[\"bounding-box\"])\n                this.drawRecognitionItemBox(box, e.kind)\n              })\n            }\n            else if (el[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              this.drawRecognitionItemBox(box, el.kind)\n            }\n            break\n          }\n          default:\n            this.#logger.warn(\"drawRecognitionBoxItem\", `Unknow jiix element type: ${ el.type }`)\n            break\n        }\n      })\n    }\n  }\n  protected clearRecognitionItemBox(): void\n  {\n    this.#logger.info(\"clearRecognitionBoxItem\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-item-box\" } })\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-item-box-link\" } })\n  }\n  async debugRecognitionItemBox(): Promise<void>\n  {\n    this.clearRecognitionItemBox()\n    if (this.#recognitionItemBoxVisibility) {\n      this.showRecognitionItemBox()\n    }\n  }\n\n  apply(): void\n  {\n    this.debugBoundingBox()\n    this.debugVertices()\n    this.debugSnapPoints()\n    this.debugRecognitionBox()\n    this.debugRecognitionItemBox()\n  }\n}\n","import { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\nimport { SVGRenderer } from \"../renderer\"\n\n/**\n * @group Manager\n */\nexport class IIMoveManager\n{\n  grabber: PointerEventGrabber\n  editor: InteractiveInkEditor\n\n  origin?: {\n    left: number,\n    top: number,\n    x: number,\n    y: number\n  }\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.editor = editor\n    this.grabber = new PointerEventGrabber(editor.configuration.grabber)\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  attach(layer: HTMLElement): void\n  {\n    this.grabber.attach(layer)\n    this.grabber.onPointerDown = this.start.bind(this)\n    this.grabber.onPointerMove = this.continue.bind(this)\n    this.grabber.onPointerUp = this.end.bind(this)\n  }\n\n  detach(): void\n  {\n    this.grabber.detach()\n  }\n\n  start(info: PointerInfo): void\n  {\n    this.origin = {\n      left: this.renderer.parent.scrollLeft,\n      top: this.renderer.parent.scrollTop,\n      x: info.clientX,\n      y: info.clientY,\n    }\n  }\n\n  continue(info: PointerInfo): void\n  {\n    if (!this.origin) {\n      throw new Error(\"Can't move cause origin is undefined\")\n    }\n    const dx = info.clientX - this.origin.x\n    const dy = info.clientY - this.origin.y\n\n    this.renderer.parent.scrollTop = this.origin.top - dy\n    this.renderer.parent.scrollLeft = this.origin.left - dx\n  }\n\n  end(info: PointerInfo): void\n  {\n    this.continue(info)\n    this.origin = undefined\n  }\n}\n","import { LoggerManager, LoggerCategory } from \"../logger\"\nimport { IModel } from \"../model\"\nimport { Box, IIStroke, IIText, SymbolType, TBox, TIISymbol } from \"../symbol\"\nimport { SVGRenderer, SVGRendererConst, SVGBuilder } from \"../renderer\"\nimport { createUUID } from \"../utils\"\nimport { InkEditor } from \"../editor\"\n\n/**\n * @group Manager\n */\nexport class IDebugSVGManager {\n  #logger = LoggerManager.getLogger(LoggerCategory.SVGDEBUG)\n  #recognitionBoxVisibility = false\n  #recognitionBoxItemsVisibility = false\n  #recognitionBoxDrawing = false\n  #recognitionBoxItemsDrawing = false\n\n  editor: InkEditor\n\n  constructor(editor: InkEditor) {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get model(): IModel {\n    return this.editor.model\n  }\n\n  get renderer(): SVGRenderer {\n    return this.editor.renderer\n  }\n\n  get recognitionBoxVisibility(): boolean {\n    return this.#recognitionBoxVisibility\n  }\n\n  set recognitionBoxVisibility(show: boolean) {\n    this.#recognitionBoxVisibility = show\n    this.debugRecognitionBox()\n  }\n\n  get recognitionBoxItemsVisibility(): boolean {\n    return this.#recognitionBoxItemsVisibility\n  }\n\n  set recognitionBoxItemsVisibility(show: boolean) {\n    this.#recognitionBoxItemsVisibility = show\n    this.debugRecognitionBoxItems()\n  }\n\n  protected drawBoundingBox(symbols: TIISymbol[]): void {\n    const symbolAttrs = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"red\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"5 5\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"debug\": \"bounding-box\"\n    }\n    const charAttrs = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"orange\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"0 5 0\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"debug\": \"bounding-box\"\n    }\n    symbols.forEach(s => {\n      const symEl = this.renderer.getElementById(s.id)\n      if (symEl) {\n        if (s.type === SymbolType.Text) {\n          const text = s as IIText\n          let transform: string = \"\"\n          if (text.rotation) {\n            transform = `rotate(${text.rotation.degree}, ${text.rotation.center.x}, ${text.rotation.center.y})`\n          }\n          text.chars.forEach(c => {\n            const ca = {\n              ...charAttrs,\n              char: c.label,\n              transform\n            }\n            symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(c.bounds, ca))\n          })\n          const sa = {\n            ...symbolAttrs,\n            symbol: s.id,\n            transform\n          }\n          symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(s.bounds, sa))\n        }\n        else {\n          const sa = {\n            ...symbolAttrs,\n            symbol: s.id,\n          }\n          symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(s.bounds, sa))\n        }\n      }\n    })\n  }\n\n  protected drawRecognitionBox(box: TBox, infos: string[], color: string, debugAttr: string): void {\n    const TEXT_HEIGHT = 20\n    const recognitionGroup = SVGBuilder.createGroup({ \"debug\": debugAttr, \"opacity\": debugAttr === \"recognition-box-items\" ? \"0.8\" : \"1\" })\n    const rectAttr = {\n      fill: \"transparent\",\n      stroke: color,\n      style: SVGRendererConst.noSelection,\n      \"stroke-dasharray\": debugAttr === \"recognition-box-items\" ? \"1 5 10\" : \"\",\n    }\n    const rect = SVGBuilder.createRect(box, rectAttr)\n    recognitionGroup.appendChild(rect)\n\n    const infosGroup = SVGBuilder.createGroup({ id: `infos-group-${createUUID()}` })\n    const infoX = box.x + box.width\n    let infoY = box.y + TEXT_HEIGHT / 2\n    infos?.forEach(w => {\n      infosGroup.appendChild(SVGBuilder.createText({ x: infoX, y: infoY }, w, { stroke: color, style: SVGRendererConst.noSelection }))\n      infoY += TEXT_HEIGHT\n    })\n    recognitionGroup.appendChild(infosGroup)\n    this.renderer.layer.appendChild(recognitionGroup)\n\n    const infosGroupBox = infosGroup.getBBox()\n    const rectBox = {\n      width: infosGroupBox.width + 10,\n      height: infosGroupBox.height + 10,\n      x: infosGroupBox.x - 5,\n      y: infosGroupBox.y - 5,\n    }\n\n    const rectTranslate = SVGBuilder.createRect(rectBox, { ...rectAttr, fill: \"white\", style: \"cursor:move\" })\n    infosGroup.prepend(rectTranslate)\n\n    const translateEl = (e: PointerEvent) => {\n      e.preventDefault()\n      e.stopPropagation()\n      const originX = Number(this.renderer.getAttribute(infosGroup.id, \"originX\"))\n      const originY = Number(this.renderer.getAttribute(infosGroup.id, \"originY\"))\n      const tx = e.clientX - originX\n      const ty = e.clientY - originY\n      this.renderer.setAttribute(infosGroup.id, \"transform\", `translate(${tx},${ty})`)\n      const newRectBox = {\n        width: rectBox.width,\n        height: rectBox.height,\n        x: rectBox.x + tx,\n        y: rectBox.y + ty,\n      }\n      this.renderer.removeSymbol(`connection-${infosGroup.id}`)\n      this.renderer.drawConnectionBetweenBox(`connection-${infosGroup.id}`, box, newRectBox, \"sides\", { stroke: color, debug: debugAttr })\n    }\n\n    rectTranslate.addEventListener(\"pointerdown\", e => {\n      e.preventDefault()\n      e.stopPropagation()\n      if (!this.renderer.getAttribute(infosGroup.id, \"originX\")) {\n        this.renderer.setAttribute(infosGroup.id, \"originX\", e.clientX.toString())\n        this.renderer.setAttribute(infosGroup.id, \"originY\", e.clientY.toString())\n      }\n      this.renderer.layer.addEventListener(\"pointermove\", translateEl)\n      this.renderer.layer.addEventListener(\"pointerup\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n      this.renderer.layer.addEventListener(\"pointerleave\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n      this.renderer.layer.addEventListener(\"pointercancel\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n    })\n  }\n\n  protected buildInfos(obj: object, currentPath = \"\"): string[] {\n    const infos: string[] = []\n    for (const key in obj) {\n      const value = obj[key as keyof typeof obj]\n      const localPath = currentPath ? `${currentPath}.${key}` : key\n      switch (typeof value) {\n        case \"object\":\n          infos.push(...this.buildInfos(value, localPath))\n          break\n        default:\n          infos.push(`${localPath}: ${JSON.stringify(value)}`)\n          break\n      }\n    }\n    return infos\n  }\n\n  protected async showRecognitionBox(): Promise<void> {\n    if(this.#recognitionBoxDrawing) return\n    this.#recognitionBoxDrawing = true\n    this.#logger.info(\"showRecognitionBox\")\n    let jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    if (!jiix) {\n      const exports = await this.editor.recognizer.send(this.model.strokes, [\"application/vnd.myscript.jiix\"])\n      jiix = exports[\"application/vnd.myscript.jiix\"]!\n    }\n    this.#logger.debug(\"showRecognitionBox\", { jiix })\n    if (jiix) {\n      jiix.elements?.forEach(el => {\n        switch (el.type) {\n          case \"Drawing\":\n          case \"Shape\": {\n            const associatedStrokes: IIStroke[] = []\n            el.range?.forEach(r => {\n              associatedStrokes.push(...this.model.strokes.slice(r.from.stroke, r.to.stroke + 1))\n            })\n            const box = Box.createFromBoxes(associatedStrokes.map(s => s.bounds))\n            let infos: string[] = [`type: ${el.type}`]\n            infos.push(...this.buildInfos(el))\n            const hideProperties = [\"bounding-box\", \"primitives\", \"range\", \"candidates\"]\n            infos = infos.filter(i => !hideProperties.some(h => i.indexOf(h) > -1))\n            const color = el.type === \"Shape\" ? \"orange\" : \"green\"\n            this.drawRecognitionBox(box, infos, color, \"recognition-box\")\n            break\n          }\n          case \"Text\": {\n            const associatedStrokes: IIStroke[] = []\n            el.range?.forEach(r => {\n              associatedStrokes.push(...this.model.strokes.slice(r.from.stroke, r.to.stroke + 1))\n            })\n            const box = Box.createFromBoxes(associatedStrokes.map(s => s.bounds))\n            this.drawRecognitionBox(box, [`type: ${el.type}`, `label: ${JSON.stringify(el.label || [])}`], \"blue\", \"recognition-box\")\n            break\n          }\n          case \"Math\": {\n            const associatedStrokes: IIStroke[] = []\n            el.range?.forEach(r => {\n              associatedStrokes.push(...this.model.strokes.slice(r.from.stroke, r.to.stroke + 1))\n            })\n            const box = Box.createFromBoxes(associatedStrokes.map(s => s.bounds))\n            let infos: string[] = [`type: ${el.type}`]\n            infos.push(...this.buildInfos(el))\n            const hideProperties = [\"bounding-box\", \"primitives\", \"range\", \"candidates\"]\n            infos = infos.filter(i => !hideProperties.some(h => i.indexOf(h) > -1))\n            this.drawRecognitionBox(box, infos, \"red\", \"recognition-box\")\n            break\n          }\n          default: {\n            this.#logger.warn(\"drawRecognitionBox\", `Unknow jiix element type: ${el.type}`)\n            break\n          }\n        }\n      })\n    }\n    this.#recognitionBoxDrawing = false\n  }\n\n  protected async showRecognitionBoxItems(): Promise<void> {\n    if(this.#recognitionBoxItemsDrawing) return\n    this.#recognitionBoxItemsDrawing = true\n    this.#logger.info(\"showRecognitionBoxItems\")\n    let jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    if (!jiix) {\n      const exports = await this.editor.recognizer.send(this.model.strokes, [\"application/vnd.myscript.jiix\"])\n      jiix = exports[\"application/vnd.myscript.jiix\"]!\n    }\n    this.#logger.debug(\"showRecognitionBoxItems\", { jiix })\n    if (jiix) {\n      jiix.elements?.forEach(el => {\n        switch (el.type) {\n          case \"Shape\": {\n            el.elements.forEach(e => {\n              const associatedStrokes: IIStroke[] = []\n              e.range?.forEach(r => {\n                associatedStrokes.push(...this.model.strokes.slice(r.from.stroke, r.to.stroke + 1))\n              })\n              const box = Box.createFromBoxes(associatedStrokes.map(s => s.bounds))\n              let infos: string[] = [`type: ${el.type}`]\n              infos.push(...this.buildInfos(e))\n              const hideProperties = [\"bounding-box\", \"primitives\", \"range\", \"candidates\"]\n              infos = infos.filter(i => !hideProperties.some(h => i.indexOf(h) > -1))\n              this.drawRecognitionBox(box, infos, \"#ce922a\", \"recognition-box-items\")\n            })\n            break\n          }\n          case \"Math\":\n          case \"Text\": {\n            el.lines?.forEach(e => {\n              e.spans?.forEach(s => {\n                const associatedStrokes: IIStroke[] = []\n                s.range.forEach(r => {\n                  associatedStrokes.push(...this.model.strokes.slice(r.from.stroke, r.to.stroke + 1))\n                })\n                const color = s.type === \"Math\" ? \"#ff6565\" : \"#099df7\"\n                const box = Box.createFromBoxes(associatedStrokes.map(s => s.bounds))\n                this.drawRecognitionBox(box, [`type: ${s.type}`, `label: ${JSON.stringify(s.label || [])}`], color, \"recognition-box-items\")\n              })\n            })\n            break\n          }\n\n          default: {\n            this.#logger.warn(\"drawRecognitionBox\", `Unknow jiix element type: ${el.type}`)\n            break\n          }\n        }\n      })\n    }\n    this.#recognitionBoxItemsDrawing = false\n  }\n\n  protected clearRecognitionBox(): void {\n    this.#logger.info(\"clearRecognitionBox\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-box\" } })\n  }\n\n  protected clearRecognitionBoxItems(): void {\n    this.#logger.info(\"clearRecognitionBoxItems\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-box-items\" } })\n  }\n\n  async debugRecognitionBox(): Promise<void> {\n    this.clearRecognitionBox()\n    if (this.#recognitionBoxVisibility) {\n      this.showRecognitionBox()\n    }\n  }\n\n  async debugRecognitionBoxItems(): Promise<void> {\n    this.clearRecognitionBoxItems()\n    if (this.#recognitionBoxItemsVisibility) {\n      this.showRecognitionBoxItems()\n    }\n  }\n\n  apply(): void {\n    this.debugRecognitionBox()\n    this.debugRecognitionBoxItems()\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIEraser, TSegment } from \"../symbol\"\nimport { SVGRenderer } from \"../renderer\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\nimport { InkEditor } from \"../editor\"\n\n/**\n * @group Manager\n */\nexport class EraseManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.WRITE)\n  grabber: PointerEventGrabber\n  editor: InteractiveInkEditor | InkEditor\n\n  currentEraser?: IIEraser\n\n  constructor(editor: InteractiveInkEditor | InkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.grabber = new PointerEventGrabber(editor.configuration.grabber)\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  attach(layer: HTMLElement): void\n  {\n    this.grabber.attach(layer)\n    this.grabber.onPointerDown = this.start.bind(this)\n    this.grabber.onPointerMove = this.continue.bind(this)\n    this.grabber.onPointerUp = this.end.bind(this)\n  }\n\n  detach(): void\n  {\n    this.grabber.detach()\n  }\n\n  start(info: PointerInfo): void\n  {\n    this.#logger.info(\"startErase\", { info })\n    this.currentEraser = new IIEraser()\n    this.currentEraser.pointers.push(info.pointer)\n    this.renderer.drawSymbol(this.currentEraser!)\n  }\n\n  continue(info: PointerInfo): void\n  {\n    this.#logger.info(\"continueErase\", { info })\n    if (!this.currentEraser) {\n      throw new Error(\"Can't update current eraser because currentEraser is undefined\")\n    }\n    this.currentEraser.pointers.push(info.pointer)\n    this.renderer.drawSymbol(this.currentEraser)\n    const lastSeg: TSegment = {\n      p1: this.currentEraser.pointers.at(-1)!,\n      p2: this.currentEraser.pointers.at(-2)!\n    }\n    if (this.editor instanceof InteractiveInkEditor) {\n      this.editor.model.symbols.forEach(s =>\n      {\n        if (s.isIntersected(lastSeg)) {\n          s.deleting = true\n          this.renderer.drawSymbol(s)\n        }\n      })\n    }\n    else {\n      this.editor.model.strokes.forEach(s =>\n      {\n        if (s.isIntersected(lastSeg)) {\n          s.deleting = true\n          this.renderer.drawSymbol(s)\n        }\n      })\n    }\n  }\n\n  async end(info: PointerInfo): Promise<void>\n  {\n    this.#logger.info(\"finishErasing\", { info })\n    this.continue(info)\n\n    this.renderer.removeSymbol(this.currentEraser!.id)\n    if (this.editor instanceof InteractiveInkEditor) {\n      this.editor.removeSymbols(this.editor.model.symbolsToDelete.map(s => s.id))\n    }\n    else {\n      this.editor.removeStrokes(this.editor.model.strokesToDelete.map(s => s.id))\n    }\n    this.currentEraser = undefined\n  }\n}\n","/**\n * @group History\n */\nexport type THistoryContext = {\n  canUndo: boolean\n  canRedo: boolean\n  empty: boolean\n  stackIndex: number\n  possibleUndoCount: number\n}\n\n/**\n * @group History\n */\nexport const getInitialHistoryContext = (): THistoryContext => {\n  return {\n    stackIndex: 0,\n    possibleUndoCount: 0,\n    canRedo: false,\n    canUndo: false,\n    empty: true,\n  }\n}\n","import { EditorEvent } from \"../editor/EditorEvent\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { Model } from \"../model\"\nimport { THistoryConfiguration } from \"./HistoryConfiguration\"\nimport { THistoryContext, getInitialHistoryContext } from \"./HistoryContext\"\n\n/**\n * @group History\n */\nexport class HistoryManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.HISTORY)\n\n  configuration: THistoryConfiguration\n  event: EditorEvent\n  context: THistoryContext\n  stack: Model[]\n\n  constructor(configuration: THistoryConfiguration, event: EditorEvent)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n    this.event = event\n    this.context = getInitialHistoryContext()\n    this.stack = []\n  }\n\n  private updateContext(): void\n  {\n    this.context.canRedo = this.stack.length - 1 > this.context.stackIndex\n    this.context.canUndo = this.context.stackIndex > 0\n    this.context.empty = this.stack[this.context.stackIndex].symbols.length === 0\n  }\n\n  push(model: Model): void\n  {\n    this.#logger.info(\"push\", { model })\n    if (this.context.stackIndex + 1 < this.stack.length) {\n      this.stack.splice(this.context.stackIndex + 1)\n    }\n\n    this.stack.push(model.clone())\n    this.context.stackIndex = this.stack.length - 1\n\n    if (this.stack.length > this.configuration.maxStackSize) {\n      this.stack.shift()\n      this.context.stackIndex--\n    }\n\n    this.updateContext()\n    this.event.emitChanged(this.context)\n  }\n\n  updateStack(model: Model): void\n  {\n    this.#logger.info(\"updateStack\", { model })\n    const index = this.stack.findIndex(m => m.modificationDate === model.modificationDate)\n    if (index > -1) {\n      this.stack.splice(index, 1, model.clone())\n    }\n    this.updateContext()\n    this.event.emitChanged(this.context)\n  }\n\n  undo(): Model\n  {\n    this.#logger.info(\"undo\")\n    if (this.context.canUndo) {\n      this.context.stackIndex--\n      this.updateContext()\n      this.event.emitChanged(this.context)\n    }\n    const previousModel = this.stack[this.context.stackIndex].clone()\n    this.#logger.debug(\"undo\", previousModel)\n    return previousModel\n  }\n\n  redo(): Model\n  {\n    this.#logger.info(\"redo\")\n    if (this.context.canRedo) {\n      this.context.stackIndex++\n      this.updateContext()\n      this.event.emitChanged(this.context)\n    }\n    const nextModel = this.stack[this.context.stackIndex].clone()\n    this.#logger.debug(\"redo\", nextModel)\n    return nextModel\n  }\n}\n","import { EditorEvent } from \"../editor/EditorEvent\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { IIDecorator, IIStroke, TIISymbol, TPoint } from \"../symbol\"\nimport { TStyle } from \"../style\"\nimport { MatrixTransform, TMatrixTransform } from \"../transform\"\nimport { THistoryContext, getInitialHistoryContext } from \"./HistoryContext\"\nimport { PartialDeep } from \"../utils\"\nimport { THistoryConfiguration } from \"./HistoryConfiguration\"\n\n/**\n * @group History\n */\nexport type TIIHistoryChanges = {\n  added?: TIISymbol[]\n  updated?: TIISymbol[]\n  erased?: TIISymbol[]\n  replaced?: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] }\n  matrix?: { symbols: TIISymbol[], matrix: TMatrixTransform }\n  translate?: { symbols: TIISymbol[], tx: number, ty: number }[]\n  scale?: { symbols: TIISymbol[], scaleX: number, scaleY: number, origin: TPoint }[]\n  rotate?: { symbols: TIISymbol[], angle: number, center: TPoint }[]\n  style?: { symbols: TIISymbol[], style?: PartialDeep<TStyle>, fontSize?: number }\n  order?: { symbols: TIISymbol[], position: \"first\" | \"last\" | \"forward\" | \"backward\" }\n  decorator?: { symbol: TIISymbol, decorator: IIDecorator, added: boolean }[]\n  group?: { symbols: TIISymbol[] }\n  ungroup?: { group: TIISymbol }\n}\n\n/**\n * @group History\n * @remarks used to send messages to the backend on undo or redo\n */\nexport type TIIHistoryBackendChanges = {\n  added?: IIStroke[]\n  erased?: IIStroke[]\n  replaced?: { oldStrokes: IIStroke[], newStrokes: IIStroke[] }\n  matrix?: { strokes: IIStroke[], matrix: TMatrixTransform },\n  translate?: { strokes: IIStroke[], tx: number, ty: number }[]\n  scale?: { strokes: IIStroke[], scaleX: number, scaleY: number, origin: TPoint }[]\n  rotate?: { strokes: IIStroke[], angle: number, center: TPoint }[]\n}\n\n/**\n * @group History\n */\nexport type TIIHistoryStackItem = {\n  changes: TIIHistoryChanges\n  model: IIModel\n}\n\n/**\n * @group History\n */\nexport class IIHistoryManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.HISTORY)\n\n  configuration: THistoryConfiguration\n  event: EditorEvent\n  context: THistoryContext\n  stack: TIIHistoryStackItem[]\n\n  constructor(configuration: THistoryConfiguration, event: EditorEvent)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n    this.event = event\n    this.context = getInitialHistoryContext()\n    this.stack = []\n  }\n\n  private updateContext(): void\n  {\n    this.context.canRedo = this.stack.length - 1 > this.context.stackIndex\n    this.context.canUndo = this.context.stackIndex > 0\n    this.context.empty = this.stack[this.context.stackIndex].model.symbols.length === 0\n  }\n\n  isChangesEmpty(changes: TIIHistoryChanges): boolean\n  {\n    return !(\n      changes.added?.length ||\n      changes.updated?.length ||\n      changes.erased?.length ||\n      changes.replaced?.oldSymbols.length ||\n      changes.matrix?.symbols.length ||\n      changes.translate?.length ||\n      changes.rotate?.length ||\n      changes.scale?.length ||\n      changes.style?.symbols?.length ||\n      changes.order?.symbols?.length ||\n      changes.decorator?.length ||\n      changes.group?.symbols.length ||\n      changes.ungroup?.group\n    )\n  }\n\n  init(model: IIModel): void\n  {\n    this.stack.push({ model: model.clone(), changes: {} })\n    this.event.emitChanged(this.context)\n  }\n\n  push(model: IIModel, changes: TIIHistoryChanges): void\n  {\n    this.#logger.info(\"push\", { model, changes })\n    if (this.isChangesEmpty(changes)) return\n\n    if (this.context.stackIndex + 1 < this.stack.length) {\n      this.stack.splice(this.context.stackIndex + 1)\n    }\n\n    this.stack.push({ model: model.clone(), changes })\n    this.context.stackIndex = this.stack.length - 1\n\n    if (this.stack.length > this.configuration.maxStackSize) {\n      this.stack.shift()\n      this.context.stackIndex--\n    }\n\n    this.updateContext()\n    this.event.emitChanged(this.context)\n  }\n\n  update(model: IIModel): void\n  {\n    this.#logger.info(\"pop\")\n    const stackIdx = this.stack.findIndex(s => s.model.modificationDate === model.modificationDate)\n    if (stackIdx > -1) {\n      this.stack[stackIdx].model = model\n      this.updateContext()\n    }\n  }\n\n  pop(): void\n  {\n    this.#logger.info(\"pop\")\n    this.stack.pop()\n    this.context.stackIndex = this.stack.length - 1\n    this.updateContext()\n  }\n\n  protected reverseChanges(changes: TIIHistoryChanges): TIIHistoryChanges\n  {\n    const reversedChanges: TIIHistoryChanges = {}\n    if (changes.added) {\n      reversedChanges.erased = changes.added\n    }\n    if (changes.erased) {\n      reversedChanges.added = changes.erased\n    }\n    if (changes.replaced) {\n      reversedChanges.replaced = {\n        newSymbols: changes.replaced.oldSymbols,\n        oldSymbols: changes.replaced.newSymbols\n      }\n    }\n    if (changes.matrix) {\n      reversedChanges.matrix = {\n        symbols: changes.matrix.symbols,\n        matrix: new MatrixTransform(changes.matrix.matrix.xx, changes.matrix.matrix.yx, changes.matrix.matrix.xy, changes.matrix.matrix.yy, changes.matrix.matrix.tx, changes.matrix.matrix.ty).invert()\n      }\n    }\n    if (changes.translate?.length) {\n      reversedChanges.translate = changes.translate.map(tr =>\n      {\n        return {\n          symbols: tr.symbols,\n          tx: -tr.tx,\n          ty: -tr.ty,\n        }\n      })\n    }\n    if (changes.rotate?.length) {\n      reversedChanges.rotate = changes.rotate.map(tr =>\n      {\n        return {\n          symbols: tr.symbols,\n          angle: 2 * Math.PI - tr.angle,\n          center: tr.center\n        }\n      })\n    }\n    if (changes.scale?.length) {\n      reversedChanges.scale = changes.scale.map(tr =>\n      {\n        return {\n          symbols: tr.symbols,\n          origin: tr.origin,\n          scaleX: 1 / tr.scaleX,\n          scaleY: 1 / tr.scaleY\n        }\n      })\n    }\n\n    return reversedChanges\n  }\n\n  undo(): TIIHistoryStackItem\n  {\n    this.#logger.info(\"undo\")\n    const currentStackItem = this.stack[this.context.stackIndex]\n    if (this.context.canUndo) {\n      this.context.stackIndex--\n      this.updateContext()\n      this.event.emitChanged(this.context)\n    }\n    const previousStackItem = this.stack[this.context.stackIndex]\n    this.#logger.debug(\"undo\", previousStackItem)\n    return {\n      model: previousStackItem.model,\n      changes: this.reverseChanges(currentStackItem.changes)\n    }\n  }\n\n  redo(): TIIHistoryStackItem\n  {\n    this.#logger.info(\"redo\")\n    if (this.context.canRedo) {\n      this.context.stackIndex++\n      this.updateContext()\n      this.event.emitChanged(this.context)\n    }\n    const nextStackItem = this.stack[this.context.stackIndex]\n    this.#logger.debug(\"redo\", nextStackItem)\n    return nextStackItem\n  }\n\n  clear(): void\n  {\n    this.context = getInitialHistoryContext()\n    this.stack = []\n  }\n}","import { EditorEvent } from \"../editor/EditorEvent\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IModel } from \"../model\"\nimport { IIStroke, TIISymbol } from \"../symbol\"\nimport { THistoryContext, getInitialHistoryContext } from \"./HistoryContext\"\nimport { THistoryConfiguration } from \"./HistoryConfiguration\"\n\n/**\n * @group History\n */\nexport type TIHistoryChanges = {\n  added?: TIISymbol[]\n  removed?: TIISymbol[]\n}\n\n/**\n * @group History\n * @remarks used to send messages to the backend on undo or redo\n */\nexport type TIHistoryBackendChanges = {\n  added?: IIStroke[]\n  removed?: IIStroke[]\n}\n\n/**\n * @group History\n */\nexport type TIHistoryStackItem = {\n  changes: TIHistoryChanges\n  model: IModel\n}\n\n/**\n * @group History\n */\nexport class IHistoryManager {\n  #logger = LoggerManager.getLogger(LoggerCategory.HISTORY)\n\n  configuration: THistoryConfiguration\n  event: EditorEvent\n  context: THistoryContext\n  stack: TIHistoryStackItem[]\n\n  constructor(configuration: THistoryConfiguration, event: EditorEvent) {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n    this.event = event\n    this.context = getInitialHistoryContext()\n    this.stack = []\n  }\n\n  private updateContext(): void {\n    this.context.canRedo = this.stack.length - 1 > this.context.stackIndex\n    this.context.canUndo = this.context.stackIndex > 0\n    this.context.empty = this.stack[this.context.stackIndex].model.strokes.length === 0\n  }\n\n  updateModelStack(model: IModel): void {\n    this.#logger.info(\"updateModelStack\", { model })\n    const stackIdx = this.stack.findIndex(s => s.model.modificationDate === model.modificationDate)\n    if (stackIdx > -1) {\n      this.stack[stackIdx].model = model.clone()\n      this.updateContext()\n    }\n    this.updateContext()\n    this.event.emitChanged(this.context)\n  }\n\n  isChangesEmpty(changes: TIHistoryChanges): boolean {\n    return !(\n      changes.added?.length ||\n      changes.removed?.length\n    )\n  }\n\n  init(model: IModel): void {\n    this.stack.push({ model: model.clone(), changes: {} })\n    this.event.emitChanged(this.context)\n  }\n\n  push(model: IModel, changes: TIHistoryChanges): void {\n    this.#logger.info(\"push\", { model, changes })\n    if (this.isChangesEmpty(changes)) return\n\n    if (this.context.stackIndex + 1 < this.stack.length) {\n      this.stack.splice(this.context.stackIndex + 1)\n    }\n\n    this.stack.push({ model: model.clone(), changes })\n    this.context.stackIndex = this.stack.length - 1\n\n    if (this.stack.length > this.configuration.maxStackSize) {\n      this.stack.shift()\n      this.context.stackIndex--\n    }\n\n    this.updateContext()\n    this.event.emitChanged(this.context)\n  }\n\n  pop(): void {\n    this.#logger.info(\"pop\")\n    this.stack.pop()\n    this.context.stackIndex = this.stack.length - 1\n    this.updateContext()\n  }\n\n  protected reverseChanges(changes: TIHistoryChanges): TIHistoryChanges {\n    const reversedChanges: TIHistoryChanges = {}\n    if (changes.added) {\n      reversedChanges.removed = changes.added\n    }\n    if (changes.removed) {\n      reversedChanges.added = changes.removed\n    }\n    return reversedChanges\n  }\n\n  undo(): TIHistoryStackItem {\n    this.#logger.info(\"undo\")\n    const currentStackItem = this.stack[this.context.stackIndex]\n    if (this.context.canUndo) {\n      this.context.stackIndex--\n      this.updateContext()\n      this.event.emitChanged(this.context)\n    }\n    const previousStackItem = this.stack[this.context.stackIndex]\n    this.#logger.debug(\"undo\", previousStackItem)\n    return {\n      model: previousStackItem.model,\n      changes: this.reverseChanges(currentStackItem.changes)\n    }\n  }\n\n  redo(): TIHistoryStackItem {\n    this.#logger.info(\"redo\")\n    if (this.context.canRedo) {\n      this.context.stackIndex++\n      this.updateContext()\n      this.event.emitChanged(this.context)\n    }\n    const nextStackItem = this.stack[this.context.stackIndex]\n    this.#logger.debug(\"redo\", nextStackItem)\n    return nextStackItem\n  }\n\n  clear(): void {\n    this.context = getInitialHistoryContext()\n    this.stack = []\n  }\n}\n","\n/**\n * @group History\n */\nexport type THistoryConfiguration = {\n  maxStackSize: number\n}\n\n/**\n * @group History\n * @source\n */\nexport const DefaultHistoryConfiguration: THistoryConfiguration = {\n  maxStackSize: 100\n}\n","/**\n * @group Menu\n * @remarks Helper functions to reduce boilerplate code in menu creation\n */\n\n/**\n * Creates a button element with common menu button styling\n * @param id - The button ID\n * @param innerHTML - The button content (can be HTML/SVG icon)\n * @param onClick - The click handler function\n * @param additionalClasses - Optional additional CSS classes\n * @returns The configured button element\n */\nexport function createMenuButton(\n  id: string,\n  innerHTML: string,\n  onClick: () => void,\n  additionalClasses: string[] = []\n): HTMLButtonElement {\n  const btn = document.createElement(\"button\")\n  btn.id = id\n  btn.classList.add(\"ms-menu-button\", \"square\", ...additionalClasses)\n  btn.innerHTML = innerHTML\n  btn.addEventListener(\"pointerup\", onClick)\n  return btn\n}\n\n/**\n * Creates a button with text content instead of HTML\n * @param id - The button ID\n * @param textContent - The button text\n * @param onClick - The click handler function\n * @param additionalClasses - Optional additional CSS classes\n * @returns The configured button element\n */\nexport function createMenuButtonWithText(\n  id: string,\n  textContent: string,\n  onClick: () => void,\n  additionalClasses: string[] = []\n): HTMLButtonElement {\n  const btn = document.createElement(\"button\")\n  btn.id = id\n  btn.classList.add(\"ms-menu-button\", ...additionalClasses)\n  btn.textContent = textContent\n  btn.addEventListener(\"pointerup\", onClick)\n  return btn\n}\n","import ArrowDown from \"../assets/svg/nav-arrow-down.svg\"\nimport { createMenuButtonWithText } from \"./MenuHelper\"\n\n/**\n * @group Menu\n */\nexport type TMenuItem = {\n  id: string,\n  label: string,\n  type: \"button\" | \"checkbox\" | \"select\" | \"list\" | \"colors\"\n  disabled?: boolean\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemButton = TMenuItem & {\n  type: \"button\"\n  icon?: string\n  callback: () => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemButtonList = TMenuItem & {\n  type: \"list\"\n  initValue: string,\n  values: { label: string, value: string }[]\n  callback: (value: string) => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemColorList = TMenuItem & {\n  type: \"colors\"\n  initValue: string,\n  values: string[]\n  fill: boolean\n  callback: (value: string) => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemBoolean = TMenuItem & {\n  type: \"checkbox\",\n  initValue: boolean | \"indeterminate\",\n  callback: (value: boolean) => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemSelect = TMenuItem & {\n  type: \"select\",\n  initValue: string,\n  values: { label: string, value: string }[]\n  callback: (value: string) => void\n}\n\n/**\n * @group Menu\n */\nexport abstract class IIMenu\n{\n  thicknessList = [\n    { label: \"S\", value: 1 },\n    { label: \"M\", value: 2 },\n    { label: \"L\", value: 4 },\n    { label: \"XL\", value: 8 },\n  ]\n\n  fontSizeList = [\n    { label: \"Auto\", value: \"auto\" },\n    { label: \"S\", value: 0.5 },\n    { label: \"M\", value: 0.75 },\n    { label: \"L\", value: 1 },\n  ]\n\n  fontWeightList = [\n    { label: \"Auto\", value: \"auto\" },\n    { label: \"Normal\", value: \"normal\" },\n    { label: \"Bold\", value: \"bold\" },\n  ]\n\n  colors = [\n    \"#000000\", \"#808080\", \"#ffffff\", \"transparent\",\n    \"#ff0000\", \"#ff6400\", \"#ffc800\", \"#ffff00\",\n    \"#0000ff\", \"#0064ff\", \"#00c8ff\", \"#00ffff\",\n    \"#008000\", \"#00af00\", \"#00e100\", \"#00ff00\"\n  ]\n\n  protected createWrapCollapsible(el: Node, title: string): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"collapsible-wrapper\")\n    const head = document.createElement(\"div\")\n    head.classList.add(\"collapsible-header\")\n    head.textContent = title\n    const btn = document.createElement(\"span\")\n    btn.classList.add(\"collapsible-header-icon\")\n    btn.innerHTML = ArrowDown\n    head.appendChild(btn)\n    head.style.setProperty(\"pointer\", \"cursor\")\n    const content = document.createElement(\"div\")\n    content.classList.add(\"collapsible-content\")\n    head.addEventListener(\"pointerup\", () => wrapper.classList.toggle(\"active\"))\n    wrapper.appendChild(head)\n    content.appendChild(el)\n    wrapper.appendChild(content)\n    return wrapper\n  }\n\n  protected createMenuItemBoolean(item: TMenuItemBoolean): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    const checkbox = document.createElement(\"input\")\n    checkbox.id = item.id\n    checkbox.setAttribute(\"type\", \"checkbox\")\n    if (item.disabled) {\n      checkbox.disabled = true\n    }\n    if (item.initValue === \"indeterminate\") {\n      checkbox.indeterminate = true\n    } else {\n      checkbox.checked = item.initValue\n    }\n    checkbox.addEventListener(\"change\", (e) => item.callback((e.target as HTMLInputElement).checked))\n    wrapper.appendChild(checkbox)\n    return wrapper\n  }\n\n  protected createMenuItemSelect(item: TMenuItemSelect): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    const select = document.createElement(\"select\")\n    select.id = item.id\n    if (item.disabled) {\n      select.disabled = true\n    }\n    item.values.forEach(v =>\n    {\n      const selected = v.value === item.initValue\n      const opt = new Option(v.label, v.value.toString(), selected, selected)\n      select.appendChild(opt)\n    })\n    select.addEventListener(\"change\", (e) => item.callback((e.target as HTMLInputElement).value))\n    wrapper.appendChild(select)\n    return wrapper\n  }\n\n  protected createMenuItemButton(item: TMenuItemButton): HTMLElement\n  {\n    const btn = document.createElement(\"button\")\n    btn.classList.add(\"ms-menu-item\", \"ms-menu-button\")\n    btn.innerHTML = item.icon || item.label\n    btn.addEventListener(\"pointerup\", item.callback)\n    return btn\n  }\n\n  protected createMenuItemButtonList(item: TMenuItemButtonList): HTMLElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    wrapper.id = item.id\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    item.values.forEach((v) =>\n    {\n      const btn = createMenuButtonWithText(\n        `${item.id}-${ v.value }-btn`,\n        v.label,\n        () => {\n          item.callback(v.value)\n          wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n          btn.classList.add(\"active\")\n        },\n        item.initValue === v.value ? [\"active\"] : []\n      )\n      if (item.disabled) {\n        btn.disabled = true\n      }\n      wrapper.appendChild(btn)\n    })\n    return wrapper\n  }\n\n  protected createMenuItemColorList(item: TMenuItemColorList): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    wrapper.id = item.id\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    wrapper.appendChild(this.createColorList(item))\n    return wrapper\n  }\n\n  protected createColorList(item: TMenuItemColorList): HTMLDivElement\n  {\n    const list = document.createElement(\"div\")\n    list.id = `${ item.id }-list`\n    list.classList.add(\"ms-menu-row\", \"color-list\")\n    item.values.forEach((color) =>\n    {\n      const btn = document.createElement(\"button\")\n      if (item.disabled) {\n        btn.disabled = true\n      }\n      btn.id = `${ item.id }-${ color.replace(\"#\", \"\") }-btn`\n      btn.classList.add(\"ms-menu-button\", \"square\")\n      const colorEl = document.createElement(\"div\")\n      colorEl.classList.add(\"color\")\n      if (item.fill) {\n        colorEl.style.setProperty(\"background-color\", color)\n        colorEl.style.setProperty(\"border\", \"1px solid lightgrey\")\n      } else {\n        colorEl.style.setProperty(\"background-color\", \"transparent\")\n        colorEl.style.setProperty(\"border\", `3px solid ${ color }`)\n      }\n      if (color === \"#ffffff\") {\n        colorEl.style.setProperty(\"border\", \"1px solid black\")\n      }\n      if (color === \"transparent\") {\n        colorEl.style.setProperty(\"background-image\", \"linear-gradient(45deg, #AAA 10%, transparent 20%, #AAA 30%, transparent 40%, #AAA 50%, transparent 60%, #AAA 70%, transparent 80%, #AAA 90%, transparent 100%)\")\n      }\n      if (item.initValue === color) {\n        btn.classList.add(\"active\")\n      }\n      btn.appendChild(colorEl)\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        item.callback(color)\n        list.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n      })\n      list!.appendChild(btn)\n    })\n    return list\n  }\n\n  protected createMenuItem(item: TMenuItem): HTMLElement\n  {\n    switch (item.type) {\n      case \"checkbox\":\n        return this.createMenuItemBoolean(item as TMenuItemBoolean)\n      case \"select\":\n        return this.createMenuItemSelect(item as TMenuItemSelect)\n      case \"list\":\n        return this.createMenuItemButtonList(item as TMenuItemButtonList)\n      case \"colors\":\n        return this.createMenuItemColorList(item as TMenuItemColorList)\n      case \"button\":\n      default:\n        return this.createMenuItemButton(item as TMenuItemButton)\n    }\n  }\n\n  abstract render(domElement: HTMLElement): void\n\n  abstract update(): void\n\n  abstract show(): void\n\n  abstract hide(): void\n\n  abstract destroy(): void\n}\n","\n/**\n * @group Gesture\n * @summary List all authorized gestures\n */\nexport type TGestureType = \"UNDERLINE\" | \"SCRATCH\" | \"JOIN\" | \"INSERT\" | \"STRIKETHROUGH\" | \"SURROUND\"\n\n/**\n * @group Gesture\n * @remarks\n *  when gestureType = \"INSERT\", subStrokes represent the two parts\n *  when gestureType = \"SCRATCH\", subStrokes represent the part to substract at the stroke corresponding fullStrokeId\n */\nexport type TGesture = {\n  gestureType: TGestureType\n  gestureStrokeId: string\n  strokeIds: string[]\n  strokeBeforeIds: string[]\n  strokeAfterIds: string[]\n  subStrokes?: { fullStrokeId: string, x: number[], y: number[] }[]\n}\n\n/**\n * @group Gesture\n * @summary\n * List all action allowed on surround detected\n * @remarks\n * only usable in the case of offscreen\n */\nexport enum SurroundAction\n{\n  Select = \"select\",\n  Surround = \"surround\",\n  Highlight = \"highlight\"\n}\n\n/**\n * @group Gesture\n * @summary\n * List all action allowed on strikeThrough detected\n * @remarks\n * only usable in the case of offscreen\n */\nexport enum StrikeThroughAction\n{\n  Erase = \"erase\",\n  Draw = \"draw\"\n}\n\n/**\n * @group Gesture\n * @summary\n * List all action allowed on split detected\n * @remarks\n * only usable in the case of offscreen\n */\nexport enum InsertAction\n{\n  /**\n   * @remarks Add line break on gesture place\n   */\n  LineBreak = \"line-break\",\n  /**\n   * @remarks Insert place in gesture place\n   */\n  Insert = \"insert\"\n}\n","import { InsertAction, StrikeThroughAction, SurroundAction } from \"./Gesture\"\n\n/**\n * @group Gesture\n * @source\n */\nexport type TGestureConfiguration = {\n  surround: SurroundAction\n  strikeThrough: StrikeThroughAction\n  insert: InsertAction\n}\n\n/**\n * @group Gesture\n * @source\n */\nexport const DefaultGestureConfiguration: TGestureConfiguration = {\n  surround: SurroundAction.Select,\n  strikeThrough: StrikeThroughAction.Draw,\n  insert: InsertAction.LineBreak\n}\n","import { EditorTool } from \"../Constants\"\nimport { LoggerManager, LoggerCategory } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport\n{\n  IIDecorator,\n  IIStroke,\n  SymbolType,\n  IIText,\n  DecoratorKind,\n  IISymbolGroup,\n  TIISymbol,\n  Box,\n  TPoint,\n  IIRecognizedText,\n  RecognizedKind,\n} from \"../symbol\"\nimport { RecognizerWebSocket } from \"../recognizer\"\nimport { SVGRenderer } from \"../renderer\"\nimport { IIHistoryManager, TIIHistoryChanges } from \"../history\"\nimport { computeAverage, isBetween, PartialDeep } from \"../utils\"\nimport { IITranslateManager } from \"../manager/IITranslateManager\"\nimport { IITextManager } from \"../manager/IITextManager\"\nimport { InteractiveInkEditor } from \"../editor\"\nimport { InsertAction, StrikeThroughAction, SurroundAction, TGesture } from \"./Gesture\"\nimport { DefaultGestureConfiguration, TGestureConfiguration } from \"./GestureConfiguration\"\n\n/**\n * @group Gesture\n */\nexport class IIGestureManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.GESTURE)\n\n  static readonly #DECORABLE_TYPES = new Set([SymbolType.Group, SymbolType.Stroke, SymbolType.Text, SymbolType.Recognized])\n  static readonly #TEXT_STROKE_GROUP_TYPES = new Set([SymbolType.Text, SymbolType.Stroke, SymbolType.Group])\n  static readonly #SURROUND_SELECT_TYPES = new Set([SymbolType.Group, SymbolType.Stroke, SymbolType.Text])\n  static readonly #ERASE_OVERLAY_TYPES = new Set([SymbolType.Stroke, SymbolType.Text, SymbolType.Group])\n  static readonly #ERASE_CONTAIN_TYPES = new Set([SymbolType.Shape, SymbolType.Edge])\n\n  insertAction: InsertAction = InsertAction.LineBreak\n  surroundAction: SurroundAction = SurroundAction.Select\n  strikeThroughAction: StrikeThroughAction = StrikeThroughAction.Draw\n  editor: InteractiveInkEditor\n\n  constructor(editor: InteractiveInkEditor, gestureAction?: PartialDeep<TGestureConfiguration>)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.surroundAction = gestureAction?.surround || DefaultGestureConfiguration.surround\n    this.strikeThroughAction = gestureAction?.strikeThrough || DefaultGestureConfiguration.strikeThrough\n    this.insertAction = gestureAction?.insert || DefaultGestureConfiguration.insert\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get recognizer(): RecognizerWebSocket\n  {\n    return this.editor.recognizer\n  }\n\n  get translator(): IITranslateManager\n  {\n    return this.editor.translator\n  }\n\n  get texter(): IITextManager\n  {\n    return this.editor.texter\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get history(): IIHistoryManager\n  {\n    return this.editor.history\n  }\n\n  get rowHeight(): number\n  {\n    return this.editor.configuration.rendering.guides.gap\n  }\n\n  get strokeSpaceWidth(): number\n  {\n    return this.editor.configuration.rendering.guides.gap * 2\n  }\n\n  async applySurroundGesture(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.info(\"applySurroundGesture\", { gestureStroke, gesture })\n    const changes: TIIHistoryChanges = {}\n    const ids = this.model.symbols.filter(s => gestureStroke.bounds.contains(s.bounds)).map(s => s.id)\n    switch (this.surroundAction) {\n      case SurroundAction.Select: {\n        if (ids.length) {\n          this.editor.tool = EditorTool.Select\n          this.editor.select(ids)\n        }\n        break\n      }\n      case SurroundAction.Highlight: {\n        const symbolIdSet = new Set<string>()\n        changes.decorator = []\n        ids.forEach(id =>\n        {\n          const sym = this.model.getRootSymbol(id)\n          if (sym && IIGestureManager.#DECORABLE_TYPES.has(sym.type) && !symbolIdSet.has(sym.id)) {\n            const symWithDec = sym as (IIText | IIStroke | IISymbolGroup | IIRecognizedText)\n            const highlight = new IIDecorator(DecoratorKind.Highlight, this.editor.penStyle)\n            const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Highlight)\n            const added = index === -1\n            // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n            added ? symWithDec.decorators.push(highlight) : symWithDec.decorators.splice(index, 1)\n            this.model.updateSymbol(symWithDec)\n            this.renderer.drawSymbol(symWithDec)\n            symbolIdSet.add(symWithDec.id)\n            changes.decorator!.push({ symbol: symWithDec, decorator: highlight, added })\n          }\n        })\n        if (changes.decorator.length) {\n          this.history.push(this.model, changes)\n        }\n        break\n      }\n      case SurroundAction.Surround: {\n        const symbolIdSet = new Set<string>()\n        changes.decorator = []\n        ids.forEach(id =>\n        {\n          const sym = this.model.getRootSymbol(id)\n          if (sym && IIGestureManager.#DECORABLE_TYPES.has(sym.type) && !symbolIdSet.has(sym.id)) {\n            const symWithDec = sym as (IIText | IIStroke | IISymbolGroup | IIRecognizedText)\n            const surround = new IIDecorator(DecoratorKind.Surround, this.editor.penStyle)\n            const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Surround)\n            const added = index === -1\n            // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n            added ? symWithDec.decorators.push(surround) : symWithDec.decorators.splice(index, 1)\n            this.model.updateSymbol(symWithDec)\n            this.renderer.drawSymbol(symWithDec)\n            changes.decorator!.push({ symbol: symWithDec, decorator: surround, added })\n            symbolIdSet.add(symWithDec.id)\n          }\n        })\n        this.history.push(this.model, changes)\n        break\n      }\n      default:\n        this.#logger.error(\"applySurroundGesture\", `Unknow surroundAction: ${ this.surroundAction }, values allowed are: ${ SurroundAction.Highlight }, ${ SurroundAction.Select }, ${ SurroundAction.Surround }`)\n        break\n    }\n    return\n  }\n\n  protected computeScratchOnStrokes(gesture: TGesture, stroke: IIStroke): IIStroke[]\n  {\n    const newStrokes: IIStroke[] = []\n    const partPointersToRemove = gesture.subStrokes?.find(ss => ss.fullStrokeId === stroke.id)\n    if (partPointersToRemove) {\n      const strokePartToErase = new IIStroke()\n      partPointersToRemove.x.forEach((x, i) => strokePartToErase.addPointer({ x, y: partPointersToRemove.y[i], p: 1, t: 1 }))\n      const subStrokes = IIStroke.substract(stroke, strokePartToErase)\n      if (subStrokes.before && subStrokes.before.pointers.length > 1) newStrokes.push(subStrokes.before)\n      if (subStrokes.after && subStrokes.after.pointers.length > 1) newStrokes.push(subStrokes.after)\n    }\n    return newStrokes\n  }\n\n  protected computeScratchOnText(gestureStroke: IIStroke, textSymbol: IIText): IIText | undefined\n  {\n    const charsToRemove = textSymbol.getCharsOverlaps(gestureStroke.pointers)\n    if (textSymbol.chars.length == charsToRemove.length) {\n      return\n    }\n    else {\n      charsToRemove.forEach(c =>\n      {\n        const cIndex = textSymbol.chars.findIndex(c1 => c1.id === c.id)\n        textSymbol.chars.splice(cIndex, 1)\n      })\n      this.texter.updateBounds(textSymbol)\n      return textSymbol\n    }\n  }\n\n  protected computeScratchOnSymbol(gestureStroke: IIStroke, gesture: TGesture, symbol: TIISymbol): { erased?: boolean, replaced?: TIISymbol[] }\n  {\n    switch (symbol.type) {\n      case SymbolType.Stroke: {\n        const strokesScratchedResult = this.computeScratchOnStrokes(gesture, symbol)\n        if (strokesScratchedResult.length) {\n          return {\n            replaced: strokesScratchedResult\n          }\n        }\n        else {\n          return { erased: true }\n        }\n      }\n      case SymbolType.Recognized: {\n        if (symbol.kind === RecognizedKind.Text) {\n          const childrenNotTouch = symbol.strokes.filter(s => !gestureStroke.bounds.overlaps(s.bounds))\n          const childrenTouch = symbol.strokes.filter(s => gestureStroke.bounds.overlaps(s.bounds))\n          const results = childrenTouch.map(s =>\n          {\n            return {\n              symbol: s,\n              result: this.computeScratchOnStrokes(gesture, s)\n            }\n          })\n          if (childrenNotTouch.length === 0 && results.every(r => r.result.length === 0)) {\n            return { erased: true }\n          }\n          else {\n            const strokesToConserve: IIStroke[] = childrenNotTouch.concat(...results.flatMap(r => r.result))\n            const strokeText = new IIRecognizedText(strokesToConserve, { baseline: symbol.baseline, xHeight: symbol.xHeight }, symbol.style)\n            strokeText.decorators = symbol.decorators\n            return {\n              replaced: [strokeText]\n            }\n          }\n        }\n        return {}\n      }\n      case SymbolType.Group: {\n        const childrenNotTouch = symbol.children.filter(s => !gestureStroke.bounds.overlaps(s.bounds))\n        const childrenTouch = symbol.children.filter(s => gestureStroke.bounds.overlaps(s.bounds))\n        const results = childrenTouch.map(s =>\n        {\n          return {\n            symbol: s,\n            result: this.computeScratchOnSymbol(gestureStroke, gesture, s)\n          }\n        })\n        if (childrenNotTouch.length === 0 && results.every(r => r.result.erased)) {\n          return { erased: true }\n        }\n        else {\n          const symbolsGroup: TIISymbol[] = childrenNotTouch\n          results.forEach(r =>\n          {\n            if (r.result.replaced) {\n              symbolsGroup.push(...r.result.replaced)\n            }\n          })\n          const newGroup = new IISymbolGroup(symbolsGroup, symbol.style)\n          newGroup.decorators = symbol.decorators\n          return {\n            replaced: [newGroup]\n          }\n        }\n      }\n      case SymbolType.Text: {\n        const textScratchedResult = this.computeScratchOnText(gestureStroke, symbol)\n        if (textScratchedResult) {\n          return {\n            replaced: [textScratchedResult]\n          }\n        }\n        else {\n          return {\n            erased: true\n          }\n        }\n      }\n      case SymbolType.Shape:\n      case SymbolType.Edge: {\n        return {\n          erased: true\n        }\n      }\n    }\n  }\n\n  async applyScratch(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyScratchGesture\", { gestureStroke, gesture })\n    if (!gesture.strokeIds.length) {\n      this.#logger.warn(\"applyScratchGesture\", \"Unable to apply underline because there are no strokes\")\n      return\n    }\n    const symbolsToUpdate: TIISymbol[] = []\n    const symbolsToErase: TIISymbol[] = []\n    const symbolsToReplace: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    gesture.strokeIds.forEach(id =>\n    {\n      const sym = this.model.getRootSymbol(id)\n      if (sym && !symbolsToErase.some(s => s.id === sym.id) && !symbolsToReplace.oldSymbols.some(s => s.id === sym.id)) {\n        const result = this.computeScratchOnSymbol(gestureStroke, gesture, sym)\n        if (result.erased) symbolsToErase.push(sym)\n        else if (result.replaced) {\n          symbolsToReplace.newSymbols.push(...result.replaced)\n          symbolsToReplace.oldSymbols.push(sym)\n        }\n      }\n    })\n\n    const promises: Promise<void | TIISymbol[]>[] = []\n    const changes: TIIHistoryChanges = {}\n    if (symbolsToUpdate.length) {\n      promises.push(this.editor.updateSymbols(symbolsToUpdate, false))\n      changes.updated = symbolsToUpdate\n    }\n\n    if (symbolsToErase.length) {\n      promises.push(this.editor.removeSymbols(symbolsToErase.map(s => s.id), false))\n      changes.erased = symbolsToErase\n    }\n\n    if (symbolsToReplace.newSymbols.length) {\n      changes.replaced = symbolsToReplace\n      promises.push(this.editor.replaceSymbols(symbolsToReplace.oldSymbols, symbolsToReplace.newSymbols, false))\n    }\n\n    this.history.push(this.model, changes)\n    await Promise.all(promises)\n  }\n\n  async applyJoinGesture(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyJoinGesture\", { gestureStroke, gesture })\n\n    const symbolsAbove = this.model.symbols.filter(s => this.model.isSymbolAbove(gestureStroke, s))\n    const symbolsRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s))\n\n    const symbolsBeforeGestureInRow = symbolsRow.filter(s => s.bounds.xMax <= gestureStroke.bounds.xMid)\n    const symbolsOnGestureInRow = symbolsRow.filter(s => s.bounds.xMax > gestureStroke.bounds.xMid && s.bounds.xMin <= gestureStroke.bounds.xMid)\n    const symbolsAfterGestureInRow = symbolsRow.filter(s => s.bounds.xMin > gestureStroke.bounds.xMid)\n    const symbolsBelow = this.model.symbols.filter(s => this.model.isSymbolBelow(gestureStroke, s))\n\n    const changes: TIIHistoryChanges = {}\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    if (symbolsOnGestureInRow.length) {\n      const symbolToJoin = symbolsOnGestureInRow[0]\n      if (symbolToJoin?.type === SymbolType.Group) {\n        const children = symbolToJoin.children.map(c => c.clone())\n        const childBefore = children.filter(c => c.bounds.xMid <= gestureStroke.bounds.xMid)\n        const childAfter = children.filter(c => c.bounds.xMid > gestureStroke.bounds.xMid)\n        if (childBefore.length && childAfter.length) {\n          const tx = Math.max(...childBefore.map(c => c.bounds.xMax)) - Math.min(...childAfter.map(c => c.bounds.xMin))\n          childAfter.forEach(c => this.translator.applyToSymbol(c, tx, 0))\n          const newGroup = new IISymbolGroup(children, symbolToJoin.style)\n          newGroup.decorators = symbolToJoin.decorators.map(d => d.clone())\n          changes.replaced = {\n            oldSymbols: [symbolToJoin],\n            newSymbols: [newGroup]\n          }\n          if (symbolsAfterGestureInRow.length) {\n            translate.push({ symbols: symbolsAfterGestureInRow, tx, ty: 0 })\n          }\n        }\n        else if (symbolsAfterGestureInRow.length) {\n          const tx = symbolToJoin.bounds.xMax - Math.min(...symbolsAfterGestureInRow.map(s => s.bounds.xMin))\n          translate.push({ symbols: symbolsAfterGestureInRow, tx, ty: 0 })\n        }\n      }\n      else if (symbolToJoin?.type === SymbolType.Recognized) {\n        const strokeText = symbolToJoin.clone()\n        const childBefore = strokeText.strokes.filter(c => c.bounds.xMid <= gestureStroke.bounds.xMid)\n        const childAfter = strokeText.strokes.filter(c => c.bounds.xMid > gestureStroke.bounds.xMid)\n        if (childBefore.length && childAfter.length) {\n          const tx = Math.max(...childBefore.map(c => c.bounds.xMax)) - Math.min(...childAfter.map(c => c.bounds.xMin))\n          childAfter.forEach(c => this.translator.applyToSymbol(c, tx, 0))\n          changes.replaced = {\n            oldSymbols: [symbolToJoin],\n            newSymbols: [strokeText]\n          }\n          if (symbolsAfterGestureInRow.length) {\n            translate.push({ symbols: symbolsAfterGestureInRow, tx, ty: 0 })\n          }\n        }\n        else if (symbolsAfterGestureInRow.length) {\n          const tx = symbolToJoin.bounds.xMax - Math.min(...symbolsAfterGestureInRow.map(s => s.bounds.xMin))\n          translate.push({ symbols: symbolsAfterGestureInRow, tx, ty: 0 })\n        }\n      }\n    }\n    else if (symbolsBeforeGestureInRow.length && symbolsAfterGestureInRow.length) {\n      const lastSymbBefore = this.model.getLastSymbol(symbolsBeforeGestureInRow)!\n      const firstSymbolAfter = this.model.getFirstSymbol(symbolsAfterGestureInRow)!\n\n      let lastXBefore = symbolsBeforeGestureInRow[0].bounds.xMax\n      for (let i = 1; i < symbolsBeforeGestureInRow.length; i++) {\n        const xMax = symbolsBeforeGestureInRow[i].bounds.xMax\n        if (xMax > lastXBefore) lastXBefore = xMax\n      }\n      let firstXAfter = symbolsAfterGestureInRow[0].bounds.xMin\n      for (let i = 1; i < symbolsAfterGestureInRow.length; i++) {\n        const xMin = symbolsAfterGestureInRow[i].bounds.xMin\n        if (xMin < firstXAfter) firstXAfter = xMin\n      }\n      const translateX = lastXBefore - firstXAfter\n\n      const lastSymbBeforeClone = lastSymbBefore.clone()\n      const firstSymbolAfterClone = firstSymbolAfter.clone()\n      this.translator.applyToSymbol(firstSymbolAfterClone, translateX, 0)\n      const symbolsToGroup = lastSymbBefore.type === SymbolType.Group ? (lastSymbBeforeClone as IISymbolGroup).children : [lastSymbBeforeClone]\n      symbolsToGroup.push(...(firstSymbolAfterClone.type === SymbolType.Group ? (firstSymbolAfterClone as IISymbolGroup).children : [firstSymbolAfterClone]))\n\n      if (symbolsToGroup.every(s => s.type === SymbolType.Text)) {\n        const texts = symbolsToGroup as IIText[]\n        const text = new IIText(texts.flatMap(s => s.chars), texts[0].point, Box.createFromBoxes(texts.map(t => t.bounds)))\n        this.texter.setBounds(text)\n        changes.replaced = {\n          oldSymbols: [lastSymbBefore, firstSymbolAfter],\n          newSymbols: [text]\n        }\n      }\n      else if (symbolsToGroup.every(s => s.type === SymbolType.Recognized)) {\n        const strokeTexts = symbolsToGroup as IIRecognizedText[]\n        const strokeText = new IIRecognizedText(strokeTexts.flatMap(s => s.strokes), strokeTexts[0], strokeTexts[0].style)\n        changes.replaced = {\n          oldSymbols: [lastSymbBefore, firstSymbolAfter],\n          newSymbols: [strokeText]\n        }\n      }\n      else {\n        const group = new IISymbolGroup(symbolsToGroup, lastSymbBefore.style)\n        if (IIGestureManager.#DECORABLE_TYPES.has(lastSymbBefore.type)) {\n          (lastSymbBefore as IIStroke).decorators.forEach(d =>\n          {\n            group.decorators.push(new IIDecorator(d.kind, d.style))\n          })\n        }\n        if (IIGestureManager.#DECORABLE_TYPES.has(firstSymbolAfter.type)) {\n          (firstSymbolAfter as IIStroke).decorators.forEach(d =>\n          {\n            if (!group.decorators.some(d1 => d1.kind == d.kind)) {\n              group.decorators.push(new IIDecorator(d.kind, d.style))\n            }\n          })\n        }\n\n        changes.replaced = {\n          oldSymbols: [lastSymbBefore, firstSymbolAfter],\n          newSymbols: [group]\n        }\n      }\n\n      const rest = symbolsAfterGestureInRow.filter(s => s.id !== firstSymbolAfter.id)\n      if (rest.length) {\n        translate.push({ symbols: rest, tx: translateX, ty: 0 })\n      }\n    }\n    else if (symbolsBeforeGestureInRow.length) {\n      const lastSymbolBeforeGesture = this.model.getLastSymbol(symbolsBeforeGestureInRow)!\n      const firstSymbolAfterGesture = this.model.getFirstSymbol(symbolsBelow)\n      if (firstSymbolAfterGesture) {\n        if (this.model.roundToLineGuide(lastSymbolBeforeGesture.bounds.yMid) >= this.model.roundToLineGuide(firstSymbolAfterGesture.bounds.yMid - this.rowHeight)) {\n          const symbolInNextRow = symbolsBelow.filter(s => this.model.isSymbolInRow(firstSymbolAfterGesture, s))\n          if (symbolInNextRow.length) {\n            const translateX = lastSymbolBeforeGesture.bounds.xMax + this.strokeSpaceWidth - firstSymbolAfterGesture.bounds.xMin\n            translate.push({ symbols: symbolInNextRow, tx: translateX, ty: -this.rowHeight })\n          }\n          const symbolsAfterNextRow = symbolsBelow.filter(s => this.model.isSymbolBelow(firstSymbolAfterGesture, s))\n          if (symbolsAfterNextRow.length) {\n            translate.push({ symbols: symbolsAfterNextRow, tx: 0, ty: -this.rowHeight })\n          }\n        }\n      }\n      else {\n        translate.push({ symbols: symbolsBelow, tx: 0, ty: -this.rowHeight })\n      }\n    }\n    else if (symbolsAfterGestureInRow.length) {\n      const firstSymbolAfterGesture = this.model.getFirstSymbol(symbolsAfterGestureInRow)!\n      const lastSymbolAbove = this.model.getLastSymbol(symbolsAbove)\n      if (lastSymbolAbove) {\n        if (this.model.roundToLineGuide(lastSymbolAbove.bounds.yMid) >= this.model.roundToLineGuide(firstSymbolAfterGesture.bounds.yMid - this.rowHeight)) {\n          const translateX = lastSymbolAbove.bounds.xMax + this.strokeSpaceWidth - firstSymbolAfterGesture.bounds.xMin\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: translateX, ty: -this.rowHeight })\n        }\n        else {\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: 0, ty: -this.rowHeight })\n        }\n\n        if (symbolsBelow.length) {\n          translate.push({ symbols: symbolsBelow, tx: 0, ty: -this.rowHeight })\n        }\n      }\n      else {\n        translate.push({ symbols: symbolsAfterGestureInRow.concat(...symbolsBelow), tx: 0, ty: -this.rowHeight })\n      }\n\n    }\n    if (changes.replaced?.oldSymbols.length) {\n      this.editor.replaceSymbols(changes.replaced.oldSymbols, changes.replaced.newSymbols, false)\n    }\n    if (translate.length) {\n      changes.translate = translate\n      Promise.all(translate.map(tr => this.translator.translate(tr.symbols, tr.tx, tr.ty, false)))\n    }\n    this.history.push(this.model, changes)\n  }\n\n  protected createStrokesFromGestureSubStroke(strokeOrigin: IIStroke, subStrokes: { x: number[], y: number[] }[]): IIStroke[]\n  {\n    const strokes: IIStroke[] = []\n    if (subStrokes[0]) {\n      const subStroke = new IIStroke(strokeOrigin.style)\n      subStrokes![0].x.forEach((x, i) =>\n      {\n        subStroke.pointers.push({\n          x,\n          y: subStrokes![0].y[i],\n          p: strokeOrigin.pointers.at(i)?.p || 1,\n          t: strokeOrigin.pointers.at(i)?.t || Math.max(...subStroke.pointers.map(p => p.t + 20))\n        })\n      })\n      strokes.push(subStroke)\n    }\n    if (subStrokes[1]) {\n      const subStroke = new IIStroke(strokeOrigin.style)\n      subStrokes[1].x.forEach((x, i) =>\n      {\n        subStroke.pointers.push({\n          x,\n          y: subStrokes![1].y[i],\n          p: strokeOrigin.pointers.at(subStroke.pointers.length + i)?.p || 1,\n          t: strokeOrigin.pointers.at(subStroke.pointers.length + i)?.t || Math.max(...subStroke.pointers.map(p => p.t + 20))\n        })\n      })\n      strokes.push(subStroke)\n    }\n    return strokes\n  }\n\n  protected computeSplitStroke(strokeOrigin: IIStroke, subStrokes: { x: number[], y: number[] }[]): { before?: IIStroke, after?: IIStroke }\n  {\n    let after: IIStroke | undefined\n    const newStrokes = this.createStrokesFromGestureSubStroke(strokeOrigin, subStrokes)\n\n    if (newStrokes[1]) {\n      after = newStrokes[1]\n      this.translator.applyToSymbol(after, this.strokeSpaceWidth, 0)\n    }\n    return {\n      before: newStrokes[0],\n      after\n    }\n  }\n\n  protected computeSplitStrokeInGroup(gestureStroke: IIStroke, group: IISymbolGroup, subStrokes: { fullStrokeId: string, x: number[], y: number[] }[]): IISymbolGroup[]\n  {\n    const newGroups: IISymbolGroup[] = []\n    const symbolsBefore: TIISymbol[] = []\n    const symbolsAfter: TIISymbol[] = []\n\n    const strokeIdToSplit = subStrokes[0].fullStrokeId\n\n    group.children.forEach(gs =>\n    {\n      if (gs.id === strokeIdToSplit) {\n        const subStroke = this.computeSplitStroke(gs as IIStroke, subStrokes)\n        if (subStroke.before) {\n          symbolsBefore.push(subStroke.before)\n        }\n        if (subStroke.after) {\n          symbolsAfter.push(subStroke.after)\n        }\n      }\n      else if (gs.bounds.xMid < gestureStroke.bounds.xMid) {\n        symbolsBefore.push(gs)\n      }\n      else if (gs.bounds.xMid > gestureStroke.bounds.xMid) {\n        this.translator.applyToSymbol(gs, this.strokeSpaceWidth, 0)\n        symbolsAfter.push(gs)\n      }\n    })\n\n    if (symbolsBefore.length) {\n      newGroups.push(new IISymbolGroup(symbolsBefore, group.style))\n    }\n    if (symbolsAfter.length) {\n      newGroups.push(new IISymbolGroup(symbolsAfter, group.style))\n    }\n    return newGroups\n  }\n\n  protected computeChangesOnSplitStroke(gestureStroke: IIStroke, strokeIdToSplit: string, subStrokes: { fullStrokeId: string, x: number[], y: number[] }[]): TIIHistoryChanges\n  {\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    const replaced: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    const symbolsAfterGestureInRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s) && gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const symbolToSplit = this.model.getRootSymbol(strokeIdToSplit)\n    if (symbolToSplit?.type === SymbolType.Group) {\n      const newGroups = this.computeSplitStrokeInGroup(gestureStroke, symbolToSplit, subStrokes)\n      replaced.newSymbols.push(...newGroups)\n      replaced.oldSymbols.push(symbolToSplit)\n    }\n    else if (symbolToSplit?.type === SymbolType.Stroke) {\n      const newStrokes = this.computeSplitStroke(symbolToSplit, subStrokes)\n      if (newStrokes.before) {\n        replaced.newSymbols.push(newStrokes.before)\n      }\n      if (newStrokes.after) {\n        replaced.newSymbols.push(newStrokes.after)\n      }\n      replaced.oldSymbols.push(symbolToSplit)\n    }\n    else if (symbolToSplit?.type === SymbolType.Recognized) {\n      const strokesToSplit = symbolToSplit.strokes.find(s => s.id === strokeIdToSplit)!\n      const strokesBefore = symbolToSplit.strokes.filter(s => s.id !== strokeIdToSplit && s.bounds.xMid < gestureStroke.bounds.xMid)\n      const strokesAfter = symbolToSplit.strokes.filter(s => s.id !== strokeIdToSplit && s.bounds.xMid > gestureStroke.bounds.xMid)\n      const newStrokes = this.computeSplitStroke(strokesToSplit, subStrokes)\n      if (newStrokes.before) {\n        replaced.newSymbols.push(...strokesBefore, newStrokes.before)\n      }\n      if (newStrokes.after) {\n        replaced.newSymbols.push(newStrokes.after, ...strokesAfter)\n      }\n      replaced.oldSymbols.push(symbolToSplit)\n    }\n    if (symbolsAfterGestureInRow.length) {\n      translate.push({ symbols: symbolsAfterGestureInRow, tx: this.strokeSpaceWidth, ty: 0 })\n    }\n\n    return {\n      translate,\n      replaced\n    }\n  }\n\n  protected computeChangesOnSplitGroup(gestureStroke: IIStroke, groupToSplit: IISymbolGroup): TIIHistoryChanges\n  {\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    const replaced: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    const symbolsAfterGestureInRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s) && gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const groupSymbolsBefore = groupToSplit.children.filter(s => s.bounds.xMid <= gestureStroke.bounds.xMid)\n    const groupsSymbolsAfter = groupToSplit.children.filter(s => s.bounds.xMid > gestureStroke.bounds.xMid)\n\n    replaced.oldSymbols.push(groupToSplit)\n    if (groupSymbolsBefore.length) {\n      const groupBefore = new IISymbolGroup(groupSymbolsBefore.map(s => s.clone()), groupToSplit.style)\n      groupBefore.decorators = groupToSplit.decorators.map(d => new IIDecorator(d.kind, d.style))\n      replaced.newSymbols.push(groupBefore)\n    }\n    if (groupsSymbolsAfter.length) {\n      const grouAfter = new IISymbolGroup(groupsSymbolsAfter.map(s => s.clone()), groupToSplit.style)\n      grouAfter.decorators = groupToSplit.decorators.map(d => new IIDecorator(d.kind, d.style))\n      this.translator.applyToSymbol(grouAfter, this.strokeSpaceWidth, 0)\n      replaced.newSymbols.push(grouAfter)\n    }\n    if (symbolsAfterGestureInRow?.length) {\n      translate.push({ symbols: symbolsAfterGestureInRow.filter(s => s.id !== groupToSplit.id), tx: this.strokeSpaceWidth, ty: 0 })\n    }\n\n    return {\n      translate,\n      replaced\n    }\n  }\n\n  protected computeChangesOnSplitStrokeText(gestureStroke: IIStroke, strokeTextToSplit: IIRecognizedText): TIIHistoryChanges\n  {\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    const replaced: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    const symbolsAfterGestureInRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s) && gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const strokesBefore = strokeTextToSplit.strokes.filter(s => s.bounds.xMid <= gestureStroke.bounds.xMid)\n    const strokesAfter = strokeTextToSplit.strokes.filter(s => s.bounds.xMid > gestureStroke.bounds.xMid)\n\n    replaced.oldSymbols.push(strokeTextToSplit)\n    if (strokesBefore.length) {\n      const strokeTextBefore = new IIRecognizedText(strokesBefore.map(s => s.clone()), strokeTextToSplit, strokeTextToSplit.style)\n      strokeTextBefore.decorators = strokeTextToSplit.decorators.map(d => new IIDecorator(d.kind, d.style))\n      replaced.newSymbols.push(strokeTextBefore)\n    }\n    if (strokesAfter.length) {\n      const strokeTextAfter = new IIRecognizedText(strokesAfter.map(s => s.clone()), strokeTextToSplit, strokeTextToSplit.style)\n      strokeTextAfter.decorators = strokeTextToSplit.decorators.map(d => new IIDecorator(d.kind, d.style))\n      this.translator.applyToSymbol(strokeTextAfter, this.strokeSpaceWidth, 0)\n      replaced.newSymbols.push(strokeTextAfter)\n    }\n    if (symbolsAfterGestureInRow?.length) {\n      translate.push({ symbols: symbolsAfterGestureInRow.filter(s => s.id !== strokeTextToSplit.id), tx: this.strokeSpaceWidth, ty: 0 })\n    }\n\n    return {\n      translate,\n      replaced\n    }\n  }\n\n  protected computeChangesOnSplitText(gestureStroke: IIStroke, textToSplit: IIText): TIIHistoryChanges\n  {\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    const replaced: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    const symbolsAfterGestureInRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s) && gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const charsBefore = textToSplit.chars.filter(c => c.bounds.x + c.bounds.width / 2 <= gestureStroke.bounds.xMid)\n    const charsAfter = textToSplit.chars.filter(c => c.bounds.x + c.bounds.width / 2 > gestureStroke.bounds.xMid)\n    const newTexts: IIText[] = []\n    if (charsBefore.length && charsAfter.length) {\n      const textBefore = new IIText(charsBefore, textToSplit.point, Box.createFromBoxes(charsBefore.map(c => c.bounds)))\n      this.texter.setBounds(textBefore)\n      newTexts.push(textBefore)\n      const pointAfter: TPoint = {\n        x: textBefore.point.x + textBefore.bounds.width + this.texter.getSpaceWidth(computeAverage(textBefore.chars.map(c => c.fontSize))),\n        y: textBefore.point.y\n      }\n      const textAfter = new IIText(charsAfter, pointAfter, Box.createFromBoxes(charsAfter.map(c => c.bounds)))\n      this.texter.setBounds(textAfter)\n      newTexts.push(textAfter)\n      replaced.newSymbols = newTexts\n      replaced.oldSymbols = [textToSplit]\n    }\n    if (symbolsAfterGestureInRow?.length) {\n      translate.push({ symbols: symbolsAfterGestureInRow.filter(s => s.id !== gestureStroke.id), tx: this.strokeSpaceWidth, ty: 0 })\n    }\n\n    return {\n      translate,\n      replaced\n    }\n  }\n\n  async applyInsertGesture(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyInsertGesture\", { gestureStroke, gesture })\n\n    const symbolsRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s))\n    const textToSplit = symbolsRow.find(s => s.type === SymbolType.Text && isBetween(gestureStroke.bounds.xMid, s.bounds.xMin, s.bounds.xMax)) as IIText | undefined\n    const groupToSplit = symbolsRow.find(s => s.type === SymbolType.Group && isBetween(gestureStroke.bounds.xMid, s.bounds.xMin, s.bounds.xMax)) as IISymbolGroup | undefined\n    const strokeTextToSplit = symbolsRow.find(s => s.type === SymbolType.Recognized && isBetween(gestureStroke.bounds.xMid, s.bounds.xMin, s.bounds.xMax)) as IIRecognizedText | undefined\n\n    const symbolsBeforeGestureInRow = symbolsRow.filter(s => gestureStroke.bounds.xMid > s.bounds.xMax)\n    const symbolsAfterGestureInRow = symbolsRow.filter(s => gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const symbolsBelow = this.model.symbols.filter(s => this.model.isSymbolBelow(gestureStroke, s))\n\n\n    let changes: TIIHistoryChanges | undefined\n    if (gesture.strokeIds.length && gesture.subStrokes?.length) {\n      changes = this.computeChangesOnSplitStroke(gestureStroke, gesture.strokeIds[0], gesture.subStrokes)\n    }\n    else if (groupToSplit) {\n      changes = this.computeChangesOnSplitGroup(gestureStroke, groupToSplit)\n    }\n    else if (textToSplit) {\n      changes = this.computeChangesOnSplitText(gestureStroke, textToSplit)\n    }\n    else if (strokeTextToSplit) {\n      changes = this.computeChangesOnSplitStrokeText(gestureStroke, strokeTextToSplit)\n    }\n    else if (symbolsAfterGestureInRow.length) {\n      const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n      let translateX = 0\n      if (symbolsBeforeGestureInRow.length) {\n        translateX = Math.min(...symbolsBeforeGestureInRow.map(s => s.bounds.xMin)) - Math.min(...symbolsAfterGestureInRow.map(s => s.bounds.xMin))\n      }\n\n      switch (this.insertAction) {\n        case InsertAction.LineBreak:\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: translateX, ty: this.rowHeight })\n          if (symbolsBelow.length) {\n            translate.push({ symbols: symbolsBelow, tx: 0, ty: this.rowHeight })\n          }\n          break\n        case InsertAction.Insert:\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: this.strokeSpaceWidth * 2, ty: 0 })\n          break\n      }\n      changes = { translate }\n    }\n    else if (symbolsBeforeGestureInRow.length && symbolsBelow.length && this.insertAction === InsertAction.LineBreak) {\n      changes = { translate: [{ symbols: symbolsBelow, tx: 0, ty: this.rowHeight }] }\n    }\n\n    if (changes) {\n      this.history.push(this.model, changes)\n      const promises: Promise<void>[] = []\n      if (changes.translate?.length) {\n        promises.push(...changes.translate.map(tr => this.translator.translate(tr.symbols, tr.tx, tr.ty, false)))\n      }\n      if (changes.replaced?.newSymbols.length) {\n        promises.push(this.editor.replaceSymbols(changes.replaced.oldSymbols, changes.replaced.newSymbols, false))\n      }\n      await Promise.all(promises)\n    }\n  }\n\n  async applyUnderlineGesture(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyUnderlineGesture\", { gestureStroke, gesture })\n    if (!gesture.strokeIds.length) {\n      this.#logger.warn(\"applyUnderlineGesture\", \"Unable to apply underline because there are no strokes\")\n      return\n    }\n\n    const changes: TIIHistoryChanges = { decorator: [] }\n    const symbolIdSet = new Set<string>()\n    gesture.strokeIds.forEach(id =>\n    {\n      const sym = this.model.getRootSymbol(id)\n      if (sym && IIGestureManager.#DECORABLE_TYPES.has(sym.type) && !symbolIdSet.has(sym.id)) {\n        const symWithDec = sym as (IIText | IIStroke | IISymbolGroup | IIRecognizedText)\n        const underline = new IIDecorator(DecoratorKind.Underline, this.editor.penStyle)\n        const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Underline)\n        const added = index === -1\n        // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n        added ? symWithDec.decorators.push(underline) : symWithDec.decorators.splice(index, 1)\n        this.model.updateSymbol(symWithDec)\n        this.renderer.drawSymbol(symWithDec)\n        changes.decorator?.push({ symbol: symWithDec, decorator: underline, added })\n        symbolIdSet.add(symWithDec.id)\n      }\n    })\n    if (changes.decorator?.length) {\n      this.history.push(this.model, changes)\n    }\n  }\n\n  async applyStrikeThroughGesture(gestureStroke: IIStroke, gesture: TGesture): Promise<void | TIISymbol[]>\n  {\n    this.#logger.debug(\"applyStrikeThroughGesture\", { gestureStroke, gesture })\n    if (!gesture.strokeIds.length) {\n      this.#logger.warn(\"applyStrikeThroughGesture\", \"Unable to apply strikethrough because there are no strokes\")\n      return\n    }\n    switch (this.strikeThroughAction) {\n      case StrikeThroughAction.Draw: {\n        const changes: TIIHistoryChanges = { decorator: [] }\n        const symbolIds: string[] = []\n        gesture.strokeIds.forEach(id =>\n        {\n          const symbol = this.model.getRootSymbol(id)\n          if (symbol && [SymbolType.Group, SymbolType.Stroke, SymbolType.Text, SymbolType.Recognized].includes(symbol.type) && !symbolIds.includes(symbol.id)) {\n            const symWithDec = symbol as (IIText | IIStroke | IISymbolGroup | IIRecognizedText)\n            const strikethrough = new IIDecorator(DecoratorKind.Strikethrough, this.editor.penStyle)\n            const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Strikethrough)\n            const added = index === -1\n            // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n            added ? symWithDec.decorators.push(strikethrough) : symWithDec.decorators.splice(index, 1)\n            this.model.updateSymbol(symWithDec)\n            this.renderer.drawSymbol(symWithDec)\n            changes.decorator?.push({ symbol: symWithDec, decorator: strikethrough, added })\n            symbolIds.push(symWithDec.id)\n          }\n        })\n        if (changes.decorator?.length) {\n          this.history.push(this.model, changes)\n        }\n        break\n      }\n      case StrikeThroughAction.Erase: {\n        return this.editor.removeSymbols(gesture.strokeIds)\n      }\n      default:\n        this.#logger.warn(\"#applyStrikeThroughGesture\", `Unknow OnStrikeThrough: ${ this.strikeThroughAction }, values allowed are: ${ StrikeThroughAction.Draw }, ${ StrikeThroughAction.Erase }`)\n        break\n    }\n  }\n\n  async apply(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.info(\"apply\", { gestureStroke, gesture })\n    this.editor.updateSymbolsStyle([gestureStroke.id], { opacity: (gestureStroke.style.opacity || 1) / 2 }, false)\n    await this.editor.removeSymbol(gestureStroke.id, false)\n    await this.editor.synchronizeStrokesWithJIIX()\n    switch (gesture.gestureType) {\n      case \"UNDERLINE\":\n        await this.applyUnderlineGesture(gestureStroke, gesture)\n        break\n      case \"SCRATCH\":\n        await this.applyScratch(gestureStroke, gesture)\n        break\n      case \"JOIN\":\n        await this.applyJoinGesture(gestureStroke, gesture)\n        break\n      case \"INSERT\":\n        await this.applyInsertGesture(gestureStroke, gesture)\n        break\n      case \"STRIKETHROUGH\":\n        await this.applyStrikeThroughGesture(gestureStroke, gesture)\n        break\n      case \"SURROUND\":\n        await this.applySurroundGesture(gestureStroke, gesture)\n        break\n      default:\n        this.#logger.warn(\"apply\", `Gesture unknow: ${ gesture.gestureType }`)\n        break\n    }\n    this.editor.event.emitGestured({ gestureType: gesture.gestureType, stroke: gestureStroke })\n    this.editor.svgDebugger.apply()\n    return Promise.resolve()\n  }\n\n  async getGestureFromContextLess(gestureStroke: IIStroke): Promise<TGesture | undefined>\n  {\n    const gesture = await this.recognizer.recognizeGesture(gestureStroke)\n    if (!gesture) return\n    switch (gesture.gestureType) {\n      case \"surround\": {\n        const hasSymbolsToSurrond = this.model.symbols.some(s =>\n        {\n          if (s.id !== gestureStroke.id && gestureStroke.bounds.contains(s.bounds)) {\n            return this.surroundAction === SurroundAction.Select || IIGestureManager.#SURROUND_SELECT_TYPES.has(s.type)\n          }\n          return false\n        })\n        if (hasSymbolsToSurrond) {\n          return {\n            gestureType: \"SURROUND\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: [],\n          }\n        }\n        return\n      }\n      case \"left-right\":\n      case \"right-left\": {\n        const symbolsToUnderline = this.model.symbols.filter(s =>\n        {\n          return s.id !== gestureStroke.id && IIGestureManager.#TEXT_STROKE_GROUP_TYPES.has(s.type) &&\n            isBetween(s.bounds.xMid, gestureStroke.bounds.xMin, gestureStroke.bounds.xMax) &&\n            isBetween(gestureStroke.bounds.yMid, s.bounds.y + s.bounds.height * 3 / 4, s.bounds.y + s.bounds.height * 5 / 4)\n        })\n        if (symbolsToUnderline.length) {\n          return {\n            gestureType: \"UNDERLINE\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: symbolsToUnderline.map(s => s.id),\n          }\n        }\n        const symbolsToStrikeThrough = this.model.symbols.filter(s =>\n        {\n          return s.id !== gestureStroke.id && IIGestureManager.#TEXT_STROKE_GROUP_TYPES.has(s.type) &&\n            isBetween(s.bounds.xMid, gestureStroke.bounds.xMin, gestureStroke.bounds.xMax) &&\n            isBetween(gestureStroke.bounds.yMid, s.bounds.y + s.bounds.height / 4, s.bounds.y + s.bounds.height * 3 / 4)\n        })\n        if (symbolsToStrikeThrough.length) {\n          return {\n            gestureType: \"STRIKETHROUGH\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: symbolsToStrikeThrough.map(s => s.id),\n          }\n        }\n        return\n      }\n      case \"scratch\": {\n        const symbolsToErase = this.model.symbols.filter(s =>\n        {\n          return s.id !== gestureStroke.id &&\n            (\n              gestureStroke.bounds.overlaps(s.bounds) && IIGestureManager.#ERASE_OVERLAY_TYPES.has(s.type) ||\n              gestureStroke.bounds.contains(s.bounds) && IIGestureManager.#ERASE_CONTAIN_TYPES.has(s.type)\n            )\n        })\n\n        if (symbolsToErase.length) {\n          return {\n            gestureType: \"SCRATCH\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: symbolsToErase.map(s => s.id),\n          }\n        }\n        return\n      }\n      case \"bottom-top\": {\n        const hasSymbolsInRow = this.model.symbols.some(s =>\n          s.id !== gestureStroke.id &&\n          IIGestureManager.#TEXT_STROKE_GROUP_TYPES.has(s.type) &&\n          isBetween(s.bounds.yMid, gestureStroke.bounds.yMin, gestureStroke.bounds.yMax)\n        )\n        if (hasSymbolsInRow) {\n          return {\n            gestureType: \"JOIN\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: [],\n          }\n        }\n        return\n      }\n      case \"top-bottom\": {\n        const hasSymbolsInRow = this.model.symbols.some(s =>\n          s.id !== gestureStroke.id &&\n          IIGestureManager.#TEXT_STROKE_GROUP_TYPES.has(s.type) &&\n          isBetween(s.bounds.yMid, gestureStroke.bounds.yMin, gestureStroke.bounds.yMax)\n        )\n        if (hasSymbolsInRow) {\n          return {\n            gestureType: \"INSERT\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: [],\n          }\n        }\n        return\n      }\n      case \"none\":\n      default:\n        return\n    }\n  }\n}\n","/**\n * @group Menu\n */\nexport type TSubMenuParam =\n{\n  trigger: HTMLElement,\n  menuTitle?: string,\n  subMenu: HTMLElement,\n  position: \"top\" | \"left\" | \"right\" | \"right-top\" | \"bottom\" | \"bottom-left\" | \"bottom-right\"\n}\n\n/**\n * @group Menu\n */\nexport class IIMenuSub {\n  element: HTMLDivElement\n  content: HTMLElement\n\n  constructor(param : TSubMenuParam) {\n    this.element = document.createElement(\"div\")\n    this.element.classList.add(\"sub-menu\")\n    this.element.appendChild(param.trigger)\n    this.content = document.createElement(\"div\")\n    if(param.menuTitle) {\n      const menuTitleElement = document.createElement(\"h3\")\n      menuTitleElement.classList.add(\"ms-menu-title\")\n      menuTitleElement.textContent = param.menuTitle\n      this.content.appendChild(menuTitleElement)\n    }\n    this.content.classList.add(\"sub-menu-content\", param.position)\n    this.content.appendChild(param.subMenu)\n    this.element.appendChild(this.content)\n\n    param.trigger.addEventListener(\"pointerdown\", () => this.toggle())\n    document.addEventListener(\"pointerdown\", (e) => {\n      if (!this.element.contains(e.target as HTMLElement)) {\n        this.close()\n      }\n    })\n  }\n\n  open(): void {\n    this.content.classList.add(\"open\")\n  }\n\n  close(): void {\n    this.content.classList.remove(\"open\")\n  }\n\n  toggle(): void {\n    this.content.classList.toggle(\"open\")\n  }\n\n  unwrap(): void {\n    this.content.classList.remove(\"sub-menu-content\")\n    this.element.insertAdjacentElement(\"beforebegin\", this.content)\n    this.element.style.display = \"none\"\n  }\n\n  wrap(): void {\n    this.content.classList.add(\"sub-menu-content\")\n    this.element.appendChild(this.content)\n    this.element.style.display = \"block\"\n  }\n\n}\n","import menuIcon from \"../assets/svg/menu.svg\"\nimport languageIcon from \"../assets/svg/language.svg\"\nimport trashIcon from \"../assets/svg/trash.svg\"\nimport undoIcon from \"../assets/svg/undo.svg\"\nimport redoIcon from \"../assets/svg/redo.svg\"\nimport translateIcon from \"../assets/svg/translate.svg\"\nimport gestureIcon from \"../assets/svg/spock-hand-gesture.svg\"\nimport guideIcon from \"../assets/svg/orthogonal-view.svg\"\nimport snapIcon from \"../assets/svg/arrow-to-dot.svg\"\nimport debugIcon from \"../assets/svg/wolf.svg\"\nimport downloadIcon from \"../assets/svg/download.svg\"\nimport uploadIcon from \"../assets/svg/upload.svg\"\nimport { EditorTool, EditorWriteTool } from \"../Constants\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { IIMenu, TMenuItemBoolean, TMenuItemButton, TMenuItemButtonList, TMenuItemSelect } from \"./IIMenu\"\nimport { TIISymbol } from \"../symbol\"\nimport { InsertAction, StrikeThroughAction, SurroundAction } from \"../gesture\"\nimport { IIMenuSub, TSubMenuParam } from \"./IIMenuSub\"\nimport { createMenuButton } from \"./MenuHelper\"\nimport { getAvailableLanguageList, PartialDeep } from \"../utils\"\nimport { InteractiveInkEditor } from \"../editor\"\n\n/**\n * @group Menu\n */\nexport class IIMenuAction extends IIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MENU)\n\n  editor: InteractiveInkEditor\n  id: string\n  wrapper?: HTMLElement\n  menuLanguage!: IIMenuSub\n  menuClear?: HTMLButtonElement\n  menuUndo?: HTMLButtonElement\n  menuRedo?: HTMLButtonElement\n  menuConvert?: HTMLButtonElement\n\n  guideGaps = [\n    { label: \"S\", value: \"25\" },\n    { label: \"M\", value: \"50\" },\n    { label: \"L\", value: \"100\" },\n    { label: \"XL\", value: \"150\" },\n  ]\n\n  constructor(editor: InteractiveInkEditor, id = \"ms-menu-action\")\n  {\n    super()\n    this.id = id\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get isMobile(): boolean\n  {\n    return this.editor.renderer.parent.clientWidth < 700\n  }\n\n  protected createMenuClear(): HTMLElement\n  {\n    this.menuClear = createMenuButton(\n      `${ this.id }-clear`,\n      trashIcon,\n      () => {\n        this.#logger.info(`${ this.id }.clear`)\n        this.editor.clear()\n      }\n    )\n    return this.menuClear\n  }\n\n  protected createMenuLanguage(): HTMLElement\n  {\n    const triggerBtn = createMenuButton(\n      `${ this.id }-language-trigger`,\n      languageIcon,\n      () => {} // Click handled by IIMenuSub\n    )\n\n    const select = document.createElement(\"select\")\n    select.classList.add(\"select-language\")\n    select.id = `${ this.id }-language`\n    getAvailableLanguageList(this.editor.configuration)\n      .then(json =>\n      {\n        const languages = json.result as { [key: string]: string }\n        for (const key in languages) {\n          const selected = key === this.editor.configuration.recognition.lang\n          const opt = new Option(languages[key], key, selected, selected)\n          select.appendChild(opt)\n        }\n      })\n    select.addEventListener(\"change\", (e) =>\n    {\n      this.#logger.info(`${ this.id }.selectLanguage`)\n      const value = (e.target as HTMLInputElement).value\n      this.editor.changeLanguage(value)\n    })\n    const params: TSubMenuParam = {\n      trigger: triggerBtn,\n      subMenu: select,\n      position: \"bottom-right\"\n    }\n    this.menuLanguage = new IIMenuSub(params)\n    return this.menuLanguage.element\n  }\n\n  protected createMenuUndo(): HTMLElement\n  {\n    this.menuUndo = createMenuButton(\n      `${ this.id }-undo`,\n      undoIcon,\n      async () => {\n        this.#logger.info(`${ this.id }.undo`)\n        await this.editor.undo()\n      }\n    )\n    return this.menuUndo\n  }\n\n  protected createMenuRedo(): HTMLElement\n  {\n    this.menuRedo = createMenuButton(\n      `${ this.id }-redo`,\n      redoIcon,\n      async () => {\n        this.#logger.info(`${ this.id }.redo`)\n        await this.editor.redo()\n      }\n    )\n    return this.menuRedo\n  }\n\n  protected createMenuConvert(): HTMLElement\n  {\n    this.menuConvert = createMenuButton(\n      `${ this.id }-convert`,\n      translateIcon,\n      () => {\n        this.#logger.info(`${ this.id }.convert`)\n        this.editor.convert()\n      }\n    )\n    return this.menuConvert\n  }\n\n  protected createMenuGesture(): HTMLDivElement\n  {\n    const trigger = createMenuButton(\n      `${ this.id }-gesture`,\n      gestureIcon,\n      () => {} // Click handled by IIMenuSub\n    )\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const surroundActionValues: { label: string, value: string }[] = []\n    for (const key in SurroundAction) {\n      const value = SurroundAction[key as keyof typeof SurroundAction]\n      surroundActionValues.push({ label: key, value })\n    }\n    const strikeThroughActionValues: { label: string, value: string }[] = []\n    for (const key in StrikeThroughAction) {\n      const value = StrikeThroughAction[key as keyof typeof StrikeThroughAction]\n      strikeThroughActionValues.push({ label: key, value })\n    }\n    const splitActionValues: { label: string, value: string }[] = []\n    for (const key in InsertAction) {\n      const value = InsertAction[key as keyof typeof InsertAction]\n      splitActionValues.push({ label: key, value })\n    }\n    const menuItems: (TMenuItemBoolean | TMenuItemSelect)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-gesture-detect`,\n        label: \"Detect gesture\",\n        initValue: this.editor.writer.detectGesture,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-detect`, { value })\n          this.editor.writer.detectGesture = value\n          this.editor.tool = EditorTool.Write\n          this.editor.writer.tool = EditorWriteTool.Pencil\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-gesture-surround`,\n        label: \"On surround\",\n        values: surroundActionValues,\n        initValue: this.editor.gesture.surroundAction,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-surround`, { value })\n          this.editor.gesture.surroundAction = value as SurroundAction\n          this.editor.tool = EditorTool.Write\n          this.editor.writer.tool = EditorWriteTool.Pencil\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-gesture-strikethrough`,\n        label: \"On strikethrough\",\n        values: strikeThroughActionValues,\n        initValue: this.editor.gesture.strikeThroughAction,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-strikethrough`, { value })\n          this.editor.gesture.strikeThroughAction = value as StrikeThroughAction\n          this.editor.tool = EditorTool.Write\n          this.editor.writer.tool = EditorWriteTool.Pencil\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-gesture-insert`,\n        label: \"On insert\",\n        values: splitActionValues,\n        initValue: this.editor.gesture.insertAction,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-InsertAction`, { value })\n          this.editor.gesture.insertAction = value as InsertAction\n          this.editor.tool = EditorTool.Write\n          this.editor.writer.tool = EditorWriteTool.Pencil\n        }\n      },\n    ]\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Gesture\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected createMenuGuide(): HTMLDivElement\n  {\n    const trigger = createMenuButton(\n      `${ this.id }-guide`,\n      guideIcon,\n      () => {} // Click handled by IIMenuSub\n    )\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const menuItems: (TMenuItemBoolean | TMenuItemSelect | TMenuItemButtonList)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-guide-enable`,\n        label: \"Show guide\",\n        initValue: this.editor.configuration.rendering.guides.enable,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.guide-enable`, { value })\n          this.editor.configuration.rendering.guides.enable = value as boolean\n          this.editor.renderingConfiguration = this.editor.configuration.rendering\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-guide-type`,\n        label: \"Guide style\",\n        values: [\n          { label: \"Line\", value: \"line\" },\n          { label: \"Grid\", value: \"grid\" },\n          { label: \"Point\", value: \"point\" },\n        ],\n        initValue: this.editor.configuration.rendering.guides.type,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.guide-type`, { value })\n          this.editor.configuration.rendering.guides.type = value as (\"line\" | \"grid\" | \"point\")\n          this.editor.renderingConfiguration = this.editor.configuration.rendering\n        }\n      },\n      {\n        type: \"list\",\n        id: `${ this.id }-guide-size`,\n        label: \"Guide style\",\n        values: this.guideGaps,\n        initValue: this.editor.configuration.rendering.guides.gap.toString(),\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.guide-size`, { value })\n          this.editor.configuration.rendering.guides.gap = +value\n          this.editor.renderingConfiguration = this.editor.configuration.rendering\n        }\n      },\n    ]\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Guide\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected createMenuSnap(): HTMLDivElement\n  {\n    const trigger = createMenuButton(\n      `${ this.id }-snap`,\n      snapIcon,\n      () => {} // Click handled by IIMenuSub\n    )\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const menuItems: (TMenuItemBoolean | TMenuItemSelect)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-snap-to-guide`,\n        label: \"Snap to guide\",\n        initValue: this.editor.snaps.configuration.guide,\n        callback: (value) => this.editor.snaps.configuration.guide = value\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-snap-to-element`,\n        label: \"Snap to element\",\n        initValue: this.editor.snaps.configuration.symbol,\n        callback: (value) => this.editor.snaps.configuration.symbol = value\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-snap-angle`,\n        label: \"Snap angle\",\n        values: [\n          { label: \"None\", value: \"0\" },\n          { label: \"10\", value: \"10\" },\n          { label: \"30\", value: \"30\" },\n          { label: \"45\", value: \"45\" },\n          { label: \"90\", value: \"90\" },\n          { label: \"180\", value: \"180\" },\n        ],\n        initValue: this.editor.snaps.configuration.angle.toString(),\n        callback: (angle) => this.editor.snaps.configuration.angle = +angle\n      },\n    ]\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Snap\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected createMenuDebug(): HTMLDivElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-debug`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = debugIcon\n\n    const menuItems: TMenuItemBoolean[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-bounding-box`,\n        label: \"Show bounding box\",\n        initValue: this.editor.svgDebugger.boundingBoxVisibility,\n        callback: (debug) => this.editor.svgDebugger.boundingBoxVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-recognition-box`,\n        label: \"Show recognition box\",\n        initValue: this.editor.svgDebugger.recognitionBoxVisibility,\n        callback: (debug) => this.editor.svgDebugger.recognitionBoxVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-bounding-item-box`,\n        label: \"Show recognition item box\",\n        initValue: this.editor.svgDebugger.recognitionItemBoxVisibility,\n        callback: (debug) => this.editor.svgDebugger.recognitionItemBoxVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-snap-points`,\n        label: \"Show snap points\",\n        initValue: this.editor.svgDebugger.snapPointsVisibility,\n        callback: (debug) => this.editor.svgDebugger.snapPointsVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-vertices`,\n        label: \"Show vertices\",\n        initValue: this.editor.svgDebugger.verticesVisibility,\n        callback: (debug) => this.editor.svgDebugger.verticesVisibility = debug\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Debug\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected createMenuExport(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-export`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = downloadIcon\n\n    const menuItems: TMenuItemButton[] = [\n      {\n        type: \"button\",\n        id: `${ this.id }-export-json`,\n        label: \"json\",\n        callback: () =>\n        {\n          this.editor.downloadAsJson()\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-svg`,\n        label: \"svg\",\n        callback: () =>\n        {\n          this.editor.downloadAsSVG()\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-png`,\n        label: \"png\",\n        callback: () =>\n        {\n          this.editor.downloadAsPNG()\n        }\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Export\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected async readFileAsText(file: File): Promise<string>\n  {\n    return new Promise((resolve, reject) =>\n    {\n      const reader = new FileReader()\n      reader.onerror = reject;\n      reader.onload = () => {\n        resolve(reader.result as string)\n      }\n      if (file) {\n        reader.readAsText(file)\n      }\n    })\n  }\n\n  protected createMenuImport(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-import`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = uploadIcon\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const importInput = document.createElement(\"input\")\n    importInput.type = \"file\"\n    importInput.accept = \".json\"\n    importInput.multiple = false\n    importInput.addEventListener(\"change\", () => {\n      importBtn.disabled = !importInput.files?.length\n    })\n\n    subMenuWrapper.appendChild(importInput)\n    const importBtn = document.createElement(\"button\")\n    importBtn.classList.add(\"ms-menu-button\")\n    importBtn.innerText = \"Import\"\n    importBtn.disabled = true\n    subMenuWrapper.appendChild(importBtn)\n    importBtn.addEventListener(\"pointerup\", async (e) =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      if (importInput.files?.length) {\n        const fileString = await this.readFileAsText(importInput.files[0])\n        const symbols = JSON.parse(fileString) as PartialDeep<TIISymbol>[]\n        await this.editor.createSymbols(symbols)\n        importInput.value = \"\"\n        importBtn.disabled = true\n      }\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Import\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected unselectAll(): void\n  {\n    this.wrapper?.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n  }\n\n  protected closeAllSubMenu(): void\n  {\n    this.wrapper?.querySelectorAll(\".open\").forEach(e => e.classList.remove(\"open\"))\n  }\n\n  render(layer: HTMLElement): void\n  {\n    if (this.editor.configuration.menu.action.enable) {\n      const menuTrigger = document.createElement(\"button\")\n      menuTrigger.id = this.id\n      menuTrigger.classList.add(\"ms-menu-button\", \"square\")\n      menuTrigger.innerHTML = menuIcon\n\n      const subMenuWrapper = document.createElement(\"div\")\n      subMenuWrapper.classList.add(\"ms-menu-colmun\")\n      subMenuWrapper.appendChild(this.createMenuGesture())\n      subMenuWrapper.appendChild(this.createMenuGuide())\n      subMenuWrapper.appendChild(this.createMenuSnap())\n      subMenuWrapper.appendChild(this.createMenuDebug())\n      subMenuWrapper.appendChild(this.createMenuImport())\n      subMenuWrapper.appendChild(this.createMenuExport())\n\n      this.wrapper = document.createElement(\"div\")\n      this.wrapper.classList.add(\"ms-menu\", \"ms-menu-top-left\", \"ms-menu-row\")\n      this.wrapper.appendChild(new IIMenuSub({ trigger: menuTrigger, subMenu: subMenuWrapper, position: \"bottom\" }).element)\n      this.wrapper.appendChild(this.createMenuLanguage())\n      this.wrapper.appendChild(this.createMenuClear())\n      this.wrapper.appendChild(this.createMenuUndo())\n      this.wrapper.appendChild(this.createMenuRedo())\n      this.wrapper.appendChild(this.createMenuConvert())\n\n      layer.appendChild(this.wrapper)\n      this.update()\n      this.show()\n    }\n  }\n\n  update(): void\n  {\n    if (this.menuLanguage) {\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      this.isMobile ? this.menuLanguage.wrap() : this.menuLanguage.unwrap()\n    }\n    if (this.menuClear) {\n      this.menuClear.disabled = this.editor.history.context.empty\n    }\n    if (this.menuUndo) {\n      this.menuUndo.disabled = !this.editor.history.context.canUndo\n    }\n    if (this.menuRedo) {\n      this.menuRedo.disabled = !this.editor.history.context.canRedo\n    }\n    if (this.menuConvert) {\n      this.menuConvert.disabled = !this.editor.extractStrokesFromSymbols(this.model.symbols).length\n    }\n  }\n\n  show(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"visible\"\n    }\n  }\n\n  hide(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"hidden\"\n    }\n  }\n\n  destroy(): void\n  {\n    if (this.wrapper) {\n      while (this.wrapper.lastChild) {\n        this.wrapper.removeChild(this.wrapper.lastChild)\n      }\n      this.wrapper.remove()\n      this.wrapper = undefined\n      this.menuClear = undefined\n      this.menuUndo = undefined\n      this.menuRedo = undefined\n      this.menuConvert = undefined\n    }\n  }\n}\n","import pencilIcon from \"../assets/svg/edit-pencil.svg\"\nimport cursorIcon from \"../assets/svg/frame-select.svg\"\nimport eraseIcon from \"../assets/svg/erase.svg\"\nimport handIcon from \"../assets/svg/drag-hand-gesture.svg\"\nimport rectangleIcon from \"../assets/svg/rectangle.svg\"\nimport rhombusIcon from \"../assets/svg/rhombus.svg\"\nimport circleIcon from \"../assets/svg/circle.svg\"\nimport ellipseIcon from \"../assets/svg/ellipse.svg\"\nimport triangleIcon from \"../assets/svg/triangle.svg\"\nimport lineIcon from \"../assets/svg/linear.svg\"\nimport arrowIcon from \"../assets/svg/linear-arrow.svg\"\nimport doubleArrowIcon from \"../assets/svg/linear-double-arrow.svg\"\nimport { EditorTool, EditorWriteTool } from \"../Constants\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIMenu } from \"./IIMenu\"\nimport { IIMenuSub } from \"./IIMenuSub\"\nimport { TSubMenuParam } from \"./IIMenuSub\"\nimport { createMenuButton } from \"./MenuHelper\"\nimport { InteractiveInkEditor } from \"../editor\"\n\n/**\n * @group Menu\n */\nexport class IIMenuTool extends IIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MENU)\n\n  editor: InteractiveInkEditor\n  id: string\n  wrapper?: HTMLDivElement\n  writeBtn?: HTMLButtonElement\n  menuSelect?: HTMLButtonElement\n  menuMove?: HTMLButtonElement\n  menuErase?: HTMLButtonElement\n  menuShape?: HTMLButtonElement\n  subMenuShape?: {\n    rectangle: HTMLButtonElement,\n    circle: HTMLButtonElement,\n    triangle: HTMLButtonElement,\n    ellipse: HTMLButtonElement\n    rhombus: HTMLButtonElement\n  }\n  menuEdge?: HTMLButtonElement\n  subMenuEdge?: {\n    line: HTMLButtonElement,\n    arrow: HTMLButtonElement,\n    doubleArrow: HTMLButtonElement,\n  }\n\n  constructor(editor: InteractiveInkEditor, id = \"ms-menu-tool\")\n  {\n    super()\n    this.id = id\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  protected createMenuWrite(): HTMLElement\n  {\n    this.writeBtn = createMenuButton(\n      `${this.id}-write-pencil`,\n      pencilIcon,\n      () => {\n        this.unselectAll()\n        this.writeBtn!.classList.add(\"active\")\n        this.editor.tool = EditorTool.Write\n        this.editor.writer.tool = EditorWriteTool.Pencil\n      }\n    )\n    return this.writeBtn\n  }\n\n  protected createMenuMove(): HTMLElement\n  {\n    this.menuMove = createMenuButton(\n      `${this.id}-move`,\n      handIcon,\n      () => {\n        this.unselectAll()\n        this.menuMove!.classList.add(\"active\")\n        this.editor.tool = EditorTool.Move\n      }\n    )\n    return this.menuMove\n  }\n\n  protected createMenuSelect(): HTMLElement\n  {\n    this.menuSelect = createMenuButton(\n      `${this.id}-select`,\n      cursorIcon,\n      () => {\n        this.unselectAll()\n        this.menuSelect!.classList.add(\"active\")\n        this.editor.tool = EditorTool.Select\n      }\n    )\n    return this.menuSelect\n  }\n\n  protected createMenuErase(): HTMLElement\n  {\n    this.menuErase = createMenuButton(\n      `${this.id}-erase`,\n      eraseIcon,\n      () => {\n        this.unselectAll()\n        this.menuErase!.classList.add(\"active\")\n        this.editor.tool = EditorTool.Erase\n      }\n    )\n    return this.menuErase\n  }\n\n  protected createShapeSubMenu(icon: string, tool: EditorWriteTool): HTMLButtonElement\n  {\n    const subMenuShape = createMenuButton(\n      `${this.id}-write-shape-${tool}`,\n      icon,\n      () => {\n        this.unselectAll()\n        this.editor.tool = EditorTool.Write\n        this.editor.writer.tool = tool\n        subMenuShape.classList.add(\"active\")\n        this.menuShape!.innerHTML = icon\n        this.menuShape!.classList.add(\"active\")\n        const subMenuContent = this.menuShape!.nextSibling\n        if (subMenuContent) {\n          (subMenuContent as HTMLElement).classList.remove(\"open\")\n        }\n      }\n    )\n    return subMenuShape\n  }\n\n  protected createMenuShape(): HTMLElement\n  {\n    this.menuShape = createMenuButton(\n      `${this.id}-write-shape`,\n      rectangleIcon,\n      () => {} // Click handled by IIMenuSub\n    )\n    this.subMenuShape = {\n      circle: this.createShapeSubMenu(circleIcon, EditorWriteTool.Circle),\n      rectangle: this.createShapeSubMenu(rectangleIcon, EditorWriteTool.Rectangle),\n      triangle: this.createShapeSubMenu(triangleIcon, EditorWriteTool.Triangle),\n      ellipse: this.createShapeSubMenu(ellipseIcon, EditorWriteTool.Ellipse),\n      rhombus: this.createShapeSubMenu(rhombusIcon, EditorWriteTool.Rhombus),\n    }\n    const subMenuContent = document.createElement(\"div\")\n    subMenuContent.id = `${this.id}-write-shape-list`\n    subMenuContent.classList.add(\"ms-menu-row\", \"sub-menu-content-shape\")\n    subMenuContent.appendChild(this.subMenuShape.rectangle)\n    subMenuContent.appendChild(this.subMenuShape.circle)\n    subMenuContent.appendChild(this.subMenuShape.ellipse)\n    subMenuContent.appendChild(this.subMenuShape.triangle)\n    subMenuContent.appendChild(this.subMenuShape.rhombus)\n\n    const params: TSubMenuParam = {\n      trigger: this.menuShape,\n      subMenu: subMenuContent,\n      position: \"top\"\n    }\n\n    return new IIMenuSub(params).element\n  }\n\n  protected createEdgeSubMenu(square: string, tool: EditorWriteTool): HTMLButtonElement\n  {\n    const subMenuEdge = createMenuButton(\n      `${this.id}-write-edge-${tool}`,\n      square,\n      () => {\n        this.unselectAll()\n        this.editor.tool = EditorTool.Write\n        this.editor.writer.tool = tool\n        subMenuEdge.classList.add(\"active\")\n        this.menuEdge!.innerHTML = square\n        this.menuEdge!.classList.add(\"active\")\n        const subMenuContent = this.menuEdge!.nextSibling\n        if (subMenuContent) {\n          (subMenuContent as HTMLElement).classList.remove(\"open\")\n        }\n      }\n    )\n    return subMenuEdge\n  }\n\n  protected createMenuEdge(): HTMLElement\n  {\n    this.menuEdge = createMenuButton(\n      `${this.id}-write-edge`,\n      lineIcon,\n      () => {} // Click handled by IIMenuSub\n    )\n    this.subMenuEdge = {\n      line: this.createEdgeSubMenu(lineIcon, EditorWriteTool.Line),\n      arrow: this.createEdgeSubMenu(arrowIcon, EditorWriteTool.Arrow),\n      doubleArrow: this.createEdgeSubMenu(doubleArrowIcon, EditorWriteTool.DoubleArrow),\n    }\n    const subMenuContent = document.createElement(\"div\")\n    subMenuContent.id = `${this.id}-write-edge-list`\n    subMenuContent.classList.add(\"ms-menu-row\", \"sub-menu-content-edge\")\n    subMenuContent.appendChild(this.subMenuEdge.line)\n    subMenuContent.appendChild(this.subMenuEdge.arrow)\n    subMenuContent.appendChild(this.subMenuEdge.doubleArrow)\n\n    const params: TSubMenuParam = {\n      trigger: this.menuEdge,\n      subMenu: subMenuContent,\n      position: \"top\"\n    }\n\n    return new IIMenuSub(params).element\n  }\n\n  protected unselectAll(): void\n  {\n    this.wrapper?.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n  }\n\n  update(): void\n  {\n    this.unselectAll()\n    switch (this.editor.tool) {\n      case EditorTool.Erase:\n        this.menuErase?.classList.add(\"active\")\n        break;\n      case EditorTool.Move:\n        this.menuMove?.classList.add(\"active\")\n        break;\n      case EditorTool.Select:\n        this.menuSelect?.classList.add(\"active\")\n        break;\n      case EditorTool.Write:\n        switch (this.editor.writer.tool) {\n          case EditorWriteTool.Circle:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.circle?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.Ellipse:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.ellipse?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.Triangle:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.triangle?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.Rectangle:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.rectangle?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.Line:\n            this.menuEdge?.classList.add(\"active\")\n            this.subMenuEdge?.line?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.Arrow:\n            this.menuEdge?.classList.add(\"active\")\n            this.subMenuEdge?.arrow?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.DoubleArrow:\n            this.menuEdge?.classList.add(\"active\")\n            this.subMenuEdge?.doubleArrow?.classList.add(\"active\")\n            break;\n          default:\n            this.writeBtn?.classList.add(\"active\")\n            break;\n        }\n        break;\n    }\n  }\n\n  render(layer: HTMLElement): void\n  {\n    if (this.editor.configuration.menu.tool.enable) {\n      this.wrapper = document.createElement(\"div\")\n      this.wrapper.classList.add(\"ms-menu\", \"ms-menu-bottom\", \"ms-menu-row\")\n\n      this.wrapper.appendChild(this.createMenuWrite())\n      this.wrapper.appendChild(this.createMenuMove())\n      this.wrapper.appendChild(this.createMenuSelect())\n      this.wrapper.appendChild(this.createMenuErase())\n      this.wrapper.appendChild(this.createMenuEdge())\n      this.wrapper.appendChild(this.createMenuShape())\n\n      layer.appendChild(this.wrapper)\n      this.update()\n      this.show()\n    }\n  }\n\n  show(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"visible\"\n    }\n  }\n\n  hide(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"hidden\"\n    }\n  }\n\n  destroy(): void\n  {\n    if (this.wrapper) {\n      while (this.wrapper.lastChild) {\n        this.wrapper.removeChild(this.wrapper.lastChild)\n      }\n      this.wrapper.remove()\n      this.writeBtn = undefined\n      this.menuSelect = undefined\n      this.menuMove = undefined\n      this.menuErase = undefined\n      this.menuShape = undefined\n      this.subMenuShape = undefined\n      this.menuEdge = undefined\n      this.subMenuEdge = undefined\n      this.wrapper = undefined\n    }\n  }\n}\n","import styleIcon from \"../assets/svg/palette.svg\"\nimport { EditorTool, EditorWriteTool } from \"../Constants\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { SymbolType, TIISymbol } from \"../symbol\"\nimport { IIMenu, TMenuItemColorList } from \"./IIMenu\"\nimport { IIMenuSub } from \"./IIMenuSub\"\nimport { TSubMenuParam } from \"./IIMenuSub\"\nimport { InteractiveInkEditor } from \"../editor\"\n\n/**\n * @group Menu\n */\nexport class IIMenuStyle extends IIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MENU)\n\n  editor: InteractiveInkEditor\n  id: string\n  wrapper?: HTMLDivElement\n  subMenu?: IIMenuSub\n  triggerBtn?: HTMLButtonElement\n  menuColorStroke?: HTMLDivElement\n  menuColorFill?: HTMLDivElement\n  menuThickness?: HTMLDivElement\n  menuFontSize?: HTMLDivElement\n  menuFontWeight?: HTMLDivElement\n  menuStrokeOpacity?: HTMLDivElement\n\n  constructor(editor: InteractiveInkEditor, id = \"ms-menu-style\")\n  {\n    super()\n    this.id = id\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get symbolsSelected(): TIISymbol[]\n  {\n    return this.model.symbolsSelected\n  }\n\n  get writeShape(): boolean\n  {\n    return ![EditorWriteTool.Arrow, EditorWriteTool.DoubleArrow, EditorWriteTool.Line, EditorWriteTool.Pencil].includes(this.editor.writer.tool)\n  }\n\n  get rowHeight(): number\n  {\n    return this.editor.configuration.rendering.guides.gap\n  }\n\n  get isMobile(): boolean\n  {\n    return this.editor.renderer.parent.clientWidth < 700\n  }\n\n  protected createMenuStroke(): HTMLDivElement\n  {\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqColor = symbolsStyles.length && symbolsStyles.every(st => st.color === symbolsStyles[0]?.color)\n    const color = hasUniqColor && symbolsStyles[0]?.color ? symbolsStyles[0]?.color : this.editor.penStyle.color as string\n    const menuColorStrokeDef: TMenuItemColorList = {\n      type: \"colors\",\n      label: \"Colors\",\n      id: `${ this.id }-color`,\n      fill: false,\n      values: this.colors,\n      initValue: color,\n      callback: (color) =>\n      {\n        this.editor.penStyle = { color }\n        this.editor.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { color })\n      },\n    }\n    const menuColor = this.createColorList(menuColorStrokeDef)\n    this.menuColorStroke = this.createWrapCollapsible(menuColor, \"Colors\")\n    this.menuColorStroke.id = `${ this.id }-color`\n    return this.menuColorStroke\n  }\n\n  protected createMenuColorFill(): HTMLDivElement\n  {\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqColor = symbolsStyles.length && symbolsStyles.every(st => st.color === symbolsStyles[0]?.color)\n    const color = hasUniqColor && symbolsStyles[0].color ? symbolsStyles[0].color : this.editor.penStyle.color as string\n    const menuColorStrokeDef: TMenuItemColorList = {\n      type: \"colors\",\n      label: \"Fill\",\n      id: `${ this.id }-fill`,\n      fill: true,\n      values: this.colors,\n      initValue: color,\n      callback: (fill) =>\n      {\n        this.editor.penStyle = { fill }\n        this.editor.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { fill })\n      },\n    }\n    const menuColor = this.createColorList(menuColorStrokeDef)\n    this.menuColorFill = this.createWrapCollapsible(menuColor, \"Fill\")\n    this.menuColorFill.id = `${ this.id }-fill`\n    return this.menuColorFill\n  }\n\n  protected createMenuThickness(): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-thickness-list`\n    wrapper.classList.add(\"ms-menu-row\", \"thickness-list\")\n\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqWidth = symbolsStyles.length && symbolsStyles.every(st => st.width === symbolsStyles[0].width)\n    const width = hasUniqWidth ? symbolsStyles[0].width : this.editor.penStyle.width\n\n    this.thicknessList.forEach((size) =>\n    {\n      const btn = document.createElement(\"button\")\n      btn.id = `${ this.id }-thickness-${ size.label }-btn`\n      btn.classList.add(\"ms-menu-button\", \"square\")\n      btn.textContent = size.label\n      if (width === size.value) {\n        btn.classList.add(\"active\")\n      }\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        this.editor.penStyle = { width: size.value }\n        wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n        if (this.symbolsSelected.length) {\n          this.editor.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { width: size.value })\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      })\n      wrapper.appendChild(btn)\n    })\n    this.menuThickness = this.createWrapCollapsible(wrapper, \"Thickness\")\n    this.menuThickness.id = `${ this.id }-thickness`\n    return this.menuThickness\n  }\n\n  protected createMenuFontSize(): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-font-size-list`\n    wrapper.classList.add(\"ms-menu-row\", \"font-size-list\")\n\n    this.fontSizeList.forEach((size) =>\n    {\n      const btn = document.createElement(\"button\")\n      btn.id = `${ this.id }-font-size-${ size.label }-btn`\n      btn.classList.add(\"ms-menu-button\", \"square\")\n      btn.textContent = size.label\n      if (this.editor.configuration.fontStyle.size === size.value) {\n        btn.classList.add(\"active\")\n      }\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n        if (size.value === \"auto\") {\n          this.editor.configuration.fontStyle.size = \"auto\"\n        }\n        else {\n          const fontSize = (size.value as number)\n          this.editor.configuration.fontStyle.size = fontSize\n          const textSymbols = this.symbolsSelected.filter(s => s.type === SymbolType.Text || (s.type === SymbolType.Group && s.extractText().length))\n          this.editor.updateTextFontStyle(textSymbols.map(s => s.id), { fontSize: fontSize * this.rowHeight })\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      })\n      wrapper.appendChild(btn)\n    })\n    this.menuFontSize = this.createWrapCollapsible(wrapper, \"Font size\")\n    this.menuFontSize.id = `${ this.id }-font-size`\n    return this.menuFontSize\n  }\n\n  protected createMenuFontWeight(): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-font-weight-list`\n    wrapper.classList.add(\"ms-menu-row\", \"font-weight-list\")\n\n    this.fontWeightList.forEach((weight) =>\n    {\n      const btn = document.createElement(\"button\")\n      btn.id = `${ this.id }-font-weight-${ weight.label }-btn`\n      btn.classList.add(\"ms-menu-button\", \"center\")\n      btn.textContent = weight.label\n      if (this.editor.configuration.fontStyle.weight === weight.value) {\n        btn.classList.add(\"active\")\n      }\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n        this.editor.configuration.fontStyle.weight = weight.value as \"auto\" | \"normal\" | \"bold\"\n        if (this.editor.configuration.fontStyle.weight !== \"auto\") {\n          const textSymbols = this.symbolsSelected.filter(s => s.type === SymbolType.Text || (s.type === SymbolType.Group && s.extractText().length))\n          this.editor.updateTextFontStyle(textSymbols.map(s => s.id), { fontWeight: this.editor.configuration.fontStyle.weight })\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      })\n      wrapper.appendChild(btn)\n    })\n    this.menuFontWeight = this.createWrapCollapsible(wrapper, \"Font weight\")\n    this.menuFontWeight.id = `${ this.id }-font-weight`\n    return this.menuFontWeight\n  }\n\n  protected createMenuOpacity(): HTMLDivElement\n  {\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqOpacity = symbolsStyles.length && symbolsStyles.every(st => st.opacity === symbolsStyles[0]?.opacity)\n    const currentOpacity = (hasUniqOpacity && symbolsStyles[0]?.opacity ? symbolsStyles[0]?.opacity : (this.editor.penStyle.opacity || 1)) * 100 as number\n\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-opacity-input-wrapper`\n    const input = document.createElement(\"input\")\n    input.id = `${ this.id }-opacity-input`\n    input.setAttribute(\"name\", `opacity`)\n    input.setAttribute(\"type\", \"range\")\n    input.setAttribute(\"step\", \"1\")\n    input.setAttribute(\"min\", \"1\")\n    input.setAttribute(\"max\", \"100\")\n    wrapper.appendChild(input)\n\n    const output = document.createElement(\"output\")\n    output.setAttribute(\"for\", `opacity`)\n    output.innerHTML = currentOpacity ? `${ currentOpacity }` : \"-\"\n    wrapper.appendChild(output)\n\n    if (currentOpacity) {\n      input.setAttribute(\"value\", currentOpacity.toString())\n    }\n    input.addEventListener(\"input\", (evt) =>\n    {\n      const value = (evt.target as HTMLInputElement).value as unknown as number\n      output.innerHTML = `${ value }%`\n      this.editor.penStyle = { opacity: value / 100 }\n      if (this.symbolsSelected.length) {\n        this.editor.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { opacity: value / 100 })\n      }\n    })\n    this.menuStrokeOpacity = this.createWrapCollapsible(wrapper, \"Opacity\")\n    this.menuStrokeOpacity.id = `${ this.id }-opacity`\n    return this.menuStrokeOpacity\n  }\n\n  render(layer: HTMLElement): void\n  {\n    if (this.editor.configuration.menu.style.enable) {\n      this.triggerBtn = document.createElement(\"button\")\n      this.triggerBtn.id = this.id\n      this.triggerBtn.classList.add(\"ms-menu-button\", \"square\")\n      this.triggerBtn.innerHTML = styleIcon\n\n      const subMenuContent = document.createElement(\"div\")\n      subMenuContent.classList.add(\"ms-menu-colmun\")\n      subMenuContent.appendChild(this.createMenuStroke())\n      subMenuContent.appendChild(this.createMenuColorFill())\n      subMenuContent.appendChild(this.createMenuThickness())\n      subMenuContent.appendChild(this.createMenuFontSize())\n      subMenuContent.appendChild(this.createMenuFontWeight())\n      subMenuContent.appendChild(this.createMenuOpacity())\n\n      const params: TSubMenuParam = {\n        trigger: this.triggerBtn,\n        subMenu: subMenuContent,\n        position: \"bottom-left\",\n      }\n      this.subMenu = new IIMenuSub(params)\n\n      this.wrapper = document.createElement(\"div\")\n      this.wrapper.classList.add(\"ms-menu\", \"ms-menu-top-right\")\n      this.wrapper.appendChild(this.subMenu.element)\n      layer.appendChild(this.wrapper)\n      this.update()\n    }\n  }\n\n  update(): void\n  {\n    if (this.subMenu) {\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      this.isMobile ? this.subMenu.wrap() : this.subMenu.unwrap()\n    }\n\n    if (this.editor.tool === EditorTool.Write) {\n      this.show()\n      if (this.menuColorStroke) {\n        this.menuColorStroke.style.display = \"block\"\n      }\n      if (this.menuColorFill) {\n        this.menuColorFill.style.display = this.writeShape ? \"block\" : \"none\"\n      }\n      if (this.menuThickness) {\n        this.menuThickness.style.display = \"block\"\n      }\n      if (this.menuFontSize) {\n        this.menuFontSize.style.display = \"block\"\n      }\n      if (this.menuFontWeight) {\n        this.menuFontWeight.style.display = \"block\"\n      }\n      if (this.menuStrokeOpacity) {\n        this.menuStrokeOpacity.style.display = \"block\"\n      }\n    }\n    else if (this.editor.tool === EditorTool.Select) {\n      this.show()\n      if (this.menuColorStroke) {\n        this.menuColorStroke.style.display = \"block\"\n      }\n      if (this.menuColorFill) {\n        const shapeSelected = this.model.symbolsSelected.length && this.model.symbolsSelected.some(s => s.type === SymbolType.Shape)\n        this.menuColorFill.style.display = shapeSelected ? \"block\" : \"none\"\n      }\n      if (this.menuThickness) {\n        this.menuThickness.style.display = \"block\"\n      }\n      if (this.menuFontSize) {\n        this.menuFontSize.style.display = \"block\"\n      }\n      if (this.menuFontWeight) {\n        this.menuFontWeight.style.display = \"block\"\n      }\n      if (this.menuStrokeOpacity) {\n        this.menuStrokeOpacity.style.display = \"block\"\n      }\n    }\n    else {\n      this.hide()\n    }\n  }\n\n  show(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"visible\"\n    }\n  }\n\n  hide(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"hidden\"\n    }\n  }\n\n  destroy(): void\n  {\n    if (this.wrapper) {\n      while (this.wrapper.lastChild) {\n        this.wrapper.removeChild(this.wrapper.lastChild)\n      }\n      this.wrapper.remove()\n      this.wrapper = undefined\n      this.subMenu = undefined\n      this.triggerBtn = undefined\n      this.menuColorStroke = undefined\n      this.menuColorFill = undefined\n      this.menuThickness = undefined\n      this.menuFontSize = undefined\n      this.menuFontWeight = undefined\n      this.menuStrokeOpacity = undefined\n    }\n  }\n}\n","import ArrowDown from \"../assets/svg/nav-arrow-down.svg\"\nimport { SELECTION_MARGIN } from \"../Constants\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { DecoratorKind, IIDecorator, IIRecognizedText, IIStroke, IISymbolGroup, IIText, RecognizedKind, SymbolType, TIISymbol } from \"../symbol\"\nimport { IIMenu, TMenuItemBoolean, TMenuItemButton, TMenuItemColorList } from \"./IIMenu\"\nimport { createUUID } from \"../utils\"\nimport { IIMenuSub, TSubMenuParam } from \"./IIMenuSub\"\nimport { InteractiveInkEditor } from \"../editor\"\nimport { createMenuButtonWithText } from \"./MenuHelper\"\n/**\n * @group Menu\n */\nexport class IIMenuContext extends IIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MENU)\n  static readonly #DECORABLE_TYPES = new Set([SymbolType.Group, SymbolType.Stroke, SymbolType.Text, SymbolType.Recognized])\n  editor: InteractiveInkEditor\n  id: string\n  wrapper?: HTMLElement\n  editMenu?: HTMLDivElement\n  editInput?: HTMLInputElement\n  editSaveBtn?: HTMLButtonElement\n  reorderMenu?: HTMLDivElement\n  decoratorMenu?: HTMLDivElement\n  menuExport?: HTMLDivElement\n  duplicateBtn?: HTMLButtonElement\n  groupBtn?: HTMLButtonElement\n  convertBtn?: HTMLButtonElement\n  removeBtn?: HTMLButtonElement\n\n  position: {\n    x: number,\n    y: number,\n    scrollTop: number,\n    scrollLeft: number\n  }\n\n  constructor(editor: InteractiveInkEditor, id = \"ms-menu-context\")\n  {\n    super()\n    this.id = id\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.position = { x: 0, y: 0, scrollLeft: 0, scrollTop: 0 }\n  }\n\n  get symbolsSelected(): TIISymbol[]\n  {\n    return this.editor.model.symbolsSelected\n  }\n\n  get haveSymbolsSelected(): boolean\n  {\n    return this.symbolsSelected.length > 0\n  }\n\n  get symbolsDecorable(): (IIStroke | IIText | IISymbolGroup | IIRecognizedText)[]\n  {\n    return this.symbolsSelected.filter(s => IIMenuContext.#DECORABLE_TYPES.has(s.type) || (s.type === SymbolType.Recognized && s.kind === RecognizedKind.Text)) as (IIStroke | IIText | IISymbolGroup | IIRecognizedText)[]\n  }\n\n  get showDecorator(): boolean\n  {\n    return this.symbolsDecorable.length > 0\n  }\n\n  protected createMenuEdit(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-edit-trigger`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Edit\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    this.editInput = document.createElement(\"input\")\n    subMenuWrapper.appendChild(this.editInput)\n    this.editSaveBtn = document.createElement(\"button\")\n    this.editSaveBtn.classList.add(\"ms-menu-button\")\n    this.editSaveBtn.innerText = \"Save\"\n    subMenuWrapper.appendChild(this.editSaveBtn)\n    this.editSaveBtn.addEventListener(\"pointerdown\", async (e) =>\n    {\n      e.stopPropagation()\n      const textSymbol = this.editor.model.symbolsSelected.find(s => s.type === SymbolType.Text) as IIText\n      if (textSymbol) {\n        const firstChar = textSymbol.chars[0]\n        textSymbol.chars = []\n        for (let i = 0; i < this.editInput!.value.length; i++) {\n          textSymbol.chars.push({\n            label: this.editInput!.value.charAt(i),\n            id: createUUID(),\n            color: firstChar.color,\n            fontSize: firstChar.fontSize,\n            fontWeight: firstChar.fontWeight,\n            bounds: firstChar.bounds\n          })\n        }\n        await this.editor.updateSymbol(textSymbol)\n        this.editor.selector.resetSelectedGroup([textSymbol])\n      }\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.editMenu = new IIMenuSub(params).element\n\n    return this.editMenu\n  }\n\n  protected createMenuDuplicate(): HTMLElement\n  {\n    this.duplicateBtn = createMenuButtonWithText(\n      `${ this.id }-duplicate`,\n      \"Duplicate\",\n      async () => {\n        const symbolsToDuplicate = this.symbolsSelected\n\n        const updateDeepIdInGroup = (gr: IISymbolGroup) =>\n      {\n        gr.children.forEach(s =>\n        {\n          s.id = s.id.slice(0, -36) + `-${ createUUID() }`\n          switch (s.type) {\n            case SymbolType.Group:\n              updateDeepIdInGroup(s)\n              break\n            case SymbolType.Recognized:\n              s.strokes.forEach(s => s.id = s.id.slice(0, -36) + `-${ createUUID() }`)\n              break\n          }\n        })\n      }\n      const duplicatedSymbols = symbolsToDuplicate.map(s =>\n      {\n        const clone = s.clone()\n        while (this.editor.model.symbols.find(s => s.id === clone.id)) {\n          clone.id = clone.id.slice(0, -36) + `-${ createUUID() }`\n          if (clone.type === SymbolType.Group) {\n            updateDeepIdInGroup(clone)\n          }\n          else if (clone.type === SymbolType.Recognized) {\n            clone.strokes.forEach(s => s.id = s.id.slice(0, -36) + `-${ createUUID() }`)\n          }\n        }\n        clone.selected = true\n        this.editor.translator.applyToSymbol(clone, SELECTION_MARGIN, SELECTION_MARGIN)\n        return clone\n      })\n\n      this.editor.unselectAll()\n      await this.editor.addSymbols(duplicatedSymbols)\n      this.editor.selector.drawSelectedGroup(duplicatedSymbols)\n    }\n    )\n    return this.duplicateBtn\n  }\n\n  protected createMenuGroup(): HTMLElement\n  {\n    this.groupBtn = createMenuButtonWithText(\n      `${ this.id }-duplicate`,\n      \"Group\",\n      async () => {\n        if (this.symbolsSelected.length === 1 && this.symbolsSelected[0].type === SymbolType.Group) {\n          const symbols = this.editor.ungroupSymbol(this.symbolsSelected[0] as IISymbolGroup)\n          this.editor.select(symbols.map(s => s.id))\n        }\n        else {\n          const symbols = this.symbolsSelected.slice()\n          this.editor.unselectAll()\n          const group = this.editor.groupSymbols(symbols)\n          group.selected = true\n          this.editor.select([group.id])\n        }\n      }\n    )\n    return this.groupBtn\n  }\n\n  protected createMenuConvert(): HTMLElement\n  {\n    this.convertBtn = createMenuButtonWithText(\n      `${ this.id }-convert`,\n      \"Convert\",\n      () => this.editor.convertSymbols(this.symbolsSelected)\n    )\n    return this.convertBtn\n  }\n\n  protected createMenuRemove(): HTMLButtonElement\n  {\n    this.removeBtn = createMenuButtonWithText(\n      `${ this.id }-remove`,\n      \"Remove\",\n      async () => {\n        this.editor.selector.removeSelectedGroup()\n        await this.editor.removeSymbols(this.symbolsSelected.map(s => s.id))\n      }\n    )\n    return this.removeBtn\n  }\n\n  protected createMenuReorder(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-reorder`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Reorder\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const menuItems: TMenuItemButton[] = [\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-first`,\n        label: \"Bring to front\",\n        callback: () =>\n        {\n          this.editor.changeOrderSymbols(this.symbolsSelected, \"last\")\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-forward`,\n        label: \"Bring forward\",\n        callback: () =>\n        {\n          this.editor.changeOrderSymbols(this.symbolsSelected, \"forward\")\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-backward`,\n        label: \"Send backward\",\n        callback: () =>\n        {\n          this.editor.changeOrderSymbols(this.symbolsSelected, \"backward\")\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-last`,\n        label: \"Send to back\",\n        callback: () =>\n        {\n          this.editor.changeOrderSymbols(this.symbolsSelected.slice().reverse(), \"first\")\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.reorderMenu = new IIMenuSub(params).element\n    return this.reorderMenu\n  }\n\n  protected createDecoratorSubMenu(label: string, kind: DecoratorKind): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-decorator-${ kind }`\n    trigger.classList.add(\"ms-menu-button\")\n    const labelEL = document.createElement(\"span\")\n    labelEL.innerText = label\n    trigger.appendChild(labelEL)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const menuItems: (TMenuItemBoolean | TMenuItemColorList)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-decorator-${ kind }-enable`,\n        label: \"Enable\",\n        initValue: false,\n        callback: (enable) =>\n        {\n          this.symbolsDecorable.forEach(s =>\n          {\n            if (enable) {\n              if (!s.decorators.some(d => d.kind === kind)) {\n                s.decorators.push(new IIDecorator(kind, this.editor.penStyle))\n              }\n            }\n            else {\n              const decoIndex = s.decorators.findIndex(d => d.kind === kind)\n              if (decoIndex > -1) {\n                s.decorators.splice(decoIndex, 1)\n              }\n            }\n            this.editor.model.updateSymbol(s)\n            this.editor.renderer.drawSymbol(s)\n          })\n\n          document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n          {\n            (b as HTMLButtonElement).disabled = !enable\n            b.classList.remove(\"active\")\n          })\n          if (enable) {\n            document.querySelector(`#${ this.id }-decorator-${ kind }-color button`)?.classList.add(\"active\")\n          }\n        }\n      },\n      {\n        type: \"colors\",\n        label: \"Colors\",\n        id: `${ this.id }-decorator-${ kind }-color`,\n        fill: false,\n        values: this.colors.filter((_c, i) => !(i % 4)),\n        initValue: this.colors[0],\n        disabled: true,\n        callback: (color) =>\n        {\n          this.symbolsDecorable.forEach(s =>\n          {\n            const deco = s.decorators.find(d => d.kind === kind)\n            if (deco) {\n              deco.style.color = color\n              this.editor.model.updateSymbol(s)\n              this.editor.renderer.drawSymbol(s)\n            }\n          })\n        },\n      }\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    return this.decoratorMenu = new IIMenuSub(params).element\n  }\n\n  protected createMenuDecorator(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-decorator`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Decorator\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Hightlight\", DecoratorKind.Highlight))\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Surround\", DecoratorKind.Surround))\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Underline\", DecoratorKind.Underline))\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Strikethrough\", DecoratorKind.Strikethrough))\n\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.decoratorMenu = new IIMenuSub(params).element\n    return this.decoratorMenu\n  }\n\n  protected createMenuExport(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-export`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Export\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const menuItems: TMenuItemButton[] = [\n      {\n        type: \"button\",\n        id: `${ this.id }-export-json`,\n        label: \"json\",\n        callback: () => this.editor.downloadAsJson(this.haveSymbolsSelected)\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-svg`,\n        label: \"svg\",\n        callback: () => this.editor.downloadAsSVG(this.haveSymbolsSelected)\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-png`,\n        label: \"png\",\n        callback: () => this.editor.downloadAsPNG(this.haveSymbolsSelected)\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.menuExport = new IIMenuSub(params).element\n    return this.menuExport\n  }\n\n  protected createMenuSelectAll(): HTMLElement\n  {\n    const btn = document.createElement(\"button\")\n    btn.id = `${ this.id }-duplicate`\n    btn.textContent = \"Select all\"\n    btn.classList.add(\"ms-menu-button\")\n    btn.addEventListener(\"pointerup\", async () => this.editor.selectAll())\n    return btn\n  }\n\n  protected updateDecoratorSubMenu(): void\n  {\n    if (this.showDecorator) {\n      this.decoratorMenu?.style.removeProperty(\"display\")\n\n      Object.values(DecoratorKind).forEach(kind =>\n      {\n        const checkbox = document.getElementById(`${ this.id }-decorator-${ kind }-enable`) as HTMLInputElement\n        if (checkbox) {\n          document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(e => e.classList.remove(\"active\"))\n          const decos = this.symbolsDecorable.flatMap(s => s.decorators).filter(d => d.kind === kind)\n\n          if (decos.length && decos.every(d => d.style.color === decos[0].style.color)) {\n            const btnToActivate = document.getElementById(`${ this.id }-decorator-${ kind }-color-${ decos[0].style.color?.replace(\"#\", \"\") }-btn`)\n            btnToActivate?.classList.add(\"active\")\n          }\n\n          if (this.symbolsDecorable.filter(s => s.decorators.some(d => d.kind === kind)).length === this.symbolsDecorable.length) {\n            checkbox.checked = true\n\n            document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n            {\n              (b as HTMLButtonElement).disabled = false\n            })\n            checkbox.indeterminate = false\n          }\n          else if (this.symbolsDecorable.filter(s => !s.decorators.some(d => d.kind === kind)).length === this.symbolsDecorable.length) {\n            checkbox.checked = false\n            document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n            {\n              (b as HTMLButtonElement).disabled = true\n            })\n            checkbox.indeterminate = false\n          }\n          else {\n            checkbox.setAttribute(\"indeterminate\", \"true\")\n            checkbox.indeterminate = true\n            document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n            {\n              (b as HTMLButtonElement).disabled = false\n            })\n          }\n        }\n\n      })\n    }\n    else {\n      this.decoratorMenu?.style.setProperty(\"display\", \"none\")\n    }\n  }\n\n  protected updateGroupMenu(): void\n  {\n    if (this.groupBtn && this.haveSymbolsSelected) {\n      this.groupBtn.style.removeProperty(\"display\")\n      if (this.symbolsSelected.length === 1 && this.symbolsSelected[0].type === SymbolType.Group) {\n        this.groupBtn.textContent = \"UnGroup\"\n      }\n      else {\n        this.groupBtn.textContent = \"Group\"\n      }\n    }\n    else {\n      this.groupBtn?.style.setProperty(\"display\", \"none\")\n    }\n  }\n\n  update(): void\n  {\n    this.wrapper?.style.setProperty(\"left\", `${ this.position.x - this.position.scrollLeft }px`)\n    this.wrapper?.style.setProperty(\"top\", `${ this.position.y - this.position.scrollTop }px`)\n\n    if (this.haveSymbolsSelected) {\n      const textSymbol = this.editor.model.symbolsSelected.find(s => s.type === SymbolType.Text)\n      if (this.editMenu && this.editInput && this.editor.model.symbolsSelected.length === 1 && textSymbol) {\n        this.editMenu.style.removeProperty(\"display\")\n        this.editInput.value = (textSymbol as IIText).label\n      }\n      else {\n        this.editMenu?.style.setProperty(\"display\", \"none\")\n      }\n\n      if (this.editor.extractStrokesFromSymbols(this.symbolsSelected).length) {\n        this.convertBtn?.style.removeProperty(\"display\")\n      }\n      else {\n        this.convertBtn?.style.setProperty(\"display\", \"none\")\n      }\n\n\n      this.reorderMenu?.style.removeProperty(\"display\")\n      this.duplicateBtn?.style.removeProperty(\"display\")\n      this.removeBtn?.style.removeProperty(\"display\")\n      this.menuExport?.style.removeProperty(\"display\")\n    }\n    else {\n      this.editMenu?.style.setProperty(\"display\", \"none\")\n      this.convertBtn?.style.setProperty(\"display\", \"none\")\n      this.reorderMenu?.style.setProperty(\"display\", \"none\")\n      this.duplicateBtn?.style.setProperty(\"display\", \"none\")\n      this.removeBtn?.style.setProperty(\"display\", \"none\")\n      this.menuExport?.style.setProperty(\"display\", \"none\")\n    }\n    this.updateDecoratorSubMenu()\n    this.updateGroupMenu()\n  }\n\n  render(layer: HTMLElement): void\n  {\n    this.wrapper = document.createElement(\"div\")\n    this.wrapper.id = `${ this.id }-wrapper`\n    this.wrapper.classList.add(\"ms-menu\", \"ms-menu-context\")\n    this.wrapper.appendChild(this.createMenuEdit())\n    this.wrapper.appendChild(this.createMenuDecorator())\n    this.wrapper.appendChild(this.createMenuReorder())\n    this.wrapper.appendChild(this.createMenuExport())\n    this.wrapper.appendChild(this.createMenuConvert())\n    this.wrapper.appendChild(this.createMenuGroup())\n    this.wrapper.appendChild(this.createMenuDuplicate())\n    this.wrapper.appendChild(this.createMenuRemove())\n    this.wrapper.appendChild(this.createMenuSelectAll())\n    this.wrapper.style.setProperty(\"display\", \"none\")\n    layer.appendChild(this.wrapper)\n\n    this.editor.layers.rendering.addEventListener(\"scroll\", () =>\n    {\n      this.position.scrollLeft = this.editor.layers.rendering.scrollLeft || 0\n      this.position.scrollTop = this.editor.layers.rendering.scrollTop || 0\n      this.update()\n    })\n  }\n\n  show(): void\n  {\n    this.update()\n    this.wrapper?.style.setProperty(\"display\", \"block\")\n  }\n\n  hide(): void\n  {\n    this.wrapper?.style.setProperty(\"display\", \"none\")\n  }\n\n  destroy(): void\n  {\n    while (this.wrapper?.lastChild) {\n      this.wrapper.removeChild(this.wrapper.lastChild)\n    }\n    this.wrapper?.remove()\n  }\n}\n","\n/**\n * @group Menu\n */\nexport type TMenuConfiguration = {\n  enable: boolean,\n  style: {\n    enable: boolean,\n  }\n  tool: {\n    enable: boolean,\n  }\n  action: {\n    enable: boolean,\n  }\n  context: {\n    enable: boolean,\n  }\n}\n\n/**\n * @group Menu\n * @source\n */\nexport const DefaultMenuConfiguration: TMenuConfiguration = {\n  enable: true,\n  style: {\n    enable: true\n  },\n  tool: {\n    enable: true\n  },\n  action: {\n    enable: true\n  },\n  context: {\n    enable: true\n  },\n}\n","import style from \"./menu.css\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { InteractiveInkEditor } from \"../editor\"\nimport { IIMenuAction } from \"./IIMenuAction\"\nimport { IIMenuTool } from \"./IIMenuTool\"\nimport { IIMenuContext } from \"./IIMenuContext\"\nimport { IIMenuStyle } from \"./IIMenuStyle\"\n\n/**\n * @group Manager\n */\nexport class IIMenuManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MENU)\n  editor: InteractiveInkEditor\n  layer?: HTMLElement\n  action: IIMenuAction\n  tool: IIMenuTool\n  context: IIMenuContext\n  style: IIMenuStyle\n\n  constructor(editor: InteractiveInkEditor, custom?: { style?: IIMenuStyle, tool?: IIMenuTool, action?: IIMenuAction, context?: IIMenuContext })\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n\n    if (custom?.style) {\n      const CustomMenuStyle = custom.style as unknown as typeof IIMenuStyle\n      this.style = new CustomMenuStyle(this.editor)\n    }\n    else {\n      this.style = new IIMenuStyle(this.editor)\n    }\n    if (custom?.tool) {\n      const CustomMenuTool = custom.tool as unknown as typeof IIMenuTool\n      this.tool = new CustomMenuTool(this.editor)\n    }\n    else {\n      this.tool = new IIMenuTool(this.editor)\n    }\n    if (custom?.action) {\n      const CustomMenuAction = custom.action as unknown as typeof IIMenuAction\n      this.action = new CustomMenuAction(this.editor)\n    }\n    else {\n      this.action = new IIMenuAction(this.editor)\n    }\n    if (custom?.context) {\n      const CustomMenuAction = custom.context as unknown as typeof IIMenuContext\n      this.context = new CustomMenuAction(this.editor)\n    }\n    else {\n      this.context = new IIMenuContext(this.editor)\n    }\n  }\n\n  render(layer: HTMLElement): void\n  {\n    if (this.editor.configuration.menu.enable) {\n      this.layer = layer\n\n      const styleElement = document.createElement(\"style\")\n      styleElement.appendChild(document.createTextNode(style as string))\n      this.layer.prepend(styleElement)\n\n      if (this.editor.configuration.menu.action.enable) {\n        this.action.render(this.layer)\n      }\n      if (this.editor.configuration.menu.style.enable) {\n        this.style.render(this.layer)\n      }\n      if (this.editor.configuration.menu.tool.enable) {\n        this.tool.render(this.layer)\n      }\n      if (this.editor.configuration.menu.context.enable) {\n        this.context.render(this.layer)\n      }\n    }\n  }\n\n  update(): void\n  {\n    this.action.update()\n    this.tool.update()\n    this.style.update()\n  }\n\n  show(): void\n  {\n    this.action.show()\n    this.tool.show()\n    this.style.show()\n  }\n\n  hide(): void\n  {\n    this.action.hide()\n    this.tool.hide()\n    this.style.hide()\n  }\n\n  destroy(): void\n  {\n    this.action.destroy()\n    this.tool.destroy()\n    this.style.destroy()\n  }\n}\n","import { PartialDeep } from \"../utils\"\n\n/**\n * @group Snap\n */\nexport type TSnapConfiguration = {\n  guide: boolean\n  symbol: boolean\n  angle: number\n}\n\n/**\n * @group Snap\n * @source\n */\nexport const DefaultSnapConfiguration: TSnapConfiguration = {\n  guide: true,\n  symbol: true,\n  angle: 0\n}\n\n/**\n * @group Snap\n */\nexport class SnapConfiguration implements TSnapConfiguration\n{\n  guide: boolean\n  symbol: boolean\n  angle: number\n\n  constructor(config? : PartialDeep<TSnapConfiguration>)\n  {\n    this.symbol = config?.symbol !== undefined ? config.symbol : DefaultSnapConfiguration.symbol\n    this.guide = config?.guide !== undefined ? config.guide : DefaultSnapConfiguration.guide\n    this.angle = config?.angle !== undefined ? config.angle : DefaultSnapConfiguration.angle\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { Box, TPoint, TSegment } from \"../symbol\"\nimport { SVGRenderer } from \"../renderer\"\nimport { SVGRendererConst } from \"../renderer/svg/SVGRendererConst\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { PartialDeep } from \"../utils\"\nimport { SnapConfiguration, TSnapConfiguration } from \"./IISnapConfiguration\"\n\n/**\n * @group Snap\n */\nexport type TSnapNudge = TPoint\n\n/**\n * @group Snap\n */\nexport type TSnapLineInfos = {\n  nudge: TSnapNudge,\n  verticales: TSegment[]\n  horizontales: TSegment[]\n}\n\n/**\n * @group Snap\n */\nexport class IISnapManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.CONVERTER)\n  editor: InteractiveInkEditor\n  configuration: SnapConfiguration\n\n  constructor(editor: InteractiveInkEditor, config?: PartialDeep<TSnapConfiguration>)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.configuration = new SnapConfiguration(config)\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get selectionSnapPoints(): TPoint[]\n  {\n    return Box.createFromPoints(this.model.symbolsSelected.flatMap(s => s.snapPoints)).snapPoints\n  }\n\n  get otherSnapPoints(): TPoint[]\n  {\n    const selectSymbolIds = this.model.symbolsSelected.map(s => s.id)\n    return this.model.symbols.filter(s => !selectSymbolIds.includes(s.id)).flatMap(s => s.snapPoints)\n  }\n\n  get snapThreshold(): number\n  {\n    return this.editor.configuration.rendering.guides.gap / 2\n  }\n\n  protected getNearestVerticalGuide(x: number): number\n  {\n    if (this.renderer.verticalGuides.length) {\n      return this.renderer.verticalGuides.reduce((prev, curr) =>\n      {\n        return (Math.abs(curr - x) < Math.abs(prev - x) ? curr : prev)\n      })\n    }\n    return x\n  }\n\n  protected getNearestHorizontalGuide(y: number): number\n  {\n    if (this.renderer.horizontalGuides.length) {\n      return this.renderer.horizontalGuides.reduce((prev, curr) =>\n      {\n        return (Math.abs(curr - y) < Math.abs(prev - y) ? curr : prev)\n      })\n    }\n    return y\n  }\n\n  protected getGuidePointToSnap(point: TPoint): TPoint\n  {\n    return {\n      x: this.getNearestVerticalGuide(point.x),\n      y: this.getNearestHorizontalGuide(point.y)\n    }\n  }\n\n  drawSnapToElementLines(lines: TSegment[]): void\n  {\n    const attrs = {\n      role: \"snap-to-element\",\n      fill: \"transparent\",\n      stroke: \"blue\",\n      \"stroke-width\": \"2\",\n      style: SVGRendererConst.noSelection,\n      \"marker-start\": `url(#${ SVGRendererConst.crossMarker })`,\n      \"marker-end\": `url(#${ SVGRendererConst.crossMarker })`\n    }\n    lines.forEach(seg =>\n    {\n      this.renderer.drawLine(seg.p1, seg.p2, attrs)\n    })\n  }\n\n  clearSnapToElementLines(): void\n  {\n    this.renderer.clearElements({ attrs: { role: \"snap-to-element\" } })\n  }\n\n  protected getSnapLinesInfos(sourcePoints: TPoint[], targetPoints: TPoint[]): TSnapLineInfos\n  {\n    const infos: TSnapLineInfos = {\n      nudge: {\n        x: Infinity,\n        y: Infinity\n      },\n      verticales: [],\n      horizontales: [],\n    }\n    if (!sourcePoints.length || !targetPoints.length) return infos\n\n    sourcePoints.forEach(p1 =>\n    {\n      targetPoints.forEach(p2 =>\n      {\n        if (this.snapThreshold > Math.abs(p2.x - p1.x)) {\n          if (Math.abs(infos.nudge.x) > Math.abs(p2.x - p1.x)) {\n            infos.nudge.x = p2.x - p1.x\n            infos.verticales = [{ p1: { ...p1 }, p2 }]\n          }\n          else if (infos.nudge.x === p2.x - p1.x) {\n            infos.verticales.push({ p1: { ...p1 }, p2 })\n          }\n        }\n        if (this.snapThreshold > Math.abs(p2.y - p1.y)) {\n          if (Math.abs(infos.nudge.y) > Math.abs(p2.y - p1.y)) {\n            infos.nudge.y = p2.y - p1.y\n            infos.horizontales = [{ p1: { ...p1 }, p2 }]\n          }\n          else if (infos.nudge.y === p2.y - p1.y) {\n            infos.horizontales.push({ p1: { ...p1 }, p2 })\n          }\n        }\n      })\n    })\n\n    return infos\n  }\n\n  snapResize(point: TPoint, horizontal = true, vertical = true): TPoint\n  {\n    this.clearSnapToElementLines()\n    if (!this.configuration.symbol && !this.configuration.guide) return point\n\n    let localPoint: TPoint = {\n      x: Infinity,\n      y: Infinity\n    }\n    if (this.configuration.guide) {\n      localPoint = this.getGuidePointToSnap(point)\n    }\n    const snapLines: TSegment[] = []\n\n    if (this.configuration.symbol) {\n      const snapLinesInfos = this.getSnapLinesInfos([point], this.otherSnapPoints)\n      if (horizontal && Math.abs(snapLinesInfos.nudge.x) <= Math.abs(point.x - localPoint.x)) {\n        localPoint.x = point.x + snapLinesInfos.nudge.x\n        snapLines.push(...snapLinesInfos.verticales)\n      }\n      if (vertical && Math.abs(snapLinesInfos.nudge.y) <= Math.abs(point.y - localPoint.y)) {\n        localPoint.y = point.y + snapLinesInfos.nudge.y\n        snapLines.push(...snapLinesInfos.horizontales)\n      }\n    }\n\n    if (localPoint.x === Infinity) localPoint.x = point.x\n    if (localPoint.y === Infinity) localPoint.y = point.y\n\n    snapLines.forEach(s => s.p1 = localPoint)\n    this.drawSnapToElementLines(snapLines)\n    return localPoint\n  }\n\n  snapTranslate(tx: number, ty: number): TSnapNudge\n  {\n    this.clearSnapToElementLines()\n    const nudge: TSnapNudge = { x: tx, y: ty }\n    if (!this.configuration.symbol && !this.configuration.guide) return nudge\n\n    const selectionSymbolPoints = this.selectionSnapPoints.map(p => ({ x: p.x + tx, y: p.y + ty }))\n\n    let lastDeltaX = Infinity\n    let lastDeltaY = Infinity\n\n    if (this.configuration.guide) {\n      selectionSymbolPoints.forEach(p =>\n      {\n        const gridPoint = this.getGuidePointToSnap(p)\n        if (lastDeltaX > Math.abs(gridPoint.x - p.x)) {\n          nudge.x = gridPoint.x - p.x + tx\n          lastDeltaX = Math.abs(gridPoint.x - p.x)\n        }\n        if (lastDeltaY > Math.abs(gridPoint.y - p.y)) {\n          nudge.y = gridPoint.y - p.y + ty\n          lastDeltaY = Math.abs(gridPoint.y - p.y)\n        }\n      })\n    }\n\n    const snapLines: TSegment[] = []\n    if (this.configuration.symbol) {\n      const snapLinesInfos = this.getSnapLinesInfos(selectionSymbolPoints, this.otherSnapPoints)\n      if (lastDeltaX >= Math.abs(snapLinesInfos.nudge.x) && snapLinesInfos.verticales.length) {\n        nudge.x = snapLinesInfos.nudge.x + tx\n        snapLines.push(...snapLinesInfos.verticales)\n      }\n      if (lastDeltaY >= Math.abs(snapLinesInfos.nudge.y) && snapLinesInfos.horizontales.length) {\n        nudge.y = snapLinesInfos.nudge.y + ty\n        snapLines.push(...snapLinesInfos.horizontales)\n      }\n    }\n    if (snapLines.length) {\n      snapLines.forEach(l =>\n      {\n        l.p1.x += nudge.x - tx\n        l.p1.y += nudge.y - ty\n      })\n      this.drawSnapToElementLines(snapLines)\n    }\n    return nudge\n  }\n\n  snapRotation(angleDegree: number): number\n  {\n    if (this.configuration.angle > 0) {\n      return this.configuration.angle * Math.round(angleDegree / this.configuration.angle)\n    }\n    return angleDegree\n  }\n}\n","import { mergeDeep, PartialDeep } from \"../utils\"\nimport { DefaultStyle, TStyle } from \"../style\"\nimport { DefaultLoggerConfiguration, TLoggerConfiguration } from \"../logger\"\nimport { DefaultGrabberConfiguration, TGrabberConfiguration } from \"../grabber\"\nimport { DefaultHistoryConfiguration, THistoryConfiguration } from \"../history\"\nimport { DefaultMenuConfiguration, TMenuConfiguration } from \"../menu\"\nimport { DefaultRecognizerWebSocketConfiguration, RecognizerWebSocketConfiguration, TRecognitionWebSocketConfiguration, TRecognizerWebSocketConfiguration, TServerWebsocketConfiguration } from \"../recognizer\"\nimport { DefaultIIRendererConfiguration, TIIRendererConfiguration } from \"../renderer\"\nimport { DefaultGestureConfiguration, TGestureConfiguration } from \"../gesture\"\nimport { TEditorConfiguration } from \"./AbstractEditor\"\nimport { DefaultSnapConfiguration, SnapConfiguration, TSnapConfiguration } from \"../snap\"\n\n/**\n * @group Editor\n */\nexport type TInteractiveInkEditorConfiguration = TEditorConfiguration & TRecognizerWebSocketConfiguration & {\n \"undo-redo\": THistoryConfiguration\n  rendering: TIIRendererConfiguration\n  grabber: TGrabberConfiguration\n  menu: TMenuConfiguration\n  penStyle: TStyle,\n  fontStyle: {\n    size: number | \"auto\"\n    weight: \"bold\" | \"normal\" | \"auto\"\n  }\n  gesture: TGestureConfiguration\n  snap: TSnapConfiguration\n}\n\n/**\n * @group Editor\n * @source\n */\nexport const DefaultInteractiveInkEditorConfiguration: TInteractiveInkEditorConfiguration = {\n  server: DefaultRecognizerWebSocketConfiguration.server,\n  recognition: DefaultRecognizerWebSocketConfiguration.recognition,\n  menu: DefaultMenuConfiguration,\n  rendering: DefaultIIRendererConfiguration,\n  logger: DefaultLoggerConfiguration,\n  grabber: DefaultGrabberConfiguration,\n  \"undo-redo\": DefaultHistoryConfiguration,\n\n  penStyle: DefaultStyle,\n  fontStyle: {\n    size: \"auto\",\n    weight: \"auto\",\n  },\n  gesture: DefaultGestureConfiguration,\n  snap: DefaultSnapConfiguration\n}\n\n/**\n * @group Editor\n */\nexport class InteractiveInkEditorConfiguration implements TInteractiveInkEditorConfiguration\n{\n  grabber: TGrabberConfiguration\n  logger: TLoggerConfiguration\n  server: TServerWebsocketConfiguration\n  recognition: TRecognitionWebSocketConfiguration\n  rendering: TIIRendererConfiguration\n  \"undo-redo\": THistoryConfiguration\n  menu: TMenuConfiguration\n\n  penStyle: TStyle\n  fontStyle: {\n    size: number | \"auto\"\n    weight: \"bold\" | \"normal\" | \"auto\"\n  }\n  gesture: TGestureConfiguration\n  snap: TSnapConfiguration\n\n  constructor(configuration?: PartialDeep<TInteractiveInkEditorConfiguration>)\n  {\n    const { server, recognition } =  new RecognizerWebSocketConfiguration(configuration)\n    this.recognition = recognition\n    this.server = server\n\n    this.grabber = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.grabber, configuration?.grabber)\n    this.logger = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.logger, configuration?.logger)\n    this.rendering = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.rendering, configuration?.rendering)\n    this[\"undo-redo\"] = mergeDeep({}, DefaultInteractiveInkEditorConfiguration[\"undo-redo\"], configuration?.[\"undo-redo\"])\n    this.menu = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.menu, configuration?.menu)\n    this.gesture = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.gesture, configuration?.gesture)\n    this.snap = new SnapConfiguration(configuration?.snap)\n\n    this.penStyle = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.penStyle, configuration?.penStyle)\n    this.fontStyle = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.fontStyle, configuration?.fontStyle)\n  }\n}\n","import { EditorTool, SELECTION_MARGIN } from \"../Constants\"\nimport { JIIXEdgeKind, JIIXELementType, JIIXNodeKind, IIModel, TExport, TJIIXStrokeItem } from \"../model\"\nimport\n{\n  Box,\n  EdgeKind,\n  IIDecorator,\n  TIIEdge,\n  IIEdgeArc,\n  IIEdgeLine,\n  IIEdgePolyLine,\n  TIIShape,\n  IIShapeCircle,\n  IIShapeEllipse,\n  IIShapePolygon,\n  IIStroke,\n  IIRecognizedText,\n  IISymbolGroup,\n  IIText,\n  ShapeKind,\n  SymbolType,\n  TIISymbol,\n  convertPartialStrokesToOIStrokes,\n  TIIRecognized,\n  IIRecognizedLine,\n  IIRecognizedPolyLine,\n  IIRecognizedArc,\n} from \"../symbol\"\nimport { RecognizerWebSocket } from \"../recognizer\"\nimport { SVGRenderer, SVGBuilder, TIIRendererConfiguration } from \"../renderer\"\nimport { TStyle } from \"../style\"\nimport\n{\n  IIConversionManager,\n  IIWriterManager,\n  IISelectionManager,\n  IIResizeManager,\n  IIRotationManager,\n  IITranslateManager,\n  IITextManager,\n  EraseManager,\n  IIDebugSVGManager,\n  IIMoveManager,\n} from \"../manager\"\nimport { RecognizedKind, IIRecognizedCircle, IIRecognizedEllipse, IIRecognizedPolygon } from \"../symbol\"\nimport { IIHistoryManager, TIIHistoryBackendChanges, TIIHistoryChanges, THistoryContext } from \"../history\"\nimport { PartialDeep, convertMillimeterToPixel, mergeDeep } from \"../utils\"\nimport { IIMenuAction, IIMenuManager, IIMenuStyle, IIMenuTool } from \"../menu\"\nimport { AbstractEditor, EditorOptionsBase } from \"./AbstractEditor\"\nimport { InteractiveInkEditorConfiguration, TInteractiveInkEditorConfiguration } from \"./InteractiveInkEditorConfiguration\"\nimport { IIGestureManager } from \"../gesture\"\nimport { IISnapManager } from \"../snap\"\n\n/**\n * @group Editor\n */\nexport type TInteractiveInkEditorOptions = PartialDeep<EditorOptionsBase &\n  {\n    configuration: TInteractiveInkEditorConfiguration\n  }> &\n  {\n    override?: {\n      recognizer?: RecognizerWebSocket\n      menu?: {\n        style?: IIMenuStyle\n        tool?: IIMenuTool\n        action?: IIMenuAction\n      }\n    }\n  }\n/**\n * @group Editor\n */\nexport class InteractiveInkEditor extends AbstractEditor\n{\n  #configuration: InteractiveInkEditorConfiguration\n  #model: IIModel\n  #tool: EditorTool = EditorTool.Write\n  #layerUITimer?: ReturnType<typeof setTimeout>\n  #recognizeStrokeTimer?: ReturnType<typeof setTimeout>\n\n  renderer: SVGRenderer\n  recognizer: RecognizerWebSocket\n\n  #penStyle: TStyle\n\n  history: IIHistoryManager\n  writer: IIWriterManager\n  eraser: EraseManager\n  gesture: IIGestureManager\n  resizer: IIResizeManager\n  rotator: IIRotationManager\n  translator: IITranslateManager\n  converter: IIConversionManager\n  texter: IITextManager\n  selector: IISelectionManager\n  svgDebugger: IIDebugSVGManager\n  snaps: IISnapManager\n  move: IIMoveManager\n  menu: IIMenuManager\n\n  constructor(rootElement: HTMLElement, options?: TInteractiveInkEditorOptions)\n  {\n    super(rootElement, options)\n\n    this.#configuration = new InteractiveInkEditorConfiguration(options?.configuration)\n    this.#penStyle = Object.assign({}, this.#configuration.penStyle)\n\n    if (options?.override?.recognizer) {\n      const CustomRecognizer = options?.override.recognizer as unknown as typeof RecognizerWebSocket\n      this.recognizer = new CustomRecognizer(this.#configuration)\n    }\n    else {\n      this.recognizer = new RecognizerWebSocket(this.#configuration)\n    }\n    this.recognizer.event.addErrorListener(this.manageError.bind(this))\n    this.recognizer.event.addExportedListener(this.event.emitExported.bind(this.event))\n    this.recognizer.event.addContentChangedListener(this.onContentChanged.bind(this))\n    this.recognizer.event.addSessionOpenedListener(this.event.emitSessionOpened.bind(this.event))\n    this.recognizer.event.addEndInitialization(this.layers.hideMessageModal.bind(this.layers))\n    this.recognizer.event.addIdleListener(this.updateLayerState.bind(this))\n\n    this.renderer = new SVGRenderer(this.#configuration.rendering)\n\n    this.history = new IIHistoryManager(this.#configuration[\"undo-redo\"], this.event)\n\n    this.writer = new IIWriterManager(this)\n    this.eraser = new EraseManager(this)\n    this.selector = new IISelectionManager(this)\n    this.move = new IIMoveManager(this)\n\n    this.gesture = new IIGestureManager(this, this.#configuration.gesture)\n    this.resizer = new IIResizeManager(this)\n    this.rotator = new IIRotationManager(this)\n    this.translator = new IITranslateManager(this)\n    this.converter = new IIConversionManager(this)\n    this.texter = new IITextManager(this)\n    this.svgDebugger = new IIDebugSVGManager(this)\n    this.snaps = new IISnapManager(this, this.#configuration.snap)\n    this.menu = new IIMenuManager(this, options?.override?.menu)\n\n    this.#model = new IIModel(this.#configuration.rendering.minWidth, this.#configuration.rendering.minHeight, this.configuration.rendering.guides.gap)\n  }\n\n  get initializationPromise(): Promise<void>\n  {\n    return this.recognizer.initialized.promise\n  }\n\n  get tool(): EditorTool\n  {\n    return this.#tool\n  }\n  set tool(i: EditorTool)\n  {\n    this.#tool = i\n    this.menu.tool.update()\n    this.setCursorStyle()\n    this.unselectAll()\n\n    this.eraser.detach()\n    this.selector.detach()\n    this.move.detach()\n    this.writer.detach()\n    switch (this.#tool) {\n      case EditorTool.Erase:\n        this.eraser.attach(this.layers.rendering)\n        break\n      case EditorTool.Select:\n        this.selector.attach(this.layers.rendering)\n        break\n      case EditorTool.Move:\n        this.move.attach(this.layers.rendering)\n        break\n      default:\n        this.writer.attach(this.layers.rendering)\n        break\n    }\n    this.event.emitToolChanged(i)\n  }\n\n  get model(): IIModel\n  {\n    return this.#model\n  }\n\n  get configuration(): InteractiveInkEditorConfiguration\n  {\n    return this.#configuration\n  }\n  set renderingConfiguration(renderingConfiguration: TIIRendererConfiguration)\n  {\n    this.configuration.rendering = mergeDeep(this.configuration.rendering, renderingConfiguration)\n    const height = Math.max(this.renderer.parent.clientHeight, this.configuration.rendering.minHeight)\n    const width = Math.max(this.renderer.parent.clientWidth, this.configuration.rendering.minWidth)\n    this.renderer.resize(height, width)\n    this.model.rowHeight = this.configuration.rendering.guides.gap\n    this.history.stack.forEach(i => i.model.rowHeight = this.model.rowHeight)\n    this.event.emitUIpdated()\n  }\n\n  get penStyle(): TStyle\n  {\n    return this.#penStyle\n  }\n  set penStyle(penStyle: PartialDeep<TStyle>)\n  {\n    this.logger.info(\"set penStyle\", { penStyle })\n    this.#penStyle = Object.assign({}, this.#penStyle, penStyle)\n  }\n\n  protected updateLayerState(idle: boolean): void\n  {\n    this.event.emitIdle(idle)\n    this.layers.updateState(idle)\n  }\n\n  updateLayerUI(timeout: number = 500): void\n  {\n    clearTimeout(this.#layerUITimer)\n    this.#layerUITimer = setTimeout(() =>\n    {\n      this.menu.update()\n      this.svgDebugger.apply()\n      this.waitForIdle()\n      this.event.emitUIpdated()\n    }, timeout)\n  }\n\n  manageError(error: Error): void\n  {\n    this.layers.showMessageError(error)\n    this.event.emitError(error)\n  }\n\n  protected setCursorStyle(): void\n  {\n    switch (this.#tool) {\n      case EditorTool.Erase:\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.add(\"erase\")\n        this.layers.root.classList.remove(\"select\")\n        this.layers.root.classList.remove(\"move\")\n        break\n      case EditorTool.Select:\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        this.layers.root.classList.add(\"select\")\n        this.layers.root.classList.remove(\"move\")\n        break\n      case EditorTool.Move:\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        this.layers.root.classList.remove(\"select\")\n        this.layers.root.classList.add(\"move\")\n        break\n      default:\n        this.layers.root.classList.add(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        this.layers.root.classList.remove(\"select\")\n        this.layers.root.classList.remove(\"move\")\n        break\n    }\n  }\n\n  protected async onContentChanged(undoRedoContext: THistoryContext): Promise<void>\n  {\n    clearTimeout(this.#recognizeStrokeTimer)\n    this.#recognizeStrokeTimer = setTimeout(async () =>\n    {\n      await this.synchronizeStrokesWithJIIX()\n      this.updateLayerUI(0)\n      this.event.emitChanged(undoRedoContext)\n    }, 500)\n  }\n\n  async initialize(): Promise<void>\n  {\n    try {\n      this.logger.info(\"initialize\")\n      this.layers.render()\n      this.layers.showLoader()\n      this.tool = EditorTool.Write\n      this.renderer.init(this.layers.rendering)\n      this.menu.render(this.layers.ui.root)\n\n      const compStyles = window.getComputedStyle(this.layers.root)\n      this.model.width = Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.#configuration.rendering.minWidth)\n      this.model.height = Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.#configuration.rendering.minHeight)\n      this.model.rowHeight = this.configuration.rendering.guides.gap\n      this.history.init(this.model)\n\n      if(!this.recognizer.configuration.server.version) {\n        await this.loadInfo(this.configuration.server)\n        this.recognizer.configuration.server.version = this.info!.version\n      }\n      await this.recognizer.init()\n    } catch (error) {\n      this.logger.error(\"initialize\", error)\n      this.layers.showMessageError(error as Error)\n      throw error\n    }\n    finally {\n      this.logger.debug(\"initialize\", \"finally\")\n      this.layers.hideLoader()\n      this.layers.updateState(true)\n    }\n  }\n\n  async changeLanguage(code: string): Promise<void>\n  {\n    try {\n      this.logger.info(\"changeLanguage\", { code })\n      this.updateLayerState(false)\n      this.configuration.recognition.lang = code\n      await this.recognizer.newSession(this.configuration)\n      this.recognizer.addStrokes(this.extractStrokesFromSymbols(this.model.symbols), false)\n      await this.synchronizeStrokesWithJIIX(true)\n      this.layers.hideLoader()\n      this.event.emitLoaded()\n    }\n    catch (error) {\n      this.logger.error(\"changeLanguage\", error)\n      this.manageError(error as Error)\n      throw error\n    }\n    finally {\n      this.updateLayerUI()\n    }\n  }\n\n  protected buildShape(partialShape: PartialDeep<TIIShape>): TIIShape\n  {\n    switch (partialShape.kind) {\n      case ShapeKind.Circle:\n        return IIShapeCircle.create(partialShape as PartialDeep<IIShapeCircle>)\n      case ShapeKind.Ellipse:\n        return IIShapeEllipse.create(partialShape as PartialDeep<IIShapeEllipse>)\n      case ShapeKind.Polygon:\n        return IIShapePolygon.create(partialShape as PartialDeep<IIShapePolygon>)\n      default:\n        throw new Error(`Unable to create shape, kind: \"${ partialShape.kind }\" is unknown`)\n    }\n  }\n\n  protected buildEdge(partialEdge: PartialDeep<TIIEdge>): TIIEdge\n  {\n    switch (partialEdge.kind) {\n      case EdgeKind.Arc:\n        return IIEdgeArc.create(partialEdge as PartialDeep<IIEdgeArc>)\n      case EdgeKind.Line:\n        return IIEdgeLine.create(partialEdge as PartialDeep<IIEdgeLine>)\n      case EdgeKind.PolyEdge:\n        return IIEdgePolyLine.create(partialEdge as PartialDeep<IIEdgePolyLine>)\n      default:\n        throw new Error(`Unable to create edge, kind: \"${ partialEdge.kind }\" is unknown`)\n    }\n  }\n\n  protected buildRecognized(partialSymbol: PartialDeep<TIIRecognized>): TIIRecognized\n  {\n    switch (partialSymbol.kind) {\n      case RecognizedKind.Text:\n        return IIRecognizedText.create(partialSymbol)\n      case RecognizedKind.Arc:\n        return IIRecognizedArc.create(partialSymbol)\n      case RecognizedKind.Circle:\n        return IIRecognizedCircle.create(partialSymbol)\n      case RecognizedKind.Ellipse:\n        return IIRecognizedEllipse.create(partialSymbol)\n      case RecognizedKind.Polygone:\n        return IIRecognizedPolygon.create(partialSymbol)\n      case RecognizedKind.Line:\n        return IIRecognizedLine.create(partialSymbol)\n      case RecognizedKind.PolyEdge:\n        return IIRecognizedPolyLine.create(partialSymbol)\n      default:\n        throw new Error(`Unable to create recognized, symbol type '${ JSON.stringify(partialSymbol) } is unknow`)\n    }\n  }\n\n  protected buildGroup(partialGroup: PartialDeep<IISymbolGroup>): IISymbolGroup\n  {\n    if (!partialGroup.children?.length) {\n      throw new Error(`Unable to create group, no children`)\n    }\n\n    const children = partialGroup.children.map(partialSymbol =>\n    {\n      switch (partialSymbol?.type) {\n        case SymbolType.Stroke:\n          return IIStroke.create(partialSymbol as PartialDeep<IIStroke>)\n        case SymbolType.Shape:\n          return this.buildShape(partialSymbol as PartialDeep<TIIShape>)\n        case SymbolType.Edge:\n          return this.buildEdge(partialSymbol as PartialDeep<TIIEdge>)\n        case SymbolType.Text:\n          return IIText.create(partialSymbol as PartialDeep<IIText>)\n        case SymbolType.Group:\n          return this.buildGroup(partialSymbol as PartialDeep<IISymbolGroup>)\n        case SymbolType.Recognized:\n          return this.buildRecognized(partialSymbol as PartialDeep<TIIRecognized>)\n        default:\n          throw new Error(`Unable to create group, symbol type '${ JSON.stringify(partialSymbol) } is unknow`)\n      }\n    })\n    const group = new IISymbolGroup(children, partialGroup.style)\n    if (partialGroup.id) {\n      group.id = partialGroup.id\n    }\n    if (partialGroup.decorators) {\n      group.decorators = partialGroup.decorators.map(d => new IIDecorator(d!.kind!, d!.style as TStyle))\n    }\n    return group\n  }\n\n  protected buildStroke(partialSymbol: PartialDeep<IIStroke>): IIStroke\n  {\n    return IIStroke.create(partialSymbol as PartialDeep<IIStroke>)\n  }\n\n  protected buildStrokeText(partialSymbol: PartialDeep<IIRecognizedText>): IIRecognizedText\n  {\n    return IIRecognizedText.create(partialSymbol as PartialDeep<IIRecognizedText>)\n  }\n\n  protected buildText(partialSymbol: PartialDeep<IIText>): IIText\n  {\n    return IIText.create(partialSymbol as PartialDeep<IIText>)\n  }\n\n  protected buildSymbol(partialSymbol: PartialDeep<TIISymbol>): TIISymbol\n  {\n    try {\n      switch (partialSymbol.type) {\n        case SymbolType.Stroke:\n          return this.buildStroke(partialSymbol)\n        case SymbolType.Shape:\n          return this.buildShape(partialSymbol)\n        case SymbolType.Edge:\n          return this.buildEdge(partialSymbol)\n        case SymbolType.Text:\n          return this.buildText(partialSymbol)\n        case SymbolType.Group:\n          return this.buildGroup(partialSymbol)\n        case SymbolType.Recognized:\n          return this.buildRecognized(partialSymbol as PartialDeep<TIIRecognized>)\n        default:\n          throw new Error(`Unable to build symbol, type: \"${ partialSymbol.type }\" is unknown`)\n      }\n    }\n    catch (error) {\n      this.logger.error(\"createSymbol\", error)\n      this.manageError(error as Error)\n      throw error\n    }\n  }\n\n  async createSymbol(partialSymbol: PartialDeep<TIISymbol>): Promise<TIISymbol>\n  {\n    try {\n      return await this.addSymbol(this.buildSymbol(partialSymbol))\n    }\n    catch (error) {\n      this.logger.error(\"createSymbol\", error)\n      this.manageError(error as Error)\n      throw error\n    }\n    finally {\n      this.updateLayerUI()\n    }\n  }\n\n  async createSymbols(partialSymbols: PartialDeep<TIISymbol>[]): Promise<TIISymbol[]>\n  {\n    try {\n      const errors: string[] = []\n      const symbols: TIISymbol[] = []\n      partialSymbols.forEach(partialSymbol =>\n      {\n        try {\n          symbols.push(this.buildSymbol(partialSymbol))\n        } catch (error) {\n          errors.push(((error as Error).message || error) as string)\n        }\n      })\n      if (errors.length) {\n        throw new Error(errors.join(\"\\n\"))\n      }\n      return await this.addSymbols(symbols)\n    } catch (error) {\n      this.logger.error(\"createSymbols\", error)\n      this.manageError(error as Error)\n      throw error\n    }\n  }\n\n  /** @hidden */\n  protected updateTextBounds(symbol: TIISymbol): void\n  {\n    if (symbol.type === SymbolType.Text) {\n      this.texter.updateBounds(symbol)\n    }\n    else if (symbol.type === SymbolType.Group) {\n      symbol.extractText().forEach(t => this.texter.updateBounds(t))\n    }\n  }\n\n  /** @hidden */\n  async addSymbol(sym: TIISymbol, addToHistory = true): Promise<TIISymbol>\n  {\n    this.logger.info(\"addSymbol\", { sym })\n    this.updateLayerState(false)\n    this.updateTextBounds(sym)\n    this.model.addSymbol(sym)\n    this.renderer.drawSymbol(sym)\n\n    const strokes = this.extractStrokesFromSymbols([sym])\n    this.recognizer.addStrokes(strokes, false)\n\n    if (addToHistory) {\n      this.history.push(this.model, { added: [sym] })\n    }\n    this.updateLayerUI()\n    return sym\n  }\n\n  /** @hidden */\n  async addSymbols(symList: TIISymbol[], addToHistory = true): Promise<TIISymbol[]>\n  {\n    this.logger.info(\"addSymbol\", { symList })\n    this.updateLayerState(false)\n    symList.forEach(s =>\n    {\n      this.updateTextBounds(s)\n      this.model.addSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n    const strokes = this.extractStrokesFromSymbols(symList)\n    this.recognizer.addStrokes(strokes, false)\n    if (addToHistory) {\n      this.history.push(this.model, { added: symList })\n    }\n    this.updateLayerUI()\n    return symList\n  }\n\n  async updateSymbol(sym: TIISymbol, addToHistory = true): Promise<TIISymbol>\n  {\n    this.logger.info(\"updateSymbol\", { sym })\n    this.updateLayerState(false)\n    this.updateTextBounds(sym)\n    this.model.updateSymbol(sym)\n    this.renderer.drawSymbol(sym)\n    const strokes = this.extractStrokesFromSymbols([sym])\n    this.recognizer.replaceStrokes(strokes.map(s => s.id), strokes)\n    if (addToHistory) {\n      this.history.push(this.model, { updated: [sym] })\n    }\n    this.updateLayerUI()\n    return sym\n  }\n\n  async updateSymbols(symList: TIISymbol[], addToHistory = true): Promise<TIISymbol[]>\n  {\n    this.logger.info(\"updateSymbol\", { symList })\n    this.updateLayerState(false)\n    symList.forEach(s =>\n    {\n      this.updateTextBounds(s)\n      this.model.updateSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n    const strokes = this.extractStrokesFromSymbols(symList)\n    this.recognizer.replaceStrokes(strokes.map(s => s.id), strokes)\n    if (addToHistory) {\n      this.history.push(this.model, { updated: symList })\n    }\n    this.updateLayerUI()\n    return symList\n  }\n\n  updateSymbolsStyle(symbolIds: string[], style: PartialDeep<TStyle>, addToHistory = true): void\n  {\n    this.logger.info(\"updateSymbolsStyle\", { symbolIds, style })\n    const symbols: TIISymbol[] = []\n    this.model.symbols.forEach(s =>\n    {\n      if (symbolIds.includes(s.id)) {\n        s.style = Object.assign({}, s.style, style)\n        if (\n          SymbolType.Text === s.type ||\n          SymbolType.Group === s.type ||\n          SymbolType.Recognized === s.type) {\n          s.updateChildrenStyle()\n        }\n        this.renderer.drawSymbol(s)\n        this.model.updateSymbol(s)\n        s.modificationDate = Date.now()\n        symbols.push(s)\n      }\n    })\n    if (symbols.length) {\n      symbols.forEach(s =>\n      {\n        if (s.type === SymbolType.Text) {\n          const lastWidth = s.bounds.width\n          this.texter.updateBounds(s)\n          const tx = s.bounds.width - lastWidth\n          if (tx !== 0) {\n            this.texter.moveTextAfter(s, tx)\n          }\n        }\n      })\n    }\n    if (addToHistory && symbols.length) {\n      this.history.push(this.model, { style: { symbols, style } })\n    }\n  }\n\n  updateTextFontStyle(textIds: string[], { fontSize, fontWeight }: { fontSize?: number, fontWeight?: \"normal\" | \"bold\" | \"auto\" }): void\n  {\n    this.logger.info(\"updateTextFontStyle\", { textIds, fontSize, fontWeight })\n    const symbols: (IIText | IISymbolGroup)[] = []\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    this.model.symbols.forEach(s =>\n    {\n      if (textIds.includes(s.id)) {\n        if (s.type === SymbolType.Text) {\n          s.updateChildrenFont({ fontSize, fontWeight: fontWeight === \"auto\" ? undefined : fontWeight })\n          const lastWidth = s.bounds.width\n          this.texter.updateBounds(s)\n          this.renderer.drawSymbol(s)\n          const tx = s.bounds.width - lastWidth\n          if (tx !== 0) {\n            const symbolsTranslated = this.texter.moveTextAfter(s, tx)\n            if (symbolsTranslated?.length) {\n              translate.push({\n                symbols: symbolsTranslated,\n                tx,\n                ty: 0\n              })\n            }\n          }\n          s.modificationDate = Date.now()\n          symbols.push(s)\n        }\n        else if (s.type === SymbolType.Group) {\n          const textChildren = s.extractText()\n          if (textChildren.length) {\n            textChildren.forEach(text =>\n            {\n              text.updateChildrenFont({ fontSize, fontWeight: fontWeight === \"auto\" ? undefined : fontWeight })\n              const lastWidth = s.bounds.width\n              this.texter.updateBounds(text)\n              const tx = s.bounds.width - lastWidth\n              const symbolsTranslated = this.texter.moveTextAfter(text, tx)\n              if (symbolsTranslated?.length) {\n                translate.push({\n                  symbols: symbolsTranslated,\n                  tx,\n                  ty: 0\n                })\n              }\n            })\n            s.modificationDate = Date.now()\n            this.renderer.drawSymbol(s)\n            symbols.push(s)\n          }\n\n        }\n      }\n    })\n    if (symbols.length) {\n      this.history.push(this.model, { style: { symbols, fontSize }, translate })\n    }\n  }\n\n  async replaceSymbols(oldSymbols: TIISymbol[], newSymbols: TIISymbol[], addToHistory = true): Promise<void>\n  {\n    this.logger.info(\"replaceSymbol\", { oldSymbols, newSymbols })\n    this.updateLayerState(false)\n\n    const oldStrokes = this.extractStrokesFromSymbols(oldSymbols)\n    const newStrokes = this.extractStrokesFromSymbols(newSymbols)\n\n    const symToReplace = oldSymbols.shift()\n\n    if (symToReplace) {\n      oldSymbols.forEach(s =>\n      {\n        this.renderer.removeSymbol(s.id)\n        this.model.removeSymbol(s.id)\n      })\n\n      this.model.replaceSymbol(symToReplace.id, newSymbols)\n      this.renderer.replaceSymbol(symToReplace.id, newSymbols)\n\n\n      if (oldStrokes.length && newStrokes.length) {\n        this.recognizer.replaceStrokes(oldStrokes.map(s => s.id), newStrokes)\n      }\n      else if (oldStrokes.length) {\n        this.recognizer.eraseStrokes(oldStrokes.map(s => s.id))\n      }\n      else {\n        this.recognizer.addStrokes(newStrokes, false)\n      }\n\n      if (addToHistory) {\n        this.history.push(this.model, { replaced: { oldSymbols, newSymbols } })\n      }\n      this.updateLayerUI()\n    }\n  }\n\n  changeOrderSymbol(symbol: TIISymbol, position: \"first\" | \"last\" | \"forward\" | \"backward\"): void\n  {\n    this.model.changeOrderSymbol(symbol.id, position)\n    this.renderer.changeOrderSymbol(symbol, position)\n    this.history.push(this.model, { order: { symbols: [symbol], position } })\n  }\n\n  changeOrderSymbols(symbols: TIISymbol[], position: \"first\" | \"last\" | \"forward\" | \"backward\")\n  {\n    symbols.forEach(s =>\n    {\n      this.model.changeOrderSymbol(s.id, position)\n      this.renderer.changeOrderSymbol(s, position)\n    })\n    this.history.push(this.model, { order: { symbols, position } })\n  }\n\n  groupSymbols(symbols: TIISymbol[]): IISymbolGroup\n  {\n    const group = this.buildGroup({ children: symbols })\n    symbols.forEach(s =>\n    {\n      this.model.removeSymbol(s.id)\n      this.renderer.removeSymbol(s.id)\n    })\n    this.model.addSymbol(group)\n    this.history.push(this.model, { group: { symbols } })\n    return group\n  }\n\n  ungroupSymbol(group: IISymbolGroup): TIISymbol[]\n  {\n    group.children.forEach(s => this.renderer.drawSymbol(s))\n    this.renderer.removeSymbol(group.id)\n    this.model.replaceSymbol(group.id, group.children)\n    this.history.push(this.model, { ungroup: { group } })\n    return group.children\n  }\n\n  async synchronizeStrokesWithJIIX(force: boolean = false): Promise<void>\n  {\n    const strokes = this.model.symbols.filter(s => s.type === SymbolType.Stroke)\n    if (!force && !strokes.length) {\n      this.event.emitSynchronized()\n      return\n    }\n    await this.export([\"application/vnd.myscript.jiix\"])\n\n    const getSymbolsAndStrokesAssociatedFromJIIXStrokeItems = (items: TJIIXStrokeItem[] = []): { symbols: TIISymbol[], strokes: IIStroke[] } =>\n    {\n      const symbols: TIISymbol[] = []\n      const strokes: IIStroke[] = []\n      const strokeIdsUsed: string[] = []\n      items.forEach(i =>\n      {\n        const strokeId = i[\"full-id\"]!\n        if (strokeIdsUsed.includes(strokeId)) {\n          return\n        }\n        strokeIdsUsed.push(strokeId)\n        const sym = this.model.getRootSymbol(strokeId)\n        if (sym) {\n          switch (sym?.type) {\n            case SymbolType.Recognized:\n              strokes.push(sym.strokes.find(s => s.id === i[\"full-id\"]!)!)\n              break\n            default:\n              strokes.push(sym as IIStroke)\n              break\n          }\n          const symIdx = symbols.findIndex(s => s.id === sym.id)\n          if (symIdx < 0) {\n            symbols.push(sym)\n          }\n          else {\n            symbols[symIdx] = sym\n          }\n        }\n      })\n      return {\n        symbols,\n        strokes\n      }\n    }\n\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    jiix?.elements?.forEach(el =>\n    {\n      switch (el.type) {\n        case JIIXELementType.Text: {\n          el.words?.forEach(w =>\n          {\n            const jiixAssociation = getSymbolsAndStrokesAssociatedFromJIIXStrokeItems(w.items)\n            if (jiixAssociation.strokes.length) {\n              if (jiixAssociation.symbols.length === 1) {\n                const symAsso = jiixAssociation.symbols[0]\n                if (\n                  symAsso.type === SymbolType.Recognized && symAsso.kind === RecognizedKind.Text &&\n                  symAsso.label === w.label &&\n                  symAsso.strokes.length === symAsso.strokes.length\n                ) {\n                  return\n                }\n              }\n              const line = el.lines!.find(l => l[\"first-char\"]! <= w[\"first-char\"]! && l[\"last-char\"]! >= w[\"last-char\"]!)!\n              const recognizedText = new IIRecognizedText(jiixAssociation.strokes, { baseline: convertMillimeterToPixel(line[\"baseline-y\"]), xHeight: convertMillimeterToPixel(line[\"x-height\"]) })\n              recognizedText.label = w.label\n              jiixAssociation.symbols.forEach(sym =>\n              {\n                if (sym.type === SymbolType.Recognized && sym.kind === RecognizedKind.Text) {\n                  sym.decorators.forEach(d =>\n                  {\n                    if (!recognizedText.decorators.some(wd => wd.kind === d.kind)) {\n                      recognizedText.decorators.push(d)\n                    }\n                  })\n                }\n                this.model.removeSymbol(sym.id)\n                this.renderer.removeSymbol(sym.id)\n              })\n              this.model.addSymbol(recognizedText)\n              this.renderer.drawSymbol(recognizedText)\n            }\n          })\n          break\n        }\n        case JIIXELementType.Node: {\n          let symbolRecognized: TIIRecognized | undefined\n          const jiixAssociation = getSymbolsAndStrokesAssociatedFromJIIXStrokeItems(el.items)\n          if (jiixAssociation.strokes.length) {\n            if (jiixAssociation.symbols.length === 1) {\n              const symAsso = jiixAssociation.symbols[0]\n              if (symAsso.type === SymbolType.Recognized &&\n                symAsso.strokes.length === jiixAssociation.strokes.length) {\n                return\n              }\n            }\n            switch (el.kind) {\n              case JIIXNodeKind.Circle: {\n                symbolRecognized = new IIRecognizedCircle(jiixAssociation.strokes)\n                break\n              }\n              case JIIXNodeKind.Ellipse: {\n                symbolRecognized = new IIRecognizedEllipse(jiixAssociation.strokes)\n                break\n              }\n              case JIIXNodeKind.Rectangle:\n              case JIIXNodeKind.Triangle:\n              case JIIXNodeKind.Parallelogram:\n              case JIIXNodeKind.Polygon:\n              case JIIXNodeKind.Rhombus: {\n                symbolRecognized = new IIRecognizedPolygon(jiixAssociation.strokes)\n                break\n              }\n              default:\n                this.logger.warn(\"synchronizeStrokesWithJIIX\", `Can not create recognized shape symbol, kind unknow: ${ el }`)\n                break\n            }\n            if (symbolRecognized) {\n              jiixAssociation.symbols.forEach(sym =>\n              {\n                this.model.removeSymbol(sym.id)\n                this.renderer.removeSymbol(sym.id)\n              })\n              this.model.addSymbol(symbolRecognized)\n              this.renderer.drawSymbol(symbolRecognized)\n            }\n          }\n          break\n        }\n        case JIIXELementType.Edge: {\n          let symbolRecognized: TIIRecognized | undefined\n          const jiixAssociation = getSymbolsAndStrokesAssociatedFromJIIXStrokeItems(el.kind === JIIXEdgeKind.PolyEdge ? el.edges.flatMap(e => e.items!) : el.items)\n          if (jiixAssociation.strokes.length) {\n            if (jiixAssociation.symbols.length === 1) {\n              const symAsso = jiixAssociation.symbols[0]\n              if (symAsso.type === SymbolType.Recognized &&\n                symAsso.strokes.length === jiixAssociation.strokes.length) {\n                return\n              }\n            }\n            switch (el.kind) {\n              case JIIXEdgeKind.Line: {\n                symbolRecognized = new IIRecognizedLine(jiixAssociation.strokes)\n                break\n              }\n              case JIIXEdgeKind.PolyEdge: {\n                symbolRecognized = new IIRecognizedPolyLine(jiixAssociation.strokes)\n                break\n              }\n              case JIIXEdgeKind.Arc: {\n                symbolRecognized = new IIRecognizedArc(jiixAssociation.strokes)\n                break\n              }\n              default:\n                this.logger.warn(\"synchronizeStrokesWithJIIX\", `Can not create recognized edge symbol, kind unknow: ${ el }`)\n                break\n            }\n            if (symbolRecognized) {\n              jiixAssociation.symbols.forEach(sym =>\n              {\n                this.model.removeSymbol(sym.id)\n                this.renderer.removeSymbol(sym.id)\n              })\n              this.model.addSymbol(symbolRecognized)\n              this.renderer.drawSymbol(symbolRecognized)\n            }\n          }\n          break\n        }\n        default:\n          this.logger.warn(\"synchronizeStrokesWithJIIX\", `Can not create recognized symbol, type unknow: ${ el }`)\n          break\n      }\n    })\n\n    this.model.mergeExport({ \"application/vnd.myscript.jiix\": jiix })\n    this.history.update(this.model)\n    this.event.emitSynchronized()\n  }\n\n  async removeSymbol(id: string, addToHistory = true): Promise<void>\n  {\n    this.logger.info(\"removeSymbol\", { id })\n    const symbol = this.model.getRootSymbol(id)\n    if (symbol) {\n      this.updateLayerState(false)\n      if (symbol.type === SymbolType.Group) {\n        const groupStrokeIds = symbol.extractStrokes().map(s => s.id)\n        symbol.removeChilds([id])\n        if (symbol.children.length) {\n          this.model.updateSymbol(symbol)\n          this.renderer.drawSymbol(symbol)\n          if (groupStrokeIds.includes(id)) {\n            this.recognizer.eraseStrokes([id])\n          }\n        }\n        else {\n          this.recognizer.eraseStrokes(groupStrokeIds)\n          this.model.removeSymbol(symbol.id)\n          this.renderer.removeSymbol(symbol.id)\n        }\n      }\n      else {\n        this.recognizer.eraseStrokes([id])\n        this.model.removeSymbol(symbol.id)\n        this.renderer.removeSymbol(symbol.id)\n      }\n      if (addToHistory) {\n        this.history.push(this.model, { erased: [symbol] })\n      }\n      this.updateLayerUI()\n    }\n    else {\n      this.renderer.removeSymbol(id)\n      this.recognizer.eraseStrokes([id])\n    }\n  }\n\n  async removeSymbols(ids: string[], addToHistory = true): Promise<TIISymbol[]>\n  {\n    this.logger.info(\"removeSymbol\", { ids })\n    const symbolsToRemove: TIISymbol[] = []\n    const symbolsToUpdate: TIISymbol[] = []\n    const strokesIds: string[] = []\n    ids.forEach(id =>\n    {\n      const sym = this.model.getRootSymbol(id)\n      if (sym) {\n        /** we remove root element */\n        if (sym.id === id) {\n          symbolsToRemove.push(sym)\n          switch (sym.type) {\n            case SymbolType.Stroke:\n              strokesIds.push(sym.id)\n              break\n            case SymbolType.Recognized:\n              strokesIds.push(...sym.strokes.map(s => s.id))\n              break\n            case SymbolType.Group:\n              strokesIds.push(...sym.extractStrokes().map(s => s.id))\n              break\n          }\n        }\n        else {\n          /** we want to remove child */\n          switch (sym.type) {\n            case SymbolType.Group: {\n              const gr = sym.clone()\n              strokesIds.push(...gr.extractStrokes().map(s => s.id).filter(id => ids.includes(id)))\n              gr.removeChilds(ids)\n              if (gr.children.length) {\n                symbolsToUpdate.push(gr)\n              }\n              else {\n                symbolsToRemove.push(gr)\n              }\n              break\n            }\n            case SymbolType.Recognized: {\n              strokesIds.push(id)\n              const ws = sym.clone()\n              ws.removeStrokes(ids)\n              if (ws.strokes.length) {\n                symbolsToUpdate.push(ws)\n              }\n              else {\n                symbolsToRemove.push(ws)\n              }\n              break\n            }\n          }\n\n        }\n      }\n    })\n    this.recognizer.eraseStrokes(strokesIds)\n    symbolsToRemove.forEach(s =>\n    {\n      this.model.removeSymbol(s.id)\n      this.renderer.removeSymbol(s.id)\n    })\n\n    symbolsToUpdate.forEach(s =>\n    {\n      this.model.updateSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n\n\n    if (addToHistory) {\n      const changes: TIIHistoryChanges = {}\n      if (symbolsToRemove.length || symbolsToUpdate.length) {\n        if (symbolsToRemove.length) {\n          changes.erased = symbolsToRemove\n        }\n        if (symbolsToUpdate.length) {\n          changes.updated = symbolsToUpdate\n        }\n        this.history.push(this.model, changes)\n        this.updateLayerUI()\n      }\n    }\n    this.updateLayerState(false)\n    return symbolsToRemove\n  }\n\n  select(ids: string[]): void\n  {\n    this.selector.removeSelectedGroup()\n    this.model.symbols.forEach(s =>\n    {\n      s.selected = ids.includes(s.id)\n      this.renderer.drawSymbol(s)\n    })\n    this.selector.drawSelectedGroup(this.model.symbolsSelected)\n    this.updateLayerUI()\n    this.event.emitSelected(this.model.symbolsSelected)\n  }\n\n  selectAll(): void\n  {\n    this.selector.removeSelectedGroup()\n    this.model.symbols.forEach(s =>\n    {\n      s.selected = true\n      this.renderer.drawSymbol(s)\n    })\n    this.selector.drawSelectedGroup(this.model.symbolsSelected)\n    this.updateLayerUI()\n    this.event.emitSelected(this.model.symbolsSelected)\n  }\n\n  unselectAll(): void\n  {\n    if (this.model.symbolsSelected.length) {\n      this.model.symbolsSelected.forEach(s =>\n      {\n        s.selected = false\n        this.renderer.drawSymbol(s)\n      })\n      this.selector.removeSelectedGroup()\n      this.updateLayerUI()\n      this.event.emitSelected(this.model.symbolsSelected)\n    }\n  }\n\n  async importPointEvents(partialStrokes: PartialDeep<IIStroke>[]): Promise<IIModel>\n  {\n    this.logger.info(\"importPointEvents\", { partialStrokes })\n    this.updateLayerState(false)\n    const strokes = convertPartialStrokesToOIStrokes(partialStrokes)\n    strokes.forEach(s =>\n    {\n      this.model.addSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n    this.recognizer.addStrokes(strokes, false)\n    this.history.push(this.model, { added: strokes })\n    this.logger.debug(\"importPointEvents\", this.model)\n    this.updateLayerUI()\n    this.event.emitImported(this.model.exports as TExport)\n    return this.model\n  }\n\n  protected triggerDownload(fileName: string, urlData: string): void\n  {\n    const downloadAnchorNode = document.createElement(\"a\")\n    downloadAnchorNode.setAttribute(\"href\", urlData)\n    downloadAnchorNode.setAttribute(\"download\", fileName)\n    document.body.appendChild(downloadAnchorNode)\n    downloadAnchorNode.click()\n    downloadAnchorNode.remove()\n  }\n\n  getSymbolsBounds(symbols: TIISymbol[], margin: number = SELECTION_MARGIN): Box\n  {\n    const box = Box.createFromBoxes(symbols.map(s => s.bounds))\n    box.x -= margin\n    box.y -= margin\n    box.width += margin * 2\n    box.height += margin * 2\n    return box\n  }\n\n  protected buildBlobFromSymbols(symbols: TIISymbol[], box: Box): Blob\n  {\n    const svgNode = SVGBuilder.createLayer(box)\n    symbols.forEach(s =>\n    {\n      const el = this.renderer.getElementById(s.id)?.cloneNode(true)\n      if (el) {\n        svgNode.appendChild(el)\n      }\n    })\n\n    const svgString = (new XMLSerializer()).serializeToString(svgNode)\n\n    return new Blob([svgString], {\n      type: \"image/svg+xml;charset=utf-8\"\n    })\n  }\n\n  protected getExportName(extension: string): string\n  {\n    const options: Intl.DateTimeFormatOptions = { year: \"numeric\", month: \"numeric\", day: \"numeric\", hour: \"2-digit\", minute: \"2-digit\", second: \"2-digit\" }\n    try {\n      return `iink-ts-${ new Date().toLocaleDateString(navigator.language, options) }.${ extension }`\n    }\n    catch {\n      return `iink-ts-${ new Date().toLocaleDateString(\"en-US\", options) }.${ extension }`\n    }\n  }\n\n  downloadAsSVG(selection = false)\n  {\n    const symbols = selection ? this.model.symbolsSelected : this.model.symbols\n    const box = this.getSymbolsBounds(symbols)\n    const svgBlob = this.buildBlobFromSymbols(symbols, box)\n    const url = URL.createObjectURL(svgBlob)\n    this.triggerDownload(this.getExportName(\"svg\"), url)\n  }\n\n  downloadAsPNG(selection = false)\n  {\n    const symbols = selection ? this.model.symbolsSelected : this.model.symbols\n    const box = this.getSymbolsBounds(symbols)\n    const svgBlob = this.buildBlobFromSymbols(symbols, box)\n\n    const url = URL.createObjectURL(svgBlob)\n    const image = new Image(box.width, box.height)\n    image.src = url\n    image.onload = () =>\n    {\n      const canvas = document.createElement(\"canvas\")\n      canvas.width = image.width\n      canvas.height = image.height\n\n      const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D\n      ctx.drawImage(image, 0, 0)\n      URL.revokeObjectURL(url)\n\n      const imgURI = canvas\n        .toDataURL(\"image/png\")\n        .replace(\"image/png\", \"image/octet-stream\")\n\n      this.triggerDownload(this.getExportName(\"png\"), imgURI)\n    }\n  }\n\n  downloadAsJson(selection = false)\n  {\n    const symbolsToExport = selection ? this.model.symbolsSelected : this.model.symbols\n    const dataStr = \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(symbolsToExport, null, 2))\n    this.triggerDownload(this.getExportName(\"json\"), dataStr)\n  }\n\n  extractStrokesFromSymbols(symbols: TIISymbol[] | undefined): IIStroke[]\n  {\n    if (!symbols?.length) return []\n    const strokes: IIStroke[] = []\n    symbols.forEach(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Stroke:\n          strokes.push(s)\n          break\n        case SymbolType.Recognized:\n          strokes.push(...s.strokes)\n          break\n        case SymbolType.Group:\n          strokes.push(...s.extractStrokes())\n          break\n      }\n    })\n    return strokes\n  }\n\n  extractTextsFromSymbols(symbols: TIISymbol[] | undefined): IIText[]\n  {\n    if (!symbols?.length) return []\n    const texts: IIText[] = []\n    symbols.forEach(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Text:\n          texts.push(s)\n          break\n        case SymbolType.Group:\n          texts.push(...s.extractText())\n          break\n      }\n    })\n    return texts\n  }\n\n  protected extractBackendChanges(changes: TIIHistoryChanges): TIIHistoryBackendChanges\n  {\n    const backendChanges: TIIHistoryBackendChanges = {}\n    backendChanges.added = this.extractStrokesFromSymbols(changes.added)\n    backendChanges.erased = this.extractStrokesFromSymbols(changes.erased)\n\n    const updated = this.extractStrokesFromSymbols(changes.updated)\n\n    const oldStrokes = updated.concat(this.extractStrokesFromSymbols(changes.replaced?.oldSymbols))\n    const newStrokes = updated.concat(this.extractStrokesFromSymbols(changes.replaced?.newSymbols))\n    if (oldStrokes.length && newStrokes.length) {\n      backendChanges.replaced = {\n        oldStrokes,\n        newStrokes\n      }\n    }\n    else {\n      backendChanges.added.push(...newStrokes)\n      backendChanges.erased.push(...oldStrokes)\n    }\n\n    if (changes.matrix) {\n      backendChanges.matrix = {\n        strokes: this.extractStrokesFromSymbols(changes.matrix.symbols),\n        matrix: changes.matrix.matrix,\n      }\n    }\n\n    if (changes.translate?.length) {\n      backendChanges.translate = []\n      changes.translate.forEach(tr =>\n      {\n        const strokes = this.extractStrokesFromSymbols(tr.symbols)\n        if (strokes.length) {\n          backendChanges.translate!.push({\n            strokes,\n            tx: tr.tx,\n            ty: tr.ty\n          })\n        }\n      })\n    }\n    if (changes.scale?.length) {\n      backendChanges.scale = []\n      changes.scale.forEach(tr =>\n      {\n        const strokes = this.extractStrokesFromSymbols(tr.symbols)\n        if (strokes.length) {\n          backendChanges.scale!.push({\n            strokes,\n            origin: tr.origin,\n            scaleX: tr.scaleX,\n            scaleY: tr.scaleY\n          })\n        }\n      })\n    }\n    if (changes.rotate?.length) {\n      backendChanges.rotate = []\n      changes.rotate.forEach(tr =>\n      {\n        const strokes = this.extractStrokesFromSymbols(tr.symbols)\n        if (strokes.length) {\n          backendChanges.rotate!.push({\n            strokes,\n            center: tr.center,\n            angle: tr.angle\n          })\n        }\n      })\n    }\n    return backendChanges\n  }\n\n  async undo(): Promise<IIModel>\n  {\n    this.logger.info(\"undo\")\n    if (this.history.context.canUndo) {\n      this.updateLayerState(false)\n      this.unselectAll()\n      const previousStackItem = this.history.undo()\n      const modifications = previousStackItem.model.extractDifferenceSymbols(this.model)\n      this.#model = previousStackItem.model.clone()\n      this.logger.debug(\"undo\", { previousStackItem })\n      const actionsToBackend = this.extractBackendChanges(previousStackItem.changes)\n      modifications.removed.forEach(s => this.renderer.removeSymbol(s.id))\n      modifications.added.forEach(s => this.renderer.drawSymbol(s))\n      if (\n        actionsToBackend.added?.length ||\n        actionsToBackend.erased?.length ||\n        actionsToBackend.replaced ||\n        actionsToBackend.matrix ||\n        actionsToBackend.translate?.length ||\n        actionsToBackend.scale?.length ||\n        actionsToBackend.rotate?.length\n      ) {\n        await this.recognizer.undo(actionsToBackend)\n      }\n      this.updateLayerUI()\n    }\n    return this.model\n  }\n\n  async redo(): Promise<IIModel>\n  {\n    this.logger.info(\"redo\")\n\n    if (this.history.context.canRedo) {\n      this.updateLayerState(false)\n      this.unselectAll()\n      const nextStackItem = this.history.redo()\n      const modifications = nextStackItem.model.extractDifferenceSymbols(this.model)\n      this.#model = nextStackItem.model.clone()\n      this.logger.debug(\"redo\", { modifications })\n      const actionsToBackend = this.extractBackendChanges(nextStackItem.changes)\n      modifications.removed.forEach(s => this.renderer.removeSymbol(s.id))\n      modifications.added.forEach(s => this.renderer.drawSymbol(s))\n      if (\n        actionsToBackend.added?.length ||\n        actionsToBackend.erased?.length ||\n        actionsToBackend.replaced ||\n        actionsToBackend.matrix ||\n        actionsToBackend.translate?.length ||\n        actionsToBackend.scale?.length ||\n        actionsToBackend.rotate?.length\n      ) {\n        await this.recognizer.redo(actionsToBackend)\n      }\n\n      this.updateLayerUI()\n    }\n    return this.model\n  }\n\n  async export(mimeTypes?: string[]): Promise<IIModel>\n  {\n    try {\n      this.logger.info(\"export\", { mimeTypes })\n      const exports = await this.recognizer.export(mimeTypes)\n      this.model.mergeExport(exports as TExport)\n    }\n    catch (error) {\n      this.logger.error(\"export\", { error })\n      this.manageError(error as Error)\n      throw error\n    }\n    return this.model\n  }\n\n  async convert(): Promise<void>\n  {\n    await this.convertSymbols()\n  }\n\n  async convertSymbols(symbols?: TIISymbol[]): Promise<void>\n  {\n    try {\n      this.updateLayerState(false)\n      await this.converter.apply(symbols)\n      this.event.emitConverted(this.model.converts as TExport)\n    }\n    catch (error) {\n      this.logger.error(\"convert\", error)\n      this.manageError(error as Error)\n      throw error\n    }\n    finally {\n      this.updateLayerUI()\n    }\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    return this.recognizer.waitForIdle()\n  }\n\n  async resize({ height, width }: { height?: number, width?: number } = {}): Promise<void>\n  {\n    try {\n      this.logger.info(\"resize\", { height, width })\n      const compStyles = window.getComputedStyle(this.layers.root)\n      height = height || Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.configuration.rendering.minHeight)\n      width = width || Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.configuration.rendering.minWidth)\n\n      this.updateLayerState(false)\n      this.model.height = height\n      this.model.width = width\n      this.renderer.resize(height, width)\n      this.updateLayerUI(50)\n      this.updateLayerState(true)\n    } catch (error) {\n      this.manageError(error as Error)\n    }\n  }\n\n  async clear(): Promise<void>\n  {\n    try {\n      this.logger.info(\"clear\")\n      this.updateLayerState(false)\n      if (this.model.symbols.length) {\n        this.selector.removeSelectedGroup()\n        const erased = this.model.symbols\n        this.renderer.clear()\n        this.model.clear()\n        this.history.push(this.model, { erased })\n        this.recognizer.clear()\n        this.event.emitSelected(this.model.symbolsSelected)\n      }\n      this.updateLayerUI()\n      this.event.emitCleared()\n    } catch (error) {\n      this.manageError(error as Error)\n    }\n  }\n\n  async destroy(): Promise<void>\n  {\n    this.logger.info(\"destroy\")\n\n    this.layers.root.classList.remove(\"draw\")\n    this.layers.root.classList.remove(\"erase\")\n    this.layers.root.classList.remove(\"select\")\n    this.layers.root.classList.remove(\"move\")\n\n    this.eraser.detach()\n    this.selector.detach()\n    this.move.detach()\n    this.writer.detach()\n\n    this.renderer.destroy()\n    this.layers.destroy()\n    this.menu.destroy()\n    this.recognizer.destroy()\n    this.model.clear()\n    this.history.clear()\n    return Promise.resolve()\n  }\n}\n","/**\n * @group Editor\n * @remarks\n * Configure when the action is triggered.\n *\n * POINTER_UP :   Action is triggered on every PenUP.\n *                This is the recommended mode for CDK V3 WebSocket recognitions.\n *\n * QUIET_PERIOD : Action is triggered after a quiet period in milli-seconds on every pointer up.\n *                The value is set to 1000 for example recognition will be triggered when the user stops writing for 1 seconds.\n *                This is the recommended mode for all REST discoveries.\n *\n * DEMAND :       Action is triggered on external demande\n */\nexport type TEditorTriggerConfiguration = {\n    exportContent: \"QUIET_PERIOD\" | \"POINTER_UP\" | \"DEMAND\"\n    exportContentDelay: number\n    resizeTriggerDelay: number\n  }\n\n  /**\n   * @group Editor\n   * @source\n   */\n  export const DefaulTEditorTriggerConfiguration: TEditorTriggerConfiguration = {\n    exportContent: \"QUIET_PERIOD\",\n    exportContentDelay: 1000,\n    resizeTriggerDelay: 100\n  }\n","import { DefaultGrabberConfiguration, TGrabberConfiguration } from \"../grabber\"\nimport { DefaultHistoryConfiguration, THistoryConfiguration } from \"../history\"\nimport { DefaultLoggerConfiguration, TLoggerConfiguration } from \"../logger\"\nimport { DefaultRecognizerHTTPV1Configuration, RecognizerHTTPV1Configuration, TRecognitionHTTPV1Configuration, TRecognizerHTTPV1Configuration, TServerHTTPConfiguration } from \"../recognizer\"\nimport { DefaultRendererConfiguration, TRendererConfiguration } from \"../renderer\"\nimport { DefaultTheme, TPenStyle, TTheme } from \"../style\"\nimport { mergeDeep, PartialDeep } from \"../utils\"\nimport { TEditorConfiguration } from \"./AbstractEditor\"\nimport { DefaulTEditorTriggerConfiguration, TEditorTriggerConfiguration } from \"./EditorTriggerConfiguration\"\n\n\n/**\n * @group Editor\n */\nexport type TInkEditorDeprecatedConfiguration = TEditorConfiguration & TRecognizerHTTPV1Configuration & {\n  rendering: TRendererConfiguration\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TPenStyle,\n  penStyleClasses?: string\n  theme: TTheme\n}\n\n/**\n * @group Editor\n * @source\n */\nexport const DefaultInkEditorDeprecatedConfiguration: TInkEditorDeprecatedConfiguration = {\n  server: DefaultRecognizerHTTPV1Configuration.server,\n  recognition: DefaultRecognizerHTTPV1Configuration.recognition,\n  rendering: DefaultRendererConfiguration,\n  grabber: DefaultGrabberConfiguration,\n  triggers: DefaulTEditorTriggerConfiguration,\n  \"undo-redo\": DefaultHistoryConfiguration,\n  logger: DefaultLoggerConfiguration,\n  penStyle: {},\n  theme: DefaultTheme\n}\n\n/**\n * @group Editor\n */\nexport class InkEditorDeprecatedConfiguration implements TInkEditorDeprecatedConfiguration\n{\n  server: TServerHTTPConfiguration\n  recognition: TRecognitionHTTPV1Configuration\n  rendering: TRendererConfiguration\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TPenStyle\n  penStyleClasses?: string\n  theme: TTheme\n\n  constructor(configuration?: PartialDeep<TInkEditorDeprecatedConfiguration>)\n  {\n    const { server, recognition } = new RecognizerHTTPV1Configuration(configuration)\n    this.server = server\n    this.recognition = recognition\n    this.rendering = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.rendering, configuration?.rendering)\n    this.grabber = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.grabber, configuration?.grabber)\n    this[\"undo-redo\"] = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration[\"undo-redo\"], configuration?.[\"undo-redo\"])\n    this.triggers = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.triggers, configuration?.triggers)\n    this.logger = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.logger, configuration?.logger)\n    this.penStyle = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.penStyle, configuration?.penStyle)\n    this.penStyleClasses = configuration?.penStyleClasses || this.penStyleClasses\n    this.theme = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.theme, configuration?.theme)\n  }\n}\n","import { EditorTool } from \"../Constants\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\nimport { Model, TExport } from \"../model\"\nimport { Stroke, TStroke, TPointer } from \"../symbol\"\nimport { RecognizerHTTPV1, TConverstionState } from \"../recognizer\"\nimport { CanvasRenderer } from \"../renderer\"\nimport { DefaultPenStyle, StyleManager, TPenStyle, TTheme } from \"../style\"\nimport { HistoryManager } from \"../history\"\nimport { DeferredPromise, PartialDeep } from \"../utils\"\nimport { AbstractEditor, EditorOptionsBase } from \"./AbstractEditor\"\nimport { InkEditorDeprecatedConfiguration, TInkEditorDeprecatedConfiguration } from \"./InkEditorDeprecatedConfiguration\"\n\n/**\n * @group Editor\n */\nexport type TInkEditorDeprecatedOptions = PartialDeep<EditorOptionsBase &\n{\n  configuration: TInkEditorDeprecatedConfiguration\n}> &\n{\n  override?: {\n    grabber?: PointerEventGrabber\n    recognizer?: RecognizerHTTPV1\n  }\n}\n\n/**\n * @group Editor\n * @deprecated Use {@link InkEditor} instead.\n */\nexport class InkEditorDeprecated extends AbstractEditor\n{\n  #configuration: InkEditorDeprecatedConfiguration\n  #model: Model\n  #resizeTimer?: ReturnType<typeof setTimeout>\n  #exportTimer?: ReturnType<typeof setTimeout>\n\n  grabber: PointerEventGrabber\n  renderer: CanvasRenderer\n  recognizer: RecognizerHTTPV1\n  history: HistoryManager\n  styleManager: StyleManager\n  #tool: EditorTool = EditorTool.Write\n\n  constructor(rootElement: HTMLElement, options?: TInkEditorDeprecatedOptions)\n  {\n    super(rootElement, options)\n\n    this.#configuration = new InkEditorDeprecatedConfiguration(options?.configuration)\n    this.styleManager = new StyleManager(options?.configuration?.penStyle, options?.configuration?.theme)\n\n    if (options?.override?.grabber) {\n      const CustomGrabber = options.override.grabber as unknown as typeof PointerEventGrabber\n      this.grabber = new CustomGrabber(this.#configuration.grabber)\n    }\n    else {\n      this.grabber = new PointerEventGrabber(this.#configuration.grabber)\n    }\n    this.grabber.onPointerDown = this.onPointerDown.bind(this)\n    this.grabber.onPointerMove = this.onPointerMove.bind(this)\n    this.grabber.onPointerUp = this.onPointerUp.bind(this)\n\n    if (options?.override?.recognizer) {\n      const CustomRecognizer = options.override.recognizer as unknown as typeof RecognizerHTTPV1\n      this.recognizer = new CustomRecognizer(this.#configuration)\n    }\n    else {\n      this.recognizer = new RecognizerHTTPV1(this.#configuration)\n    }\n    this.renderer = new CanvasRenderer(this.#configuration.rendering)\n\n    this.tool = EditorTool.Write\n    this.#model = new Model()\n    this.history = new HistoryManager(this.#configuration[\"undo-redo\"], this.event)\n  }\n\n  protected onPointerDown(info: PointerInfo): void\n  {\n    this.logger.info(\"onPointerDown\", { tool: this.tool, info })\n    const style: TPenStyle = Object.assign({}, this.theme?.ink, this.currentPenStyle)\n    switch (this.tool) {\n      case EditorTool.Erase: {\n        if (this.model.removeStrokesFromPoint(info.pointer).length > 0) {\n          this.renderer.drawModel(this.model)\n        }\n        break\n      }\n      case EditorTool.Write:\n        this.model.initCurrentStroke(info.pointer, info.pointerType, style)\n        this.drawCurrentStroke()\n        break\n      default:\n        this.logger.warn(\"#onPointerDown\", `onPointerDown tool unknow: \"${ this.tool }\"`)\n        break\n    }\n  }\n\n  protected onPointerMove(info: PointerInfo): void\n  {\n    this.logger.info(\"onPointerMove\", { tool: this.tool, info })\n    switch (this.tool) {\n      case EditorTool.Erase: {\n        if (this.model.removeStrokesFromPoint(info.pointer).length > 0) {\n          this.renderer.drawModel(this.model)\n        }\n        break\n      }\n      case EditorTool.Write:\n        this.model.appendToCurrentStroke(info.pointer)\n        this.drawCurrentStroke()\n        break\n      default:\n        this.logger.warn(\"#onPointerMove\", `onPointerMove tool unknow: \"${ this.tool }\"`)\n        break\n    }\n  }\n\n  protected async onPointerUp(info: PointerInfo): Promise<void>\n  {\n    try {\n      this.logger.info(\"onPointerUp\", { tool: this.tool, info })\n      switch (this.tool) {\n        case EditorTool.Erase:\n          this.model.removeStrokesFromPoint(info.pointer)\n          if (this.history.stack.at(-1)?.modificationDate !== this.model.modificationDate) {\n            await this.updateModelRendering()\n          }\n          break\n        case EditorTool.Write:\n          this.model.endCurrentStroke(info.pointer)\n          await this.updateModelRendering()\n          break\n        default:\n          this.logger.warn(\"#onPointerUp\", `onPointerUp tool unknow: \"${ this.tool }\"`)\n          break\n      }\n    } catch (error) {\n      this.layers.showMessageError(error as Error)\n      this.event.emitError(error as Error)\n      throw error\n    }\n  }\n\n  get initializationPromise(): Promise<void>\n  {\n    return Promise.resolve()\n  }\n\n  get tool(): EditorTool\n  {\n    return this.#tool\n  }\n  set tool(i: EditorTool)\n  {\n    this.#tool = i\n    this.setCursorStyle()\n  }\n\n  protected setCursorStyle(): void\n  {\n    switch (this.tool) {\n      case EditorTool.Erase:\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.add(\"erase\")\n        break\n      default:\n        this.layers.root.classList.add(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        break\n    }\n  }\n\n  get model(): Model\n  {\n    return this.#model\n  }\n\n  get currentPenStyle(): TPenStyle\n  {\n    return this.styleManager.currentPenStyle\n  }\n\n  get penStyle(): TPenStyle\n  {\n    return this.styleManager.penStyle\n  }\n  set penStyle(penStyle: TPenStyle | undefined)\n  {\n    this.logger.info(\"setPenStyle\", { penStyle })\n    this.styleManager.setPenStyle(penStyle)\n  }\n\n  get penStyleClasses(): string\n  {\n    return this.styleManager.penStyleClasses\n  }\n  set penStyleClasses(penStyleClasses: string | undefined)\n  {\n    this.logger.info(\"setPenStyleClasses\", { penStyleClasses })\n    this.styleManager.setPenStyleClasses(penStyleClasses)\n  }\n\n  get theme(): TTheme\n  {\n    return this.styleManager.theme\n  }\n  set theme(theme: PartialDeep<TTheme>)\n  {\n    this.logger.info(\"setTheme\", { theme })\n    this.styleManager.setTheme(theme)\n  }\n\n  get configuration(): InkEditorDeprecatedConfiguration\n  {\n    return this.#configuration\n  }\n\n  async initialize(): Promise<void>\n  {\n    try {\n      this.logger.info(\"initialize\")\n      this.layers.render()\n      this.layers.showLoader()\n\n      const compStyles = window.getComputedStyle(this.layers.root)\n      this.model.width = Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.#configuration.rendering.minWidth)\n      this.model.height = Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.#configuration.rendering.minHeight)\n      this.history.push(this.model)\n      this.layers.rendering.classList.add(this.configuration.recognition.type.toLowerCase().replace(\" \", \"-\"))\n      this.renderer.init(this.layers.rendering, { x: 50, y: 50 })\n      this.grabber.attach(this.layers.rendering)\n    } catch (error) {\n      this.logger.error(\"initialize\", error)\n      this.layers.showMessageError(error as Error)\n      throw error\n    }\n    finally {\n      this.logger.debug(\"initialize\", \"finally\")\n      this.layers.hideLoader()\n      this.layers.updateState(true)\n    }\n  }\n\n  drawCurrentStroke(): void\n  {\n    this.logger.debug(\"drawCurrentStroke\", { stroke: this.model.currentSymbol })\n    this.renderer.drawPendingStroke(this.model.currentSymbol)\n  }\n\n  async updateModelRendering(): Promise<Model>\n  {\n    this.logger.info(\"updateModelRendering\")\n    this.renderer.drawModel(this.model)\n    const deferred = new DeferredPromise<Model>()\n    this.history.push(this.model)\n    if (this.#configuration.triggers.exportContent !== \"DEMAND\") {\n      clearTimeout(this.#exportTimer)\n      let currentModel = this.model.clone()\n      this.#exportTimer = setTimeout(async () =>\n      {\n        try {\n          currentModel = await this.recognizer.export(currentModel)\n          this.history.updateStack(currentModel)\n          if (this.model.modificationDate === currentModel.modificationDate) {\n            this.model.exports = currentModel.exports\n          }\n          deferred.resolve(this.model)\n        } catch (error) {\n          this.logger.error(\"updateModelRendering\", { error })\n          this.event.emitError(error as Error)\n          deferred.reject(error as Error)\n        }\n      }, this.#configuration.triggers.exportContent === \"QUIET_PERIOD\" ? this.#configuration.triggers.exportContentDelay : 0)\n    } else {\n      deferred.resolve(this.model)\n    }\n    await deferred.promise\n    this.event.emitExported(this.model.exports as TExport)\n    this.logger.debug(\"updateModelRendering\", this.model.exports)\n    return deferred.promise\n  }\n\n  async export(mimeTypes?: string[]): Promise<Model>\n  {\n    this.logger.info(\"export\", { mimeTypes })\n    const newModel = await this.recognizer.export(this.model.clone(), mimeTypes)\n    if (this.model.modificationDate === newModel.modificationDate) {\n      this.model.mergeExport(newModel.exports as TExport)\n    }\n    this.history.updateStack(newModel)\n    this.event.emitExported(this.model.exports as TExport)\n    this.logger.debug(\"export\", this.model)\n    return this.model\n  }\n\n  async convert(params?: { conversionState?: TConverstionState, mimeTypes?: string[] }): Promise<Model>\n  {\n    this.logger.info(\"convert\", { params })\n    const newModel = await this.recognizer.convert(this.model, params?.conversionState, params?.mimeTypes)\n    Object.assign(this.#model, newModel)\n    this.event.emitConverted(this.model.converts as TExport)\n    this.logger.debug(\"convert\", this.model)\n    return this.model\n  }\n\n  async importPointEvents(strokes: PartialDeep<TStroke>[]): Promise<Model>\n  {\n    const errors: string[] = []\n    strokes.forEach((s, strokeIndex) =>\n    {\n      let flag = true\n      const stroke = new Stroke(s.style || DefaultPenStyle, s.pointerType)\n      if (s.id) stroke.id = s.id\n      if (!s.pointers?.length) {\n        errors.push(`stroke ${ strokeIndex + 1 } has not pointers`)\n        flag = false\n        return\n      }\n      s.pointers?.forEach((pp, pIndex) =>\n      {\n        if (!pp) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no pointer at ${ pIndex }`)\n          flag = false\n          return\n        }\n        const pointer: TPointer = {\n          p: pp.p || 1,\n          t: pp.t || pIndex,\n          x: 0,\n          y: 0\n        }\n        if (pp?.x == undefined || pp?.x == null) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no x at pointer at ${ pIndex }`)\n          flag = false\n          return\n        }\n        else {\n          pointer.x = pp.x\n        }\n        if (pp?.y == undefined || pp?.y == null) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no y at pointer at ${ pIndex }`)\n          flag = false\n          return\n        }\n        else {\n          pointer.y = pp.y\n        }\n        if (flag) {\n          stroke.pointers.push(pointer)\n        }\n      })\n      if (flag) {\n        this.model.addStroke(stroke)\n      }\n    })\n\n    if (errors.length) {\n      this.event.emitError(new Error(errors.join(\"\\n\")))\n    }\n    try {\n      const newModel = await this.updateModelRendering()\n      Object.assign(this.#model, newModel)\n      this.event.emitImported(this.model.exports as TExport)\n      return this.model\n    } catch (error) {\n      this.event.emitError(error as Error)\n      throw error as Error\n    }\n  }\n  async resize({ height, width }: { height?: number, width?: number } = {}): Promise<void>\n  {\n    this.logger.info(\"resize\", { height, width })\n    const deferredResize = new DeferredPromise<Model>()\n    const compStyles = window.getComputedStyle(this.layers.root)\n    this.model.height = height || Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.configuration.rendering.minHeight)\n    this.model.width = width || Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.configuration.rendering.minWidth)\n    this.renderer.resize(this.model)\n    if (this.model.symbols.length) {\n      clearTimeout(this.#resizeTimer)\n      this.#resizeTimer = setTimeout(async () =>\n      {\n        const resizeModel = await this.recognizer.resize(this.model)\n        deferredResize.resolve(resizeModel)\n      }, this.#configuration.triggers.resizeTriggerDelay)\n    } else {\n      deferredResize.resolve(this.model)\n    }\n    this.#model = await deferredResize.promise\n    this.logger.debug(\"resize\", { model: this.model })\n    this.event.emitExported(this.model.exports as TExport)\n  }\n\n  async undo(): Promise<void>\n  {\n    this.logger.info(\"undo\")\n    this.#model = this.history.undo() as Model\n    this.renderer.drawModel(this.#model)\n    this.#model = await this.recognizer.export(this.#model)\n    this.history.updateStack(this.#model)\n    this.event.emitExported(this.#model.exports as TExport)\n    this.logger.debug(\"undo\", this.#model)\n  }\n\n  async redo(): Promise<void>\n  {\n    this.logger.info(\"redo\")\n    this.#model = this.history.redo() as Model\n    this.renderer.drawModel(this.#model)\n    this.#model = await this.recognizer.export(this.#model)\n    this.history.updateStack(this.#model)\n    this.event.emitExported(this.#model.exports as TExport)\n    this.logger.debug(\"redo\", this.#model)\n  }\n\n  async clear(): Promise<void>\n  {\n    this.logger.info(\"clear\")\n    this.model.clear()\n    this.history.push(this.model)\n    this.renderer.drawModel(this.model)\n    this.event.emitExported(this.model.exports as TExport)\n    this.event.emitCleared()\n    this.logger.debug(\"clear\", this.model)\n  }\n\n  async destroy(): Promise<void>\n  {\n    this.logger.info(\"destroy\")\n    this.event.removeAllListeners()\n    this.grabber.detach()\n    this.layers.destroy()\n    this.renderer.destroy()\n    return Promise.resolve()\n  }\n}\n","import style from \"./InteractiveInkSSRSmartGuide.css\"\nimport { InteractiveInkSSREditor } from \"../editor\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { ExportType, TJIIXExport, TJIIXWord } from \"../model\"\nimport { convertMillimeterToPixel, createUUID } from \"../utils\"\nimport { TMarginConfiguration } from \"../recognizer\"\n\n/**\n * @group InteractiveInkSSRSmartGuide\n */\nexport class InteractiveInkSSRSmartGuide\n{\n  uuid: string\n  #smartGuideElement!: HTMLDivElement\n  #wrapperElement!: HTMLDivElement\n  #prompterContainerElement!: HTMLDivElement\n  #prompterTextElement!: HTMLDivElement\n  #ellipsisElement!: HTMLDivElement\n  #tagElement!: HTMLDivElement\n  #candidatesElement!: HTMLDivElement\n  #menuElement!: HTMLDivElement\n  #convertElement!: HTMLButtonElement\n  #copyElement!: HTMLButtonElement\n  #deleteElement!: HTMLButtonElement\n  #isMenuOpen!: boolean\n  editor: InteractiveInkSSREditor\n  margin: TMarginConfiguration\n  jiix?: TJIIXExport\n  lastWord?: TJIIXWord\n  wordToChange?: TJIIXWord\n  #logger = LoggerManager.getLogger(LoggerCategory.SMARTGUIDE)\n\n  constructor(editor: InteractiveInkSSREditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.uuid = createUUID()\n    this.editor = editor\n    this.margin = {\n      bottom: 0,\n      left: 0,\n      right: 0,\n      top: 0\n    }\n    this.#createRootElement()\n    this.#createWrapperElement()\n    this.#createPrompterContainerElement()\n    this.#createPrompterTextElement()\n    this.#createEllipsisElement()\n    this.#createTagElement()\n    this.#createCandidatesElement()\n    this.#createMoreMenuElement()\n    this.#createConvertElement()\n    this.#createCopyElement()\n    this.#createDeleteElement()\n  }\n\n  #createRootElement(): void\n  {\n    this.#smartGuideElement = document.createElement(\"div\")\n    this.#smartGuideElement.id = `smartguide-${ this.uuid }`\n    this.#smartGuideElement.classList.add(\"smartguide\")\n    this.#smartGuideElement.addEventListener(\"pointerdown\", e => {\n      e.preventDefault()\n      e.stopPropagation()\n    })\n  }\n\n  #createWrapperElement(): void\n  {\n    this.#wrapperElement = document.createElement(\"div\")\n    this.#wrapperElement.id = `smartguide-wrapper-${ this.uuid }`\n    this.#wrapperElement.classList.add(\"smartguide-wrapper\")\n  }\n\n  #createPrompterContainerElement(): void\n  {\n    this.#prompterContainerElement = document.createElement(\"div\")\n    this.#prompterContainerElement.id = `prompter-container-${ this.uuid }`\n    this.#prompterContainerElement.classList.add(\"prompter-container\")\n  }\n\n  #createPrompterTextElement(): void\n  {\n    this.#prompterTextElement = document.createElement(\"div\")\n    this.#prompterTextElement.id = `prompter-text-${ this.uuid }`\n    this.#prompterTextElement.classList.add(\"prompter-text\")\n    this.#prompterTextElement.setAttribute(\"touch-action\", \"none\")\n  }\n\n  #createEllipsisElement(): void\n  {\n    this.#ellipsisElement = document.createElement(\"div\")\n    this.#ellipsisElement.id = `ellipsis-${ this.uuid }`\n    this.#ellipsisElement.classList.add(\"ellipsis\")\n    this.#ellipsisElement.innerHTML = \"...\"\n  }\n\n  #createTagElement(): void\n  {\n    this.#tagElement = document.createElement(\"div\")\n    this.#tagElement.id = `tag-icon-${ this.uuid }`\n    this.#tagElement.classList.add(\"tag-icon\")\n    this.#tagElement.innerHTML = \"&#182;\"\n  }\n\n  #createCandidatesElement(): void\n  {\n    this.#candidatesElement = document.createElement(\"div\")\n    this.#candidatesElement.id = `candidates-${ this.uuid }`\n    this.#candidatesElement.classList.add(\"candidates\")\n  }\n\n  #createMoreMenuElement(): void\n  {\n    this.#menuElement = document.createElement(\"div\")\n    this.#menuElement.id = `more-menu-${ this.uuid }`\n    this.#menuElement.classList.add(\"more-menu\")\n  }\n\n  #createConvertElement(): void\n  {\n    this.#convertElement = document.createElement(\"button\")\n    this.#convertElement.id = `convert-${ this.uuid }`\n    this.#convertElement.classList.add(\"options-label-button\")\n    this.#convertElement.innerHTML = \"Convert\"\n  }\n\n  #createCopyElement(): void\n  {\n    this.#copyElement = document.createElement(\"button\")\n    this.#copyElement.id = `copy-${ this.uuid }`\n    this.#copyElement.classList.add(\"options-label-button\")\n    this.#copyElement.innerHTML = \"Copy\"\n  }\n\n  #createDeleteElement(): void\n  {\n    this.#deleteElement = document.createElement(\"button\")\n    this.#deleteElement.id = `delete-${ this.uuid }`\n    this.#deleteElement.classList.add(\"options-label-button\")\n    this.#deleteElement.innerHTML = \"Delete\"\n  }\n\n  init(domElement: HTMLElement, margin: TMarginConfiguration): void\n  {\n    this.#logger.info(\"init\", { domElement, margin })\n\n    const styleElement = document.createElement(\"style\")\n    styleElement.appendChild(document.createTextNode(style as string))\n    domElement.appendChild(styleElement)\n\n\n    domElement.appendChild(this.#smartGuideElement)\n    this.#smartGuideElement.appendChild(this.#wrapperElement)\n\n    this.#wrapperElement.appendChild(this.#tagElement)\n\n    this.#prompterContainerElement.appendChild(this.#prompterTextElement)\n    this.#wrapperElement.appendChild(this.#prompterContainerElement)\n\n    this.#wrapperElement.appendChild(this.#ellipsisElement)\n\n    this.#menuElement.appendChild(this.#convertElement)\n    this.#menuElement.appendChild(this.#copyElement)\n    this.#menuElement.appendChild(this.#deleteElement)\n    this.#menuElement.classList.add(\"close\")\n    this.#wrapperElement.appendChild(this.#menuElement)\n    this.#isMenuOpen = false\n\n    this.#candidatesElement.style.display = \"none\"\n    this.#wrapperElement.appendChild(this.#candidatesElement)\n    this.margin = margin\n    this.#addListeners()\n\n    this.resize()\n  }\n\n  #showCandidates = (target: HTMLElement) =>\n  {\n    this.#logger.info(\"showCandidates\", { target })\n    const wordId = parseInt(target.id.replace(\"word-\", \"\").replace(this.uuid, \"\"))\n    const words = this.jiix?.words as TJIIXWord[]\n    this.wordToChange = words[wordId]\n    if (this.wordToChange) {\n      this.wordToChange.id = wordId.toString()\n      this.#candidatesElement.innerHTML = \"\"\n      if (this.wordToChange?.candidates) {\n        this.#candidatesElement.style.display = \"flex\"\n        this.wordToChange.candidates.forEach((word, index) =>\n        {\n          if (this.wordToChange?.label === word) {\n            this.#candidatesElement.innerHTML += `<span id=\"cdt-${ index }${ this.uuid }\" class=\"selected-word\">${ word }</span>`\n          } else {\n            this.#candidatesElement.innerHTML += `<span id=\"cdt-${ index }${ this.uuid }\">${ word }</span>`\n          }\n        })\n\n        target.appendChild(this.#candidatesElement)\n      }\n    }\n  }\n  #hideCandidates(): void\n  {\n    this.#candidatesElement.style.display = \"none\"\n  }\n\n  #openMenu(): void\n  {\n    this.#menuElement.classList.add(\"open\")\n    this.#menuElement.classList.remove(\"close\")\n    this.#isMenuOpen = true\n  }\n  #closeMenu(): void\n  {\n    this.#menuElement.classList.add(\"close\")\n    this.#menuElement.classList.remove(\"open\")\n    this.#isMenuOpen = false\n  }\n\n  #onClickEllipsis = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickEllipsis\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n    this.#isMenuOpen ? this.#closeMenu() : this.#openMenu()\n    this.#hideCandidates()\n  }\n\n  #onClickConvert = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickConvert\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    this.editor.convert()\n    this.#closeMenu()\n  }\n\n  #createTextAreaElement(value: string): HTMLTextAreaElement\n  {\n    const isRTL = document.documentElement.getAttribute(\"dir\") === \"rtl\"\n    const textArea = document.createElement(\"textarea\")\n    textArea.style.fontSize = \"12pt\"\n    textArea.style.display = \"absolute\"\n    textArea.style[isRTL ? \"right\" : \"left\"] = \"-9999px\"\n    const yPosition = window.pageYOffset || document.documentElement.scrollTop\n    textArea.style.top = `${ yPosition }px`\n    textArea.setAttribute(\"readonly\", \"\")\n    textArea.value = value\n    return textArea\n  }\n\n  #selectText(textArea: HTMLTextAreaElement)\n  {\n    if (navigator.userAgent.match(/ipad|iphone/i)) {\n      const range = document.createRange()\n      range.selectNodeContents(textArea)\n      const selection = window.getSelection()\n      if (selection) {\n        selection.removeAllRanges()\n        selection.addRange(range)\n        textArea.setSelectionRange(0, 999999)\n      }\n    } else {\n      textArea.select()\n    }\n  }\n\n  #onClickCopy = async (evt: Event): Promise<void> =>\n  {\n    this.#logger.info(\"onClickCopy\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    try {\n      this.#closeMenu()\n      let message = \"Nothing to copy\"\n      if (this.#prompterTextElement.innerText) {\n        message = `\"${ this.#prompterTextElement.innerText }\" copied to clipboard`\n        const fakeEl = this.#createTextAreaElement(this.#prompterTextElement.innerText)\n        this.#prompterContainerElement.appendChild(fakeEl)\n        this.#selectText(fakeEl)\n        document.execCommand(\"copy\")\n        fakeEl.remove()\n      }\n      this.editor.event.emitNotif({ message, timeout: 1500 })\n    } catch (error) {\n      this.#logger.error(\"onClickCopy\", error)\n      this.editor.event.emitError(error as Error)\n    }\n  }\n\n  #onClickDelete = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickDelete\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    this.editor.clear()\n    this.#closeMenu()\n  }\n\n  #onClickCandidate = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickCandidate\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    const target = evt.target as HTMLElement\n    const candidate = target.innerText\n    if (this.jiix?.words && candidate !== this.wordToChange?.label && this.wordToChange?.candidates?.includes(candidate)) {\n      this.jiix.words[parseInt(this.wordToChange?.id as string)].label = candidate\n      this.editor.import(new Blob([JSON.stringify(this.jiix)], { type: ExportType.JIIX }), ExportType.JIIX)\n    }\n    this.#candidatesElement.style.display = \"none\"\n  }\n\n  #onClickPrompter = (evt: Event): void =>\n  {\n    this.#logger.info(\"onClickPrompter\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    this.#closeMenu()\n    const target = evt.target as HTMLElement\n    if (target.id !== this.#prompterTextElement.id) {\n      this.#showCandidates(target)\n    } else {\n      this.#hideCandidates()\n    }\n  }\n\n  #stopPropagation = (evt: Event) =>\n  {\n    evt.preventDefault()\n    evt.stopPropagation()\n  }\n\n  #onClickOutSide = () =>\n  {\n    this.#hideCandidates()\n    this.#closeMenu()\n  }\n\n  #addListeners(): void\n  {\n    this.#smartGuideElement.addEventListener(\"pointerdown\", this.#stopPropagation.bind(this))\n    this.#ellipsisElement.addEventListener(\"pointerdown\", this.#onClickEllipsis.bind(this))\n    this.#convertElement.addEventListener(\"pointerdown\", this.#onClickConvert.bind(this))\n    this.#copyElement.addEventListener(\"pointerdown\", this.#onClickCopy.bind(this))\n    this.#deleteElement.addEventListener(\"pointerdown\", this.#onClickDelete.bind(this))\n    this.#prompterTextElement.addEventListener(\"pointerdown\", this.#onClickPrompter.bind(this))\n    this.#candidatesElement.addEventListener(\"pointerdown\", this.#onClickCandidate.bind(this))\n    document.addEventListener(\"pointerdown\", this.#onClickOutSide.bind(this))\n  }\n\n  #removeListeners(): void\n  {\n    this.#smartGuideElement.addEventListener(\"pointerdown\", this.#stopPropagation)\n    this.#ellipsisElement.removeEventListener(\"pointerdown\", this.#onClickEllipsis)\n    this.#convertElement.removeEventListener(\"pointerdown\", this.#onClickConvert)\n    this.#copyElement.removeEventListener(\"pointerdown\", this.#onClickCopy)\n    this.#deleteElement.removeEventListener(\"pointerdown\", this.#onClickDelete)\n    this.#prompterTextElement.removeEventListener(\"pointerdown\", this.#onClickPrompter)\n    this.#candidatesElement.removeEventListener(\"pointerdown\", this.#onClickCandidate)\n    document.removeEventListener(\"pointerdown\", this.#onClickOutSide)\n  }\n\n  resize(): void\n  {\n    this.#logger.info(\"resize\")\n    const marginLeft = convertMillimeterToPixel(this.margin.left)\n    const marginRight = convertMillimeterToPixel(this.margin.right)\n    this.#wrapperElement.style.marginLeft = `${ marginLeft }px`\n    this.#wrapperElement.style.marginRight = `${ marginRight }px`\n  }\n\n  update(exports: TJIIXExport): void\n  {\n    this.#logger.info(\"update\", { exports })\n    this.jiix = exports\n    const createWordSpan = (index: number, word?: TJIIXWord) =>\n    {\n      const span = document.createElement(\"span\")\n      span.id = `word-${ index }${ this.uuid }`\n      if (word) {\n        span.textContent = word.label\n      } else {\n        span.innerHTML = \"&nbsp;\"\n      }\n      this.#logger.debug(\"update\", { span })\n      return span\n    }\n\n    const populatePrompter = () =>\n    {\n      this.#logger.info(\"populatePrompter\")\n      this.#prompterTextElement.innerHTML = \"\"\n      if (this.jiix?.words) {\n        const words = this.jiix.words as TJIIXWord[]\n        const myFragment = document.createDocumentFragment()\n        words.forEach((word, index) =>\n        {\n          if (word.label === \" \" || word.label.includes(\"\\n\")) {\n            myFragment.appendChild(createWordSpan(index))\n          } else if (index !== words.length - 1) {\n            myFragment.appendChild(createWordSpan(index, word))\n          } else {\n            this.#prompterTextElement.appendChild(myFragment)\n            if (this.lastWord) {\n              this.lastWord = word\n            }\n            const span = createWordSpan(index, word)\n\n            if ((this.lastWord?.candidates !== word.candidates) && (this.lastWord?.label !== word.label)) {\n              this.lastWord = word\n            }\n            if (this.wordToChange?.id === index.toString()) {\n              span.classList.add(\"modified-word\")\n              this.wordToChange = undefined\n            }\n            else {\n              span.classList.add(\"added-word\")\n            }\n            this.#prompterTextElement.appendChild(span)\n            this.#prompterContainerElement.scrollLeft = span.offsetLeft\n            this.#logger.debug(\"update => populatePrompter\", { span, lastWord: this.lastWord })\n          }\n        })\n      }\n    }\n    populatePrompter()\n    if (this.jiix?.words?.length) {\n      this.#ellipsisElement.style.setProperty(\"pointer-events\", \"auto\")\n    }\n    else {\n      this.#ellipsisElement.style.setProperty(\"pointer-events\", \"none\")\n    }\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    this.#prompterTextElement.innerHTML = \"\"\n    this.#candidatesElement.innerHTML = \"\"\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\")\n    this.#removeListeners()\n    this.#smartGuideElement.remove()\n  }\n}","import { DefaultGrabberConfiguration, TGrabberConfiguration } from \"../grabber\"\nimport { DefaultHistoryConfiguration, THistoryConfiguration } from \"../history\"\nimport { DefaultLoggerConfiguration, TLoggerConfiguration } from \"../logger\"\nimport { DefaultRecognizerWebSocketSSRConfiguration, TRecognizerWebSocketSSRRecognitionConfiguration, TRecognizerWebSocketSSRConfiguration, RecognizerWebSocketSSRConfiguration, TServerWebsocketConfiguration } from \"../recognizer\"\nimport { DefaultRendererConfiguration, TRendererConfiguration } from \"../renderer\"\nimport { DefaultTheme, TPenStyle, TTheme } from \"../style\"\nimport { mergeDeep, PartialDeep } from \"../utils\"\nimport { TEditorConfiguration } from \"./AbstractEditor\"\nimport { DefaulTEditorTriggerConfiguration, TEditorTriggerConfiguration } from \"./EditorTriggerConfiguration\"\n\n/**\n * @group Editor\n */\nexport type TInteractiveInkSSREditorConfiguration = TEditorConfiguration & TRecognizerWebSocketSSRConfiguration & {\n  rendering: TRendererConfiguration\n  smartGuide: {\n    enable: boolean\n  },\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TPenStyle,\n  penStyleClasses?: string\n  theme: TTheme\n}\n\n/**\n * @group Editor\n * @source\n */\nexport const DefaultInteractiveInkSSREditorConfiguration: TInteractiveInkSSREditorConfiguration = {\n  server: DefaultRecognizerWebSocketSSRConfiguration.server,\n  recognition: DefaultRecognizerWebSocketSSRConfiguration.recognition,\n  rendering: DefaultRendererConfiguration,\n  smartGuide: {\n    enable: true\n  },\n  grabber: DefaultGrabberConfiguration,\n  triggers: DefaulTEditorTriggerConfiguration,\n  \"undo-redo\": DefaultHistoryConfiguration,\n  logger: DefaultLoggerConfiguration,\n  penStyle: {},\n  theme: DefaultTheme\n}\n\n/**\n * @group Editor\n */\nexport class InteractiveInkSSREditorConfiguration implements TInteractiveInkSSREditorConfiguration\n{\n  server: TServerWebsocketConfiguration\n  recognition: TRecognizerWebSocketSSRRecognitionConfiguration\n  rendering: TRendererConfiguration\n  smartGuide: {\n    enable: boolean\n  }\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TPenStyle\n  penStyleClasses?: string\n  theme: TTheme\n\n  constructor(configuration?: PartialDeep<TInteractiveInkSSREditorConfiguration>)\n  {\n    const { server, recognition } = new RecognizerWebSocketSSRConfiguration(configuration)\n    this.server = server\n    this.recognition = recognition\n\n    this.rendering = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.rendering, configuration?.rendering)\n    this.smartGuide = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.smartGuide, configuration?.smartGuide)\n    this[\"undo-redo\"] = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration[\"undo-redo\"], configuration?.[\"undo-redo\"])\n    this.grabber = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.grabber, configuration?.grabber)\n    this.triggers = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.triggers, configuration?.triggers)\n    this.logger = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.logger, configuration?.logger)\n    this.penStyle = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.penStyle, configuration?.penStyle)\n    this.penStyleClasses = configuration?.penStyleClasses || this.penStyleClasses\n    this.theme = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.theme, configuration?.theme)\n\n    if (this.recognition.type !== \"TEXT\") {\n      this.smartGuide.enable = false\n    }\n    if (this.smartGuide.enable && !this.recognition.text.mimeTypes.includes(\"application/vnd.myscript.jiix\")) {\n      this.recognition.text.mimeTypes.push(\"application/vnd.myscript.jiix\")\n    }\n\n  }\n}\n","import { EditorTool } from \"../Constants\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\nimport { Model, TExport, TJIIXExport } from \"../model\"\nimport { TRecognizerWebSocketSSRMessageSVGPatch, RecognizerWebSocketSSR, DefaultMarginConfiguration, TConverstionState, TMarginConfiguration } from \"../recognizer\"\nimport { InteractiveInkSSRSmartGuide } from \"../smartguide\"\nimport { InteractiveInkSSRSVGRenderer } from \"../renderer\"\nimport { DefaultPenStyle, StyleManager, TPenStyle, TTheme } from \"../style\"\nimport { HistoryManager, THistoryContext } from \"../history\"\nimport { DeferredPromise, PartialDeep } from \"../utils\"\nimport { Stroke, TStroke, TPointer } from \"../symbol\"\nimport { AbstractEditor, EditorOptionsBase } from \"./AbstractEditor\"\nimport { InteractiveInkSSREditorConfiguration } from \"./InteractiveInkSSREditorConfiguration\"\n\n/**\n * @group Editor\n */\nexport type TInteractiveInkSSREditorOptions = PartialDeep<EditorOptionsBase &\n  {\n    configuration: InteractiveInkSSREditorConfiguration\n  }> &\n  {\n    override?: {\n      grabber?: PointerEventGrabber\n      recognizer?: RecognizerWebSocketSSR\n    }\n  }\n\n/**\n * @group Editor\n */\nexport class InteractiveInkSSREditor extends AbstractEditor\n{\n  #configuration: InteractiveInkSSREditorConfiguration\n  #model: Model\n  #resizeTimer?: ReturnType<typeof setTimeout>\n\n  smartGuide?: InteractiveInkSSRSmartGuide\n  grabber: PointerEventGrabber\n  renderer: InteractiveInkSSRSVGRenderer\n  recognizer: RecognizerWebSocketSSR\n  history: HistoryManager\n  styleManager: StyleManager\n  #tool: EditorTool = EditorTool.Write\n\n  constructor(rootElement: HTMLElement, options?: TInteractiveInkSSREditorOptions)\n  {\n    super(rootElement, options)\n\n    this.#configuration = new InteractiveInkSSREditorConfiguration(options?.configuration)\n    this.styleManager = new StyleManager(options?.configuration?.penStyle, options?.configuration?.theme)\n\n    if (options?.override?.grabber) {\n      const CustomGrabber = options.override.grabber as unknown as typeof PointerEventGrabber\n      this.grabber = new CustomGrabber(this.#configuration.grabber)\n    }\n    else {\n      this.grabber = new PointerEventGrabber(this.#configuration.grabber)\n    }\n\n    if (options?.override?.recognizer) {\n      const CustomRecognizer = options.override.recognizer as unknown as typeof RecognizerWebSocketSSR\n      this.recognizer = new CustomRecognizer(this.#configuration)\n    }\n    else {\n      this.recognizer = new RecognizerWebSocketSSR(this.#configuration)\n    }\n\n    this.renderer = new InteractiveInkSSRSVGRenderer(this.#configuration.rendering)\n\n    this.tool = EditorTool.Write\n    this.#model = new Model()\n    this.history = new HistoryManager(this.#configuration[\"undo-redo\"], this.event)\n  }\n\n  get initializationPromise(): Promise<void>\n  {\n    return this.recognizer.initialized.promise\n  }\n\n  get tool(): EditorTool\n  {\n    return this.#tool\n  }\n  set tool(i: EditorTool)\n  {\n    this.#tool = i\n    this.setCursorStyle()\n  }\n\n  protected setCursorStyle(): void\n  {\n    switch (this.tool) {\n      case EditorTool.Erase:\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.add(\"erase\")\n        break\n      default:\n        this.layers.root.classList.add(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        break\n    }\n  }\n\n  get model(): Model\n  {\n    return this.#model\n  }\n\n  get configuration(): InteractiveInkSSREditorConfiguration\n  {\n    return this.#configuration\n  }\n\n  get currentPenStyle(): TPenStyle\n  {\n    return this.styleManager.currentPenStyle\n  }\n\n  get penStyle(): TPenStyle\n  {\n    return this.styleManager.penStyle\n  }\n  set penStyle(penStyle: PartialDeep<TPenStyle>)\n  {\n    this.logger.info(\"setPenStyle\", { penStyle })\n    this.styleManager.setPenStyle(penStyle)\n    this.logger.debug(\"setPenStyle\", this.styleManager.penStyle)\n    this.recognizer.setPenStyle(this.styleManager.penStyle)\n  }\n\n  get penStyleClasses(): string\n  {\n    return this.styleManager.penStyleClasses\n  }\n  set penStyleClasses(penClass: string)\n  {\n    this.logger.info(\"setPenStyleClasses\", { penClass })\n    this.styleManager.setPenStyleClasses(penClass)\n    this.logger.debug(\"setPenStyleClasses\", this.styleManager.penStyleClasses)\n    this.recognizer.setPenStyleClasses(this.styleManager.penStyleClasses)\n  }\n\n  get theme(): TTheme\n  {\n    return this.styleManager.theme\n  }\n  set theme(theme: PartialDeep<TTheme>)\n  {\n    this.logger.info(\"setTheme\", { theme })\n    this.styleManager.setTheme(theme)\n    this.logger.debug(\"setTheme\", this.styleManager.theme)\n    this.recognizer.setTheme(this.styleManager.theme)\n  }\n\n  protected async syncStyle(): Promise<void>\n  {\n    await Promise.all([\n      this.recognizer.setPenStyle(this.styleManager.penStyle),\n      this.recognizer.setPenStyleClasses(this.styleManager.penStyleClasses),\n      this.recognizer.setTheme(this.styleManager.theme)\n    ])\n  }\n\n  protected onExport(exports: TExport): void\n  {\n    this.logger.debug(\"onExport\", { exports })\n    if (this.smartGuide && exports?.[\"application/vnd.myscript.jiix\"]) {\n      const jjix = exports[\"application/vnd.myscript.jiix\"] as TJIIXExport\n      this.smartGuide.update(jjix)\n    }\n    this.model.mergeExport(exports)\n    this.event.emitExported(exports)\n  }\n\n  protected onPointerDown(info: PointerInfo): void\n  {\n    this.logger.info(\"onPointerDown\", { tool: this.tool, info })\n    const style: TPenStyle = Object.assign({}, this.theme?.ink, this.currentPenStyle)\n    this.model.initCurrentStroke(info.pointer, this.tool === EditorTool.Erase ? \"eraser\" : info.pointerType, style)\n    this.drawCurrentStroke()\n  }\n\n  protected onPointerMove(info: PointerInfo): void\n  {\n    this.logger.info(\"onPointerMove\", { tool: this.tool, info })\n    this.model.appendToCurrentStroke(info.pointer)\n    this.drawCurrentStroke()\n  }\n\n  protected async onPointerUp(info: PointerInfo): Promise<void>\n  {\n    try {\n      this.logger.info(\"onPointerUp\", { tool: this.tool, info })\n      this.model.endCurrentStroke(info.pointer)\n      await this.synchronizeModelWithBackend()\n    } catch (error) {\n      this.event.emitError(error as Error)\n    }\n  }\n\n  protected onSVGPatch(evt: TRecognizerWebSocketSSRMessageSVGPatch): void\n  {\n    this.logger.info(\"onSVGPatch\", { evt })\n    this.renderer.updatesLayer(evt.layer, evt.updates)\n  }\n\n  protected initializeSmartGuide(): void\n  {\n    this.smartGuide?.destroy()\n    this.logger.info(\"initializeSmartGuide\", { smartGuide: this.configuration.smartGuide })\n    if (this.configuration.smartGuide.enable) {\n      this.smartGuide = new InteractiveInkSSRSmartGuide(this)\n      let margin: TMarginConfiguration = DefaultMarginConfiguration\n      switch (this.configuration.recognition.type) {\n        case \"TEXT\":\n          margin = this.configuration.recognition.text.margin\n          break\n        case \"MATH\":\n          margin = this.configuration.recognition.math.margin\n          break\n      }\n      this.smartGuide.init(this.layers.ui.root, margin)\n    }\n  }\n\n  protected onContentChanged(undoRedoContext: THistoryContext): void\n  {\n    this.history.context = undoRedoContext\n    this.event.emitChanged(undoRedoContext)\n  }\n\n  protected onError(error: Error): void\n  {\n    this.layers.showMessageError(error)\n    this.event.emitError(error)\n  }\n\n  async initialize(): Promise<void>\n  {\n    try {\n      this.logger.info(\"initialize\")\n      this.layers.render()\n      this.layers.showLoader()\n\n      const compStyles = window.getComputedStyle(this.layers.root)\n      this.model.width = Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.#configuration.rendering.minWidth)\n      this.model.height = Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.#configuration.rendering.minHeight)\n      this.history.push(this.model)\n      this.renderer.init(this.layers.rendering)\n\n      this.grabber.attach(this.layers.rendering)\n      this.grabber.onPointerDown = this.onPointerDown.bind(this)\n      this.grabber.onPointerMove = this.onPointerMove.bind(this)\n      this.grabber.onPointerUp = this.onPointerUp.bind(this)\n\n      this.initializeSmartGuide()\n\n      if(!this.recognizer.configuration.server.version) {\n        await this.loadInfo(this.configuration.server)\n        this.recognizer.configuration.server.version = this.info!.version\n      }\n      await this.recognizer.init(this.model.height, this.model.width)\n      this.recognizer.event.addExportedListener(this.onExport.bind(this))\n      this.recognizer.event.addSVGPatchListener(this.onSVGPatch.bind(this))\n      this.recognizer.event.addContentChangedListener(this.onContentChanged.bind(this))\n      this.recognizer.event.addIdleListener(this.event.emitIdle.bind(this.event))\n      this.recognizer.event.addErrorListener(this.onError.bind(this))\n\n      await this.syncStyle()\n    } catch (error) {\n      this.logger.error(\"initialize\", error)\n      this.layers.showMessageError(error as Error)\n      throw error\n    }\n    finally {\n      this.logger.debug(\"initialize\", \"finally\")\n      this.layers.hideLoader()\n      this.layers.updateState(true)\n    }\n  }\n\n  drawCurrentStroke(): void\n  {\n    this.logger.debug(\"drawCurrentStroke\", { stroke: this.model.currentSymbol })\n    const currentSymbol = this.model.currentSymbol as Stroke\n    if (currentSymbol) {\n      this.renderer.drawPendingStroke(currentSymbol)\n    }\n  }\n\n  async synchronizeModelWithBackend(): Promise<Model>\n  {\n    this.logger.info(\"synchronizeModelWithBackend\")\n    if (this.#configuration.triggers.exportContent !== \"DEMAND\") {\n      const unsentStrokes = this.model.extractUnsentStrokes()\n      this.model.updatePositionSent()\n      this.history.push(this.model)\n      this.renderer.clearErasingStrokes()\n      const exports = await this.recognizer.addStrokes(unsentStrokes)\n      this.model.mergeExport(exports)\n      this.history.updateStack(this.model)\n    }\n    this.logger.debug(\"synchronizeModelWithBackend\", this.model)\n    return this.model\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    return this.recognizer.waitForIdle()\n  }\n\n  async export(mimeTypes?: string[]): Promise<Model>\n  {\n    this.logger.info(\"export\", { mimeTypes })\n    try {\n      if (this.#configuration.triggers.exportContent === \"DEMAND\") {\n        const unsentStrokes = this.model.extractUnsentStrokes()\n        this.history.push(this.model)\n        this.history.stack.push(this.model.clone())\n        this.model.updatePositionSent()\n        const exports = await this.recognizer.addStrokes(unsentStrokes)\n        this.model.updatePositionReceived()\n        this.model.mergeExport(exports)\n        this.logger.debug(\"export\", this.model)\n      } else {\n        return await this.recognizer.export(this.model, mimeTypes)\n      }\n    } catch (error) {\n      this.logger.error(\"export\", { error })\n      this.event.emitError(error as Error)\n      return Promise.reject(error)\n    }\n    return this.model\n  }\n\n  async convert(params?: { conversionState?: TConverstionState }): Promise<Model>\n  {\n    this.logger.info(\"convert\", { params })\n    this.history.push(this.model)\n    this.history.stack.push(this.model.clone())\n    this.#model = await this.recognizer.convert(this.model, params?.conversionState)\n    this.logger.debug(\"convert\", this.model)\n    this.history.push(this.model)\n    this.event.emitConverted(this.model.converts as TExport)\n    return this.model\n  }\n\n  async import(data: Blob | string | TJIIXExport, mimeType?: string): Promise<Model>\n  {\n    let blobToImport: Blob\n    if (data instanceof Blob) {\n      blobToImport = data\n    }\n    else if (typeof data === \"string\") {\n      blobToImport = new Blob([data])\n    }\n    else {\n      blobToImport = new Blob([JSON.stringify(data)])\n    }\n    this.logger.info(\"import\", { data, mimeType })\n    this.history.stack.push(this.model.clone())\n    this.#model = await this.recognizer.import(this.model, blobToImport, mimeType)\n    this.history.push(this.model)\n    this.event.emitImported(this.model.exports as TExport)\n    return this.model\n  }\n\n  async importPointEvents(strokes: PartialDeep<TStroke>[]): Promise<Model>\n  {\n    this.logger.info(\"importPointEvents\", { strokes })\n    const errors: string[] = []\n    const strokesToImport = strokes.map((s, strokeIndex) =>\n    {\n      const str = new Stroke(s.style || DefaultPenStyle, s.pointerType)\n      if (s.id) str.id = s.id\n      if (s.pointerType) str.pointerType = s.pointerType\n      if (!s.pointers?.length) {\n        errors.push(`stroke ${ strokeIndex + 1 } has not pointers`)\n      }\n      let flag = true\n      s.pointers?.forEach((pp, pIndex) =>\n      {\n        flag = true\n        if (!pp) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no pointer at ${ pIndex }`)\n          return\n        }\n        const pointer: TPointer = {\n          p: pp.p || 1,\n          t: pp.t || pIndex,\n          x: 0,\n          y: 0\n        }\n        if (pp?.x == undefined || pp?.x == null) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no x at pointer at ${ pIndex }`)\n          flag = false\n        }\n        else {\n          pointer.x = pp.x\n        }\n        if (pp?.y == undefined || pp?.y == null) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no y at pointer at ${ pIndex }`)\n          flag = false\n        }\n        else {\n          pointer.y = pp.y\n        }\n        if (flag) {\n          str.pointers.push(pointer)\n        }\n      })\n      return str\n    })\n    if (errors.length) {\n      this.event.emitError(new Error(errors.join(\"\\n\")))\n    }\n    strokesToImport.map(s => this.model.addStroke(s))\n    const exportPoints = await this.recognizer.importPointEvents(strokesToImport)\n    this.model.mergeExport(exportPoints)\n    this.event.emitImported(this.model.exports as TExport)\n    this.logger.debug(\"importPointEvents\", this.model)\n    return this.model\n  }\n\n  async resize({ height, width }: { height?: number, width?: number } = {}): Promise<void>\n  {\n    this.logger.info(\"resize\", { height, width })\n    const deferredResize = new DeferredPromise<Model>()\n    const compStyles = window.getComputedStyle(this.layers.root)\n    this.model.height = height || Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.configuration.rendering.minHeight)\n    this.model.width = width || Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.configuration.rendering.minWidth)\n    const clonedModel = this.model.clone()\n    this.renderer.resize(clonedModel)\n    clearTimeout(this.#resizeTimer)\n    this.#resizeTimer = setTimeout(async () =>\n    {\n      try {\n        const resizeModel = await this.recognizer.resize(clonedModel)\n        deferredResize.resolve(resizeModel)\n      } catch (error) {\n        this.logger.error(\"resize\", { height, width, error })\n        deferredResize.reject(error as Error)\n      }\n    }, this.#configuration.triggers.resizeTriggerDelay)\n\n    this.#model = await deferredResize.promise\n    this.smartGuide?.resize()\n    this.event.emitExported(this.model.exports as TExport)\n    this.logger.debug(\"resize\", this.model)\n  }\n\n  async undo(): Promise<Model>\n  {\n    this.logger.info(\"undo\")\n    if (this.history.context.canUndo) {\n      this.#model = this.history.undo() as Model\n      return this.recognizer.undo(this.model)\n    }\n    else {\n      throw new Error(\"Undo not allowed\")\n    }\n  }\n\n  async redo(): Promise<Model>\n  {\n    this.logger.info(\"redo\")\n    if (this.history.context.canRedo) {\n      this.#model = this.history.redo() as Model\n      this.logger.debug(\"undo\", this.#model)\n      return this.recognizer.redo(this.model)\n    }\n    else {\n      throw new Error(\"Redo not allowed\")\n    }\n  }\n\n  async clear(): Promise<void>\n  {\n    this.logger.info(\"clear\")\n    this.model.clear()\n    this.history.push(this.model)\n    await this.recognizer.clear(this.model)\n    this.event.emitCleared()\n  }\n\n  async destroy(): Promise<void>\n  {\n    this.logger.info(\"destroy\")\n    this.event.removeAllListeners()\n    this.grabber.detach()\n    this.layers.destroy()\n    this.renderer.destroy()\n    this.recognizer.destroy()\n    this.smartGuide?.destroy()\n    return Promise.resolve()\n  }\n}\n","import { DefaultGrabberConfiguration, TGrabberConfiguration } from \"../grabber\"\nimport { DefaultHistoryConfiguration, THistoryConfiguration } from \"../history\"\nimport { DefaultLoggerConfiguration, TLoggerConfiguration } from \"../logger\"\nimport { DefaultRecognizerHTTPV2Configuration, RecognizerHTTPV2Configuration, TRecognizerHTTPV2Configuration, TRecognizerHTTPV2RecognitionConfiguration, TServerHTTPConfiguration } from \"../recognizer\"\nimport { DefaultIIRendererConfiguration, TIIRendererConfiguration } from \"../renderer\"\nimport { DefaultStyle, TStyle } from \"../style\"\nimport { convertPixelToMillimeter, mergeDeep, PartialDeep } from \"../utils\"\nimport { TEditorConfiguration } from \"./AbstractEditor\"\nimport { DefaulTEditorTriggerConfiguration, TEditorTriggerConfiguration } from \"./EditorTriggerConfiguration\"\n\n\n/**\n * @group Editor\n */\nexport type TInkEditorConfiguration = TEditorConfiguration & TRecognizerHTTPV2Configuration & {\n  rendering: TIIRendererConfiguration\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TStyle\n}\n\n/**\n * @group Editor\n * @source\n */\nexport const DefaultInkEditorConfiguration: TInkEditorConfiguration = {\n  server: DefaultRecognizerHTTPV2Configuration.server,\n  recognition: DefaultRecognizerHTTPV2Configuration.recognition,\n  rendering: DefaultIIRendererConfiguration,\n  grabber: DefaultGrabberConfiguration,\n  triggers: DefaulTEditorTriggerConfiguration,\n  \"undo-redo\": DefaultHistoryConfiguration,\n  logger: DefaultLoggerConfiguration,\n  penStyle: DefaultStyle,\n}\n\n/**\n * @group Editor\n */\nexport class InkEditorConfiguration implements TInkEditorConfiguration\n{\n  server: TServerHTTPConfiguration\n  recognition: TRecognizerHTTPV2RecognitionConfiguration\n  rendering: TIIRendererConfiguration\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TStyle\n\n  constructor(configuration?: PartialDeep<InkEditorConfiguration>)\n  {\n    const { server, recognition } = new RecognizerHTTPV2Configuration(configuration)\n    this.server = server\n    this.recognition = recognition\n    this.rendering = mergeDeep({}, DefaultInkEditorConfiguration.rendering, configuration?.rendering)\n    this.recognition.text.guides.enable = this.rendering.guides.enable\n    if (this.rendering.guides.enable)\n    {\n      this.recognition.text.guides[\"line-gap-mm\"] = convertPixelToMillimeter(this.rendering.guides.gap)\n    }\n    this.grabber = mergeDeep({}, DefaultInkEditorConfiguration.grabber, configuration?.grabber)\n    this[\"undo-redo\"] = mergeDeep({}, DefaultInkEditorConfiguration[\"undo-redo\"], configuration?.[\"undo-redo\"])\n    this.triggers = mergeDeep({}, DefaultInkEditorConfiguration.triggers, configuration?.triggers)\n    this.logger = mergeDeep({}, DefaultInkEditorConfiguration.logger, configuration?.logger)\n    this.penStyle = mergeDeep({}, DefaultInkEditorConfiguration.penStyle, configuration?.penStyle)\n  }\n}\n","import { InkEditor } from \"../editor\";\nimport { PointerInfo } from \"../grabber\";\nimport { IModel } from \"../model\";\nimport { TStyle } from \"../style\";\nimport { IIStroke, SymbolType, TIISymbol, TPointer } from \"../symbol\";\nimport { DeferredPromise } from \"../utils\";\nimport { AbstractWriterManager } from \"./AbstractWriterManager\";\n\nexport class IWriterManager extends AbstractWriterManager {\n  editor: InkEditor\n  #exportTimer?: ReturnType<typeof setTimeout>\n\n  constructor(editor: InkEditor) {\n    super(editor)\n    this.editor = editor\n  }\n\n  get model(): IModel {\n    return this.editor.model\n  }\n\n  protected createCurrentSymbol(pointer: TPointer, style: TStyle, pointerType: string): TIISymbol {\n    this.model.currentStroke = new IIStroke(style, pointerType)\n    this.model.currentStroke.addPointer(pointer)\n    return this.model.currentStroke\n  }\n\n  protected updateCurrentSymbol(pointer: TPointer): IIStroke {\n    if (this.model.currentStroke?.type === SymbolType.Stroke) {\n      this.model.currentStroke.addPointer(pointer)\n    }\n    return this.model.currentStroke!\n  }\n\n  async end(info: PointerInfo): Promise<void> {\n    const localPointer = info.pointer\n    const localSymbol = this.updateCurrentSymbol(localPointer)\n    this.model.currentStroke = undefined\n    this.renderer.drawSymbol(localSymbol)\n    this.model.addStroke(localSymbol)\n    this.editor.history.push(this.model, { added: [localSymbol] })\n    const deferred = new DeferredPromise<void>()\n\n    if (this.editor.configuration.triggers.exportContent !== \"DEMAND\") {\n      clearTimeout(this.#exportTimer)\n      this.#exportTimer = setTimeout(async () => {\n        this.editor.export()\n      }, this.editor.configuration.triggers.exportContent === \"QUIET_PERIOD\" ? this.editor.configuration.triggers.exportContentDelay : 0)\n    } else {\n      deferred.resolve()\n    }\n    return deferred.promise\n\n  }\n}\n","import { EditorTool } from \"../Constants\"\nimport { PointerEventGrabber } from \"../grabber\"\nimport { IModel, TExport, TExportV2 } from \"../model\"\nimport { RecognizerHTTPV2 } from \"../recognizer\"\nimport { SVGRenderer } from \"../renderer\"\nimport { TStyle } from \"../style\"\nimport { IHistoryManager } from \"../history\"\nimport { PartialDeep } from \"../utils\"\nimport { AbstractEditor, EditorOptionsBase } from \"./AbstractEditor\"\nimport { InkEditorConfiguration, TInkEditorConfiguration } from \"./InkEditorConfiguration\"\nimport { IWriterManager } from \"../manager/IWriterManager\"\nimport { IDebugSVGManager, EraseManager } from \"../manager\"\n\n/**\n * @group Editor\n */\nexport type TInkEditorOptions = PartialDeep<EditorOptionsBase &\n{\n  configuration: TInkEditorConfiguration\n}> &\n{\n  override?: {\n    grabber?: PointerEventGrabber\n    recognizer?: RecognizerHTTPV2\n  }\n}\n\n/**\n * @group Editor\n */\nexport class InkEditor extends AbstractEditor\n{\n  #configuration: InkEditorConfiguration\n  #model: IModel\n  #penStyle: TStyle\n  renderer: SVGRenderer\n  recognizer: RecognizerHTTPV2\n  history: IHistoryManager\n  writer: IWriterManager\n  eraser: EraseManager\n  debugger: IDebugSVGManager\n  #tool: EditorTool = EditorTool.Write\n\n  constructor(rootElement: HTMLElement, options?: TInkEditorOptions)\n  {\n    super(rootElement, options)\n\n    this.#configuration = new InkEditorConfiguration(options?.configuration)\n\n    this.#penStyle = Object.assign({}, this.#configuration.penStyle)\n\n    if (options?.override?.recognizer) {\n      const CustomRecognizer = options.override.recognizer as unknown as typeof RecognizerHTTPV2\n      this.recognizer = new CustomRecognizer(this.#configuration)\n    }\n    else {\n      this.recognizer = new RecognizerHTTPV2(this.#configuration)\n    }\n    this.renderer = new SVGRenderer(this.#configuration.rendering)\n\n    this.#model = new IModel()\n    this.writer = new IWriterManager(this)\n    this.eraser = new EraseManager(this)\n    this.debugger = new IDebugSVGManager(this)\n    this.tool = EditorTool.Write\n    this.history = new IHistoryManager(this.#configuration[\"undo-redo\"], this.event)\n  }\n\n  get penStyle(): TStyle\n  {\n    return this.#penStyle\n  }\n  set penStyle(penStyle: PartialDeep<TStyle>)\n  {\n    this.logger.info(\"set penStyle\", { penStyle })\n    this.#penStyle = Object.assign({}, this.#penStyle, penStyle)\n  }\n\n  get initializationPromise(): Promise<void>\n  {\n    return Promise.resolve()\n  }\n\n  get tool(): EditorTool\n  {\n    return this.#tool\n  }\n  set tool(i: EditorTool)\n  {\n    this.#tool = i\n    this.writer.detach()\n    this.eraser.detach()\n\n    switch (this.tool) {\n      case EditorTool.Erase:\n        this.eraser.attach(this.layers.root)\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.add(\"erase\")\n        break\n      default:\n        this.writer.attach(this.layers.root)\n        this.layers.root.classList.add(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        break\n    }\n\n  }\n\n  get model(): IModel\n  {\n    return this.#model\n  }\n\n  get configuration(): InkEditorConfiguration\n  {\n    return this.#configuration\n  }\n\n  async initialize(): Promise<void>\n  {\n    try {\n      this.logger.info(\"initialize\")\n      this.layers.render()\n      this.layers.showLoader()\n      this.tool = EditorTool.Write\n      this.renderer.init(this.layers.rendering)\n\n      const compStyles = window.getComputedStyle(this.layers.root)\n      this.model.width = Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.#configuration.rendering.minWidth)\n      this.model.height = Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.#configuration.rendering.minHeight)\n      this.model.rowHeight = this.configuration.rendering.guides.gap\n      this.history.init(this.model)\n\n      if (!this.recognizer.configuration.server.version) {\n        await this.loadInfo(this.configuration.server)\n        this.recognizer.configuration.server.version = this.info!.version\n      }\n    } catch (error) {\n      this.logger.error(\"initialize\", error)\n      this.layers.showMessageError(error as Error)\n      throw error\n    }\n    finally {\n      this.logger.debug(\"initialize\", \"finally\")\n      this.layers.hideLoader()\n      this.layers.updateState(true)\n    }\n  }\n\n  updateSymbolsStyle(symbolIds: string[], style: PartialDeep<TStyle>): void\n  {\n    this.logger.info(\"updateSymbolsStyle\", { symbolIds, style })\n    const symbolIdSet = new Set(symbolIds)\n    this.model.strokes.forEach(s =>\n    {\n      if (symbolIdSet.has(s.id)) {\n        s.style = Object.assign({}, s.style, style)\n        this.renderer.drawSymbol(s)\n        this.model.updateStroke(s)\n        s.modificationDate = Date.now()\n      }\n    })\n  }\n\n  async export(requestedMimeTypes?: string[]): Promise<TExportV2>\n  {\n    try {\n      this.logger.info(\"export\")\n      const currentModel = this.model.clone()\n\n      const exports = await this.recognizer.send(currentModel.strokes, requestedMimeTypes)\n      currentModel.mergeExport(exports)\n      if (this.model.modificationDate === currentModel.modificationDate) {\n        this.model.exports = currentModel.exports\n      }\n      this.history.updateModelStack(currentModel)\n      this.event.emitExported(this.model.exports || {})\n      if (this.debugger.recognitionBoxItemsVisibility) {\n        this.debugger.debugRecognitionBoxItems()\n      }\n      if (this.debugger.recognitionBoxVisibility) {\n        this.debugger.debugRecognitionBox()\n      }\n      return exports\n    } catch (error) {\n      this.logger.error(\"export\", error)\n      this.layers.showMessageError(error as Error)\n      this.event.emitError(error as Error)\n      throw error\n    }\n  }\n\n  async resize({ height, width }: { height?: number, width?: number } = {}): Promise<void>\n  {\n    this.logger.info(\"resize\", { height, width })\n    const compStyles = window.getComputedStyle(this.layers.root)\n    this.model.height = height || Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.configuration.rendering.minHeight)\n    this.model.width = width || Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.configuration.rendering.minWidth)\n    this.renderer.resize(this.model.height, this.model.width)\n    this.logger.debug(\"resize\", { model: this.model })\n    this.event.emitExported(this.model.exports || {})\n  }\n\n  async removeStrokes(strokeIds: string[]): Promise<void>\n  {\n    this.logger.info(\"removeStrokes\", { strokeIds })\n    const strokeIdSet = new Set(strokeIds)\n    const removedStrokes = this.model.strokes.filter(s => strokeIdSet.has(s.id))\n    if (removedStrokes.length === 0) {\n      this.logger.warn(\"removeStrokes\", \"No strokes found to remove\")\n      return\n    }\n    this.#model = this.model.clone()\n    removedStrokes.forEach(s => {\n      this.renderer.removeSymbol(s.id)\n      this.model.removeStroke(s.id)\n    })\n    this.history.push(this.#model, { removed: removedStrokes })\n    const exports = await this.recognizer.send(this.model.strokes)\n    this.model.mergeExport(exports)\n    this.history.updateModelStack(this.model)\n    this.event.emitExported(this.#model.exports as TExport)\n    this.logger.debug(\"removeStrokes\", { model: this.#model })\n  }\n\n  async undo(): Promise<void>\n  {\n    this.logger.info(\"undo\")\n    const previousStackItem = this.history.undo()\n    const modifications = previousStackItem.model.extractDifferenceStrokes(this.model)\n    this.#model = previousStackItem.model.clone()\n    modifications.removed.forEach(s => this.renderer.removeSymbol(s.id))\n    modifications.added.forEach(s => this.renderer.drawSymbol(s))\n    await this.export()\n  }\n\n  async redo(): Promise<void>\n  {\n    this.logger.info(\"redo\")\n    const previousStackItem = this.history.redo()\n    const modifications = previousStackItem.model.extractDifferenceStrokes(this.model)\n    this.#model = previousStackItem.model.clone()\n    modifications.removed.forEach(s => this.renderer.removeSymbol(s.id))\n    modifications.added.forEach(s => this.renderer.drawSymbol(s))\n    await this.export()\n  }\n\n  async clear(): Promise<void>\n  {\n    this.logger.info(\"clear\")\n    const erased = this.model.strokes\n    this.model.clear()\n    this.history.push(this.model, { removed: erased })\n    this.renderer.clear()\n    this.event.emitExported(this.#model.exports as TExport)\n  }\n\n  async destroy(): Promise<void>\n  {\n    this.logger.info(\"destroy\")\n    this.event.removeAllListeners()\n    this.writer.detach()\n    this.layers.destroy()\n    this.renderer.destroy()\n    return Promise.resolve()\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { EditorType } from \"./AbstractEditor\"\nimport { InteractiveInkEditor, TInteractiveInkEditorOptions } from \"./InteractiveInkEditor\"\nimport { InkEditorDeprecated, TInkEditorDeprecatedOptions } from \"./InkEditorDeprecated\"\nimport { InteractiveInkSSREditor, TInteractiveInkSSREditorOptions } from \"./InteractiveInkSSREditor\"\nimport { InkEditor, TInkEditorOptions } from \"./InkEditor\"\n\n/**\n * @group Editor\n * @hideconstructor\n */\nexport class Editor\n{\n  protected static logger = LoggerManager.getLogger(LoggerCategory.EDITOR)\n  protected static instance: InteractiveInkEditor | InkEditorDeprecated | InteractiveInkSSREditor | InkEditor |undefined\n\n  static async load<T extends EditorType>(rootElement: HTMLElement, type: T, options: T extends \"INTERACTIVEINK\" ? TInteractiveInkEditorOptions : T extends \"INKV1\" ? TInkEditorDeprecatedOptions : TInteractiveInkSSREditorOptions extends \"INKV2\" ? TInkEditorOptions : TInteractiveInkSSREditorOptions):\n    Promise<T extends \"INTERACTIVEINK\" ? InteractiveInkEditor : T extends \"INKV1\" ? InkEditorDeprecated : InteractiveInkSSREditor extends \"INKV2\" ? InkEditor : InteractiveInkSSREditor>\n  {\n    Editor.logger.info(\"load\", { type, options })\n    if (!options) {\n        throw new Error(`Param 'options' missing`)\n    }\n    if (Editor.instance) {\n      await Editor.instance.destroy()\n    }\n\n    switch (type) {\n      case \"INTERACTIVEINK\":\n        Editor.instance = new InteractiveInkEditor(rootElement, options as TInteractiveInkEditorOptions)\n        break\n      case \"INKV1\":\n        Editor.instance = new InkEditorDeprecated(rootElement, options as TInkEditorDeprecatedOptions)\n        break\n      case \"INKV2\":\n        Editor.instance = new InkEditor(rootElement, options as TInkEditorOptions)\n        break;\n      // case \"INTERACTIVEINKSSR\":\n      default:\n        Editor.instance = new InteractiveInkSSREditor(rootElement, options as TInteractiveInkSSREditorOptions)\n        break\n    }\n\n    await Editor.instance.initialize()\n\n    return Editor.instance as T extends \"INTERACTIVEINK\" ? InteractiveInkEditor : T extends \"INKV1\" ? InkEditorDeprecated : InteractiveInkSSREditor extends \"INKV2\" ? InkEditor : InteractiveInkSSREditor\n  }\n\n  static getInstance(): InteractiveInkEditor | InkEditorDeprecated | InteractiveInkSSREditor | InkEditor | undefined\n  {\n    return Editor.instance\n  }\n\n}\n","\n/**\n * @group Recognizer\n */\nexport type TConvertionConfiguration = {\n    force?: {\n        \"on-stylesheet-change\": boolean\n    }\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultConvertionConfiguration: TConvertionConfiguration = {\n    force: {\n        \"on-stylesheet-change\": false\n    }\n}\n","import { TServerHTTPConfiguration } from \"../recognizer\"\nimport { PartialDeep } from \"./types\"\n\n/**\n * @group Utils\n */\nexport async function getAvailableFontList(configuration: PartialDeep<{ server: TServerHTTPConfiguration, recognition: { lang: string }}>): Promise<Array<string>>\n{\n  if (!configuration?.server?.scheme && !configuration?.server?.host) {\n    return Promise.reject(\"Failed to get fonts: configuration.server.scheme & configuration.server.host are required!\")\n  }\n  if (!configuration?.recognition?.lang) {\n    return Promise.reject(\"Failed to get fonts: configuration.recognition.lang is required!\")\n  }\n  const serverConfig = configuration.server\n  const response = await fetch(`${ serverConfig.scheme }://${ serverConfig.host }/api/v4.0/iink/font/google/language/` + configuration.recognition.lang)\n  const { result } = await response.json()\n  return result.sort()\n}\n"],"names":["EditorTool","EditorWriteTool","SvgElementRole","ResizeDirection","SELECTION_MARGIN","DeferredPromise","promise","resolve","reject","isFullFilled","isPending","constructor","this","Promise","async","v","isValidNumber","x","isNaN","parseFloat","toString","isFinite","isBetween","val","min","max","computeAverage","arr","reduce","p","c","length","computeDistance","p1","p2","distance","Math","hypot","y","computeDistanceSquared","dx","dy","computeAngleAxeRadian","begin","end","atan2","scalaire","v1","v2","computeNearestPointOnSegment","seg","vectP1P","vectP1P2","scalaireP1P_P1P2","scalaireP1P2_P1P2","t","convertRadianToDegree","radian","PI","toFixed","convertDegreeToRadian","degree","computeRotatedPoint","point","center","cos","sin","computePointOnEllipse","radiusX","radiusY","phi","theta","cosPhi","sinPhi","M","abs","N","findIntersectionBetween2Segment","seg1","seg2","S1dx","S1dy","S2dx","S2dy","S1S2dx","S1S2dy","ua_t","ub_t","u_b","ua","ub","findIntersectBetweenSegmentAndCircle","r","result","fx","fy","a","b","cc","deter","pow","e","sqrt","u1","u2","push","computeAngleRadian","p1c","p2c","p1p2","acos","getClosestPoints","points1","points2","minDistanceSquared","Number","MAX_SAFE_INTEGER","_p1","_p2","dSquared","getClosestPoint","points","closest","index","i","isPointInsidePolygon","inside","j","isVersionSuperiorOrEqual","source","target","sourceParts","split","targetParts","computeHmac","message","applicationKey","hmacKey","enc","TextEncoder","messageEncoded","encode","keyEncoded","key","crypto","subtle","importKey","name","hash","signature","sign","buffer","Uint8Array","Array","prototype","map","call","padStart","join","MM_TO_PX_RATIO","PX_TO_MM_RATIO","convertMillimeterToPixel","mm","convertPixelToMillimeter","px","convertBoundingBoxMillimeterToPixel","box","width","height","createUUID","dt","Date","now","replace","random","floor","mergeDeep","sources","isObject","item","isArray","shift","Object","assign","concat","isDeepEqual","object1","object2","objKeys1","keys","objKeys2","value1","value2","isObjects","object","getAvailableLanguageList","configuration","server","scheme","host","serverConfig","fetch","json","computeLinksPointers","angle","radius","computeMiddlePointer","point1","point2","getApiInfos","response","ok","version","gitCommit","nativeVersion","LoggerLevel","LoggerCategory","Logger","category","level","debug","functionName","data","DEBUG","dataLog","from","console","info","INFO","warn","WARN","error","LoggerManager","static","Map","getLogger","loggerMap","has","set","ERROR","get","setLoggerLevel","config","lc","DefaultLoggerConfiguration","EDITOR","RECOGNIZER","GRABBER","RENDERER","EDITOR_EVENT","MODEL","SYMBOL","SMARTGUIDE","GESTURE","STYLE","HISTORY","TRANSFORMER","CONVERTER","WRITE","SELECTION","SVGDEBUG","MENU","EditorEventName","EditorEvent","EventTarget","logger","abortController","element","super","AbortController","removeAllListeners","abort","emit","type","evt","CustomEvent","bubbles","composed","detail","undefined","dispatchEvent","emitSessionOpened","sessionId","SESSION_OPENED","addSessionOpenedListener","callback","addEventListener","signal","emitLoaded","LOADED","addLoadedListener","emitNotif","notif","NOTIF","addNotifListener","emitError","err","addErrorListener","emitExported","exports","EXPORTED","addExportedListener","emitChanged","undoRedoContext","CHANGED","canClear","empty","addChangedListener","emitIdle","idle","IDLE","addIdleListener","emitCleared","CLEARED","addClearedListener","emitConverted","CONVERTED","addConvertedListener","emitImported","IMPORTED","addImportedListener","emitSelected","symbols","SELECTED","addSelectedListener","emitToolChanged","mode","TOOL_CHANGED","addToolChangedListener","emitUIpdated","UI_UPDATED","addUIpdatedListener","emitSynchronized","SYNCHRONIZED","addSynchronizedListener","emitGestured","gesture","GESTURED","addGesturedListener","ExportType","JIIXELementType","JIIXNodeKind","JIIXEdgeKind","ExportV2Type","JIIXV2ShapeKind","EditorLayer","root","ui","rendering","onCloseModal","rootClassCss","classList","add","createLayerRender","createLayerUI","render","styleElement","document","createElement","appendChild","createTextNode","prepend","createLoader","loaderHTML","style","display","showLoader","loader","hideLoader","createMessageOverlay","overlay","closeMessageModal","modal","contains","hideMessageModal","text","innerText","remove","createMessageModal","closeBtn","bind","createMessage","showMessageInfo","setTimeout","timeout","showMessageError","createBusy","busy","createState","showState","state","hideState","updateState","destroy","lastChild","removeChild","AbstractEditor","layers","event","loggerConfiguration","rootElement","options","override","cssClass","editor","loggerConfig","loadInfo","Box","boundindBox","Error","createFromBoxes","boxes","minX","maxX","minY","maxY","createFromPoints","getCorners","getSide","getCenter","getSides","vertices","isContained","wrapper","containsPoint","child","overlaps","box1","box2","xMin","xMid","xMax","yMin","yMid","yMax","corners","side","snapPoints","boundaries","DefaultStyle","color","DefaultPenStyle","DefaultTheme","ink","module","o","n","l","m","d","defineProperty","configurable","enumerable","__esModule","default","hasOwnProperty","s","TypeError","value","Symbol","iterator","toJSON","u","forEach","trim","indexOf","substring","_trimSemiColon","toCSS","slice","parser","JsonCSS","StyleHelper","themeToCSS","themeToJSON","theme","penStyleToCSS","penStyle","css","penStyleToJSON","penStyleString","stringToJSON","JSONToString","entries","k","StyleManager","penStyleClasses","currentPenStyle","setTheme","setPenStyleClasses","setPenStyle","structuredClone","penStyleClass","DecoratorKind","SymbolType","EdgeKind","ShapeKind","RecognizedKind","IIDecorator","id","kind","clone","MatrixTransform","xx","yx","xy","yy","tx","ty","identity","applyToPoint","mat","rotation","hypotAc","hypotBd","toCssString","matrix","invert","denom","multiply","translate","rotate","cosAngle","round","sinAngle","scale","IISymbolBase","creationTime","modificationDate","selected","deleting","transform","opacity","edges","isClosed","isIntersected","some","edge","EdgeDecoration","OIEdgeBase","startDecoration","endDecoration","Edge","bounds","bb","e1","e2","isValidPoint","IIEdgeArc","startAngle","sweepAngle","_vertices","Arc","verticesId","computedVertices","nbVertices","angleStep","endAngle","at","create","partial","arc","IIEdgeLine","start","Line","line","IIEdgePolyLine","PolyEdge","polyline","OIShapeBase","Shape","IIShapeCircle","_bounds","Circle","computedBondingBox","firstPoint","perimeter","nbPoint","rad","boundingBox","createBetweenPoints","origin","updateBetweenPoints","circle","IIShapeEllipse","orientation","Ellipse","ellipse","IIShapePolygon","Polygon","polygon","createTriangleBetweenPoints","updateTriangleBetweenPoints","poly","createParallelogramBetweenPoints","updateParallelogramBetweenPoints","createRectangleBetweenPoints","updateRectangleBetweenPoints","createRhombusBetweenPoints","updateRhombusBetweenPoints","IIStroke","pointerType","decorators","pointers","Stroke","strokeToSplit","before","after","substract","stroke","partStroke","lastPointBeforeStroke","closestLastPointBeforeStroke","newStrokes","strokeAfter","firstPointAfterStroke","closestFirstPointStrokeAfter","computePressure","ratio","pressure","filterPointByAcquisitionDelta","lastPointer","delta","addPointer","pointer","formatToSend","errors","flag","pp","pIndex","convertPartialStrokesToOIStrokes","strokes","IIRecognizedBase","Recognized","flatMap","updateChildrenStyle","containsStroke","strokeId","removeStrokes","strokeIds","strokeRemoved","filter","includes","IIRecognizedArc","ws","IIRecognizedCircle","IIRecognizedEllipse","IIRecognizedLine","IIRecognizedPolyLine","IIRecognizedPolygon","Polygone","IIRecognizedText","baseline","xHeight","label","lines","Text","IISymbolGroup","children","Group","chars","containsSymbol","containsOnlyStroke","extractText","extractStrokes","removeChilds","symbolIds","group","every","texts","symbolId","symbol","s1","IIText","offsetY","getCharCorners","char","boxBox","updateChildrenFont","fontSize","fontWeight","getCharsOverlaps","charCorners","fill","IIEraser","Eraser","Model","positions","currentSymbol","converts","rowHeight","creationDate","lastSentPosition","lastReceivedPosition","globalDistance","getStrokeFromPoint","_strokeList","strokePointer","addPoint","addStroke","updateStroke","updatedStroke","strokeIndex","findIndex","splice","removeStroke","removeStrokesFromPoint","strokeToRemove","extractUnsentStrokes","initCurrentStroke","dpi","pxWidth","appendToCurrentStroke","endCurrentStroke","updatePositionSent","position","updatePositionReceived","mergeExport","mergeConvert","clonedModel","clear","IIModel","symbolsMap","syncMap","size","symbolsSelected","symbolsToDelete","selectSymbol","find","unselectSymbol","resetSelection","getRootSymbol","directMatch","getSymbolRowIndex","getSymbolsByRowOrdered","rowsMap","rowIndex","row","rows","sort","s2","r1","r2","roundToLineGuide","isSymbolAbove","isSymbolInRow","isSymbolBelow","getFirstSymbol","previous","current","getLastSymbol","addSymbol","updateSymbol","updatedSymbol","sIndex","replaceSymbol","delete","changeOrderSymbol","fromIndex","toIndex","sym","removeSymbol","symbolIndex","extractDifferenceSymbols","model","modelKeys","Set","thisKeys","added","removed","IModel","currentStroke","strokesToDelete","extractDifferenceStrokes","modelStrokeKeys","thisStrokeKeys","DefaultServerHTTPConfiguration","DefaultServerWebsocketConfiguration","websocket","pingEnabled","pingDelay","maxPingLostCount","autoReconnect","maxRetryCount","fileChunkSize","DefaultEraserConfiguration","DefaultDiagramConvertConfiguration","types","DefaultDiagramConfiguration","convert","eraser","mimeTypes","DefaultJiixConfiguration","ids","words","DefaultExportConfiguration","jiix","DefaultMarginConfiguration","top","left","right","bottom","DefaultSolverConfiguration","enable","DefaultMathUndoRedoConfiguration","DefaultMathConfiguration","solver","margin","DefaultRawContentConfiguration","recognition","classification","DefaultDebugConfiguration","DefaultRecognitionRendererConfiguration","DefaultTextGuidesConfiguration","DefaultTextConfiguration","guides","DefaultTextGuidesConfigurationV2","DefaultTexConfigurationV2","DefaultShapeConvertConfiguration","DefaultShapeBeautificationConfiguration","DefaultShapeConfiguration","beautification","DefaultMathV2Configuration","DefaultRawContentV2Configuration","RecognizerEventName","RecognizerError","RecognizerEvent","emitStartInitialization","START_INITIALIZATION","addStartInitialization","emitEndtInitialization","END_INITIALIZATION","addEndInitialization","emitContentChanged","CONTENT_CHANGED","addContentChangedListener","emitConnectionClose","code","CONNECTION_CLOSE","addConnectionCloseListener","emitSVGPatch","svgPatch","SVG_PATCH","addSVGPatchListener","DefaulRecognitionHTTPV1ConfigurationConfiguration","export","math","diagram","renderer","lang","DefaultRecognizerHTTPV1Configuration","RecognizerHTTPV1Configuration","RecognizerHTTPV1","url","postConfig","buildData","strokeGroupByPenStyle","groupIndex","sg","isPenStyleEqual","ps1","ps2","strokeGroupsToSend","newGroup","JSON","stringify","contentType","charAt","toUpperCase","toLowerCase","xDPI","yDPI","strokeGroups","post","mimeType","headers","Headers","append","hmac","reqInit","method","body","credentials","request","Request","blob","catch","tryFetch","then","res","UNKNOW","WRONG_CREDENTIALS","CANT_ESTABLISH","getMimeTypes","requestedMimeTypes","conversionState","myModel","dataToConcert","promises","mt","all","String","mimeTypesRequiringExport","resize","DefaultRecognizerHTTPV2RecognitionConfiguration","shape","DefaultRecognizerHTTPV2Configuration","RecognizerHTTPV2Configuration","RecognizerHTTPV2","formatStrokes","scaleX","scaleY","send","TRecognizerWebSocketMessageType","DefaultRecognitionWebSocketConfiguration","gestures","ignoreGestureStrokes","DefaultRecognizerWebSocketConfiguration","RecognizerWebSocketConfiguration","RecognizerWebSocket","socket","pingWorker","pingCount","reconnectionCount","currentPartId","currentErrorCode","addStrokeDeferred","contextlessGestureDeferred","transformStrokeDeferred","eraseStrokeDeferred","replaceStrokeDeferred","exportDeferredMap","closeDeferred","waitForIdleDeferred","undoDeferred","redoDeferred","clearDeferred","initialized","readyState","OPEN","rejectDeferredPending","values","resetAllDeferred","clearSocketListener","removeEventListener","openCallback","closeCallback","messageCallback","reason","GOING_AWAY","PROTOCOL_ERROR","UNSUPPORTED_DATA","ABNORMAL_CLOSURE","INVALID_FRAME_PAYLOAD","POLICY_VIOLATION","MESSAGE_TOO_BIG","INTERNAL_ERROR","SERVICE_RESTART","TRY_AGAIN","BAD_GATEWAY","TLS_HANDSHAKE","terminate","manageHMACChallenge","hmacChallengeMessage","hmacChallenge","initPing","PingWorker","postMessage","onmessage","close","manageAuthenticated","pixelTomm","iinkSessionId","manageSessionDescriptionMessage","sessionDescriptionMessage","manageNewPartMessage","newPartMessage","managePartChangeMessage","partChangeMessage","partId","manageContentChangedMessage","contentChangeMessage","canRedo","canUndo","manageExportMessage","exportMessage","parse","manageWaitForIdle","manageErrorMessage","errorMessage","NO_ACTIVITY","TOO_OLD","NO_SESSION_FOUND","manageGestureDetected","gestureMessage","manageContextlessGesture","websocketMessage","Pong","HMAC_Challenge","Authenticated","SessionDescription","NewPart","PartChanged","ContentChanged","Exported","GestureDetected","ContextlessGesture","Idle","newSession","init","WebSocket","CONNECTING","CLOSING","CLOSED","waitForIdle","buildAddStrokesMessage","processGestures","addStrokes","buildReplaceStrokesMessage","oldStrokeIds","replaceStrokes","buildTransformTranslateMessage","transformationType","transformTranslate","buildTransformRotateMessage","x0","y0","transformRotate","buildTransformScaleMessage","transformScale","buildTransformMatrixMessage","transformMatrix","buildEraseStrokesMessage","eraseStrokes","recognizeGesture","buildUndoRedoChanges","changes","changesMessages","erased","replaced","oldStrokes","tr","undo","actions","redo","DefaultRecognizerWebSocketSSRRecognitionConfiguration","DefaultRecognizerWebSocketSSRConfiguration","RecognizerWebSocketSSRConfiguration","RecognizerWebSocketSSR","viewSizeHeight","viewSizeWidth","connected","ackDeferred","exportDeferred","convertDeferred","importDeferred","resizeDeferred","importPointEventsDeferred","toLocaleLowerCase","infinitePing","params","xDpi","yDpi","manageAckMessage","manageContentPackageDescriptionMessage","manageContentChangeMessage","context","stackIndex","undoStackIndex","possibleUndoCount","manageSVGPatchMessage","svgPatchMessage","styleClasses","localModel","import","chunkSize","importFileId","readBlob","fileReader","FileReader","onloadend","ev","onerror","readAsText","importFileMessage","blobPart","fileChuckMessage","lastChunk","importPointEvents","events","myExportConverted","undoExports","redoExports","clearExports","CanvasRendererShape","table","returnedAngle","drawEllipseArc","context2D","shapeEllipse","centerPoint","maxRadius","minRadius","z1","z2","z3","z4","boundariesPoints","save","beginPath","alpha","cosAlpha","sinAlpha","moveTo","lineTo","restore","drawLine","drawArrowHead","headPoint","beta","fillStyle","strokeStyle","drawShapeEllipse","beginDecoration","beginTangentAngle","endTangentAngle","drawShapeLine","shapeLine","lastPoint","draw","lineWidth","CanvasRendererStroke","renderArc","context2d","renderLine","linkPoints1","linkPoints2","renderFinal","linkPoints","newAngle","renderQuadratic","ctrl","linkPoints3","quadraticCurveTo","NUMBER_POINTS","NUMBER_QUADRATICS","secondPoint","beginLine","endLine","beginFinal","endFinal","closePath","CanvasRendererText","string","textLine","drawUnderline","textUnderline","underline","topLeftPoint","firstCharacter","lastCharacter","drawText","font","textHeight","textAlign","justificationType","textBaseline","fillText","drawTextLine","underlineList","CanvasRenderer","strokeRenderer","shapeRenderer","textRenderer","createCanvas","canvas","resizeContent","pixelRatio","window","devicePixelRatio","renderingCanvas","capturingCanvas","domElement","parentNode","minWidth","clientWidth","minHeight","clientHeight","getContext","drawSymbol","guide","setAttribute","backgroundSize","parent","renderingCanvasContext","capturingCanvasContext","drawModel","clearRect","drawPendingStroke","innerHTML","SVGRendererConst","arrowHeadStartMarker","arrowHeadEndMaker","selectionFilterId","removalFilterId","crossMarker","noSelection","XMLNS","SVGBuilder","createLayer","attrs","svgEl","createElementNS","createFilter","createDefs","createMarker","marker","createComponentTransfert","createDropShadow","deviation","shadow","createTransfertFunctionTable","feFunc","createGroup","groupEl","createLine","lineEl","createCircle","circleEl","createPath","pathEl","createPolygon","polygonEl","createRect","rectEl","createTSpan","tSpanEl","textContent","createForeignObject","node","objEl","createText","textEl","SVGRendererEdgeUtil","getLinePath","getPolyLinePath","path","getArcPath","getSVGPath","getSVGElement","pathAttrs","Arrow","SVGRendererEraserUtil","startPath","strokeWith","acc","shadowBlur","SVGRendererDecoratorUtil","decorator","Highlight","Surround","Strikethrough","Underline","SVGRendererShapeUtil","getPolygonePath","getCirclePath","getEllipsePath","SVGRendererStrokeUtil","getFinalPath","parts","getQuadraticPath","central","STROKE_LENGTH","STROKE_WIDTH","NB_QUADRATICS","beforeLastPoint","strokeGroup","strokeAttrs","deco","SVGRendererTextUtil","textGroup","textElement","SVGRendererRecognizedUtil","recognizedSymbol","SVGRendererGroupUtil","getChildElement","symbolGroup","SVGRenderer","groupGuidesId","layer","definitionGroup","verticalGuides","horizontalGuides","initLayer","setProperty","createSVGTools","defs","REFX","SIZE","REFY","arrowHeadMarkerAttrs","markerWidth","markerHeight","refX","refY","arrowHeadStart","orient","arrowHeadEnd","crossMarkerAttrs","viewBox","cross","createFilters","filtersGroup","removalFilter","filterUnits","bfeComponentTransfer","bfeFuncA","selectionFilter","drawGuides","getAttribute","offSet","gap","subOffSet","role","Guide","guidesGroup","svgLine","subY","subX","svgPoint","removeGuides","querySelector","oncontextmenu","buildElementFromSymbol","prependElement","el","symbolToMove","moveEl","insertAdjacentElement","nextElementSibling","previousElementSibling","appendElement","removeElement","oldStroke","oldNode","replaceWith","elements","drawCircle","drawRect","drawConnectionBetweenBox","attrsLine","getElementById","getElements","tagName","query","querySelectorAll","clearElements","firstChild","SVGStroker","buildSVGPath","drawStroke","svgElement","svgPathElement","svgPath","InteractiveInkSSRSVGRenderer","stroker","replaceAll","layerName","update","oldLayer","insertAdjacentHTML","svg","pendingStrokesGroup","replaceElement","elementToRemove","parentSelector","parentId","insertBefore","refId","selector","removeAttribute","updateLayer","updatesLayer","updates","clearPendingStroke","pendingStrokeGroup","clearErasingStrokes","erasingStroke","rect","getBoundingClientRect","svgList","DefaultGuidesConfiguration","DefaultRendererConfiguration","DefaultIIRendererConfiguration","DefaultListenerConfiguration","capture","passive","DefaultGrabberConfiguration","listenerOptions","xyFloatPrecision","timestampFloatPrecision","delayLongTouch","PointerEventGrabber","layerCapture","capturing","prevent","preventDefault","onPointerDown","onPointerMove","onPointerUp","onContextMenu","roundFloat","oneFloat","requestedFloatPrecision","floatPrecision","extractPointer","clientX","clientY","changedTouches","clientLeft","scrollLeft","clientTop","scrollTop","getPointerInfos","isPrimary","button","buttons","pointerDownHandler","pointerInfo","pointerMoveHandler","pointerUpHandler","pointerOutHandler","contextMenuHandler","stopPointerEvent","attach","detach","removeProperty","AbstractWriterManager","grabber","detectGesture","continue","localPointer","createCurrentSymbol","updateCurrentSymbol","IIConversionManager","fontStyle","computeFontSize","buildChar","grid","weight","buildText","word","charSymbols","charFontSize","charStrokes","items","hightlight","strikethrough","surround","convertText","onlyText","jiixWords","jiixChars","textFontSize","isNewLine","currentY","leftX","currentX","texter","getSpaceWidth","wordStrokes","wordSymbol","nbRow","setBounds","buildCircle","cx","cy","buildEllipse","rx","ry","buildRectangle","rectangle","buildPolygon","buildRhombus","buildTriangle","buildParallelogram","convertNode","associatedStroke","uniqStrokes","Rectangle","Triangle","Parallelogram","Rhombus","buildLine","x1","y1","x2","y2","p1Decoration","p2Decoration","buildPolyEdge","unshift","buildArc","convertEdge","apply","removeSelectedGroup","strokesToConvert","extractStrokesFromSymbols","conversionResults","conversion","addSymbols","cs","removeSymbols","history","IIResizeManager","interactElementsGroup","direction","transformOrigin","keepRatio","applyToStroke","applyToShape","applyToEdge","applyOnText","updateBounds","applyOnGroup","applyToSymbol","applyOnRecognizedSymbol","setTransformOrigin","originX","originY","scaleElement","sx","sy","InteractElementsGroup","localPoint","horizontalResize","verticalResize","snaps","snapResize","deltaX","deltaY","clearSnapToElementLines","oldSymbols","strokesFromSymbols","recognizer","svgDebugger","IIRotationManager","angleRad","strokeText","rotateElement","angleDegree","snapRotation","IISelectionManager","selectingId","startSelectionPoint","endSelectionPoint","selectedGroup","rotator","translator","resizer","selectionBox","drawSelectingRect","clearSelectingRect","getPoint","createTranslateRect","Translate","boxWithMarge","translateEl","handler","stopPropagation","endHandler","cursor","resetSelectedGroup","hideInteractElements","createRotateGroup","Rotate","attrs1","attrs2","attrs3","createResizeGroup","Resize","P_NW","P_NE","P_SE","P_SW","bindEl","def","lineResize","cornerResize","createInteractElementsGroup","symbolElementMap","surroundGroup","SURROUND_ATTRS","createEdgeResizeGroup","pointIndex","pointEl","createInteractEdgeGroup","drawSelectedGroup","groupBox","getBBox","menu","show","hide","updatedSymbols","found","currentEl","symbolTypesAllowed","parentElement","unselectAll","updateLayerUI","IITextManager","drawSymbolHidden","setCharsBounds","textGroupEl","getNumberOfChars","ext","getExtentOfChar","getElementBoundingBox","markers","clipped","getBoundingBox","charSymbol","textSymbol","moveTextAfter","textsAfter","IITranslateManager","addToHistory","translateElement","nudge","snapTranslate","IIWriterManager","tool","Pencil","currentSymbolOrigin","wt","gestureManager","needContextLessGesture","strokeBoundsWithMargin","getSymbolsBounds","DoubleArrow","updateCurrentSymbolShape","updateCurrentSymbolEdge","interactWithBackend","localStroke","gestureFromContextLess","getGestureFromContextLess","pop","localSymbol","IIDebugSVGManager","snapPointsVisibility","verticesVisibility","boundingBoxVisibility","recognitionBoxVisibility","recognitionItemBoxVisibility","debugSnapPoints","debugVertices","showBoundingBox","hideBoundingBox","debugRecognitionBox","debugRecognitionItemBox","showSnapPoints","hideSnapPoints","showVertices","hideVertices","drawBoundingBox","symbolAttrs","charAttrs","symEl","ca","sa","debugBoundingBox","drawRecognitionBox","infos","COLOR","recognitionGroup","infosGroup","infoX","infoY","TEXT_HEIGHT","w","infosGroupBox","rectBox","rectTranslate","newRectBox","showRecognitionBox","hideProperties","candidates","inf","clearRecognitionBox","drawRecognitionItemBox","recognitionItemGroup","charX","charY","charsGroup","charsGroupBox","showRecognitionItemBox","clearRecognitionItemBox","IIMoveManager","IDebugSVGManager","recognitionBoxItemsVisibility","recognitionBoxDrawing","recognitionBoxItemsDrawing","debugRecognitionBoxItems","debugAttr","rectAttr","buildInfos","obj","currentPath","localPath","associatedStrokes","range","to","h","showRecognitionBoxItems","spans","clearRecognitionBoxItems","EraseManager","currentEraser","lastSeg","InteractiveInkEditor","getInitialHistoryContext","HistoryManager","stack","updateContext","maxStackSize","updateStack","previousModel","nextModel","IIHistoryManager","isChangesEmpty","updated","order","ungroup","stackIdx","reverseChanges","reversedChanges","newSymbols","currentStackItem","previousStackItem","nextStackItem","IHistoryManager","updateModelStack","DefaultHistoryConfiguration","createMenuButton","onClick","additionalClasses","btn","createMenuButtonWithText","IIMenu","thicknessList","fontSizeList","fontWeightList","colors","createWrapCollapsible","title","head","ArrowDown","content","toggle","createMenuItemBoolean","labelEl","checkbox","disabled","initValue","indeterminate","checked","createMenuItemSelect","select","opt","Option","createMenuItemButton","icon","createMenuItemButtonList","createMenuItemColorList","createColorList","list","colorEl","createMenuItem","SurroundAction","StrikeThroughAction","InsertAction","DefaultGestureConfiguration","Select","strikeThrough","Draw","insert","LineBreak","IIGestureManager","insertAction","surroundAction","strikeThroughAction","gestureAction","strokeSpaceWidth","applySurroundGesture","gestureStroke","symbolIdSet","DECORABLE_TYPES","symWithDec","highlight","computeScratchOnStrokes","partPointersToRemove","subStrokes","ss","fullStrokeId","strokePartToErase","computeScratchOnText","charsToRemove","cIndex","c1","computeScratchOnSymbol","strokesScratchedResult","childrenNotTouch","results","strokesToConserve","symbolsGroup","textScratchedResult","applyScratch","symbolsToUpdate","symbolsToErase","symbolsToReplace","updateSymbols","replaceSymbols","applyJoinGesture","symbolsAbove","symbolsRow","symbolsBeforeGestureInRow","symbolsOnGestureInRow","symbolsAfterGestureInRow","symbolsBelow","symbolToJoin","childBefore","childAfter","lastSymbBefore","firstSymbolAfter","lastXBefore","firstXAfter","translateX","lastSymbBeforeClone","firstSymbolAfterClone","symbolsToGroup","strokeTexts","d1","rest","lastSymbolBeforeGesture","firstSymbolAfterGesture","symbolInNextRow","symbolsAfterNextRow","lastSymbolAbove","createStrokesFromGestureSubStroke","strokeOrigin","subStroke","computeSplitStroke","computeSplitStrokeInGroup","newGroups","symbolsBefore","symbolsAfter","strokeIdToSplit","gs","computeChangesOnSplitStroke","symbolToSplit","strokesToSplit","strokesBefore","strokesAfter","computeChangesOnSplitGroup","groupToSplit","groupSymbolsBefore","groupsSymbolsAfter","groupBefore","grouAfter","computeChangesOnSplitStrokeText","strokeTextToSplit","strokeTextBefore","strokeTextAfter","computeChangesOnSplitText","textToSplit","charsBefore","charsAfter","newTexts","textBefore","pointAfter","textAfter","applyInsertGesture","Insert","applyUnderlineGesture","applyStrikeThroughGesture","Erase","updateSymbolsStyle","synchronizeStrokesWithJIIX","gestureType","SURROUND_SELECT_TYPES","gestureStrokeId","strokeAfterIds","strokeBeforeIds","symbolsToUnderline","TEXT_STROKE_GROUP_TYPES","symbolsToStrikeThrough","ERASE_OVERLAY_TYPES","ERASE_CONTAIN_TYPES","IIMenuSub","param","trigger","menuTitle","menuTitleElement","subMenu","open","unwrap","wrap","IIMenuAction","menuLanguage","menuClear","menuUndo","menuRedo","menuConvert","guideGaps","isMobile","createMenuClear","createMenuLanguage","triggerBtn","languages","changeLanguage","createMenuUndo","createMenuRedo","createMenuConvert","createMenuGesture","subMenuWrapper","surroundActionValues","strikeThroughActionValues","splitActionValues","writer","Write","createMenuGuide","renderingConfiguration","createMenuSnap","createMenuDebug","menuItems","createMenuExport","downloadAsJson","downloadAsSVG","downloadAsPNG","readFileAsText","file","reader","onload","createMenuImport","importInput","accept","multiple","importBtn","files","fileString","createSymbols","closeAllSubMenu","action","menuTrigger","visibility","IIMenuTool","writeBtn","menuSelect","menuMove","menuErase","menuShape","subMenuShape","menuEdge","subMenuEdge","createMenuWrite","createMenuMove","Move","createMenuSelect","createMenuErase","createShapeSubMenu","subMenuContent","nextSibling","createMenuShape","rectangleIcon","triangle","rhombus","createEdgeSubMenu","square","createMenuEdge","lineIcon","arrow","doubleArrow","IIMenuStyle","menuColorStroke","menuColorFill","menuThickness","menuFontSize","menuFontWeight","menuStrokeOpacity","writeShape","createMenuStroke","symbolsStyles","st","menuColorStrokeDef","menuColor","createMenuColorFill","createMenuThickness","createMenuFontSize","textSymbols","updateTextFontStyle","createMenuFontWeight","createMenuOpacity","currentOpacity","input","output","shapeSelected","IIMenuContext","editMenu","editInput","editSaveBtn","reorderMenu","decoratorMenu","menuExport","duplicateBtn","groupBtn","convertBtn","removeBtn","haveSymbolsSelected","symbolsDecorable","showDecorator","createMenuEdit","firstChar","createMenuDuplicate","symbolsToDuplicate","updateDeepIdInGroup","gr","duplicatedSymbols","createMenuGroup","ungroupSymbol","groupSymbols","convertSymbols","createMenuRemove","createMenuReorder","changeOrderSymbols","reverse","createDecoratorSubMenu","labelEL","decoIndex","_c","createMenuDecorator","createMenuSelectAll","selectAll","updateDecoratorSubMenu","decos","btnToActivate","updateGroupMenu","DefaultMenuConfiguration","IIMenuManager","custom","CustomMenuStyle","CustomMenuTool","CustomMenuAction","DefaultSnapConfiguration","SnapConfiguration","IISnapManager","selectionSnapPoints","otherSnapPoints","selectSymbolIds","snapThreshold","getNearestVerticalGuide","prev","curr","getNearestHorizontalGuide","getGuidePointToSnap","drawSnapToElementLines","getSnapLinesInfos","sourcePoints","targetPoints","Infinity","verticales","horizontales","horizontal","vertical","snapLines","snapLinesInfos","selectionSymbolPoints","lastDeltaX","lastDeltaY","gridPoint","DefaultInteractiveInkEditorConfiguration","snap","InteractiveInkEditorConfiguration","layerUITimer","recognizeStrokeTimer","converter","move","CustomRecognizer","manageError","onContentChanged","updateLayerState","initializationPromise","setCursorStyle","clearTimeout","initialize","compStyles","getComputedStyle","parseInt","buildShape","partialShape","buildEdge","partialEdge","buildRecognized","partialSymbol","buildGroup","partialGroup","buildStroke","buildStrokeText","buildSymbol","createSymbol","partialSymbols","updateTextBounds","symList","lastWidth","textIds","symbolsTranslated","textChildren","symToReplace","force","getSymbolsAndStrokesAssociatedFromJIIXStrokeItems","strokeIdsUsed","symIdx","jiixAssociation","symAsso","recognizedText","wd","Node","symbolRecognized","groupStrokeIds","symbolsToRemove","strokesIds","partialStrokes","triggerDownload","fileName","urlData","downloadAnchorNode","click","buildBlobFromSymbols","svgNode","cloneNode","svgString","XMLSerializer","serializeToString","Blob","getExportName","extension","year","month","day","hour","minute","second","toLocaleDateString","navigator","language","selection","svgBlob","URL","createObjectURL","image","Image","src","drawImage","revokeObjectURL","imgURI","toDataURL","symbolsToExport","dataStr","encodeURIComponent","extractTextsFromSymbols","extractBackendChanges","backendChanges","modifications","actionsToBackend","DefaulTEditorTriggerConfiguration","exportContent","exportContentDelay","resizeTriggerDelay","DefaultInkEditorDeprecatedConfiguration","triggers","InkEditorDeprecatedConfiguration","InkEditorDeprecated","resizeTimer","exportTimer","styleManager","CustomGrabber","drawCurrentStroke","updateModelRendering","deferred","currentModel","newModel","deferredResize","resizeModel","InteractiveInkSSRSmartGuide","uuid","smartGuideElement","wrapperElement","prompterContainerElement","prompterTextElement","ellipsisElement","tagElement","candidatesElement","menuElement","convertElement","copyElement","deleteElement","isMenuOpen","lastWord","wordToChange","createRootElement","createWrapperElement","createPrompterContainerElement","createPrompterTextElement","createEllipsisElement","createTagElement","createCandidatesElement","createMoreMenuElement","createConvertElement","createCopyElement","createDeleteElement","addListeners","showCandidates","wordId","hideCandidates","openMenu","closeMenu","onClickEllipsis","onClickConvert","createTextAreaElement","isRTL","documentElement","textArea","yPosition","pageYOffset","selectText","userAgent","match","createRange","selectNodeContents","getSelection","removeAllRanges","addRange","setSelectionRange","onClickCopy","fakeEl","execCommand","onClickDelete","onClickCandidate","candidate","JIIX","onClickPrompter","onClickOutSide","removeListeners","marginLeft","marginRight","createWordSpan","span","myFragment","createDocumentFragment","offsetLeft","populatePrompter","DefaultInteractiveInkSSREditorConfiguration","smartGuide","InteractiveInkSSREditorConfiguration","InteractiveInkSSREditor","penClass","syncStyle","onExport","jjix","synchronizeModelWithBackend","onSVGPatch","initializeSmartGuide","onError","unsentStrokes","blobToImport","strokesToImport","str","exportPoints","DefaultInkEditorConfiguration","InkEditorConfiguration","IWriterManager","InkEditor","debugger","strokeIdSet","removedStrokes","Editor","load","instance","getInstance","computeDistanceBetweenPointAndSegment","convertPartialStrokesToStrokes","ji","createPointsOnSegment","spaceBetweenPoint","spaceWithP1","getAvailableFontList","isPointInsideBox"],"mappings":"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","x_google_ignoreList":[24]}