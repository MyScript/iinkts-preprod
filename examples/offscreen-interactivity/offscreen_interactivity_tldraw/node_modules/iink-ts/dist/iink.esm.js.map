{"version":3,"file":"iink.esm.js","sources":["../src/Constants.ts","../src/utils/DeferredPromise.ts","../src/utils/math.ts","../src/utils/geometry.ts","../src/utils/version.ts","../src/utils/crypto.ts","../src/utils/units.ts","../src/utils/uuid.ts","../src/utils/object.ts","../src/utils/font.ts","../src/utils/language.ts","../src/utils/quadratics.ts","../src/utils/infos.ts","../src/logger/logger.ts","../src/logger/LoggerManager.ts","../src/logger/LoggerConfiguration.ts","../src/editor/EditorEvent.ts","../src/model/Export.ts","../src/model/ExportV2.ts","../src/editor/EditorLayer.ts","../src/editor/AbstractEditor.ts","../src/symbol/Box.ts","../src/style/Style.ts","../src/style/PenStyle.ts","../src/style/Theme.ts","../node_modules/json-css/lib/jsoncss.min.js","../src/style/StyleHelper.ts","../src/style/StyleManager.ts","../src/symbol/IIDecorator.ts","../src/symbol/Symbol.ts","../src/symbol/geometry/IIEdge.ts","../src/symbol/geometry/IIShape.ts","../src/symbol/recognized/IIRecognizedBase.ts","../src/transform/Matrix.ts","../src/symbol/IISymbolBase.ts","../src/symbol/Point.ts","../src/symbol/geometry/IIEdgeArc.ts","../src/symbol/geometry/IIEdgeLine.ts","../src/symbol/geometry/IIEdgePolyLine.ts","../src/symbol/geometry/IIShapeCircle.ts","../src/symbol/geometry/IIShapeEllipse.ts","../src/symbol/geometry/IIShapePolygon.ts","../src/symbol/IIStroke.ts","../src/symbol/recognized/IIRecognizedArc.ts","../src/symbol/recognized/IIRecognizedCircle.ts","../src/symbol/recognized/IIRecognizedEllipse.ts","../src/symbol/recognized/IIRecognizedLine.ts","../src/symbol/recognized/IIRecognizedPolyLine.ts","../src/symbol/recognized/IIRecognizedPolygon.ts","../src/symbol/recognized/IIRecognizedText.ts","../src/symbol/IISymbolGroup.ts","../src/symbol/IIText.ts","../src/symbol/IIEraser.ts","../src/symbol/Stroke.ts","../src/model/Model.ts","../src/model/IIModel.ts","../src/model/IModel.ts","../src/recognizer/ServerConfiguration.ts","../src/recognizer/recognition/EraserConfiguration.ts","../src/recognizer/recognition/DiagramConfiguration.ts","../src/recognizer/recognition/ExportConfiguration.ts","../src/recognizer/recognition/MarginConfiguration.ts","../src/recognizer/recognition/MathConfiguration.ts","../src/recognizer/recognition/RawContentConfiguration.ts","../src/recognizer/recognition/RecognitionRendererConfiguration.ts","../src/recognizer/recognition/TextConfiguration.ts","../src/recognizer/recognition/TextConfigurationV2.ts","../src/recognizer/recognition/ConvertionConfiguration.ts","../src/recognizer/recognition/ShapeConfiguration.ts","../src/recognizer/recognition/MathV2Configuration.ts","../src/recognizer/recognition/RawContentV2Configuration.ts","../src/recognizer/RecognizerEvent.ts","../src/recognizer/RecognizerError.ts","../src/recognizer/RecognizerHTTPV1Configuration.ts","../src/recognizer/RecognizerHTTPV1.ts","../src/recognizer/RecognizerHTTPV2Configuration.ts","../src/recognizer/RecognizerHTTPV2.ts","../src/recognizer/RecognizerWebSocketMessage.ts","../src/recognizer/RecognizerWebSocketConfiguration.ts","../src/recognizer/RecognizerWebSocket.ts","../src/recognizer/RecognizerWebSocketSSRConfiguration.ts","../src/recognizer/RecognizerWebSocketSSR.ts","../src/renderer/canvas/CanvasRendererShape.ts","../src/renderer/canvas/CanvasRendererStroke.ts","../src/renderer/canvas/CanvasRendererText.ts","../src/renderer/canvas/CanvasRenderer.ts","../src/renderer/svg/SVGRendererConst.ts","../src/renderer/svg/SVGBuilder.ts","../src/renderer/svg/SVGRendererEdgeUtil.ts","../src/renderer/svg/SVGRendererEraserUtil.ts","../src/renderer/svg/SVGRendererDecoratorUtil.ts","../src/renderer/svg/SVGRendererShapeUtil.ts","../src/renderer/svg/SVGRendererStrokeUtil.ts","../src/renderer/svg/SVGRendererTextUtil.ts","../src/renderer/svg/SVGRendererRecognizedUtil.ts","../src/renderer/svg/SVGRendererGroupUtil.ts","../src/renderer/svg/SVGRenderer.ts","../src/renderer/svg/SVGStroker.ts","../src/renderer/svg/SVGSSRenderer.ts","../src/renderer/RendererConfiguration.ts","../src/grabber/GrabberConfiguration.ts","../src/grabber/PointerEventGrabber.ts","../src/manager/AbstractWriterManager.ts","../src/manager/IIConversionManager.ts","../src/manager/IIResizeManager.ts","../src/manager/IIRotationManager.ts","../src/manager/IISelectionManager.ts","../src/manager/IITextManager.ts","../src/manager/IITranslateManager.ts","../src/manager/IIWriterManager.ts","../src/manager/IIDebugSVGManager.ts","../src/manager/IIMoveManager.ts","../src/manager/IDebugSVGManager.ts","../src/manager/EraseManager.ts","../src/history/HistoryContext.ts","../src/history/HistoryManager.ts","../src/history/IIHistoryManager.ts","../src/history/IHistoryManager.ts","../src/history/HistoryConfiguration.ts","../src/menu/MenuHelper.ts","../src/menu/IIMenu.ts","../src/gesture/Gesture.ts","../src/gesture/GestureConfiguration.ts","../src/gesture/IIGestureManager.ts","../src/menu/IIMenuSub.ts","../src/menu/IIMenuAction.ts","../src/menu/IIMenuTool.ts","../src/menu/IIMenuStyle.ts","../src/menu/IIMenuContext.ts","../src/menu/MenuConfiguration.ts","../src/menu/IIMenuManager.ts","../src/snap/IISnapConfiguration.ts","../src/snap/IISnapManager.ts","../src/editor/InteractiveInkEditorConfiguration.ts","../src/editor/InteractiveInkEditor.ts","../src/editor/EditorTriggerConfiguration.ts","../src/editor/InkEditorDeprecatedConfiguration.ts","../src/editor/InkEditorDeprecated.ts","../src/smartguide/InteractiveInkSSRSmartGuide.ts","../src/editor/InteractiveInkSSREditorConfiguration.ts","../src/editor/InteractiveInkSSREditor.ts","../src/editor/InkEditorConfiguration.ts","../src/manager/IWriterManager.ts","../src/editor/InkEditor.ts","../src/editor/Editor.ts"],"sourcesContent":["/**\n * @group Editor\n * @summary\n * List the possibilities of interactions\n */\nexport enum EditorTool\n{\n  Write = \"write\",\n  Erase = \"erase\",\n  /**\n   * @remarks only usable in the case of offscreen\n   */\n  Select = \"select\",\n  /**\n   * @remarks only usable in the case of offscreen\n   */\n  Move = \"move\"\n}\n\n/**\n * @group Editor\n * @summary\n * List all the shapes that can be drawn\n * @remarks\n * only usable in the case of offscreen\n */\nexport enum EditorWriteTool\n{\n  Pencil = \"pencil\",\n  Rectangle = \"rectangle\",\n  Rhombus = \"rhombus\",\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Triangle = \"triangle\",\n  Parallelogram = \"parallelogram\",\n  Line = \"line\",\n  Arrow = \"arrow\",\n  DoubleArrow = \"double-arrow\",\n}\n\n/**\n * @group Renderer\n * @summary\n * List all svg elements roles\n * @remarks\n * only usable in the case of offscreen\n */\nexport enum SvgElementRole\n{\n  Guide = \"guide\",\n  InteractElementsGroup = \"interact-elements-group\",\n  Translate = \"translate\",\n  Resize = \"resize\",\n  Rotate = \"rotate\",\n}\n\n/**\n * @group Renderer\n * @summary\n * List all svg elements resize direction\n * @remarks\n * only usable in the case of offscreen\n */\nexport const enum ResizeDirection\n{\n  North = \"n-resize\",\n  East = \"e-resize\",\n  South = \"s-resize\",\n  West = \"w-resize\",\n  NorthEast = \"ne-resize\",\n  NorthWest = \"nw-resize\",\n  SouthEast = \"se-resize\",\n  SouthWest = \"sw-resize\"\n}\n\n/**\n * @group Renderer\n */\nexport const SELECTION_MARGIN = 10 as const\n","\n/**\n * @group Utils\n */\nexport class DeferredPromise<T> {\n  promise: Promise<T>\n  resolve!: (value: T) => void\n  reject!: (value: Error | string) => void\n\n  isFullFilled: boolean\n  isPending: boolean\n\n\n  constructor()\n  {\n    this.isFullFilled = false\n    this.isPending = true\n\n    this.promise = new Promise((resolve, reject) =>\n    {\n      this.reject = async (v: unknown) =>\n      {\n        this.isFullFilled = true\n        this.isPending = false\n        return reject(v)\n      }\n      this.resolve = async (v: unknown) =>\n      {\n        this.isFullFilled = true\n        this.isPending = false\n        return resolve(v as T)\n      }\n    })\n  }\n}\n","/**\n * @group Utils\n */\nexport function isValidNumber(x: unknown): boolean\n{\n  if (x === undefined || x === null) return false\n  return !isNaN(parseFloat(x.toString())) && isFinite(+x)\n}\n/**\n * @group Utils\n */\nexport function isBetween(val: number, min: number, max: number): boolean\n{\n  return val >= min && val <= max\n}\n\n/**\n * @group Utils\n */\nexport function computeAverage(arr: number[]): number\n{\n  return arr.reduce((p, c) => p + c, 0) / (arr.length || 1)\n}\n","import { TBox, TPoint, TSegment } from \"../symbol\"\nimport { isBetween } from \"./math\"\n\n/**\n * @group Utils\n */\nexport function computeDistance(p1: TPoint, p2: TPoint): number\n{\n  const distance = Math.hypot(p2.y - p1.y, p2.x - p1.x)\n  return isNaN(distance) ? 0 : distance\n}\n\n/**\n * @group Utils\n * @remarks Faster than computeDistance when comparing distances (avoids sqrt)\n */\nexport function computeDistanceSquared(p1: TPoint, p2: TPoint): number\n{\n  const dx = p2.x - p1.x\n  const dy = p2.y - p1.y\n  return dx * dx + dy * dy\n}\n\n/**\n * @group Utils\n */\nexport function computeAngleAxeRadian(begin: TPoint, end: TPoint): number\n{\n  return Math.atan2(end.y - begin.y, end.x - begin.x)\n}\n\n/**\n * @group Utils\n */\nexport function createPointsOnSegment(p1: TPoint, p2: TPoint, spaceBetweenPoint = 1): TPoint[]\n{\n  const points: TPoint[] = []\n  const globalDistance = computeDistance(p1, p2)\n  let spaceWithP1 = spaceBetweenPoint\n  while (spaceWithP1 < globalDistance) {\n    const p = {\n      x: p1.x + (spaceWithP1 * (p2.x - p1.x)) / globalDistance,\n      y: p1.y + (spaceWithP1 * (p2.y - p1.y)) / globalDistance\n    }\n    points.push(p)\n    spaceWithP1 += spaceBetweenPoint\n  }\n  return points\n}\n\n/**\n * @group Utils\n */\nexport function scalaire(v1: TPoint, v2: TPoint): number\n{\n  return v1.x * v2.x + v1.y * v2.y\n}\n\n/**\n * @group Utils\n */\nexport function computeNearestPointOnSegment(p: TPoint, seg: TSegment): TPoint\n{\n  const vectP1P = { x: p.x - seg.p1.x, y: p.y - seg.p1.y }\n  const vectP1P2 = { x: seg.p2.x - seg.p1.x, y: seg.p2.y - seg.p1.y }\n  if (vectP1P2.x === 0 && vectP1P2.y === 0) {\n    return seg.p1\n  }\n  const scalaireP1P_P1P2 = scalaire(vectP1P, vectP1P2)\n  const scalaireP1P2_P1P2 = scalaire(vectP1P2, vectP1P2)\n\n  const t = Math.min(1, Math.max(0, scalaireP1P_P1P2 / scalaireP1P2_P1P2))\n  return { x: seg.p1.x + (vectP1P2.x * t), y: seg.p1.y + (vectP1P2.y * t) }\n}\n\n/**\n * @group Utils\n */\nexport function isPointInsideBox(point: TPoint, box: TBox): boolean\n{\n  return isBetween(point.x, box.x, box.x + box.width) && isBetween(point.y, box.y, box.y + box.height)\n}\n\n/**\n * @group Utils\n */\nexport function convertRadianToDegree(radian: number): number\n{\n  return +((radian % (2 * Math.PI)) / Math.PI * 180).toFixed(4)\n}\n\n/**\n * @group Utils\n */\nexport function convertDegreeToRadian(degree: number): number\n{\n  return +((degree % 360) / 180 * Math.PI).toFixed(4)\n}\n\n/**\n * @group Utils\n */\nexport function computeRotatedPoint(point: TPoint, center: TPoint, radian: number): TPoint\n{\n  const dx = point.x - center.x\n  const dy = point.y - center.y\n  const cos = Math.cos(radian)\n  const sin = Math.sin(radian)\n  return {\n    x: +(center.x + cos * dx - sin * dy).toFixed(3),\n    y: +(center.y + sin * dx + cos * dy).toFixed(3)\n  }\n}\n\n/**\n * @group Utils\n */\nexport function computePointOnEllipse(center: TPoint, radiusX: number, radiusY: number, phi: number, theta: number): TPoint\n{\n  const cosPhi = Math.cos(phi)\n  const sinPhi = Math.sin(phi)\n\n  const M = Math.abs(radiusX) * Math.cos(theta)\n  const N = Math.abs(radiusY) * Math.sin(theta)\n\n  return {\n    x: +(center.x + cosPhi * M - sinPhi * N).toFixed(3),\n    y: +(center.y + sinPhi * M + cosPhi * N).toFixed(3)\n  }\n}\n\n/**\n * @group Utils\n */\nexport function computeDistanceBetweenPointAndSegment(p: TPoint, seg: TSegment): number\n{\n  return computeDistance(p, computeNearestPointOnSegment(p, seg))\n}\n\n/**\n * @group Utils\n */\nexport function findIntersectionBetween2Segment(seg1: TSegment, seg2: TSegment): TPoint | undefined\n{\n\n  if (seg1.p1.x === seg2.p1.x && seg1.p1.y === seg2.p1.y) return seg1.p1\n  if (seg1.p1.x === seg2.p2.x && seg1.p1.y === seg2.p2.y) return seg1.p1\n\n  if (seg1.p2.x === seg2.p1.x && seg1.p2.y === seg2.p1.y) return seg1.p2\n  if (seg1.p2.x === seg2.p2.x && seg1.p2.y === seg2.p2.y) return seg1.p2\n\n  const S1dx = seg1.p2.x - seg1.p1.x\n  const S1dy = seg1.p2.y - seg1.p1.y\n\n  const S2dx = seg2.p2.x - seg2.p1.x\n  const S2dy = seg2.p2.y - seg2.p1.y\n\n  const S1S2dx = seg1.p1.x - seg2.p1.x\n  const S1S2dy = seg1.p1.y - seg2.p1.y\n\n  const ua_t = S2dx * S1S2dy - S2dy * S1S2dx\n  const ub_t = S1dx * S1S2dy - S1dy * S1S2dx\n  const u_b = S2dy * S1dx - S2dx * S1dy\n\n  if (ua_t === 0 || ub_t === 0 || u_b === 0) return\n\n  const ua = ua_t / u_b\n  const ub = ub_t / u_b\n  if (isBetween(ua, 0, 1) && isBetween(ub, 0, 1)) {\n    return {\n      x: seg1.p1.x + ua * S1dx,\n      y: seg1.p1.y + ua * S1dy\n    }\n  }\n  return\n}\n\n/**\n * @group Utils\n */\nexport function findIntersectBetweenSegmentAndCircle(seg: TSegment, c: TPoint, r: number): TPoint[]\n{\n  const result: TPoint[] = []\n\n  const dx = seg.p2.x - seg.p1.x\n  const dy = seg.p2.y - seg.p1.y\n  const fx = seg.p1.x - c.x\n  const fy = seg.p1.y - c.y\n\n  const a = dx * dx + dy * dy\n  const b = 2 * (dx * fx + dy * fy)\n  const cc = fx * fx + fy * fy - r * r\n  const deter = Math.pow(b, 2) - 4 * a * cc\n\n  if (deter <= 0) return []\n\n  const e = Math.sqrt(deter)\n  const u1 = (-b + e) / (2 * a)\n  const u2 = (-b - e) / (2 * a)\n\n  if ((u1 < 0 || u1 > 1) && (u2 < 0 || u2 > 1)) {\n    return result\n  }\n\n  if (isBetween(u1, 0, 1)) {\n    result.push({\n      x: (seg.p2.x - seg.p1.x) * u1 + seg.p1.x,\n      y: (seg.p2.y - seg.p1.y) * u1 + seg.p1.y\n    })\n  }\n\n  if (isBetween(u2, 0, 1)) {\n    result.push({\n      x: (seg.p2.x - seg.p1.x) * u2 + seg.p1.x,\n      y: (seg.p2.y - seg.p1.y) * u2 + seg.p1.y\n    })\n  }\n\n  return result\n}\n\n/**\n * @group Utils\n */\nexport function computeAngleRadian(p1: TPoint, center: TPoint, p2: TPoint): number\n{\n  const p1c = Math.hypot(center.x - p1.x, center.y - p1.y)\n  const p2c = Math.hypot(center.x - p2.x, center.y - p2.y)\n  const p1p2 = Math.hypot(p2.x - p1.x, p2.y - p1.y)\n  return Math.acos((p2c * p2c + p1c * p1c - p1p2 * p1p2) / (2 * p2c * p1c))\n}\n\n/**\n * @group Utils\n */\nexport function getClosestPoints(points1: TPoint[], points2: TPoint[]): { p1: TPoint, p2: TPoint }\n{\n  let minDistanceSquared = Number.MAX_SAFE_INTEGER\n  let result = { p1: points1[0], p2: points2[0] }\n\n  for (const _p1 of points1) {\n    for (const _p2 of points2) {\n      const dSquared = computeDistanceSquared(_p1, _p2)\n      if (dSquared < minDistanceSquared) {\n        minDistanceSquared = dSquared\n        result = { p1: _p1, p2: _p2 }\n      }\n    }\n  }\n  return result\n}\n\n/**\n * @group Utils\n */\nexport function getClosestPoint(points: TPoint[], point: TPoint): { point?: TPoint, index: number }\n{\n  let minDistanceSquared = Number.MAX_SAFE_INTEGER\n  let closest: TPoint | undefined\n  let index = -1\n\n  for (let i = 0; i < points.length; i++) {\n    const dSquared = computeDistanceSquared(points[i], point)\n    if (dSquared < minDistanceSquared) {\n      minDistanceSquared = dSquared\n      closest = points[i]\n      index = i\n    }\n  }\n  return { point: closest, index }\n}\n\n/**\n * @group Utils\n */\nexport function isPointInsidePolygon(point: TPoint, points: TPoint[])\n{\n  let inside = false\n  for (let i = 0, j = points.length - 1; i < points.length; j = i++) {\n    const p1 = points[i]\n    const p2 = points[j]\n    const intersect = ((p1.y > point.y) != (p2.y > point.y))\n      && (point.x < (p2.x - p1.x) * (point.y - p1.y) / (p2.y - p1.y) + p1.x)\n    if (intersect) inside = !inside\n  }\n\n  return inside\n}\n","\n/**\n * @group Utils\n */\nexport const isVersionSuperiorOrEqual = (source: string, target: string): boolean =>\n{\n  const sourceParts = source.split(\".\")\n  const targetParts = target.split(\".\")\n\n  for (let i = 0; i < targetParts.length; i++) {\n    const a = Number(targetParts[i])\n    const b = Number(sourceParts[i])\n    if (a > b) return false\n    if (a < b) return true\n  }\n  return true\n}\n","/**\n * @group Utils\n */\nexport async function computeHmac(message: string, applicationKey: string, hmacKey: string): Promise<string>\n{\n  const enc = new TextEncoder()\n  const messageEncoded = enc.encode(message)\n  const keyEncoded = enc.encode(applicationKey + hmacKey)\n\n  const key = await crypto.subtle.importKey(\n    \"raw\",\n    keyEncoded,\n    {\n      name: \"HMAC\",\n      hash: { name: \"SHA-512\" }\n    },\n    false,\n    [\"sign\"]\n  )\n\n  const signature = await crypto.subtle.sign(\n    \"HMAC\",\n    key,\n    messageEncoded\n  )\n\n  const buffer = new Uint8Array(signature)\n  return Array.prototype.map.call(buffer, x => x.toString(16).padStart(2, \"0\")).join(\"\")\n}\n","import { TBox } from \"../symbol\"\n\nconst MM_TO_PX_RATIO = 96 / 25.4\nconst PX_TO_MM_RATIO = 25.4 / 96\n\n/**\n * @group Utils\n */\nexport function convertMillimeterToPixel(mm: number): number\n{\n  return +(mm * MM_TO_PX_RATIO).toFixed(3)\n}\n\n/**\n * @group Utils\n */\nexport function convertPixelToMillimeter(px: number): number\n{\n  return +(px * PX_TO_MM_RATIO).toFixed(3)\n}\n\n/**\n * @group Utils\n */\nexport function convertBoundingBoxMillimeterToPixel(box?: TBox): TBox\n{\n  if (!box) {\n    return { height: 0, width: 0, x: 0, y: 0}\n  }\n  return {\n    x: convertMillimeterToPixel(box.x),\n    y: convertMillimeterToPixel(box.y),\n    width: convertMillimeterToPixel(box.width),\n    height: convertMillimeterToPixel(box.height),\n  }\n}\n","\n/**\n * @group Utils\n */\nexport function createUUID(): string\n{\n  let dt = Date.now()\n  const uuid = \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function (c)\n  {\n    const r = (dt + Math.random() * 16) % 16 | 0\n    dt = Math.floor(dt / 16)\n    return (c == \"x\" ? r : (r & 0x3 | 0x8)).toString(16)\n  })\n  return uuid\n}\n","\n/**\n * @group Utils\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const mergeDeep = (target: any, ...sources: any[]): any =>\n{\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const isObject = (item: any) =>\n  {\n    return (item && typeof item === \"object\" && !Array.isArray(item))\n  }\n  if (!sources.length) return target\n  const source = sources.shift()\n\n  if (isObject(target) && isObject(source)) {\n    for (const key in source) {\n      if (isObject(source[key])) {\n        if (!target[key]) {\n          Object.assign(target, { [key]: {} })\n        }\n        mergeDeep(target[key], source[key])\n      }\n      else if (Array.isArray(target[key]) && Array.isArray(source[key])) {\n        target[key] = target[key].concat(source[key])\n      }\n      else {\n        Object.assign(target, { [key]: source[key] })\n      }\n    }\n  }\n  else if (Array.isArray(target) && Array.isArray(source)) {\n    target = target.concat(source)\n  }\n  else if (source) {\n    target = source\n  }\n\n  return mergeDeep(target, ...sources)\n}\n\n/**\n * @group Utils\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const isDeepEqual = (object1: any, object2: any) =>\n{\n  const objKeys1 = Object.keys(object1)\n  const objKeys2 = Object.keys(object2)\n\n  if (objKeys1.length !== objKeys2.length) return false\n\n  for (const key of objKeys1) {\n    const value1 = object1[key]\n    const value2 = object2[key]\n\n    const isObjects = isObject(value1) && isObject(value2)\n\n    if (\n      (isObjects && !isDeepEqual(value1, value2)) ||\n      (!isObjects && value1 !== value2)\n    ) {\n      return false\n    }\n  }\n  return true\n}\n\n/**\n * @group Utils\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst isObject = (object: any) =>\n{\n  return object && typeof object === \"object\"\n}\n","import { TServerHTTPConfiguration } from \"../recognizer\"\nimport { PartialDeep } from \"./types\"\n\n/**\n * @group Utils\n */\nexport async function getAvailableFontList(configuration: PartialDeep<{ server: TServerHTTPConfiguration, recognition: { lang: string }}>): Promise<Array<string>>\n{\n  if (!configuration?.server?.scheme && !configuration?.server?.host) {\n    return Promise.reject(\"Failed to get fonts: configuration.server.scheme & configuration.server.host are required!\")\n  }\n  if (!configuration?.recognition?.lang) {\n    return Promise.reject(\"Failed to get fonts: configuration.recognition.lang is required!\")\n  }\n  const serverConfig = configuration.server\n  const response = await fetch(`${ serverConfig.scheme }://${ serverConfig.host }/api/v4.0/iink/font/google/language/` + configuration.recognition.lang)\n  const { result } = await response.json()\n  return result.sort()\n}\n","import { TServerHTTPConfiguration } from \"../recognizer\"\nimport { PartialDeep } from \"./types\"\n\n/**\n * @group Utils\n */\nexport async function getAvailableLanguageList(configuration: PartialDeep<{ server: TServerHTTPConfiguration }>): Promise<{ result: { [key: string]: string } }>\n{\n  if (configuration?.server?.scheme && configuration?.server?.host) {\n    const serverConfig = configuration.server\n    const response = await fetch(`${ serverConfig.scheme }://${ serverConfig.host }/api/v4.0/iink/availableLanguageList`)\n    return response.json()\n  } else {\n    return Promise.reject(\"Failed to get languages: configuration.server.scheme & configuration.server.host are required!\")\n  }\n}\n","import { TPoint, TPointer } from \"../symbol\"\n\n/**\n * @group Utils\n */\nexport function computeLinksPointers(point: TPointer, angle: number, width: number): TPoint[]\n{\n  const radius = point.p * width\n  return [\n    {\n      x: +(point.x - (Math.sin(angle) * radius)).toFixed(3),\n      y: +(point.y + (Math.cos(angle) * radius)).toFixed(3)\n    },\n    {\n      x: +(point.x + (Math.sin(angle) * radius)).toFixed(3),\n      y: +(point.y - (Math.cos(angle) * radius)).toFixed(3),\n    }\n  ]\n}\n\n/**\n * @group Utils\n */\nexport function computeMiddlePointer(point1: TPointer, point2: TPointer): TPointer\n{\n  return {\n    x: +((point2.x + point1.x) / 2).toFixed(3),\n    y: +((point2.y + point1.y) / 2).toFixed(3),\n    p: +((point2.p + point1.p) / 2).toFixed(3),\n    t: +((point2.t + point1.t) / 2).toFixed(3),\n  }\n}\n","import { TServerHTTPConfiguration } from \"../recognizer\"\nimport { PartialDeep } from \"./types\"\n\n/**\n * @group Utils\n */\nexport type TApiInfos = {\n  version: string,\n  gitCommit: string,\n  nativeVersion: string\n}\n\n/**\n * @group Utils\n */\nexport async function getApiInfos(configuration?: PartialDeep<{ server: TServerHTTPConfiguration }>): Promise<TApiInfos>\n{\n  try {\n    if (!configuration?.server?.scheme && !configuration?.server?.host) {\n      return Promise.reject(\"Failed to get infos: configuration.server.scheme & configuration.server.host are required!\")\n    }\n    const response = await fetch(`${ configuration.server.scheme }://${ configuration.server.host }/api/v4.0/iink/version`)\n    if (response.ok) {\n      const version = await response.json() as TApiInfos\n      return version\n    }\n    else {\n      //latest version published before this endpoint\n      return { version: \"3.1.3\", gitCommit: \"unknown\", nativeVersion: \"<=3.1.1\" }\n    }\n\n  } catch {\n    //latest version published before this endpoint\n    return { version: \"3.1.3\", gitCommit: \"7e148bd566438ca77dc83cb4edcc6ed0f51a8a15\", nativeVersion: \"<=3.1.1\" }\n   }\n\n}\n","/**\n * @group Logger\n */\nexport enum LoggerLevel\n{\n  DEBUG = \"1\",\n  INFO = \"2\",\n  WARN = \"3\",\n  ERROR = \"4\"\n}\n\n/**\n * @group Logger\n */\nexport enum LoggerCategory\n{\n  EDITOR = \"EDITOR\",\n  RECOGNIZER = \"RECOGNIZER\",\n  GRABBER = \"GRABBER\",\n  GESTURE = \"GESTURE\",\n  EDITOR_EVENT = \"EDITOR_EVENT\",\n  MODEL = \"MODEL\",\n  RENDERER = \"RENDERER\",\n  SMARTGUIDE = \"SMARTGUIDE\",\n  STYLE = \"STYLE\",\n  HISTORY = \"HISTORY\",\n  SYMBOL = \"SYMBOL\",\n  WRITE = \"WRITE\",\n  TRANSFORMER = \"TRANSFORMER\",\n  CONVERTER = \"CONVERTER\",\n  SELECTION = \"SELECTION\",\n  SVGDEBUG = \"SVGDEBUG\",\n  MENU = \"MENU\"\n}\n\n/**\n * @group Logger\n */\nexport class Logger\n{\n  category: LoggerCategory\n  level: LoggerLevel\n\n  constructor(category: LoggerCategory, level: LoggerLevel)\n  {\n    this.category = category\n    this.level = level\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  debug(functionName: string, ...data: any)\n  {\n    if (LoggerLevel.DEBUG >= this.level) {\n      const dataLog = {\n        level: \"debug\",\n        from: `${ this.category }.${ functionName }`,\n        message: data,\n      }\n      console.debug(dataLog)\n    }\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  info(functionName: string, ...data: any)\n  {\n    if (LoggerLevel.INFO >= this.level) {\n      const dataLog = {\n        level: \"info\",\n        from: `${ this.category }.${ functionName }`,\n        message: data,\n      }\n      console.info(dataLog)\n    }\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  warn(functionName: string, ...data: any)\n  {\n    if (LoggerLevel.WARN >= this.level) {\n      const dataLog = {\n        level: \"warn\",\n        from: `${ this.category }.${ functionName }`,\n        message: data,\n      }\n      console.warn(dataLog)\n    }\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  error(functionName: string, ...error: any)\n  {\n    const dataLog = {\n      level: \"error\",\n      from: `${ this.category }.${ functionName }`,\n      message: error,\n    }\n    console.error(dataLog)\n  }\n}\n","import { TLoggerConfiguration } from \"./LoggerConfiguration\"\nimport { Logger, LoggerCategory, LoggerLevel } from \"./logger\"\n\n/**\n * @group Logger\n */\nexport class LoggerManager\n{\n  static #loggerMap: Map<LoggerCategory, Logger> = new Map()\n\n  static getLogger(name: LoggerCategory): Logger\n  {\n    if (!this.#loggerMap.has(name)) {\n      this.#loggerMap.set(name, new Logger(name, LoggerLevel.ERROR))\n    }\n    return this.#loggerMap.get(name) as Logger\n  }\n\n  static setLoggerLevel(config: TLoggerConfiguration)\n  {\n    for (const lc in config) {\n      LoggerManager.getLogger(lc as LoggerCategory).level = config[lc as LoggerCategory]\n    }\n  }\n}\n","import { LoggerCategory, LoggerLevel } from \"./logger\"\n\n/**\n * @group Logger\n */\nexport type TLoggerConfiguration = {\n  [key in keyof typeof LoggerCategory]: LoggerLevel\n}\n\n/**\n * @group Logger\n * @source\n */\nexport const DefaultLoggerConfiguration: TLoggerConfiguration = {\n  [LoggerCategory.EDITOR]: LoggerLevel.ERROR,\n  [LoggerCategory.RECOGNIZER]: LoggerLevel.ERROR,\n  [LoggerCategory.GRABBER]: LoggerLevel.ERROR,\n  [LoggerCategory.RENDERER]: LoggerLevel.ERROR,\n  [LoggerCategory.EDITOR_EVENT]: LoggerLevel.ERROR,\n  [LoggerCategory.MODEL]: LoggerLevel.ERROR,\n  [LoggerCategory.SYMBOL]: LoggerLevel.ERROR,\n  [LoggerCategory.SMARTGUIDE]: LoggerLevel.ERROR,\n  [LoggerCategory.GESTURE]: LoggerLevel.ERROR,\n  [LoggerCategory.STYLE]: LoggerLevel.ERROR,\n  [LoggerCategory.HISTORY]: LoggerLevel.ERROR,\n  [LoggerCategory.TRANSFORMER]: LoggerLevel.ERROR,\n  [LoggerCategory.CONVERTER]: LoggerLevel.ERROR,\n  [LoggerCategory.WRITE]: LoggerLevel.ERROR,\n  [LoggerCategory.SELECTION]: LoggerLevel.ERROR,\n  [LoggerCategory.SVGDEBUG]: LoggerLevel.ERROR,\n  [LoggerCategory.MENU]: LoggerLevel.ERROR,\n}\n","import { EditorTool } from \"../Constants\"\nimport { LoggerManager, LoggerCategory } from \"../logger\"\nimport { TExport, TExportV2 } from \"../model\"\nimport { IIStroke, TIISymbol, TSymbol } from \"../symbol\"\nimport { THistoryContext } from \"../history\"\nimport { TGestureType } from \"../gesture\"\n\n/**\n * @group Editor\n * @remarks Lists all events that can be listened to on the editor or DOM element\n * @example\n * You can run code on \"EditorEventName\" raised by using\n * ```ts\n * editor.event.addEventListener(EditorEventName.CHANGED, (evt) => console.log(evt.detail))\n * ```\n */\nexport enum EditorEventName\n{\n  /**\n   * @remarks event emitted when history has changed i.e. the context of undo-redo\n   */\n  CHANGED = \"changed\",\n  /**\n   * @remarks event emitted when clearing is complete\n   */\n  CLEARED = \"cleared\",\n  /**\n   * @remarks event emitted after the conversion is complete\n   */\n  CONVERTED = \"converted\",\n  /**\n   * @remarks event emitted when the editor encounters an error\n   */\n  ERROR = \"error\",\n  /**\n   * @remarks event emitted on click on pointer events\n   */\n  POINTEREVENTS = \"pointer_events\",\n  /**\n   * @remarks event emitted after\n   */\n  NOTIF = \"notif\",\n  /**\n   * @remarks event emitted after the end of the export\n   */\n  EXPORTED = \"exported\",\n  /**\n   * @remarks event emitted after the end of the import\n   */\n  IMPORTED = \"imported\",\n  /**\n   * @remarks event emitted when the server is idle after a job\n   */\n  IDLE = \"idle\",\n  /**\n   * @remarks event emitted after full editor initialization\n   */\n  LOADED = \"loaded\",\n  /**\n   * @remarks event emitted session opened\n   */\n  SESSION_OPENED = \"session-opened\",\n  /**\n   * @remarks event emitted after selection change\n   */\n  SELECTED = \"selected\",\n  /**\n   * @remarks event emitted after tool change\n   */\n  TOOL_CHANGED = \"tool-changed\",\n  /**\n   * @remarks event emitted after mode change\n   */\n  UI_UPDATED = \"ui-updated\",\n  /**\n   * @remarks event emitted after stroke synchronized with jiix\n   */\n  SYNCHRONIZED = \"synchronized\",\n  /**\n   * @remarks event emitted after applying a gesture\n   */\n  GESTURED = \"gestured\"\n}\n\n/**\n * @group Editor\n */\nexport class EditorEvent extends EventTarget\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.EDITOR_EVENT);\n  protected abortController: AbortController\n  element: Element\n\n  constructor(element: Element)\n  {\n    super()\n    this.#logger.info(\"constructor\", { element })\n    this.abortController = new AbortController()\n    this.element = element\n  }\n\n  removeAllListeners(): void\n  {\n    this.#logger.info(\"removeAllListeners\")\n    this.abortController.abort()\n    this.abortController = new AbortController()\n  }\n\n  protected emit(type: string, data?: unknown): void\n  {\n    const evt = new CustomEvent(type, Object.assign({ bubbles: true, composed: true }, data ? { detail: data } : undefined))\n    this.dispatchEvent(evt)\n    this.element?.dispatchEvent(evt)\n  }\n\n  emitSessionOpened(sessionId: string): void\n  {\n    this.#logger.info(\"emitSessionOpened\")\n    this.emit(EditorEventName.SESSION_OPENED, sessionId)\n  }\n  addSessionOpenedListener(callback: (sessionId: string) => void): void\n  {\n    this.#logger.info(\"addSessionOpenedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.SESSION_OPENED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as string),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitLoaded(): void\n  {\n    this.#logger.info(\"emitLoaded\")\n    this.emit(EditorEventName.LOADED)\n  }\n  addLoadedListener(callback: () => void): void\n  {\n    this.#logger.info(\"addLoadedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.LOADED,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitNotif(notif: { message: string; timeout?: number }): void\n  {\n    this.#logger.info(\"emitNotif\", { notif })\n    this.emit(EditorEventName.NOTIF, notif)\n  }\n  addNotifListener(callback: (notif: { message: string; timeout?: number }) => void): void\n  {\n    this.#logger.info(\"addNotifListener\", { callback })\n    this.addEventListener(\n      EditorEventName.NOTIF,\n      (evt: unknown) => callback((evt as CustomEvent).detail as { message: string; timeout?: number }),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitError(err: Error): void\n  {\n    this.#logger.info(\"emitError\", { err })\n    this.emit(EditorEventName.ERROR, err)\n  }\n  addErrorListener(callback: (err: Error) => void): void\n  {\n    this.#logger.info(\"addErrorListener\", { callback })\n    this.addEventListener(\n      EditorEventName.ERROR,\n      (evt: unknown) => callback((evt as CustomEvent).detail as Error),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitExported(exports: TExport | TExportV2): void\n  {\n    this.#logger.info(\"emitExported\", { exports })\n    this.emit(EditorEventName.EXPORTED, exports)\n  }\n  addExportedListener(callback: (exports: TExport | TExportV2) => void): void\n  {\n    this.#logger.info(\"addExportedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.EXPORTED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TExport | TExportV2),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitChanged(undoRedoContext: THistoryContext): void\n  {\n    this.#logger.info(\"emitChanged\", { undoRedoContext })\n    this.emit(EditorEventName.CHANGED, {\n      ...undoRedoContext,\n      canClear: !undoRedoContext.empty\n    })\n  }\n  addChangedListener(callback: (context: THistoryContext) => void): void\n  {\n    this.#logger.info(\"addChangedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.CHANGED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as THistoryContext),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitIdle(idle: boolean): void\n  {\n    this.#logger.info(\"emitIdle\", { idle })\n    this.emit(EditorEventName.IDLE, idle)\n  }\n  addIdleListener(callback: (idle: boolean) => void): void\n  {\n    this.#logger.info(\"addIdleListener\", { callback })\n    this.addEventListener(\n      EditorEventName.IDLE,\n      (evt: unknown) => callback((evt as CustomEvent).detail as boolean),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitCleared(): void\n  {\n    this.#logger.info(\"emitCleared\")\n    this.emit(EditorEventName.CLEARED)\n  }\n  addClearedListener(callback: () => void): void\n  {\n    this.#logger.info(\"addClearedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.CLEARED,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitConverted(exports: TExport): void\n  {\n    this.#logger.info(\"emitConverted\", { exports })\n    this.emit(EditorEventName.CONVERTED, exports)\n  }\n  addConvertedListener(callback: (exports: TExport) => void): void\n  {\n    this.#logger.info(\"addConvertedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.CONVERTED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TExport),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitImported(exports: TExport): void\n  {\n    this.#logger.info(\"emitImported\", { exports })\n    this.emit(EditorEventName.IMPORTED, exports)\n  }\n  addImportedListener(callback: (exports: TExport) => void): void\n  {\n    this.#logger.info(\"addImportedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.IMPORTED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TExport),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitSelected(symbols: TSymbol[]): void\n  {\n    this.#logger.info(\"emitSelected\")\n    this.emit(EditorEventName.SELECTED, symbols)\n  }\n  addSelectedListener(callback: (symbols: TIISymbol[]) => void): void\n  {\n    this.#logger.info(\"addSelectedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.SELECTED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TIISymbol[]),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitToolChanged(mode: EditorTool): void\n  {\n    this.#logger.info(\"emitToolChanged\")\n    this.emit(EditorEventName.TOOL_CHANGED, mode)\n  }\n  addToolChangedListener(callback: (mode: EditorTool) => void): void\n  {\n    this.#logger.info(\"addToolChangedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.TOOL_CHANGED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as EditorTool),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitUIpdated(): void\n  {\n    this.#logger.info(\"emitUIpdated\")\n    this.emit(EditorEventName.UI_UPDATED)\n  }\n  addUIpdatedListener(callback: () => void): void\n  {\n    this.#logger.info(\"addUIpdatedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.UI_UPDATED,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitSynchronized(): void\n  {\n    this.#logger.info(\"emitSynchronized\")\n    this.emit(EditorEventName.SYNCHRONIZED)\n  }\n  addSynchronizedListener(callback: () => void): void\n  {\n    this.#logger.info(\"addSynchronizedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.SYNCHRONIZED,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitGestured(gesture: { gestureType: TGestureType, stroke: IIStroke }): void\n  {\n    this.#logger.info(\"emitSynchronized\")\n    this.emit(EditorEventName.GESTURED, gesture)\n  }\n  addGesturedListener(callback: (gesture: { gestureType: TGestureType, stroke: IIStroke }) => void): void\n  {\n    this.#logger.info(\"addSynchronizedListener\", { callback })\n    this.addEventListener(\n      EditorEventName.GESTURED,\n      (evt) => callback((evt as CustomEvent).detail as { gestureType: TGestureType, stroke: IIStroke }),\n      { signal: this.abortController.signal }\n    )\n  }\n}\n","import { EdgeDecoration, TBox, TPoint } from \"../symbol\"\n\n/**\n * @group Exports\n * @remarks List all supported MIME types for export. Please note, the MIME types supported depend on the recognition type configured\n */\nexport enum ExportType\n{\n  JIIX = \"application/vnd.myscript.jiix\",\n  TEXT = \"text/plain\",\n  LATEX = \"application/x-latex\",\n  MATHML = \"application/mathml+xml\",\n  SVG = \"image/svg+xml\",\n  OFFICE_DOCUMENT = \"application/vnd.openxmlformats-officedocument.presentationml.presentation\"\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix  Element type}\n */\nexport enum JIIXELementType\n{\n  Text = \"Text\",\n  Node = \"Node\",\n  Edge = \"Edge\",\n  RawContent = \"Raw Content\",\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#diagram-item-blocks | Element node kind}\n */\nexport enum JIIXNodeKind\n{\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Rectangle = \"rectangle\",\n  Triangle = \"triangle\",\n  Parallelogram = \"parallelogram\",\n  Polygon = \"polygon\",\n  Rhombus = \"rhombus\",\n}\n\n/**\n * @group Exports\n */\nexport enum JIIXEdgeKind\n{\n  Line = \"line\",\n  PolyEdge = \"polyedge\",\n  Arc = \"arc\",\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#stroke-item | Stroke item}\n */\nexport type TJIIXStrokeItem = {\n  type: \"stroke\"\n  id: string\n  \"full-id\"?: string\n  timestamp?: string\n  X?: number[]\n  Y?: number[]\n  F?: number[]\n  T?: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXBase = {\n  \"bounding-box\"?: TBox\n  items?: TJIIXStrokeItem[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXElementBase<T = string> = TJIIXBase & {\n  id: string\n  type: T\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#word-object | Word object}\n */\nexport type TJIIXWord = TJIIXBase & {\n  id?: string\n  label: string\n  candidates?: string[]\n  \"first-char\"?: number\n  \"last-char\"?: number\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#character-object | Character object}\n */\nexport type TJIIXChar = TJIIXBase & {\n  label: string\n  candidates?: string[]\n  word: number\n  grid: TPoint[]\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#text-interpretation | Text Element }\n */\nexport type TJIIXLine = {\n  \"baseline-y\": number\n  \"first-char\"?: number\n  \"last-char\"?: number\n  \"x-height\": number\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#text-interpretation | Text Element }\n */\nexport type TJIIXTextElement = TJIIXElementBase<JIIXELementType.Text> & {\n  id: string\n  \"bounding-box\"?: TBox\n  label: string\n  words?: TJIIXWord[]\n  chars?: TJIIXChar[]\n  lines?: TJIIXLine[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeElementBase<K = string> = TJIIXElementBase<JIIXELementType.Node> & {\n  id: string\n  kind: K\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeCircle = TJIIXNodeElementBase<JIIXNodeKind.Circle> & {\n  id: string\n  cx: number\n  cy: number\n  r: number\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeEllipse = TJIIXNodeElementBase<JIIXNodeKind.Ellipse> & {\n  id: string\n  cx: number\n  cy: number\n  rx: number\n  ry: number\n  orientation: number\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeRectangle = TJIIXNodeElementBase<JIIXNodeKind.Rectangle> & {\n  id: string\n  height: number\n  width: number\n  x: number\n  y: number\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeTriangle = TJIIXNodeElementBase<JIIXNodeKind.Triangle> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeParrallelogram = TJIIXNodeElementBase<JIIXNodeKind.Parallelogram> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodePolygon = TJIIXNodeElementBase<JIIXNodeKind.Polygon> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeRhombus = TJIIXNodeElementBase<JIIXNodeKind.Rhombus> & {\n  id: string\n  points: number[]\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXNodeElement =\n  TJIIXNodeCircle |\n  TJIIXNodeEllipse |\n  TJIIXNodeRectangle |\n  TJIIXNodeTriangle |\n  TJIIXNodeParrallelogram |\n  TJIIXNodePolygon |\n  TJIIXNodeRhombus\n\n/**\n * @group Exports\n */\nexport type TJIIXEdgeElementBase<K = string> = TJIIXElementBase<JIIXELementType.Edge> & {\n  kind: K\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#line-item | Element line}\n */\nexport type TJIIXEdgeLine = TJIIXEdgeElementBase<JIIXEdgeKind.Line> & {\n  x1: number\n  x2: number\n  y1: number\n  y2: number\n  p1Decoration?: EdgeDecoration\n  p2Decoration?: EdgeDecoration\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXEdgePolyEdge = TJIIXEdgeElementBase<JIIXEdgeKind.PolyEdge> & {\n  edges: TJIIXEdgeLine[]\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#arc-item | Element arc}\n */\nexport type TJIIXEdgeArc = TJIIXEdgeElementBase<JIIXEdgeKind.Arc> & {\n  cx: number,\n  cy: number,\n  rx: number,\n  ry: number,\n  phi: number,\n  startAngle: number,\n  sweepAngle: number\n  startDecoration?: EdgeDecoration\n  endDecoration?: EdgeDecoration\n}\n\n/**\n * @group Exports\n */\nexport type TJIIXEdgeElement =\n  TJIIXEdgeLine |\n  TJIIXEdgePolyEdge |\n  TJIIXEdgeArc\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/web/jiix | Exports}\n */\nexport type TJIIXElement =\n  TJIIXTextElement |\n  TJIIXNodeElement |\n  TJIIXEdgeElement\n\n/**\n * @group Exports\n */\nexport type TJIIXExport = {\n  type: string\n  id: string\n  \"bounding-box\"?: TBox\n  version: string\n  elements?: TJIIXElement[]\n  label?: string\n  words?: TJIIXWord[]\n  chars?: TJIIXChar[]\n}\n\n/**\n * @group Exports\n * @remarks\n * List all supported MIME types for export.\n *\n * Attention the MIME types supported depend on the {@link TRecognitionType | type of recognition}\n *\n * {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix | Documentation}\n */\nexport type TExport = {\n  /** @hidden */\n  [key: string]: unknown\n  /**\n   * @remarks vnd.myscript.jiix is used for text and raw-content exports\n   */\n  \"application/vnd.myscript.jiix\"?: TJIIXExport\n  /**\n   * @remarks text/plain is only use for text export\n   */\n  \"text/plain\"?: string\n  /**\n   * @remarks x-latex is only use for math export\n   * @see {@link https://katex.org/docs/browser.html | katex} to render\n   */\n  \"application/x-latex\"?: string\n  /**\n   * @remarks mathml+xml is only use for math export\n   * @see {@link https://www.w3.org/Math/whatIsMathML.html | Mathematical Markup Language}\n   */\n  \"application/mathml+xml\"?: string\n  /**\n   * @remarks svg+xml is only use for diagram export\n   */\n  \"image/svg+xml\"?: string\n  /**\n   * @remarks vnd.openxmlformats-officedocument.presentationml.presentation is only use for diagram export\n   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/Blob | Blob}\n   */\n  \"application/vnd.openxmlformats-officedocument.presentationml.presentation\"?: Blob\n}\n","import { TRecognitionV2Type } from \"../recognizer\"\nimport { TJIIXBase, TJIIXWord } from \"./Export\"\n\n/**\n * @group Exports\n * @remarks List all supported MIME types for export in RecognizersV2. Please note, the MIME types supported depend on the recognition type configured\n */\nexport enum ExportV2Type {\n  JIIX = \"application/vnd.myscript.jiix\",\n  TEXT = \"text/plain\",\n  LATEX = \"application/x-latex\",\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix  Element type}\n */\n\n\n/**\n * @group Exports\n*/\nexport type JIIXV2RangeItem = {\n  from: { stroke: number }\n  to: { stroke: number }\n}\n\n/**\n * @group Exports\n * @remarks Only in InkRecognizer () activated with recognition.export.JIIXV2.range = true\n */\nexport type JIIXV2Range = JIIXV2RangeItem[]\n\n/**\n * @group Exports\n */\nexport type JIIXV2Base = TJIIXBase & {\n  range?: JIIXV2Range\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ElementBase<T = TRecognitionV2Type> = JIIXV2Base & {\n  id: string\n  type: T\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2LineSpan = {\n  type: string\n  range: JIIXV2RangeItem[]\n  label: string\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2Line = {\n  type: string\n  range: JIIXV2RangeItem[]\n  label: string\n  spans: JIIXV2LineSpan[]\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix/#word-object | Word object}\n */\nexport type JIIXV2Expression = JIIXV2Base & TJIIXWord & {\n  lines: JIIXV2Line[]\n}\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix#text-interpretation | Text Element }\n */\nexport type JIIXV2TextElement = JIIXV2ElementBase<\"Text\"> & JIIXV2Expression\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/jiix#text-interpretation | Math Element }\n */\nexport type JIIXV2MathElement = JIIXV2ElementBase<\"Math\"> & JIIXV2Expression\n\n/** @group Exports\n */\nexport type JIIXV2DrawingElement = JIIXV2ElementBase<\"Drawing\"> & JIIXV2Expression\n\n/**\n * @group Exports\n */\nexport enum JIIXV2ShapeKind {\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Rectangle = \"rectangle\",\n  Triangle = \"triangle\",\n  IsoscelesTriangle = \"isosceles triangle\",\n  RightTriangle = \"right triangle\",\n  RightIsoscelesTriangle = \"right isosceles triangle\",\n  EquilateralTriangle = \"equilateral triangle\",\n  Quadrilateral = \"quadrilateral\",\n  Trapezoid = \"trapezoid\",\n  Square = \"square\",\n  Parallelogram = \"parallelogram\",\n  Polygon = \"polygon\",\n  Rhombus = \"rhombus\",\n  Line = \"line\",\n  ArcOfEllipse = \"arc of ellipse\",\n  ArcOfCircle = \"arc of circle\",\n  PolyLine = \"polyline\",\n  Arrow = \"arrow\",\n  CurvedDoubleArrow = \"curved double arrow\",\n  CurvedArrow = \"curved arrow\",\n  PolylineArrow = \"polyline arrow\",\n  PolylineDoubleArrow = \"polyline double arrow\",\n  DoubleArrow = \"double arrow\",\n}\n\n/**\n   * @group Exports\n   */\nexport type JIIXV2PolygonType = \"triangle\" | \"isosceles triangle\" | \"right triangle\" | \"right isosceles triangle\" | \"equilateral triangle\" | \"quadrilateral\" | \"trapezoid\" | \"parallelogram\" | \"rhombus\" | \"rectangle\" | \"square\"\n\n/**\n   * @group Exports\n   */\nexport type JIIXV2ShapeItemBase<K = JIIXV2ShapeKind> = JIIXV2ElementBase<K> & {\n  kind: K\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2EllipseBase<K = JIIXV2ShapeKind.Ellipse | JIIXV2ShapeKind.Circle> = JIIXV2ShapeItemBase<JIIXV2ShapeKind.Ellipse | JIIXV2ShapeKind.Circle> & {\n  kind: K\n  id: string\n  cx: number\n  cy: number\n  rx: number\n  ry: number\n  orientation: number\n  type: string\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2Circle = JIIXV2EllipseBase<JIIXV2ShapeKind.Circle>\n\n/**\n * @group Exports\n */\nexport type JIIXV2Ellipse = JIIXV2EllipseBase<JIIXV2ShapeKind.Ellipse>\n\n/**\n * @group Exports\n */\nexport type JIIXV2PrimitiveArc = {\n  type: \"arc\"\n  cx: number,\n  cy: number,\n  rx: number,\n  ry: number,\n  phi: number,\n  startAngle: number,\n  sweepAngle: number\n  startDecoration?: string\n  endDecoration?: string\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2PrimitiveLine = {\n  type: \"line\"\n  x1: number\n  y1: number\n  x2: number\n  y2: number\n  startDecoration?: string\n  endDecoration?: string\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2PolygonBase<K = JIIXV2PolygonType> = JIIXV2ShapeItemBase<K> & {\n  kind: K\n  primitives: JIIXV2PrimitiveLine[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygon = JIIXV2PolygonBase<JIIXV2ShapeKind.Polygon>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonTriangle = JIIXV2PolygonBase<JIIXV2ShapeKind.Triangle>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonIsoscelesTriangle = JIIXV2PolygonBase<JIIXV2ShapeKind.IsoscelesTriangle>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonRightTriangle = JIIXV2PolygonBase<JIIXV2ShapeKind.RightTriangle>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonRightIsoscelesTriangle = JIIXV2PolygonBase<JIIXV2ShapeKind.RightIsoscelesTriangle>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonEquilateralTriangle = JIIXV2PolygonBase<JIIXV2ShapeKind.EquilateralTriangle>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonQuadrilateral = JIIXV2PolygonBase<JIIXV2ShapeKind.Quadrilateral>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonTrapezoid = JIIXV2PolygonBase<JIIXV2ShapeKind.Trapezoid>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonParallelogram = JIIXV2PolygonBase<JIIXV2ShapeKind.Parallelogram>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonRhombus = JIIXV2PolygonBase<JIIXV2ShapeKind.Rhombus>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonRectangle = JIIXV2PolygonBase<JIIXV2ShapeKind.Rectangle>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapePolygonSquare = JIIXV2PolygonBase<JIIXV2ShapeKind.Square>\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeLine = JIIXV2ShapeItemBase<JIIXV2ShapeKind.Line> & {\n  primitives: JIIXV2PrimitiveLine[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeLineArrow = JIIXV2ShapeItemBase<JIIXV2ShapeKind.Arrow> & {\n  primitives: JIIXV2PrimitiveLine[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeLineDoubleArrow = JIIXV2ShapeItemBase<JIIXV2ShapeKind.DoubleArrow> & {\n  primitives: JIIXV2PrimitiveLine[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeLinePolyline = JIIXV2ShapeItemBase<JIIXV2ShapeKind.PolyLine> & {\n  primitives: JIIXV2PrimitiveLine[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeLinePolylineArrow = JIIXV2ShapeItemBase<JIIXV2ShapeKind.PolylineArrow> & {\n  primitives: JIIXV2PrimitiveLine[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeLinePolylineDoubleArrow = JIIXV2ShapeItemBase<JIIXV2ShapeKind.PolylineDoubleArrow> & {\n  primitives: JIIXV2PrimitiveLine[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeCurvedDoubleArrow = JIIXV2ShapeItemBase<JIIXV2ShapeKind.CurvedDoubleArrow> & {\n  primitives: JIIXV2PrimitiveArc[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeCurvedArrow = JIIXV2ShapeItemBase<JIIXV2ShapeKind.CurvedArrow> & {\n  primitives: JIIXV2PrimitiveArc[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeArcOfEllipse = JIIXV2ShapeItemBase<JIIXV2ShapeKind.ArcOfEllipse> & {\n  primitives: JIIXV2PrimitiveArc[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeArcOfCircle = JIIXV2ShapeItemBase<JIIXV2ShapeKind.ArcOfCircle> & {\n  primitives: JIIXV2PrimitiveArc[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2ShapeElement = JIIXV2Circle | JIIXV2Ellipse | JIIXV2ShapePolygon | JIIXV2ShapePolygonTriangle | JIIXV2ShapePolygonIsoscelesTriangle | JIIXV2ShapePolygonRightTriangle | JIIXV2ShapePolygonRightIsoscelesTriangle | JIIXV2ShapePolygonEquilateralTriangle | JIIXV2ShapePolygonQuadrilateral | JIIXV2ShapePolygonTrapezoid | JIIXV2ShapePolygonParallelogram | JIIXV2ShapePolygonRhombus | JIIXV2ShapePolygonRectangle | JIIXV2ShapePolygonSquare | JIIXV2ShapeLineArrow | JIIXV2ShapeLineDoubleArrow | JIIXV2ShapeLinePolyline | JIIXV2ShapeLinePolylineArrow | JIIXV2ShapeLinePolylineDoubleArrow | JIIXV2ShapeCurvedDoubleArrow | JIIXV2ShapeCurvedArrow | JIIXV2ShapeArcOfEllipse | JIIXV2ShapeArcOfCircle | JIIXV2ShapeLine\n\n/**\n * @group Exports\n * @remarks Only in InkRecognizer () activated with recognition.export.JIIXV2.range = true\n */\nexport type JIIXV2RawContentBase<T = TRecognitionV2Type> = {\n  type: T\n  range?: JIIXV2Range\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2RawContentItemText = JIIXV2RawContentBase<\"Text\"> & JIIXV2Expression\n\n/**\n * @group Exports\n */\nexport type JIIXV2RawContentTextLine = {\n  type: \"Line\"\n  label: string\n  range?: JIIXV2RangeItem\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2RawContentShape = JIIXV2RawContentBase<\"Shape\"> & {\n  label: string\n  shape: JIIXV2RawContentItemShape[]\n}\n\n/**\n * @group Exports\n */\nexport type JIIXV2RawContentItemShape = JIIXV2RawContentBase<\"Shape\"> & {\n  range: JIIXV2RangeItem[]\n  elements: JIIXV2ShapeElement[]\n}\n\nexport type JIIXV2RawContentElement = JIIXV2RawContentItemText | JIIXV2RawContentItemShape\n\n/**\n * @group Exports\n * @remarks {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/web/JIIXV2 | Exports}\n */\nexport type JIIXV2Element =\n  JIIXV2TextElement |\n  JIIXV2ShapeElement |\n  JIIXV2MathElement |\n  JIIXV2DrawingElement |\n  JIIXV2RawContentElement\n\n/**\n * @group Exports\n */\nexport type JIIXV2Export = JIIXV2Base & {\n  type: string\n  id: string\n  version: string\n  elements?: JIIXV2Element[]\n  label?: string\n  words?: JIIXV2Expression[]\n}\n\n/**\n * @group Exports\n * @remarks\n * List all supported MIME types for export.\n *\n * Attention the MIME types supported depend on the {@link TRecognitionType | type of recognition}\n *\n * {@link https://developer.myscript.com/docs/interactive-ink/latest/reference/JIIXV2 | Documentation}\n */\nexport type TExportV2 = {\n  /** @hidden */\n  [key: string]: unknown\n  /**\n   * @remarks vnd.myscript.jiix is used for text and raw-content exports\n   */\n  \"application/vnd.myscript.jiix\"?: JIIXV2Export\n  /**\n   * @remarks text/plain is only use for text export\n   */\n  \"text/plain\"?: string\n  /**\n   * @remarks x-latex is only use for math export\n   * @see {@link https://katex.org/docs/browser.html | katex} to render\n   */\n  \"application/x-latex\"?: string\n}\n","\nimport style from \"../iink.css\"\n/**\n * @group Editor\n */\nexport type EditorLayerUIInfoModal = {\n  root: HTMLDivElement,\n  text: HTMLParagraphElement\n}\n\n/**\n * @group Editor\n */\nexport type EditorLayerUIMessage = {\n  root: HTMLDivElement\n  overlay: HTMLDivElement\n  modal: EditorLayerUIInfoModal\n}\n\n/**\n * @group Editor\n */\nexport type EditorLayerUIState = {\n  root: HTMLDivElement\n  busy: HTMLDivElement\n}\n\n/**\n * @group Editor\n */\nexport type EditorLayerUI = {\n  root: HTMLDivElement\n  loader: HTMLDivElement\n  message: EditorLayerUIMessage\n  state: EditorLayerUIState\n}\n\n/**\n * @group Editor\n */\nexport class EditorLayer\n{\n  root: HTMLElement\n  ui: EditorLayerUI\n  rendering: HTMLElement\n\n  onCloseModal?: (inError?: boolean) => void\n\n  constructor(root: HTMLElement, rootClassCss: string = \"ms-editor\")\n  {\n    this.root = root\n    this.root.classList.add(rootClassCss)\n    this.rendering = this.createLayerRender()\n    this.ui = this.createLayerUI()\n  }\n\n  render(): void\n  {\n    const styleElement = document.createElement(\"style\")\n    styleElement.appendChild(document.createTextNode(style as string))\n    this.root.prepend(styleElement)\n\n    this.root.appendChild(this.rendering)\n    this.root.appendChild(this.ui.root)\n  }\n\n  createLoader(): HTMLDivElement\n  {\n    const loaderHTML = document.createElement(\"div\")\n    loaderHTML.classList.add(\"loader\")\n    loaderHTML.style.display = \"none\"\n    return loaderHTML\n  }\n  showLoader(): void\n  {\n    this.ui.loader.style.display = \"block\"\n  }\n  hideLoader(): void\n  {\n    this.ui.loader.style.display = \"none\"\n  }\n\n  createMessageOverlay(): HTMLDivElement\n  {\n    const overlay = document.createElement(\"div\")\n    overlay.classList.add(\"message-overlay\")\n    return overlay\n  }\n  closeMessageModal(): void\n  {\n    this.onCloseModal?.(this.ui.message.modal.root.classList.contains(\"error-msg\"))\n    this.hideMessageModal()\n  }\n\n  hideMessageModal(): void\n  {\n    this.ui.message.root.style.display = \"none\"\n    this.ui.message.modal.text.innerText = \"\"\n    this.ui.message.modal.root.classList.remove(\"error-msg\")\n    this.ui.message.modal.root.classList.remove(\"info-msg\")\n  }\n  createMessageModal(): EditorLayerUIInfoModal\n  {\n    const element = document.createElement(\"div\")\n    element.classList.add(\"message-modal\")\n\n    const closeBtn = document.createElement(\"button\")\n    closeBtn.classList.add(\"ms-button\", \"close\")\n    closeBtn.addEventListener(\"pointerup\", this.closeMessageModal.bind(this))\n    element.appendChild(closeBtn)\n\n    const text = document.createElement(\"p\")\n    element.appendChild(text)\n    return { root: element, text }\n  }\n  createMessage(): EditorLayerUIMessage\n  {\n    const root = document.createElement(\"div\")\n    root.classList.add(\"message-container\")\n    root.style.display = \"none\"\n\n    const overlay = this.createMessageOverlay()\n    root.appendChild(overlay)\n\n    const modal = this.createMessageModal()\n    root.appendChild(modal.root)\n\n    return {\n      root,\n      overlay,\n      modal\n    }\n  }\n  showMessageInfo(notif: { message: string, timeout?: number })\n  {\n    this.ui.message.modal.root.classList.add(\"info-msg\")\n    this.ui.message.modal.root.classList.remove(\"error-msg\")\n    this.ui.message.root.style.display = \"block\"\n    this.ui.message.modal.text.innerText = notif.message\n    setTimeout(() =>\n    {\n      this.closeMessageModal()\n    }, notif.timeout || 2500)\n  }\n  showMessageError(err: Error | string)\n  {\n    this.ui.message.modal.root.classList.add(\"error-msg\")\n    this.ui.message.modal.root.classList.remove(\"info-msg\")\n    this.ui.message.root.style.display = \"block\"\n    this.ui.message.modal.text.innerText = typeof err === \"string\" ? err : err.message\n  }\n\n  createBusy(): HTMLDivElement\n  {\n    const busy = document.createElement(\"div\")\n    busy.classList.add(\"busy\")\n    return busy\n  }\n  createState(): EditorLayerUIState\n  {\n    const root = document.createElement(\"div\")\n    root.classList.add(\"state\")\n    root.style.display = \"none\"\n\n    const busy = this.createBusy()\n    root.appendChild(busy)\n\n    return {\n      root,\n      busy\n    }\n  }\n  showState(): void\n  {\n    this.ui.state.root.style.display = \"block\"\n  }\n  hideState(): void\n  {\n    this.ui.state.root.style.display = \"none\"\n  }\n  updateState(idle: boolean): void\n  {\n    if (idle) {\n      this.hideState()\n    }\n    else {\n      this.showState()\n    }\n  }\n\n  createLayerUI(): EditorLayerUI\n  {\n    const root = document.createElement(\"div\")\n    root.classList.add(\"ms-layer-ui\")\n\n    const loader = this.createLoader()\n    root.appendChild(loader)\n\n    const message = this.createMessage()\n    root.appendChild(message.root)\n\n    const state = this.createState()\n    root.appendChild(state.root)\n\n    return {\n      root,\n      loader,\n      message,\n      state\n    }\n  }\n\n  createLayerRender(): HTMLDivElement\n  {\n    const render = document.createElement(\"div\")\n    render.classList.add(\"ms-layer-rendering\")\n    return render\n  }\n\n  destroy(): void\n  {\n    while (this.root.lastChild) {\n      this.root.removeChild(this.root.lastChild)\n    }\n  }\n}\n","import { getApiInfos, PartialDeep, TApiInfos } from \"../utils\"\nimport {\n  LoggerCategory,\n  LoggerManager,\n  DefaultLoggerConfiguration,\n  TLoggerConfiguration\n} from \"../logger\"\nimport { TServerHTTPConfiguration } from \"../recognizer\"\nimport { EditorEvent } from \"./EditorEvent\"\nimport { EditorLayer } from \"./EditorLayer\"\n\n/**\n * @hidden\n * @group Editor\n */\nexport type TEditorConfiguration = {\n  logger: TLoggerConfiguration\n}\n\n/**\n * @group Editor\n * @remarks \"INKV1\" is deprecated use \"INKV2\" instead.\n */\nexport type EditorType = \"INTERACTIVEINK\" | \"INKV1\" | \"INTERACTIVEINKSSR\" | \"INKV2\"\n\n/**\n * @hidden\n * @group Editor\n */\nexport type EditorOptionsBase = {\n  configuration: TEditorConfiguration\n  override?: {\n    cssClass?: string\n  }\n}\n\n/**\n * @hidden\n * @group Editor\n */\nexport abstract class AbstractEditor\n{\n  logger = LoggerManager.getLogger(LoggerCategory.EDITOR)\n  layers: EditorLayer\n  event: EditorEvent\n  info?: TApiInfos\n\n  #loggerConfiguration!: TLoggerConfiguration\n\n  constructor(rootElement: HTMLElement, options?: PartialDeep<EditorOptionsBase>)\n  {\n    this.loggerConfiguration = Object.assign({}, DefaultLoggerConfiguration, options?.configuration?.logger)\n    this.logger.info(\"constructor\", { rootElement, options })\n\n    this.event = new EditorEvent(rootElement)\n    this.layers = new EditorLayer(rootElement, options?.override?.cssClass || \"ms-editor\")\n\n    //@ts-ignore\n    rootElement.editor = this\n  }\n\n  get loggerConfiguration(): TLoggerConfiguration\n  {\n    return this.#loggerConfiguration\n  }\n\n  set loggerConfiguration(loggerConfig: TLoggerConfiguration)\n  {\n    this.#loggerConfiguration = Object.assign({}, DefaultLoggerConfiguration, loggerConfig)\n    LoggerManager.setLoggerLevel(this.#loggerConfiguration)\n  }\n\n  abstract initialize(): Promise<void>\n\n  abstract clear(): Promise<void>\n\n  abstract destroy(): Promise<void>\n\n  async loadInfo(server: TServerHTTPConfiguration): Promise<TApiInfos>\n  {\n    if (!this.info) {\n      this.info = await getApiInfos({ server })\n    }\n    return this.info\n  }\n}\n","import { isBetween } from \"../utils\"\nimport { TPoint, TSegment } from \"./Point\"\n\n/**\n * @group Symbol\n */\nexport type TBox = {\n  x: number,\n  y: number,\n  width: number,\n  height: number\n}\n\n/**\n * @group Symbol\n */\nexport class Box implements TBox\n{\n  x: number\n  y: number\n  width: number\n  height: number\n\n  constructor(boundindBox: TBox)\n  {\n    if (boundindBox.width < 0) throw new Error(\"width must be positive\")\n    if (boundindBox.height < 0) throw new Error(\"height must be positive\")\n    this.height = boundindBox.height\n    this.width = boundindBox.width\n    this.x = boundindBox.x\n    this.y = boundindBox.y\n  }\n\n  static createFromBoxes(boxes: TBox[]): Box\n  {\n    if (!boxes?.length) {\n      return new Box({ height: 0, width: 0, x: 0, y: 0 })\n    }\n    let minX = boxes[0].x\n    let maxX = boxes[0].x + boxes[0].width\n    let minY = boxes[0].y\n    let maxY = boxes[0].y + boxes[0].height\n    for (let i = 1; i < boxes.length; i++) {\n      const b = boxes[i]\n      if (b.x < minX) minX = b.x\n      if (b.x + b.width > maxX) maxX = b.x + b.width\n      if (b.y < minY) minY = b.y\n      if (b.y + b.height > maxY) maxY = b.y + b.height\n    }\n    return new Box({ x: minX, y: minY, width: maxX - minX, height: maxY - minY })\n  }\n\n  static createFromPoints(points: TPoint[]): Box\n  {\n    if (!points?.length) {\n      return new Box({ height: 0, width: 0, x: 0, y: 0 })\n    }\n    let minX = points[0].x\n    let maxX = points[0].x\n    let minY = points[0].y\n    let maxY = points[0].y\n    for (let i = 1; i < points.length; i++) {\n      const p = points[i]\n      if (p.x < minX) minX = p.x\n      if (p.x > maxX) maxX = p.x\n      if (p.y < minY) minY = p.y\n      if (p.y > maxY) maxY = p.y\n    }\n    return new Box({ x: minX, y: minY, width: maxX - minX, height: maxY - minY })\n  }\n\n  static getCorners(box: TBox): TPoint[]\n  {\n    return [\n      { x: box.x, y: box.y },\n      { x: box.x + box.width, y: box.y },\n      { x: box.x + box.width, y: box.y + box.height },\n      { x: box.x, y: box.y + box.height }\n    ]\n  }\n\n  static getSide(box: TBox): TPoint[]\n  {\n    return [\n      { x: box.x + box.width / 2, y: box.y },\n      { x: box.x + box.width, y: box.y + box.height / 2 },\n      { x: box.x + box.width / 2, y: box.y + box.height },\n      { x: box.x, y: box.y + box.height / 2 }\n    ];\n\n  }\n\n  static getCenter(box: TBox): TPoint\n  {\n    return { x: box.x + box.width / 2, y: box.y + box.height / 2 }\n  }\n\n  static getSides(box: TBox): TSegment[]\n  {\n    const vertices = Box.getCorners(box)\n    return vertices.map((p, i) =>\n    {\n      if (i === 3) {\n        return { p1: vertices[0], p2: p }\n      }\n      else {\n        return { p1: p, p2: vertices[i + 1] }\n      }\n    })\n  }\n\n  static isContained(box: TBox, wrapper: TBox): boolean\n  {\n    return isBetween(box.x, wrapper.x, wrapper.x + wrapper.width) &&\n      isBetween(box.x + box.width, wrapper.x, wrapper.x + wrapper.width) &&\n      isBetween(box.y, wrapper.y, wrapper.y + wrapper.height) &&\n      isBetween(box.y + box.height, wrapper.y, wrapper.y + wrapper.height)\n  }\n\n  static containsPoint(box: TBox, point: TPoint): boolean\n  {\n    return isBetween(point.x, box.x, box.x + box.width) &&\n      isBetween(point.y, box.y, box.y + box.height)\n  }\n\n  static contains(box: TBox, child: TBox): boolean\n  {\n    return isBetween(child.x, box.x, box.x + box.width) &&\n      isBetween(child.x + child.width, box.x, box.x + box.width) &&\n      isBetween(child.y, box.y, box.y + box.height) &&\n      isBetween(child.y + child.height, box.y, box.y + box.height)\n  }\n\n  static overlaps(box1: TBox, box2: TBox): boolean\n  {\n    if (box1.x > box2.x + box2.width) return false\n    if (box1.x + box1.width < box2.x) return false\n    if (box1.y > box2.y + box2.height) return false\n    if (box1.y + box1.height < box2.y) return false\n\n    return true\n  }\n\n  get xMin(): number\n  {\n    return this.x\n  }\n\n  get xMid(): number\n  {\n    return this.x + this.width / 2\n  }\n\n  get xMax(): number\n  {\n    return this.x + this.width\n  }\n\n  get yMin(): number\n  {\n    return this.y\n  }\n\n  get yMid(): number\n  {\n    return this.y + this.height / 2\n  }\n\n  get yMax(): number\n  {\n    return this.y + this.height\n  }\n\n  get corners(): TPoint[]\n  {\n    return Box.getCorners(this)\n  }\n\n  get center(): TPoint\n  {\n    return Box.getCenter(this)\n  }\n\n  get side(): TPoint[]\n  {\n    return Box.getSide(this)\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return [\n      ...this.corners,\n      this.center\n    ]\n  }\n\n  isContained(wrapper: TBox): boolean\n  {\n    return Box.isContained(this, wrapper)\n  }\n\n  contains(child: TBox): boolean\n  {\n    return Box.contains(this, child)\n  }\n\n  containsPoint(point: TPoint): boolean\n  {\n    return Box.containsPoint(this, point)\n  }\n\n  overlaps(boundaries: TBox): boolean\n  {\n    return Box.overlaps(this, boundaries)\n  }\n}\n","/**\n * @group Style\n * @property {String} color=#000000 Color (supported formats rgb() rgba() hsl() hsla() #rgb #rgba #rrggbb #rrggbbaa)\n * @property {String} width in px\n\n */\nexport type TStyle = {\n  [key: string]: string | number | undefined\n  width: number\n  color: string\n  opacity?: number\n  fill?: string\n}\n\n/**\n * @group Style\n * @source\n */\nexport const DefaultStyle: TStyle = {\n  width: 2,\n  color: \"#000000\",\n//   opacity: 1,\n//   fill: \"transparent\",\n} as const\n","import { PartialDeep } from \"../utils\"\nimport { TStyle } from \"./Style\"\n\n/**\n * @group Style\n * @property {String} -myscript-pen-width=1 Width of strokes and primitives in mm (no other unit is supported yet)\n * @property {String} -myscript-pen-fill-style=none\n * @property {String} -myscript-pen-fill-color=#FFFFFF00 Color filled inside the area delimited by strokes and primitives\n */\nexport type TPenStyle = PartialDeep<TStyle> & {\n  \"-myscript-pen-width\"?: number\n  \"-myscript-pen-fill-style\"?: string\n  \"-myscript-pen-fill-color\"?: string\n}\n\n/**\n * @group Style\n * @source\n */\nexport const DefaultPenStyle: TPenStyle = {\n}\n","import { TPenStyle } from \"./PenStyle\"\n\n/**\n * @group Style\n */\nexport type TThemeMath = {\n  \"font-family\": string\n}\n\n/**\n * @group Style\n */\nexport type TThemeMathSolved = {\n  \"font-family\": string\n  color: string\n}\n\n/**\n * @group Style\n */\nexport type TThemeText = {\n  \"font-family\": string,\n  \"font-size\": number\n}\n\n/**\n * @group Style\n */\nexport type TTheme = {\n  ink: TPenStyle\n  \".math\": TThemeMath\n  \".math-solved\": TThemeMathSolved\n  \".text\": TThemeText\n  [key: string]: unknown\n}\n\n/**\n * @group Style\n * @source\n */\nexport const DefaultTheme: TTheme = {\n  ink: {\n    color: \"#000000\",\n    width: 1,\n    \"-myscript-pen-width\": 1,\n    \"-myscript-pen-fill-style\": \"none\",\n    \"-myscript-pen-fill-color\": \"#FFFFFF00\"\n  },\n  \".math\": {\n    \"font-family\": \"STIXGeneral\"\n  },\n  \".math-solved\": {\n    \"font-family\": \"STIXGeneral\",\n    color: \"#A8A8A8FF\"\n  },\n  \".text\": {\n    \"font-family\": \"MyScriptInter\",\n    \"font-size\": 10\n  }\n}\n","!function(t,e){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define([],e):\"object\"==typeof exports?exports.JsonCSS=e():t.JsonCSS=e()}(this,function(){return function(t){function e(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,\"a\",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p=\"\",e(e.s=1)}([function(t,e,n){\"use strict\";function o(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}Object.defineProperty(e,\"__esModule\",{value:!0});var r=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t},i=function t(e){var n=this;o(this,t),this.toJSON=function(t){if(\"string\"!=typeof t)return console.error(\"Need a CSS string but given \",void 0===t?\"undefined\":r(t),t),\"Not a valid CSS..!\";var e={},o=void 0,i=void 0,u=void 0;try{t.split(\"{\").forEach(function(t){if(i=t.trim())if(-1===i.indexOf(\"}\"))e[i]={},o=i;else{i.substring(0,i.indexOf(\"}\")).split(\";\").forEach(function(t){(u=t.split(\":\"))&&2===u.length&&(e[o][u[0].trim().replace(/^\\\"|\\\"$/g,\"\")]=n._trimSemiColon(u[1].trim().replace(/^\\\"|\\\"$/g,\"\")))});try{o=i.split(\"}\")[1].trim(),o&&(e[o]={})}catch(t){}}})}catch(t){return\"Not a valid CSS..!\"}return e},this.toCSS=function(t){if(\"object\"!==(void 0===t?\"undefined\":r(t)))return console.error(\"Need a JSON object but given \",void 0===t?\"undefined\":r(t),t),\"Not a valid JSON..!\";var e=\"\";try{for(var n in t)if(t.hasOwnProperty(n)){e+=n+\" {\\n\";for(var o in t[n])t[n].hasOwnProperty(o)&&(e+=o+\": \"+t[n][o]+\";\\n\");e+=\"}\\n\"}}catch(t){return\"Not a valid JSON..!\"}return e},this._trimSemiColon=function(t){return\";\"===t.slice(-1)?t.slice(0,n.length-1):t}};e.default=i},function(t,e,n){\"use strict\";t.exports=n(0).default}])});","import JsonCSS from \"json-css\"\nimport { TTheme } from \"./Theme\"\nimport { TPenStyle } from \"./PenStyle\"\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst parser: any = new JsonCSS()\n\n/**\n * @group Style\n */\nexport const StyleHelper = {\n  themeToCSS(json: TTheme): string\n  {\n    return parser.toCSS(json) as string\n    // css = css.replace( /[\\r\\n]+/gm, \"\" )\n    // return css\n  },\n  themeToJSON(style: string): TTheme\n  {\n    const theme = parser.toJSON(style) as TTheme\n    theme[\".text\"][\"font-size\"] = Number(theme[\".text\"][\"font-size\"])\n    theme.ink[\"-myscript-pen-width\"] = Number(theme.ink[\"-myscript-pen-width\"])\n    theme.ink.width = Number(theme.ink.width)\n    return theme\n  },\n  penStyleToCSS (penStyle: TPenStyle): string {\n    let css = parser.toCSS({ css: penStyle }) as string\n    css = css.substring(6, css.length - 3)\n    return css\n  },\n  penStyleToJSON (penStyleString: string): TPenStyle {\n    const penStyle = parser.toJSON(`css {${penStyleString}}`).css as TPenStyle\n    if (penStyle.width) {\n      penStyle.width = Number(penStyle.width)\n    } else {\n      delete penStyle.width\n    }\n    if (penStyle[\"-myscript-pen-width\"]) {\n      penStyle[\"-myscript-pen-width\"] = Number(penStyle[\"-myscript-pen-width\"])\n    } else {\n      delete penStyle[\"-myscript-pen-width\"]\n    }\n    return penStyle\n  },\n\n  stringToJSON(style: string): {[key: string]: string}\n  {\n    return parser.toJSON(`css {${style}}`).css\n  },\n  JSONToString(style: {[key: string]: string}): string\n  {\n    return Object.entries(style).map(([k, v]) => `${k}:${v}`).join(\";\")\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { PartialDeep, mergeDeep } from \"../utils\"\nimport { DefaultPenStyle, TPenStyle } from \"./PenStyle\"\nimport { DefaultTheme, TTheme } from \"./Theme\"\n\n/**\n * @group Style\n */\nexport class StyleManager\n{\n  #penStyle!: TPenStyle\n  #theme!: TTheme\n  #penStyleClasses!: string\n  #currentPenStyle!: TPenStyle\n  #logger =  LoggerManager.getLogger(LoggerCategory.STYLE)\n\n  constructor(penStyle?: PartialDeep<TPenStyle>, theme?: PartialDeep<TTheme>)\n  {\n    this.#logger.info(\"constructor\", { penStyle, theme })\n    this.setTheme(theme)\n    this.setPenStyleClasses()\n    this.setPenStyle(penStyle)\n  }\n\n  get currentPenStyle(): TPenStyle\n  {\n    return this.#currentPenStyle || this.#penStyle\n  }\n\n  get penStyle(): TPenStyle\n  {\n    return this.#penStyle\n  }\n  setPenStyle(style?: PartialDeep<TPenStyle>)\n  {\n    this.#logger.info(\"setPenStyle\", { style })\n    this.#penStyle = mergeDeep(structuredClone(DefaultPenStyle), style || {}) as TPenStyle\n    this.#currentPenStyle = style || (this.theme[`.${ this.#penStyleClasses }`]) as TPenStyle\n    this.#logger.debug(\"setPenStyle\", this.#currentPenStyle)\n  }\n\n  get theme(): TTheme\n  {\n    return this.#theme\n  }\n  setTheme(theme?: PartialDeep<TTheme>)\n  {\n    this.#logger.info(\"setTheme\", { theme })\n    this.#theme = mergeDeep(structuredClone(DefaultTheme), theme || {}) as TTheme\n    this.#logger.debug(\"setTheme\", this.#theme)\n  }\n\n  get penStyleClasses(): string\n  {\n    return this.#penStyleClasses\n  }\n  setPenStyleClasses(penStyleClass = \"\")\n  {\n    this.#logger.info(\"setPenStyleClasses\", { penStyleClass })\n    this.#penStyleClasses = penStyleClass\n    this.#currentPenStyle = (this.theme[`.${ this.#penStyleClasses }`]) as TPenStyle\n    this.#logger.debug(\"setPenStyleClasses\", this.#currentPenStyle)\n  }\n\n}\n","import { createUUID, mergeDeep, PartialDeep } from \"../utils\"\nimport { DefaultStyle, TStyle } from \"../style\"\n\n/**\n * @group Symbol\n */\nexport enum DecoratorKind\n{\n  Highlight = \"highlight\",\n  Surround = \"surround\",\n  Underline = \"underline\",\n  Strikethrough = \"strikethrough\",\n}\n\n/**\n * @group Symbol\n */\nexport class IIDecorator\n{\n  id: string\n  kind: DecoratorKind\n  style: TStyle\n\n  constructor(kind: DecoratorKind, style: PartialDeep<TStyle>)\n  {\n    this.id = `${ kind }-${ createUUID() }`\n    this.style = structuredClone(mergeDeep({}, DefaultStyle ,style))\n    this.kind = kind\n  }\n\n  clone(): IIDecorator\n  {\n    const clone = new IIDecorator(this.kind, structuredClone(this.style))\n    clone.id = this.id\n    return clone\n  }\n\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep } from \"../utils\"\n\n/**\n * @group Symbol\n */\nexport enum SymbolType\n{\n  Stroke = \"stroke\",\n  Group = \"group\",\n  Shape = \"shape\",\n  Edge = \"edge\",\n  Text = \"text\",\n  Eraser = \"eraser\",\n  Recognized = \"recognized\"\n}\n\n/**\n * @group Symbol\n */\nexport interface TSymbol {\n  id: string\n  creationTime: number\n  modificationDate: number\n  type: string\n  style: PartialDeep<TStyle>\n}\n","import { SELECTION_MARGIN } from \"../../Constants\"\nimport { TStyle } from \"../../style\"\nimport { findIntersectionBetween2Segment, PartialDeep } from \"../../utils\"\nimport { Box, TBox } from \"../Box\"\nimport { IISymbolBase } from \"../IISymbolBase\"\nimport { TPoint } from \"../Point\"\nimport { SymbolType } from \"../Symbol\"\n\n/**\n * @group Symbol\n */\nexport enum EdgeKind\n{\n  Line = \"line\",\n  PolyEdge = \"polyedge\",\n  Arc = \"arc\",\n}\n\n/**\n * @group Symbol\n */\nexport enum EdgeDecoration\n{\n  Arrow = \"arrow-head\"\n}\n\n/**\n * @group Symbol\n */\nexport abstract class OIEdgeBase<K = EdgeKind> extends IISymbolBase<SymbolType.Edge>\n{\n  readonly kind: K\n  readonly isClosed = false\n\n  startDecoration?: EdgeDecoration\n  endDecoration?: EdgeDecoration\n\n  constructor(\n    kind: K,\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(SymbolType.Edge, style)\n    this.kind = kind\n\n    this.startDecoration = startDecoration\n    this.endDecoration = endDecoration\n  }\n\n  abstract get vertices(): TPoint[]\n\n  get bounds(): Box\n  {\n    const bb = Box.createFromPoints(this.vertices)\n    bb.x -= SELECTION_MARGIN / 2\n    bb.y -= SELECTION_MARGIN / 2\n    bb.height += SELECTION_MARGIN\n    bb.width += SELECTION_MARGIN\n    if (this.startDecoration || this.endDecoration) {\n      bb.x -= ((this.style.width || 1) * 2.5)\n      bb.y -= ((this.style.width || 1) * 2.5)\n      bb.height += ((this.style.width || 1) * 5)\n      bb.width += ((this.style.width || 1) * 5)\n    }\n    return bb\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.vertices\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.bounds.isContained(box) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n\n  abstract clone(): OIEdgeBase\n}\n","import { TStyle } from \"../../style\"\nimport { findIntersectionBetween2Segment, PartialDeep } from \"../../utils\"\nimport { Box, TBox } from \"../Box\"\nimport { IISymbolBase } from \"../IISymbolBase\"\nimport { TPoint } from \"../Point\"\nimport { SymbolType } from \"../Symbol\"\n\n/**\n * @group Symbol\n */\nexport enum ShapeKind\n{\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Polygon = \"polygon\",\n  Table = \"table\"\n}\n\n/**\n * @group Symbol\n */\nexport abstract class OIShapeBase<K = ShapeKind> extends IISymbolBase<SymbolType.Shape>\n{\n  readonly kind: K\n  readonly isClosed = true\n\n  constructor(kind: K, style?: PartialDeep<TStyle>)\n  {\n    super(SymbolType.Shape, style)\n    this.kind = kind\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.bounds.snapPoints\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.bounds.isContained(box) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { Box, TBox } from \"../Box\"\nimport { IIStroke } from \"../IIStroke\"\nimport { IISymbolBase } from \"../IISymbolBase\"\nimport { TPoint } from \"../Point\"\nimport { SymbolType } from \"../Symbol\"\n\n/**\n * @group Symbol\n */\nexport enum RecognizedKind\n{\n  Text = \"text\",\n  Line = \"line\",\n  PolyEdge = \"polyedge\",\n  Arc = \"arc\",\n  Circle = \"circle\",\n  Ellipse = \"ellipse\",\n  Polygone = \"polygone\",\n}\n\n/**\n * @group Symbol\n */\nexport abstract class IIRecognizedBase<K = RecognizedKind> extends IISymbolBase<SymbolType.Recognized>\n{\n  readonly kind: K\n\n  strokes: IIStroke[]\n\n  constructor(\n    kind: K,\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(SymbolType.Recognized, style)\n    this.kind = kind\n    this.strokes = strokes\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.strokes.flatMap(s => s.vertices)\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromBoxes(this.strokes.map(c => c.bounds))\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.bounds.snapPoints\n  }\n\n  updateChildrenStyle(): void\n  {\n    this.strokes.forEach(child => child.style = Object.assign({}, child.style, this.style))\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.strokes.some(s => s.overlaps(box))\n  }\n\n  containsStroke(strokeId: string): boolean\n  {\n    return this.strokes.some(s => s.id === strokeId)\n  }\n\n  removeStrokes(strokeIds: string[]): IIStroke[]\n  {\n    const strokeRemoved = this.strokes.filter(s => strokeIds.includes(s.id))\n    this.strokes = this.strokes.filter(s => !strokeIds.includes(s.id))\n    return strokeRemoved\n  }\n}\n","import { TPoint } from \"../symbol\"\n\n/**\n * @group Transform\n * @remarks Represents a 2D affine transform, defined as a 3x3 matrix with an implicit third raw of <code>[ 0 0 1 ]</code>\n */\nexport type TMatrixTransform = {\n  /**\n   * @remarks scaling x\n   */\n  xx: number,\n  /**\n   * @remarks shearing x\n   */\n  yx: number,\n  /**\n   * @remarks translation x\n   */\n  tx: number,\n  /**\n   * @remarks shearing y\n   */\n  xy: number,\n  /**\n   * @remarks scaling y\n   */\n  yy: number,\n  /**\n   * @remarks translation y\n   */\n  ty: number,\n}\n\n/**\n * @group Transform\n * @remarks Represents a 2D affine transform, defined as a 3x3 matrix with an implicit third raw of <code>[ 0 0 1 ]</code>\n */\nexport class MatrixTransform implements TMatrixTransform\n{\n  xx: number\n  yx: number\n  xy: number\n  yy: number\n  tx: number\n  ty: number\n\n  constructor(xx: number, yx: number, xy: number, yy: number, tx: number, ty: number)\n  {\n    this.xx = xx\n    this.yx = yx\n    this.xy = xy\n    this.yy = yy\n    this.tx = tx\n    this.ty = ty\n  }\n\n  static identity(): MatrixTransform\n  {\n    return new MatrixTransform(1, 0, 0, 1, 0, 0)\n  }\n\n  static applyToPoint(mat: TMatrixTransform, point: TPoint): TPoint\n  {\n    return {\n      x: mat.xx * point.x + mat.xy * point.y + mat.tx,\n      y: mat.yx * point.x + mat.yy * point.y + mat.ty,\n    }\n  }\n\n  static rotation(mat: TMatrixTransform): number\n  {\n    let rotation\n\n    if (mat.xx !== 0 || mat.xy !== 0) {\n      const hypotAc = Math.hypot(mat.xx, mat.xy)\n      rotation = Math.acos(mat.xx / hypotAc) * (mat.xy > 0 ? -1 : 1)\n    } else if (mat.yx !== 0 || mat.yy !== 0) {\n      const hypotBd = Math.hypot(mat.yx, mat.yy)\n      rotation = Math.PI / 2 + Math.acos(mat.yx / hypotBd) * (mat.yy > 0 ? -1 : 1)\n    } else {\n      rotation = 0\n    }\n\n    return rotation\n  }\n\n  static toCssString(matrix: TMatrixTransform): string\n  {\n    return `matrix(${ matrix.xx }, ${ matrix.yx }, ${ matrix.xy }, ${ matrix.yy }, ${ matrix.tx }, ${ matrix.ty })`\n  }\n\n\tinvert() {\n\t\tconst { xx, yx, xy, yy, tx, ty } = this\n\t\tconst denom = xx * yy - yx * xy\n\t\tthis.xx = yy / denom\n\t\tthis.yx = yx / -denom\n\t\tthis.xy = xy / -denom\n\t\tthis.yy = xx / denom\n\t\tthis.tx = (yy * tx - xy * ty) / -denom\n\t\tthis.ty = (yx * tx - xx * ty) / denom\n\t\treturn this\n\t}\n\n  multiply(m: TMatrixTransform): MatrixTransform\n  {\n    const { xx, yx, xy, yy, tx, ty } = this\n    this.xx = xx * m.xx + xy * m.yx\n    this.yx = yx * m.xx + yy * m.yx\n    this.xy = xx * m.xy + xy * m.yy\n    this.yy = yx * m.xy + yy * m.yy\n    this.tx = xx * m.tx + xy * m.ty + tx\n    this.ty = yx * m.tx + yy * m.ty + ty\n    return this\n  }\n\n  translate(tx: number, ty: number): MatrixTransform\n  {\n    return this.multiply({ xx: 1, yx: 0, xy: 0, yy: 1, tx, ty })\n  }\n\n  rotate(radian: number, center?: TPoint): MatrixTransform\n  {\n    if (center) {\n      this.translate(center.x, center.y)\n    }\n    const cosAngle = Math.round(Math.cos(radian) * 1000) / 1000\n    const sinAngle = Math.round(Math.sin(radian) * 1000) / 1000\n    this.multiply({\n      xx: cosAngle,\n      yx: sinAngle,\n      xy: -sinAngle,\n      yy: cosAngle,\n      tx: 0,\n      ty: 0\n    })\n    if (center) {\n      this.translate(-center.x, -center.y)\n    }\n    return this\n  }\n\n  scale(x: number, y: number, center?: TPoint): MatrixTransform\n  {\n    if (center) {\n      this.translate(center.x, center.y)\n    }\n    this.multiply({\n      xx: x,\n      yx: 0,\n      xy: 0,\n      yy: y,\n      tx: 0,\n      ty: 0\n    })\n    if (center) {\n      this.translate(-center.x, -center.y)\n    }\n    return this\n  }\n\n  applyToPoint(point: TPoint): TPoint\n  {\n    return MatrixTransform.applyToPoint(this, point)\n  }\n\n  clone(): MatrixTransform\n  {\n    return new MatrixTransform(this.xx, this.yx, this.xy, this.yy, this.tx, this.ty)\n  }\n\n  toCssString(): string\n  {\n    return MatrixTransform.toCssString(this)\n  }\n\n}\n","import { PartialDeep, createUUID, findIntersectionBetween2Segment } from \"../utils\"\nimport { TBox } from \"./Box\"\nimport { TPoint, TSegment } from \"./Point\"\nimport { SymbolType, TSymbol } from \"./Symbol\"\nimport { DefaultStyle, TStyle } from \"../style\"\nimport { MatrixTransform } from \"../transform\"\n\n/**\n * @group Symbol\n */\nexport abstract class IISymbolBase<T extends string = SymbolType> implements TSymbol\n{\n  readonly type: T\n  abstract readonly isClosed: boolean\n  style: TStyle\n\n  id: string\n  creationTime: number\n  modificationDate: number\n  selected: boolean\n  deleting: boolean\n  transform: MatrixTransform\n\n  constructor(type: T, style?: PartialDeep<TStyle>)\n  {\n    this.type = type\n    this.id = `${ this.type }-${ createUUID() }`\n\n    this.creationTime = Date.now()\n    this.modificationDate = this.creationTime\n    this.selected = false\n    this.deleting = false\n\n    this.transform = MatrixTransform.identity()\n\n    this.style = Object.assign({}, DefaultStyle, style)\n    if (this.style.opacity) {\n      this.style.opacity = +this.style.opacity\n    }\n    this.style.width = +this.style.width\n  }\n\n  abstract get vertices(): TPoint[]\n\n  abstract get snapPoints(): TPoint[]\n\n  get edges(): TSegment[]\n  {\n    if (this.isClosed) {\n      return this.vertices.map((p, i) =>\n      {\n        if (i === this.vertices.length - 1) {\n          return { p1: p, p2: this.vertices[0] }\n        }\n        else {\n          return { p1: p, p2: this.vertices[i + 1] }\n        }\n      })\n    }\n    else {\n      return this.vertices.slice(0, -1).map((p, i) =>\n      {\n        return { p1: p, p2: this.vertices[i + 1] }\n      })\n    }\n  }\n\n  abstract overlaps(box: TBox): boolean\n\n  abstract clone(): IISymbolBase\n\n  abstract toJSON(): PartialDeep<IISymbolBase>\n\n  isIntersected(seg: TSegment): boolean\n  {\n    return this.edges.some(edge =>\n    {\n      return findIntersectionBetween2Segment(edge, seg)\n    })\n  }\n}\n","import { PartialDeep, isValidNumber } from \"../utils\"\n\n/**\n * @group Symbol\n */\nexport type TPoint = {\n  x: number\n  y: number\n}\n\n/**\n * @group Symbol\n */\nexport type TPointer = TPoint & {\n  t: number\n  p: number\n}\n\n/**\n * @group Symbol\n */\nexport type TSegment = {\n  p1: TPoint\n  p2: TPoint\n}\n\n/**\n * @group Symbol\n */\nexport function isValidPoint(p?: PartialDeep<TPoint>): boolean\n{\n  if (!p) return false\n  if (!isValidNumber(p.x)) return false\n  if (!isValidNumber(p.y)) return false\n  return true\n}\n","import { SELECTION_MARGIN } from \"../../Constants\"\nimport { TStyle } from \"../../style\"\nimport { PartialDeep, computePointOnEllipse, isValidNumber } from \"../../utils\"\nimport { EdgeDecoration, EdgeKind, OIEdgeBase } from \"./IIEdge\"\nimport { TPoint, isValidPoint } from \"../Point\"\n\n/**\n * @group Symbol\n */\nexport class IIEdgeArc extends OIEdgeBase<EdgeKind.Arc>\n{\n  center: TPoint\n  startAngle: number\n  sweepAngle: number\n  radiusX: number\n  radiusY: number\n  phi: number\n  protected _vertices: Map<string, TPoint[]>\n\n  constructor(\n    center: TPoint,\n    startAngle: number,\n    sweepAngle: number,\n    radiusX: number,\n    radiusY: number,\n    phi: number,\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>,\n  )\n  {\n    super(EdgeKind.Arc, startDecoration, endDecoration, style)\n    this.center = center\n    this.startAngle = startAngle\n    this.sweepAngle = sweepAngle\n    this.radiusX = radiusX\n    this.radiusY = radiusY\n    this.phi = phi\n    this._vertices = new Map<string, TPoint[]>()\n    this._vertices.set(this.verticesId, this.computedVertices())\n  }\n\n  protected get verticesId(): string\n  {\n    return `${ this.center.x }-${ this.center.y }-${ this.startAngle }-${ this.sweepAngle }-${ this.radiusX }-${ this.radiusY }-${ this.phi }`\n  }\n\n  protected computedVertices(): TPoint[]\n  {\n    const length = Math.abs(this.sweepAngle) * Math.sqrt((Math.pow(this.radiusX, 2) + Math.pow(this.radiusY, 2)) / 2)\n    const nbVertices = Math.max(8, Math.round(length / SELECTION_MARGIN))\n    const angleStep = this.sweepAngle / nbVertices\n    const v: TPoint[] = []\n    const endAngle = this.startAngle + this.sweepAngle\n    if (this.sweepAngle > 0) {\n      for (let angle = this.startAngle; angle < endAngle; angle += angleStep) {\n        v.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.phi, angle))\n      }\n    } else {\n      for (let angle = this.startAngle; angle > endAngle; angle += angleStep) {\n        v.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.phi, angle))\n      }\n    }\n    v.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.phi, endAngle))\n    return v\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (!this._vertices.has(this.verticesId)) {\n      this._vertices.set(this.verticesId, this.computedVertices())\n    }\n    return this._vertices.get(this.verticesId)!\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return [\n      this.vertices[0],\n      this.vertices.at(-1)!\n    ]\n  }\n\n  clone(): IIEdgeArc\n  {\n    const clone = new IIEdgeArc(\n      structuredClone(this.center),\n      this.startAngle,\n      this.sweepAngle,\n      this.radiusX,\n      this.radiusY,\n      this.phi,\n      this.startDecoration,\n      this.endDecoration,\n      structuredClone(this.style)\n    )\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIEdgeArc>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      center: this.center,\n      startAngle: this.startAngle,\n      sweepAngle: this.sweepAngle,\n      radiusX: this.radiusX,\n      radiusY: this.radiusY,\n      phi: this.phi,\n      startDecoration: this.startDecoration,\n      style: this.style,\n      endDecoration: this.endDecoration,\n    }\n  }\n\n  static create(partial: PartialDeep<IIEdgeArc>): IIEdgeArc\n  {\n    if (!isValidPoint(partial?.center)) throw new Error(`Unable to create a arc, center point is invalid`)\n    if (!isValidNumber(partial?.startAngle)) throw new Error(`Unable to create a arc, startAngle is invalid`)\n    if (!isValidNumber(partial?.sweepAngle)) throw new Error(`Unable to create a arc, sweepAngle is invalid`)\n    if (!isValidNumber(partial?.radiusX)) throw new Error(`Unable to create a arc, radiusX is invalid`)\n    if (!isValidNumber(partial?.radiusY)) throw new Error(`Unable to create a arc, radiusY is invalid`)\n    const arc = new IIEdgeArc(\n      partial?.center as TPoint,\n      partial.startAngle!,\n      partial.sweepAngle!,\n      partial.radiusX!,\n      partial.radiusY!,\n      partial.phi || 0,\n      partial.startDecoration,\n      partial.endDecoration,\n      partial.style\n    )\n    if (partial.id) {\n      arc.id = partial.id\n    }\n    return arc\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { EdgeDecoration, EdgeKind, OIEdgeBase } from \"./IIEdge\"\nimport { TPoint, isValidPoint } from \"../Point\"\n\n/**\n * @group Symbol\n */\nexport class IIEdgeLine extends OIEdgeBase<EdgeKind.Line>\n{\n  start: TPoint\n  end: TPoint\n\n  constructor(\n    start: TPoint,\n    end: TPoint,\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(EdgeKind.Line, startDecoration, endDecoration, style)\n    this.start = start\n    this.end = end\n  }\n\n  get vertices(): TPoint[]\n  {\n    return [\n      this.start,\n      this.end\n    ]\n  }\n\n  clone(): IIEdgeLine\n  {\n    const clone = new IIEdgeLine(structuredClone(this.start), structuredClone(this.end), this.startDecoration, this.endDecoration, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIEdgeLine>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      start: this.start,\n      end: this.end,\n      style: this.style,\n      startDecoration: this.startDecoration,\n      endDecoration: this.endDecoration,\n    }\n  }\n\n  static create(partial: PartialDeep<IIEdgeLine>): IIEdgeLine\n  {\n    if (!isValidPoint(partial?.start)) throw new Error(`Unable to create a arc, start point is invalid`)\n    if (!isValidPoint(partial?.end)) throw new Error(`Unable to create a arc, end point is invalid`)\n    const line = new IIEdgeLine(partial?.start as TPoint, partial?.end as TPoint, partial.startDecoration, partial.endDecoration, partial.style)\n    if (partial.id) {\n      line.id = partial.id\n    }\n    return line\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { EdgeDecoration, EdgeKind, OIEdgeBase } from \"./IIEdge\"\nimport { TPoint, isValidPoint } from \"../Point\"\n\n/**\n * @group Symbol\n */\nexport class IIEdgePolyLine extends OIEdgeBase<EdgeKind.PolyEdge>\n{\n  points: TPoint[]\n\n  constructor(\n    points: TPoint[],\n    startDecoration?: EdgeDecoration,\n    endDecoration?: EdgeDecoration,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(EdgeKind.PolyEdge, startDecoration, endDecoration, style)\n    this.points = points\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.points\n  }\n\n  clone(): IIEdgePolyLine\n  {\n    const clone = new IIEdgePolyLine(structuredClone(this.points),this.startDecoration, this.endDecoration, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIEdgePolyLine>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      points: this.points,\n      style: this.style,\n      startDecoration: this.startDecoration,\n      endDecoration: this.endDecoration,\n    }\n  }\n\n  static create(partial: PartialDeep<IIEdgePolyLine>): IIEdgePolyLine\n  {\n    if (!partial?.points?.map(p => isValidPoint(p))) throw new Error(`Unable to create a PolyLine, points are invalid`)\n    const polyline = new IIEdgePolyLine(partial?.points as TPoint[], partial.startDecoration, partial.endDecoration, partial.style)\n    if (partial.id) {\n      polyline.id = partial.id\n    }\n    return polyline\n  }\n}\n","import { SELECTION_MARGIN } from \"../../Constants\"\nimport { TStyle } from \"../../style\"\nimport { PartialDeep, findIntersectBetweenSegmentAndCircle, isValidNumber, computeRotatedPoint } from \"../../utils\"\nimport { TPoint, isValidPoint } from \"../Point\"\nimport { OIShapeBase, ShapeKind } from \"./IIShape\"\nimport { Box, TBox } from \"../Box\"\n\n/**\n * @group Symbol\n */\nexport class IIShapeCircle extends OIShapeBase<ShapeKind.Circle>\n{\n  center: TPoint\n  radius: number\n  protected _vertices: Map<string, TPoint[]>\n  protected _bounds: Map<string, Box>\n\n  constructor(\n    center: TPoint,\n    radius: number,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(ShapeKind.Circle, style)\n    this.center = center\n    this.radius = radius\n    this._vertices = new Map<string, TPoint[]>()\n    this._vertices.set(this.verticesId, this.computedVertices())\n    this._bounds = new Map<string, Box>()\n    this._bounds.set(this.verticesId, this.computedBondingBox())\n  }\n\n  protected get verticesId(): string\n  {\n    return `${ this.center.x }-${ this.center.y }-${ this.radius }`\n  }\n\n  protected computedVertices(): TPoint[]\n  {\n    const firstPoint: TPoint = {\n      x: this.center.x,\n      y: this.radius + this.center.y\n    }\n    const perimeter = 2 * Math.PI * this.radius\n    const nbPoint = Math.max(8, Math.round(perimeter / SELECTION_MARGIN))\n    const points: TPoint[] = []\n    for (let i = 0; i < nbPoint; i++) {\n      const rad = 2 * Math.PI * (i / nbPoint)\n      points.push(computeRotatedPoint(firstPoint, this.center, rad))\n    }\n    return points\n  }\n\n  protected computedBondingBox(): Box\n  {\n    const boundingBox: TBox = {\n      x: this.center.x - this.radius,\n      y: this.center.y - this.radius,\n      height: this.radius * 2,\n      width: this.radius * 2\n    }\n    return new Box(boundingBox)\n  }\n\n  get bounds(): Box\n  {\n    if (!this._bounds.has(this.verticesId)) {\n      this._bounds.set(this.verticesId, this.computedBondingBox())\n    }\n    return this._bounds.get(this.verticesId)!\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (!this._vertices.has(this.verticesId)) {\n      this._vertices.set(this.verticesId, this.computedVertices())\n    }\n    return this._vertices.get(this.verticesId)!\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.bounds.isContained(box) ||\n      Box.getSides(box).some(seg => findIntersectBetweenSegmentAndCircle(seg, this.center, this.radius).length)\n  }\n\n  clone(): IIShapeCircle\n  {\n    const clone = new IIShapeCircle(structuredClone(this.center), this.radius, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIShapeCircle>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      center: this.center,\n      radius: this.radius,\n      style: this.style,\n    }\n  }\n\n  static createBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapeCircle\n  {\n    const center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n\n    const width = Math.abs(origin.x - target.x)\n    const height = Math.abs(origin.y - target.y)\n    const radius = Math.min(width, height) / 2\n    return new IIShapeCircle(center, radius, style)\n  }\n\n  static updateBetweenPoints(circle: IIShapeCircle, origin: TPoint, target: TPoint): IIShapeCircle\n  {\n    circle.center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n    const width = Math.abs(origin.x - target.x)\n    const height = Math.abs(origin.y - target.y)\n    circle.radius = Math.min(width, height) / 2\n    return circle\n  }\n\n  static create(partial: PartialDeep<IIShapeCircle>): IIShapeCircle\n  {\n    if (!isValidPoint(partial.center)) throw new Error(`Unable to create circle, center is invalid`)\n    if (!isValidNumber(partial.radius)) throw new Error(`Unable to create circle, radius is undefined`)\n    const circle = new IIShapeCircle(partial.center as TPoint, partial.radius!, partial.style)\n    if (partial.id) {\n      circle.id = partial.id\n    }\n    return circle\n  }\n}\n","import { SELECTION_MARGIN } from \"../../Constants\"\nimport { TStyle } from \"../../style\"\nimport { PartialDeep, computePointOnEllipse, findIntersectionBetween2Segment, isValidNumber, } from \"../../utils\"\nimport { TPoint, isValidPoint } from \"../Point\"\nimport { OIShapeBase, ShapeKind } from \"./IIShape\"\nimport { Box, TBox } from \"../Box\"\n\n/**\n * @group Symbol\n */\nexport class IIShapeEllipse extends OIShapeBase<ShapeKind.Ellipse>\n{\n  center: TPoint\n  radiusX: number\n  radiusY: number\n  orientation: number\n  protected _vertices: Map<string, TPoint[]>\n\n  constructor(\n    center: TPoint,\n    radiusX: number,\n    radiusY: number,\n    orientation: number,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(ShapeKind.Ellipse, style)\n    this.center = center\n    this.radiusX = radiusX\n    this.radiusY = radiusY\n    this.orientation = orientation\n    this._vertices = new Map<string, TPoint[]>()\n  }\n\n  protected get verticesId(): string\n  {\n    return `${ this.center.x }-${ this.center.y }-${ this.radiusX }-${ this.radiusY }-${ this.orientation }`\n  }\n\n  protected computedVertices(): TPoint[]\n  {\n    const points: TPoint[] = []\n    const perimeter = 2 * Math.PI * Math.sqrt((Math.pow(this.radiusX, 2) + Math.pow(this.radiusY, 2)) / 2)\n    const nbPoint = Math.max(8, Math.round(perimeter / SELECTION_MARGIN))\n    for (let i = 0; i < nbPoint; i++) {\n      const theta = 2 * Math.PI * (i / nbPoint)\n      points.push(computePointOnEllipse(this.center, this.radiusX, this.radiusY, this.orientation, theta))\n    }\n\n    return points\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (!this._vertices.has(this.verticesId)) {\n      this._vertices.set(this.verticesId, this.computedVertices())\n    }\n    return this._vertices.get(this.verticesId)!\n  }\n\n  overlaps(box: TBox): boolean\n  {\n\n    return this.bounds.isContained(box) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n\n  clone(): IIShapeEllipse\n  {\n    const clone = new IIShapeEllipse(structuredClone(this.center), this.radiusX, this.radiusY, this.orientation, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIShapeEllipse>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      center: this.center,\n      orientation: this.orientation,\n      radiusX: this.radiusX,\n      radiusY: this.radiusY,\n      style: this.style,\n    }\n  }\n\n  static createBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapeEllipse\n  {\n    const center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n    const radiusX = Math.abs(origin.x - target.x) / 2\n    const radiusY = Math.abs(origin.y - target.y) / 2\n    return new IIShapeEllipse(center, radiusX, radiusY, 0, style)\n  }\n\n  static updateBetweenPoints(ellipse: IIShapeEllipse, origin: TPoint, target: TPoint): IIShapeEllipse\n  {\n    ellipse.center = {\n      x: (origin.x + target.x) / 2,\n      y: (origin.y + target.y) / 2\n    }\n    ellipse.radiusX = Math.abs(origin.x - target.x) / 2\n    ellipse.radiusY = Math.abs(origin.y - target.y) / 2\n    return ellipse\n  }\n\n  static create(partial: PartialDeep<IIShapeEllipse>): IIShapeEllipse\n  {\n    if (!isValidPoint(partial.center)) throw new Error(`Unable to create ellipse, center is undefined`)\n    if (!isValidNumber(partial.radiusX)) throw new Error(`Unable to create ellipse, radiusX is undefined`)\n    if (!isValidNumber(partial.radiusY)) throw new Error(`Unable to create ellipse, radiusY is undefined`)\n    const ellipse = new IIShapeEllipse(partial.center as TPoint, partial.radiusX!, partial.radiusY!, partial.orientation || 0, partial.style)\n    if (partial.id) {\n      ellipse.id = partial.id\n    }\n    return ellipse\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { TPoint, isValidPoint } from \"../Point\"\nimport { OIShapeBase, ShapeKind } from \"./IIShape\"\nimport { Box } from \"../Box\"\nimport { PartialDeep } from \"../../utils\"\n\n/**\n * @group Symbol\n */\nexport class IIShapePolygon extends OIShapeBase<ShapeKind.Polygon>\n{\n  points: TPoint[]\n\n  constructor(points: TPoint[], style?: PartialDeep<TStyle>)\n  {\n    super(ShapeKind.Polygon, style)\n    this.points = points\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.points\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  clone(): IIShapePolygon\n  {\n    const clone = new IIShapePolygon(structuredClone(this.points), structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIShapePolygon>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      points: this.points,\n      style: this.style,\n    }\n  }\n\n  static create(partial: PartialDeep<IIShapePolygon>): IIShapePolygon\n  {\n    if (!partial?.points || partial?.points?.length < 3) throw new Error(`Unable to create polygon at least 3 points required`)\n    if (partial?.points?.some(p => !isValidPoint(p))) throw new Error(`Unable to create a polygon, one or more points are invalid`)\n    const polygon = new IIShapePolygon(partial.points as TPoint[], partial.style)\n    if (partial.id) {\n      polygon.id = partial.id\n    }\n    return polygon\n  }\n\n  static createTriangleBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapePolygon\n  {\n    const points: TPoint[] = [\n      { x: origin.x, y: origin.y },\n      { x: target.x, y: origin.y },\n      { x: (origin.x + target.x) / 2, y: target.y }\n    ]\n    return new IIShapePolygon(points, style)\n  }\n  static updateTriangleBetweenPoints(poly: IIShapePolygon, origin: TPoint, target: TPoint): IIShapePolygon\n  {\n    poly.points = [\n      { x: origin.x, y: origin.y },\n      { x: target.x, y: origin.y },\n      { x: (origin.x + target.x) / 2, y: target.y }\n    ]\n    poly.modificationDate = Date.now()\n    return poly\n  }\n\n  static createParallelogramBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapePolygon\n  {\n    const points: TPoint[] = [\n      { x: origin.x, y: origin.y },\n      { x: origin.x + (target.x - origin.x) * 0.75, y: origin.y },\n      { x: target.x, y: target.y },\n      { x: origin.x + (target.x - origin.x) * 0.25, y: target.y },\n    ]\n    return new IIShapePolygon(points, style)\n  }\n  static updateParallelogramBetweenPoints(poly: IIShapePolygon, origin: TPoint, target: TPoint): IIShapePolygon\n  {\n    const points: TPoint[] = [\n      { x: origin.x, y: origin.y },\n      { x: origin.x + (target.x - origin.x) * 0.75, y: origin.y },\n      { x: target.x, y: target.y },\n      { x: origin.x + (target.x - origin.x) * 0.25, y: target.y },\n    ]\n    poly.points = points\n    poly.modificationDate = Date.now()\n    return poly\n  }\n\n  static createRectangleBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMin, y: box.yMin },\n      { x: box.xMax, y: box.yMin },\n      { x: box.xMax, y: box.yMax },\n      { x: box.xMin, y: box.yMax },\n    ]\n    return new IIShapePolygon(points, style)\n  }\n  static updateRectangleBetweenPoints(poly: IIShapePolygon, origin: TPoint, target: TPoint): IIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMin, y: box.yMin },\n      { x: box.xMax, y: box.yMin },\n      { x: box.xMax, y: box.yMax },\n      { x: box.xMin, y: box.yMax },\n    ]\n    poly.points = points\n    poly.modificationDate = Date.now()\n    return poly\n  }\n\n  static createRhombusBetweenPoints(origin: TPoint, target: TPoint, style?: PartialDeep<TStyle>): IIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMid, y: box.yMin },\n      { x: box.xMax, y: box.yMid },\n      { x: box.xMid, y: box.yMax },\n      { x: box.xMin, y: box.yMid },\n    ]\n    return new IIShapePolygon(points, style)\n  }\n\n  static updateRhombusBetweenPoints(poly: IIShapePolygon, origin: TPoint, target: TPoint): IIShapePolygon\n  {\n    const box = Box.createFromPoints([origin, target])\n    const points: TPoint[] = [\n      { x: box.xMid, y: box.yMin },\n      { x: box.xMax, y: box.yMid },\n      { x: box.xMid, y: box.yMax },\n      { x: box.xMin, y: box.yMid },\n    ]\n    poly.points = points\n    poly.modificationDate = Date.now()\n    return poly\n  }\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep, computeDistance, getClosestPoint } from \"../utils\"\nimport { TStroke, TStrokeToSend } from \"./Stroke\"\nimport { TPoint, TPointer } from \"./Point\"\nimport { Box, TBox } from \"./Box\"\nimport { SymbolType } from \"./Symbol\"\nimport { IIDecorator } from \"./IIDecorator\"\nimport { IISymbolBase } from \"./IISymbolBase\"\n\n/**\n * @group Symbol\n */\nexport class IIStroke extends IISymbolBase<SymbolType.Stroke>\n{\n  readonly isClosed = false\n\n  pointerType: string\n  length: number\n  decorators: IIDecorator[]\n  pointers: Array<TPointer>\n\n  constructor(style?: PartialDeep<TStyle>, pointerType = \"pen\")\n  {\n    super(SymbolType.Stroke, style)\n\n    this.pointerType = pointerType\n    this.pointers = []\n    this.decorators = []\n    this.length = 0\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  static split(strokeToSplit: IIStroke, i: number): { before: IIStroke, after: IIStroke }\n  {\n    const before = new IIStroke(strokeToSplit.style, strokeToSplit.pointerType)\n    before.pointers = strokeToSplit.pointers.slice(0, i)\n\n    const after = new IIStroke(strokeToSplit.style, strokeToSplit.pointerType)\n    after.pointers = strokeToSplit.pointers.slice(i)\n\n    return { before, after }\n  }\n\n  static substract(stroke: IIStroke, partStroke: IIStroke): { before?: IIStroke, after?: IIStroke }\n  {\n    if (!partStroke.length) return { before: stroke }\n    const result: { before?: IIStroke, after?: IIStroke } = {}\n    const lastPointBeforeStroke = {\n      x: partStroke.pointers[0].x as number,\n      y: partStroke.pointers[0].y as number\n    }\n    const closestLastPointBeforeStroke = getClosestPoint(stroke.pointers, lastPointBeforeStroke)\n    if (closestLastPointBeforeStroke.index > -1) {\n      const newStrokes = IIStroke.split(stroke, closestLastPointBeforeStroke.index)\n      result.before = newStrokes.before\n      result.after = newStrokes.after\n    }\n    const strokeAfter = result.after || stroke\n    const firstPointAfterStroke = {\n      x: partStroke.pointers.at(-1)!.x as number,\n      y: partStroke.pointers.at(-1)!.y as number\n    }\n    const closestFirstPointStrokeAfter = getClosestPoint(strokeAfter.pointers, firstPointAfterStroke)\n    if (closestFirstPointStrokeAfter.index > -1) {\n      const newStrokes = IIStroke.split(strokeAfter, closestFirstPointStrokeAfter.index)\n      result.after = newStrokes.after\n    }\n    if (!result.before?.pointers.length) result.before = undefined\n    if (!result.after?.pointers.length) result.after = undefined\n    return result\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.bounds.snapPoints\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.pointers\n  }\n\n  protected computePressure(distance: number): number\n  {\n    let ratio = 1.0\n    if (distance === this.length) {\n      ratio = 1.0\n    } else if (distance < 10) {\n      ratio = 0.2 + Math.pow(0.1 * distance, 0.4)\n    } else if (distance > this.length - 10) {\n      ratio = 0.2 + Math.pow(0.1 * (this.length - distance), 0.4)\n    }\n    const pressure = ratio * Math.max(0.1, 1.0 - (0.1 * Math.sqrt(distance)))\n    return isNaN(pressure) ? 0.5 : Math.round(pressure * 100) / 100\n  }\n\n  protected filterPointByAcquisitionDelta(point: TPointer): boolean\n  {\n    const lastPointer = this.pointers.at(-1)\n    const delta: number = (2 + ((this.style.width || 1) / 4))\n    return !lastPointer ||\n      Math.abs(lastPointer.x - point.x) >= delta ||\n      Math.abs(lastPointer.y - point.y) >= delta\n  }\n\n  addPointer(pointer: TPointer): void\n  {\n    if (this.filterPointByAcquisitionDelta(pointer)) {\n      const lastPointer = this.pointers.at(-1)\n      const distance = lastPointer ? computeDistance(pointer, lastPointer) : 0\n      this.length += distance\n      pointer.p = this.computePressure(distance)\n      this.pointers.push(pointer)\n      this.modificationDate = Date.now()\n    }\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.pointers.some(p =>\n    {\n      return p.x >= box.x && p.x <= box.x + box.width\n        && p.y >= box.y && p.y <= box.y + box.height\n    })\n  }\n\n  clone(): IIStroke\n  {\n    const clone = new IIStroke(this.style, this.pointerType)\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.pointers = structuredClone(this.pointers)\n    clone.decorators = this.decorators.map(d => d.clone())\n    clone.length = this.length\n    return clone\n  }\n\n  formatToSend(): TStrokeToSend\n  {\n    const json: TStrokeToSend = {\n      id: this.id,\n      pointerType: this.pointerType,\n      p: [],\n      t: [],\n      x: [],\n      y: []\n    }\n    this.pointers.forEach(p =>\n    {\n      json.p.push(p.p)\n      json.t.push(p.t)\n      json.x.push(p.x)\n      json.y.push(p.y)\n    })\n    return json\n  }\n\n  toJSON(): PartialDeep<IIStroke>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      pointers: this.pointers,\n      style: this.style,\n      decorators: this.decorators.length ? this.decorators : undefined\n    }\n  }\n\n  static create(partial: PartialDeep<IIStroke>): IIStroke\n  {\n    if (!partial.pointers?.length) {\n      throw new Error(`not pointers`)\n    }\n    const stroke = new IIStroke(partial.style, partial.pointerType)\n    if (partial.id) {\n      stroke.id = partial.id\n    }\n    const errors: string[] = []\n    let flag = true\n    partial.pointers?.forEach((pp, pIndex) =>\n    {\n      if (!pp) {\n        errors.push(`no pointer at ${ pIndex }`)\n        flag = false\n        return\n      }\n      const pointer: TPointer = {\n        p: pp.p || 1,\n        t: pp.t || pIndex,\n        x: 0,\n        y: 0\n      }\n      if (pp?.x == undefined || pp?.x == null) {\n        errors.push(`no x at pointer at ${ pIndex }`)\n        flag = false\n        return\n      }\n      else {\n        pointer.x = pp.x\n      }\n      if (pp?.y == undefined || pp?.y == null) {\n        errors.push(`no y at pointer at ${ pIndex }`)\n        flag = false\n        return\n      }\n      else {\n        pointer.y = pp.y\n      }\n      if (flag) {\n        stroke.addPointer(pointer)\n      }\n    })\n\n    if (errors.length) {\n      throw new Error(errors.join(\" and \"))\n    }\n    if (partial.decorators?.length) {\n      partial.decorators.forEach(d => {\n        if(d?.kind) {\n          stroke.decorators.push(new IIDecorator(d.kind, Object.assign({}, stroke.style, d.style)))\n        }\n      })\n    }\n    return stroke\n  }\n}\n\n/**\n * @group Symbol\n * @group Utils\n */\nexport function convertPartialStrokesToOIStrokes(json: PartialDeep<TStroke>[]): IIStroke[]\n{\n  const errors: string[] = []\n  const strokes: IIStroke[] = []\n  json.forEach((j, i) =>\n  {\n    try {\n      strokes.push(IIStroke.create(j as PartialDeep<IIStroke>))\n    } catch (e) {\n      errors.push(`stroke ${ i + 1 } has ${ (e as Error).message }`)\n    }\n  })\n\n  if (errors.length) {\n    throw new Error(errors.join(\"\\n\"))\n  }\n\n  return strokes\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedArc extends IIRecognizedBase<RecognizedKind.Arc>\n{\n  readonly isClosed = false\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Arc, strokes, style)\n  }\n\n  clone(): IIRecognizedArc\n  {\n    const clone = new IIRecognizedArc(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedArc>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: structuredClone(this.strokes),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedArc>): IIRecognizedArc\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n    const ws = new IIRecognizedArc(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedCircle extends IIRecognizedBase<RecognizedKind.Circle>\n{\n  readonly isClosed = true\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Circle, strokes, style)\n  }\n\n  clone(): IIRecognizedCircle\n  {\n    const clone = new IIRecognizedCircle(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedCircle>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: structuredClone(this.strokes),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedCircle>): IIRecognizedCircle\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n\n    const ws = new IIRecognizedCircle(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedEllipse extends IIRecognizedBase<RecognizedKind.Ellipse>\n{\n  readonly isClosed = true\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Ellipse, strokes, style)\n  }\n\n  clone(): IIRecognizedEllipse\n  {\n    const clone = new IIRecognizedEllipse(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedEllipse>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: structuredClone(this.strokes),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedEllipse>): IIRecognizedEllipse\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n\n    const ws = new IIRecognizedEllipse(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedLine extends IIRecognizedBase<RecognizedKind.Line>\n{\n  readonly isClosed = false\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Line, strokes, style)\n  }\n\n  clone(): IIRecognizedLine\n  {\n    const clone = new IIRecognizedLine(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedLine>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: structuredClone(this.strokes),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedLine>): IIRecognizedLine\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n\n    const ws = new IIRecognizedLine(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedPolyLine extends IIRecognizedBase<RecognizedKind.PolyEdge>\n{\n  readonly isClosed = false\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.PolyEdge, strokes, style)\n  }\n\n  clone(): IIRecognizedPolyLine\n  {\n    const clone = new IIRecognizedPolyLine(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedPolyLine>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: structuredClone(this.strokes),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedPolyLine>): IIRecognizedPolyLine\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n\n    const ws = new IIRecognizedPolyLine(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedPolygon extends IIRecognizedBase<RecognizedKind.Polygone>\n{\n  readonly isClosed = true\n\n  constructor(\n    strokes: IIStroke[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Polygone, strokes, style)\n  }\n\n  clone(): IIRecognizedPolygon\n  {\n    const clone = new IIRecognizedPolygon(this.strokes.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedPolygon>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      strokes: structuredClone(this.strokes),\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedPolygon>): IIRecognizedPolygon\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n\n    const ws = new IIRecognizedPolygon(strokes, partial.style)\n\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../../style\"\nimport { PartialDeep } from \"../../utils\"\nimport { IIDecorator } from \"../IIDecorator\"\nimport { IIRecognizedBase, RecognizedKind } from \"./IIRecognizedBase\"\nimport { IIStroke } from \"../IIStroke\"\n\n/**\n * @group Symbol\n */\nexport class IIRecognizedText extends IIRecognizedBase<RecognizedKind.Text>\n{\n  readonly isClosed = false\n\n  decorators: IIDecorator[]\n\n  baseline: number\n  xHeight: number\n  label?: string\n\n  constructor(\n    strokes: IIStroke[],\n    lines: { baseline: number, xHeight: number },\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(RecognizedKind.Text, strokes, style)\n    this.baseline = lines.baseline\n    this.xHeight = lines.xHeight\n    this.decorators = []\n  }\n\n  clone(): IIRecognizedText\n  {\n    const clone = new IIRecognizedText(this.strokes.map(s => s.clone()), { baseline: this.baseline, xHeight: this.xHeight }, structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.label = this.label\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.decorators = this.decorators.map(d => d.clone())\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIRecognizedText>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      kind: this.kind,\n      label: this.label,\n      baseline: this.baseline,\n      xHeight: this.xHeight,\n      strokes: structuredClone(this.strokes),\n      decorators: this.decorators.length ? structuredClone(this.decorators) : undefined\n    }\n  }\n\n  static create(partial: PartialDeep<IIRecognizedText>): IIRecognizedText\n  {\n    if (!partial.strokes?.length) {\n      throw new Error(`no strokes`)\n    }\n    const strokes = partial.strokes.map(s => IIStroke.create(s!))\n    const line = {\n      baseline: partial.baseline || 0,\n      xHeight: partial.xHeight || 0\n    }\n    const ws = new IIRecognizedText(strokes, line, partial.style)\n\n    if (partial.decorators?.length) {\n      partial.decorators.forEach(d =>\n      {\n        if (d?.kind) {\n          ws.decorators.push(new IIDecorator(d.kind, Object.assign({}, ws.style, d.style)))\n        }\n      })\n    }\n    if (partial.id) {\n      ws.id = partial.id\n    }\n    return ws\n  }\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep } from \"../utils\"\nimport { TPoint } from \"./Point\"\nimport { Box, TBox } from \"./Box\"\nimport { SymbolType } from \"./Symbol\"\nimport { IIDecorator } from \"./IIDecorator\"\nimport { IISymbolBase } from \"./IISymbolBase\"\nimport { IIStroke } from \"./IIStroke\"\nimport { IIText } from \"./IIText\"\nimport { TIISymbol } from \".\"\n\n/**\n * @group Symbol\n */\nexport class IISymbolGroup extends IISymbolBase<SymbolType.Group>\n{\n  readonly isClosed = false\n\n  children: TIISymbol[]\n  decorators: IIDecorator[]\n\n  constructor(\n    children: TIISymbol[],\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(SymbolType.Group, style)\n    this.children = children\n    this.decorators = []\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return this.bounds.snapPoints\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.children.flatMap(s => s.vertices)\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromBoxes(this.children.map(c => c.bounds))\n  }\n\n  updateChildrenStyle(): void\n  {\n    this.children.forEach(child => {\n      child.style = Object.assign({}, child.style, this.style)\n      switch (child.type) {\n        case SymbolType.Group:\n          child.updateChildrenStyle()\n          break\n        case SymbolType.Text:\n          child.chars.forEach(c =>\n          {\n            if (child.style.color) {\n              c.color = child.style.color\n            }\n          })\n          break\n        case SymbolType.Recognized:\n          child.updateChildrenStyle()\n          break\n      }\n\n    })\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.children.some(s => s.overlaps(box))\n  }\n\n  containsSymbol(strokeId: string): boolean\n  {\n    return IISymbolGroup.containsSymbol(this, strokeId)\n  }\n\n  containsOnlyStroke(): boolean\n  {\n    return IISymbolGroup.containsOnlyStroke(this)\n  }\n\n  extractText(): IIText[]\n  {\n    return IISymbolGroup.extractText(this)\n  }\n\n  extractStrokes(): IIStroke[]\n  {\n    return IISymbolGroup.extractStrokes(this)\n  }\n\n  removeChilds(symbolIds: string[]): IISymbolGroup\n  {\n    return IISymbolGroup.removeChilds(this, symbolIds)\n  }\n\n  static containsOnlyStroke(group: IISymbolGroup): boolean\n  {\n    return group.children.every(s =>\n    {\n      if (s.type === SymbolType.Group) {\n        return IISymbolGroup.containsOnlyStroke(s as IISymbolGroup)\n      }\n      if (s.type === SymbolType.Stroke) {\n        return true\n      }\n      return false\n    })\n  }\n\n  static extractText(group: IISymbolGroup): IIText[]\n  {\n    const texts: IIText[] = []\n    group.children.forEach(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Text:\n          texts.push(s)\n          break;\n        case SymbolType.Group:\n          texts.push(...IISymbolGroup.extractText(s))\n          break;\n      }\n    })\n    return texts\n  }\n\n  static extractStrokes(group: IISymbolGroup): IIStroke[]\n  {\n    const strokes: IIStroke[] = []\n    group.children.forEach(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Stroke:\n          strokes.push(s)\n          break;\n        case SymbolType.Recognized:\n          strokes.push(...s.strokes)\n          break;\n        case SymbolType.Group:\n          strokes.push(...IISymbolGroup.extractStrokes(s))\n          break;\n      }\n    })\n    return strokes\n  }\n\n  static containsSymbol(group: IISymbolGroup, symbolId: string): boolean\n  {\n    return group.children.some(symbol =>\n    {\n      if (symbol.id === symbolId) return true\n      if (symbol.type === SymbolType.Group) {\n        return IISymbolGroup.containsSymbol(symbol, symbolId)\n      }\n      else if (symbol.type === SymbolType.Recognized) {\n        return symbol.containsStroke(symbolId)\n      }\n      return false\n    })\n  }\n\n  static removeChilds(group: IISymbolGroup, symbolIds: string[]): IISymbolGroup\n  {\n    group.children = group.children.filter(s => !symbolIds.includes(s.id))\n    const symbolsToRemove = group.children.slice()\n    symbolsToRemove.forEach(s =>\n    {\n      if (s.type === SymbolType.Group) {\n        if (!s.removeChilds(symbolIds).children.length) {\n          group.children = group.children.filter(s1 => s1.id !== s.id)\n        }\n      }\n      else if (s.type === SymbolType.Recognized) {\n        s.removeStrokes(symbolIds)\n        if (!s.strokes.length) {\n          group.removeChilds([s.id])\n        }\n      }\n    })\n    return group\n  }\n\n  clone(): IISymbolGroup\n  {\n    const clone = new IISymbolGroup(this.children.map(s => s.clone()), structuredClone({ ...this.style }))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.decorators = this.decorators.map(d => d.clone())\n    return clone\n  }\n\n  toJSON(): PartialDeep<IISymbolGroup>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      children: structuredClone(this.children),\n      decorators: this.decorators.length ? structuredClone(this.decorators) : undefined\n    }\n  }\n}\n","import { TStyle } from \"../style\"\nimport { PartialDeep, convertDegreeToRadian, findIntersectionBetween2Segment, isPointInsidePolygon, computeRotatedPoint } from \"../utils\"\nimport { TPoint, isValidPoint } from \"./Point\"\nimport { SymbolType } from \"./Symbol\"\nimport { Box, TBox } from \"./Box\"\nimport { IIDecorator } from \"./IIDecorator\"\nimport { IISymbolBase } from \"./IISymbolBase\"\n\n/**\n * @group Symbol\n */\nexport type TIISymbolChar = {\n  id: string\n  label: string\n  fontSize: number\n  fontWeight: \"normal\" | \"bold\"\n  color: string\n  bounds: TBox\n}\n\n/**\n * @group Symbol\n */\nexport class IIText extends IISymbolBase<SymbolType.Text>\n{\n  readonly isClosed = true\n\n  point: TPoint\n  chars: TIISymbolChar[]\n  decorators: IIDecorator[]\n  bounds: Box\n  rotation?: {\n    degree: number,\n    center: TPoint\n  }\n\n  constructor(\n    chars: TIISymbolChar[],\n    point: TPoint,\n    bounds: TBox,\n    style?: PartialDeep<TStyle>\n  )\n  {\n    super(SymbolType.Text, style)\n    this.point = point\n    this.bounds = new Box(bounds)\n    this.chars = chars\n    this.decorators = []\n  }\n\n  get label(): string\n  {\n    return this.chars.map(c => c.label).join(\"\")\n  }\n\n  get vertices(): TPoint[]\n  {\n    if (this.rotation) {\n      const center = this.rotation.center\n      const rad = convertDegreeToRadian(-this.rotation.degree)\n      return this.bounds.corners\n        .map(p =>\n        {\n          return computeRotatedPoint(p, center, rad)\n        })\n    }\n    else {\n      return this.bounds.corners\n    }\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    const offsetY = this.bounds.yMax - this.point.y\n    const points = [\n      { x: this.bounds.x, y: this.bounds.yMin + offsetY },\n      { x: this.bounds.xMax, y: this.bounds.yMin + offsetY },\n      { x: this.bounds.xMax, y: this.bounds.yMax - offsetY },\n      { x: this.bounds.x, y: this.bounds.yMax - offsetY },\n      this.bounds.center\n    ]\n    if (this.rotation) {\n      const center = this.rotation.center\n      const rad = convertDegreeToRadian(-this.rotation.degree)\n      return points\n        .map(p =>\n        {\n          return computeRotatedPoint(p, center, rad)\n        })\n    }\n    return points\n  }\n\n  protected getCharCorners(char: TIISymbolChar): TPoint[]\n  {\n    const boxBox = new Box(char.bounds)\n    if (this.rotation) {\n      const center = this.rotation.center\n      const rad = convertDegreeToRadian(-this.rotation.degree)\n      return boxBox.corners\n        .map(p =>\n        {\n          return computeRotatedPoint(p, center, rad)\n        })\n    }\n    return boxBox.corners\n  }\n\n  updateChildrenStyle(): void\n  {\n    this.chars.forEach(c => {\n      if (this.style.color) {\n        c.color = this.style.color\n      }\n    })\n    this.modificationDate = Date.now()\n  }\n\n  updateChildrenFont( { fontSize, fontWeight }: { fontSize?: number, fontWeight?: \"normal\" | \"bold\" }): void\n  {\n    this.chars.forEach(c => {\n      if (fontSize) {\n        c.fontSize = fontSize\n      }\n      if (fontWeight) {\n        c.fontWeight = fontWeight\n      }\n    })\n    this.modificationDate = Date.now()\n  }\n\n  getCharsOverlaps(points: TPoint[]): TIISymbolChar[]\n  {\n    return this.chars.filter(c =>\n    {\n      const charCorners = this.getCharCorners(c)\n      return points.some(p => isPointInsidePolygon(p, charCorners))\n    })\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.vertices.some(p => Box.containsPoint(box, p)) ||\n      this.edges.some(e1 => Box.getSides(box).some(e2 => !!findIntersectionBetween2Segment(e1, e2)))\n  }\n\n  clone(): IIText\n  {\n    const clone = new IIText(structuredClone(this.chars), structuredClone(this.point), this.bounds, structuredClone(this.style))\n    clone.id = this.id\n    clone.selected = this.selected\n    clone.deleting = this.deleting\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.decorators = this.decorators.map(d => d.clone())\n    clone.rotation = this.rotation ? structuredClone(this.rotation) : undefined\n    return clone\n  }\n\n  toJSON(): PartialDeep<IIText>\n  {\n    return {\n      id: this.id,\n      type: this.type,\n      point: this.point,\n      chars: this.chars,\n      style: this.style,\n      rotation: this.rotation,\n      bounds: this.bounds,\n      decorators: this.decorators.length ? this.decorators : undefined\n    }\n  }\n\n  static create(partial: PartialDeep<IIText>): IIText\n  {\n    if (!isValidPoint(partial?.point)) throw new Error(`Unable to create a IIText, point are invalid`)\n    if (!partial.chars?.length) throw new Error(`Unable to create a IIText, no chars`)\n    if (!partial.bounds) throw new Error(`Unable to create a IIText, no boundingBox`)\n    const text = new IIText(partial.chars as TIISymbolChar[], partial.point as TPoint, partial.bounds as TBox, partial.style)\n    if (partial.id) text.id = partial.id\n    if (partial.decorators?.length) {\n      partial.decorators.forEach(d => {\n        if(d?.kind) {\n          text.decorators.push(new IIDecorator(d.kind, Object.assign({}, text.style, d.style)))\n        }\n      })\n    }\n    return text\n  }\n}\n","import { createUUID, PartialDeep } from \"../utils\"\nimport { TPoint, TPointer } from \"./Point\"\nimport { Box, TBox } from \"./Box\"\nimport { SymbolType } from \"./Symbol\"\nimport { IISymbolBase } from \"./IISymbolBase\"\nimport { TStyle } from \"../style\"\n\nconst style: TStyle = {\n  color: \"grey\",\n  fill: \"none\",\n  width: 12,\n  opacity: 0.2\n}\n\n/**\n * @group Symbol\n */\nexport class IIEraser extends IISymbolBase<SymbolType.Eraser>\n{\n  readonly isClosed = false\n  pointers: TPointer[]\n\n  constructor()\n  {\n    super(SymbolType.Eraser, style)\n    this.id = `${ this.type }-${ createUUID() }`\n    this.creationTime = Date.now()\n    this.modificationDate = this.creationTime\n    this.pointers = []\n  }\n\n  get bounds(): Box\n  {\n    return Box.createFromPoints(this.vertices)\n  }\n\n  get vertices(): TPoint[]\n  {\n    return this.pointers\n  }\n\n  get snapPoints(): TPoint[]\n  {\n    return []\n  }\n\n  clone(): IISymbolBase\n  {\n    const clone = new IIEraser()\n    clone.id = this.id\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.pointers = structuredClone(this.pointers)\n    return clone\n  }\n\n  overlaps(box: TBox): boolean\n  {\n    return this.pointers.some(p =>\n    {\n      return p.x >= box.x && p.x <= box.x + box.width\n        && p.y >= box.y && p.y <= box.y + box.height\n    })\n  }\n\n  toJSON(): PartialDeep<IIEraser>\n  {\n    return {\n      id: this.id,\n      pointers: this.pointers,\n      style: this.style\n    }\n  }\n}\n","import { DefaultPenStyle, TPenStyle } from \"../style\"\nimport { PartialDeep, createUUID } from \"../utils\"\nimport { TPointer } from \"./Point\"\nimport { SymbolType, TSymbol } from \"./Symbol\"\n\n/**\n * @group Symbol\n */\nexport type TStrokeToSend = {\n  id: string\n  pointerType: string\n  x: number[]\n  y: number[]\n  t: number[]\n  p: number[]\n}\n\n/**\n * @group Symbol\n */\nexport type TStrokeGroupToSend = {\n  penStyle?: string\n  strokes: TStrokeToSend[]\n}\n\n/**\n * @group Symbol\n */\nexport type TStroke = TSymbol & {\n  style: TPenStyle\n  pointerType: string\n  pointers: TPointer[]\n  length: number\n}\n\n/**\n * @group Symbol\n */\nexport type TStrokeGroup = {\n  penStyle: TPenStyle\n  strokes: Stroke[]\n}\n\n/**\n * @group Symbol\n */\nexport class Stroke implements TStroke\n{\n  type = SymbolType.Stroke\n  id: string\n  creationTime: number\n  modificationDate: number\n  style: TPenStyle\n  pointerType: string\n  pointers: TPointer[]\n  length: number\n\n  constructor(style: TPenStyle, pointerType = \"pen\")\n  {\n    this.id = `${this.type}-${createUUID()}`\n    this.creationTime = Date.now()\n    this.modificationDate = this.creationTime\n    this.style = style\n    this.pointerType = pointerType\n    this.pointers = []\n    this.length = 0\n  }\n\n  clone(): Stroke\n  {\n    const clone = new Stroke(this.style, this.pointerType)\n    clone.id = this.id\n    clone.creationTime = this.creationTime\n    clone.modificationDate = this.modificationDate\n    clone.pointers = structuredClone(this.pointers)\n    clone.length = this.length\n    return clone\n  }\n\n  formatToSend(): TStrokeToSend\n  {\n    const json: TStrokeToSend = {\n      id: this.id,\n      pointerType: this.pointerType,\n      p: [],\n      t: [],\n      x: [],\n      y: []\n    }\n    this.pointers.forEach(p => {\n      json.p.push(p.p)\n      json.t.push(p.t)\n      json.x.push(p.x)\n      json.y.push(p.y)\n    })\n    return json\n  }\n}\n\n/**\n * @group Symbol\n * @group Utils\n */\nexport function convertPartialStrokesToStrokes(json: PartialDeep<TStroke>[]): Stroke[]\n{\n  const errors: string[] = []\n  const strokes: Stroke[] = []\n  json.forEach((j, ji) => {\n    let flag = true\n    const stroke = new Stroke(j.style || DefaultPenStyle, j.pointerType)\n    if (j.id) stroke.id = j.id\n    if (!j.pointers?.length) {\n      errors.push(`stroke ${ji + 1} has not pointers`)\n      flag = false\n      return\n    }\n    j.pointers?.forEach((pp, pIndex) => {\n      if (!pp) {\n        errors.push(`stroke ${ji + 1} has no pointer at ${pIndex}`)\n        flag = false\n        return\n      }\n      const pointer: TPointer = {\n        p: pp.p || 1,\n        t: pp.t || pIndex,\n        x: 0,\n        y: 0\n      }\n      if (pp?.x == undefined || pp?.x == null) {\n        errors.push(`stroke ${ji + 1} has no x at pointer at ${pIndex}`)\n        flag = false\n        return\n      }\n      else {\n        pointer.x = pp.x\n      }\n      if (pp?.y == undefined || pp?.y == null) {\n        errors.push(`stroke ${ji + 1} has no y at pointer at ${pIndex}`)\n        flag = false\n        return\n      }\n      else {\n        pointer.y = pp.y\n      }\n      if (flag) {\n        stroke.pointers.push(pointer)\n      }\n    })\n    if (flag) {\n      strokes.push(stroke)\n    }\n  })\n\n  if (errors.length) {\n    throw new Error(errors.join(\"\\n\"))\n  }\n\n  return strokes\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { TPenStyle } from \"../style\"\nimport { computeDistance } from \"../utils\"\nimport { TExport } from \"./Export\"\nimport { Stroke, TPoint, TPointer } from \"../symbol\"\n\n/**\n * @group Model\n */\nexport type TRecognitionPositions = {\n  lastSentPosition: number\n  lastReceivedPosition: number\n}\n\n/**\n * @group Model\n */\nexport class Model\n{\n  readonly creationTime: number\n  modificationDate: number\n  positions: TRecognitionPositions\n  currentSymbol?: Stroke\n  symbols: Stroke[]\n  exports?: TExport\n  converts?: TExport\n  width: number\n  height: number\n  rowHeight: number\n  idle: boolean\n  #logger = LoggerManager.getLogger(LoggerCategory.MODEL)\n\n  constructor(width = 100, height = 100, rowHeight = 0, creationDate = Date.now())\n  {\n    this.#logger.info(\"constructor\", { width, height, creationDate })\n    this.creationTime = creationDate\n    this.modificationDate = creationDate\n    this.width = width\n    this.height = height\n    this.rowHeight = rowHeight\n    this.symbols = []\n    this.positions = {\n      lastSentPosition: 0,\n      lastReceivedPosition: 0\n    }\n    this.idle = true\n  }\n\n  protected computePressure(distance: number, globalDistance: number): number\n  {\n    let ratio = 1.0\n    if (distance === globalDistance) {\n      ratio = 1.0\n    } else if (distance < 10) {\n      ratio = 0.2 + Math.pow(0.1 * distance, 0.4)\n    } else if (distance > globalDistance - 10) {\n      ratio = 0.2 + Math.pow(0.1 * (globalDistance - distance), 0.4)\n    }\n    const pressure = ratio * Math.max(0.1, 1.0 - (0.1 * Math.sqrt(distance)))\n    return isNaN(pressure) ? 0.5 : Math.round(pressure * 100) / 100\n  }\n\n  protected filterPointByAcquisitionDelta(stroke: Stroke, point: TPointer, lastPointer?: TPointer): boolean\n  {\n    const delta: number = (2 + ((stroke.style[\"-myscript-pen-width\"] || 0) / 4))\n    return !lastPointer ||\n      stroke.pointers.length === 0 ||\n      Math.abs(lastPointer.x - point.x) >= delta ||\n      Math.abs(lastPointer.y - point.y) >= delta\n  }\n\n  getStrokeFromPoint(point: TPoint): Stroke[]\n  {\n    this.#logger.info(\"getStrokeFromPoint\", { point })\n    const isBetween = (val: number, min: number, max: number): boolean => (val >= min && val <= max)\n\n    const _strokeList: Stroke[] = []\n    this.symbols.forEach((stroke) =>\n    {\n      for (let i = 0; i < stroke.pointers.length; i++) {\n        const strokePointer = stroke.pointers[i]\n        if (\n          isBetween(strokePointer.x, point.x - 5, point.x + 5) &&\n          isBetween(strokePointer.y, point.y - 5, point.y + 5)\n        ) {\n          _strokeList.push(stroke)\n          break\n        }\n        else {\n          if (computeDistance(point, strokePointer) < 10) {\n            _strokeList.push(stroke)\n            break\n          }\n        }\n      }\n    })\n    this.#logger.debug(\"getStrokeFromPoint\", { strokes: _strokeList })\n    return _strokeList\n  }\n\n  addPoint(stroke: Stroke, pointer: TPointer): void\n  {\n    this.#logger.debug(\"addPoint\", { stroke, pointer })\n    const lastPointer = stroke.pointers.at(-1)\n    if (this.filterPointByAcquisitionDelta(stroke, pointer, lastPointer)) {\n      const distance = lastPointer ? computeDistance(pointer, lastPointer) : 0\n      stroke.length += distance\n      pointer.p = this.computePressure(distance, stroke.length)\n      stroke.pointers.push(pointer)\n      stroke.modificationDate = Date.now()\n    }\n  }\n\n  addStroke(stroke: Stroke): void\n  {\n    this.#logger.info(\"addStroke\", { stroke })\n    this.symbols.push(stroke)\n    this.modificationDate = Date.now()\n    this.converts = undefined\n    this.exports = undefined\n  }\n\n  updateStroke(updatedStroke: Stroke): void\n  {\n    this.#logger.info(\"updateStroke\", { updatedStroke })\n    const strokeIndex = this.symbols.findIndex((s: Stroke): boolean => s.id === updatedStroke.id)\n    if (strokeIndex !== -1) {\n      updatedStroke.modificationDate = Date.now()\n      this.symbols.splice(strokeIndex, 1, updatedStroke)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"updateStroke\", this.symbols)\n  }\n\n  removeStroke(id: string): void\n  {\n    this.#logger.info(\"removeStroke\", { id })\n    const strokeIndex = this.symbols.findIndex(s => s.id === id)\n    if (strokeIndex !== -1) {\n      this.positions.lastSentPosition--\n      this.positions.lastReceivedPosition--\n      this.symbols.splice(strokeIndex, 1)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"removeStroke\", this.symbols)\n  }\n\n  removeStrokesFromPoint(point: TPoint): string[]\n  {\n    this.#logger.info(\"removeStrokesFromPoint\", { point })\n    const strokes = this.getStrokeFromPoint(point)\n    strokes.forEach(strokeToRemove =>\n    {\n      this.removeStroke(strokeToRemove.id)\n    })\n    this.#logger.debug(\"removeStrokesFromPoint\", strokes.map(s => s.id))\n    return strokes.map(s => s.id)\n  }\n\n  extractUnsentStrokes(): Stroke[]\n  {\n    return this.symbols.slice(this.positions.lastSentPosition)\n  }\n\n  initCurrentStroke(point: TPointer, pointerType: string, style: TPenStyle, dpi = 96): void\n  {\n    this.#logger.info(\"initCurrentStroke\", { point, pointerType, style, dpi })\n    if (style[\"-myscript-pen-width\"]) {\n      const pxWidth = (style[\"-myscript-pen-width\"] * dpi) / 25.4\n      style.width = pxWidth / 2\n    }\n    this.modificationDate = Date.now()\n    this.exports = undefined\n    this.currentSymbol = new Stroke(style, pointerType)\n    this.#logger.debug(\"initCurrentStroke\", this.currentSymbol)\n    this.addPoint(this.currentSymbol, point)\n  }\n\n  appendToCurrentStroke(point: TPointer): void\n  {\n    this.#logger.info(\"appendToCurrentStroke\", { point })\n    if (this.currentSymbol) {\n      this.addPoint(this.currentSymbol, point)\n    }\n    this.#logger.debug(\"appendToCurrentStroke\", this.currentSymbol)\n  }\n\n  endCurrentStroke(point: TPointer): void\n  {\n    this.#logger.info(\"endCurrentStroke\", { point })\n    if (this.currentSymbol) {\n      this.addPoint(this.currentSymbol, point)\n      this.addStroke(this.currentSymbol)\n      this.currentSymbol = undefined\n    }\n    this.#logger.debug(\"endCurrentStroke\", this.currentSymbol)\n  }\n\n  updatePositionSent(position: number = this.symbols.length): void\n  {\n    this.#logger.info(\"updatePositionSent\", { position })\n    this.positions.lastSentPosition = position\n    this.#logger.debug(\"updatePositionSent\", this.positions.lastSentPosition)\n  }\n\n  updatePositionReceived(): void\n  {\n    this.#logger.info(\"updatePositionReceived\")\n    this.positions.lastReceivedPosition = this.positions.lastSentPosition\n    this.#logger.debug(\"updatePositionReceived\", this.positions.lastReceivedPosition)\n  }\n\n  mergeExport(exports: TExport)\n  {\n    this.#logger.info(\"mergeExport\", { exports })\n    if (this.exports) {\n      Object.assign(this.exports, exports)\n    } else {\n      this.exports = exports\n    }\n    this.#logger.debug(\"mergeExport\", this.exports)\n  }\n\n  mergeConvert(converts: TExport)\n  {\n    this.#logger.info(\"mergeConvert\", { converts })\n    if (this.converts) {\n      Object.assign(this.converts, converts)\n    } else {\n      this.converts = converts\n    }\n    this.#logger.debug(\"mergeConvert\", this.converts)\n  }\n\n  clone(): Model\n  {\n    this.#logger.info(\"clone\")\n    const clonedModel = new Model(this.width, this.height, this.rowHeight, this.creationTime)\n    clonedModel.modificationDate = structuredClone(this.modificationDate)\n    clonedModel.currentSymbol = this.currentSymbol ? this.currentSymbol.clone() : undefined\n    clonedModel.symbols = this.symbols.map(s => s.clone())\n    clonedModel.positions = structuredClone(this.positions)\n    clonedModel.exports = this.exports ? structuredClone(this.exports) : undefined\n    clonedModel.converts = this.converts ? structuredClone(this.converts) : undefined\n    clonedModel.idle = this.idle\n    this.#logger.debug(\"clone\", { clonedModel })\n    return clonedModel\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    this.modificationDate = Date.now()\n    this.currentSymbol = undefined\n    this.symbols = []\n    this.positions.lastSentPosition = 0\n    this.positions.lastReceivedPosition = 0\n    this.exports = undefined\n    this.converts = undefined\n    this.idle = true\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport\n{\n  RecognizedKind,\n  SymbolType,\n  TIISymbol,\n} from \"../symbol\"\nimport { TExport } from \"./Export\"\n\n/**\n * @group Model\n */\nexport class IIModel\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MODEL)\n  #symbolsMap = new Map<string, TIISymbol>()\n  readonly creationTime: number\n  modificationDate: number\n  currentSymbol?: TIISymbol\n  symbols: TIISymbol[]\n  exports?: TExport\n  converts?: TExport\n  width: number\n  height: number\n  rowHeight: number\n  idle: boolean\n\n  constructor(width = 100, height = 100, rowHeight = 0, creationDate = Date.now())\n  {\n    this.creationTime = creationDate\n    this.modificationDate = creationDate\n    this.width = width\n    this.height = height\n    this.rowHeight = rowHeight\n    this.symbols = []\n    this.exports = undefined\n    this.converts = undefined\n    this.idle = true\n  }\n\n  /**\n   * Synchronize the internal Map with the symbols array\n   * Useful when symbols are modified directly (e.g., in tests)\n   */\n  #syncMap(): void\n  {\n    if (this.#symbolsMap.size !== this.symbols.length) {\n      this.#symbolsMap.clear()\n      this.symbols.forEach(s => this.#symbolsMap.set(s.id, s))\n    }\n  }\n\n  get symbolsSelected(): TIISymbol[]\n  {\n    return this.symbols.filter(s => s.selected)\n  }\n\n  get symbolsToDelete(): TIISymbol[]\n  {\n    return this.symbols.filter(s => s.deleting)\n  }\n\n  selectSymbol(id: string): void\n  {\n    this.#syncMap()\n    let symbol = this.#symbolsMap.get(id)\n    if (!symbol) {\n      symbol = this.symbols.find(s => s.type === SymbolType.Group && s.containsSymbol(id))\n    }\n    if (symbol) {\n      symbol.selected = true\n    }\n  }\n\n  unselectSymbol(id: string): void\n  {\n    this.#syncMap()\n    const symbol = this.#symbolsMap.get(id)\n    if (symbol) {\n      symbol.selected = false\n    }\n  }\n\n  resetSelection(): void\n  {\n    this.symbols.forEach(s => s.selected = false)\n  }\n\n  getRootSymbol(id: string): TIISymbol | undefined\n  {\n    this.#syncMap()\n    const directMatch = this.#symbolsMap.get(id)\n    if (directMatch) return directMatch\n\n    return this.symbols.find(s =>\n    {\n      if (s.type === SymbolType.Group && s.containsSymbol(id)) {\n        return s\n      }\n      if (s.type === SymbolType.Recognized && s.containsStroke(id)) {\n        return s\n      }\n      return\n    })\n  }\n\n  getSymbolRowIndex(symbol: TIISymbol): number\n  {\n    return Math.round((symbol.type === SymbolType.Recognized && symbol.kind === RecognizedKind.Text ? symbol.baseline : symbol.bounds.yMid) / this.rowHeight)\n  }\n\n  getSymbolsByRowOrdered(): { rowIndex: number, symbols: TIISymbol[] }[]\n  {\n    const rowsMap = new Map<number, TIISymbol[]>()\n\n    for (const s of this.symbols) {\n      const rowIndex = this.getSymbolRowIndex(s)\n      const row = rowsMap.get(rowIndex)\n      if (row) {\n        row.push(s)\n      } else {\n        rowsMap.set(rowIndex, [s])\n      }\n    }\n\n    const rows: { rowIndex: number, symbols: TIISymbol[] }[] = []\n    rowsMap.forEach((symbols, rowIndex) => {\n      symbols.sort((s1, s2) => s1.bounds.xMid - s2.bounds.xMid)\n      rows.push({ rowIndex, symbols })\n    })\n\n    return rows.sort((r1, r2) => r1.rowIndex - r2.rowIndex)\n  }\n\n  roundToLineGuide(y: number): number\n  {\n    return Math.round(y / this.rowHeight) * this.rowHeight\n  }\n\n  isSymbolAbove(source: TIISymbol, target: TIISymbol): boolean\n  {\n    return this.getSymbolRowIndex(source) > this.getSymbolRowIndex(target)\n  }\n\n  isSymbolInRow(source: TIISymbol, target: TIISymbol): boolean\n  {\n    return this.getSymbolRowIndex(source) === this.getSymbolRowIndex(target)\n  }\n\n  isSymbolBelow(source: TIISymbol, target: TIISymbol): boolean\n  {\n    return this.getSymbolRowIndex(source) < this.getSymbolRowIndex(target)\n  }\n\n  getFirstSymbol(symbols: TIISymbol[]): TIISymbol | undefined\n  {\n    if (!symbols.length) return\n    return symbols.reduce((previous, current) =>\n    {\n      if (previous) {\n        if (this.getSymbolRowIndex(previous) < this.getSymbolRowIndex(current)) {\n          return previous\n        }\n        else if (this.getSymbolRowIndex(previous) == this.getSymbolRowIndex(current) && previous.bounds.xMid < current.bounds.xMid) {\n          return previous\n        }\n      }\n      return current\n    })\n  }\n\n  getLastSymbol(symbols: TIISymbol[]): TIISymbol | undefined\n  {\n    if (!symbols.length) return\n    return symbols.reduce((previous, current) =>\n    {\n      if (previous) {\n        if (this.getSymbolRowIndex(previous) > this.getSymbolRowIndex(current)) {\n          return previous\n        }\n        if (this.getSymbolRowIndex(previous) < this.getSymbolRowIndex(current)) {\n          return current\n        }\n        else if (previous.bounds.xMid > current.bounds.xMid) {\n          return previous\n        }\n      }\n      return current\n    })\n  }\n\n  addSymbol(symbol: TIISymbol): void\n  {\n    this.#logger.info(\"addSymbol\", { symbol })\n    if (this.#symbolsMap.has(symbol.id)) {\n      throw new Error(`Symbol id already exist: ${ symbol.id }`)\n    }\n    this.symbols.push(symbol)\n    this.#symbolsMap.set(symbol.id, symbol)\n    this.modificationDate = Date.now()\n    this.converts = undefined\n    this.exports = undefined\n    this.#logger.debug(\"addSymbol\", this.symbols)\n  }\n\n  updateSymbol(updatedSymbol: TIISymbol): void\n  {\n    this.#logger.info(\"updateSymbol\", { updatedSymbol })\n    const sIndex = this.symbols.findIndex(s => s.id === updatedSymbol.id)\n    if (sIndex !== -1) {\n      updatedSymbol.modificationDate = Date.now()\n      this.symbols.splice(sIndex, 1, updatedSymbol)\n      this.#symbolsMap.set(updatedSymbol.id, updatedSymbol)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"updateSymbol\", this.symbols)\n  }\n\n  replaceSymbol(id: string, symbols: TIISymbol[]): void\n  {\n    const sIndex = this.symbols.findIndex(s => s.id === id)\n    if (sIndex !== -1) {\n      this.symbols.splice(sIndex, 1, ...symbols)\n      this.#symbolsMap.delete(id)\n      symbols.forEach(s => this.#symbolsMap.set(s.id, s))\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n  }\n\n  changeOrderSymbol(id: string, position: \"first\" | \"last\" | \"forward\" | \"backward\")\n  {\n    const fromIndex = this.symbols.findIndex(s => s.id === id)\n    if (fromIndex > -1) {\n      let toIndex = fromIndex\n      switch (position) {\n        case \"first\":\n          toIndex = 0\n          break\n        case \"last\":\n          toIndex = this.symbols.length - 1\n          break\n        case \"forward\":\n          toIndex = Math.min(toIndex + 1, this.symbols.length - 1)\n          break\n        case \"backward\":\n          toIndex = Math.max(toIndex - 1, 0)\n          break\n      }\n      const sym = this.symbols.splice(fromIndex, 1)[0]\n      this.symbols.splice(toIndex, 0, sym)\n    }\n  }\n\n  removeSymbol(id: string): void\n  {\n    this.#logger.info(\"removeSymbol\", { id })\n    this.#syncMap()\n    const symbolIndex = this.symbols.findIndex(s => s.id === id)\n    if (symbolIndex !== -1) {\n      this.symbols.splice(symbolIndex, 1)\n      this.#symbolsMap.delete(id)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"removeSymbol\", this.symbols)\n  }\n\n  extractDifferenceSymbols(model: IIModel): { added: TIISymbol[], removed: TIISymbol[] }\n  {\n    const modelKeys = new Set(model.symbols.map(s => `${s.id}:${s.modificationDate}`))\n    const thisKeys = new Set(this.symbols.map(s => `${s.id}:${s.modificationDate}`))\n\n    return {\n      added: this.symbols.filter(s => !modelKeys.has(`${s.id}:${s.modificationDate}`)),\n      removed: model.symbols.filter(s => !thisKeys.has(`${s.id}:${s.modificationDate}`))\n    }\n  }\n\n  mergeExport(exports: TExport)\n  {\n    this.#logger.info(\"mergeExport\", { exports })\n    if (this.exports) {\n      Object.assign(this.exports, exports)\n    } else {\n      this.exports = exports\n    }\n    this.#logger.debug(\"mergeExport\", this.exports)\n  }\n\n  clone(): IIModel\n  {\n    this.#logger.info(\"clone\")\n    const clonedModel = new IIModel(this.width, this.height, this.rowHeight, this.creationTime)\n    clonedModel.modificationDate = this.modificationDate\n    clonedModel.symbols = this.symbols.map(s =>\n    {\n      const c = s.clone()\n      c.selected = false\n      clonedModel.#symbolsMap.set(c.id, c)\n      return c\n    })\n    clonedModel.exports = structuredClone(this.exports)\n    clonedModel.idle = this.idle\n    this.#logger.debug(\"clone\", { clonedModel })\n    return clonedModel\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    this.modificationDate = Date.now()\n    this.symbols = []\n    this.#symbolsMap.clear()\n    this.currentSymbol = undefined\n    this.exports = undefined\n    this.converts = undefined\n    this.idle = true\n\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIStroke } from \"../symbol\"\nimport { TExportV2 } from \"./ExportV2\"\n\n/**\n * @group Model\n */\nexport class IModel\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MODEL)\n  readonly creationTime: number\n  modificationDate: number\n  currentStroke?: IIStroke\n  strokes: IIStroke[]\n  exports?: TExportV2\n  converts?: TExportV2\n  width: number\n  height: number\n  rowHeight: number\n  idle: boolean\n\n  constructor(width = 100, height = 100, rowHeight = 0, creationDate = Date.now())\n  {\n    this.creationTime = creationDate\n    this.modificationDate = creationDate\n    this.width = width\n    this.height = height\n    this.rowHeight = rowHeight\n    this.strokes = []\n    this.exports = undefined\n    this.converts = undefined\n    this.idle = true\n  }\n\n  get strokesToDelete(): IIStroke[]\n  {\n    return this.strokes.filter(s => s.deleting)\n  }\n\n  addStroke(stroke: IIStroke): void\n  {\n    this.#logger.info(\"addStroke\", { stroke })\n    const sIndex = this.strokes.findIndex(s => s.id === stroke.id)\n    if (sIndex > -1) {\n      throw new Error(`Stroke id already exist: ${ stroke.id }`)\n    }\n    this.strokes.push(stroke)\n    this.modificationDate = Date.now()\n    this.converts = undefined\n    this.exports = undefined\n    this.#logger.debug(\"addStroke\", this.strokes)\n  }\n\n  updateStroke(updatedStroke: IIStroke): void\n  {\n    this.#logger.info(\"updateStroke\", { updatedStroke })\n    const sIndex = this.strokes.findIndex(s => s.id === updatedStroke.id)\n    if (sIndex !== -1) {\n      updatedStroke.modificationDate = Date.now()\n      this.strokes.splice(sIndex, 1, updatedStroke)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"updateStroke\", this.strokes)\n  }\n\n  removeStroke(id: string): void\n  {\n    this.#logger.info(\"removeSymbol\", { id })\n    const strokeIndex = this.strokes.findIndex(s => s.id === id)\n    if (strokeIndex !== -1) {\n      this.strokes.splice(strokeIndex, 1)\n      this.modificationDate = Date.now()\n      this.converts = undefined\n      this.exports = undefined\n    }\n    this.#logger.debug(\"removeSymbol\", this.strokes)\n  }\n\n  extractDifferenceStrokes(model: IModel): { added: IIStroke[], removed: IIStroke[] }\n  {\n    const modelStrokeKeys = new Set(model.strokes.map(s => `${s.id}-${s.modificationDate}`))\n    const thisStrokeKeys = new Set(this.strokes.map(s => `${s.id}-${s.modificationDate}`))\n\n    return {\n      added: this.strokes.filter(s => !modelStrokeKeys.has(`${s.id}-${s.modificationDate}`)),\n      removed: model.strokes.filter(s => !thisStrokeKeys.has(`${s.id}-${s.modificationDate}`))\n    }\n  }\n\n  mergeExport(exports: TExportV2)\n  {\n    this.#logger.info(\"mergeExport\", { exports })\n    if (this.exports) {\n      Object.assign(this.exports, exports)\n    } else {\n      this.exports = exports\n    }\n    this.#logger.debug(\"mergeExport\", this.exports)\n  }\n\n  clone(): IModel\n  {\n    this.#logger.info(\"clone\")\n    const clonedModel = new IModel(this.width, this.height, this.rowHeight, this.creationTime)\n    clonedModel.modificationDate = this.modificationDate\n    clonedModel.strokes = this.strokes.map(s =>\n    {\n      const c = s.clone()\n      c.selected = false\n      return c\n    })\n    clonedModel.exports = structuredClone(this.exports)\n    clonedModel.idle = this.idle\n    this.#logger.debug(\"clone\", { clonedModel })\n    return clonedModel\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    this.modificationDate = Date.now()\n    this.strokes = []\n    this.exports = undefined\n    this.converts = undefined\n    this.currentStroke = undefined\n    this.idle = true\n\n  }\n}\n","/**\n * @group Recognizer\n */\nexport type TScheme = \"https\" | \"http\"\n\n/**\n * @group Recognizer\n */\nexport type TServerHTTPConfiguration = {\n  scheme: TScheme,\n  host: string\n  applicationKey: string\n  hmacKey: string | ((applicationKey: string) => Promise<string>)\n  version?: string\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultServerHTTPConfiguration: TServerHTTPConfiguration = {\n  scheme: \"https\",\n  host: \"cloud.myscript.com\",\n  applicationKey: \"\",\n  hmacKey: \"\",\n  version: \"\"\n}\n\n/**\n * @group Recognizer\n */\nexport type TServerWebsocketConfiguration = TServerHTTPConfiguration & {\n  websocket: {\n    pingEnabled: boolean\n    pingDelay: number\n    maxPingLostCount: number\n    autoReconnect: boolean\n    maxRetryCount: number\n    fileChunkSize: number\n  }\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultServerWebsocketConfiguration: TServerWebsocketConfiguration = {\n  ...DefaultServerHTTPConfiguration,\n  websocket: {\n    pingEnabled: true,\n    pingDelay: 15000,\n    maxPingLostCount: 20,\n    autoReconnect: true,\n    maxRetryCount: 2,\n    fileChunkSize: 300000\n  }\n}\n","\n/**\n * @group Recognizer\n */\nexport type TEraserConfiguration = {\n  \"erase-precisely\": boolean\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultEraserConfiguration: TEraserConfiguration = {\n  \"erase-precisely\": false\n}\n","\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\nimport { TTextConfConfiguration } from \"./TextConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TDiagramConvertConfiguration = {\n  types?: (\"text\" | \"shape\")[]\n  \"match-text-size\"?: boolean\n}\n\n/**\n * @group Recognizer\n */\nexport type TDiagramConfiguration = {\n  mimeTypes: (\"application/vnd.myscript.jiix\" | \"application/vnd.openxmlformats-officedocument.presentationml.presentation\" | \"image/svg+xml\")[]\n  \"enable-sub-blocks\"?: boolean\n  text?: TTextConfConfiguration\n  convert?: TDiagramConvertConfiguration\n  \"session-time\"?: number\n  eraser?: TEraserConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultDiagramConvertConfiguration: TDiagramConvertConfiguration = {\n  types: [\"text\", \"shape\"],\n  \"match-text-size\": true\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultDiagramConfiguration: TDiagramConfiguration = {\n  convert: DefaultDiagramConvertConfiguration,\n  eraser: DefaultEraserConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n}\n","\n/**\n * @group Recognizer\n */\nexport type TImageViewportConfiguration = {\n  x: number\n  y: number\n  width: number\n  height: number\n}\n\n/**\n * @group Recognizer\n */\nexport type TImageConfiguration = {\n  guides: boolean\n  viewport: TImageViewportConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport type TJiixConfiguration = {\n  \"bounding-box\": boolean\n  strokes: boolean\n  ids: boolean\n  \"full-stroke-ids\": boolean\n  text: {\n    chars: boolean\n    words: boolean\n    lines?: boolean\n  }\n  style?: boolean\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultJiixConfiguration: TJiixConfiguration = {\n  \"bounding-box\": false,\n  strokes: false,\n  ids: false,\n  \"full-stroke-ids\": false,\n  text: {\n    chars: false,\n    words: true,\n    lines: false\n  },\n}\n\n/**\n * @group Recognizer\n */\nexport type TMathMLFlavor = {\n  name: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TMathMLExport = {\n  flavor: TMathMLFlavor\n}\n\n/**\n * @group Recognizer\n */\nexport type TExportConfiguration = {\n  \"image-resolution\"?: number\n  image?: TImageConfiguration\n  jiix: TJiixConfiguration\n  mathml?: TMathMLExport\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultExportConfiguration: TExportConfiguration = {\n  \"image-resolution\": 300,\n  jiix: DefaultJiixConfiguration\n}\n","\n/**\n * @group Recognizer\n */\nexport type TMarginConfiguration = {\n  bottom: number\n  left: number\n  right: number\n  top: number\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultMarginConfiguration: TMarginConfiguration = {\n  top: 20,\n  left: 10,\n  right: 10,\n  bottom: 10\n}\n","import { DefaultMarginConfiguration, TMarginConfiguration } from \"./MarginConfiguration\"\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRoundingMode = \"half up\" | \"truncate\"\n\n/**\n * @group Recognizer\n */\nexport type TAngleUnit = \"deg\" | \"rad\"\n\n/**\n * @group Recognizer\n */\nexport type TSolverOptions = \"algebraic\" | \"numeric\"\n\n/**\n * @group Recognizer\n */\nexport type TSolverConfiguration = {\n  enable?: boolean\n  \"fractional-part-digits\"?: number\n  \"decimal-separator\"?: string\n  \"rounding-mode\"?: TRoundingMode\n  \"angle-unit\"?: TAngleUnit\n  options?: TSolverOptions\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultSolverConfiguration: TSolverConfiguration = {\n  enable: true,\n  \"fractional-part-digits\": 3,\n  \"decimal-separator\": \".\",\n  \"rounding-mode\": \"half up\",\n  \"angle-unit\": \"deg\"\n}\n\n/**\n * @group Recognizer\n */\nexport type TUndoRedoMode = \"stroke\" | \"session\"\n\n/**\n * @group Recognizer\n */\nexport type TMathUndoRedoConfiguration = {\n  mode: TUndoRedoMode\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultMathUndoRedoConfiguration: TMathUndoRedoConfiguration = {\n  mode: \"stroke\"\n}\n\n/**\n * @group Recognizer\n */\nexport type TMathConfiguration = {\n  mimeTypes: (\"application/x-latex\" | \"application/mathml+xml\" | \"application/vnd.myscript.jiix\")[]\n  solver?: TSolverConfiguration\n  margin: TMarginConfiguration\n  \"undo-redo\"?: TMathUndoRedoConfiguration\n  customGrammar?: string\n  customGrammarId?: string\n  customGrammarContent?: string\n  eraser?: TEraserConfiguration\n  \"session-time\"?: number\n  \"recognition-timeout\"?: number\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultMathConfiguration: TMathConfiguration = {\n  solver: DefaultSolverConfiguration,\n  margin: DefaultMarginConfiguration,\n  eraser: DefaultEraserConfiguration,\n  \"undo-redo\": DefaultMathUndoRedoConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n}\n","\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\nimport { TTextConfConfiguration } from \"./TextConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRawContentConfiguration = {\n  text?: TTextConfConfiguration\n  \"session-time\"?: number\n  recognition: {\n    types: (\"text\" | \"shape\" | \"math\" | \"decoration\")[]\n  }\n  classification: {\n    types: (\"text\" | \"shape\" | \"math\" | \"decoration\" | \"drawing\")[]\n  }\n  eraser?: TEraserConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRawContentConfiguration: TRawContentConfiguration = {\n  recognition: {\n    types: [ \"text\", \"math\", \"shape\", \"decoration\"]\n  },\n  classification: {\n    types: [ \"text\", \"math\", \"shape\", \"decoration\", \"drawing\"]\n  },\n  eraser: DefaultEraserConfiguration,\n}\n","\n/**\n * @group Recognizer\n */\nexport type TRecognitionRendererDebugConfiguration = {\n  \"draw-text-boxes\": boolean\n  \"draw-image-boxes\": boolean\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultDebugConfiguration: TRecognitionRendererDebugConfiguration = {\n  \"draw-text-boxes\": false,\n  \"draw-image-boxes\": false\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognitionRendererConfiguration = {\n  debug: TRecognitionRendererDebugConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognitionRendererConfiguration: TRecognitionRendererConfiguration = {\n  debug: DefaultDebugConfiguration\n}\n","import { DefaultMarginConfiguration, TMarginConfiguration } from \"./MarginConfiguration\"\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TTextGuidesConfiguration = {\n  enable: boolean\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultTextGuidesConfiguration: TTextGuidesConfiguration = {\n  enable: true\n}\n\n/**\n * @group Recognizer\n */\nexport type TTextConfConfiguration = {\n  customResources?: string[]\n  customLexicon?: string[]\n  addLKText?: boolean\n}\n\n/**\n * @group Recognizer\n */\nexport type TTextConfiguration = {\n  text?: boolean\n  mimeTypes: (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n  margin: TMarginConfiguration\n  guides?: TTextGuidesConfiguration\n  configuration?: TTextConfConfiguration\n  eraser?: TEraserConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultTextConfiguration: TTextConfiguration = {\n  guides: DefaultTextGuidesConfiguration,\n  eraser: DefaultEraserConfiguration,\n  margin: DefaultMarginConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n}\n","import { DefaultMarginConfiguration, TMarginConfiguration } from \"./MarginConfiguration\"\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TTextGuidesConfigurationV2 = {\n  enable: boolean,\n  \"line-gap-mm\"?: number,\n  \"origin-y-mm\"?: number,\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultTextGuidesConfigurationV2: TTextGuidesConfigurationV2 = {\n  enable: true,\n  \"line-gap-mm\": 100,\n  \"origin-y-mm\": 0,\n}\n\n/**\n * @group Recognizer\n */\nexport type TTextRecognizerHTTPV2ConfConfiguration = {\n  customResources?: string[]\n  customLexicon?: string[]\n  addLKText?: boolean\n}\n\n/**\n * @group Recognizer\n */\nexport type TTextRecognizerHTTPV2Configuration = {\n  text?: boolean\n  mimeTypes: (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n  margin: TMarginConfiguration\n  guides: TTextGuidesConfigurationV2\n  configuration?: TTextRecognizerHTTPV2ConfConfiguration\n  eraser?: TEraserConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultTexConfigurationV2: TTextRecognizerHTTPV2Configuration = {\n  guides: DefaultTextGuidesConfigurationV2,\n  eraser: DefaultEraserConfiguration,\n  margin: DefaultMarginConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n}\n","\n/**\n * @group Recognizer\n */\nexport type TConvertionConfiguration = {\n    force?: {\n        \"on-stylesheet-change\": boolean\n    }\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultConvertionConfiguration: TConvertionConfiguration = {\n    force: {\n        \"on-stylesheet-change\": false\n    }\n}\n","\nimport { DefaultEraserConfiguration, TEraserConfiguration } from \"./EraserConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TShapeConvertConfiguration = {\n  types?: (\"shape\")[]\n  \"match-text-size\"?: boolean\n}\n\nexport type TShapeBeautificationConfiguration = {\n    enable?: true\n}\n/**\n * @group Recognizer\n */\nexport type TShapeConfiguration = {\n  mimeTypes: (\"application/vnd.myscript.jiix\" | \"application/vnd.openxmlformats-officedocument.presentationml.presentation\" | \"image/svg+xml\")[]\n  \"enable-sub-blocks\"?: boolean\n  convert?: TShapeConvertConfiguration\n  \"session-time\"?: number\n  eraser?: TEraserConfiguration\n  beautification?: TShapeBeautificationConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultShapeConvertConfiguration: TShapeConvertConfiguration = {\n  types: [\"shape\"],\n  \"match-text-size\": true\n}\n\nexport const DefaultShapeBeautificationConfiguration: TShapeBeautificationConfiguration = {\n    enable: true\n  }\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultShapeConfiguration: TShapeConfiguration = {\n  convert: DefaultShapeConvertConfiguration,\n  eraser: DefaultEraserConfiguration,\n  mimeTypes: [\"application/vnd.myscript.jiix\"],\n  beautification: DefaultShapeBeautificationConfiguration\n}\n","import { DefaultEraserConfiguration } from \"./EraserConfiguration\";\nimport { DefaultMarginConfiguration } from \"./MarginConfiguration\";\nimport { DefaultMathUndoRedoConfiguration, DefaultSolverConfiguration, TMathConfiguration } from \"./MathConfiguration\";\n\nexport const DefaultMathV2Configuration: TMathConfiguration = {\n  solver: DefaultSolverConfiguration,\n  margin: DefaultMarginConfiguration,\n  eraser: DefaultEraserConfiguration,\n  \"undo-redo\": DefaultMathUndoRedoConfiguration,\n  mimeTypes: [\"application/x-latex\"],\n}","import { DefaultEraserConfiguration } from \"./EraserConfiguration\";\nimport { TRawContentConfiguration } from \"./RawContentConfiguration\";\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRawContentV2Configuration: TRawContentConfiguration = {\n  recognition: {\n    types: [ \"text\", \"math\", \"shape\"]\n  },\n  classification: {\n    types: [ \"text\", \"math\", \"shape\", \"decoration\", \"drawing\"]\n  },\n  eraser: DefaultEraserConfiguration,\n}\n","import { THistoryContext } from \"../history\"\nimport { TExport } from \"../model\"\nimport { TRecognizerWebSocketSSRMessageSVGPatch } from \"./RecognizerWebSocketSSRMessage\"\n\n/**\n * @group Recognizer\n * @summary\n * Lists all events that can be listened to on the editor or DOM element\n * @example\n * You can run code on \"RecognizerEventName\" raised by using\n * ```ts\n * recognizer.events.addEventListener(RecognizerEventName.CONTENT_CHANGED, (evt) => console.log(evt.detail))\n * ```\n */\nexport enum RecognizerEventName\n{\n  /**\n   * @summary event emitted at the start of connection initialization\n   */\n  START_INITIALIZATION = \"start-initialization\",\n  /**\n   * @summary event emitted after full recognizer initialization\n   */\n  END_INITIALIZATION = \"end-initialization\",\n  /**\n   * @summary event emitted after receiving an \"contentChanged\" message\n   */\n  CONTENT_CHANGED = \"content-changed\",\n  /**\n   * @summary event emitted after receiving an \"idle\" message\n   */\n  IDLE = \"idle\",\n  /**\n   * @summary event emitted after receiving an \"exported\" message\n   */\n  EXPORTED = \"exported\",\n  /**\n   * @summary event emitted when the recognizer encounters an error\n   */\n  ERROR = \"error\",\n  /**\n   * @remarks event emitted after connection closed\n   */\n  CONNECTION_CLOSE = \"connection-close\",\n  /**\n   * @summary\n   * event emitted after receiving an \"svgPatch\" message\n   * @remarks\n   * only usable in the case of websocket\n   */\n  SVG_PATCH = \"svg-patch\",\n  /**\n   * @summary event emitted session opened\n   */\n  SESSION_OPENED = \"session-opened\",\n\n}\n\n/**\n * @group Recognizer\n */\nexport class RecognizerEvent extends EventTarget\n{\n  protected abortController: AbortController\n\n  constructor()\n  {\n    super()\n    this.abortController = new AbortController()\n  }\n\n  removeAllListeners(): void\n  {\n    this.abortController.abort()\n    this.abortController = new AbortController()\n  }\n\n  protected emit(type: string, data?: unknown): void\n  {\n    const evt = new CustomEvent(type, Object.assign({ bubbles: true, composed: true }, data ? { detail: data } : undefined))\n    this.dispatchEvent(evt)\n  }\n\n  emitStartInitialization(): void\n  {\n    this.emit(RecognizerEventName.START_INITIALIZATION)\n  }\n  addStartInitialization(callback: () => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.START_INITIALIZATION,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitEndtInitialization(): void\n  {\n    this.emit(RecognizerEventName.END_INITIALIZATION)\n  }\n  addEndInitialization(callback: () => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.END_INITIALIZATION,\n      () => callback(),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitSessionOpened(sessionId: string): void\n  {\n    this.emit(RecognizerEventName.SESSION_OPENED, sessionId)\n  }\n  addSessionOpenedListener(callback: (sessionId: string) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.SESSION_OPENED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as string),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitContentChanged(undoRedoContext: THistoryContext): void\n  {\n    this.emit(RecognizerEventName.CONTENT_CHANGED, {\n      ...undoRedoContext,\n      canClear: !undoRedoContext.empty\n    })\n  }\n  addContentChangedListener(callback: (context: THistoryContext) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.CONTENT_CHANGED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as THistoryContext),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitIdle(idle: boolean): void\n  {\n    this.emit(RecognizerEventName.IDLE, idle)\n  }\n  addIdleListener(callback: (idle: boolean) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.IDLE,\n      (evt: unknown) => callback((evt as CustomEvent).detail as boolean),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitExported(exports: TExport): void\n  {\n    this.emit(RecognizerEventName.EXPORTED, exports)\n  }\n  addExportedListener(callback: (exports: TExport) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.EXPORTED,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TExport),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitError(err: Error): void\n  {\n    this.emit(RecognizerEventName.ERROR, err)\n  }\n  addErrorListener(callback: (err: Error) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.ERROR,\n      (evt: unknown) => callback((evt as CustomEvent).detail as Error),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  emitConnectionClose({ code, message }: { code: number, message?: string }): void\n  {\n    this.emit(RecognizerEventName.CONNECTION_CLOSE, { code, message })\n  }\n  addConnectionCloseListener(callback: ({ code, message }: { code: number, message?: string }) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.CONNECTION_CLOSE,\n      (evt: unknown) => callback((evt as CustomEvent).detail as { code: number, message?: string }),\n      { signal: this.abortController.signal }\n    )\n  }\n\n  /**\n   * @remarks only use in the case of websocket\n   */\n  emitSVGPatch(svgPatch: TRecognizerWebSocketSSRMessageSVGPatch): void\n  {\n    this.emit(RecognizerEventName.SVG_PATCH, svgPatch)\n  }\n  /**\n   * @remarks only usable in the case of websocket\n   */\n  addSVGPatchListener(callback:  (svgPatch: TRecognizerWebSocketSSRMessageSVGPatch) => void): void\n  {\n    this.addEventListener(\n      RecognizerEventName.SVG_PATCH,\n      (evt: unknown) => callback((evt as CustomEvent).detail as TRecognizerWebSocketSSRMessageSVGPatch),\n      { signal: this.abortController.signal }\n    )\n  }\n}\n","/**\n * @group Recognizer\n * @remarks List all errors generated by the backend with their descriptions\n */\nexport enum RecognizerError {\n  NO_ACTIVITY = \"Session closed due to no activity. Without a connection on your part, it will be permanently lost after an hour.\",\n  WRONG_CREDENTIALS = \"Application credentials are invalid. Please check or regenerate your application key and hmackey.\",\n  TOO_OLD = \"Session is too old. Max Session Duration Reached.\",\n  NO_SESSION_FOUND = \"No sessions found. Without activation for 1 hour, sessions are deleted from the server. To avoid losing your work, use the json export, then import it this will create a new session.\",\n  UNKNOW = \"An unknown error has occurred.\",\n  ABNORMAL_CLOSURE = \"MyScript recognition server is not reachable.\",\n  CANT_ESTABLISH = \"Unable to establish a connection to MyScript recognition server. Check the host and your connectivity.\",\n  GOING_AWAY = \"MyScript recognition server is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection.\",\n  PROTOCOL_ERROR = \"MyScript recognition server terminated the connection due to a protocol error.\",\n  UNSUPPORTED_DATA = \"MyScript recognition server terminated the connection because the endpoint received data of a type it cannot accept. (For example, a text-only endpoint received binary data.)\",\n  INVALID_FRAME_PAYLOAD = \"MyScript recognition server terminated the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message).\",\n  POLICY_VIOLATION = \"MyScript recognition server terminated the connection because it received a message that violates its policy.\",\n  MESSAGE_TOO_BIG = \"MyScript recognition server terminated the connection because a data frame was received that is too large.\",\n  INTERNAL_ERROR = \"MyScript recognition server terminated the connection because it encountered an unexpected condition that prevented it from fulfilling the request.\",\n  SERVICE_RESTART = \"MyScript recognition server terminated the connection because it is restarting.\",\n  TRY_AGAIN = \"MyScript recognition server terminated the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients.\",\n  BAD_GATEWAY = \"MyScript recognition server was acting as a gateway or proxy and received an invalid response from the upstream server.\",\n  TLS_HANDSHAKE = \"MyScript recognition server connection was closed due to a failure to perform a TLS handshake\",\n}\n","import { isVersionSuperiorOrEqual, mergeDeep, PartialDeep } from \"../utils\"\nimport {\n  DefaultDiagramConfiguration,\n  DefaultExportConfiguration,\n  DefaultMathConfiguration,\n  DefaultRawContentConfiguration,\n  DefaultRecognitionRendererConfiguration,\n  DefaultTextConfiguration,\n  TConvertionConfiguration,\n  TDiagramConfiguration,\n  TExportConfiguration,\n  TMathConfiguration,\n  TRawContentConfiguration,\n  TRecognitionRendererConfiguration,\n  TTextConfiguration\n} from \"./recognition\"\nimport { TRecognitionType } from \"./RecognitionConfiguration\"\nimport { DefaultServerHTTPConfiguration, TServerHTTPConfiguration } from \"./ServerConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRecognitionHTTPV1Configuration = {\n  type: TRecognitionType\n  lang: string\n  math: TMathConfiguration\n  text: TTextConfiguration\n  diagram: TDiagramConfiguration\n  \"raw-content\": TRawContentConfiguration\n  renderer: TRecognitionRendererConfiguration\n  export: TExportConfiguration\n  convert?: TConvertionConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaulRecognitionHTTPV1ConfigurationConfiguration: TRecognitionHTTPV1Configuration = {\n  export: DefaultExportConfiguration,\n  math: DefaultMathConfiguration,\n  diagram: DefaultDiagramConfiguration,\n  \"raw-content\": DefaultRawContentConfiguration,\n  renderer: DefaultRecognitionRendererConfiguration,\n  text: DefaultTextConfiguration,\n  type: \"TEXT\",\n  lang: \"en_US\",\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV1Configuration = {\n  server: TServerHTTPConfiguration\n  recognition: TRecognitionHTTPV1Configuration\n}\n\n/**\n * @group Recognizer\n */\nexport const DefaultRecognizerHTTPV1Configuration: TRecognizerHTTPV1Configuration =\n{\n  server: DefaultServerHTTPConfiguration,\n  recognition: DefaulRecognitionHTTPV1ConfigurationConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport class RecognizerHTTPV1Configuration implements TRecognizerHTTPV1Configuration {\n  recognition: TRecognitionHTTPV1Configuration\n  server: TServerHTTPConfiguration\n\n  constructor(configuration?: PartialDeep<TRecognizerHTTPV1Configuration>)\n  {\n    this.server = mergeDeep({}, DefaultRecognizerHTTPV1Configuration.server, configuration?.server)\n    this.recognition = mergeDeep({}, DefaultRecognizerHTTPV1Configuration.recognition, configuration?.recognition)\n\n    if (configuration?.recognition?.text?.mimeTypes) {\n      this.recognition.text.mimeTypes = configuration.recognition.text.mimeTypes as (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n    }\n    this.recognition.text.mimeTypes = [...new Set(this.recognition.text.mimeTypes)]\n\n    if (configuration?.recognition?.math?.mimeTypes) {\n      this.recognition.math.mimeTypes = configuration.recognition.math.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/x-latex\" | \"application/mathml+xml\")[]\n    }\n    this.recognition.math.mimeTypes = [...new Set(this.recognition.math.mimeTypes)]\n\n    if (configuration?.recognition?.diagram?.mimeTypes) {\n      this.recognition.diagram.mimeTypes = configuration.recognition.diagram.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/vnd.openxmlformats-officedocument.presentationml.presentation\" | \"image/svg+xml\")[]\n    }\n    this.recognition.diagram.mimeTypes = [...new Set(this.recognition.diagram.mimeTypes)]\n\n    if (configuration?.recognition?.diagram?.convert?.types) {\n      this.recognition.diagram.convert!.types = configuration.recognition.diagram.convert.types as (\"text\" | \"shape\")[]\n    }\n\n    if (configuration?.recognition?.[\"raw-content\"]?.recognition?.types) {\n      this.recognition[\"raw-content\"].recognition!.types = configuration?.recognition?.[\"raw-content\"]?.recognition?.types as (\"text\" | \"shape\")[]\n    }\n    this.recognition[\"raw-content\"].recognition.types = [...new Set(this.recognition[\"raw-content\"].recognition.types.filter((type) => type !== \"decoration\"))]\n\n    if (configuration?.recognition?.[\"raw-content\"]?.classification?.types) {\n      this.recognition[\"raw-content\"].classification!.types = configuration?.recognition?.[\"raw-content\"]?.classification?.types as (\"text\" | \"shape\")[]\n    }\n\n    if (this.server.version) {\n      if (!isVersionSuperiorOrEqual(this.server.version, \"2.3.0\")) {\n        delete this.recognition.convert\n      }\n      if (!isVersionSuperiorOrEqual(this.server.version, \"3.2.0\")) {\n        delete this.recognition.export.jiix.text.lines\n      }\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { Model, TExport, TJIIXExport } from \"../model\"\nimport { TStrokeGroup, TStrokeGroupToSend } from \"../symbol\"\nimport { StyleHelper, TPenStyle } from \"../style\"\nimport { computeHmac, getApiInfos, isVersionSuperiorOrEqual, PartialDeep } from \"../utils\"\nimport { RecognizerError } from \"./RecognizerError\"\nimport { RecognizerHTTPV1Configuration, TRecognizerHTTPV1Configuration } from \"./RecognizerHTTPV1Configuration\"\nimport { TConverstionState } from \"./RecognitionConfiguration\"\nimport { TDiagramConfiguration, TExportConfiguration, TMathConfiguration, TRawContentConfiguration, TTextConfiguration } from \"./recognition\"\n\ntype ApiError = {\n  code?: string\n  message: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV1PostConfiguration = {\n  lang: string,\n  diagram?: TDiagramConfiguration,\n  math?: TMathConfiguration,\n  \"raw-content\"?: TRawContentConfiguration,\n  text?: TTextConfiguration,\n  export: TExportConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV1PostData = {\n  configuration: TRecognizerHTTPV1PostConfiguration,\n  xDPI: number,\n  yDPI: number,\n  contentType: string,\n  conversionState?: TConverstionState\n  height: number,\n  width: number,\n  strokeGroups: TStrokeGroupToSend[]\n}\n\n/**\n * @deprecated Use {@link RecognizerHTTPV2} instead.\n * @group Recognizer\n */\nexport class RecognizerHTTPV1\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RECOGNIZER)\n\n  configuration: RecognizerHTTPV1Configuration\n\n  constructor(config: PartialDeep<TRecognizerHTTPV1Configuration>)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.configuration = new RecognizerHTTPV1Configuration(config)\n  }\n\n  get url()\n  {\n    return `${ this.configuration.server.scheme }://${ this.configuration.server.host }/api/v4.0/iink/batch`\n  }\n\n  get postConfig(): TRecognizerHTTPV1PostConfiguration\n  {\n    switch (this.configuration.recognition.type) {\n      case \"DIAGRAM\":\n        return {\n          lang: this.configuration.recognition.lang,\n          diagram: this.configuration.recognition.diagram,\n          export: this.configuration.recognition.export\n        }\n      case \"MATH\":\n        return {\n          lang: this.configuration.recognition.lang,\n          math: this.configuration.recognition.math,\n          export: this.configuration.recognition.export\n        }\n      case \"Raw Content\":\n        return {\n          lang: this.configuration.recognition.lang,\n          \"raw-content\": this.configuration.recognition[\"raw-content\"],\n          export: this.configuration.recognition.export\n        }\n      case \"TEXT\":\n        return {\n          lang: this.configuration.recognition.lang,\n          text: this.configuration.recognition.text,\n          export: this.configuration.recognition.export\n        }\n      default:\n        throw new Error(`get postConfig error Recognition type unkow \"${ this.configuration.recognition.type }\"`)\n        break\n    }\n  }\n\n  protected buildData(model: Model): TRecognizerHTTPV1PostData\n  {\n    this.#logger.info(\"buildData\", { model })\n    const isPenStyleEqual = (ps1: TPenStyle, ps2: TPenStyle) =>\n    {\n      return ps1 && ps2 && ps1[\"-myscript-pen-fill-color\"] === ps2[\"-myscript-pen-fill-color\"] &&\n        ps1[\"-myscript-pen-fill-style\"] === ps2[\"-myscript-pen-fill-style\"] &&\n        ps1[\"-myscript-pen-width\"] === ps2[\"-myscript-pen-width\"] &&\n        ps1.color === ps2.color &&\n        ps1.width === ps2.width\n    }\n\n    const strokeGroupByPenStyle: TStrokeGroup[] = []\n    model.symbols.forEach((s) =>\n    {\n      const groupIndex = strokeGroupByPenStyle.findIndex(sg => isPenStyleEqual(sg.penStyle, s.style))\n      if (groupIndex > -1) {\n        strokeGroupByPenStyle[groupIndex].strokes.push(s)\n      } else {\n        strokeGroupByPenStyle.push({\n          penStyle: s.style,\n          strokes: [s]\n        })\n      }\n    })\n\n    const strokeGroupsToSend: TStrokeGroupToSend[] = []\n    strokeGroupByPenStyle.forEach((group: TStrokeGroup) =>\n    {\n      const newPenStyle = JSON.stringify(group.penStyle) === \"{}\" ? undefined : StyleHelper.penStyleToCSS(group.penStyle as TPenStyle)\n      const newGroup = {\n        penStyle: newPenStyle,\n        strokes: group.strokes.map(s => s.formatToSend())\n      }\n      strokeGroupsToSend.push(newGroup)\n    })\n\n    const contentType: string = this.configuration.recognition.type === \"Raw Content\" ?\n      \"Raw Content\" :\n      this.configuration.recognition.type.charAt(0).toUpperCase() + this.configuration.recognition.type.slice(1).toLowerCase()\n\n    const data = {\n      configuration: this.postConfig,\n      xDPI: 96,\n      yDPI: 96,\n      contentType,\n      height: model.height,\n      width: model.width,\n      strokeGroups: strokeGroupsToSend\n    }\n    this.#logger.debug(\"buildData\", { data })\n    return data\n  }\n\n  protected async post(data: unknown, mimeType: string): Promise<unknown>\n  {\n    this.#logger.info(\"post\", { data, mimeType })\n    const headers = new Headers()\n    headers.append(\"Accept\", \"application/json,\" + mimeType)\n    headers.append(\"applicationKey\", this.configuration.server.applicationKey)\n    try {\n      let hmacKey: string\n      if (typeof this.configuration.server.hmacKey == \"string\") {\n        hmacKey = this.configuration.server.hmacKey\n      } else if (typeof this.configuration.server.hmacKey == \"function\") {\n        hmacKey = await this.configuration.server.hmacKey(this.configuration.server.applicationKey)\n      }\n      else {\n        throw new Error(\"HMAC key is not a string nor a function\")\n      }\n      if (hmacKey) {\n        const hmac = await computeHmac(JSON.stringify(data), this.configuration.server.applicationKey, hmacKey)\n        headers.append(\"hmac\", hmac)\n      }\n    } catch (error) {\n      this.#logger.error(\"post.computeHmac\", error)\n    }\n    headers.append(\"Content-Type\", \"application/json\")\n\n    if (!this.configuration.server.version) {\n      this.configuration.server.version = (await getApiInfos(this.configuration)).version\n    }\n    if (isVersionSuperiorOrEqual(this.configuration.server.version!, \"2.0.4\")) {\n      headers.append(\"myscript-client-name\", \"iink-ts\")\n      headers.append(\"myscript-client-version\", \"1.0.0-buildVersion\")\n    }\n    if (!isVersionSuperiorOrEqual(this.configuration.server.version!, \"2.3.0\")) {\n      delete this.configuration.recognition.convert\n    }\n    if (!isVersionSuperiorOrEqual(this.configuration.server.version!, \"3.2.0\")) {\n      delete this.configuration.recognition.export.jiix.text.lines\n    }\n\n    const reqInit: RequestInit = {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify(data),\n      credentials: \"omit\"\n    }\n    const request = new Request(this.url, reqInit)\n    const response: Response = await fetch(request)\n    if (response.ok) {\n      const contentType = response.headers.get(\"content-type\")\n      let result: unknown\n      switch (contentType) {\n        case \"application/vnd.openxmlformats-officedocument.presentationml.presentation\":\n        case \"image/png\":\n        case \"image/jpeg\":\n          result = await response.blob()\n          break\n        case \"application/json\":\n          result = await response.json()\n          break\n        case \"application/vnd.myscript.jiix\":\n          result = await response.clone().json().catch(async () => await response.text())\n          break\n        default:\n          result = await response.text()\n          break\n      }\n      this.#logger.debug(\"post\", { result })\n      return result\n    } else {\n      const err = await response.json() as ApiError\n      this.#logger.error(\"post\", { err })\n      throw err\n    }\n  }\n\n  protected async tryFetch(data: TRecognizerHTTPV1PostData, mimeType: string): Promise<TExport | never>\n  {\n    this.#logger.debug(\"tryFetch\", { data, mimeType })\n    return this.post(data, mimeType)\n      .then((res) =>\n      {\n        const exports: TExport = {}\n        exports[mimeType] = res as TJIIXExport | string | Blob\n        this.#logger.debug(\"tryFetch\", { exports })\n        return exports\n      })\n      .catch((err) =>\n      {\n        this.#logger.error(\"tryFetch\", { data, mimeType, err })\n        let message = err.message || RecognizerError.UNKNOW\n        if (!err.code) {\n          message = RecognizerError.CANT_ESTABLISH\n        } else if (err.code === \"access.not.granted\") {\n          message = RecognizerError.WRONG_CREDENTIALS\n        }\n        const error = new Error(message)\n        throw error\n      })\n  }\n\n  protected getMimeTypes(requestedMimeTypes?: string[]): string[]\n  {\n    this.#logger.info(\"getMimeTypes\", { requestedMimeTypes })\n    let mimeTypes: string[] = requestedMimeTypes || []\n    if (!mimeTypes.length) {\n      switch (this.configuration.recognition.type) {\n        case \"DIAGRAM\":\n          mimeTypes = this.configuration.recognition.diagram.mimeTypes\n          break\n        case \"MATH\":\n          mimeTypes = this.configuration.recognition.math.mimeTypes\n          break\n        case \"Raw Content\":\n          mimeTypes = [\"application/vnd.myscript.jiix\"]\n          break\n        case \"TEXT\":\n          mimeTypes = this.configuration.recognition.text.mimeTypes\n          break\n        default:\n          throw new Error(`Recognition type \"${ this.configuration.recognition.type }\" is unknown.\\n Possible types are:\\n -DIAGRAM\\n -MATH\\n -Raw Content\\n -TEXT`)\n          break\n      }\n    }\n    return mimeTypes\n  }\n\n  async convert(model: Model, conversionState?: TConverstionState, requestedMimeTypes?: string[]): Promise<Model>\n  {\n    this.#logger.info(\"convert\", { model, conversionState, requestedMimeTypes })\n    const myModel = model.clone()\n    const mimeTypes = this.getMimeTypes(requestedMimeTypes)\n    const dataToConcert = this.buildData(myModel)\n    dataToConcert.conversionState = conversionState\n    const promises = mimeTypes.map(mt => this.tryFetch(dataToConcert, mt))\n    const exports: TExport[] = await Promise.all(promises)\n    exports.forEach(e =>\n    {\n      myModel.mergeConvert(e)\n    })\n    this.#logger.debug(\"convert\", { model: myModel })\n    return myModel\n  }\n\n  async export(model: Model, requestedMimeTypes?: string[]): Promise<Model>\n  {\n    this.#logger.info(\"export\", { model, requestedMimeTypes })\n    const myModel = model.clone()\n    if (myModel.symbols.length === 0) {\n      return Promise.resolve(myModel)\n    }\n    const mimeTypes = this.getMimeTypes(requestedMimeTypes)\n    if (!mimeTypes.length) {\n      this.#logger.error(\"export\", { model, requestedMimeTypes, \"Export failed, no mimeTypes define in recognition configuration\": String })\n      return Promise.reject(new Error(\"Export failed, no mimeTypes define in recognition configuration\"))\n    }\n    const mimeTypesRequiringExport: string[] = mimeTypes.filter(m => !myModel.exports || !myModel.exports[m])\n    const data = this.buildData(model)\n    const exports: TExport[] = await Promise.all(mimeTypesRequiringExport.map(mimeType => this.tryFetch(data, mimeType)))\n    exports.forEach(e =>\n    {\n      myModel.mergeExport(e)\n    })\n    this.#logger.debug(\"export\", { model: myModel })\n    return myModel\n  }\n\n  async resize(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"resize\", { model })\n    return this.export(model)\n  }\n\n}\n","import { mergeDeep, isVersionSuperiorOrEqual, PartialDeep } from \"../utils\"\nimport {\n  DefaultShapeConfiguration,\n  DefaultExportConfiguration,\n  DefaultMathV2Configuration,\n  DefaultRawContentV2Configuration,\n  DefaultTexConfigurationV2,\n  TConvertionConfiguration,\n  TShapeConfiguration,\n  TExportConfiguration,\n  TMathConfiguration,\n  TRawContentConfiguration,\n  TTextRecognizerHTTPV2Configuration\n} from \"./recognition\"\nimport { TRecognitionV2Type } from \"./RecognitionConfiguration\"\nimport { DefaultServerHTTPConfiguration, TServerHTTPConfiguration } from \"./ServerConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV2RecognitionConfiguration = {\n  type: TRecognitionV2Type\n  lang: string\n  math: TMathConfiguration\n  text: TTextRecognizerHTTPV2Configuration\n  shape: TShapeConfiguration\n  \"raw-content\": TRawContentConfiguration\n  export: TExportConfiguration\n  convert?: TConvertionConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognizerHTTPV2RecognitionConfiguration: TRecognizerHTTPV2RecognitionConfiguration = {\n  export: DefaultExportConfiguration,\n  math: DefaultMathV2Configuration,\n  shape: DefaultShapeConfiguration,\n  \"raw-content\": DefaultRawContentV2Configuration,\n  text: DefaultTexConfigurationV2,\n  type: \"TEXT\",\n  lang: \"en_US\",\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV2Configuration = {\n  server: TServerHTTPConfiguration\n  recognition: TRecognizerHTTPV2RecognitionConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport const DefaultRecognizerHTTPV2Configuration: TRecognizerHTTPV2Configuration =\n{\n  server: DefaultServerHTTPConfiguration,\n  recognition: DefaultRecognizerHTTPV2RecognitionConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport class RecognizerHTTPV2Configuration implements TRecognizerHTTPV2Configuration {\n  recognition: TRecognizerHTTPV2RecognitionConfiguration\n  server: TServerHTTPConfiguration\n\n  constructor(configuration?: PartialDeep<TRecognizerHTTPV2Configuration>)\n  {\n    this.server = mergeDeep({}, DefaultRecognizerHTTPV2Configuration.server, configuration?.server)\n    this.recognition = mergeDeep({}, DefaultRecognizerHTTPV2Configuration.recognition, configuration?.recognition)\n\n    if (configuration?.recognition?.text?.mimeTypes) {\n      this.recognition.text.mimeTypes = configuration.recognition.text.mimeTypes as (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n    }\n    this.recognition.text.mimeTypes = [...new Set(this.recognition.text.mimeTypes)]\n\n    if (configuration?.recognition?.math?.mimeTypes) {\n      this.recognition.math.mimeTypes = configuration.recognition.math.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/x-latex\" | \"application/mathml+xml\")[]\n    }\n    this.recognition.math.mimeTypes = [...new Set(this.recognition.math.mimeTypes)]\n\n    if (configuration?.recognition?.shape?.mimeTypes) {\n      this.recognition.shape.mimeTypes = configuration.recognition.shape.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/vnd.openxmlformats-officedocument.presentationml.presentation\" | \"image/svg+xml\")[]\n    }\n    this.recognition.shape.mimeTypes = [...new Set(this.recognition.shape.mimeTypes)]\n\n    if (configuration?.recognition?.[\"raw-content\"]?.recognition?.types) {\n      this.recognition[\"raw-content\"].recognition!.types = configuration?.recognition?.[\"raw-content\"]?.recognition?.types as (\"text\" | \"shape\")[]\n    }\n    if (configuration?.recognition?.[\"raw-content\"]?.classification?.types) {\n      this.recognition[\"raw-content\"].classification!.types = configuration?.recognition?.[\"raw-content\"]?.classification?.types as (\"text\" | \"shape\")[]\n    }\n\n    if (this.server.version) {\n      if (!isVersionSuperiorOrEqual(this.server.version, \"2.3.0\")) {\n        delete this.recognition.convert\n      }\n      if (!isVersionSuperiorOrEqual(this.server.version, \"3.2.0\")) {\n        delete this.recognition.export.jiix.text.lines\n      }\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { TExportV2, TJIIXExport } from \"../model\"\nimport { TStroke, TStrokeToSend } from \"../symbol\"\nimport { computeHmac, getApiInfos, isVersionSuperiorOrEqual, PartialDeep } from \"../utils\"\nimport { RecognizerError } from \"./RecognizerError\"\nimport { RecognizerHTTPV2Configuration, TRecognizerHTTPV2Configuration } from \"./RecognizerHTTPV2Configuration\"\nimport { TDiagramConfiguration, TExportConfiguration, TMathConfiguration, TRawContentConfiguration, TTextConfiguration } from \"./recognition\"\n\ntype ApiError = {\n  code?: string\n  message: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV2PostConfiguration = {\n  lang: string,\n  diagram?: TDiagramConfiguration,\n  math?: TMathConfiguration,\n  \"raw-content\"?: TRawContentConfiguration,\n  text?: TTextConfiguration,\n  export: TExportConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerHTTPV2PostData = {\n  scaleX: number,\n  scaleY: number,\n  configuration: TRecognizerHTTPV2PostConfiguration,\n  contentType: string,\n  strokes: TStrokeToSend[]\n}\n\n/**\n * @group Recognizer\n */\nexport class RecognizerHTTPV2 {\n  #logger = LoggerManager.getLogger(LoggerCategory.RECOGNIZER)\n\n  configuration: RecognizerHTTPV2Configuration\n\n  constructor(config: PartialDeep<TRecognizerHTTPV2Configuration>) {\n    this.#logger.info(\"constructor\", { config })\n    this.configuration = new RecognizerHTTPV2Configuration(config)\n  }\n\n  get url() {\n    return `${this.configuration.server.scheme}://${this.configuration.server.host}/api/v4.0/iink/recognize`\n  }\n\n  get postConfig(): TRecognizerHTTPV2PostConfiguration {\n    switch (this.configuration.recognition.type) {\n      case \"SHAPE\":\n        return {\n          lang: this.configuration.recognition.lang,\n          diagram: this.configuration.recognition.shape,\n          export: this.configuration.recognition.export\n        }\n      case \"MATH\":\n        return {\n          lang: this.configuration.recognition.lang,\n          math: this.configuration.recognition.math,\n          export: this.configuration.recognition.export\n        }\n      case \"Raw Content\":\n        return {\n          lang: this.configuration.recognition.lang,\n          \"raw-content\": this.configuration.recognition[\"raw-content\"],\n          export: this.configuration.recognition.export\n        }\n      case \"TEXT\":\n        return {\n          lang: this.configuration.recognition.lang,\n          text: this.configuration.recognition.text,\n          export: this.configuration.recognition.export\n        }\n      default:\n        throw new Error(`get postConfig error Recognition type unkow \"${this.configuration.recognition.type}\"`)\n        break\n    }\n  }\n\n  protected formatStrokes(strokes: TStroke[]): TStrokeToSend[] {\n    return strokes.map(s => {\n      return {\n        id: s.id,\n        pointerType: s.pointerType,\n        p: s.pointers.map(p => p.p),\n        t: s.pointers.map(p => p.t),\n        x: s.pointers.map(p => p.x),\n        y: s.pointers.map(p => p.y)\n      }\n    })\n  }\n\n  protected buildData(strokes: TStroke[]): TRecognizerHTTPV2PostData {\n    this.#logger.info(\"buildData\", { strokes })\n\n    const contentType: string = this.configuration.recognition.type === \"Raw Content\" ?\n      \"Raw Content\" :\n      this.configuration.recognition.type.charAt(0).toUpperCase() + this.configuration.recognition.type.slice(1).toLowerCase()\n\n    const data = {\n      configuration: this.postConfig,\n      scaleX: 0.265,\n      scaleY: 0.265,\n      contentType,\n      strokes: this.formatStrokes(strokes)\n    }\n    this.#logger.debug(\"buildData\", { data })\n    return data\n  }\n\n  protected async post(data: unknown, mimeType: string): Promise<unknown> {\n    this.#logger.info(\"post\", { data, mimeType })\n    const headers = new Headers()\n    headers.append(\"Accept\", mimeType)\n    headers.append(\"applicationKey\", this.configuration.server.applicationKey)\n    try {\n      let hmacKey: string\n      if (typeof this.configuration.server.hmacKey == \"string\") {\n        hmacKey = this.configuration.server.hmacKey\n      } else if (typeof this.configuration.server.hmacKey == \"function\") {\n        hmacKey = await this.configuration.server.hmacKey(this.configuration.server.applicationKey)\n      }\n      else {\n        throw new Error(\"HMAC key is not a string nor a function\")\n      }\n      if (hmacKey) {\n        const hmac = await computeHmac(JSON.stringify(data), this.configuration.server.applicationKey, hmacKey)\n        headers.append(\"hmac\", hmac)\n      }\n    } catch (error) {\n      this.#logger.error(\"post.computeHmac\", error)\n    }\n    headers.append(\"Content-Type\", \"application/json\")\n\n    if (!this.configuration.server.version) {\n      this.configuration.server.version = (await getApiInfos(this.configuration)).version\n    }\n\n    if (this.configuration.server.version && isVersionSuperiorOrEqual(this.configuration.server.version, \"2.0.4\")) {\n      headers.append(\"myscript-client-name\", \"iink-ts\")\n      headers.append(\"myscript-client-version\", \"1.0.0-buildVersion\")\n    }\n\n    const reqInit: RequestInit = {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify(data),\n      credentials: \"omit\"\n    }\n    const request = new Request(this.url, reqInit)\n    const response: Response = await fetch(request)\n    if (response.ok) {\n      const contentType = response.headers.get(\"content-type\")\n      let result: unknown\n      switch (contentType) {\n        case \"application/vnd.openxmlformats-officedocument.presentationml.presentation\":\n        case \"image/png\":\n        case \"image/jpeg\":\n          result = await response.blob()\n          break\n        case \"application/json\":\n          result = await response.json()\n          break\n        case \"application/vnd.myscript.jiix\":\n          result = await response.clone().json().catch(async () => await response.text())\n          break\n        default:\n          result = await response.text()\n          break\n      }\n      this.#logger.debug(\"post\", { result })\n      return result\n    } else {\n      const err = await response.json() as ApiError\n      this.#logger.error(\"post\", { err })\n      throw err\n    }\n  }\n\n  protected async tryFetch(data: TRecognizerHTTPV2PostData, mimeType: string): Promise<TExportV2 | never> {\n    this.#logger.debug(\"tryFetch\", { data, mimeType })\n    return this.post(data, mimeType)\n      .then((res) => {\n        const exports: TExportV2 = {}\n        exports[mimeType] = res as TJIIXExport | string | Blob\n        this.#logger.debug(\"tryFetch\", { exports })\n        return exports\n      })\n      .catch((err) => {\n        this.#logger.error(\"tryFetch\", { data, mimeType, err })\n        let message = err.message || RecognizerError.UNKNOW\n        if (!err.code) {\n          message = RecognizerError.CANT_ESTABLISH\n        } else if (err.code === \"access.not.granted\") {\n          message = RecognizerError.WRONG_CREDENTIALS\n        }\n        const error = new Error(message)\n        throw error\n      })\n  }\n\n  protected getMimeTypes(requestedMimeTypes?: string[]): string[] {\n    this.#logger.info(\"getMimeTypes\", { requestedMimeTypes })\n    let mimeTypes: string[] = requestedMimeTypes || []\n    if (!mimeTypes.length) {\n      switch (this.configuration.recognition.type) {\n        case \"SHAPE\":\n          mimeTypes = this.configuration.recognition.shape.mimeTypes\n          break\n        case \"MATH\":\n          mimeTypes = this.configuration.recognition.math.mimeTypes\n          break\n        case \"Raw Content\":\n          mimeTypes = [\"application/vnd.myscript.jiix\"]\n          break\n        case \"TEXT\":\n          mimeTypes = this.configuration.recognition.text.mimeTypes\n          break\n        default:\n          throw new Error(`Recognition type \"${this.configuration.recognition.type}\" is unknown.\\n Possible types are:\\n -DIAGRAM\\n -MATH\\n -Raw Content\\n -TEXT\\n -SHAPE`)\n          break\n      }\n    }\n    return mimeTypes\n  }\n\n  async send(strokes: TStroke[], requestedMimeTypes?: string[]): Promise<TExportV2> {\n    this.#logger.info(\"send\", strokes)\n\n    const recognition: TExportV2 = {}\n    if (strokes.length === 0) {\n      return Promise.resolve(recognition)\n    }\n    const mimeTypes = requestedMimeTypes || this.getMimeTypes()\n\n    const data = this.buildData(strokes)\n    const exports: TExportV2[] = await Promise.all(mimeTypes.map(mimeType => this.tryFetch(data, mimeType)))\n      exports.forEach(e => {\n        Object.assign(recognition, e)\n      })\n\n    this.#logger.debug(\"send\", recognition)\n    return recognition\n  }\n}\n","import { TGesture } from \"../gesture\"\nimport { TExport } from \"../model\"\n\n/**\n * @group Recognizer\n */\nexport enum TRecognizerWebSocketMessageType\n{\n  HMAC_Challenge = \"hmacChallenge\",\n  Authenticated = \"authenticated\",\n  SessionDescription = \"sessionDescription\",\n  NewPart = \"newPart\",\n  PartChanged = \"partChanged\",\n  ContentChanged = \"contentChanged\",\n  Idle = \"idle\",\n  Pong = \"pong\",\n  Exported = \"exported\",\n  GestureDetected = \"gestureDetected\",\n  ContextlessGesture = \"contextlessGesture\",\n  Error = \"error\",\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessage<T = string> = {\n  type: T\n  [key: string]: unknown\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageAuthenticated = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.Authenticated>\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageHMACChallenge = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.HMAC_Challenge> & {\n  hmacChallenge: string\n  iinkSessionId: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TInteractiveInkSessionDescriptionMessage = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.SessionDescription> & {\n  contentPartCount: number\n  iinkSessionId: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageNewPart = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.NewPart> & {\n  id: string\n  idx: null\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessagePartChange = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.PartChanged> & {\n  partIdx: number\n  partId: string\n  partCount: number\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageContentChange = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.ContentChanged> & {\n  partId: string\n  canUndo: boolean\n  canRedo: boolean\n  empty: boolean\n  undoStackIndex: number\n  possibleUndoCount: number\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageExport = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.Exported> & {\n  partId: string\n  exports: TExport\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageGesture = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.GestureDetected> & TGesture\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageContextlessGesture = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.ContextlessGesture> & {\n  gestureType: \"none\" | \"scratch\" | \"left-right\" | \"right-left\" | \"bottom-top\" | \"top-bottom\" | \"surround\",\n  strokeId: string\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessagePong = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.Pong>\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageIdle = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.Idle>\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageError = TRecognizerWebSocketMessage<TRecognizerWebSocketMessageType.Error> & {\n  code?: number | string\n  message?: string\n  data?: {\n    code: number | string\n    message: string\n  }\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketMessageReceived =\n  TRecognizerWebSocketMessageAuthenticated |\n  TRecognizerWebSocketMessageHMACChallenge |\n  TInteractiveInkSessionDescriptionMessage |\n  TRecognizerWebSocketMessageNewPart |\n  TRecognizerWebSocketMessagePartChange |\n  TRecognizerWebSocketMessageContentChange |\n  TRecognizerWebSocketMessageExport |\n  TRecognizerWebSocketMessageGesture |\n  TRecognizerWebSocketMessageContextlessGesture |\n  TRecognizerWebSocketMessagePong |\n  TRecognizerWebSocketMessageIdle |\n  TRecognizerWebSocketMessageError\n","import { mergeDeep, isVersionSuperiorOrEqual, PartialDeep } from \"../utils\"\nimport { TExportConfiguration, TTextConfConfiguration } from \"./recognition\"\nimport { DefaultServerWebsocketConfiguration, TServerWebsocketConfiguration } from \"./ServerConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRecognitionWebSocketConfiguration = {\n  lang: string\n  export: TExportConfiguration\n  \"raw-content\": {\n    text?: TTextConfConfiguration\n    \"session-time\"?: number\n    recognition?: {\n      types: (\"text\" | \"shape\")[]\n    }\n    classification?: {\n      types: (\"text\" | \"shape\")[]\n    }\n    gestures?: (\"underline\" | \"scratch-out\" | \"join\" | \"insert\" | \"strike-through\" | \"surround\")[]\n  }\n  gesture: {\n    enable: boolean,\n    ignoreGestureStrokes: boolean\n  }\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognitionWebSocketConfiguration: TRecognitionWebSocketConfiguration = {\n  export: {\n    jiix: {\n      \"bounding-box\": true,\n      \"full-stroke-ids\": true,\n      ids: true,\n      strokes: false,\n      text: {\n        chars: true,\n        words: true,\n        lines: true\n      }\n    }\n  },\n  \"raw-content\": {\n    recognition: {\n      types: [\"text\", \"shape\"]\n    },\n    classification: {\n      types: [\"text\", \"shape\"]\n    },\n    gestures: [\"underline\", \"scratch-out\", \"join\", \"insert\", \"strike-through\", \"surround\"]\n  },\n  lang: \"en_US\",\n  gesture: {\n    enable: true,\n    ignoreGestureStrokes: false,\n  }\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketConfiguration = {\n  server: TServerWebsocketConfiguration\n  recognition: TRecognitionWebSocketConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognizerWebSocketConfiguration: TRecognizerWebSocketConfiguration =\n{\n  server: DefaultServerWebsocketConfiguration,\n  recognition: DefaultRecognitionWebSocketConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport class RecognizerWebSocketConfiguration implements TRecognizerWebSocketConfiguration\n{\n  server: TServerWebsocketConfiguration\n  recognition: TRecognitionWebSocketConfiguration\n\n  constructor(configuration?: PartialDeep<TRecognizerWebSocketConfiguration>)\n  {\n    this.server = mergeDeep({}, DefaultRecognizerWebSocketConfiguration.server, configuration?.server)\n\n    this.recognition = mergeDeep({}, DefaultRecognizerWebSocketConfiguration.recognition, configuration?.recognition)\n    this.recognition.export.jiix[\"full-stroke-ids\"] = true\n    this.recognition.export.jiix.ids = true\n    this.recognition.export.jiix.text.words = true\n    this.recognition.export.jiix.text.chars = true\n    this.recognition.export.jiix.text.lines = true\n    this.recognition.export.jiix[\"bounding-box\"] = true\n    if (configuration?.recognition?.[\"raw-content\"]?.recognition?.types) {\n      this.recognition[\"raw-content\"].recognition!.types = configuration.recognition[\"raw-content\"].recognition.types as (\"text\" | \"shape\")[]\n    }\n    if (configuration?.recognition?.[\"raw-content\"]?.classification?.types) {\n      this.recognition[\"raw-content\"].classification!.types = configuration.recognition[\"raw-content\"].classification.types as (\"text\" | \"shape\")[]\n    }\n    if (configuration?.recognition?.[\"raw-content\"]?.gestures) {\n      this.recognition[\"raw-content\"].gestures = configuration.recognition[\"raw-content\"].gestures as (\"underline\" | \"scratch-out\" | \"join\" | \"insert\" | \"strike-through\" | \"surround\")[]\n    }\n    if (this.server.version && !isVersionSuperiorOrEqual(this.server.version, \"3.2.0\")) {\n      delete this.recognition.export.jiix.text.lines\n      delete this.recognition[\"raw-content\"].classification\n    }\n  }\n}\n","import { TIIHistoryBackendChanges, THistoryContext } from \"../history\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { TExport, TJIIXExport } from \"../model\"\nimport { IIStroke } from \"../symbol\"\nimport { TMatrixTransform } from \"../transform\"\nimport { computeHmac, mergeDeep, DeferredPromise, PartialDeep, isVersionSuperiorOrEqual, getApiInfos } from \"../utils\"\nimport\n{\n  TRecognizerWebSocketMessage,\n  TRecognizerWebSocketMessageContentChange,\n  TRecognizerWebSocketMessageContextlessGesture,\n  TRecognizerWebSocketMessageError,\n  TRecognizerWebSocketMessageExport,\n  TRecognizerWebSocketMessageGesture,\n  TRecognizerWebSocketMessageHMACChallenge,\n  TRecognizerWebSocketMessageNewPart,\n  TRecognizerWebSocketMessagePartChange,\n  TRecognizerWebSocketMessageReceived,\n  TRecognizerWebSocketMessageType,\n  TInteractiveInkSessionDescriptionMessage\n} from \"./RecognizerWebSocketMessage\"\nimport { RecognizerError } from \"./RecognizerError\"\nimport PingWorker from \"web-worker:../worker/ping.worker.ts\"\nimport { RecognizerEvent } from \"./RecognizerEvent\"\nimport { RecognizerWebSocketConfiguration, TRecognizerWebSocketConfiguration } from \"./RecognizerWebSocketConfiguration\"\n\n/**\n * A websocket dialog have this sequence :\n * --------------- Client --------------------------------------------------------------- Server ---------------\n * { type: \"authenticate\" }                           ==================>\n *                                                    <==================       { type: \"hmacChallenge\" }\n * { type: \"hmac\" }                                   ==================>\n *                                                    <==================       { type: \"authenticated\" }\n * { type: \"initSession\" | \"restoreSession\" }         ==================>\n *                                                    <==================       { type: \"sessionDescription\" }\n * { type: \"newContentPart\" | \"openContentPart\" }     ==================>\n *                                                    <==================       { type: \"partChanged\" }\n * { type: \"addStrokes\" }                             ==================>\n *                                                    <==================       { type: \"contentChanged\" }\n * { type: \"transform\" }                              ==================>\n *                                                    <==================       { type: \"contentChanged\" }\n * { type: \"eraseStrokes\" }                           ==================>\n *                                                    <==================       { type: \"contentChanged\" }\n */\n\n/**\n * @group Recognizer\n */\nexport class RecognizerWebSocket\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RECOGNIZER)\n\n  protected socket!: WebSocket\n  protected pingWorker?: Worker\n  protected pingCount = 0\n  protected reconnectionCount = 0\n  protected sessionId?: string\n  protected currentPartId?: string\n  protected currentErrorCode?: string | number\n\n  protected addStrokeDeferred?: DeferredPromise<TRecognizerWebSocketMessageGesture | undefined>\n  protected contextlessGestureDeferred: Map<string, DeferredPromise<TRecognizerWebSocketMessageContextlessGesture>>\n  protected transformStrokeDeferred?: DeferredPromise<void>\n  protected eraseStrokeDeferred?: DeferredPromise<void>\n  protected replaceStrokeDeferred?: DeferredPromise<void>\n  protected exportDeferredMap: Map<string, DeferredPromise<TExport>>\n  protected closeDeferred?: DeferredPromise<void>\n  protected waitForIdleDeferred?: DeferredPromise<void>\n  protected undoDeferred?: DeferredPromise<void>\n  protected redoDeferred?: DeferredPromise<void>\n  protected clearDeferred?: DeferredPromise<void>\n\n  configuration: RecognizerWebSocketConfiguration\n  initialized: DeferredPromise<void>\n  url: string\n  event: RecognizerEvent\n\n  constructor(config: PartialDeep<TRecognizerWebSocketConfiguration>, event?: RecognizerEvent)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.configuration = new RecognizerWebSocketConfiguration(config)\n    const scheme = (this.configuration.server.scheme === \"https\") ? \"wss\" : \"ws\"\n    this.url = `${ scheme }://${ this.configuration.server.host }/api/v4.0/iink/offscreen?applicationKey=${ this.configuration.server.applicationKey }`\n\n    this.event = event || new RecognizerEvent()\n    this.initialized = new DeferredPromise<void>()\n    this.exportDeferredMap = new Map()\n    this.contextlessGestureDeferred = new Map()\n  }\n\n  get mimeTypes(): string[]\n  {\n    return [\"application/vnd.myscript.jiix\"]\n  }\n\n  async #send(message: TRecognizerWebSocketMessage): Promise<void>\n  {\n    if (!this.socket) {\n      throw new Error(\"Recognizer must be initilized\")\n    }\n    if (this.socket.readyState === this.socket.OPEN) {\n      this.socket.send(JSON.stringify(message))\n    }\n    else {\n      throw new Error(`Can not send message: ${message.type}, connection not ready, state: ${ this.socket.readyState }`)\n    }\n  }\n\n  protected rejectDeferredPending(error: Error | string): void\n  {\n    this.initialized.reject(error)\n    this.addStrokeDeferred?.reject(error)\n    this.transformStrokeDeferred?.reject(error)\n    this.eraseStrokeDeferred?.reject(error)\n    this.replaceStrokeDeferred?.reject(error)\n    this.undoDeferred?.reject(error)\n    this.redoDeferred?.reject(error)\n    this.clearDeferred?.reject(error)\n    Array.from(this.contextlessGestureDeferred.values())\n      .forEach(v =>\n      {\n        v.reject(error)\n      })\n    Array.from(this.exportDeferredMap.values())\n      .forEach(v =>\n      {\n        v.reject(error)\n      })\n    this.waitForIdleDeferred?.reject(error)\n  }\n\n  protected resetAllDeferred(): void\n  {\n    this.initialized = new DeferredPromise<void>()\n    this.addStrokeDeferred = undefined\n    this.contextlessGestureDeferred.clear()\n    this.transformStrokeDeferred = undefined\n    this.eraseStrokeDeferred = undefined\n    this.replaceStrokeDeferred = undefined\n    this.exportDeferredMap.clear()\n    this.waitForIdleDeferred = undefined\n    this.closeDeferred = undefined\n  }\n\n  protected clearSocketListener(): void\n  {\n    this.socket.removeEventListener(\"open\", this.openCallback.bind(this))\n    this.socket.removeEventListener(\"close\", this.closeCallback.bind(this))\n    this.socket.removeEventListener(\"message\", this.messageCallback.bind(this))\n  }\n\n  protected closeCallback(evt: CloseEvent): void\n  {\n    this.#logger.info(\"closeCallback\", { evt })\n    let message = evt.reason\n    if (!this.currentErrorCode) {\n      switch (evt.code) {\n        case 1000:\n          // Normal Closure\n          break\n        case 1001:\n          message = RecognizerError.GOING_AWAY\n          break\n        case 1002:\n          message = RecognizerError.PROTOCOL_ERROR\n          break\n        case 1003:\n          message = RecognizerError.UNSUPPORTED_DATA\n          break\n        case 1006:\n          message = RecognizerError.ABNORMAL_CLOSURE\n          break\n        case 1007:\n          message = RecognizerError.INVALID_FRAME_PAYLOAD\n          break\n        case 1008:\n          message = RecognizerError.POLICY_VIOLATION\n          break\n        case 1009:\n          message = RecognizerError.MESSAGE_TOO_BIG\n          break\n        case 1011:\n          message = RecognizerError.INTERNAL_ERROR\n          break\n        case 1012:\n          message = RecognizerError.SERVICE_RESTART\n          break\n        case 1013:\n          message = RecognizerError.TRY_AGAIN\n          break\n        case 1014:\n          message = RecognizerError.BAD_GATEWAY\n          break\n        case 1015:\n          message = RecognizerError.TLS_HANDSHAKE\n          break\n        default:\n          message = RecognizerError.CANT_ESTABLISH\n          break\n      }\n    }\n\n    this.clearSocketListener()\n    this.closeDeferred?.resolve()\n    if (!this.currentErrorCode && evt.code !== 1000) {\n      const error = new Error(message)\n      this.event.emitError(error)\n      this.rejectDeferredPending(message)\n    }\n    this.pingWorker?.terminate()\n    this.resetAllDeferred()\n  }\n\n  protected openCallback(): void\n  {\n    this.reconnectionCount = 0\n    this.#send({\n      type: \"authenticate\",\n      \"myscript-client-name\": \"iink-ts\",\n      \"myscript-client-version\": \"1.0.0-buildVersion\",\n    })\n  }\n\n  protected async manageHMACChallenge(hmacChallengeMessage: TRecognizerWebSocketMessageHMACChallenge): Promise<void>\n  {\n    let hmacKey: string\n    if (typeof this.configuration.server.hmacKey == \"string\") {\n      hmacKey = this.configuration.server.hmacKey\n    } else if (typeof this.configuration.server.hmacKey == \"function\") {\n      hmacKey = await this.configuration.server.hmacKey(this.configuration.server.applicationKey)\n    }\n    else {\n      return this.initialized.reject(new Error(\"HMAC key is not a string nor a function\"))\n    }\n    if (!hmacKey) {\n      return this.initialized.reject(new Error(\"HMAC key is required\"))\n    }\n    this.#send({\n      type: \"hmac\",\n      hmac: await computeHmac(hmacChallengeMessage.hmacChallenge, this.configuration.server.applicationKey, hmacKey)\n    })\n  }\n\n  protected initPing(): void\n  {\n    this.pingWorker = new PingWorker()\n    this.pingWorker.postMessage({\n      pingDelay: this.configuration.server.websocket.pingDelay,\n    })\n    this.pingWorker.onmessage = () =>\n    {\n      if (this.socket.readyState <= 1) {\n        if (this.pingCount < this.configuration.server.websocket.maxPingLostCount) {\n          this.send({ type: \"ping\" })\n        }\n        else {\n          this.close(1000, \"MAXIMUM_PING_REACHED\")\n          this.pingWorker?.terminate()\n        }\n        this.pingCount++\n      }\n    }\n  }\n\n  protected manageAuthenticated(): void\n  {\n    if (!isVersionSuperiorOrEqual(this.configuration.server.version!, \"3.2.0\")) {\n      delete this.configuration.recognition.export.jiix.text.lines\n      delete this.configuration.recognition[\"raw-content\"].classification\n    }\n    const pixelTomm = 25.4 / 96\n    this.#send({\n      type: this.sessionId ? \"restoreSession\" : \"initSession\",\n      iinkSessionId: this.sessionId,\n      scaleX: pixelTomm,\n      scaleY: pixelTomm,\n      configuration: this.configuration.recognition\n    })\n  }\n\n  protected manageSessionDescriptionMessage(sessionDescriptionMessage: TInteractiveInkSessionDescriptionMessage): void\n  {\n    if (sessionDescriptionMessage.iinkSessionId) {\n      this.sessionId = sessionDescriptionMessage.iinkSessionId\n      this.event.emitSessionOpened(this.sessionId)\n    }\n    if (this.currentPartId) {\n      this.#send({ type: \"openContentPart\", id: this.currentPartId })\n    }\n    else {\n      this.#send({ type: \"newContentPart\", contentType: \"Raw Content\", mimeTypes: this.mimeTypes })\n    }\n  }\n\n  protected manageNewPartMessage(newPartMessage: TRecognizerWebSocketMessageNewPart): void\n  {\n    this.initialized.resolve()\n    this.currentPartId = newPartMessage.id\n  }\n\n  protected managePartChangeMessage(partChangeMessage: TRecognizerWebSocketMessagePartChange): void\n  {\n    this.initialized.resolve()\n    this.currentPartId = partChangeMessage.partId\n  }\n\n  protected manageContentChangedMessage(contentChangeMessage: TRecognizerWebSocketMessageContentChange): void\n  {\n    this.initialized.resolve()\n    this.replaceStrokeDeferred?.resolve()\n    this.transformStrokeDeferred?.resolve()\n    this.eraseStrokeDeferred?.resolve()\n    this.undoDeferred?.resolve()\n    this.redoDeferred?.resolve()\n    this.clearDeferred?.resolve()\n    this.event.emitContentChanged({\n      canRedo: contentChangeMessage.canRedo,\n      canUndo: contentChangeMessage.canRedo,\n    } as THistoryContext)\n  }\n\n  protected manageExportMessage(exportMessage: TRecognizerWebSocketMessageExport): void\n  {\n    if (exportMessage.exports[\"application/vnd.myscript.jiix\"]) {\n      exportMessage.exports[\"application/vnd.myscript.jiix\"] = JSON.parse(exportMessage.exports[\"application/vnd.myscript.jiix\"].toString()) as TJIIXExport\n    }\n\n    Object.keys(exportMessage.exports)\n      .forEach(key =>\n      {\n        if (this.exportDeferredMap.has(key)) {\n          this.exportDeferredMap.get(key)!.resolve(exportMessage.exports)\n        }\n      })\n    this.event.emitExported(exportMessage.exports)\n  }\n\n  protected manageWaitForIdle(): void\n  {\n    this.waitForIdleDeferred?.resolve()\n    this.event.emitIdle(true)\n  }\n\n  protected manageErrorMessage(errorMessage: TRecognizerWebSocketMessageError): void\n  {\n    this.currentErrorCode = errorMessage.data?.code || errorMessage.code\n    let message = errorMessage.data?.message || errorMessage.message || RecognizerError.UNKNOW\n\n    if (this.currentErrorCode === \"no.activity\") {\n      this.rejectDeferredPending(message)\n      this.event.emitConnectionClose({ code: 1000,  message: RecognizerError.NO_ACTIVITY })\n    }\n    else {\n      switch (this.currentErrorCode) {\n        case \"access.not.granted\":\n          message = RecognizerError.WRONG_CREDENTIALS\n          break\n        case \"session.too.old\":\n          message = RecognizerError.TOO_OLD\n          break\n        case \"restore.session.not.found\":\n          message = RecognizerError.NO_SESSION_FOUND\n          break\n      }\n      this.rejectDeferredPending(message)\n      this.event.emitError(new Error(message))\n    }\n  }\n\n  protected manageGestureDetected(gestureMessage: TRecognizerWebSocketMessageGesture): void\n  {\n    this.addStrokeDeferred?.resolve(gestureMessage)\n  }\n\n  protected manageContextlessGesture(gestureMessage: TRecognizerWebSocketMessageContextlessGesture): void\n  {\n    this.contextlessGestureDeferred.get(gestureMessage.strokeId)?.resolve(gestureMessage)\n  }\n\n  protected messageCallback(message: MessageEvent<string>): void\n  {\n    this.currentErrorCode = undefined\n    try {\n      const websocketMessage: TRecognizerWebSocketMessageReceived = JSON.parse(message.data)\n      if (websocketMessage.type === TRecognizerWebSocketMessageType.Pong) {\n        return\n      }\n      this.pingCount = 0\n      switch (websocketMessage.type) {\n        case TRecognizerWebSocketMessageType.HMAC_Challenge:\n          this.manageHMACChallenge(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.Authenticated:\n          this.manageAuthenticated()\n          break\n        case TRecognizerWebSocketMessageType.SessionDescription:\n          this.manageSessionDescriptionMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.NewPart:\n          this.manageNewPartMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.PartChanged:\n          this.managePartChangeMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.ContentChanged:\n          this.manageContentChangedMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.Exported:\n          this.manageExportMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.GestureDetected:\n          this.manageGestureDetected(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.ContextlessGesture:\n          this.manageContextlessGesture(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.Error:\n          this.manageErrorMessage(websocketMessage)\n          break\n        case TRecognizerWebSocketMessageType.Idle:\n          this.manageWaitForIdle()\n          break\n        default:\n          this.#logger.warn(\"messageCallback\", `Message type unknow: \"${ websocketMessage }\".`)\n          break\n      }\n    }\n    catch {\n      this.event.emitError(new Error(message.data))\n    }\n  }\n\n  async newSession(config: PartialDeep<TRecognizerWebSocketConfiguration>): Promise<void>\n  {\n    await this.close(1000, \"new-session\")\n    this.configuration = mergeDeep({}, this.configuration, config)\n    this.sessionId = undefined\n    this.currentPartId = undefined\n    await this.init()\n  }\n\n  async init(): Promise<void>\n  {\n    this.event.emitStartInitialization()\n    if (this.currentErrorCode === \"restore.session.not.found\") {\n      this.currentErrorCode = undefined\n      this.sessionId = undefined\n      this.currentPartId = undefined\n    }\n    if (!this.configuration.server.version) {\n      this.configuration.server.version = (await getApiInfos(this.configuration)).version\n    }\n    this.socket = new WebSocket(this.url)\n    this.clearSocketListener()\n    this.socket.addEventListener(\"open\", this.openCallback.bind(this))\n    this.socket.addEventListener(\"close\", this.closeCallback.bind(this))\n    this.socket.addEventListener(\"message\", this.messageCallback.bind(this))\n    await this.initialized.promise\n    if (this.configuration.server.websocket.pingEnabled) {\n      this.pingCount = 0\n      this.initPing()\n    }\n    this.event.emitEndtInitialization()\n    return this.initialized.promise\n  }\n\n  async send(message: TRecognizerWebSocketMessage): Promise<void>\n  {\n    if (!this.socket) {\n      return Promise.reject(new Error(\"Recognizer must be initilized\"))\n    }\n\n    switch (this.socket.readyState) {\n      case this.socket.CONNECTING:\n      case this.socket.OPEN:\n        await this.initialized.promise\n        this.#send(message)\n        return Promise.resolve()\n      case this.socket.CLOSING:\n      case this.socket.CLOSED:\n        if (this.configuration.server.websocket.autoReconnect) {\n          this.reconnectionCount++\n          if (this.configuration.server.websocket.maxRetryCount > this.reconnectionCount) {\n            await this.init()\n            await this.waitForIdle()\n            return this.#send(message)\n          }\n          else {\n            return Promise.reject(new Error(\"Unable to send message. The maximum number of connection attempts has been reached.\"))\n          }\n        }\n        else {\n          return Promise.reject(new Error(\"Unable to send message. Connection closed and automatic reconnection disabled\"))\n        }\n        break\n    }\n  }\n\n  protected buildAddStrokesMessage(strokes: IIStroke[], processGestures = true): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"addStrokes\",\n      processGestures,\n      strokes: strokes.map(s => s.formatToSend())\n    }\n  }\n  async addStrokes(strokes: IIStroke[], processGestures = true): Promise<TRecognizerWebSocketMessageGesture | undefined>\n  {\n    this.addStrokeDeferred = new DeferredPromise<TRecognizerWebSocketMessageGesture | undefined>()\n    if (strokes.length === 0) {\n      this.addStrokeDeferred.resolve(undefined)\n      return this.addStrokeDeferred?.promise\n    }\n    await this.send(this.buildAddStrokesMessage(strokes, processGestures))\n    return this.addStrokeDeferred?.promise\n  }\n\n  protected buildReplaceStrokesMessage(oldStrokeIds: string[], newStrokes: IIStroke[]): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"replaceStrokes\",\n      oldStrokeIds,\n      newStrokes: newStrokes.map(s => s.formatToSend())\n    }\n  }\n  async replaceStrokes(oldStrokeIds: string[], newStrokes: IIStroke[]): Promise<void>\n  {\n    this.replaceStrokeDeferred = new DeferredPromise<void>()\n    if (oldStrokeIds.length === 0) {\n      this.replaceStrokeDeferred.resolve()\n      return this.replaceStrokeDeferred?.promise\n    }\n    await this.send(this.buildReplaceStrokesMessage(oldStrokeIds, newStrokes))\n    return this.replaceStrokeDeferred?.promise\n  }\n\n  protected buildTransformTranslateMessage(strokeIds: string[], tx: number, ty: number): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"TRANSLATE\",\n      strokeIds,\n      tx,\n      ty\n    }\n  }\n  async transformTranslate(strokeIds: string[], tx: number, ty: number): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformTranslateMessage(strokeIds, tx, ty))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildTransformRotateMessage(strokeIds: string[], angle: number, x0: number = 0, y0: number = 0): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"ROTATE\",\n      strokeIds,\n      angle,\n      x0,\n      y0\n    }\n  }\n  async transformRotate(strokeIds: string[], angle: number, x0: number = 0, y0: number = 0): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformRotateMessage(strokeIds, angle, x0, y0))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildTransformScaleMessage(strokeIds: string[], scaleX: number, scaleY: number, x0: number = 0, y0: number = 0): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"SCALE\",\n      strokeIds,\n      scaleX,\n      scaleY,\n      x0,\n      y0\n    }\n  }\n  async transformScale(strokeIds: string[], scaleX: number, scaleY: number, x0: number = 0, y0: number = 0): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformScaleMessage(strokeIds, scaleX, scaleY, x0, y0))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildTransformMatrixMessage(strokeIds: string[], matrix: TMatrixTransform): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"transform\",\n      transformationType: \"MATRIX\",\n      strokeIds,\n      ...matrix\n    }\n  }\n  async transformMatrix(strokeIds: string[], matrix: TMatrixTransform): Promise<void>\n  {\n    this.transformStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.transformStrokeDeferred.resolve()\n      return this.transformStrokeDeferred?.promise\n    }\n    await this.send(this.buildTransformMatrixMessage(strokeIds, matrix))\n    return this.transformStrokeDeferred?.promise\n  }\n\n  protected buildEraseStrokesMessage(strokeIds: string[]): TRecognizerWebSocketMessage\n  {\n    return {\n      type: \"eraseStrokes\",\n      strokeIds\n    }\n  }\n  async eraseStrokes(strokeIds: string[]): Promise<void>\n  {\n    this.eraseStrokeDeferred = new DeferredPromise<void>()\n    if (strokeIds.length === 0) {\n      this.eraseStrokeDeferred.resolve()\n      return this.eraseStrokeDeferred?.promise\n    }\n    await this.send(this.buildEraseStrokesMessage(strokeIds))\n    return this.eraseStrokeDeferred?.promise\n  }\n\n  async recognizeGesture(stroke: IIStroke): Promise<TRecognizerWebSocketMessageContextlessGesture | undefined>\n  {\n    if (!stroke) {\n      return\n    }\n    this.contextlessGestureDeferred.set(stroke.id, new DeferredPromise<TRecognizerWebSocketMessageContextlessGesture>())\n    const pixelTomm = 25.4 / 96\n    await this.send({\n      type: \"contextlessGesture\",\n      scaleX: pixelTomm,\n      scaleY: pixelTomm,\n      stroke: stroke.formatToSend()\n    })\n    return this.contextlessGestureDeferred.get(stroke.id)!.promise\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    if (!this.waitForIdleDeferred || this.waitForIdleDeferred.isFullFilled) {\n      this.waitForIdleDeferred = new DeferredPromise<void>()\n    }\n    const message: TRecognizerWebSocketMessage = {\n      type: \"waitForIdle\",\n    }\n    await this.send(message)\n    return this.waitForIdleDeferred?.promise\n  }\n\n  protected buildUndoRedoChanges(changes: TIIHistoryBackendChanges): TRecognizerWebSocketMessage[]\n  {\n    const changesMessages: TRecognizerWebSocketMessage[] = []\n    if (changes.added?.length) {\n      changesMessages.push(this.buildAddStrokesMessage(changes.added, false))\n    }\n    if (changes.erased?.length) {\n      changesMessages.push(this.buildEraseStrokesMessage(changes.erased.map(s => s.id)))\n    }\n    if (changes.replaced?.newStrokes.length) {\n      changesMessages.push(this.buildReplaceStrokesMessage(changes.replaced.oldStrokes.map(s => s.id), changes.replaced.newStrokes))\n    }\n    if (changes.matrix?.strokes.length) {\n      changesMessages.push(this.buildTransformMatrixMessage(changes.matrix.strokes.map(s => s.id), changes.matrix.matrix))\n    }\n    if (changes.translate?.length) {\n      changes.translate.forEach(tr =>\n      {\n        changesMessages.push(this.buildTransformTranslateMessage(tr.strokes.map(s => s.id), tr.tx, tr.ty))\n      })\n    }\n    if (changes.rotate?.length) {\n      changes.rotate.forEach(tr =>\n      {\n        changesMessages.push(this.buildTransformRotateMessage(tr.strokes.map(s => s.id), tr.angle, tr.center.x, tr.center.y))\n      })\n    }\n    if (changes.scale?.length) {\n      changes.scale.forEach(tr =>\n      {\n        changesMessages.push(this.buildTransformScaleMessage(tr.strokes.map(s => s.id), tr.scaleX, tr.scaleY, tr.origin.x, tr.origin.y))\n      })\n    }\n    return changesMessages\n  }\n\n  async undo(actions: TIIHistoryBackendChanges): Promise<void>\n  {\n    const changes = this.buildUndoRedoChanges(actions)\n    if (changes.length === 0) {\n      return\n    }\n    this.undoDeferred = new DeferredPromise<void>()\n    const message: TRecognizerWebSocketMessage = {\n      type: \"undo\",\n      changes\n    }\n    await this.send(message)\n    return this.undoDeferred?.promise\n  }\n\n  async redo(actions: TIIHistoryBackendChanges): Promise<void>\n  {\n    const changes = this.buildUndoRedoChanges(actions)\n    if (changes.length === 0) {\n      return\n    }\n    this.redoDeferred = new DeferredPromise<void>()\n\n    const message: TRecognizerWebSocketMessage = {\n      type: \"redo\",\n      changes\n    }\n    await this.send(message)\n    return this.redoDeferred?.promise\n  }\n\n  async export(requestedMimeTypes?: string[]): Promise<TExport>\n  {\n    const mimeTypes: string[] = requestedMimeTypes || this.mimeTypes.slice()\n    await Promise.all(mimeTypes.map(mt => this.exportDeferredMap.get(mt)?.promise))\n    mimeTypes.forEach(mt =>\n    {\n      this.exportDeferredMap.set(mt, new DeferredPromise<TExport>())\n    })\n\n    const message: TRecognizerWebSocketMessage = {\n      type: \"export\",\n      partId: this.currentPartId,\n      mimeTypes\n    }\n    await this.send(message)\n    const exports = await Promise.all(mimeTypes.map(mt => this.exportDeferredMap.get(mt)!.promise))\n    return Object.assign({}, ...exports)\n  }\n\n  async clear(): Promise<void>\n  {\n    this.clearDeferred = new DeferredPromise<void>()\n    await this.send({\n      type: \"clear\"\n    })\n    return this.clearDeferred?.promise\n  }\n\n  async close(code: number, reason: string): Promise<void>\n  {\n    this.resetAllDeferred()\n    this.closeDeferred = new DeferredPromise<void>()\n    if (this.socket.readyState === this.socket.OPEN || this.socket.readyState === this.socket.CONNECTING) {\n      this.socket.close(code, reason)\n    }\n    else {\n      this.closeDeferred.resolve()\n    }\n    await this.closeDeferred.promise\n  }\n\n  async destroy(): Promise<void>\n  {\n    if (this.socket) {\n      await this.close(1000, \"Recognizer destroyed\")\n    }\n  }\n}\n","import { isVersionSuperiorOrEqual, mergeDeep, PartialDeep } from \"../utils\"\nimport {\n  DefaultExportConfiguration,\n  DefaultMathConfiguration,\n  DefaultRecognitionRendererConfiguration,\n  DefaultTextConfiguration,\n  TConvertionConfiguration,\n  TExportConfiguration,\n  TMathConfiguration,\n  TRecognitionRendererConfiguration,\n  TTextConfiguration\n} from \"./recognition\"\nimport { TRecognitionType } from \"./RecognitionConfiguration\"\nimport { DefaultServerWebsocketConfiguration, TServerWebsocketConfiguration } from \"./ServerConfiguration\"\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketSSRRecognitionConfiguration = {\n  type: Omit<TRecognitionType, \"DIAGRAM\" | \"Raw Content\">\n  lang: string\n  math: TMathConfiguration\n  text: TTextConfiguration\n  renderer: TRecognitionRendererConfiguration\n  export: TExportConfiguration\n  convert?: TConvertionConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognizerWebSocketSSRRecognitionConfiguration: TRecognizerWebSocketSSRRecognitionConfiguration = {\n  export: DefaultExportConfiguration,\n  math: DefaultMathConfiguration,\n  renderer: DefaultRecognitionRendererConfiguration,\n  text: DefaultTextConfiguration,\n  type: \"TEXT\",\n  lang: \"en_US\",\n}\n\n/**\n * @group Recognizer\n */\nexport type TRecognizerWebSocketSSRConfiguration = {\n  server: TServerWebsocketConfiguration\n  recognition: TRecognizerWebSocketSSRRecognitionConfiguration\n}\n\n/**\n * @group Recognizer\n * @source\n */\nexport const DefaultRecognizerWebSocketSSRConfiguration: TRecognizerWebSocketSSRConfiguration =\n{\n  server: DefaultServerWebsocketConfiguration,\n  recognition: DefaultRecognizerWebSocketSSRRecognitionConfiguration\n}\n\n/**\n * @group Recognizer\n */\nexport class RecognizerWebSocketSSRConfiguration implements TRecognizerWebSocketSSRConfiguration\n{\n  recognition: TRecognizerWebSocketSSRRecognitionConfiguration\n  server: TServerWebsocketConfiguration\n\n  constructor(configuration?: PartialDeep<TRecognizerWebSocketSSRConfiguration>) {\n    this.server = mergeDeep({}, DefaultRecognizerWebSocketSSRConfiguration.server, configuration?.server)\n    this.recognition = mergeDeep({}, DefaultRecognizerWebSocketSSRConfiguration.recognition, configuration?.recognition)\n\n    if (configuration?.recognition?.text?.mimeTypes) {\n      this.recognition.text.mimeTypes = configuration.recognition.text.mimeTypes as (\"text/plain\" | \"application/vnd.myscript.jiix\")[]\n    }\n    this.recognition.text.mimeTypes = [...new Set(this.recognition.text.mimeTypes)]\n\n    if (configuration?.recognition?.math?.mimeTypes) {\n      this.recognition.math.mimeTypes = configuration.recognition.math.mimeTypes as (\"application/vnd.myscript.jiix\" | \"application/x-latex\" | \"application/mathml+xml\")[]\n    }\n    this.recognition.math.mimeTypes = [...new Set(this.recognition.math.mimeTypes)]\n\n    if (this.server.version) {\n      if (!isVersionSuperiorOrEqual(this.server.version, \"2.3.0\")) {\n        delete this.recognition.convert\n      }\n      if (!isVersionSuperiorOrEqual(this.server.version, \"3.2.0\")) {\n        delete this.recognition.export.jiix.text.lines\n      }\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { Model, TExport, TJIIXExport } from \"../model\"\nimport { Stroke } from \"../symbol\"\nimport { StyleHelper, TPenStyle, TTheme } from \"../style\"\nimport { THistoryContext } from \"../history\"\nimport { DeferredPromise, PartialDeep, computeHmac, getApiInfos, isVersionSuperiorOrEqual } from \"../utils\"\nimport\n{\n  TRecognizerWebSocketSSRMessage,\n  TRecognizerWebSocketSSRMessageContentChange,\n  TRecognizerWebSocketSSRMessageError,\n  TRecognizerWebSocketSSRMessageExport,\n  TRecognizerWebSocketSSRMessageHMACChallenge,\n  TRecognizerWebSocketSSRMessagePartChange,\n  TRecognizerWebSocketSSRMessageSVGPatch\n} from \"./RecognizerWebSocketSSRMessage\"\nimport { RecognizerError } from \"./RecognizerError\"\nimport { RecognizerEvent } from \"./RecognizerEvent\"\nimport { TRecognizerWebSocketSSRConfiguration, RecognizerWebSocketSSRConfiguration } from \"./RecognizerWebSocketSSRConfiguration\"\nimport { TConverstionState } from \"./RecognitionConfiguration\"\n\n/**\n * A websocket dialog have this sequence :\n * --------------------------- Client --------------------------------------------------- Server ----------------------------------\n * init: send newContentPackage or restoreIInkSession           ==================>\n *                                                              <==================       ack\n * answer ack:\n *  send the hmac (if enable)                                   ==================>\n *  send the configuration                                      ==================>\n *                                                              <==================       contentPackageDescription\n * answer contentPackageDescription:\n *  send newContentPart or openContentPart                      ==================>\n *                                                              <==================        partChanged\n *                                                              <==================        contentChanged\n *                                                              <==================        newPart\n *                                                              <==================        svgPatch\n *\n * setPenStyle (send the parameters)                            ==================>\n * setTheme (send the parameters)                               ==================>\n * setPenStyleClasses (send the parameters)                     ==================>\n *                                                              <==================        svgPatch\n * addStrokes (send the strokes ) ============>\n *                                                              <==================        update\n */\n\n/**\n * @group Recognizer\n */\nexport class RecognizerWebSocketSSR\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RECOGNIZER)\n\n  protected socket!: WebSocket\n  protected pingCount = 0\n  protected reconnectionCount = 0\n  protected viewSizeHeight!: number\n  protected viewSizeWidth!: number\n  protected sessionId?: string\n  currentPartId?: string\n  protected currentErrorCode?: string | number\n\n  protected penStyle?: TPenStyle\n  protected penStyleClasses?: string\n  protected theme?: TTheme\n\n  protected connected?: DeferredPromise<void>\n  protected ackDeferred?: DeferredPromise<void>\n  protected addStrokeDeferred?: DeferredPromise<TExport>\n  protected exportDeferred?: DeferredPromise<TExport>\n  protected convertDeferred?: DeferredPromise<TExport>\n  protected importDeferred?: DeferredPromise<TExport>\n  protected resizeDeferred?: DeferredPromise<void>\n  protected undoDeferred?: DeferredPromise<TExport>\n  protected redoDeferred?: DeferredPromise<TExport>\n  protected clearDeferred?: DeferredPromise<TExport>\n  protected importPointEventsDeferred?: DeferredPromise<TExport>\n  protected waitForIdleDeferred?: DeferredPromise<void>\n\n  configuration: TRecognizerWebSocketSSRConfiguration\n  initialized: DeferredPromise<void>\n  url: string\n  event: RecognizerEvent\n\n  constructor(config?: PartialDeep<TRecognizerWebSocketSSRConfiguration>)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.configuration = new RecognizerWebSocketSSRConfiguration(config)\n    const scheme = (this.configuration.server.scheme === \"https\") ? \"wss\" : \"ws\"\n    this.url = `${ scheme }://${ this.configuration.server.host }/api/v4.0/iink/document?applicationKey=${ this.configuration.server.applicationKey }`\n    this.event = new RecognizerEvent()\n    this.initialized = new DeferredPromise<void>()\n  }\n\n  get mimeTypes(): string[]\n  {\n    switch (this.configuration.recognition.type.toLocaleLowerCase()) {\n      case \"text\":\n        return this.configuration.recognition.text.mimeTypes\n      case \"math\":\n        return this.configuration.recognition.math.mimeTypes\n      default:\n        throw new Error(`Unauthorized recognition type: \"${ this.configuration.recognition.type }\"`)\n    }\n  }\n\n  protected infinitePing(): void\n  {\n    this.pingCount++\n    if (this.configuration.server.websocket.maxPingLostCount < this.pingCount) {\n      this.socket.close(1000, \"MAXIMUM_PING_REACHED\")\n    } else if (this.socket.readyState <= 1) {\n      setTimeout(() =>\n      {\n        if (this.socket.readyState <= 1) {\n          this.socket.send(JSON.stringify({ type: \"ping\" }))\n          this.infinitePing()\n        }\n      }, this.configuration.server.websocket.pingDelay)\n    }\n  }\n\n  protected openCallback(): void\n  {\n    this.connected?.resolve()\n    const params: TRecognizerWebSocketSSRMessage = {\n      type: this.sessionId ? \"restoreIInkSession\" : \"newContentPackage\",\n      iinkSessionId: this.sessionId,\n      applicationKey: this.configuration.server.applicationKey,\n      xDpi: 96,\n      yDpi: 96,\n      viewSizeHeight: this.viewSizeHeight,\n      viewSizeWidth: this.viewSizeWidth\n    }\n    if (isVersionSuperiorOrEqual(this.configuration.server.version!, \"2.0.4\")) {\n      params[\"myscript-client-name\"] = \"iink-ts\"\n      params[\"myscript-client-version\"] = \"1.0.0-buildVersion\"\n    }\n    this.send(params)\n  }\n\n  protected rejectDeferredPending(error: Error): void\n  {\n    if (this.connected?.isPending) {\n      this.connected?.reject(error)\n    }\n    if (this.initialized.isPending) {\n      this.initialized.reject(error)\n    }\n    if (this.addStrokeDeferred?.isPending) {\n      this.addStrokeDeferred?.reject(error)\n    }\n    if (this.exportDeferred?.isPending) {\n      this.exportDeferred?.reject(error)\n    }\n    if (this.importPointEventsDeferred?.isPending) {\n      this.importPointEventsDeferred?.reject(error)\n    }\n    if (this.convertDeferred?.isPending) {\n      this.convertDeferred?.reject(error)\n    }\n    if (this.importDeferred?.isPending) {\n      this.importDeferred?.reject(error)\n    }\n    if (this.resizeDeferred?.isPending) {\n      this.resizeDeferred?.reject(error)\n    }\n    if (this.waitForIdleDeferred?.isPending) {\n      this.waitForIdleDeferred?.reject(error)\n    }\n    if (this.undoDeferred?.isPending) {\n      this.undoDeferred?.reject(error)\n    }\n    if (this.redoDeferred?.isPending) {\n      this.redoDeferred?.reject(error)\n    }\n    if (this.clearDeferred?.isPending) {\n      this.clearDeferred.reject(error)\n    }\n    if (this.waitForIdleDeferred?.isPending) {\n      this.waitForIdleDeferred.reject(error)\n    }\n  }\n\n  protected closeCallback(evt: CloseEvent): void\n  {\n    let message = \"\"\n    if (!this.currentErrorCode) {\n      switch (evt.code) {\n        case 1000:\n          // Normal Closure\n          break\n        case 1001:\n          message = RecognizerError.GOING_AWAY\n          break\n        case 1002:\n          message = RecognizerError.PROTOCOL_ERROR\n          break\n        case 1003:\n          message = RecognizerError.UNSUPPORTED_DATA\n          break\n        case 1006:\n          message = RecognizerError.ABNORMAL_CLOSURE\n          break\n        case 1007:\n          message = RecognizerError.INVALID_FRAME_PAYLOAD\n          break\n        case 1008:\n          message = RecognizerError.POLICY_VIOLATION\n          break\n        case 1009:\n          message = RecognizerError.MESSAGE_TOO_BIG\n          break\n        case 1011:\n          message = RecognizerError.INTERNAL_ERROR\n          break\n        case 1012:\n          message = RecognizerError.SERVICE_RESTART\n          break\n        case 1013:\n          message = RecognizerError.TRY_AGAIN\n          break\n        case 1014:\n          message = RecognizerError.BAD_GATEWAY\n          break\n        case 1015:\n          message = RecognizerError.TLS_HANDSHAKE\n          break\n        default:\n          this.#logger.warn(\"closeCallback\", \"unknow CloseEvent.code\", { evt })\n          message = RecognizerError.CANT_ESTABLISH\n          break\n      }\n    }\n\n    if (!this.currentErrorCode && evt.code !== 1000) {\n      const error = new Error(message || evt.reason)\n      this.rejectDeferredPending(error)\n      this.event.emitError(error)\n    }\n  }\n\n  protected async manageAckMessage(websocketMessage: TRecognizerWebSocketSSRMessage): Promise<void>\n  {\n    this.#logger.info(\"manageAckMessage\", { websocketMessage })\n    const hmacChallengeMessage = websocketMessage as TRecognizerWebSocketSSRMessageHMACChallenge\n    if (hmacChallengeMessage.hmacChallenge) {\n      let hmacKey: string\n      if (typeof this.configuration.server.hmacKey == \"string\") {\n        if (this.configuration.server.hmacKey.length === 0) {\n          return this.ackDeferred?.reject(\"HMAC key is empty\")\n        }\n        hmacKey = this.configuration.server.hmacKey\n      } else if (typeof this.configuration.server.hmacKey == \"function\") {\n        hmacKey = await this.configuration.server.hmacKey(this.configuration.server.applicationKey)\n      }\n      else {\n        this.ackDeferred?.reject(\"HMAC key is not a string nor a function\")\n        return this.initialized.reject(new Error(\"HMAC key is not a string nor a function\"))\n      }\n      if (!hmacKey) {\n        this.ackDeferred?.reject(\"HMAC key is undefined\")\n        return this.initialized.reject(new Error(\"HMAC key is undefined\"))\n      }\n      this.send({\n        type: \"hmac\",\n        hmac: await computeHmac(hmacChallengeMessage.hmacChallenge, this.configuration.server.applicationKey, hmacKey)\n      })\n    }\n    if (hmacChallengeMessage.iinkSessionId) {\n      this.sessionId = hmacChallengeMessage.iinkSessionId\n    }\n    if (!isVersionSuperiorOrEqual(this.configuration.server.version!, \"2.3.0\")) {\n      delete this.configuration.recognition.convert\n    }\n    if (!isVersionSuperiorOrEqual(this.configuration.server.version!, \"3.2.0\")) {\n      delete this.configuration.recognition.export.jiix.text.lines\n    }\n    this.send({ ...this.configuration.recognition, type: \"configuration\" })\n    this.ackDeferred?.resolve()\n  }\n\n  protected async manageContentPackageDescriptionMessage(): Promise<void>\n  {\n    this.reconnectionCount = 0\n    await this.ackDeferred?.promise\n    this.#logger.info(\"manageContentPackageDescriptionMessage\")\n    if (this.currentPartId) {\n      this.send({ type: \"openContentPart\", id: this.currentPartId, mimeTypes: this.mimeTypes })\n    }\n    else {\n      this.send({ type: \"newContentPart\", contentType: this.configuration.recognition.type, mimeTypes: this.mimeTypes })\n    }\n  }\n\n  protected managePartChangeMessage(websocketMessage: TRecognizerWebSocketSSRMessage): void\n  {\n    this.#logger.info(\"managePartChangeMessage\", { websocketMessage })\n    const partChangeMessage = websocketMessage as TRecognizerWebSocketSSRMessagePartChange\n    this.currentPartId = partChangeMessage.partId\n    this.initialized.resolve()\n  }\n\n  protected manageExportMessage(websocketMessage: TRecognizerWebSocketSSRMessage): void\n  {\n    this.#logger.info(\"manageExportMessage\", { websocketMessage })\n    const exportMessage = websocketMessage as TRecognizerWebSocketSSRMessageExport\n    if (exportMessage.exports[\"application/vnd.myscript.jiix\"]) {\n      exportMessage.exports[\"application/vnd.myscript.jiix\"] = JSON.parse(exportMessage.exports[\"application/vnd.myscript.jiix\"].toString()) as TJIIXExport\n    }\n    this.initialized.resolve()\n    this.addStrokeDeferred?.resolve(exportMessage.exports)\n    this.exportDeferred?.resolve(exportMessage.exports)\n    this.convertDeferred?.resolve(exportMessage.exports)\n    this.importDeferred?.resolve(exportMessage.exports)\n    this.undoDeferred?.resolve(exportMessage.exports)\n    this.redoDeferred?.resolve(exportMessage.exports)\n    this.clearDeferred?.resolve(exportMessage.exports)\n    this.importPointEventsDeferred?.resolve(exportMessage.exports)\n    this.event.emitExported(exportMessage.exports)\n  }\n\n  protected async manageWaitForIdle(): Promise<void>\n  {\n    this.event.emitIdle(true)\n    this.waitForIdleDeferred?.resolve()\n  }\n\n  protected manageErrorMessage(websocketMessage: TRecognizerWebSocketSSRMessage): void\n  {\n    const err = websocketMessage as TRecognizerWebSocketSSRMessageError\n    this.currentErrorCode = err.data?.code || err.code\n    let message = err.data?.message || err.message || RecognizerError.UNKNOW\n\n    switch (this.currentErrorCode) {\n      case \"no.activity\":\n        message = RecognizerError.NO_ACTIVITY\n        break\n      case \"access.not.granted\":\n        message = RecognizerError.WRONG_CREDENTIALS\n        break\n      case \"session.too.old\":\n        message = RecognizerError.TOO_OLD\n        break\n    }\n    const error = new Error(message)\n    this.rejectDeferredPending(error)\n    this.event.emitError(error)\n  }\n\n  protected manageContentChangeMessage(websocketMessage: TRecognizerWebSocketSSRMessage): void\n  {\n    this.#logger.info(\"manageContentChangeMessage\", { websocketMessage })\n    const contentChangeMessage = websocketMessage as TRecognizerWebSocketSSRMessageContentChange\n    const context: THistoryContext = {\n      canRedo: contentChangeMessage.canRedo,\n      canUndo: contentChangeMessage.canUndo,\n      empty: contentChangeMessage.empty,\n      stackIndex: contentChangeMessage.undoStackIndex,\n      possibleUndoCount: contentChangeMessage.possibleUndoCount,\n    }\n    this.event.emitContentChanged(context)\n  }\n\n  protected manageSVGPatchMessage(websocketMessage: TRecognizerWebSocketSSRMessage): void\n  {\n    this.#logger.info(\"manageSVGPatchMessage\", { websocketMessage })\n    this.resizeDeferred?.resolve()\n    const svgPatchMessage = websocketMessage as TRecognizerWebSocketSSRMessageSVGPatch\n    this.event.emitSVGPatch(svgPatchMessage)\n  }\n\n  protected messageCallback(message: MessageEvent<string>): void\n  {\n    this.#logger.debug(\"messageCallback\", { message })\n    this.currentErrorCode = undefined\n    const websocketMessage: TRecognizerWebSocketSSRMessage = JSON.parse(message.data)\n    if (websocketMessage.type !== \"pong\") {\n      this.pingCount = 0\n      switch (websocketMessage.type) {\n        case \"ack\":\n          this.manageAckMessage(websocketMessage)\n          break\n        case \"contentPackageDescription\":\n          this.manageContentPackageDescriptionMessage()\n          break\n        case \"partChanged\":\n          this.managePartChangeMessage(websocketMessage)\n          break\n        case \"newPart\":\n          this.initialized.resolve()\n          break\n        case \"contentChanged\":\n          this.manageContentChangeMessage(websocketMessage)\n          break\n        case \"exported\":\n          this.manageExportMessage(websocketMessage)\n          break\n        case \"svgPatch\":\n          this.manageSVGPatchMessage(websocketMessage)\n          break\n        case \"error\":\n          this.manageErrorMessage(websocketMessage)\n          break\n        case \"idle\":\n          this.manageWaitForIdle()\n          break\n        default:\n          this.#logger.warn(\"messageCallback\", `Message type unknow: \"${ websocketMessage.type }\".`)\n      }\n    }\n  }\n\n  async init(height: number, width: number): Promise<void>\n  {\n    try {\n      this.event.emitStartInitialization()\n      this.#logger.info(\"init\", { height, width })\n      this.destroy()\n\n      if (!this.configuration.server.version) {\n        this.configuration.server.version = (await getApiInfos(this.configuration)).version\n      }\n      this.connected = new DeferredPromise<void>()\n      this.initialized = new DeferredPromise<void>()\n      this.ackDeferred = new DeferredPromise<void>()\n      this.viewSizeHeight = height\n      this.viewSizeWidth = width\n      this.pingCount = 0\n      this.socket = new WebSocket(this.url)\n\n      if (this.configuration.server.websocket.pingEnabled) {\n        this.infinitePing()\n      }\n\n      this.socket.addEventListener(\"open\", this.openCallback.bind(this))\n      this.socket.addEventListener(\"close\", this.closeCallback.bind(this))\n      this.socket.addEventListener(\"message\", this.messageCallback.bind(this))\n      this.event.emitEndtInitialization()\n      await this.connected.promise\n      await this.initialized.promise\n    } catch (err: unknown) {\n      this.rejectDeferredPending(err as Error)\n      return this.initialized.promise\n    }\n  }\n\n  async send(message: TRecognizerWebSocketSSRMessage): Promise<void>\n  {\n    if (!this.socket) {\n      return Promise.reject(new Error(\"Recognizer must be initilized\"))\n    }\n    await this.connected?.promise\n    if (this.socket.readyState === this.socket.OPEN) {\n      this.#logger.debug(\"send\", { message })\n      this.socket.send(JSON.stringify(message))\n      return Promise.resolve()\n    } else {\n      if (this.socket.readyState != this.socket.CONNECTING && this.configuration.server.websocket.autoReconnect) {\n        this.reconnectionCount++\n        if (this.configuration.server.websocket.maxRetryCount >= this.reconnectionCount) {\n          this.#logger.debug(\"send\", `try to reconnect number: ${ this.reconnectionCount }.`)\n          await this.init(this.viewSizeHeight, this.viewSizeWidth)\n          await this.setPenStyle(this.penStyle as TPenStyle)\n          await this.setPenStyleClasses(this.penStyleClasses as string)\n          await this.setTheme(this.theme as TTheme)\n          return this.send(message)\n        }\n        else {\n          return Promise.reject(new Error(\"Unable to send message. The maximum number of connection attempts has been reached.\"))\n        }\n      }\n    }\n  }\n\n  async addStrokes(strokes: Stroke[]): Promise<TExport>\n  {\n    this.#logger.info(\"addStrokes\", { strokes })\n    await this.initialized.promise\n    this.addStrokeDeferred = new DeferredPromise<TExport>()\n    if (strokes.length === 0) {\n      this.addStrokeDeferred.resolve({} as TExport)\n    }\n    else {\n      await this.send({\n        type: \"addStrokes\",\n        strokes: strokes.map(s => s.formatToSend())\n      })\n    }\n    return this.addStrokeDeferred?.promise\n  }\n\n  async setPenStyle(penStyle: TPenStyle): Promise<void>\n  {\n    this.#logger.info(\"setPenStyle\", { penStyle })\n    await this.initialized.promise\n    this.penStyle = penStyle\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"setPenStyle\",\n      style: StyleHelper.penStyleToCSS(penStyle)\n    }\n    return this.send(message)\n  }\n\n  async setPenStyleClasses(penStyleClasses: string): Promise<void>\n  {\n    await this.initialized.promise\n    this.penStyleClasses = penStyleClasses\n    this.#logger.info(\"setPenStyleClasses\", { penStyleClasses })\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"setPenStyleClasses\",\n      styleClasses: penStyleClasses\n    }\n    return this.send(message)\n  }\n\n  async setTheme(theme: TTheme): Promise<void>\n  {\n    this.#logger.info(\"setTheme\", { theme })\n    await this.initialized.promise\n    this.theme = theme\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"setTheme\",\n      theme: StyleHelper.themeToCSS(theme)\n    }\n    return this.send(message)\n  }\n\n  async export(model: Model, requestedMimeTypes?: string[]): Promise<Model>\n  {\n    this.#logger.info(\"export\", { model, requestedMimeTypes })\n    await this.initialized.promise\n    this.exportDeferred = new DeferredPromise<TExport>()\n    const localModel = model.clone()\n    let mimeTypes: string[] = requestedMimeTypes || []\n    if (!mimeTypes.length) {\n      switch (this.configuration.recognition.type) {\n        case \"MATH\":\n          mimeTypes = this.configuration.recognition.math.mimeTypes\n          break\n        case \"TEXT\":\n          mimeTypes = this.configuration.recognition.text.mimeTypes\n          break\n        default:\n          throw new Error(`Recognition type \"${ this.configuration.recognition.type }\" is unknown.\\n Possible types are:\\n -MATH\\n -TEXT`)\n      }\n    }\n\n    if (!mimeTypes.length) {\n      return Promise.reject(new Error(`Export failed, no mimeTypes define in recognition ${ this.configuration.recognition.type } configuration`))\n    }\n\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"export\",\n      partId: this.currentPartId,\n      mimeTypes\n    }\n    await this.send(message)\n    const exports: TExport = await this.exportDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(exports)\n    this.#logger.debug(\"export\", { model: localModel })\n    return localModel\n  }\n\n  async import(model: Model, data: Blob, mimeType?: string): Promise<Model>\n  {\n    this.#logger.info(\"import\", { data, mimeType })\n    await this.initialized.promise\n    const localModel = model.clone()\n    const chunkSize = this.configuration.server.websocket.fileChunkSize\n    const importFileId = Math.random().toString(10).substring(2, 6)\n    this.importDeferred = new DeferredPromise<TExport>()\n    const readBlob = (blob: Blob): Promise<string | never> =>\n    {\n      const fileReader = new FileReader()\n      return new Promise((resolve, reject) =>\n      {\n        fileReader.onloadend = (ev) => resolve(ev.target?.result as string)\n        fileReader.onerror = () => reject()\n        fileReader.readAsText(blob)\n      })\n    }\n\n    const importFileMessage: TRecognizerWebSocketSSRMessage = {\n      type: \"importFile\",\n      importFileId,\n      mimeType\n    }\n    await this.send(importFileMessage)\n    for (let i = 0; i < data.size; i += chunkSize) {\n      const blobPart = data.slice(i, i + chunkSize, data.type)\n      const partFileString = await readBlob(blobPart)\n      const fileChuckMessage: TRecognizerWebSocketSSRMessage = {\n        type: \"fileChunk\",\n        importFileId,\n        data: partFileString,\n        lastChunk: i + chunkSize > data.size\n      }\n      await this.send(fileChuckMessage)\n    }\n    const exports = await this.importDeferred?.promise\n    this.importDeferred = undefined\n    localModel.mergeExport(exports)\n    return localModel\n  }\n\n  async resize(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"resize\", { model })\n    await this.initialized.promise\n    this.resizeDeferred = new DeferredPromise<void>()\n    const localModel = model.clone()\n    this.viewSizeHeight = localModel.height\n    this.viewSizeWidth = localModel.width\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"changeViewSize\",\n      height: this.viewSizeHeight,\n      width: this.viewSizeWidth,\n    }\n    await this.send(message)\n    await this.resizeDeferred?.promise\n    return localModel\n  }\n\n  async importPointEvents(strokes: Stroke[]): Promise<TExport>\n  {\n    this.#logger.info(\"importPointsEvents\", { strokes })\n    await this.initialized.promise\n    this.importPointEventsDeferred = new DeferredPromise<TExport>()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"pointerEvents\",\n      events: strokes.map(s => s.formatToSend())\n    }\n    await this.send(message)\n    return this.importPointEventsDeferred?.promise\n  }\n\n  async convert(model: Model, conversionState?: TConverstionState): Promise<Model>\n  {\n    this.#logger.info(\"convert\", { model, conversionState })\n    await this.initialized.promise\n    this.convertDeferred = new DeferredPromise<TExport>()\n    const localModel = model.clone()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"convert\",\n      conversionState\n    }\n    await this.send(message)\n    const myExportConverted: TExport = await this.convertDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeConvert(myExportConverted)\n    this.#logger.debug(\"convert\", { model: localModel })\n    return localModel\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    await this.initialized.promise\n    this.waitForIdleDeferred = new DeferredPromise<void>()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"waitForIdle\",\n    }\n    await this.send(message)\n    return this.waitForIdleDeferred?.promise\n  }\n\n  async undo(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"undo\", { model })\n    await this.initialized.promise\n    const localModel = model.clone()\n    this.undoDeferred = new DeferredPromise<TExport>()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"undo\",\n    }\n    await this.send(message)\n    const undoExports = await this.undoDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(undoExports)\n    this.#logger.debug(\"undo\", { model: localModel })\n    this.undoDeferred = undefined\n    return localModel\n  }\n\n  async redo(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"redo\", { model })\n    await this.initialized.promise\n    const localModel = model.clone()\n    this.redoDeferred = new DeferredPromise<TExport>()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"redo\",\n    }\n    await this.send(message)\n    const redoExports = await this.redoDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(redoExports)\n    this.#logger.debug(\"redo\", { model: redoExports })\n    this.redoDeferred = undefined\n    return localModel\n  }\n\n  async clear(model: Model): Promise<Model>\n  {\n    this.#logger.info(\"clear\", { model })\n    await this.initialized.promise\n    const localModel = model.clone()\n    localModel.modificationDate = Date.now()\n    this.clearDeferred = new DeferredPromise<TExport>()\n    const message: TRecognizerWebSocketSSRMessage = {\n      type: \"clear\",\n    }\n    await this.send(message)\n    const clearExports = await this.clearDeferred?.promise\n    localModel.updatePositionReceived()\n    localModel.mergeExport(clearExports)\n    this.clearDeferred = undefined\n    this.#logger.info(\"clear\", { model: localModel })\n    return localModel\n  }\n\n  close(code: number, reason: string): void\n  {\n    if (this.socket.readyState === this.socket.OPEN || this.socket.readyState === this.socket.CONNECTING) {\n      this.#logger.info(\"close\", { code, reason })\n      this.socket.removeEventListener(\"close\", this.closeCallback)\n      this.socket.removeEventListener(\"message\", this.messageCallback)\n      this.socket.removeEventListener(\"open\", this.openCallback)\n      this.socket.close(code, reason)\n    }\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\")\n    this.connected = undefined\n    this.ackDeferred = undefined\n    this.addStrokeDeferred = undefined\n    this.exportDeferred = undefined\n    this.convertDeferred = undefined\n    this.importDeferred = undefined\n    this.importPointEventsDeferred = undefined\n    this.waitForIdleDeferred = undefined\n    this.resizeDeferred = undefined\n    this.undoDeferred = undefined\n    this.redoDeferred = undefined\n    this.clearDeferred = undefined\n    if (this.socket) {\n      this.socket.removeEventListener(\"close\", this.closeCallback)\n      this.socket.removeEventListener(\"message\", this.messageCallback)\n      this.socket.removeEventListener(\"open\", this.openCallback)\n      this.close(1000, \"Recognizer destroyed\")\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { TPoint, TCanvasShapeEllipseSymbol, TCanvasShapeLineSymbol, TCanvasShapeTableSymbol, TSymbol } from \"../../symbol\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRendererShape\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n\n  symbols = {\n    table: \"table\",\n    ellipse: \"ellipse\",\n    line: \"line\"\n  }\n\n  protected phi(angle: number): number\n  {\n    let returnedAngle = ((angle + Math.PI) % (Math.PI * 2)) - Math.PI\n    if (returnedAngle < -Math.PI) {\n      returnedAngle += Math.PI * 2\n    }\n    this.#logger.debug(\"phi\", { angle, returnedAngle })\n    return returnedAngle\n  }\n\n  protected drawEllipseArc(context2D: CanvasRenderingContext2D, shapeEllipse: TCanvasShapeEllipseSymbol): TPoint[]\n  {\n    this.#logger.debug(\"drawEllipseArc\", { context2D, shapeEllipse })\n    const { centerPoint, maxRadius, minRadius, orientation, startAngle, sweepAngle } = shapeEllipse\n    const angleStep = 0.02\n    const z1 = Math.cos(orientation) * maxRadius\n    const z2 = Math.cos(orientation) * minRadius\n    const z3 = Math.sin(orientation) * maxRadius\n    const z4 = Math.sin(orientation) * minRadius\n    const n = Math.floor(Math.abs(sweepAngle) / angleStep)\n    const boundariesPoints = []\n    context2D.save()\n    try {\n      context2D.beginPath()\n      for (let i = 0; i <= n; i++) {\n        const angle = startAngle + ((i / n) * sweepAngle)\n        const alpha = Math.atan2(Math.sin(angle) / minRadius, Math.cos(angle) / maxRadius)\n        const cosAlpha = Math.cos(alpha)\n        const sinAlpha = Math.sin(alpha)\n        const x = (centerPoint.x + (z1 * cosAlpha)) - (z4 * sinAlpha)\n        const y = (centerPoint.y + (z2 * sinAlpha)) + (z3 * cosAlpha)\n        if (i === 0) {\n          context2D.moveTo(x, y)\n        } else {\n          context2D.lineTo(x, y)\n        }\n        if (i === 0 || i === n) {\n          boundariesPoints.push({ x, y })\n        }\n      }\n      context2D.stroke()\n    } catch(error) {\n      this.#logger.error(\"drawEllipseArc\", { error })\n    } finally {\n      context2D.restore()\n    }\n    return boundariesPoints\n  }\n\n  protected drawLine(context2D: CanvasRenderingContext2D, p1: TPoint, p2: TPoint)\n  {\n    this.#logger.debug(\"drawLine\", { context2D, p1, p2 })\n    context2D.save()\n    try {\n      context2D.beginPath()\n      context2D.moveTo(p1.x, p1.y)\n      context2D.lineTo(p2.x, p2.y)\n      context2D.stroke()\n    } catch(error) {\n      this.#logger.error(\"drawLine\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawArrowHead(context2D: CanvasRenderingContext2D, headPoint: TPoint, angle: number, length: number)\n  {\n    this.#logger.debug(\"drawArrowHead\", { context2D, headPoint, angle, length })\n    const alpha = this.phi(angle + (Math.PI * (7 / 8)))\n    const beta = this.phi(angle - (Math.PI * (7 / 8)))\n    context2D.save()\n    try {\n      context2D.fillStyle = context2D.strokeStyle\n\n      context2D.moveTo(headPoint.x, headPoint.y)\n      context2D.beginPath()\n      context2D.lineTo(headPoint.x + (length * Math.cos(alpha)), headPoint.y + (length * Math.sin(alpha)))\n      context2D.lineTo(headPoint.x + (length * Math.cos(beta)), headPoint.y + (length * Math.sin(beta)))\n      context2D.lineTo(headPoint.x, headPoint.y)\n      context2D.fill()\n    } catch(error) {\n      this.#logger.error(\"drawArrowHead\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawShapeEllipse(context2D: CanvasRenderingContext2D, shapeEllipse: TCanvasShapeEllipseSymbol)\n  {\n    this.#logger.debug(\"drawShapeEllipse\", { context2D, shapeEllipse })\n    const points = this.drawEllipseArc(context2D, shapeEllipse)\n\n    if (shapeEllipse?.beginDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, points[0], shapeEllipse.beginTangentAngle, 12.0)\n    }\n    if (shapeEllipse?.endDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, points[1], shapeEllipse.endTangentAngle, 12.0)\n    }\n  }\n\n  protected drawShapeLine(context2D: CanvasRenderingContext2D, shapeLine: TCanvasShapeLineSymbol)\n  {\n    this.#logger.debug(\"drawShapeLine\", { context2D, shapeLine })\n    this.drawLine(context2D, shapeLine.firstPoint, shapeLine.lastPoint)\n    if (shapeLine.beginDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, shapeLine.firstPoint, shapeLine.beginTangentAngle, 12.0)\n    }\n    if (shapeLine.endDecoration === \"ARROW_HEAD\") {\n      this.drawArrowHead(context2D, shapeLine.lastPoint, shapeLine.endTangentAngle, 12.0)\n    }\n  }\n\n  draw(context2D: CanvasRenderingContext2D, symbol: TSymbol)\n  {\n    this.#logger.info(\"draw\", { context2D, symbol })\n    context2D.save()\n    context2D.lineWidth = symbol.style.width as number\n    context2D.strokeStyle = symbol.style.color as string\n\n    switch (symbol.type) {\n      case this.symbols.table: {\n        const tableSymbols = symbol as TCanvasShapeTableSymbol\n        tableSymbols.lines.forEach(line => this.drawLine(context2D, line.p1, line.p2))\n        break\n      }\n      case this.symbols.ellipse: {\n        this.drawShapeEllipse(context2D, symbol as TCanvasShapeEllipseSymbol)\n        break\n      }\n      case this.symbols.line: {\n        this.drawShapeLine(context2D, symbol as TCanvasShapeLineSymbol)\n        break\n      }\n      default:\n        this.#logger.warn(\"draw\", `${ symbol.type } not implemented`)\n        break\n    }\n  }\n\n}\n","import { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { Stroke, TPointer } from \"../../symbol\"\nimport { computeAngleAxeRadian, computeLinksPointers, computeMiddlePointer } from \"../../utils\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRendererStroke\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n\n  protected renderArc(context2d: CanvasRenderingContext2D, center: TPointer, radius: number): void\n  {\n    this.#logger.debug(\"renderArc\", { context2d, center, radius })\n    context2d.arc(center.x, center.y, radius, 0, Math.PI * 2, true)\n  }\n\n  protected renderLine(context2d: CanvasRenderingContext2D, begin: TPointer, end: TPointer, width: number): void\n  {\n    this.#logger.debug(\"renderLine\", { context2d, begin, end, width })\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, end), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(begin, end), width)\n\n    context2d.moveTo(linkPoints1[0].x, linkPoints1[0].y)\n    context2d.lineTo(linkPoints2[0].x, linkPoints2[0].y)\n    context2d.lineTo(linkPoints2[1].x, linkPoints2[1].y)\n    context2d.lineTo(linkPoints1[1].x, linkPoints1[1].y)\n  }\n\n  protected renderFinal(context2d: CanvasRenderingContext2D, begin: TPointer, end: TPointer, width: number): void\n  {\n    this.#logger.debug(\"renderFinal\", { context2d, begin, end, width })\n    const ARCSPLIT = 6\n    const angle = computeAngleAxeRadian(begin, end)\n    const linkPoints = computeLinksPointers(end, angle, width)\n    context2d.moveTo(linkPoints[0].x, linkPoints[0].y)\n    for (let i = 1; i <= ARCSPLIT; i++) {\n      const newAngle = angle - ((i * Math.PI) / ARCSPLIT)\n      context2d.lineTo(end.x - ((end.p * width) * Math.sin(newAngle)), end.y + (end.p * width * Math.cos(newAngle)))\n    }\n  }\n\n  protected renderQuadratic(context2d: CanvasRenderingContext2D, begin: TPointer, end: TPointer, ctrl: TPointer, width: number): void\n  {\n    this.#logger.debug(\"renderQuadratic\", { context2d, begin, end, ctrl, width })\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, ctrl), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(ctrl, end), width)\n    const linkPoints3 = computeLinksPointers(ctrl, computeAngleAxeRadian(begin, end), width)\n\n    context2d.moveTo(linkPoints1[0].x, linkPoints1[0].y)\n    context2d.quadraticCurveTo(linkPoints3[0].x, linkPoints3[0].y, linkPoints2[0].x, linkPoints2[0].y)\n    context2d.lineTo(linkPoints2[1].x, linkPoints2[1].y)\n    context2d.quadraticCurveTo(linkPoints3[1].x, linkPoints3[1].y, linkPoints1[1].x, linkPoints1[1].y)\n  }\n\n  draw(context2d: CanvasRenderingContext2D, stroke: Stroke): void\n  {\n    this.#logger.info(\"draw\", { context2d, stroke })\n    const NUMBER_POINTS = stroke.pointers.length\n    const NUMBER_QUADRATICS = NUMBER_POINTS - 2\n    const width = (stroke.style.width as number) > 0 ? (stroke.style.width as number) : context2d.lineWidth\n    const color = (stroke.style.color as string) ? (stroke.style.color as string) : context2d.strokeStyle\n    const firstPoint = stroke.pointers[0] as TPointer\n\n    context2d.save()\n    try {\n      context2d.beginPath()\n      if (NUMBER_POINTS < 3) {\n        this.renderArc(context2d, firstPoint, width * 0.6)\n      } else {\n        this.renderArc(context2d, firstPoint, width * firstPoint.p)\n        const secondPoint: TPointer = computeMiddlePointer(firstPoint, stroke.pointers[1])\n        this.renderLine(context2d, firstPoint, secondPoint, width)\n\n        for (let i = 0; i < NUMBER_QUADRATICS; i++) {\n          const begin: TPointer = computeMiddlePointer(stroke.pointers[i], stroke.pointers[i + 1])\n          const end: TPointer = computeMiddlePointer(stroke.pointers[i + 1], stroke.pointers[i + 2])\n          const ctrl: TPointer = stroke.pointers[i + 1]\n          this.renderQuadratic(context2d, begin, end, ctrl, width)\n        }\n        const beginLine: TPointer = computeMiddlePointer(stroke.pointers[NUMBER_POINTS - 2], stroke.pointers[NUMBER_POINTS - 1])\n        const endLine: TPointer = stroke.pointers[NUMBER_POINTS - 1]\n        this.renderLine(context2d, beginLine, endLine, width)\n\n        const beginFinal: TPointer = stroke.pointers[NUMBER_POINTS - 2]\n        const endFinal: TPointer = stroke.pointers[NUMBER_POINTS - 1]\n        this.renderFinal(context2d, beginFinal, endFinal, width)\n      }\n      context2d.closePath()\n      if (color !== undefined) {\n        context2d.fillStyle = color\n        context2d.fill()\n      }\n      context2d.save()\n    }\n    catch (error) {\n      this.#logger.error(\"draw\", { error })\n    }\n    finally {\n      context2d.restore()\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { TSymbol, TCanvasTextSymbol, TCanvasTextUnderlineSymbol, TCanvasUnderLineSymbol, TPoint } from \"../../symbol\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRendererText\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n\n  symbols = {\n    char: \"char\",\n    string: \"string\",\n    textLine: \"textLine\"\n  }\n\n  protected drawUnderline(context2D: CanvasRenderingContext2D, textUnderline: TCanvasTextUnderlineSymbol, underline: TCanvasUnderLineSymbol)\n  {\n    this.#logger.debug(\"#drawUnderline\", { context2D, textUnderline, underline })\n    context2D.save()\n    try {\n      const delta = textUnderline.data.width / textUnderline.label.length\n      const p1: TPoint = {\n        x: textUnderline.data.topLeftPoint.x + (underline.data.firstCharacter * delta),\n        y: textUnderline.data.topLeftPoint.y + textUnderline.data.height\n      }\n      const p2: TPoint = {\n        x: textUnderline.data.topLeftPoint.x + (underline.data.lastCharacter * delta),\n        y: textUnderline.data.topLeftPoint.y + textUnderline.data.height\n      }\n      context2D.beginPath()\n      context2D.moveTo(p1.x, p1.y)\n      context2D.lineTo(p2.x, p2.y)\n      context2D.stroke()\n    } catch(error) {\n      this.#logger.error(\"#drawUnderline\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawText(context2D: CanvasRenderingContext2D, text: TCanvasTextSymbol)\n  {\n    this.#logger.debug(\"#drawText\", { context2D, text })\n    context2D.save()\n    try {\n      context2D.font = `${ text.data.textHeight }px serif`\n      context2D.textAlign = (text.data.justificationType === \"CENTER\") ? \"center\" : \"left\"\n      context2D.textBaseline = \"bottom\"\n      context2D.fillStyle = context2D.strokeStyle\n      context2D.fillText(text.label, text.data.topLeftPoint.x, (text.data.topLeftPoint.y + text.data.height))\n    } catch(error) {\n      this.#logger.error(\"#drawText\", { error })\n    } finally {\n      context2D.restore()\n    }\n  }\n\n  protected drawTextLine(context2D: CanvasRenderingContext2D, textUnderline: TCanvasTextUnderlineSymbol)\n  {\n    this.#logger.debug(\"#drawTextLine\", { context2D, textUnderline })\n    this.drawText(context2D, textUnderline)\n    textUnderline.underlineList.forEach((underline) =>\n    {\n      this.drawUnderline(context2D, textUnderline, underline)\n    })\n  }\n\n  draw(context2D: CanvasRenderingContext2D, symbol: TSymbol)\n  {\n    this.#logger.info(\"draw\", { context2D, symbol })\n    context2D.lineWidth = (symbol.style.width as number)\n    context2D.strokeStyle = (symbol.style.color as string)\n    switch (symbol.type) {\n      case this.symbols.char:\n      case this.symbols.string:\n        this.drawText(context2D, symbol as TCanvasTextSymbol)\n        break\n      case this.symbols.textLine:\n        this.drawTextLine(context2D, symbol as TCanvasTextUnderlineSymbol)\n        break\n      default:\n        this.#logger.warn(\"draw\", `${symbol.type} not implemented`)\n        break\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { Model } from \"../../model\"\nimport { Stroke, TSymbol } from \"../../symbol\"\nimport { TRendererConfiguration } from \"../RendererConfiguration\"\nimport { CanvasRendererShape } from \"./CanvasRendererShape\"\nimport { CanvasRendererStroke } from \"./CanvasRendererStroke\"\nimport { CanvasRendererText } from \"./CanvasRendererText\"\n\n/**\n * @group Renderer\n */\nexport class CanvasRenderer\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n  configuration: Omit<TRendererConfiguration, \"guides\">\n  strokeRenderer: CanvasRendererStroke\n  shapeRenderer: CanvasRendererShape\n  textRenderer: CanvasRendererText\n  context!: {\n    parent: HTMLElement\n    renderingCanvas: HTMLCanvasElement\n    renderingCanvasContext: CanvasRenderingContext2D\n    capturingCanvas: HTMLCanvasElement\n    capturingCanvasContext: CanvasRenderingContext2D\n  }\n\n  constructor(config: Omit<TRendererConfiguration, \"guides\">)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.configuration = config\n    this.strokeRenderer = new CanvasRendererStroke()\n    this.shapeRenderer = new CanvasRendererShape()\n    this.textRenderer = new CanvasRendererText()\n  }\n\n  protected createCanvas(type: string): HTMLCanvasElement\n  {\n    this.#logger.debug(\"createCanvas\", { type })\n    const canvas: HTMLCanvasElement = document.createElement(\"canvas\")\n    canvas.id = type\n    canvas.classList.add(type)\n    canvas.classList.add(\"ms-canvas\")\n    return canvas\n  }\n\n  protected resizeContent(): void\n  {\n    const pixelRatio: number = window.devicePixelRatio\n    const elements: HTMLCanvasElement[] = [this.context.renderingCanvas, this.context.capturingCanvas]\n    elements.forEach((canvas) =>\n    {\n      const domElement = canvas.parentNode as HTMLElement\n      const width = Math.max(this.configuration.minWidth, domElement.clientWidth)\n      const height = Math.max(this.configuration.minHeight, domElement.clientHeight)\n      canvas.width = width * pixelRatio\n      canvas.height = height * pixelRatio\n      canvas.getContext(\"2d\")?.scale(pixelRatio, pixelRatio)\n      canvas.style.width = `${ width }px`\n      canvas.style.height = `${ height }px`\n    })\n  }\n\n  protected drawSymbol(context2D: CanvasRenderingContext2D, symbol: TSymbol)\n  {\n    this.#logger.debug(\"drawSymbol\", { symbol })\n    if (symbol.type === \"stroke\") {\n      const stroke = symbol as Stroke\n      if (stroke.pointerType !== \"eraser\") {\n        this.strokeRenderer.draw(context2D, stroke)\n      }\n    } else if (Object.keys(this.textRenderer.symbols).includes(symbol.type)) {\n      this.textRenderer.draw(context2D, symbol)\n    } else if (Object.keys(this.shapeRenderer.symbols).includes(symbol.type)) {\n      this.shapeRenderer.draw(context2D, symbol)\n    } else {\n      this.#logger.warn(\"drawSymbol\", `symbol type unknow: ${symbol.type}`)\n    }\n  }\n\n  init(element: HTMLElement, guide?: { x?: number, y?: number } ): void\n  {\n    this.#logger.info(\"init\", { element })\n    const renderingCanvas: HTMLCanvasElement = this.createCanvas(\"ms-rendering-canvas\")\n    renderingCanvas.setAttribute(\"data-layer\", \"MODEL\")\n    if (guide) {\n      renderingCanvas.style.backgroundSize = `${guide.x || 1}px ${guide.y || 1}px`\n    }\n    element.appendChild(renderingCanvas)\n\n    const capturingCanvas: HTMLCanvasElement = this.createCanvas(\"ms-capture-canvas\")\n    capturingCanvas.setAttribute(\"data-layer\", \"CAPTURE\")\n    element.appendChild(capturingCanvas)\n\n    this.context = {\n      parent: element,\n      renderingCanvas,\n      renderingCanvasContext: renderingCanvas.getContext(\"2d\") as CanvasRenderingContext2D,\n      capturingCanvas,\n      capturingCanvasContext: capturingCanvas.getContext(\"2d\") as CanvasRenderingContext2D\n    }\n\n    this.resizeContent()\n  }\n\n  drawModel(model: Model): void\n  {\n    this.#logger.info(\"drawModel\", { model })\n    this.context.renderingCanvasContext?.clearRect(0, 0, this.context.renderingCanvas.width, this.context.renderingCanvas.height)\n    model.symbols.forEach(symbol => this.drawSymbol(this.context.renderingCanvasContext, symbol))\n    this.context.capturingCanvasContext.clearRect(0, 0, this.context.capturingCanvas.width, this.context.capturingCanvas.height)\n  }\n\n  drawPendingStroke(stroke: Stroke | undefined): void\n  {\n    this.#logger.info(\"drawPendingStroke\", { stroke })\n    this.context.capturingCanvasContext.clearRect(0, 0, this.context.capturingCanvas.width, this.context.capturingCanvas.height)\n    if (stroke && stroke?.pointerType !== \"eraser\") {\n      this.strokeRenderer.draw(this.context.capturingCanvasContext, stroke)\n    }\n  }\n\n  resize(model: Model): void\n  {\n    this.#logger.info(\"resize\", { model })\n    this.resizeContent()\n    this.drawModel(model)\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\")\n    if (this.context.parent) {\n      this.context.parent.innerHTML = \"\"\n    }\n  }\n}\n","\n/**\n * @group Renderer\n */\nexport const SVGRendererConst =\n{\n  arrowHeadStartMarker: \"arrow-head-start\",\n  arrowHeadEndMaker: \"arrow-head-end\",\n  selectionFilterId: \"selection-filter\",\n  removalFilterId: \"removal-filter\",\n  crossMarker: \"cross-marker\",\n  noSelection: \"pointer-events: none; -webkit-touch-callout: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;\",\n}","import { TBox, TPoint } from \"../../symbol\"\n\nconst XMLNS = \"http://www.w3.org/2000/svg\"\n/**\n * @group Renderer\n */\nexport class SVGBuilder\n{\n  static createLayer(boundingBox: TBox, attrs: { [key: string]: string } = {}): SVGSVGElement\n  {\n    const svgEl = document.createElementNS(XMLNS, \"svg\")\n    svgEl.setAttribute(\"width\", `${ boundingBox.width }px`)\n    svgEl.setAttribute(\"height\", `${ boundingBox.height }px`)\n    svgEl.setAttribute(\"viewBox\", `${boundingBox.x}, ${boundingBox.y}, ${boundingBox. width }, ${ boundingBox.height }`)\n    for (const k in attrs) {\n      svgEl.setAttribute(k, attrs[k])\n    }\n    return svgEl\n  }\n\n  static createFilter(id: string, attrs: { [key: string]: string } = {}): SVGFilterElement\n  {\n    const filter = document.createElementNS(XMLNS, \"filter\")\n    filter.id = id\n    for (const k in attrs) {\n      filter.setAttribute(k, attrs[k])\n    }\n    return filter\n  }\n\n  static createDefs(): SVGDefsElement\n  {\n    return document.createElementNS(XMLNS, \"defs\")\n  }\n\n  static createMarker(id: string, attrs: { [key: string]: string } = {}): SVGMarkerElement\n  {\n    const marker = document.createElementNS(XMLNS, \"marker\")\n    marker.setAttribute(\"id\", id)\n    for (const k in attrs) {\n      marker.setAttribute(k, attrs[k])\n    }\n    return marker\n  }\n\n  static createComponentTransfert(): SVGFEComponentTransferElement\n  {\n    return document.createElementNS(XMLNS, \"feComponentTransfer\")\n  }\n\n  static createDropShadow({ dx = 0, dy = 0, deviation = 0, color = \"#3e68ff\", opacity = 1 }): SVGFEDropShadowElement\n  {\n    const shadow = document.createElementNS(XMLNS, \"feDropShadow\")\n    shadow.setAttribute(\"dx\", dx.toString())\n    shadow.setAttribute(\"dy\", dy.toString())\n    shadow.setAttribute(\"stdDeviation\", deviation.toString())\n    shadow.setAttribute(\"flood-color\", color)\n    shadow.setAttribute(\"flood-opacity\", opacity.toString())\n    return shadow\n  }\n\n  static createTransfertFunctionTable(type: \"feFuncA\" | \"feFuncB\" | \"feFuncG\" | \"feFuncR\", values: string): SVGFEFuncAElement\n  {\n    const feFunc = document.createElementNS(XMLNS, type)\n    feFunc.setAttribute(\"type\", \"table\")\n    feFunc.setAttribute(\"tableValues\", values)\n    return feFunc\n  }\n\n  static createGroup(attrs: { [key: string]: string } = {}): SVGGElement\n  {\n    const groupEl = document.createElementNS(XMLNS, \"g\")\n    for (const k in attrs) {\n      groupEl.setAttribute(k, attrs[k])\n    }\n    return groupEl\n  }\n\n  static createLine(p1: TPoint, p2: TPoint, attrs: { [key: string]: string } = {}): SVGLineElement\n  {\n    const lineEl = document.createElementNS(XMLNS, \"line\")\n    lineEl.setAttribute(\"x1\", p1.x.toString())\n    lineEl.setAttribute(\"y1\", p1.y.toString())\n    lineEl.setAttribute(\"x2\", p2.x.toString())\n    lineEl.setAttribute(\"y2\", p2.y.toString())\n    for (const k in attrs) {\n      lineEl.setAttribute(k, attrs[k])\n    }\n    return lineEl\n  }\n\n  static createCircle(p: TPoint, r: number, attrs: { [key: string]: string } = {}): SVGCircleElement\n  {\n    const circleEl = document.createElementNS(XMLNS, \"circle\")\n    circleEl.setAttribute(\"cx\", p.x.toString())\n    circleEl.setAttribute(\"cy\", p.y.toString())\n    circleEl.setAttribute(\"r\", r.toString())\n    for (const k in attrs) {\n      circleEl.setAttribute(k, attrs[k])\n    }\n    return circleEl\n  }\n\n  static createPath(attrs: { [key: string]: string } = {}): SVGPathElement\n  {\n    const pathEl = document.createElementNS(XMLNS, \"path\")\n    for (const k in attrs) {\n      pathEl.setAttribute(k, attrs[k])\n    }\n    return pathEl\n  }\n\n  static createPolygon(points: number[], attrs: { [key: string]: string } = {}): SVGPolylineElement\n  {\n    const polygonEl = document.createElementNS(XMLNS, \"polygon\")\n    polygonEl.setAttribute(\"points\", points.join(\",\"))\n    for (const k in attrs) {\n      polygonEl.setAttribute(k, attrs[k])\n    }\n    return polygonEl\n  }\n\n  static createRect(box: TBox, attrs: { [key: string]: string } = {}): SVGRectElement\n  {\n    const rectEl = document.createElementNS(XMLNS, \"rect\")\n    rectEl.setAttribute(\"x\", box.x.toString())\n    rectEl.setAttribute(\"y\", box.y.toString())\n    rectEl.setAttribute(\"width\", box.width.toString())\n    rectEl.setAttribute(\"height\", box.height.toString())\n    for (const k in attrs) {\n      rectEl.setAttribute(k, attrs[k])\n    }\n    return rectEl\n  }\n\n  static createTSpan(text: string, attrs: { [key: string]: string } = {}): SVGTSpanElement\n  {\n    const tSpanEl = document.createElementNS(XMLNS, \"tspan\")\n    tSpanEl.textContent = text\n    for (const k in attrs) {\n      tSpanEl.setAttribute(k, attrs[k])\n    }\n    return tSpanEl\n  }\n\n  static createForeignObject(box: TBox, node: HTMLElement, attrs: { [key: string]: string } = {}): SVGForeignObjectElement\n  {\n    const objEl = document.createElementNS(XMLNS, \"foreignObject\")\n    objEl.setAttribute(\"x\", box.x.toString())\n    objEl.setAttribute(\"y\", box.y.toString())\n    objEl.setAttribute(\"width\", box.width.toString())\n    objEl.setAttribute(\"height\", box.height.toString())\n    for (const k in attrs) {\n      objEl.setAttribute(k, attrs[k])\n    }\n    objEl.appendChild(node)\n    return objEl\n  }\n\n  static createText(p: TPoint, text: string, attrs: { [key: string]: string } = {}): SVGTextElement\n  {\n    const textEl = document.createElementNS(XMLNS, \"text\")\n    textEl.textContent = text\n    textEl.setAttribute(\"x\", p.x.toString())\n    textEl.setAttribute(\"y\", p.y.toString())\n    for (const k in attrs) {\n      textEl.setAttribute(k, attrs[k])\n    }\n    return textEl\n  }\n}\n","import { EdgeDecoration, EdgeKind, IIEdgeArc, IIEdgeLine, IIEdgePolyLine, TIIEdge } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { SVGRendererConst } from \"./SVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererEdgeUtil\n{\n  static getLinePath(line: IIEdgeLine): string\n  {\n    return `M ${ line.start.x } ${ line.start.y } L ${ line.end.x } ${ line.end.y }`\n  }\n\n  static getPolyLinePath(line: IIEdgePolyLine): string\n  {\n    let path = `M ${ line.vertices[0].x } ${ line.vertices[0].y }`\n    for (let i = 0; i < line.vertices.length; i++) {\n      path += ` L ${ line.vertices[i].x } ${ line.vertices[i].y }`\n    }\n    return path\n  }\n\n  static getArcPath(arc: IIEdgeArc): string\n  {\n    let path = `M ${ arc.vertices[0].x } ${ arc.vertices[0].y } Q`\n    for (let i = 0; i < arc.vertices.length; i++) {\n      path += ` ${ arc.vertices[i].x } ${ arc.vertices[i].y }`\n    }\n    return path\n  }\n\n  static getSVGPath(edge: TIIEdge): string\n  {\n    switch (edge.kind) {\n      case EdgeKind.Line:\n        return SVGRendererEdgeUtil.getLinePath(edge)\n      case EdgeKind.PolyEdge:\n        return SVGRendererEdgeUtil.getPolyLinePath(edge)\n      case EdgeKind.Arc:\n        return SVGRendererEdgeUtil.getArcPath(edge)\n      default:\n        throw new Error(`Can't getSVGPath for edge cause kind is unknow: \"${ JSON.stringify(edge) }\"`)\n    }\n  }\n\n  static getSVGElement(edge: TIIEdge): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": edge.id,\n      \"type\": edge.type,\n      \"kind\": edge.kind,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    if (edge.selected) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.selectionFilterId })`\n    }\n    if (edge.deleting) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.removalFilterId })`\n    }\n    const group = SVGBuilder.createGroup(attrs)\n\n    const pathAttrs: { [key: string]: string } = {\n      \"fill\": \"transparent\",\n      \"stroke\": edge.style.color || DefaultStyle.color!,\n      \"stroke-width\": (edge.style.width || DefaultStyle.width).toString(),\n      \"d\": SVGRendererEdgeUtil.getSVGPath(edge),\n    }\n    if (edge.style.opacity) {\n      pathAttrs[\"opacity\"] = edge.style.opacity.toString()\n    }\n\n    if (edge.startDecoration === EdgeDecoration.Arrow) {\n      pathAttrs[\"marker-start\"] = `url(#${ SVGRendererConst.arrowHeadStartMarker })`\n    }\n    if (edge.endDecoration === EdgeDecoration.Arrow) {\n      pathAttrs[\"marker-end\"] = `url(#${ SVGRendererConst.arrowHeadEndMaker })`\n    }\n    group.appendChild(SVGBuilder.createPath(pathAttrs))\n    return group\n  }\n\n\n}\n","import { IIEraser, TPointer } from \"../../symbol\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererEraserUtil\n{\n  static getSVGPath(eraser: IIEraser): string\n  {\n    if (eraser.pointers.length < 1) return \"\"\n\n    const firstPoint = eraser.pointers.at(0) as TPointer\n\n    const startPath = `M ${ firstPoint.x } ${ firstPoint.y }`\n\n    if (eraser.pointers.length === 1) {\n      const strokeWith = eraser.style.width || 4\n      return `${startPath} L ${ firstPoint.x  + strokeWith / 2 } ${ firstPoint.y }`\n    }\n\n    const middlePoints = eraser.pointers.slice(1)\n\n    return middlePoints.reduce((acc, point) => {\n      return `${ acc } L ${ point.x } ${ point.y }`\n    }, startPath)\n  }\n\n  static getSVGElement(eraser: IIEraser): SVGPathElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": eraser.id,\n      \"type\": \"eraser\",\n      \"stroke-width\": \"12\",\n      \"stroke\": \"grey\",\n      \"opacity\": \"0.2\",\n      \"shadowBlur\": \"5\",\n      \"stroke-linecap\": \"round\",\n      \"fill\": \"transparent\",\n      \"d\": SVGRendererEraserUtil.getSVGPath(eraser)\n    }\n    return SVGBuilder.createPath(attrs)\n  }\n\n}","import { DecoratorKind, IIDecorator, RecognizedKind, SymbolType, TBox, TIISymbol } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererDecoratorUtil\n{\n  static getSVGElement(decorator: IIDecorator, symbol: TIISymbol): SVGGeometryElement | undefined\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": decorator.id,\n      \"type\": \"decorator\",\n      \"kind\": decorator.kind,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    if (decorator.style.opacity) {\n      attrs[\"opacity\"] = decorator.style.opacity.toString()\n    }\n    if (symbol.deleting) {\n      attrs[\"opacity\"] = ((decorator.style.opacity || 1) * 0.5).toString()\n    }\n\n    let element: SVGGeometryElement | undefined\n\n    switch (decorator.kind) {\n      case DecoratorKind.Highlight: {\n        attrs[\"opacity\"] = symbol.deleting ? \"0.25\" : \"0.5\"\n        attrs[\"stroke\"] = \"transparent\"\n        attrs[\"fill\"] = decorator.style.color || DefaultStyle.color!\n        const boundingBox: TBox = {\n          x: symbol.bounds.x - +(symbol.style.width || DefaultStyle.width),\n          y: symbol.bounds.y - +(symbol.style.width || DefaultStyle.width),\n          height: symbol.bounds.height + +(symbol.style.width || DefaultStyle.width) * 2,\n          width: symbol.bounds.width + +(symbol.style.width || DefaultStyle.width) * 2,\n        }\n        element = SVGBuilder.createRect(boundingBox, attrs)\n        break\n      }\n      case DecoratorKind.Surround: {\n        attrs[\"fill\"] = \"transparent\"\n        attrs[\"stroke\"] = decorator.style.color || DefaultStyle.color!\n        attrs[\"stroke-width\"] = (decorator.style.width || DefaultStyle.width).toString()\n        const boundingBox: TBox = {\n          x: symbol.bounds.x - +(symbol.style.width || DefaultStyle.width),\n          y: symbol.bounds.y - +(symbol.style.width || DefaultStyle.width),\n          height: symbol.bounds.height + +(symbol.style.width || DefaultStyle.width) * 2,\n          width: symbol.bounds.width + +(symbol.style.width || DefaultStyle.width) * 2,\n        }\n        element = SVGBuilder.createRect(boundingBox, attrs)\n        break\n      }\n      case DecoratorKind.Strikethrough: {\n        attrs[\"fill\"] = \"transparent\"\n        attrs[\"stroke\"] = decorator.style.color || DefaultStyle.color!\n        attrs[\"stroke-width\"] = (decorator.style.width || DefaultStyle.width).toString()\n        const p1 = {\n          x: symbol.bounds.xMin,\n          y: symbol.bounds.yMid\n        }\n        const p2 = {\n          x: symbol.bounds.xMax,\n          y: symbol.bounds.yMid\n        }\n        if (symbol.type === SymbolType.Recognized && symbol.kind === RecognizedKind.Text) {\n          p1.y = symbol.baseline - symbol.xHeight / 2\n          p2.y = symbol.baseline - symbol.xHeight / 2\n        }\n        element = SVGBuilder.createLine(p1, p2, attrs)\n        break\n      }\n      case DecoratorKind.Underline: {\n        attrs[\"fill\"] = \"transparent\"\n        attrs[\"stroke\"] = decorator.style.color || DefaultStyle.color!\n        attrs[\"stroke-width\"] = (decorator.style.width || DefaultStyle.width).toString()\n        const p1 = {\n          x: symbol.bounds.xMin,\n          y: symbol.bounds.yMax + +(symbol.style.width || DefaultStyle.width)\n        }\n        const p2 = {\n          x: symbol.bounds.xMax,\n          y: symbol.bounds.yMax + +(symbol.style.width || DefaultStyle.width)\n        }\n        if (symbol.type === SymbolType.Recognized && symbol.kind === RecognizedKind.Text) {\n          p1.y = symbol.baseline + symbol.xHeight / 2\n          p2.y = symbol.baseline + symbol.xHeight / 2\n        }\n        element = SVGBuilder.createLine(p1, p2, attrs)\n        break\n      }\n    }\n\n    return element\n  }\n}","import { IIShapeCircle, IIShapeEllipse, IIShapePolygon, ShapeKind, TIIShape } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { convertRadianToDegree } from \"../../utils\"\nimport { SVGRendererConst } from \"./SVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererShapeUtil\n{\n  static getPolygonePath(polygon: IIShapePolygon): string\n  {\n    let path = `M ${polygon.points[0].x} ${polygon.points[0].y}`\n    for (let i = 1; i < polygon.points.length; i++) {\n      path += ` L ${polygon.points[i].x} ${polygon.points[i].y}`\n    }\n    return path + \" Z\"\n  }\n\n  static getCirclePath(circle: IIShapeCircle): string\n  {\n    return `M ${circle.center.x - circle.radius} ${circle.center.y} a ${circle.radius} ${circle.radius} 0 1 1 ${circle.radius * 2} 0 a ${circle.radius} ${circle.radius} 0 1 1 -${circle.radius * 2} 0 Z`\n  }\n\n  static getEllipsePath(ellipse: IIShapeEllipse): string\n  {\n    return `M ${ellipse.center.x - ellipse.radiusX} ${ellipse.center.y} a ${ellipse.radiusX} ${ellipse.radiusY} 0 1 1 ${ellipse.radiusX * 2} 0 a ${ellipse.radiusX} ${ellipse.radiusY} 0 1 1 -${ellipse.radiusX * 2} 0 Z`\n  }\n\n  static getSVGPath(shape: TIIShape): string\n  {\n    switch(shape.kind) {\n      case ShapeKind.Polygon:\n        return SVGRendererShapeUtil.getPolygonePath(shape as IIShapePolygon)\n      case ShapeKind.Circle:\n        return SVGRendererShapeUtil.getCirclePath(shape as IIShapeCircle)\n      case ShapeKind.Ellipse:\n        return SVGRendererShapeUtil.getEllipsePath(shape as IIShapeEllipse)\n      default:\n        throw new Error(`Can't getSVGPath for shape cause kind is unknow: \"${ JSON.stringify(shape) }\"`)\n    }\n  }\n\n  static getSVGElement(shape: TIIShape): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": shape.id,\n      \"type\": shape.type,\n      \"kind\": shape.kind,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    if (shape.selected) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.selectionFilterId })`\n    }\n    if (shape.deleting) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.removalFilterId })`\n    }\n\n    const group = SVGBuilder.createGroup(attrs)\n\n    const pathAttrs: { [key: string]: string } = {\n      \"fill\": shape.style.fill || \"transparent\",\n      \"stroke\": shape.style.color || DefaultStyle.color!,\n      \"stroke-width\": (shape.style.width || DefaultStyle.width).toString(),\n      \"d\": SVGRendererShapeUtil.getSVGPath(shape),\n    }\n    if (shape.style.opacity) {\n      pathAttrs[\"opacity\"] = shape.style.opacity.toString()\n    }\n    if (shape.kind === ShapeKind.Ellipse) {\n      pathAttrs.transform = `rotate(${ convertRadianToDegree(shape.orientation) }, ${shape.center.x}, ${shape.center.y})`\n    }\n\n    group.appendChild(SVGBuilder.createPath(pathAttrs))\n\n    return group\n  }\n}\n","import { DecoratorKind, IIStroke, TPointer } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { computeAngleAxeRadian, computeLinksPointers, computeMiddlePointer } from \"../../utils\"\nimport { SVGRendererDecoratorUtil } from \"./SVGRendererDecoratorUtil\"\nimport { SVGRendererConst } from \"./SVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererStrokeUtil\n{\n\n  protected static getArcPath(center: TPointer, radius: number): string\n  {\n    const svgPath = [\n      `M ${ center.x } ${ center.y }`,\n      `m ${ -radius } 0`,\n      `a ${ radius } ${ radius } 0 1 0 ${ radius * 2 } 0`,\n      `a ${ radius } ${ radius } 0 1 0 ${ -(radius * 2) } 0`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected static getLinePath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, end), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x } ${ linkPoints1[0].y }`,\n      `L ${ linkPoints2[0].x } ${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x } ${ linkPoints2[1].y }`,\n      `L ${ linkPoints1[1].x } ${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected static getFinalPath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const ARCSPLIT = 6\n    const angle = computeAngleAxeRadian(begin, end)\n    const linkPoints = computeLinksPointers(end, angle, width)\n    const parts = [`M ${ linkPoints[0].x } ${ linkPoints[0].y }`]\n    for (let i = 1; i <= ARCSPLIT; i++) {\n      const newAngle = angle - (i * (Math.PI / ARCSPLIT))\n      const x = +(end.x - (end.p * width * Math.sin(newAngle))).toFixed(3)\n      const y = +(end.y + (end.p * width * Math.cos(newAngle))).toFixed(3)\n      parts.push(`L ${ x } ${ y }`)\n    }\n    const svgPath = parts.join(\" \")\n    return svgPath\n  }\n\n  protected static getQuadraticPath(begin: TPointer, end: TPointer, central: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, central), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(central, end), width)\n    const linkPoints3 = computeLinksPointers(central, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x } ${ linkPoints1[0].y }`,\n      `Q ${ linkPoints3[0].x } ${ linkPoints3[0].y } ${ linkPoints2[0].x } ${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x } ${ linkPoints2[1].y }`,\n      `Q ${ linkPoints3[1].x } ${ linkPoints3[1].y } ${ linkPoints1[1].x } ${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  static getSVGPath(stroke: IIStroke): string\n  {\n    const STROKE_LENGTH = stroke.pointers.length\n    if (!STROKE_LENGTH) return \"\"\n    const STROKE_WIDTH = (stroke.style.width as number)\n    const NB_QUADRATICS = STROKE_LENGTH - 2\n    const firstPoint = stroke.pointers[0]\n\n    const parts = []\n    if (STROKE_LENGTH < 3) {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * 0.6))\n    } else {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * firstPoint.p))\n      parts.push(this.getLinePath(firstPoint, computeMiddlePointer(firstPoint, stroke.pointers[1]), STROKE_WIDTH))\n\n      for (let i = 0; i < NB_QUADRATICS; i++) {\n        const begin = computeMiddlePointer(stroke.pointers[i], stroke.pointers[i + 1])\n        const end = computeMiddlePointer(stroke.pointers[i + 1], stroke.pointers[i + 2])\n        const central = stroke.pointers[i + 1]\n        parts.push(this.getQuadraticPath(begin, end, central, STROKE_WIDTH)\n        )\n      }\n      const beforeLastPoint = stroke.pointers[STROKE_LENGTH - 2]\n      const lastPoint = stroke.pointers[STROKE_LENGTH - 1]\n      parts.push(this.getLinePath(computeMiddlePointer(beforeLastPoint, lastPoint), lastPoint, STROKE_WIDTH))\n      parts.push(this.getFinalPath(beforeLastPoint, lastPoint, STROKE_WIDTH))\n    }\n    return parts.join(\" \")\n  }\n\n  static getSVGElement(stroke: IIStroke): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": stroke.id,\n      \"type\": \"stroke\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n    }\n    if (stroke.selected) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.selectionFilterId })`\n    }\n    if (stroke.deleting) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.removalFilterId })`\n    }\n\n    const strokeGroup = SVGBuilder.createGroup(attrs)\n\n    const strokeAttrs: { [key: string]: string } = {\n      \"fill\": stroke.style.color || DefaultStyle.color!,\n      \"stroke-width\": stroke.style.width.toString(),\n      \"d\": SVGRendererStrokeUtil.getSVGPath(stroke)\n    }\n    if (stroke.style.opacity) {\n      strokeAttrs.opacity = stroke.style.opacity.toString()\n    }\n    strokeGroup.append(SVGBuilder.createPath(strokeAttrs))\n\n    stroke.decorators.forEach(d =>\n    {\n      const deco = SVGRendererDecoratorUtil.getSVGElement(d, stroke)\n      if (deco) {\n        if (d.kind === DecoratorKind.Highlight) {\n          strokeGroup.prepend(deco)\n        }\n        else {\n          strokeGroup.append(deco)\n        }\n      }\n    })\n\n    return strokeGroup\n  }\n\n}","import { DecoratorKind, IIText } from \"../../symbol\"\nimport { SVGRendererDecoratorUtil } from \"./SVGRendererDecoratorUtil\"\nimport { SVGRendererConst } from \"./SVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererTextUtil\n{\n  static getSVGElement(text: IIText): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": text.id,\n      \"type\": text.type,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n      \"style\": SVGRendererConst.noSelection,\n    }\n    if (text.style.opacity) {\n      attrs.opacity = text.style.opacity.toString()\n    }\n    if (text.rotation) {\n      attrs.transform = `rotate(${ text.rotation.degree }, ${ text.rotation.center.x }, ${ text.rotation.center.y })`\n    }\n    if (text.selected) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.selectionFilterId })`\n    }\n    if (text.deleting) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.removalFilterId })`\n    }\n\n    const textGroup = SVGBuilder.createGroup(attrs)\n\n    const textElement = SVGBuilder.createText(text.point, \"\")\n\n    text.chars.forEach(c =>\n    {\n      const attrs: { [key: string]: string } = {\n        id: c.id,\n        fill: c.color,\n        \"font-size\": `${ c.fontSize }px`,\n        \"font-weight\": c.fontWeight.toString(),\n      }\n      textElement.appendChild(SVGBuilder.createTSpan(c.label, attrs))\n    })\n    textGroup.append(textElement)\n\n    text.decorators.forEach(d =>\n    {\n      const deco = SVGRendererDecoratorUtil.getSVGElement(d, text)\n      if (deco) {\n        if (d.kind === DecoratorKind.Highlight) {\n          textGroup.prepend(deco)\n        }\n        else {\n          textGroup.append(deco)\n        }\n      }\n    })\n\n    return textGroup\n  }\n}","import { DecoratorKind, RecognizedKind, TIIRecognized } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { SVGRendererDecoratorUtil } from \"./SVGRendererDecoratorUtil\"\nimport { SVGRendererStrokeUtil } from \"./SVGRendererStrokeUtil\"\nimport { SVGRendererConst } from \"./SVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererRecognizedUtil\n{\n  static getSVGElement(recognizedSymbol: TIIRecognized): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": recognizedSymbol.id,\n      \"type\": recognizedSymbol.type,\n      \"kind\": recognizedSymbol.kind,\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n      \"fill\": recognizedSymbol.style.color || DefaultStyle.color,\n      \"stroke-width\": (recognizedSymbol.style.width || DefaultStyle.width).toString(),\n    }\n    if (recognizedSymbol.style.opacity) {\n      attrs[\"opacity\"] = recognizedSymbol.style.opacity.toString()\n    }\n    if (recognizedSymbol.selected) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.selectionFilterId })`\n    }\n    if (recognizedSymbol.deleting) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.removalFilterId })`\n    }\n\n    const groupEl = SVGBuilder.createGroup(attrs)\n\n    recognizedSymbol.strokes.forEach(s =>\n    {\n      groupEl.append(SVGRendererStrokeUtil.getSVGElement(s))\n    })\n\n    if (recognizedSymbol.kind === RecognizedKind.Text) {\n      recognizedSymbol.decorators.forEach(d =>\n      {\n        const deco = SVGRendererDecoratorUtil.getSVGElement(d, recognizedSymbol)\n        if (deco) {\n          if (d.kind === DecoratorKind.Highlight) {\n            groupEl.prepend(deco)\n          }\n          else {\n            groupEl.append(deco)\n          }\n        }\n      })\n    }\n\n    return groupEl\n  }\n\n}","import { DecoratorKind, IIEraser, IISymbolGroup, SymbolType, TIISymbol } from \"../../symbol\"\nimport { DefaultStyle } from \"../../style\"\nimport { SVGRendererDecoratorUtil } from \"./SVGRendererDecoratorUtil\"\nimport { SVGRendererEdgeUtil } from \"./SVGRendererEdgeUtil\"\nimport { SVGRendererShapeUtil } from \"./SVGRendererShapeUtil\"\nimport { SVGRendererStrokeUtil } from \"./SVGRendererStrokeUtil\"\nimport { SVGRendererConst } from \"./SVGRendererConst\"\nimport { SVGBuilder } from \"./SVGBuilder\"\nimport { SVGRendererTextUtil } from \"./SVGRendererTextUtil\"\nimport { SVGRendererRecognizedUtil } from \"./SVGRendererRecognizedUtil\"\n\n/**\n * @group Renderer\n */\nexport class SVGRendererGroupUtil\n{\n\n  static getChildElement(symbol: TIISymbol | IIEraser): SVGGraphicsElement | undefined\n  {\n    let element: SVGGraphicsElement | undefined\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        element = SVGRendererStrokeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Shape:\n        element = SVGRendererShapeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Edge:\n        element = SVGRendererEdgeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Text:\n        element = SVGRendererTextUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Group:\n        element = SVGRendererGroupUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Recognized:\n        element = SVGRendererRecognizedUtil.getSVGElement(symbol)\n        break\n    }\n    return element\n  }\n\n  static getSVGElement(symbolGroup: IISymbolGroup): SVGGraphicsElement\n  {\n    const attrs: { [key: string]: string } = {\n      \"id\": symbolGroup.id,\n      \"type\": \"group\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n      \"fill\": symbolGroup.style.color || DefaultStyle.color!,\n      \"stroke-width\": (symbolGroup.style.width || DefaultStyle.width).toString(),\n    }\n    if (symbolGroup.style.opacity) {\n      attrs[\"opacity\"] = symbolGroup.style.opacity.toString()\n    }\n    if (symbolGroup.selected) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.selectionFilterId })`\n    }\n    if (symbolGroup.deleting) {\n      attrs[\"filter\"] = `url(#${ SVGRendererConst.removalFilterId })`\n    }\n\n    const groupEl = SVGBuilder.createGroup(attrs)\n\n    symbolGroup.children.forEach(sym =>\n    {\n      groupEl.append(SVGRendererGroupUtil.getChildElement(sym)!)\n    })\n\n    symbolGroup.decorators.forEach(d =>\n    {\n      const deco = SVGRendererDecoratorUtil.getSVGElement(d, symbolGroup)\n      if (deco) {\n        if (d.kind === DecoratorKind.Highlight) {\n          groupEl.prepend(deco)\n        }\n        else {\n          groupEl.append(deco)\n        }\n      }\n    })\n\n    return groupEl\n  }\n\n}","import { SvgElementRole } from \"../../Constants\"\nimport { getClosestPoints } from \"../../utils\"\nimport { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { TIISymbol, TPoint, TBox, Box, IIEraser, SymbolType } from \"../../symbol\"\nimport { TIIRendererConfiguration } from \"../RendererConfiguration\"\nimport { SVGRendererConst } from \"./SVGRendererConst\"\nimport { SVGRendererEdgeUtil } from \"./SVGRendererEdgeUtil\"\nimport { SVGRendererEraserUtil } from \"./SVGRendererEraserUtil\"\nimport { SVGRendererGroupUtil } from \"./SVGRendererGroupUtil\"\nimport { SVGRendererShapeUtil } from \"./SVGRendererShapeUtil\"\nimport { SVGRendererStrokeUtil } from \"./SVGRendererStrokeUtil\"\nimport { SVGRendererTextUtil } from \"./SVGRendererTextUtil\"\nimport { SVGRendererRecognizedUtil } from \"./SVGRendererRecognizedUtil\"\nimport { SVGBuilder } from \"./SVGBuilder\"\n\n/**\n * @group Renderer\n */\nexport class SVGRenderer {\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n  groupGuidesId = \"guides-wrapper\"\n\n  configuration: TIIRendererConfiguration\n  parent!: HTMLElement\n  layer!: SVGSVGElement\n  definitionGroup!: SVGGElement\n\n  verticalGuides: number[] = []\n  horizontalGuides: number[] = []\n\n  constructor(configuration: TIIRendererConfiguration) {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n  }\n\n  protected initLayer(): void {\n    const width = Math.max(this.configuration.minWidth, this.parent.clientWidth)\n    const height = Math.max(this.configuration.minHeight, this.parent.clientHeight)\n    this.layer = SVGBuilder.createLayer({ x: 0, y: 0, width, height })\n    this.layer.style.setProperty(\"height\", \"auto\")\n    this.layer.style.setProperty(\"width\", \"auto\")\n    this.layer.appendChild(this.createSVGTools())\n    this.parent.style.setProperty(\"overflow\", \"auto\")\n    this.parent.appendChild(this.layer)\n  }\n\n  protected createDefs(): SVGDefsElement {\n    const defs = SVGBuilder.createDefs()\n\n    const SIZE = 5\n    const REFX = SIZE - 1, REFY = SIZE / 2\n    const arrowHeadMarkerAttrs = {\n      style: SVGRendererConst.noSelection,\n      fill: \"context-stroke\",\n      markerWidth: SIZE.toString(),\n      markerHeight: SIZE.toString(),\n      refX: REFX.toString(),\n      refY: REFY.toString(),\n    }\n\n    const arrowHeadStart = SVGBuilder.createMarker(SVGRendererConst.arrowHeadStartMarker, { ...arrowHeadMarkerAttrs, orient: \"auto-start-reverse\" })\n    arrowHeadStart.appendChild(SVGBuilder.createPolygon([0, 0, SIZE, REFY, 0, SIZE], arrowHeadMarkerAttrs))\n    defs.appendChild(arrowHeadStart)\n\n    const arrowHeadEnd = SVGBuilder.createMarker(SVGRendererConst.arrowHeadEndMaker, { ...arrowHeadMarkerAttrs, orient: \"auto\" })\n    arrowHeadEnd.appendChild(SVGBuilder.createPolygon([0, 0, SIZE, REFY, 0, SIZE], arrowHeadMarkerAttrs))\n    defs.appendChild(arrowHeadEnd)\n\n    const crossMarkerAttrs = {\n      style: SVGRendererConst.noSelection,\n      markerWidth: \"5\",\n      markerHeight: \"5\",\n      refX: \"0\",\n      refY: \"0\",\n      viewBox: \"-5 -5 10 10\"\n    }\n    const cross = SVGBuilder.createMarker(SVGRendererConst.crossMarker, crossMarkerAttrs)\n    cross.appendChild(SVGBuilder.createPath({ d: \"M -4,-4 L 4,4 M -4,4 L 4,-4\", stroke: \"white\", \"stroke-width\": \"3\" }))\n    cross.appendChild(SVGBuilder.createPath({ d: \"M -4,-4 L 4,4 M -4,4 L 4,-4\", stroke: \"context-stroke\", \"stroke-width\": \"2\" }))\n    defs.appendChild(cross)\n\n    return defs\n  }\n\n  protected createFilters(): SVGGElement {\n    const filtersGroup = SVGBuilder.createGroup({ id: \"definition-group\" })\n    const removalFilter = SVGBuilder.createFilter(SVGRendererConst.removalFilterId, { filterUnits: \"userSpaceOnUse\" })\n    const bfeComponentTransfer = SVGBuilder.createComponentTransfert()\n    const bfeFuncA = SVGBuilder.createTransfertFunctionTable(\"feFuncA\", \"0 0.25\")\n    bfeComponentTransfer.appendChild(bfeFuncA)\n    removalFilter.appendChild(bfeComponentTransfer)\n    filtersGroup.appendChild(removalFilter)\n\n    const selectionFilter = SVGBuilder.createFilter(SVGRendererConst.selectionFilterId, { filterUnits: \"userSpaceOnUse\" })\n    selectionFilter.appendChild(SVGBuilder.createDropShadow({ dx: -1, dy: -1, deviation: 1 }))\n    filtersGroup.appendChild(selectionFilter)\n\n    return filtersGroup\n  }\n\n  protected drawGuides(): void {\n    this.verticalGuides = []\n    this.horizontalGuides = []\n    const height = Number(this.layer.getAttribute(\"height\")?.replace(\"px\", \"\"))\n    const width = Number(this.layer.getAttribute(\"width\")?.replace(\"px\", \"\"))\n    const offSet = this.configuration.guides.gap\n    const subOffSet = this.configuration.guides.gap / 5\n    const attrs = {\n      id: this.groupGuidesId,\n      stroke: \"grey\",\n      opacity: \"0.5\",\n      style: SVGRendererConst.noSelection,\n      role: SvgElementRole.Guide\n    }\n    const guidesGroup = SVGBuilder.createGroup(attrs)\n    switch (this.configuration.guides.type) {\n      case \"line\":\n        for (let y = offSet; y < height; y += offSet) {\n          const begin: TPoint = { x: offSet, y }\n          const end: TPoint = { x: width - offSet, y }\n          this.horizontalGuides.push(y)\n          const svgLine = SVGBuilder.createLine(begin, end, { \"stroke-width\": \"1\", style: SVGRendererConst.noSelection })\n          guidesGroup.appendChild(svgLine)\n        }\n        break\n      case \"grid\":\n        for (let y = 0; y < height; y += offSet) {\n          const begin: TPoint = { x: 0, y }\n          const end: TPoint = { x: width, y }\n          const svgLine = SVGBuilder.createLine(begin, end, { \"stroke-width\": \"1\", style: SVGRendererConst.noSelection })\n          guidesGroup.appendChild(svgLine)\n          this.horizontalGuides.push(y)\n          for (let subY = y + subOffSet; subY < y + offSet; subY += subOffSet) {\n            this.horizontalGuides.push(subY)\n            const svgLine = SVGBuilder.createLine({ x: 0, y: subY }, { x: width, y: subY }, { \"stroke-width\": \"0.25\", style: SVGRendererConst.noSelection })\n            guidesGroup.appendChild(svgLine)\n          }\n        }\n        for (let x = 0; x < width; x += offSet) {\n          const begin: TPoint = { x, y: 0 }\n          const end: TPoint = { x, y: height }\n          const svgLine = SVGBuilder.createLine(begin, end, { \"stroke-width\": \"1\", style: SVGRendererConst.noSelection })\n          guidesGroup.appendChild(svgLine)\n          this.verticalGuides.push(x)\n          for (let subX = x + subOffSet; subX < x + offSet; subX += subOffSet) {\n            this.verticalGuides.push(subX)\n            const svgLine = SVGBuilder.createLine({ x: subX, y: 0 }, { x: subX, y: height }, { \"stroke-width\": \"0.25\", style: SVGRendererConst.noSelection })\n            guidesGroup.appendChild(svgLine)\n          }\n        }\n        break\n      case \"point\":\n        for (let x = offSet; x < width; x += offSet) {\n          this.verticalGuides.push(x)\n          for (let y = offSet; y < height; y += offSet) {\n            this.horizontalGuides.push(y)\n            const svgPoint = SVGBuilder.createCircle({ x, y }, 1)\n            guidesGroup.appendChild(svgPoint)\n          }\n        }\n        break\n      default:\n        this.#logger.error(\"drawGuides\", `Guide type unknown: ${this.configuration.guides.type}`)\n        break\n    }\n    this.horizontalGuides = [...new Set(this.horizontalGuides)]\n    this.verticalGuides = [...new Set(this.verticalGuides)]\n    this.definitionGroup.appendChild(guidesGroup)\n  }\n\n  protected removeGuides(): void {\n    this.verticalGuides = []\n    this.horizontalGuides = []\n    this.layer.querySelector(`#${this.groupGuidesId}`)?.remove()\n  }\n\n  protected createSVGTools(): SVGGElement {\n    this.definitionGroup = SVGBuilder.createGroup({ id: \"definition-group\" })\n    this.definitionGroup.appendChild(this.createDefs())\n    this.definitionGroup.appendChild(this.createFilters())\n    if (this.configuration.guides.enable) {\n      this.drawGuides()\n    }\n    return this.definitionGroup\n  }\n\n  init(element: HTMLElement): void {\n    this.#logger.info(\"init\", { element })\n    this.parent = element\n    this.parent.oncontextmenu = () => false\n    this.initLayer()\n  }\n\n  getAttribute(id: string, name: string): string | undefined | null {\n    const element = this.layer.querySelector(`#${id}`) as HTMLElement | null\n    return element?.getAttribute(name)\n  }\n\n  setAttribute(id: string, name: string, value: string): void {\n    const element = this.layer.querySelector(`#${id}`) as HTMLElement | null\n    element?.setAttribute(name, value)\n  }\n\n  buildElementFromSymbol(symbol: TIISymbol | IIEraser): SVGGraphicsElement | undefined {\n    let element: SVGGraphicsElement | undefined\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        element = SVGRendererStrokeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Eraser:\n        element = SVGRendererEraserUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Shape:\n        element = SVGRendererShapeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Edge:\n        element = SVGRendererEdgeUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Text:\n        element = SVGRendererTextUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Group:\n        element = SVGRendererGroupUtil.getSVGElement(symbol)\n        break\n      case SymbolType.Recognized:\n        element = SVGRendererRecognizedUtil.getSVGElement(symbol)\n        break\n      default:\n        this.#logger.error(\"buildElementFromSymbol\", `symbol unknow: \"${JSON.stringify(symbol)}\"`)\n    }\n    return element\n  }\n\n  prependElement(el: Element): void {\n    this.layer.prepend(el)\n  }\n\n  changeOrderSymbol(symbolToMove: TIISymbol, position: \"first\" | \"last\" | \"forward\" | \"backward\"): void {\n    const moveEl = this.layer.querySelector(`#${symbolToMove.id}`)\n    if (!moveEl) return\n    switch (position) {\n      case \"first\":\n        this.definitionGroup.insertAdjacentElement(\"afterend\", moveEl)\n        break\n      case \"last\":\n        this.layer.insertAdjacentElement(\"beforeend\", moveEl)\n        break\n      case \"forward\":\n        moveEl.nextElementSibling?.insertAdjacentElement(\"afterend\", moveEl)\n        break\n      case \"backward\":\n        if (moveEl.previousElementSibling !== this.definitionGroup) {\n          moveEl.previousElementSibling?.insertAdjacentElement(\"beforebegin\", moveEl)\n        }\n        break\n    }\n  }\n\n  appendElement(el: Element): void {\n    this.layer.appendChild(el)\n  }\n\n  removeElement(id: string): void {\n    this.#logger.debug(\"Element\", { id })\n    const oldStroke = this.layer.querySelector(`#${id}`)\n    if (oldStroke) {\n      oldStroke.remove()\n    }\n  }\n\n  drawSymbol(symbol: TIISymbol | IIEraser): SVGGraphicsElement | undefined {\n    this.#logger.debug(\"drawSymbol\", { symbol })\n    const oldNode = this.layer.querySelector(`#${symbol?.id}`)\n    const svgEl = this.buildElementFromSymbol(symbol)\n\n    if (svgEl) {\n      if (oldNode) {\n        oldNode.replaceWith(svgEl)\n      }\n      else {\n        this.layer.appendChild(svgEl)\n      }\n    }\n    return svgEl\n  }\n\n  replaceSymbol(id: string, symbols: TIISymbol[]): SVGGraphicsElement[] | undefined {\n    this.#logger.debug(\"drawSymbol\", { symbols })\n    const oldNode = this.layer.querySelector(`#${id}`)\n    const elements = symbols.map(s => this.buildElementFromSymbol(s)).filter(x => !!x) as SVGGraphicsElement[]\n\n    if (elements.length) {\n      if (oldNode) {\n        elements.forEach(e => oldNode.insertAdjacentElement(\"beforebegin\", e))\n        oldNode.remove()\n      }\n      else {\n        elements.forEach(e => this.layer.appendChild(e))\n      }\n    }\n    return elements\n  }\n\n  removeSymbol(id: string): void {\n    this.#logger.debug(\"removeSymbol\", { id })\n    this.removeElement(id)\n  }\n\n  drawCircle(point: TPoint, radius: number, attrs: { [key: string]: string } = {}): void {\n    this.#logger.info(\"drawCircle\", { point, radius, attrs })\n    this.layer.appendChild(SVGBuilder.createCircle(point, radius, attrs))\n  }\n\n  drawRect(box: TBox, attrs: { [key: string]: string } = {}): void {\n    this.#logger.info(\"drawRect\", { box, attrs })\n    this.layer.appendChild(SVGBuilder.createRect(box, attrs))\n  }\n\n  drawLine(p1: TPoint, p2: TPoint, attrs: { [key: string]: string } = {}): void {\n    this.#logger.info(\"drawLine\", { p1, p2, attrs })\n    this.layer.appendChild(SVGBuilder.createLine(p1, p2, attrs))\n  }\n\n  drawConnectionBetweenBox(id: string, box1: TBox, box2: TBox, position: \"corners\" | \"sides\", attrs?: { [key: string]: string }): void {\n    let points1: TPoint[] = new Box(box1).corners\n    let points2: TPoint[] = new Box(box2).corners\n    if (position === \"sides\") {\n      points1 = new Box(box1).side\n      points2 = new Box(box2).side\n    }\n    const { p1, p2 } = getClosestPoints(points1, points2)\n    const attrsLine = {\n      id,\n      fill: \"transparent\",\n      style: SVGRendererConst.noSelection,\n      ...attrs\n    }\n    this.drawLine(p1, p2, attrsLine)\n  }\n\n  resize(height: number, width: number): void {\n    this.#logger.info(\"resize\", { height, width })\n    this.layer.setAttribute(\"width\", `${width}px`)\n    this.layer.setAttribute(\"height\", `${height}px`)\n    this.layer.setAttribute(\"viewBox\", `0, 0, ${width}, ${height}`)\n    this.removeGuides()\n    if (this.configuration.guides.enable) {\n      this.drawGuides()\n    }\n  }\n\n  getElementById(id: string): SVGGraphicsElement | null {\n    return this.layer.querySelector(`#${id}`) as SVGGraphicsElement | null\n  }\n\n  getElements({ tagName, attrs }: { tagName?: string, attrs?: { [key: string]: string } }): NodeListOf<Element> {\n    this.#logger.info(\"getElements\", { tagName, attrs })\n    let query = tagName || \"*\"\n    if (attrs) {\n      for (const k in attrs) {\n        query += `[${k}=${attrs[k]}]`\n      }\n    }\n    return this.layer.querySelectorAll(query)\n  }\n\n  clearElements({ tagName, attrs }: { tagName?: string, attrs?: { [key: string]: string } }): void {\n    this.#logger.info(\"clearElements\", { tagName, attrs })\n    this.getElements({ tagName, attrs })\n      .forEach(e => e.remove())\n  }\n\n  clear(): void {\n    this.#logger.info(\"clear\")\n    if (this.layer) {\n      while (this.layer.firstChild) {\n        this.layer.firstChild.remove()\n      }\n      this.layer.appendChild(this.createSVGTools())\n    }\n  }\n\n  destroy(): void {\n    if (this.layer) {\n      this.layer.remove()\n    }\n  }\n}","import { TPointer, TStroke } from \"../../symbol\"\nimport { computeAngleAxeRadian, computeLinksPointers, computeMiddlePointer } from \"../../utils\"\n\n/**\n * @group Renderer\n */\nexport class SVGStroker\n{\n\n  protected getArcPath(center: TPointer, radius: number): string\n  {\n    const svgPath = [\n      `M ${ center.x },${ center.y }`,\n      `m ${ -radius },0`,\n      `a ${ radius },${ radius } 0 1 0 ${ radius * 2 },0`,\n      `a ${ radius },${ radius } 0 1 0 ${ -(radius * 2) },0`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected getLinePath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, end), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x },${ linkPoints1[0].y }`,\n      `L ${ linkPoints2[0].x },${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x },${ linkPoints2[1].y }`,\n      `L ${ linkPoints1[1].x },${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected getFinalPath(begin: TPointer, end: TPointer, width: number): string\n  {\n    const ARCSPLIT = 6\n    const angle = computeAngleAxeRadian(begin, end)\n    const linkPoints = computeLinksPointers(end, angle, width)\n    const parts = [`M ${ linkPoints[0].x },${ linkPoints[0].y }`]\n    for (let i = 1; i <= ARCSPLIT; i++) {\n      const newAngle = angle - (i * (Math.PI / ARCSPLIT))\n      parts.push(`L ${ end.x - (end.p * width * Math.sin(newAngle)) },${ end.y + (end.p * width * Math.cos(newAngle)) }`)\n    }\n    const svgPath = parts.join(\" \")\n    return svgPath\n  }\n\n  protected getQuadraticPath(begin: TPointer, end: TPointer, central: TPointer, width: number): string\n  {\n    const linkPoints1 = computeLinksPointers(begin, computeAngleAxeRadian(begin, central), width)\n    const linkPoints2 = computeLinksPointers(end, computeAngleAxeRadian(central, end), width)\n    const linkPoints3 = computeLinksPointers(central, computeAngleAxeRadian(begin, end), width)\n    const svgPath = [\n      `M ${ linkPoints1[0].x },${ linkPoints1[0].y }`,\n      `Q ${ linkPoints3[0].x },${ linkPoints3[0].y } ${ linkPoints2[0].x },${ linkPoints2[0].y }`,\n      `L ${ linkPoints2[1].x },${ linkPoints2[1].y }`,\n      `Q ${ linkPoints3[1].x },${ linkPoints3[1].y } ${ linkPoints1[1].x },${ linkPoints1[1].y }`\n    ].join(\" \")\n    return svgPath\n  }\n\n  protected buildSVGPath(stroke: TStroke): string\n  {\n    const STROKE_LENGTH = stroke.pointers.length\n    const STROKE_WIDTH = (stroke.style.width as number)\n    const NB_QUADRATICS = STROKE_LENGTH - 2\n    const firstPoint = stroke.pointers[0]\n\n    const parts = []\n    if (STROKE_LENGTH < 3) {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * 0.6))\n    } else {\n      parts.push(this.getArcPath(firstPoint, STROKE_WIDTH * firstPoint.p))\n      parts.push(this.getLinePath(firstPoint, computeMiddlePointer(firstPoint, stroke.pointers[1]), STROKE_WIDTH))\n\n      for (let i = 0; i < NB_QUADRATICS; i++) {\n        const begin = computeMiddlePointer(stroke.pointers[i], stroke.pointers[i + 1])\n        const end = computeMiddlePointer(stroke.pointers[i + 1], stroke.pointers[i + 2])\n        const central = stroke.pointers[i + 1]\n        parts.push(this.getQuadraticPath(begin, end, central, STROKE_WIDTH)\n        )\n      }\n      const beforeLastPoint = stroke.pointers[STROKE_LENGTH - 2]\n      const lastPoint = stroke.pointers[STROKE_LENGTH - 1]\n      parts.push(this.getLinePath(computeMiddlePointer(beforeLastPoint, lastPoint), lastPoint, STROKE_WIDTH))\n      parts.push(this.getFinalPath(beforeLastPoint, lastPoint, STROKE_WIDTH))\n    }\n    return parts.join(\" \")\n  }\n\n  drawStroke(svgElement: SVGElement, stroke: TStroke, attrs?: { name: string, value: string }[]): void\n  {\n    const svgPathElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\")\n    svgPathElement.classList.add(\"pending-stroke\")\n    svgPathElement.setAttribute(\"id\", stroke.id)\n    svgPathElement.setAttribute(\"type\", stroke.pointerType)\n    attrs?.forEach(a =>\n    {\n      svgPathElement.setAttribute(a.name, a.value)\n    })\n    const svgPath = this.buildSVGPath(stroke)\n    svgPathElement.setAttribute(\"d\", `${ svgPath }Z`)\n    svgElement.appendChild(svgPathElement)\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../../logger\"\nimport { Model } from \"../../model\"\nimport { TStroke } from \"../../symbol\"\nimport { TRendererConfiguration } from \"../RendererConfiguration\"\nimport { TUpdatePatch, TUpdatePatchAppendChild, TUpdatePatchInsertBefore, TUpdatePatchRemoveAttribut, TUpdatePatchRemoveChild, TUpdatePatchRemoveElement, TUpdatePatchReplaceAll, TUpdatePatchReplaceELement, TUpdatePatchSetAttribut } from \"../../recognizer\"\nimport { SVGStroker } from \"./SVGStroker\"\n\n/**\n * @group Renderer\n */\nexport class InteractiveInkSSRSVGRenderer\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.RENDERER)\n\n  config: TRendererConfiguration\n  stroker: SVGStroker\n  context!: {\n    parent: HTMLElement\n  }\n\n  constructor(config: TRendererConfiguration)\n  {\n    this.#logger.info(\"constructor\", { config })\n    this.config = config\n    this.stroker = new SVGStroker()\n  }\n\n  init(element: HTMLElement): void\n  {\n    this.#logger.info(\"init\", { element })\n    element.style.fontSize = \"10px\"\n    this.context = {\n      parent: element\n    }\n  }\n\n  protected drawStroke(svgElement: SVGElement, stroke: TStroke)\n  {\n    let style: string\n    if (stroke.pointerType === \"eraser\") {\n      stroke.style.width = 12\n      style = \"fill:grey;stroke:transparent;shadowBlur:5;opacity:0.2;\"\n    } else {\n      style = `fill:${ stroke.style.color };stroke:transparent;`\n    }\n    this.stroker.drawStroke(svgElement, stroke, [{ name: \"style\", value: style }])\n  }\n\n  protected replaceAll(layerName: string, update: TUpdatePatchReplaceAll): void\n  {\n    const oldLayer = this.context.parent.querySelector(`svg[data-layer=\"${ layerName }\"]`) as SVGElement | null\n    oldLayer?.remove()\n    this.context.parent.insertAdjacentHTML(\"beforeend\", update.svg)\n    const layer = this.context.parent.querySelector(`svg[data-layer=\"${ layerName }\"]`) as SVGElement\n    if (layerName === \"MODEL\") {\n      const pendingStrokesGroup = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\")\n      pendingStrokesGroup.id = \"pendingStrokes\"\n      layer.appendChild(pendingStrokesGroup)\n    }\n  }\n\n  protected replaceElement(update: TUpdatePatchReplaceELement): void\n  {\n    const elementToRemove = this.context.parent.querySelector(`#${ update.id }`) as HTMLElement | null\n    if (elementToRemove) {\n      const parent = elementToRemove.parentNode as HTMLElement | null | undefined\n      elementToRemove?.remove()\n      parent?.insertAdjacentHTML(\"beforeend\", update.svg)\n    }\n  }\n\n  protected appendChild(layerName: string, update: TUpdatePatchAppendChild): void\n  {\n    const parentSelector = update.parentId ? `#${ update.parentId }` : `svg[data-layer=\"${ layerName }\"]`\n    const parent = this.context.parent.querySelector(parentSelector) as HTMLElement\n    parent?.insertAdjacentHTML(\"beforeend\", update.svg)\n  }\n\n  protected removeChild(update: TUpdatePatchRemoveChild): void\n  {\n    this.context.parent.querySelector(`#${ update.parentId } > *:nth-child(${ update.index + 1 })`)?.remove()\n  }\n\n  protected removeElement(update: TUpdatePatchRemoveElement): void\n  {\n    const elementToRemove = this.context.parent.querySelector(`#${ update.id }`)\n    if (elementToRemove) {\n      if (update.id.includes(\"s\") || update.id.includes(\"MODEL\")) {\n        elementToRemove.remove()\n      } else {\n        elementToRemove.setAttribute(\"class\", \"removed-stroke\")\n        setTimeout(() =>\n        {\n          elementToRemove?.remove()\n        }, 100)\n      }\n    }\n  }\n\n  protected insertBefore(update: TUpdatePatchInsertBefore): void\n  {\n    const parent = this.context.parent.querySelector(`#${ update.refId }`) as HTMLElement | null\n    parent?.insertAdjacentHTML(\"beforebegin\", update.svg)\n  }\n\n  protected setAttribute(update: TUpdatePatchSetAttribut): void\n  {\n    const selector = update.id ? `#${ update.id }` : \"svg\"\n    const element = this.context.parent.querySelector(selector) as HTMLElement | null\n    element?.setAttribute(update.name, update.value)\n  }\n\n  protected removeAttribute(update: TUpdatePatchRemoveAttribut): void\n  {\n    const selector = update.id ? `#${ update.id }` : \"svg\"\n    const element = this.context.parent.querySelector(selector) as HTMLElement | null\n    element?.removeAttribute(update.name)\n  }\n\n  updateLayer(layerName: string, update: TUpdatePatch): void\n  {\n    this.#logger.info(\"updateLayer\", { layerName, update })\n    switch (update.type) {\n      case \"REPLACE_ALL\":\n        this.replaceAll(layerName, update as TUpdatePatchReplaceAll)\n        break\n      case \"REPLACE_ELEMENT\":\n        this.replaceElement(update as TUpdatePatchReplaceELement)\n        break\n      case \"APPEND_CHILD\":\n        this.appendChild(layerName, update as TUpdatePatchAppendChild)\n        break\n      case \"REMOVE_ELEMENT\":\n        this.removeElement(update as TUpdatePatchRemoveElement)\n        break\n      case \"REMOVE_CHILD\":\n        this.removeChild(update as TUpdatePatchRemoveChild)\n        break\n      case \"INSERT_BEFORE\":\n        this.insertBefore(update as TUpdatePatchInsertBefore)\n        break\n      case \"SET_ATTRIBUTE\":\n        this.setAttribute(update as TUpdatePatchSetAttribut)\n        break\n      case \"REMOVE_ATTRIBUTE\":\n        this.removeAttribute(update as TUpdatePatchRemoveAttribut)\n        break\n      default:\n        this.#logger.warn(\"updateLayer\", `update.type unknow ${update.type}`)\n        break\n    }\n  }\n\n  updatesLayer(layerName: string, updates: TUpdatePatch[]): void\n  {\n    this.#logger.info(\"updatesLayer\", { layerName, updates })\n    updates.forEach(u => this.updateLayer(layerName, u))\n    this.clearPendingStroke()\n  }\n\n  clearPendingStroke(): void\n  {\n    this.#logger.info(\"clearPendingStroke\")\n    const pendingStrokeGroup = this.context.parent.querySelector(\"#pendingStrokes\") as SVGElement\n    if (pendingStrokeGroup) {\n      pendingStrokeGroup.innerHTML = \"\"\n    }\n  }\n\n  drawPendingStroke(stroke: TStroke): void\n  {\n    this.#logger.info(\"drawPendingStroke\", { stroke })\n    if (stroke) {\n      const pendingStrokeGroup = this.context.parent.querySelector(\"#pendingStrokes\") as SVGElement\n      if (pendingStrokeGroup) {\n        const oldStroke = pendingStrokeGroup.querySelector(`#${ stroke?.id }`)\n        if (oldStroke) {\n          oldStroke.remove()\n        }\n        this.drawStroke(pendingStrokeGroup, stroke)\n      }\n    }\n  }\n\n  clearErasingStrokes(): void\n  {\n    const erasingStrokeList = this.context.parent.querySelectorAll(\"[type=eraser]\") as NodeListOf<SVGElement>\n    erasingStrokeList.forEach(erasingStroke => {\n      erasingStroke.remove()\n    })\n  }\n\n  resize(model: Model): void\n  {\n    this.#logger.info(\"resize\", { model })\n    const rect = this.context.parent.getBoundingClientRect()\n    const svgList = this.context.parent.querySelectorAll(\"svg\")\n    const width = Math.max(rect.width, model.width)\n    const height = Math.max(rect.height, model.height)\n    svgList.forEach(svg =>\n    {\n      svg.setAttribute(\"viewBox\", `0 0 ${ width }, ${ height }`)\n      svg.setAttribute(\"width\", `${ width }px`)\n      svg.setAttribute(\"height\", `${ height }px`)\n    })\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\", { context: this.context })\n    if (this.context?.parent) {\n      this.context.parent.querySelectorAll(\"svg\").forEach(n => n.remove())\n    }\n  }\n}","\n/**\n * @group Renderer\n */\nexport type TGuidesConfiguration = {\n  enable: boolean,\n  gap: number\n}\n\n/**\n * @group Renderer\n * @source\n */\nexport const DefaultGuidesConfiguration: TGuidesConfiguration = {\n  enable: true,\n  gap: 50,\n}\n\n/**\n * @group Renderer\n */\nexport type TRendererConfiguration = {\n  minHeight: number\n  minWidth: number\n  guides: TGuidesConfiguration\n}\n\n/**\n * @group Renderer\n * @source\n */\nexport const DefaultRendererConfiguration: TRendererConfiguration = {\n  guides: DefaultGuidesConfiguration,\n  minHeight: 100,\n  minWidth: 100,\n}\n\n/**\n * @group Renderer\n */\nexport type TIIRendererConfiguration = TRendererConfiguration & {\n  guides: TGuidesConfiguration & {\n    type: \"line\" | \"grid\" | \"point\"\n  },\n}\n\n/**\n * @group Renderer\n * @source\n */\nexport const DefaultIIRendererConfiguration: TIIRendererConfiguration = {\n  guides: {\n    enable: true,\n    gap: 50,\n    type: \"point\"\n  },\n  minHeight: 100,\n  minWidth: 100,\n}\n","\n/**\n * @group Grabber\n */\nexport type TListenerConfiguration = {\n  capture: boolean\n  passive: boolean\n}\n\n/**\n * @group Grabber\n * @source\n */\nexport const DefaultListenerConfiguration: TListenerConfiguration = {\n  capture: false,\n  passive: true\n}\n\n/**\n * @group Grabber\n */\nexport type TGrabberConfiguration = {\n  listenerOptions: TListenerConfiguration\n  xyFloatPrecision: number\n  timestampFloatPrecision: number\n  delayLongTouch: number\n}\n\n/**\n * @group Grabber\n * @source\n */\nexport const DefaultGrabberConfiguration: TGrabberConfiguration = {\n  listenerOptions: DefaultListenerConfiguration,\n  xyFloatPrecision: 0,\n  timestampFloatPrecision: 0,\n  delayLongTouch: 500\n}\n","import { TGrabberConfiguration } from \"./GrabberConfiguration\"\nimport { LoggerCategory, LoggerLevel, LoggerManager } from \"../logger\"\nimport { TPointer } from \"../symbol\"\n\nexport type PointerInfo = {\n  clientX: number,\n  clientY: number,\n  isPrimary: boolean,\n  type: string,\n  pointerType: string,\n  target: HTMLElement,\n  pointer: TPointer,\n  button: number,\n  buttons: number\n}\n\n/**\n * @group Grabber\n */\nexport class PointerEventGrabber\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.GRABBER)\n\n  protected configuration: TGrabberConfiguration\n  protected layerCapture!: HTMLElement\n  protected capturing: boolean = false\n  protected pointerType?: string\n  protected prevent = (e: Event) => e.preventDefault()\n\n  onPointerDown?: (info: PointerInfo) => void\n  onPointerMove?: (info: PointerInfo) => void\n  onPointerUp?: (info: PointerInfo) => void\n  onContextMenu?: (info: PointerInfo) => void\n\n  constructor(configuration: TGrabberConfiguration)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n  }\n\n  protected roundFloat(oneFloat: number, requestedFloatPrecision: number): number\n  {\n    if (requestedFloatPrecision >= 0) {\n      const floatPrecision: number = Math.pow(10, requestedFloatPrecision)\n      return Math.round(oneFloat / floatPrecision) * floatPrecision\n    }\n    this.#logger.debug(\"roundFloat\", { oneFloat, requestedFloatPrecision })\n    return oneFloat\n  }\n\n  protected extractPointer(event: MouseEvent | TouchEvent): TPointer\n  {\n    let clientX: number, clientY: number\n    if (\"changedTouches\" in event) {\n      ({ clientX, clientY } = event.changedTouches[0])\n    } else {\n      ({ clientX, clientY } = event)\n    }\n    const rect: DOMRect = this.layerCapture.getBoundingClientRect()\n    const pointer = {\n      x: this.roundFloat(clientX - rect.left - this.layerCapture.clientLeft + this.layerCapture.scrollLeft, this.configuration.xyFloatPrecision),\n      y: this.roundFloat(clientY - rect.top - this.layerCapture.clientTop + this.layerCapture.scrollTop, this.configuration.xyFloatPrecision),\n      t: this.roundFloat(Date.now(), this.configuration.timestampFloatPrecision),\n      p: (event as PointerEvent).pressure,\n    }\n    this.#logger.debug(\"extractPointer\", { event, pointer })\n    return pointer\n  }\n\n  protected getPointerInfos(evt: PointerEvent): PointerInfo\n  {\n    return {\n      clientX: evt.clientX,\n      clientY: evt.clientY,\n      isPrimary: evt.isPrimary,\n      type: evt.type,\n      target: evt.target as HTMLElement,\n      pointerType: evt.pointerType,\n      pointer: this.extractPointer(evt),\n      button: evt.button,\n      buttons: evt.buttons\n    }\n  }\n\n  protected pointerDownHandler = (evt: PointerEvent) =>\n  {\n    const pointerInfo = this.getPointerInfos(evt)\n    this.#logger.debug(\"pointerDownHandler\", pointerInfo)\n\n    // exit if not a left click or multi-touch\n    if (pointerInfo.button !== 0 || evt.buttons !== 1) {\n      return\n    }\n    this.capturing = true\n    this.pointerType = evt.pointerType\n\n    if (this.#logger.level === LoggerLevel.INFO) {\n      this.#logger.info(\"pointerDownHandler\", pointerInfo)\n    }\n\n    if (this.onPointerDown) {\n      this.onPointerDown(pointerInfo)\n    }\n  }\n\n  protected pointerMoveHandler = (evt: PointerEvent) =>\n  {\n    const pointerInfo = this.getPointerInfos(evt)\n    this.#logger.debug(\"pointerMoveHandler\", pointerInfo)\n    if (this.capturing && this.pointerType === evt.pointerType) {\n      if (this.#logger.level === LoggerLevel.INFO) {\n        this.#logger.info(\"pointerMoveHandler\", pointerInfo)\n      }\n      if (this.onPointerMove) {\n        this.onPointerMove(pointerInfo)\n      }\n    }\n  }\n\n  protected pointerUpHandler = (evt: PointerEvent) =>\n  {\n    const pointerInfo = this.getPointerInfos(evt)\n    this.#logger.debug(\"pointerUpHandler\", pointerInfo)\n    if (this.capturing && this.pointerType === evt.pointerType) {\n      if (this.#logger.level === LoggerLevel.INFO) {\n        this.#logger.info(\"pointerUpHandler\", pointerInfo)\n      }\n      this.pointerType = undefined\n      this.capturing = false\n      if (this.onPointerUp) {\n        this.onPointerUp(pointerInfo)\n      }\n    }\n  }\n\n  protected pointerOutHandler = (evt: PointerEvent) =>\n  {\n    const pointerInfo = this.getPointerInfos(evt)\n    this.#logger.debug(\"pointerOutHandler\", pointerInfo)\n    if (this.capturing && this.pointerType === evt.pointerType && !this.layerCapture.contains(evt.target as HTMLElement)) {\n      if (this.#logger.level === LoggerLevel.INFO) {\n        this.#logger.info(\"pointerOutHandler\", pointerInfo)\n      }\n      this.pointerType = undefined\n      this.capturing = false\n      if (this.onPointerUp) {\n        this.onPointerUp(pointerInfo)\n      }\n    }\n  }\n\n  protected contextMenuHandler = (evt: MouseEvent) =>\n  {\n    const pointerInfo = this.getPointerInfos(evt as PointerEvent)\n    this.#logger.debug(\"contextMenuHandler\", pointerInfo)\n    if (evt.target && this.onContextMenu){\n      if (this.#logger.level === LoggerLevel.INFO) {\n        this.#logger.info(\"contextMenuHandler\", pointerInfo)\n      }\n      this.onContextMenu(pointerInfo)\n    }\n  }\n\n  stopPointerEvent(): void\n  {\n    this.capturing = false\n    this.pointerType = undefined\n  }\n\n  attach(layerCapture: HTMLElement)\n  {\n    this.#logger.info(\"attach\", { domElement: layerCapture })\n    if (this.layerCapture) {\n      this.detach()\n    }\n    this.layerCapture = layerCapture\n    // The touch-action CSS property prevents the input from continuing.\n    // https://developer.mozilla.org/en-US/docs/Web/API/Element/pointercancel_event\n    this.layerCapture.style.setProperty(\"touch-action\", \"none\")\n    this.layerCapture.addEventListener(\"pointerdown\", this.pointerDownHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"pointermove\", this.pointerMoveHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"pointerup\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"pointercancel\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"pointerleave\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"pointerout\", this.pointerOutHandler, this.configuration.listenerOptions)\n    this.layerCapture.addEventListener(\"contextmenu\", this.contextMenuHandler)\n  }\n\n  detach()\n  {\n    this.#logger.info(\"detach\")\n    this.layerCapture?.style.removeProperty(\"touch-action\")\n    this.layerCapture?.removeEventListener(\"pointerdown\", this.pointerDownHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"pointermove\", this.pointerMoveHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"pointerup\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"pointerleave\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"pointercancel\", this.pointerUpHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"pointerout\", this.pointerOutHandler, this.configuration.listenerOptions)\n    this.layerCapture?.removeEventListener(\"contextmenu\", this.contextMenuHandler)\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport\n{\n  TIISymbol,\n  TPointer,\n} from \"../symbol\"\nimport { SVGRenderer } from \"../renderer\"\nimport { TStyle } from \"../style\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\nimport { InkEditor } from \"../editor\"\n\n\n/**\n * @group Manager\n */\nexport abstract class AbstractWriterManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.WRITE)\n  grabber: PointerEventGrabber\n  editor: InteractiveInkEditor | InkEditor\n  currentSymbol?: TIISymbol\n\n  detectGesture: boolean = true\n\n  constructor(editor: InteractiveInkEditor | InkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.grabber = new PointerEventGrabber(editor.configuration.grabber)\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  attach(layer: HTMLElement): void\n  {\n    this.grabber.attach(layer)\n    this.grabber.onPointerDown = this.start.bind(this)\n    this.grabber.onPointerMove = this.continue.bind(this)\n    this.grabber.onPointerUp = this.end.bind(this)\n  }\n\n  detach(): void\n  {\n    this.grabber.detach()\n  }\n\n  protected abstract createCurrentSymbol(pointer: TPointer, style: TStyle, pointerType: string): TIISymbol\n  protected abstract updateCurrentSymbol(pointer: TPointer): TIISymbol\n\n  start(info: PointerInfo): void\n  {\n    this.#logger.info(\"startWriting\", { info })\n    const localPointer = info.pointer\n    this.currentSymbol = this.createCurrentSymbol(localPointer, this.editor.penStyle, info.pointerType)\n    this.renderer.drawSymbol(this.currentSymbol!)\n  }\n\n  continue(info: PointerInfo): void\n  {\n    this.#logger.info(\"continueWriting\", { info })\n    const localPointer = info.pointer\n    this.currentSymbol = this.updateCurrentSymbol(localPointer)\n    this.renderer.drawSymbol(this.currentSymbol!)\n  }\n\n  abstract end(info: PointerInfo): Promise<void>\n}\n","import { InteractiveInkEditor } from \"../editor\"\nimport { LoggerManager, LoggerCategory } from \"../logger\"\nimport\n{\n  IIModel,\n  TJIIXChar,\n  TJIIXEdgeArc,\n  TJIIXEdgeElement,\n  JIIXEdgeKind,\n  TJIIXEdgeLine,\n  TJIIXEdgePolyEdge,\n  TJIIXExport,\n  TJIIXNodeCircle,\n  TJIIXNodeElement,\n  TJIIXNodeEllipse,\n  JIIXNodeKind,\n  TJIIXNodeParrallelogram,\n  TJIIXNodePolygon,\n  TJIIXNodeRectangle,\n  TJIIXNodeRhombus,\n  TJIIXNodeTriangle,\n  TJIIXTextElement,\n  TJIIXWord\n} from \"../model\"\nimport\n{\n  Box,\n  DecoratorKind,\n  IIDecorator,\n  IIEdgeArc,\n  IIEdgeLine,\n  IIEdgePolyLine,\n  IIShapeCircle,\n  IIShapeEllipse,\n  IIShapePolygon,\n  IIStroke,\n  IIText,\n  SymbolType,\n  TIIEdge,\n  TIIShape,\n  TIISymbol,\n  TIISymbolChar,\n  TPoint\n} from \"../symbol\"\nimport { RecognizedKind } from \"../symbol\"\nimport { computeAngleAxeRadian, computeAverage, convertBoundingBoxMillimeterToPixel, convertMillimeterToPixel, createUUID } from \"../utils\"\n\n/**\n * @group Manager\n */\nexport class IIConversionManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.CONVERTER)\n  editor: InteractiveInkEditor\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get configuration(): { size: number | \"auto\", weight: \"bold\" | \"normal\" | \"auto\" } {\n    return this.editor.configuration.fontStyle\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get rowHeight(): number\n  {\n    return this.editor.configuration.rendering.guides.gap\n  }\n\n  protected computeFontSize(chars: TJIIXChar[]): number\n  {\n    if (chars.some(c => c[\"bounding-box\"])) {\n      const height = convertMillimeterToPixel(computeAverage(chars.map(c => c[\"bounding-box\"]?.height || 1)))\n      return Math.round(Math.round(height * this.rowHeight) / this.rowHeight / 2) * 2\n    }\n    return Math.round(this.rowHeight / 2)\n  }\n\n  buildChar(char: TJIIXChar, strokes: IIStroke[], fontSize: number): TIISymbolChar\n  {\n    const points = char.grid.map(p => ({\n      x: convertMillimeterToPixel(p.x),\n      y: convertMillimeterToPixel(p.y),\n    }))\n    let fontWeight = this.configuration.weight\n    if (fontWeight === \"auto\") {\n      fontWeight = (strokes[0].style.width || 1) > 2 ? \"bold\" : \"normal\"\n    }\n\n    const color = strokes[0].style.color || \"black\"\n    return {\n      id: `text-char-${ createUUID() }`,\n      label: char.label,\n      color,\n      fontSize,\n      fontWeight,\n      bounds: Box.createFromPoints(points)\n    }\n  }\n\n  buildText(word: TJIIXWord, chars: TJIIXChar[], strokes: IIStroke[], size: number | \"auto\"): IIText\n  {\n    const boundingBox = Box.createFromBoxes([convertBoundingBoxMillimeterToPixel(word[\"bounding-box\"])])\n    const charSymbols: TIISymbolChar[] = []\n    const charFontSize = size === \"auto\" ? this.computeFontSize(chars) : size\n\n    chars.forEach(char =>\n    {\n      const charStrokes = strokes.filter(s => char.items?.some(i => i[\"full-id\"] === s.id)) as IIStroke[]\n      if (charStrokes.length) {\n        charSymbols.push(this.buildChar(char, charStrokes, charFontSize))\n      }\n    })\n    const point: TPoint = {\n      x: boundingBox.xMin,\n      y: boundingBox.yMax\n    }\n    const text = new IIText(charSymbols, point, boundingBox, strokes[0].style)\n    const decorators = strokes.flatMap(s => s.decorators)\n    strokes.forEach(s =>\n    {\n      const sym = this.model.getRootSymbol(s.id)\n      if ((sym?.type === SymbolType.Recognized && sym.kind === RecognizedKind.Text) || sym?.type === SymbolType.Group) {\n        const hightlight = sym.decorators.find(d => d.kind === DecoratorKind.Highlight)\n        if (hightlight) decorators.push(hightlight)\n        const strikethrough = sym.decorators.find(d => d.kind === DecoratorKind.Strikethrough)\n        if (strikethrough) decorators.push(strikethrough)\n        const surround = sym.decorators.find(d => d.kind === DecoratorKind.Surround)\n        if (surround) decorators.push(surround)\n        const underline = sym.decorators.find(d => d.kind === DecoratorKind.Underline)\n        if (underline) decorators.push(underline)\n      }\n    })\n    if (decorators.length) {\n      const hightlight = decorators.find(d => d.kind === DecoratorKind.Highlight)\n      if (hightlight) {\n        text.decorators.push(new IIDecorator(DecoratorKind.Highlight, hightlight.style))\n      }\n      const strikethrough = decorators.find(d => d.kind === DecoratorKind.Strikethrough)\n      if (strikethrough) {\n        text.decorators.push(new IIDecorator(DecoratorKind.Strikethrough, strikethrough.style))\n      }\n      const surround = decorators.find(d => d.kind === DecoratorKind.Surround)\n      if (surround) {\n        text.decorators.push(new IIDecorator(DecoratorKind.Surround, surround.style))\n      }\n      const underline = decorators.find(d => d.kind === DecoratorKind.Underline)\n      if (underline) {\n        text.decorators.push(new IIDecorator(DecoratorKind.Underline, underline.style))\n      }\n    }\n\n    return text\n  }\n\n  convertText(text: TJIIXTextElement, strokes: IIStroke[], onlyText: boolean): { symbol: IIText, strokes: IIStroke[] }[] | undefined\n  {\n    if (!text.lines) {\n      throw new Error(\"You need to active configuration.recognition.export.jiix.text.lines = true\")\n    }\n    if (!text.words) {\n      throw new Error(\"You need to active configuration.recognition.export.jiix.text.words = true\")\n    }\n    if (!text.chars) {\n      throw new Error(\"You need to active configuration.recognition.export.jiix.text.chars = true\")\n    }\n    if (!text.chars.some(c => c.items)) {\n      throw new Error(\"You need to active configuration.recognition.export.jiix.strokes = true\")\n    }\n\n    const jiixWords = text.words as TJIIXWord[]\n    const jiixChars = text.chars as TJIIXChar[]\n\n    const result: { symbol: IIText, strokes: IIStroke[] }[] = []\n\n\n    let textFontSize = this.configuration.size\n    if (onlyText && textFontSize === \"auto\") {\n      textFontSize = Math.round(this.computeFontSize(jiixChars.filter(c => c.items?.length)) / 2) * 2\n    }\n    else if (this.configuration.size !== \"auto\") {\n      textFontSize = this.configuration.size * this.rowHeight\n    }\n\n    let isNewLine = false\n    let currentY = convertMillimeterToPixel(text.lines[0][\"baseline-y\"])\n    const leftX = convertMillimeterToPixel(text[\"bounding-box\"]?.x || 0)\n    let currentX = convertMillimeterToPixel(jiixWords[0][\"bounding-box\"]?.x || 0)\n    jiixWords.forEach(word =>\n    {\n      if (word.label === \" \") {\n        currentX += this.editor.texter.getSpaceWidth(result.at(-1)?.symbol.chars[0].fontSize|| (this.rowHeight / 2))\n        return\n      }\n      const wordStrokes = strokes.filter(s => word.items?.some(i => i[\"full-id\"] === s.id)) as IIStroke[]\n      if (wordStrokes.length) {\n        const chars = jiixChars.slice(word[\"first-char\"] as number, (word[\"last-char\"] || 0) + 1)\n        const wordSymbol = this.buildText(word, chars, wordStrokes, textFontSize)\n\n        if (onlyText) {\n          if (isNewLine) {\n            isNewLine = false\n            const nbRow = Math.round((wordSymbol.point.y - currentY) / this.rowHeight) || 1\n            currentY += nbRow * this.rowHeight\n            if (Math.abs(wordSymbol.point.x - leftX) < this.rowHeight) {\n              currentX = leftX\n            }\n            else {\n              currentX = wordSymbol.point.x\n            }\n          }\n          wordSymbol.point.x = currentX\n          wordSymbol.point.y = this.model.roundToLineGuide(currentY)\n        }\n\n        this.editor.texter.setBounds(wordSymbol)\n        currentX += wordSymbol.bounds.width\n        result.push({\n          symbol: wordSymbol,\n          strokes: wordStrokes\n        })\n      }\n      isNewLine = word.label === \"\\n\"\n    })\n\n    return result\n  }\n\n  buildCircle(circle: TJIIXNodeCircle, strokes: IIStroke[]): IIShapeCircle\n  {\n    const center: TPoint = {\n      x: convertMillimeterToPixel(circle.cx),\n      y: convertMillimeterToPixel(circle.cy)\n    }\n    return new IIShapeCircle(center, convertMillimeterToPixel(circle.r), strokes[0]?.style)\n  }\n\n  buildEllipse(ellipse: TJIIXNodeEllipse, strokes: IIStroke[]): IIShapeEllipse\n  {\n    const center: TPoint = {\n      x: convertMillimeterToPixel(ellipse.cx),\n      y: convertMillimeterToPixel(ellipse.cy),\n    }\n    return new IIShapeEllipse(center, convertMillimeterToPixel(ellipse.rx), convertMillimeterToPixel(ellipse.ry), ellipse.orientation, strokes[0]?.style)\n  }\n\n  buildRectangle(rectangle: TJIIXNodeRectangle, strokes: IIStroke[]): IIShapePolygon\n  {\n    const height = convertMillimeterToPixel(rectangle.height)\n    const width = convertMillimeterToPixel(rectangle.width)\n    const x = convertMillimeterToPixel(rectangle.x)\n    const y = convertMillimeterToPixel(rectangle.y)\n    const points: TPoint[] = [\n      { x, y },\n      { x: x + width, y },\n      { x: x + width, y: y + height },\n      { x, y: y + height }\n    ]\n    return new IIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildPolygon(polygon: TJIIXNodePolygon, strokes: IIStroke[]): IIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new IIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildRhombus(polygon: TJIIXNodeRhombus, strokes: IIStroke[]): IIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new IIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildTriangle(polygon: TJIIXNodeTriangle, strokes: IIStroke[]): IIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new IIShapePolygon(points, strokes[0]?.style)\n  }\n\n  buildParallelogram(polygon: TJIIXNodeParrallelogram, strokes: IIStroke[]): IIShapePolygon\n  {\n    const points: TPoint[] = []\n    for (let i = 0; i < polygon.points.length; i += 2) {\n      points.push({\n        x: convertMillimeterToPixel(polygon.points[i]),\n        y: convertMillimeterToPixel(polygon.points[i + 1])\n      })\n    }\n\n    return new IIShapePolygon(points, strokes[0]?.style)\n  }\n\n  convertNode(node: TJIIXNodeElement, strokes: IIStroke[]): { symbol: TIIShape, strokes: IIStroke[] } | undefined\n  {\n    const associatedStroke = strokes.filter(s => node.items?.some(i => i[\"full-id\"] === s.id))\n    if (!associatedStroke.length) return\n\n    const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n\n    let shape: TIIShape\n    switch (node.kind) {\n      case JIIXNodeKind.Circle:\n        shape = this.buildCircle(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Ellipse:\n        shape = this.buildEllipse(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Rectangle:\n        shape = this.buildRectangle(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Triangle:\n        shape = this.buildTriangle(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Parallelogram:\n        shape = this.buildParallelogram(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Polygon:\n        shape = this.buildPolygon(node, uniqStrokes)\n        break\n      case JIIXNodeKind.Rhombus:\n        shape = this.buildRhombus(node, uniqStrokes)\n        break\n      default:\n        this.#logger.warn(\"convertNode\", `Conversion of Node with kind equal to ${ JSON.stringify(node) } is unknow`)\n        return\n    }\n    return { symbol: shape, strokes: uniqStrokes }\n  }\n\n  buildLine(line: TJIIXEdgeLine, strokes: IIStroke[]): IIEdgeLine\n  {\n    const point1: TPoint = { x: convertMillimeterToPixel(line.x1), y: convertMillimeterToPixel(line.y1) }\n    const point2: TPoint = { x: convertMillimeterToPixel(line.x2), y: convertMillimeterToPixel(line.y2) }\n    const angle = computeAngleAxeRadian(point1, point2)\n\n    if (Math.abs(angle % Math.PI) < 0.1) {\n      // to adjust the line with the horizontal\n      point1.y = +((point1.y + point2.y) / 2).toFixed(3)\n      point2.y = point1.y\n    }\n    else if (Math.abs(angle % (Math.PI / 2)) < 0.1) {\n      // to adjust the line with the vertical\n      point1.x = +((point1.x + point2.x) / 2).toFixed(3)\n      point2.x = point1.x\n    }\n    return new IIEdgeLine(point1, point2, line.p1Decoration, line.p2Decoration, strokes[0]?.style)\n  }\n\n  buildPolyEdge(polyline: TJIIXEdgePolyEdge, strokes: IIStroke[]): IIEdgePolyLine\n  {\n    const start: TPoint = { x: convertMillimeterToPixel(polyline.edges[0].x1), y: convertMillimeterToPixel(polyline.edges[0].y1) }\n    const points = polyline.edges.map(e => ({ x: convertMillimeterToPixel(e.x2), y: convertMillimeterToPixel(e.y2) }))\n    points.unshift(start)\n    for (let index = 0; index < points.length - 1; index++) {\n      const p1 = points[index]\n      const p2 = points[index + 1]\n      const angle = computeAngleAxeRadian(p1, p2)\n      if (Math.abs(angle % Math.PI) < 0.1) {\n        p1.y = +((p1.y + p2.y) / 2).toFixed(3)\n        p2.y = p1.y\n      }\n      else if (Math.abs(angle % (Math.PI / 2)) < 0.1) {\n        p1.x = +((p1.x + p2.x) / 2).toFixed(3)\n        p2.x = p1.x\n      }\n    }\n\n    return new IIEdgePolyLine(points, polyline.edges[0].p1Decoration, polyline.edges.at(-1)!.p2Decoration, strokes[0]?.style)\n  }\n\n  buildArc(arc: TJIIXEdgeArc, strokes: IIStroke[]): IIEdgeArc\n  {\n    const center: TPoint = { x: convertMillimeterToPixel(arc.cx), y: convertMillimeterToPixel(arc.cy) }\n    const radiusX = convertMillimeterToPixel(arc.rx)\n    const radiusY = convertMillimeterToPixel(arc.ry)\n    return new IIEdgeArc(center, arc.startAngle, arc.sweepAngle, radiusX, radiusY, arc.phi, arc.startDecoration, arc.endDecoration, strokes[0]?.style)\n  }\n\n  convertEdge(edge: TJIIXEdgeElement, strokes: IIStroke[]): { symbol: TIIEdge, strokes: IIStroke[] } | undefined\n  {\n    switch (edge.kind) {\n      case JIIXEdgeKind.Line: {\n        const associatedStroke = strokes.filter(s => edge.items?.some(i => i[\"full-id\"] === s.id))\n        if (!associatedStroke.length) return\n        const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n        const oiEdge = this.buildLine(edge, uniqStrokes)\n        return {\n          symbol: oiEdge,\n          strokes: uniqStrokes\n        }\n      }\n      case JIIXEdgeKind.Arc: {\n        const associatedStroke = strokes.filter(s => edge.items?.some(i => i[\"full-id\"] === s.id))\n        if (!associatedStroke.length) return\n        const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n        const oiEdge = this.buildArc(edge, uniqStrokes)\n        return {\n          symbol: oiEdge,\n          strokes: uniqStrokes\n        }\n      }\n      case JIIXEdgeKind.PolyEdge: {\n        const associatedStroke = strokes.filter(s => edge.edges.flatMap(e => e.items)?.some(i => i![\"full-id\"] === s.id))\n        if (!associatedStroke.length) return\n        const uniqStrokes = associatedStroke.filter((a, i) => associatedStroke.findIndex((s) => a.id === s.id) === i)\n        const oiEdge = this.buildPolyEdge(edge, uniqStrokes)\n        return {\n          symbol: oiEdge,\n          strokes: uniqStrokes\n        }\n      }\n      default:\n        this.#logger.error(\"convertEdge\", `Conversion of Edge with kind equal to ${ JSON.stringify(edge) } is unknow`)\n        return\n    }\n  }\n\n  async apply(symbols: TIISymbol[] = []): Promise<void>\n  {\n    this.#logger.info(\"convert\")\n    if (!this.model.exports?.[\"application/vnd.myscript.jiix\"]) {\n      await this.editor.export([\"application/vnd.myscript.jiix\"])\n    }\n    this.editor.selector.removeSelectedGroup()\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"] as TJIIXExport\n    if (jiix?.elements?.length) {\n      const strokesToConvert = this.editor.extractStrokesFromSymbols(symbols.length ? symbols : this.model.symbols)\n\n      const onlyText = !jiix.elements?.some(e => e.type !== \"Text\")\n      const conversionResults: { symbol: TIISymbol, strokes: IIStroke[] }[] = []\n      jiix.elements.forEach(el =>\n      {\n        switch (el.type) {\n          case \"Text\": {\n            const conversion = this.convertText(el, strokesToConvert, onlyText)\n            if (conversion) {\n              conversionResults.push(...conversion)\n            }\n            break\n          }\n          case \"Node\": {\n            const conversion = this.convertNode(el, strokesToConvert)\n            if (conversion) {\n              conversionResults.push(conversion)\n            }\n            break\n          }\n          case \"Edge\": {\n            const conversion = this.convertEdge(el, strokesToConvert)\n            if (conversion) {\n              conversionResults.push(conversion)\n            }\n            break\n          }\n          default: {\n            this.#logger.warn(\"buildConversions\", `Unknow jiix element type: ${ el.type }`)\n          }\n        }\n      })\n\n      this.editor.addSymbols(conversionResults.map(cs => cs.symbol), false)\n      this.editor.removeSymbols(conversionResults.flatMap(cs => cs.strokes.map(s => s.id)), false)\n      this.editor.history.push(this.model, { added: conversionResults.map(c => c.symbol), erased: conversionResults.flatMap(cs => cs.strokes) })\n    }\n  }\n}\n","import { ResizeDirection, SvgElementRole } from \"../Constants\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport\n{\n  Box,\n  EdgeKind,\n  IIStroke,\n  IISymbolGroup,\n  IIText,\n  ShapeKind,\n  SymbolType,\n  TIIEdge,\n  TIIShape,\n  TIISymbol,\n  TPoint,\n  TIIRecognized,\n  RecognizedKind\n} from \"../symbol\"\n\n/**\n * @group Manager\n */\nexport class IIResizeManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.TRANSFORMER)\n  editor: InteractiveInkEditor\n\n  interactElementsGroup?: SVGElement\n  direction!: ResizeDirection\n  boundingBox!: Box\n  transformOrigin!: TPoint\n  keepRatio = false\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  protected applyToStroke(stroke: IIStroke, origin: TPoint, scaleX: number, scaleY: number): IIStroke\n  {\n    this.#logger.debug(\"applyToStroke\", { stroke, origin, scaleX, scaleY })\n    stroke.pointers.forEach(p =>\n    {\n      p.x = +(origin.x + scaleX * (p.x - origin.x)).toFixed(3)\n      p.y = +(origin.y + scaleY * (p.y - origin.y)).toFixed(3)\n    })\n    return stroke\n  }\n\n  protected applyToShape(shape: TIIShape, origin: TPoint, scaleX: number, scaleY: number): TIIShape\n  {\n    this.#logger.debug(\"applyToShape\", { shape, origin, scaleX, scaleY })\n    switch (shape.kind) {\n      case ShapeKind.Ellipse: {\n        const cosPhi = Math.cos(shape.orientation)\n        const sinPhi = Math.sin(shape.orientation)\n        shape.center.x = +(shape.center.x + ((scaleX - 1) * cosPhi + (scaleY - 1) * sinPhi) * (shape.center.x - origin.x)).toFixed(3)\n        shape.center.y = +(shape.center.y + ((scaleX - 1) * -sinPhi + (scaleY - 1) * cosPhi) * (shape.center.y - origin.y)).toFixed(3)\n        shape.radiusX = +(Math.abs(shape.radiusX * (scaleX * cosPhi - scaleY * sinPhi))).toFixed(3)\n        shape.radiusY = +(Math.abs(shape.radiusY * (scaleX * sinPhi + scaleY * cosPhi))).toFixed(3)\n        return shape\n      }\n      case ShapeKind.Circle: {\n        shape.radius = +(shape.radius * (scaleX + scaleY) / 2).toFixed(3)\n        shape.center.x = +(origin.x + scaleX * (shape.center.x - origin.x)).toFixed(3)\n        shape.center.y = +(origin.y + scaleY * (shape.center.y - origin.y)).toFixed(3)\n        return shape\n      }\n      case ShapeKind.Polygon: {\n        shape.points.forEach(p =>\n        {\n          p.x = +(origin.x + scaleX * (p.x - origin.x)).toFixed(3)\n          p.y = +(origin.y + scaleY * (p.y - origin.y)).toFixed(3)\n        })\n        return shape\n      }\n      default:\n        throw new Error(`Can't apply resize on shape, kind unknow: ${ JSON.stringify(shape) }`)\n    }\n  }\n\n  protected applyToEdge(edge: TIIEdge, origin: TPoint, scaleX: number, scaleY: number): TIIEdge\n  {\n    this.#logger.debug(\"applyToEdge\", { edge, origin, scaleX, scaleY })\n    switch (edge.kind) {\n      case EdgeKind.Arc: {\n        const cosPhi = Math.cos(edge.phi)\n        const sinPhi = Math.sin(edge.phi)\n        edge.center.x = +(edge.center.x + ((scaleX - 1) * cosPhi + (scaleY - 1) * sinPhi) * (edge.center.x - origin.x)).toFixed(3)\n        edge.center.y = +(edge.center.y + ((scaleX - 1) * -sinPhi + (scaleY - 1) * cosPhi) * (edge.center.y - origin.y)).toFixed(3)\n        edge.radiusX = +(edge.radiusX * Math.abs(scaleX * cosPhi + scaleY * sinPhi)).toFixed(3)\n        edge.radiusY = +(edge.radiusY * Math.abs(scaleX * sinPhi + scaleY * cosPhi)).toFixed(3)\n\n        if (scaleX < 0) {\n          edge.startAngle = +(Math.PI - edge.startAngle).toFixed(3)\n          edge.sweepAngle *= -1\n        }\n        else if (scaleY < 0) {\n          edge.sweepAngle *= -1\n        }\n        return edge\n      }\n      case EdgeKind.Line: {\n        edge.start.x = +(origin.x + scaleX * (edge.start.x - origin.x)).toFixed(3)\n        edge.start.y = +(origin.y + scaleY * (edge.start.y - origin.y)).toFixed(3)\n        edge.end.x = +(origin.x + scaleX * (edge.end.x - origin.x)).toFixed(3)\n        edge.end.y = +(origin.y + scaleY * (edge.end.y - origin.y)).toFixed(3)\n        return edge\n      }\n      case EdgeKind.PolyEdge: {\n        edge.points.forEach(p =>\n        {\n          p.x = +(origin.x + scaleX * (p.x - origin.x)).toFixed(3)\n          p.y = +(origin.y + scaleY * (p.y - origin.y)).toFixed(3)\n          return p\n        })\n        return edge\n      }\n      default:\n        throw new Error(`Can't apply resize on edge, kind unknow: ${ JSON.stringify(edge) }`)\n    }\n  }\n\n  protected applyOnText(text: IIText, origin: TPoint, scaleX: number, scaleY: number): IIText\n  {\n    text.point.x = +(origin.x + scaleX * (text.point.x - origin.x)).toFixed(3)\n    text.point.y = +(origin.y + scaleY * (text.point.y - origin.y)).toFixed(3)\n\n    text.chars.forEach(c =>\n    {\n      c.fontSize = +(c.fontSize * (scaleX + scaleY) / 2).toFixed(3)\n    })\n    return this.editor.texter.updateBounds(text)\n  }\n\n  protected applyOnGroup(group: IISymbolGroup, origin: TPoint, scaleX: number, scaleY: number): IISymbolGroup\n  {\n    group.children.forEach(s => this.applyToSymbol(s, origin, scaleX, scaleY))\n    return group\n  }\n\n  protected applyOnRecognizedSymbol(recognizedSymbol: TIIRecognized, origin: TPoint, scaleX: number, scaleY: number): TIIRecognized\n  {\n    recognizedSymbol.strokes.forEach(s => this.applyToStroke(s, origin, scaleX, scaleY))\n    if (recognizedSymbol.kind === RecognizedKind.Text) {\n      recognizedSymbol.xHeight *= scaleY\n    }\n    return recognizedSymbol\n  }\n\n  applyToSymbol(symbol: TIISymbol, origin: TPoint, scaleX: number, scaleY: number): TIISymbol\n  {\n    this.#logger.info(\"applyToSymbol\", { symbol, scaleX, scaleY })\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        return this.applyToStroke(symbol, origin, scaleX, scaleY)\n      case SymbolType.Shape:\n        return this.applyToShape(symbol, origin, scaleX, scaleY)\n      case SymbolType.Edge:\n        return this.applyToEdge(symbol, origin, scaleX, scaleY)\n      case SymbolType.Text:\n        return this.applyOnText(symbol, origin, scaleX, scaleY)\n      case SymbolType.Group:\n        return this.applyOnGroup(symbol, origin, scaleX, scaleY)\n      case SymbolType.Recognized:\n        return this.applyOnRecognizedSymbol(symbol, origin, scaleX, scaleY)\n      default:\n        throw new Error(`Can't apply resize on symbol, type unknow: ${ JSON.stringify(symbol) }`)\n    }\n  }\n\n  setTransformOrigin(id: string, originX: number, originY: number): void\n  {\n    this.editor.renderer.setAttribute(id, \"transform-origin\", `${ originX }px ${ originY }px`)\n  }\n\n  scaleElement(id: string, sx: number, sy: number): void\n  {\n    this.#logger.info(\"scaleElement\", { id, sx, sy })\n    this.editor.renderer.setAttribute(id, \"transform\", `scale(${ sx },${ sy })`)\n  }\n\n  start(target: Element, origin: TPoint): void\n  {\n    this.#logger.info(\"start\", { target })\n    this.interactElementsGroup = (target.closest(`[role=${ SvgElementRole.InteractElementsGroup }]`) as unknown) as SVGGElement\n    this.direction = target.getAttribute(\"resize-direction\") as ResizeDirection\n\n    this.keepRatio = this.model.symbolsSelected.some(s => s.type === SymbolType.Text || (s.type === SymbolType.Shape && (s as TIIShape).kind === ShapeKind.Circle))\n\n    this.transformOrigin = origin\n    this.boundingBox = Box.createFromPoints(this.model.symbolsSelected.flatMap(s => s.vertices))\n    this.setTransformOrigin(this.interactElementsGroup!.id, this.transformOrigin.x, this.transformOrigin.y)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.setTransformOrigin(s.id, this.transformOrigin.x, this.transformOrigin.y)\n    })\n  }\n\n  continue(point: TPoint): { scaleX: number, scaleY: number }\n  {\n    this.#logger.info(\"continue\", { point })\n    if (!this.interactElementsGroup) {\n      throw new Error(\"Can't resize, you must call start before\")\n    }\n    const localPoint = point\n    const horizontalResize = [\n      ResizeDirection.East,\n      ResizeDirection.NorthEast,\n      ResizeDirection.SouthEast,\n      ResizeDirection.West,\n      ResizeDirection.NorthWest,\n      ResizeDirection.SouthWest\n    ].includes(this.direction)\n    const verticalResize = [\n      ResizeDirection.North,\n      ResizeDirection.NorthEast,\n      ResizeDirection.NorthWest,\n      ResizeDirection.South,\n      ResizeDirection.SouthEast,\n      ResizeDirection.SouthWest\n    ].includes(this.direction)\n    const { x, y } = this.editor.snaps.snapResize(point, horizontalResize, verticalResize)\n    localPoint.x = x\n    localPoint.y = y\n\n    let deltaX = 0, deltaY = 0\n    if ([ResizeDirection.East, ResizeDirection.NorthEast, ResizeDirection.SouthEast].includes(this.direction)) {\n      deltaX = localPoint.x - this.boundingBox.xMax\n    }\n    else if ([ResizeDirection.West, ResizeDirection.NorthWest, ResizeDirection.SouthWest].includes(this.direction)) {\n      deltaX = this.boundingBox.xMin - localPoint.x\n    }\n\n    if ([ResizeDirection.North, ResizeDirection.NorthEast, ResizeDirection.NorthWest].includes(this.direction)) {\n      deltaY = this.boundingBox.yMin - localPoint.y\n    }\n    else if ([ResizeDirection.South, ResizeDirection.SouthEast, ResizeDirection.SouthWest].includes(this.direction)) {\n      deltaY = localPoint.y - this.boundingBox.yMax\n    }\n\n    let scaleX = this.boundingBox.width ? 1 + (deltaX / this.boundingBox.width) : 1\n    let scaleY = this.boundingBox.height ? 1 + (deltaY / this.boundingBox.height) : 1\n\n    if (this.keepRatio) {\n      if ([ResizeDirection.North, ResizeDirection.South].includes(this.direction)) {\n        scaleX = scaleY\n      }\n      else if ([ResizeDirection.East, ResizeDirection.West].includes(this.direction)) {\n        scaleY = scaleX\n      }\n      else {\n        scaleX = Math.max(scaleX, scaleY)\n        scaleY = scaleX\n      }\n    }\n    this.scaleElement(this.interactElementsGroup.id, scaleX, scaleY)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.scaleElement(s.id, scaleX, scaleY)\n    })\n    return {\n      scaleX,\n      scaleY\n    }\n  }\n\n  async end(point: TPoint): Promise<void>\n  {\n    this.#logger.info(\"end\", { point })\n    const { scaleX, scaleY } = this.continue(point)\n    this.editor.snaps.clearSnapToElementLines()\n    const oldSymbols = this.model.symbolsSelected.map(s => s.clone())\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.applyToSymbol(s, this.transformOrigin, scaleX, scaleY)\n      this.editor.renderer.drawSymbol(s)\n      this.model.updateSymbol(s)\n    })\n\n    const strokesFromSymbols = this.editor.extractStrokesFromSymbols(this.model.symbolsSelected)\n    this.editor.recognizer.transformScale(strokesFromSymbols.map(s => s.id), scaleX, scaleY, this.transformOrigin.x, this.transformOrigin.y)\n    this.editor.history.push(this.model, { scale: [{ symbols: oldSymbols, origin: {...this.transformOrigin}, scaleX, scaleY }] })\n\n    this.interactElementsGroup = undefined\n    this.editor.svgDebugger.apply()\n  }\n}\n","import { SvgElementRole } from \"../Constants\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport\n{\n  Box,\n  EdgeKind,\n  IIStroke,\n  IISymbolGroup,\n  IIText,\n  TIIRecognized,\n  ShapeKind,\n  SymbolType,\n  TIIEdge,\n  TIIShape,\n  TIISymbol,\n  TPoint\n} from \"../symbol\"\nimport { computeAngleRadian, convertDegreeToRadian, convertRadianToDegree, computeRotatedPoint } from \"../utils\"\n\n/**\n * @group Manager\n */\nexport class IIRotationManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.TRANSFORMER)\n  editor: InteractiveInkEditor\n  interactElementsGroup?: SVGElement\n  center!: TPoint\n  origin!: TPoint\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  protected applyToStroke(stroke: IIStroke, center: TPoint, angleRad: number): IIStroke\n  {\n    stroke.pointers.forEach(p =>\n    {\n      const { x, y } = computeRotatedPoint(p, center, angleRad)\n      p.x = x\n      p.y = y\n    })\n    return stroke\n  }\n\n  protected applyToShape(shape: TIIShape, center: TPoint, angleRad: number): TIIShape\n  {\n    switch (shape.kind) {\n      case ShapeKind.Ellipse: {\n        shape.center = computeRotatedPoint(shape.center, center, angleRad)\n        shape.orientation = (shape.orientation + angleRad) % (2 * Math.PI)\n        return shape\n      }\n      case ShapeKind.Circle: {\n        shape.center = computeRotatedPoint(shape.center, center, angleRad)\n        return shape\n      }\n      case ShapeKind.Polygon: {\n        shape.points.forEach(p =>\n        {\n          const { x, y } = computeRotatedPoint(p, center, angleRad)\n          p.x = x\n          p.y = y\n        })\n        return shape\n      }\n      default:\n        throw new Error(`Can't apply rotate on shape, kind unknow: ${ JSON.stringify(shape) }`)\n    }\n  }\n\n  protected applyToEdge(edge: TIIEdge, center: TPoint, angleRad: number): TIIEdge\n  {\n    switch (edge.kind) {\n      case EdgeKind.Arc: {\n        edge.phi = (edge.phi - angleRad) % (2 * Math.PI)\n        edge.center = computeRotatedPoint(edge.center, center, angleRad)\n        return edge\n      }\n      case EdgeKind.Line: {\n        edge.start = computeRotatedPoint(edge.start, center, angleRad)\n        edge.end = computeRotatedPoint(edge.end, center, angleRad)\n        return edge\n      }\n      case EdgeKind.PolyEdge: {\n        edge.points = edge.points.map(p => computeRotatedPoint(p, center, angleRad))\n        return edge\n      }\n      default:\n        throw new Error(`Can't apply rotate on edge, kind unknow: ${ JSON.stringify(edge) }`)\n    }\n    return edge\n  }\n\n  protected applyOnText(text: IIText, center: TPoint, angleRad: number): IIText\n  {\n    text.rotation = {\n      degree: convertRadianToDegree(angleRad) + (text.rotation?.degree || 0),\n      center: center\n    }\n    return this.editor.texter.updateBounds(text)\n  }\n\n  protected applyOnGroup(group: IISymbolGroup, center: TPoint, angleRad: number): IISymbolGroup\n  {\n    group.children.forEach(s => this.applyToSymbol(s, center, angleRad))\n    return group\n  }\n\n  protected applyOnRecognizedSymbol(strokeText: TIIRecognized, center: TPoint, angleRad: number): TIIRecognized\n  {\n    strokeText.strokes.forEach(s => this.applyToStroke(s, center, angleRad))\n    return strokeText\n  }\n\n  applyToSymbol(symbol: TIISymbol, center: TPoint, angleRad: number): TIISymbol\n  {\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        return this.applyToStroke(symbol, center, angleRad)\n      case SymbolType.Shape:\n        return this.applyToShape(symbol, center, angleRad)\n      case SymbolType.Edge:\n        return this.applyToEdge(symbol, center, angleRad)\n      case SymbolType.Text:\n        return this.applyOnText(symbol, center, angleRad)\n      case SymbolType.Group:\n        return this.applyOnGroup(symbol, center, angleRad)\n      case SymbolType.Recognized:\n        return this.applyOnRecognizedSymbol(symbol, center, angleRad)\n      default:\n        throw new Error(`Can't apply rotate on symbol, type unknow: ${ JSON.stringify(symbol) }`)\n    }\n  }\n\n  setTransformOrigin(id: string, originX: number, originY: number): void\n  {\n    this.editor.renderer.setAttribute(id, \"transform-origin\", `${ originX }px ${ originY }px`)\n  }\n\n  rotateElement(id: string, degree: number): void\n  {\n    this.#logger.info(\"rotateElement\", { id, degree })\n    this.editor.renderer.setAttribute(id, \"transform\", `rotate(${ degree })`)\n  }\n\n  start(target: Element, origin: TPoint): void\n  {\n    this.#logger.info(\"start\", { target })\n    this.interactElementsGroup = (target.closest(`[role=${ SvgElementRole.InteractElementsGroup }]`) as unknown) as SVGGElement\n    const boundingBox = Box.createFromPoints(this.model.symbolsSelected.flatMap(s => s.vertices))\n\n    this.center = {\n      x: boundingBox.xMin + boundingBox.width / 2,\n      y: boundingBox.yMid\n    }\n    this.origin = origin\n    this.setTransformOrigin(this.interactElementsGroup.id, this.center.x, this.center.y)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.setTransformOrigin(s.id, this.center.x, this.center.y)\n    })\n  }\n\n  continue(point: TPoint): number\n  {\n    this.#logger.info(\"continue\", { point })\n    if (!this.interactElementsGroup) {\n      throw new Error(\"Can't rotate, you must call start before\")\n    }\n    let angleDegree = Math.round(convertRadianToDegree(computeAngleRadian(this.origin, this.center, point)))\n\n    angleDegree = this.editor.snaps.snapRotation(angleDegree)\n\n    if (point.x - this.center.x < 0) {\n      angleDegree = 360 - angleDegree\n    }\n\n    this.rotateElement(this.interactElementsGroup.id, angleDegree)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.rotateElement(s.id, angleDegree)\n    })\n    return angleDegree\n  }\n\n  async end(point: TPoint): Promise<void>\n  {\n    this.#logger.info(\"end\", { point })\n    const angleDegree = this.continue(point)\n    const angleRad = convertDegreeToRadian(angleDegree) % (2 * Math.PI)\n    const oldSymbols = this.model.symbolsSelected.map(s => s.clone())\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.applyToSymbol(s, this.center, angleRad)\n      this.editor.renderer.drawSymbol(s)\n      this.model.updateSymbol(s)\n    })\n    const strokesFromSymbols = this.editor.extractStrokesFromSymbols(this.model.symbolsSelected)\n    this.editor.recognizer.transformRotate(strokesFromSymbols.map(s => s.id), angleRad, this.center.x, this.center.y)\n    this.editor.history.push(this.model, { rotate: [{ symbols: oldSymbols, angle: angleRad, center: {...this.center}, }] })\n\n    this.interactElementsGroup = undefined\n    this.editor.svgDebugger.apply()\n  }\n}\n","import { ResizeDirection, SELECTION_MARGIN, SvgElementRole } from \"../Constants\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { Box, IIText, SymbolType, TBox, TIIEdge, TIISymbol, TPoint } from \"../symbol\"\nimport { SVGRenderer, SVGBuilder } from \"../renderer\"\nimport { IIResizeManager } from \"./IIResizeManager\"\nimport { IIRotationManager } from \"./IIRotationManager\"\nimport { IITranslateManager } from \"./IITranslateManager\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\n\n/**\n * @group Manager\n */\nexport class IISelectionManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.SELECTION)\n  grabber: PointerEventGrabber\n  editor: InteractiveInkEditor\n\n  #selectingId = \"selecting-rect\"\n  startSelectionPoint?: TPoint\n  endSelectionPoint?: TPoint\n  selectedGroup?: SVGGElement\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.grabber = new PointerEventGrabber(editor.configuration.grabber)\n    this.grabber.onPointerDown = this.start.bind(this)\n    this.grabber.onPointerMove = this.continue.bind(this)\n    this.grabber.onPointerUp = this.end.bind(this)\n    this.grabber.onContextMenu = this.onContextMenu.bind(this)\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get rotator(): IIRotationManager\n  {\n    return this.editor.rotator\n  }\n\n  get translator(): IITranslateManager\n  {\n    return this.editor.translator\n  }\n\n  get resizer(): IIResizeManager\n  {\n    return this.editor.resizer\n  }\n\n  get selectionBox(): Box | undefined\n  {\n    if (this.startSelectionPoint && this.endSelectionPoint) {\n      return Box.createFromPoints([this.startSelectionPoint, this.endSelectionPoint])\n    }\n    return\n  }\n\n  attach(layer: HTMLElement): void\n  {\n    this.removeSelectedGroup()\n    this.grabber.attach(layer)\n  }\n\n  detach(): void\n  {\n    this.removeSelectedGroup()\n    this.grabber.detach()\n  }\n\n  drawSelectingRect(box: TBox): void\n  {\n    this.clearSelectingRect()\n    const attrs = {\n      id: this.#selectingId,\n      fill: \"transparent\",\n      stroke: \"grey\",\n      opacity: \"0.25\",\n    }\n    this.renderer.appendElement(SVGBuilder.createRect(box, attrs))\n  }\n\n  clearSelectingRect(): void\n  {\n    this.renderer.clearElements({ attrs: { id: this.#selectingId } })\n  }\n\n  protected getPoint(ev: PointerEvent): TPoint\n  {\n    const { clientLeft, scrollLeft, clientTop, scrollTop } = this.renderer.parent\n    const rect: DOMRect = this.renderer.parent.getBoundingClientRect()\n    return {\n      x: ev.clientX - rect.left - clientLeft + scrollLeft,\n      y: ev.clientY - rect.top - clientTop + scrollTop,\n    }\n  }\n\n  protected createTranslateRect(box: TBox): SVGRectElement\n  {\n    const attrs = {\n      role: SvgElementRole.Translate,\n      style: \"cursor:move\",\n      fill: \"transparent\",\n      stroke: \"transparent\",\n    }\n    const boxWithMarge: TBox = {\n      height: box.height,\n      width: box.width,\n      x: box.x,\n      y: box.y\n    }\n    const translateEl = SVGBuilder.createRect(boxWithMarge, attrs)\n    const handler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.translator.continue(this.getPoint(ev))\n    }\n    const endHandler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.translator.end(this.getPoint(ev))\n      this.renderer.layer.removeEventListener(\"pointermove\", handler)\n      this.renderer.layer.removeEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerup\", endHandler)\n      this.renderer.layer.style.cursor = \"\"\n      this.resetSelectedGroup(this.model.symbolsSelected)\n    }\n\n    translateEl.addEventListener(\"pointerdown\", (ev) =>\n    {\n      if (ev.button !== 0 || ev.buttons !== 1) {\n        return\n      }\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.hideInteractElements()\n      this.translator.start(ev.target as Element, this.getPoint(ev))\n      this.renderer.layer.addEventListener(\"pointermove\", handler)\n      this.renderer.layer.addEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerup\", endHandler)\n\n      this.renderer.layer.style.cursor = \"move\"\n    })\n    return translateEl\n  }\n\n  protected createRotateGroup(box: TBox): SVGGElement\n  {\n    const group = SVGBuilder.createGroup({\n      role: SvgElementRole.Rotate,\n      \"vector-effect\": \"non-scaling-size\",\n      \"style\": \"cursor:pointer;\",\n      \"opacity\": \"1\",\n    })\n    const radius = 8\n    const center: TPoint = {\n      x: (box.x + box.width / 2),\n      y: box.y - 4 * SELECTION_MARGIN\n    }\n    const attrs1 = {\n      role: SvgElementRole.Rotate,\n      \"stroke-width\": \"2\",\n      \"stroke\": \"black\",\n      fill: \"white\",\n    }\n    group.appendChild(SVGBuilder.createCircle(center, radius, attrs1))\n\n    const attrs2 = {\n      role: SvgElementRole.Rotate,\n      fill: \"black\",\n    }\n\n    group.appendChild(SVGBuilder.createCircle(center, radius / 2, attrs2))\n    const attrs3 = {\n      role: SvgElementRole.Rotate,\n      stroke: \"black\",\n      \"stroke-width\": \"2\"\n    }\n    group.appendChild(SVGBuilder.createLine({ x: center.x, y: center.y + radius }, { x: center.x, y: box.y - SELECTION_MARGIN }, attrs3))\n\n    const handler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.rotator.continue(this.getPoint(ev))\n    }\n    const endHandler = (ev: PointerEvent) =>\n    {\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.rotator.end(this.getPoint(ev))\n      this.renderer.layer.removeEventListener(\"pointermove\", handler)\n      this.renderer.layer.removeEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.removeEventListener(\"pointerup\", endHandler)\n      this.resetSelectedGroup(this.model.symbolsSelected)\n    }\n\n    group.addEventListener(\"pointerdown\", (ev) =>\n    {\n      if (ev.button !== 0 || ev.buttons !== 1) {\n        return\n      }\n      ev.preventDefault()\n      ev.stopPropagation()\n      this.hideInteractElements()\n      this.rotator.start(ev.target as Element, this.getPoint(ev))\n      this.renderer.layer.addEventListener(\"pointermove\", handler)\n      this.renderer.layer.addEventListener(\"pointercancel\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerleave\", endHandler)\n      this.renderer.layer.addEventListener(\"pointerup\", endHandler)\n    })\n    return group\n  }\n\n  protected createResizeGroup(box: TBox): SVGGElement\n  {\n    const group = SVGBuilder.createGroup({\n      role: SvgElementRole.Resize,\n      \"vector-effect\": \"non-scaling-size\",\n      \"stroke-width\": \"4\",\n      \"stroke\": \"#3e68ff\",\n    })\n    const P_NW: TPoint = { x: box.x - SELECTION_MARGIN, y: box.y - SELECTION_MARGIN }\n    const P_NE: TPoint = { x: box.x + box.width + SELECTION_MARGIN, y: box.y - SELECTION_MARGIN }\n    const P_SE: TPoint = { x: box.x + box.width + SELECTION_MARGIN, y: box.y + box.height + SELECTION_MARGIN }\n    const P_SW: TPoint = { x: box.x - SELECTION_MARGIN, y: box.y + box.height + SELECTION_MARGIN }\n\n    const bindEl = (el: SVGElement, transformOrigin: TPoint, cursor: string) =>\n    {\n      const handler = (ev: PointerEvent) =>\n      {\n        ev.preventDefault()\n        ev.stopPropagation()\n        this.resizer.continue(this.getPoint(ev))\n      }\n      const endHandler = (ev: PointerEvent) =>\n      {\n        ev.preventDefault()\n        ev.stopPropagation()\n        this.resizer.end(this.getPoint(ev))\n        this.renderer.layer.removeEventListener(\"pointermove\", handler)\n        this.renderer.layer.removeEventListener(\"pointercancel\", endHandler)\n        this.renderer.layer.removeEventListener(\"pointerleave\", endHandler)\n        this.renderer.layer.removeEventListener(\"pointerup\", endHandler)\n\n        this.renderer.layer.style.cursor = \"\"\n        this.resetSelectedGroup(this.model.symbolsSelected)\n      }\n\n      el.addEventListener(\"pointerdown\", (ev) =>\n      {\n        if (ev.button !== 0 || ev.buttons !== 1) {\n          return\n        }\n        ev.preventDefault()\n        ev.stopPropagation()\n        this.hideInteractElements()\n        this.renderer.layer.style.cursor = cursor\n        this.resizer.start(ev.target as Element, transformOrigin)\n        this.renderer.layer.addEventListener(\"pointermove\", handler)\n        this.renderer.layer.addEventListener(\"pointercancel\", endHandler)\n        this.renderer.layer.addEventListener(\"pointerleave\", endHandler)\n        this.renderer.layer.addEventListener(\"pointerup\", endHandler)\n      })\n    }\n\n    const sideResizeDefs = [\n      { direction: ResizeDirection.North, p1: P_NW, p2: P_NE, transformOrigin: { x: box.x + box.width / 2, y: box.y + box.height } },\n      { direction: ResizeDirection.East, p1: P_NE, p2: P_SE, transformOrigin: { x: box.x, y: box.y + box.height / 2 } },\n      { direction: ResizeDirection.South, p1: P_SW, p2: P_SE, transformOrigin: { x: box.x + box.width / 2, y: box.y } },\n      { direction: ResizeDirection.West, p1: P_NW, p2: P_SW, transformOrigin: { x: box.x + box.width, y: box.y + box.height / 2 } },\n    ]\n    sideResizeDefs.forEach(def =>\n    {\n      const attrs = {\n        role: SvgElementRole.Resize,\n        \"resize-direction\": def.direction,\n        \"transform-origin\": JSON.stringify(def.transformOrigin),\n        style: `cursor:${ def.direction };`\n      }\n      const lineResize = SVGBuilder.createLine(def.p1, def.p2, attrs)\n      bindEl(lineResize, def.transformOrigin, def.direction)\n      group.appendChild(lineResize)\n    })\n    const cornerResizeDefs = [\n      { direction: ResizeDirection.NorthWest, p: P_NW, transformOrigin: { x: box.x + box.width, y: box.y + box.height } },\n      { direction: ResizeDirection.NorthEast, p: P_NE, transformOrigin: { x: box.x, y: box.y + box.height } },\n      { direction: ResizeDirection.SouthEast, p: P_SE, transformOrigin: { x: box.x, y: box.y } },\n      { direction: ResizeDirection.SouthWest, p: P_SW, transformOrigin: { x: box.x + box.width, y: box.y } },\n    ]\n    cornerResizeDefs.forEach(def =>\n    {\n      const attrs = {\n        \"stroke-width\": \"4\",\n        role: SvgElementRole.Resize,\n        \"resize-direction\": def.direction,\n        \"transform-origin\": JSON.stringify(def.transformOrigin),\n        transform: \"scale(1, 1)\",\n        fill: \"white\",\n        style: `cursor:${ def.direction };`\n      }\n      const cornerResize = SVGBuilder.createCircle(def.p, 5, attrs)\n      bindEl(cornerResize, def.transformOrigin, def.direction)\n      group.appendChild(cornerResize)\n    })\n    return group\n  }\n\n  protected createInteractElementsGroup(symbols: TIISymbol[]): SVGGElement | undefined\n  {\n    this.#logger.info(\"createInteractElementsGroup\", { symbols })\n\n    if (!symbols.length) return\n\n    const symbolElementMap = symbols.map(s =>\n    {\n      return {\n        symbol: s,\n        element: this.renderer.getElementById(s.id),\n      }\n    })\n\n    const box1 = Box.createFromBoxes(symbols.map(s =>\n    {\n      return {\n        x: s.bounds.x - (s.style.width || 1),\n        y: s.bounds.y - (s.style.width || 1),\n        height: s.bounds.height + (s.style.width || 1) * 2,\n        width: s.bounds.width + (s.style.width || 1) * 2,\n      }\n    }))\n\n    const box2 = Box.createFromPoints(symbols.flatMap(s => s.vertices))\n    const box = Box.createFromBoxes([box1, box2])\n\n    const attrs = {\n      id: `selected-${ Date.now() }`,\n      role: SvgElementRole.InteractElementsGroup,\n    }\n    const surroundGroup = SVGBuilder.createGroup(attrs)\n    surroundGroup.appendChild(this.createTranslateRect(box))\n    surroundGroup.appendChild(this.createResizeGroup(box))\n    surroundGroup.appendChild(this.createRotateGroup(box))\n    const SURROUND_ATTRS = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"#3e68ff\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"4\",\n      \"vector-effect\": \"non-scaling-size\",\n      transform: \"rotate(0, 0, 0)\"\n    }\n    symbolElementMap.forEach(s =>\n    {\n      if (s.element) {\n        const bounds: TBox = {\n          x: s.symbol.bounds.x - (s.symbol.style.width || 1),\n          y: s.symbol.bounds.y - (s.symbol.style.width || 1),\n          height: s.symbol.bounds.height + (s.symbol.style.width || 1) * 2,\n          width: s.symbol.bounds.width + (s.symbol.style.width || 1) * 2,\n        }\n        if (s.symbol.type === SymbolType.Text) {\n          const t = s.symbol as IIText\n          SURROUND_ATTRS.transform = `rotate(${ t.rotation?.degree || 0 }, ${ t.rotation?.center.x || 0 }, ${ t.rotation?.center.y || 0 })`\n        }\n        else {\n          SURROUND_ATTRS.transform = \"rotate(0, 0, 0)\"\n        }\n        surroundGroup.prepend(SVGBuilder.createRect(bounds, SURROUND_ATTRS))\n      }\n    })\n    return surroundGroup\n  }\n\n  protected createEdgeResizeGroup(edge: TIIEdge): SVGGElement\n  {\n    const group = SVGBuilder.createGroup({\n      role: SvgElementRole.Resize,\n      \"vector-effect\": \"non-scaling-size\",\n      \"stroke-width\": \"4\",\n      \"stroke\": \"#3e68ff\",\n    })\n\n    const radius = 5\n    const attrs = {\n      role: SvgElementRole.Resize,\n      \"stroke-width\": \"4\",\n      \"stroke\": \"#3e68ff\",\n      fill: \"white\",\n      style: `cursor:grab;`\n    }\n    const bindEl = (el: SVGCircleElement, pointIndex: number) =>\n    {\n      const handler = (ev: PointerEvent) =>\n      {\n        ev.preventDefault()\n        ev.stopPropagation()\n        const point = this.getPoint(ev)\n        const { x, y } = this.editor.snaps.snapResize(point)\n        edge.vertices[pointIndex].x = x\n        edge.vertices[pointIndex].y = y\n        this.model.updateSymbol(edge)\n        this.renderer.drawSymbol(edge)\n      }\n      const endHandler = (ev: PointerEvent) =>\n      {\n        ev.preventDefault()\n        ev.stopPropagation()\n        const point = this.getPoint(ev)\n        const { x, y } = this.editor.snaps.snapResize(point)\n        edge.vertices[pointIndex].x = x\n        edge.vertices[pointIndex].y = y\n        this.renderer.layer.style.cursor = \"\"\n        this.editor.updateSymbol(edge)\n        this.renderer.layer.removeEventListener(\"pointermove\", handler)\n        this.renderer.layer.removeEventListener(\"pointercancel\", endHandler)\n        this.renderer.layer.removeEventListener(\"pointerleave\", endHandler)\n        this.renderer.layer.removeEventListener(\"pointerup\", endHandler)\n        this.editor.snaps.clearSnapToElementLines()\n        this.resetSelectedGroup(this.model.symbolsSelected)\n      }\n\n      el.addEventListener(\"pointerdown\", (ev) =>\n      {\n        if (ev.button !== 0 || ev.buttons !== 1) {\n          return\n        }\n        this.renderer.layer.style.cursor = \"grabbing\"\n        this.hideInteractElements()\n        ev.preventDefault()\n        ev.stopPropagation()\n        this.renderer.layer.addEventListener(\"pointermove\", handler)\n        this.renderer.layer.addEventListener(\"pointercancel\", endHandler)\n        this.renderer.layer.addEventListener(\"pointerleave\", endHandler)\n        this.renderer.layer.addEventListener(\"pointerup\", endHandler)\n      })\n    }\n    edge.vertices.forEach((p, i) =>\n    {\n      const pointEl = SVGBuilder.createCircle(p, radius, attrs)\n      bindEl(pointEl, i)\n      group.appendChild(pointEl)\n    })\n\n    return group\n  }\n\n  protected createInteractEdgeGroup(edge: TIIEdge): SVGGElement | undefined\n  {\n    this.#logger.info(\"createInteractEdgeGroup\", { edge })\n    const attrs = {\n      id: `selected-${ Date.now() }`,\n      role: SvgElementRole.InteractElementsGroup,\n    }\n    const surroundGroup = SVGBuilder.createGroup(attrs)\n    surroundGroup.appendChild(this.createTranslateRect(edge.bounds))\n    surroundGroup.appendChild(this.createEdgeResizeGroup(edge.clone()))\n    return surroundGroup\n  }\n\n  drawSelectedGroup(symbols: TIISymbol[]): void\n  {\n    if (!symbols.length) return\n    if (symbols.length === 1 && symbols[0].type === SymbolType.Edge) {\n      this.selectedGroup = this.createInteractEdgeGroup(symbols[0] as TIIEdge)\n    }\n    else {\n      this.selectedGroup = this.createInteractElementsGroup(symbols)\n    }\n    if (this.selectedGroup) {\n      this.renderer.layer.appendChild(this.selectedGroup)\n      const groupBox = this.selectedGroup.getBBox()\n      this.editor.menu.context.position.x = groupBox.x + groupBox.width / 2 - this.renderer.parent.clientLeft\n      this.editor.menu.context.position.y = groupBox.y + groupBox.height - this.renderer.parent.clientTop\n      this.editor.menu.context.show()\n    }\n    this.editor.menu.update()\n  }\n\n  resetSelectedGroup(symbols: TIISymbol[]): void\n  {\n    this.#logger.info(\"resetSelectedGroup\", { symbols })\n    this.removeSelectedGroup()\n    this.drawSelectedGroup(symbols)\n  }\n\n  removeSelectedGroup(): void\n  {\n    this.#logger.info(\"removeSelectedGroup\")\n    this.editor.menu.context.hide()\n    this.selectedGroup?.remove()\n    this.selectedGroup = undefined\n  }\n\n  hideInteractElements(): void\n  {\n    this.editor.menu.context.hide()\n    const query = `[role=${ SvgElementRole.Resize }],[role=${ SvgElementRole.Rotate }],[role=${ SvgElementRole.Translate }]`\n    this.selectedGroup?.querySelectorAll(query)\n      .forEach(el =>\n      {\n        el.setAttribute(\"visibility\", \"hidden\")\n      })\n  }\n\n  start(info: PointerInfo): void\n  {\n    this.removeSelectedGroup()\n    this.startSelectionPoint = info.pointer\n    this.endSelectionPoint = info.pointer\n    this.drawSelectingRect(this.selectionBox!)\n  }\n\n  continue(info: PointerInfo): TIISymbol[]\n  {\n    if (!this.startSelectionPoint) {\n      throw new Error(\"You need to call startSelectionByBox before\")\n    }\n    this.endSelectionPoint = info.pointer\n    const updatedSymbols: TIISymbol[] = []\n    this.model.symbols.forEach(s =>\n    {\n      if (s.selected !== s.overlaps(this.selectionBox!)) {\n        s.selected = s.overlaps(this.selectionBox!)\n        updatedSymbols.push(s)\n        this.renderer.drawSymbol(s)\n      }\n    })\n    this.drawSelectingRect(this.selectionBox!)\n    return updatedSymbols\n  }\n\n  end(info: PointerInfo): TIISymbol[]\n  {\n    const updatedSymbols = this.continue(info)\n    this.startSelectionPoint = undefined\n    this.endSelectionPoint = undefined\n    this.clearSelectingRect()\n    this.drawSelectedGroup(this.model.symbolsSelected)\n    this.editor.event.emitSelected(this.model.symbolsSelected)\n    this.editor.menu.style.update()\n    return updatedSymbols\n  }\n\n  protected async onContextMenu(info: PointerInfo): Promise<void>\n  {\n    let found = false\n    let currentEl = info.target as HTMLElement | null\n    const symbolTypesAllowed = [SymbolType.Edge, SymbolType.Shape, SymbolType.Stroke, SymbolType.Text]\n    while (currentEl && currentEl.tagName !== \"svg\" && !found) {\n      if (symbolTypesAllowed.includes(currentEl.getAttribute(\"type\") as SymbolType)) {\n        found = true\n      }\n      else {\n        currentEl = currentEl.parentElement\n      }\n    }\n    this.editor.unselectAll()\n    if (currentEl?.id) {\n      this.model.selectSymbol(currentEl.id)\n      this.renderer.drawSymbol(this.model.symbolsSelected[0])\n      this.drawSelectedGroup(this.model.symbolsSelected)\n      this.editor.updateLayerUI()\n    }\n    else {\n      this.editor.menu.context.position.x = info.pointer.x + this.renderer.parent.clientLeft\n      this.editor.menu.context.position.y = info.pointer.y + this.renderer.parent.clientTop\n      this.editor.menu.context.show()\n    }\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { Box, IIText, SymbolType, TIISymbol, TIISymbolChar } from \"../symbol\"\nimport { SVGRenderer } from \"../renderer\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\n\n/**\n * @group Manager\n */\nexport class IITextManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.CONVERTER)\n  editor: InteractiveInkEditor\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get rowHeight(): number\n  {\n    return this.editor.configuration.rendering.guides.gap\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  protected drawSymbolHidden(text: IIText): SVGGElement\n  {\n    const clone = text.clone()\n    clone.id = \"text-to-measure\"\n    clone.chars.forEach(c => c.id += \"-to-measure\")\n    clone.decorators = []\n    this.renderer.layer.querySelector(`#${ clone.id }`)?.remove()\n    const el = this.renderer.buildElementFromSymbol(clone)!\n    el.setAttribute(\"visibility\", \"hidden\")\n    this.renderer.prependElement(el)\n    return el\n  }\n\n  setCharsBounds(text: IIText, textGroupEl: SVGGElement): IIText\n  {\n    const textEl = textGroupEl.querySelector(\"text\")\n    if (textEl) {\n      for (let i = 0; i < textEl.getNumberOfChars(); i++) {\n        const char = text.chars.at(i)\n        if (char) {\n          const ext = textEl.getExtentOfChar(i)\n          char.bounds = new Box(ext)\n        }\n      }\n    }\n    return text\n  }\n\n  setBounds(text: IIText): void\n  {\n    const element = this.drawSymbolHidden(text)\n    text.bounds = this.getElementBoundingBox(element)\n    this.setCharsBounds(text, element)\n  }\n\n  getElementBoundingBox(textElement: SVGElement): Box\n  {\n    return new Box(textElement.querySelector(\"text\")!.getBBox({ stroke: true, markers: true, clipped: true, fill: true }))\n  }\n\n  getBoundingBox(text: IIText): Box\n  {\n    const element = this.drawSymbolHidden(text)\n    return this.getElementBoundingBox(element)\n  }\n\n  getSpaceWidth(fontSize: number): number\n  {\n    const boundingBox = new Box({ height: 0, width: 0, x: 0, y: 0 })\n    const charSymbol: TIISymbolChar = {\n      id: `text-char-space`,\n      label: \"-\",\n      color: \"\",\n      fontSize,\n      fontWeight: \"normal\",\n      bounds: boundingBox\n    }\n    return this.getBoundingBox(new IIText([charSymbol], { x: 0, y: 0 }, boundingBox))?.width as number\n  }\n\n  updateBounds(textSymbol: IIText): IIText\n  {\n    this.setBounds(textSymbol)\n    this.model.updateSymbol(textSymbol)\n    return textSymbol\n  }\n\n  moveTextAfter(text: IIText, tx: number): TIISymbol[] | undefined\n  {\n    const row = this.model.getSymbolsByRowOrdered().find(r => r.rowIndex === this.model.getSymbolRowIndex(text))\n    if (row) {\n      const textsAfter = row.symbols.filter(s => s.type === SymbolType.Text && s.bounds.xMid > text.bounds.xMid) as IIText[]\n      textsAfter.forEach(symbol => {\n        symbol.point.x += tx\n        this.updateBounds(symbol)\n        this.model.updateSymbol(symbol)\n        this.renderer.drawSymbol(symbol)\n      })\n      return textsAfter\n    }\n    return\n  }\n}\n","import { SvgElementRole } from \"../Constants\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport\n{\n  EdgeKind,\n  IIStroke,\n  IIText,\n  IISymbolGroup,\n  ShapeKind,\n  SymbolType,\n  TIIEdge,\n  TIIShape,\n  TIISymbol,\n  TPoint,\n  TIIRecognized,\n  RecognizedKind\n} from \"../symbol\"\n\n/**\n * @group Manager\n */\nexport class IITranslateManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.TRANSFORMER)\n  editor: InteractiveInkEditor\n  interactElementsGroup?: SVGElement\n  transformOrigin!: TPoint\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  protected applyToStroke(stroke: IIStroke, tx: number, ty: number): IIStroke\n  {\n    stroke.pointers.forEach(p =>\n    {\n      p.x += tx\n      p.y += ty\n    })\n    return stroke\n  }\n\n  protected applyToShape(shape: TIIShape, tx: number, ty: number): TIIShape\n  {\n    switch (shape.kind) {\n      case ShapeKind.Ellipse:\n      case ShapeKind.Circle: {\n        shape.center.x += tx\n        shape.center.y += ty\n        return shape\n      }\n      case ShapeKind.Polygon: {\n        shape.points.forEach(p =>\n        {\n          p.x += tx\n          p.y += ty\n        })\n        return shape\n      }\n      default:\n        throw new Error(`Can't apply translate on shape, kind unknow: ${ JSON.stringify(shape) }`)\n    }\n  }\n\n  protected applyToEdge(edge: TIIEdge, tx: number, ty: number): TIIEdge\n  {\n    switch (edge.kind) {\n      case EdgeKind.Arc: {\n        edge.center.x += tx\n        edge.center.y += ty\n        return edge\n      }\n      case EdgeKind.Line: {\n        edge.start.x += tx\n        edge.start.y += ty\n        edge.end.x += tx\n        edge.end.y += ty\n        return edge\n      }\n      case EdgeKind.PolyEdge: {\n        edge.points.forEach(p =>\n        {\n          p.x += tx\n          p.y += ty\n        })\n        return edge\n      }\n    }\n\n    return edge\n  }\n\n  protected applyOnText(text: IIText, tx: number, ty: number): IIText\n  {\n    if (text.rotation) {\n      text.rotation.center = { x: text.rotation.center.x + tx, y: text.rotation.center.y + ty }\n    }\n    text.point.x += tx\n    text.point.y += ty\n    return this.editor.texter.updateBounds(text)\n  }\n\n  protected applyOnGroup(group: IISymbolGroup, tx: number, ty: number): IISymbolGroup\n  {\n    group.children.forEach(s => this.applyToSymbol(s, tx, ty))\n    return group\n  }\n\n  protected applyOnRecognizedSymbol(recognizedSymbol: TIIRecognized, tx: number, ty: number): TIIRecognized\n  {\n    recognizedSymbol.strokes.forEach(s => this.applyToStroke(s, tx, ty))\n    if (recognizedSymbol.kind === RecognizedKind.Text) {\n      recognizedSymbol.baseline += ty\n    }\n    return recognizedSymbol\n  }\n\n  applyToSymbol(symbol: TIISymbol, tx: number, ty: number): TIISymbol\n  {\n    this.#logger.info(\"applyToSymbol\", { symbol, tx, ty })\n    switch (symbol.type) {\n      case SymbolType.Stroke:\n        return this.applyToStroke(symbol, tx, ty)\n      case SymbolType.Shape:\n        return this.applyToShape(symbol, tx, ty)\n      case SymbolType.Edge:\n        return this.applyToEdge(symbol, tx, ty)\n      case SymbolType.Text:\n        return this.applyOnText(symbol, tx, ty)\n      case SymbolType.Group:\n        return this.applyOnGroup(symbol, tx, ty)\n      case SymbolType.Recognized:\n        return this.applyOnRecognizedSymbol(symbol, tx, ty)\n      default:\n        throw new Error(`Can't apply translate on symbol, type unknow: ${ JSON.stringify(symbol) }`)\n    }\n  }\n\n  translate(symbols: TIISymbol[], tx: number, ty: number, addToHistory = true): Promise<void>\n  {\n    this.#logger.info(\"translate\", { symbols, tx, ty })\n    symbols.forEach(s =>\n    {\n      this.applyToSymbol(s, tx, ty)\n      this.model.updateSymbol(s)\n      this.editor.renderer.drawSymbol(s)\n    })\n    if (addToHistory) {\n      this.editor.history.push(this.model, { translate: [{ symbols: this.model.symbolsSelected, tx, ty }] })\n    }\n    const strokes = this.editor.extractStrokesFromSymbols(symbols)\n    return this.editor.recognizer.transformTranslate(strokes.map(s => s.id), tx, ty)\n  }\n\n  translateElement(id: string, tx: number, ty: number): void\n  {\n    this.#logger.info(\"translateElement\", { id, tx, ty })\n    this.editor.renderer.setAttribute(id, \"transform\", `translate(${ tx },${ ty })`)\n  }\n\n  start(target: Element, origin: TPoint): void\n  {\n    this.#logger.info(\"start\", { origin })\n    this.interactElementsGroup = (target.closest(`[role=${ SvgElementRole.InteractElementsGroup }]`) as unknown) as SVGGElement\n    this.transformOrigin = origin\n  }\n\n  continue(point: TPoint): { tx: number, ty: number }\n  {\n    this.#logger.info(\"continue\", { point })\n    if (!this.interactElementsGroup) {\n      throw new Error(\"Can't translate, you must call start before\")\n    }\n\n    let tx = point.x - this.transformOrigin.x\n    let ty = point.y - this.transformOrigin.y\n\n    const nudge = this.editor.snaps.snapTranslate(tx, ty)\n    tx = nudge.x\n    ty = nudge.y\n\n    this.translateElement(this.interactElementsGroup.id as string, tx, ty)\n    this.model.symbolsSelected.forEach(s =>\n    {\n      this.translateElement(s.id as string, tx, ty)\n    })\n    return {\n      tx,\n      ty\n    }\n  }\n\n  async end(point: TPoint): Promise<void>\n  {\n    this.#logger.info(\"end\", { point })\n    const { tx, ty } = this.continue(point)\n    this.editor.snaps.clearSnapToElementLines()\n    this.translate(this.model.symbolsSelected, tx, ty)\n\n    this.interactElementsGroup = undefined\n    this.editor.svgDebugger.apply()\n  }\n\n}\n","import { SELECTION_MARGIN, EditorWriteTool } from \"../Constants\"\nimport { TGesture } from \"../gesture\"\nimport { IIModel } from \"../model\"\nimport\n{\n  EdgeDecoration,\n  EdgeKind,\n  IIEdgeLine,\n  IIShapePolygon,\n  IIShapeCircle,\n  IIShapeEllipse,\n  IIStroke,\n  SymbolType,\n  TIIEdge,\n  TIISymbol,\n  TPoint,\n  TPointer\n} from \"../symbol\"\nimport { RecognizerWebSocket } from \"../recognizer\"\nimport { SVGRenderer } from \"../renderer\"\nimport { TStyle } from \"../style\"\nimport { IIHistoryManager } from \"../history\"\nimport { IIGestureManager } from \"../gesture/IIGestureManager\"\nimport { IISnapManager } from \"../snap/IISnapManager\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { PointerInfo } from \"../grabber\"\nimport { AbstractWriterManager } from \"./AbstractWriterManager\"\n\n\n/**\n * @group Manager\n */\nexport class IIWriterManager extends AbstractWriterManager\n{\n  #tool: EditorWriteTool = EditorWriteTool.Pencil\n  detectGesture: boolean = true\n  editor: InteractiveInkEditor\n  currentSymbolOrigin?: TPoint\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    super(editor)\n    this.editor = editor\n  }\n\n  get tool(): EditorWriteTool\n  {\n    return this.#tool\n  }\n  set tool(wt: EditorWriteTool)\n  {\n    this.#tool = wt\n    if (wt !== EditorWriteTool.Pencil) {\n      this.editor.layers.root.classList.add(\"shape\")\n    }\n    else {\n      this.editor.layers.root.classList.remove(\"shape\")\n    }\n    this.editor.unselectAll()\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get history(): IIHistoryManager\n  {\n    return this.editor.history\n  }\n\n  get gestureManager(): IIGestureManager\n  {\n    return this.editor.gesture\n  }\n\n  get snaps(): IISnapManager\n  {\n    return this.editor.snaps\n  }\n\n  get recognizer(): RecognizerWebSocket\n  {\n    return this.editor.recognizer\n  }\n\n  attach(layer: HTMLElement): void\n  {\n    this.grabber.attach(layer)\n    this.grabber.onPointerDown = this.start.bind(this)\n    this.grabber.onPointerMove = this.continue.bind(this)\n    this.grabber.onPointerUp = this.end.bind(this)\n  }\n\n  detach(): void\n  {\n    this.grabber.detach()\n  }\n\n  protected needContextLessGesture(stroke: IIStroke): boolean\n  {\n    const strokeBoundsWithMargin = this.editor.getSymbolsBounds([stroke], 2 * SELECTION_MARGIN)\n    return this.detectGesture && this.model.symbols.some(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Recognized:\n        case SymbolType.Stroke:\n          return false\n        case SymbolType.Group:\n          if (s.containsOnlyStroke()) {\n            return false\n          }\n          else {\n            return s.bounds.overlaps(strokeBoundsWithMargin)\n          }\n        default:\n          return s.bounds.overlaps(strokeBoundsWithMargin)\n      }\n    })\n  }\n\n  protected createCurrentSymbol(pointer: TPointer, style: TStyle, pointerType: string): TIISymbol\n  {\n    switch (this.tool) {\n      case EditorWriteTool.Pencil:\n        this.model.currentSymbol = new IIStroke(style, pointerType)\n        break\n      case EditorWriteTool.Rectangle:\n        this.model.currentSymbol = IIShapePolygon.createRectangleBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Triangle:\n        this.model.currentSymbol = IIShapePolygon.createTriangleBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Parallelogram:\n        this.model.currentSymbol = IIShapePolygon.createParallelogramBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Rhombus:\n        this.model.currentSymbol = IIShapePolygon.createRhombusBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Circle:\n        this.model.currentSymbol = IIShapeCircle.createBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Ellipse:\n        this.model.currentSymbol = IIShapeEllipse.createBetweenPoints(pointer, pointer, style)\n        break\n      case EditorWriteTool.Line:\n      case EditorWriteTool.Arrow:\n      case EditorWriteTool.DoubleArrow: {\n        let startDecoration, endDecoration\n        if (this.tool === EditorWriteTool.Arrow) {\n          endDecoration = EdgeDecoration.Arrow\n        }\n        else if (this.tool === EditorWriteTool.DoubleArrow) {\n          startDecoration = EdgeDecoration.Arrow\n          endDecoration = EdgeDecoration.Arrow\n        }\n        this.model.currentSymbol = new IIEdgeLine(pointer, pointer, startDecoration, endDecoration, style)\n        break\n      }\n      default:\n        throw new Error(`Can't create symbol, tool is unknow: \"${ this.tool }\"`)\n    }\n    return this.updateCurrentSymbol(pointer)\n  }\n\n  protected updateCurrentSymbolShape(pointer: TPointer): void\n  {\n    switch (this.tool) {\n      case EditorWriteTool.Rectangle:\n        IIShapePolygon.updateRectangleBetweenPoints(this.model.currentSymbol as IIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case EditorWriteTool.Triangle:\n        IIShapePolygon.updateTriangleBetweenPoints(this.model.currentSymbol as IIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case EditorWriteTool.Parallelogram:\n        IIShapePolygon.updateParallelogramBetweenPoints(this.model.currentSymbol as IIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case EditorWriteTool.Rhombus:\n        IIShapePolygon.updateRhombusBetweenPoints(this.model.currentSymbol as IIShapePolygon, this.currentSymbolOrigin!, pointer)\n        break\n      case EditorWriteTool.Circle:\n        IIShapeCircle.updateBetweenPoints(this.model.currentSymbol as IIShapeCircle, this.currentSymbolOrigin!, pointer)\n        break\n      case EditorWriteTool.Ellipse:\n        IIShapeEllipse.updateBetweenPoints(this.model.currentSymbol as IIShapeEllipse, this.currentSymbolOrigin!, pointer)\n        break\n    }\n  }\n\n  protected updateCurrentSymbolEdge(pointer: TPointer): void\n  {\n    const edge = this.model.currentSymbol as TIIEdge\n    switch (edge.kind) {\n      case EdgeKind.Line:\n        edge.end = pointer\n        break\n    }\n  }\n\n  protected updateCurrentSymbol(pointer: TPointer): TIISymbol\n  {\n    if (!this.model.currentSymbol) {\n      throw new Error(\"Can't update current symbol because currentSymbol is undefined\")\n    }\n\n    switch (this.model.currentSymbol.type) {\n      case SymbolType.Stroke:\n        this.model.currentSymbol!.addPointer(pointer)\n        break\n      case SymbolType.Shape:\n        this.updateCurrentSymbolShape(pointer)\n        break\n      case SymbolType.Edge:\n        this.updateCurrentSymbolEdge(pointer)\n        break\n    }\n    return this.model.currentSymbol\n  }\n\n  start(info: PointerInfo): void\n  {\n    const localPointer = info.pointer\n    if (this.tool !== EditorWriteTool.Pencil) {\n      const { x, y } = this.snaps.snapResize(localPointer)\n      localPointer.x = x\n      localPointer.y = y\n    }\n    this.currentSymbolOrigin = localPointer\n    this.createCurrentSymbol(localPointer, this.editor.penStyle, info.pointerType)\n    this.renderer.drawSymbol(this.model.currentSymbol!)\n  }\n\n  continue(info: PointerInfo): void\n  {\n    const localPointer = info.pointer\n    if (this.tool !== EditorWriteTool.Pencil) {\n      const { x, y } = this.snaps.snapResize(localPointer)\n      localPointer.x = x\n      localPointer.y = y\n    }\n    this.updateCurrentSymbol(localPointer)\n    this.renderer.drawSymbol(this.model.currentSymbol!)\n  }\n\n  protected async interactWithBackend(stroke: IIStroke): Promise<void>\n  {\n    const localStroke = stroke.clone()\n    let gestureFromContextLess: TGesture | undefined\n    if (this.needContextLessGesture(stroke)) {\n      gestureFromContextLess = await this.gestureManager.getGestureFromContextLess(localStroke)\n    }\n    if (gestureFromContextLess) {\n      this.history.pop()\n      this.recognizer.addStrokes([localStroke], this.detectGesture)\n      await this.gestureManager.apply(localStroke, gestureFromContextLess)\n    }\n    else {\n      const gesture = await this.recognizer.addStrokes([localStroke], this.detectGesture)\n      if (gesture) {\n        this.history.pop()\n        await this.gestureManager.apply(localStroke, gesture)\n      }\n    }\n  }\n\n  async end(info: PointerInfo): Promise<void>\n  {\n    const localPointer = info.pointer\n    if (this.tool !== EditorWriteTool.Pencil) {\n      const { x, y } = this.snaps.snapResize(localPointer)\n      localPointer.x = x\n      localPointer.y = y\n    }\n    const localSymbol = this.updateCurrentSymbol(localPointer)\n    this.model.currentSymbol = undefined\n    this.currentSymbolOrigin = undefined\n    this.snaps.clearSnapToElementLines()\n\n    this.renderer.drawSymbol(localSymbol!)\n    this.model.addSymbol(localSymbol)\n    this.history.push(this.model, { added: [localSymbol] })\n\n    if (localSymbol.type === SymbolType.Stroke) {\n      await this.interactWithBackend(localSymbol)\n    }\n  }\n}\n","import { LoggerManager, LoggerCategory } from \"../logger\"\nimport { IIModel, JIIXEdgeKind } from \"../model\"\nimport { Box, IIText, SymbolType, TBox, TIISymbol } from \"../symbol\"\nimport { SVGRenderer, SVGRendererConst, SVGBuilder } from \"../renderer\"\nimport { convertBoundingBoxMillimeterToPixel, createUUID } from \"../utils\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\n\n/**\n * @group Manager\n */\nexport class IIDebugSVGManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.SVGDEBUG)\n  #snapPointsVisibility = false\n  #verticesVisibility = false\n  #boundingBoxVisibility = false\n  #recognitionBoxVisibility = false\n  #recognitionItemBoxVisibility = false\n\n  editor: InteractiveInkEditor\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get snapPointsVisibility(): boolean\n  {\n    return this.#snapPointsVisibility\n  }\n  set snapPointsVisibility(show: boolean)\n  {\n    this.#snapPointsVisibility = show\n    this.debugSnapPoints()\n  }\n\n  get verticesVisibility(): boolean\n  {\n    return this.#verticesVisibility\n  }\n  set verticesVisibility(show: boolean)\n  {\n    this.#verticesVisibility = show\n    this.debugVertices()\n  }\n\n  get boundingBoxVisibility(): boolean\n  {\n    return this.#boundingBoxVisibility\n  }\n  set boundingBoxVisibility(show: boolean)\n  {\n    this.#boundingBoxVisibility = show\n    // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n    this.#boundingBoxVisibility ? this.showBoundingBox() : this.hideBoundingBox()\n  }\n\n  get recognitionBoxVisibility(): boolean\n  {\n    return this.#recognitionBoxVisibility\n  }\n  set recognitionBoxVisibility(show: boolean)\n  {\n    this.#recognitionBoxVisibility = show\n    this.debugRecognitionBox()\n  }\n\n  get recognitionItemBoxVisibility(): boolean\n  {\n    return this.#recognitionItemBoxVisibility\n  }\n  set recognitionItemBoxVisibility(show: boolean)\n  {\n    this.#recognitionItemBoxVisibility = show\n    this.debugRecognitionItemBox()\n  }\n\n  protected showSnapPoints(): void\n  {\n    this.#logger.info(\"showSnapPoints\")\n    if (this.model.currentSymbol) {\n      this.model.currentSymbol.snapPoints.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"blue\", \"debug\": \"snap-points\" }))\n    }\n    this.model.symbols.forEach(s => s.snapPoints.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"blue\", \"debug\": \"snap-points\" })))\n  }\n  protected hideSnapPoints(): void\n  {\n    this.#logger.info(\"hideSnapPoints\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"snap-points\" } })\n  }\n  debugSnapPoints(): void\n  {\n    this.hideSnapPoints()\n    if (this.snapPointsVisibility) {\n      this.showSnapPoints()\n    }\n  }\n\n  protected showVertices(): void\n  {\n    this.#logger.info(\"showVertices\")\n    if (this.model.currentSymbol) {\n      this.model.currentSymbol.vertices.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"red\", \"debug\": \"vertices\" }))\n    }\n    this.model.symbols.forEach(s => s.vertices.forEach(p => this.renderer.drawCircle(p, 2, { fill: \"red\", \"debug\": \"vertices\" })))\n  }\n  protected hideVertices(): void\n  {\n    this.#logger.info(\"hideVertices\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"vertices\" } })\n  }\n  debugVertices(): void\n  {\n    this.hideVertices()\n    if (this.verticesVisibility) {\n      this.showVertices()\n    }\n  }\n\n  protected drawBoundingBox(symbols: TIISymbol[]): void\n  {\n    const symbolAttrs = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"red\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"5 5\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"debug\": \"bounding-box\"\n    }\n    const charAttrs = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"orange\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"0 5 0\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"debug\": \"bounding-box\"\n    }\n    symbols.forEach(s =>\n    {\n      const symEl = this.renderer.getElementById(s.id)\n      if (symEl) {\n        if (s.type === SymbolType.Text) {\n          const text = s as IIText\n          let transform: string = \"\"\n          if (text.rotation) {\n            transform = `rotate(${ text.rotation.degree }, ${ text.rotation.center.x }, ${ text.rotation.center.y })`\n          }\n          text.chars.forEach(c =>\n          {\n            const ca = {\n              ...charAttrs,\n              char: c.label,\n              transform\n            }\n            symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(c.bounds, ca))\n          })\n          const sa = {\n            ...symbolAttrs,\n            symbol: s.id,\n            transform\n          }\n          symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(s.bounds, sa))\n        }\n        else {\n          const sa = {\n            ...symbolAttrs,\n            symbol: s.id,\n          }\n          symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(s.bounds, sa))\n        }\n      }\n    })\n  }\n  protected showBoundingBox(): void\n  {\n    this.#logger.info(\"showBoundingBox\")\n    if (this.model.currentSymbol) {\n      this.drawBoundingBox([this.model.currentSymbol])\n    }\n    this.drawBoundingBox(this.model.symbols)\n  }\n  protected hideBoundingBox(): void\n  {\n    this.#logger.info(\"hideBoundingBox\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"bounding-box\" } })\n  }\n  debugBoundingBox(): void\n  {\n    this.hideBoundingBox()\n    if (this.boundingBoxVisibility) {\n      this.showBoundingBox()\n    }\n  }\n\n  protected drawRecognitionBox(box: TBox, infos?: string[]): void\n  {\n    const COLOR = \"green\"\n    const TEXT_HEIGHT = 20\n    const recognitionGroup = SVGBuilder.createGroup({ \"debug\": \"recognition-box\" })\n\n    const rect = SVGBuilder.createRect(box, { fill: \"transparent\", stroke: COLOR, style: SVGRendererConst.noSelection })\n    recognitionGroup.appendChild(rect)\n\n    const infosGroup = SVGBuilder.createGroup({ id: `infos-group-${ createUUID() }` })\n    const infoX = box.x + box.width\n    let infoY = box.y + TEXT_HEIGHT / 2\n    infos?.forEach(w =>\n    {\n      infosGroup.appendChild(SVGBuilder.createText({ x: infoX, y: infoY }, w, { stroke: COLOR, style: SVGRendererConst.noSelection }))\n      infoY += TEXT_HEIGHT\n    })\n    recognitionGroup.appendChild(infosGroup)\n    this.renderer.layer.appendChild(recognitionGroup)\n\n    const infosGroupBox = infosGroup.getBBox()\n    const rectBox = {\n      width: infosGroupBox.width + 10,\n      height: infosGroupBox.height + 10,\n      x: infosGroupBox.x - 5,\n      y: infosGroupBox.y - 5,\n    }\n    const rectTranslate = SVGBuilder.createRect(rectBox, { fill: \"white\", style: \"cursor:move\", stroke: COLOR })\n    infosGroup.prepend(rectTranslate)\n\n    const translateEl = (e: PointerEvent) =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      const originX = Number(this.renderer.getAttribute(infosGroup.id, \"originX\"))\n      const originY = Number(this.renderer.getAttribute(infosGroup.id, \"originY\"))\n      const tx = e.clientX - originX\n      const ty = e.clientY - originY\n      this.renderer.setAttribute(infosGroup.id, \"transform\", `translate(${ tx },${ ty })`)\n      const newRectBox = {\n        width: rectBox.width,\n        height: rectBox.height,\n        x: rectBox.x + tx,\n        y: rectBox.y + ty,\n      }\n      this.renderer.removeSymbol(`connection-${ infosGroup.id }`)\n      this.renderer.drawConnectionBetweenBox(`connection-${ infosGroup.id }`, box, newRectBox, \"corners\", { stroke: COLOR, debug: \"recognition-box-link\" })\n    }\n\n    rectTranslate.addEventListener(\"pointerdown\", e =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      if (!this.renderer.getAttribute(infosGroup.id, \"originX\")) {\n        this.renderer.setAttribute(infosGroup.id, \"originX\", e.clientX.toString())\n        this.renderer.setAttribute(infosGroup.id, \"originY\", e.clientY.toString())\n      }\n      this.renderer.layer.addEventListener(\"pointermove\", translateEl)\n      this.renderer.layer.addEventListener(\"pointerup\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n      this.renderer.layer.addEventListener(\"pointerleave\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n      this.renderer.layer.addEventListener(\"pointercancel\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n    })\n  }\n\n  protected async showRecognitionBox(): Promise<void>\n  {\n    this.#logger.info(\"showRecognitionBox\")\n    await this.editor.export([\"application/vnd.myscript.jiix\"])\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    this.#logger.debug(\"showRecognitionBox\", { jiix })\n    if (jiix) {\n      if (!jiix[\"bounding-box\"]) {\n        this.#logger.warn(\"drawRecognitionBox\", \"You must to enabled configuration.recognition.exports[\\\"bounding-box\\\"]\")\n        return\n      }\n      jiix.elements?.forEach(el =>\n      {\n        switch (el.type) {\n          case \"Node\": {\n            if (el[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              const hideProperties = [\"bounding-box\", \"items\", \"id\"]\n              const infos = Object.keys(el).filter(k => !hideProperties.includes(k)).map(k => `${ k }: ${ JSON.stringify(el[k as keyof typeof el]) }`)\n              this.drawRecognitionBox(box, infos)\n            }\n            break\n          }\n          case \"Text\": {\n            el.words?.forEach(w =>\n            {\n              if (w?.[\"bounding-box\"]) {\n                const box = convertBoundingBoxMillimeterToPixel(w[\"bounding-box\"])\n                this.drawRecognitionBox(box, [`type: ${ el.type }`, `candidates: ${ JSON.stringify(w.candidates || []) }`])\n              }\n            })\n            break\n          }\n          case \"Edge\": {\n            if (el.kind === JIIXEdgeKind.PolyEdge) {\n              const infos = [\n                `type: ${ el.type }`,\n                `kind: ${ el.kind }`,\n              ]\n              el.edges.forEach((e, i) =>\n              {\n                let inf = `edge-${ i }: [{ x1: ${ e.x1 }, y2: ${ e.y1 } },{ x2: ${ e.x2 }, y2: ${ e.y2 } }]`\n                if (e.p1Decoration) {\n                  inf += `, p1Decoration: ${ e.p1Decoration }`\n                }\n                if (e.p2Decoration) {\n                  inf += `, p2Decoration: ${ e.p2Decoration }`\n                }\n                infos.push(inf)\n              })\n              const box = convertBoundingBoxMillimeterToPixel(Box.createFromBoxes(el.edges.map(e => e[\"bounding-box\"] as TBox)))\n              this.drawRecognitionBox(box, infos)\n            }\n            else if (el[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              const hideProperties = [\"bounding-box\", \"items\", \"id\", \"ports\", \"connected\"]\n              const infos = Object.keys(el).filter(k => !hideProperties.includes(k)).map(k => `${ k }: ${ JSON.stringify(el[k as keyof typeof el]) }`)\n              this.drawRecognitionBox(box, infos)\n            }\n            break\n          }\n          default: {\n            this.#logger.warn(\"drawRecognitionBox\", `Unknow jiix element type: ${ el.type }`)\n            break\n          }\n        }\n      })\n    }\n  }\n  protected clearRecognitionBox(): void\n  {\n    this.#logger.info(\"clearRecognitionBox\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-box\" } })\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-box-link\" } })\n  }\n  async debugRecognitionBox(): Promise<void>\n  {\n    this.clearRecognitionBox()\n    if (this.#recognitionBoxVisibility) {\n      this.showRecognitionBox()\n    }\n  }\n\n  protected drawRecognitionItemBox(box: TBox, label?: string, chars?: string[]): void\n  {\n    const COLOR = \"blue\"\n    const CHAR_SIZE = 14\n\n    const recognitionItemGroup = SVGBuilder.createGroup({ \"debug\": \"recognition-item-box\" })\n    const rect = SVGBuilder.createRect(box, { fill: \"transparent\", stroke: COLOR, style: SVGRendererConst.noSelection })\n    recognitionItemGroup.appendChild(rect)\n\n    const charX = box.x\n    let charY = box.y - CHAR_SIZE\n\n    const charsGroup = SVGBuilder.createGroup({ id: `chars-group-${ createUUID() }` })\n    if (label) {\n      charsGroup.appendChild(SVGBuilder.createText({ x: charX, y: charY }, `label: ${ label }`, { fill: COLOR, \"font-size\": CHAR_SIZE.toString(), style: SVGRendererConst.noSelection }))\n    }\n    if (chars?.length) {\n      charY += CHAR_SIZE\n      charsGroup.appendChild(SVGBuilder.createText({ x: charX, y: charY }, `[${ chars.join(\", \") }]`, { fill: COLOR, \"font-size\": CHAR_SIZE.toString(), style: SVGRendererConst.noSelection }))\n    }\n\n    recognitionItemGroup.appendChild(charsGroup)\n    this.renderer.layer.appendChild(recognitionItemGroup)\n\n    const charsGroupBox = charsGroup.getBBox()\n    const rectBox = {\n      width: charsGroupBox.width + 10,\n      height: charsGroupBox.height + 10,\n      x: charsGroupBox.x - 5,\n      y: charsGroupBox.y - 5,\n    }\n    const rectTranslate = SVGBuilder.createRect(rectBox, { fill: \"white\", style: \"cursor:move\", stroke: COLOR })\n    charsGroup.prepend(rectTranslate)\n\n    const translateEl = (e: PointerEvent) =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      const originX = Number(this.renderer.getAttribute(charsGroup.id, \"originX\"))\n      const originY = Number(this.renderer.getAttribute(charsGroup.id, \"originY\"))\n      const tx = e.clientX - originX\n      const ty = e.clientY - originY\n      this.renderer.setAttribute(charsGroup.id, \"transform\", `translate(${ tx },${ ty })`)\n      const newRectBox = {\n        width: rectBox.width,\n        height: rectBox.height,\n        x: rectBox.x + tx,\n        y: rectBox.y + ty,\n      }\n      this.renderer.removeSymbol(`connection-${ charsGroup.id }`)\n      this.renderer.drawConnectionBetweenBox(`connection-${ charsGroup.id }`, box, newRectBox, \"corners\", { stroke: COLOR, debug: \"recognition-item-box-link\" })\n    }\n\n    rectTranslate.addEventListener(\"pointerdown\", e =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      if (!this.renderer.getAttribute(charsGroup.id, \"originX\")) {\n        this.renderer.setAttribute(charsGroup.id, \"originX\", e.clientX.toString())\n        this.renderer.setAttribute(charsGroup.id, \"originY\", e.clientY.toString())\n      }\n      this.renderer.layer.addEventListener(\"pointermove\", translateEl)\n    })\n    this.renderer.layer.addEventListener(\"pointerup\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n    this.renderer.layer.addEventListener(\"pointerleave\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n    this.renderer.layer.addEventListener(\"pointercancel\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n\n  }\n  protected async showRecognitionItemBox(): Promise<void>\n  {\n    this.#logger.info(\"showRecognitionBoxItem\")\n    await this.editor.export([\"application/vnd.myscript.jiix\"])\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    this.#logger.debug(\"showRecognitionBoxItem\", { jiix })\n    if (jiix) {\n      jiix.elements?.forEach(el =>\n      {\n        switch (el.type) {\n          case \"Text\": {\n            el.chars?.forEach(c =>\n            {\n              if (c?.[\"bounding-box\"]) {\n                const box = convertBoundingBoxMillimeterToPixel(c[\"bounding-box\"])\n                this.drawRecognitionItemBox(box, c.label, c.candidates)\n              }\n            })\n            break\n          }\n          case \"Node\": {\n            if (el?.[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              this.drawRecognitionItemBox(box, el.kind)\n            }\n            break\n          }\n          case \"Edge\": {\n            if (el.kind === JIIXEdgeKind.PolyEdge) {\n              el.edges.forEach(e =>\n              {\n                const box = convertBoundingBoxMillimeterToPixel(e[\"bounding-box\"])\n                this.drawRecognitionItemBox(box, e.kind)\n              })\n            }\n            else if (el[\"bounding-box\"]) {\n              const box = convertBoundingBoxMillimeterToPixel(el[\"bounding-box\"])\n              this.drawRecognitionItemBox(box, el.kind)\n            }\n            break\n          }\n          default:\n            this.#logger.warn(\"drawRecognitionBoxItem\", `Unknow jiix element type: ${ el.type }`)\n            break\n        }\n      })\n    }\n  }\n  protected clearRecognitionItemBox(): void\n  {\n    this.#logger.info(\"clearRecognitionBoxItem\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-item-box\" } })\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-item-box-link\" } })\n  }\n  async debugRecognitionItemBox(): Promise<void>\n  {\n    this.clearRecognitionItemBox()\n    if (this.#recognitionItemBoxVisibility) {\n      this.showRecognitionItemBox()\n    }\n  }\n\n  apply(): void\n  {\n    this.debugBoundingBox()\n    this.debugVertices()\n    this.debugSnapPoints()\n    this.debugRecognitionBox()\n    this.debugRecognitionItemBox()\n  }\n}\n","import { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\nimport { SVGRenderer } from \"../renderer\"\n\n/**\n * @group Manager\n */\nexport class IIMoveManager\n{\n  grabber: PointerEventGrabber\n  editor: InteractiveInkEditor\n\n  origin?: {\n    left: number,\n    top: number,\n    x: number,\n    y: number\n  }\n\n  constructor(editor: InteractiveInkEditor)\n  {\n    this.editor = editor\n    this.grabber = new PointerEventGrabber(editor.configuration.grabber)\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  attach(layer: HTMLElement): void\n  {\n    this.grabber.attach(layer)\n    this.grabber.onPointerDown = this.start.bind(this)\n    this.grabber.onPointerMove = this.continue.bind(this)\n    this.grabber.onPointerUp = this.end.bind(this)\n  }\n\n  detach(): void\n  {\n    this.grabber.detach()\n  }\n\n  start(info: PointerInfo): void\n  {\n    this.origin = {\n      left: this.renderer.parent.scrollLeft,\n      top: this.renderer.parent.scrollTop,\n      x: info.clientX,\n      y: info.clientY,\n    }\n  }\n\n  continue(info: PointerInfo): void\n  {\n    if (!this.origin) {\n      throw new Error(\"Can't move cause origin is undefined\")\n    }\n    const dx = info.clientX - this.origin.x\n    const dy = info.clientY - this.origin.y\n\n    this.renderer.parent.scrollTop = this.origin.top - dy\n    this.renderer.parent.scrollLeft = this.origin.left - dx\n  }\n\n  end(info: PointerInfo): void\n  {\n    this.continue(info)\n    this.origin = undefined\n  }\n}\n","import { LoggerManager, LoggerCategory } from \"../logger\"\nimport { IModel } from \"../model\"\nimport { Box, IIStroke, IIText, SymbolType, TBox, TIISymbol } from \"../symbol\"\nimport { SVGRenderer, SVGRendererConst, SVGBuilder } from \"../renderer\"\nimport { createUUID } from \"../utils\"\nimport { InkEditor } from \"../editor\"\n\n/**\n * @group Manager\n */\nexport class IDebugSVGManager {\n  #logger = LoggerManager.getLogger(LoggerCategory.SVGDEBUG)\n  #recognitionBoxVisibility = false\n  #recognitionBoxItemsVisibility = false\n  #recognitionBoxDrawing = false\n  #recognitionBoxItemsDrawing = false\n\n  editor: InkEditor\n\n  constructor(editor: InkEditor) {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get model(): IModel {\n    return this.editor.model\n  }\n\n  get renderer(): SVGRenderer {\n    return this.editor.renderer\n  }\n\n  get recognitionBoxVisibility(): boolean {\n    return this.#recognitionBoxVisibility\n  }\n\n  set recognitionBoxVisibility(show: boolean) {\n    this.#recognitionBoxVisibility = show\n    this.debugRecognitionBox()\n  }\n\n  get recognitionBoxItemsVisibility(): boolean {\n    return this.#recognitionBoxItemsVisibility\n  }\n\n  set recognitionBoxItemsVisibility(show: boolean) {\n    this.#recognitionBoxItemsVisibility = show\n    this.debugRecognitionBoxItems()\n  }\n\n  protected drawBoundingBox(symbols: TIISymbol[]): void {\n    const symbolAttrs = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"red\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"5 5\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"debug\": \"bounding-box\"\n    }\n    const charAttrs = {\n      style: \"pointer-events: none\",\n      fill: \"transparent\",\n      stroke: \"orange\",\n      \"stroke-width\": \"1\",\n      \"stroke-dasharray\": \"0 5 0\",\n      \"vector-effect\": \"non-scaling-stroke\",\n      \"debug\": \"bounding-box\"\n    }\n    symbols.forEach(s => {\n      const symEl = this.renderer.getElementById(s.id)\n      if (symEl) {\n        if (s.type === SymbolType.Text) {\n          const text = s as IIText\n          let transform: string = \"\"\n          if (text.rotation) {\n            transform = `rotate(${text.rotation.degree}, ${text.rotation.center.x}, ${text.rotation.center.y})`\n          }\n          text.chars.forEach(c => {\n            const ca = {\n              ...charAttrs,\n              char: c.label,\n              transform\n            }\n            symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(c.bounds, ca))\n          })\n          const sa = {\n            ...symbolAttrs,\n            symbol: s.id,\n            transform\n          }\n          symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(s.bounds, sa))\n        }\n        else {\n          const sa = {\n            ...symbolAttrs,\n            symbol: s.id,\n          }\n          symEl.insertAdjacentElement(\"beforebegin\", SVGBuilder.createRect(s.bounds, sa))\n        }\n      }\n    })\n  }\n\n  protected drawRecognitionBox(box: TBox, infos: string[], color: string, debugAttr: string): void {\n    const TEXT_HEIGHT = 20\n    const recognitionGroup = SVGBuilder.createGroup({ \"debug\": debugAttr, \"opacity\": debugAttr === \"recognition-box-items\" ? \"0.8\" : \"1\" })\n    const rectAttr = {\n      fill: \"transparent\",\n      stroke: color,\n      style: SVGRendererConst.noSelection,\n      \"stroke-dasharray\": debugAttr === \"recognition-box-items\" ? \"1 5 10\" : \"\",\n    }\n    const rect = SVGBuilder.createRect(box, rectAttr)\n    recognitionGroup.appendChild(rect)\n\n    const infosGroup = SVGBuilder.createGroup({ id: `infos-group-${createUUID()}` })\n    const infoX = box.x + box.width\n    let infoY = box.y + TEXT_HEIGHT / 2\n    infos?.forEach(w => {\n      infosGroup.appendChild(SVGBuilder.createText({ x: infoX, y: infoY }, w, { stroke: color, style: SVGRendererConst.noSelection }))\n      infoY += TEXT_HEIGHT\n    })\n    recognitionGroup.appendChild(infosGroup)\n    this.renderer.layer.appendChild(recognitionGroup)\n\n    const infosGroupBox = infosGroup.getBBox()\n    const rectBox = {\n      width: infosGroupBox.width + 10,\n      height: infosGroupBox.height + 10,\n      x: infosGroupBox.x - 5,\n      y: infosGroupBox.y - 5,\n    }\n\n    const rectTranslate = SVGBuilder.createRect(rectBox, { ...rectAttr, fill: \"white\", style: \"cursor:move\" })\n    infosGroup.prepend(rectTranslate)\n\n    const translateEl = (e: PointerEvent) => {\n      e.preventDefault()\n      e.stopPropagation()\n      const originX = Number(this.renderer.getAttribute(infosGroup.id, \"originX\"))\n      const originY = Number(this.renderer.getAttribute(infosGroup.id, \"originY\"))\n      const tx = e.clientX - originX\n      const ty = e.clientY - originY\n      this.renderer.setAttribute(infosGroup.id, \"transform\", `translate(${tx},${ty})`)\n      const newRectBox = {\n        width: rectBox.width,\n        height: rectBox.height,\n        x: rectBox.x + tx,\n        y: rectBox.y + ty,\n      }\n      this.renderer.removeSymbol(`connection-${infosGroup.id}`)\n      this.renderer.drawConnectionBetweenBox(`connection-${infosGroup.id}`, box, newRectBox, \"sides\", { stroke: color, debug: debugAttr })\n    }\n\n    rectTranslate.addEventListener(\"pointerdown\", e => {\n      e.preventDefault()\n      e.stopPropagation()\n      if (!this.renderer.getAttribute(infosGroup.id, \"originX\")) {\n        this.renderer.setAttribute(infosGroup.id, \"originX\", e.clientX.toString())\n        this.renderer.setAttribute(infosGroup.id, \"originY\", e.clientY.toString())\n      }\n      this.renderer.layer.addEventListener(\"pointermove\", translateEl)\n      this.renderer.layer.addEventListener(\"pointerup\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n      this.renderer.layer.addEventListener(\"pointerleave\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n      this.renderer.layer.addEventListener(\"pointercancel\", () => this.renderer.layer.removeEventListener(\"pointermove\", translateEl))\n    })\n  }\n\n  protected buildInfos(obj: object, currentPath = \"\"): string[] {\n    const infos: string[] = []\n    for (const key in obj) {\n      const value = obj[key as keyof typeof obj]\n      const localPath = currentPath ? `${currentPath}.${key}` : key\n      switch (typeof value) {\n        case \"object\":\n          infos.push(...this.buildInfos(value, localPath))\n          break\n        default:\n          infos.push(`${localPath}: ${JSON.stringify(value)}`)\n          break\n      }\n    }\n    return infos\n  }\n\n  protected async showRecognitionBox(): Promise<void> {\n    if(this.#recognitionBoxDrawing) return\n    this.#recognitionBoxDrawing = true\n    this.#logger.info(\"showRecognitionBox\")\n    let jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    if (!jiix) {\n      const exports = await this.editor.recognizer.send(this.model.strokes, [\"application/vnd.myscript.jiix\"])\n      jiix = exports[\"application/vnd.myscript.jiix\"]!\n    }\n    this.#logger.debug(\"showRecognitionBox\", { jiix })\n    if (jiix) {\n      jiix.elements?.forEach(el => {\n        switch (el.type) {\n          case \"Drawing\":\n          case \"Shape\": {\n            const associatedStrokes: IIStroke[] = []\n            el.range?.forEach(r => {\n              associatedStrokes.push(...this.model.strokes.slice(r.from.stroke, r.to.stroke + 1))\n            })\n            const box = Box.createFromBoxes(associatedStrokes.map(s => s.bounds))\n            let infos: string[] = [`type: ${el.type}`]\n            infos.push(...this.buildInfos(el))\n            const hideProperties = [\"bounding-box\", \"primitives\", \"range\", \"candidates\"]\n            infos = infos.filter(i => !hideProperties.some(h => i.indexOf(h) > -1))\n            const color = el.type === \"Shape\" ? \"orange\" : \"green\"\n            this.drawRecognitionBox(box, infos, color, \"recognition-box\")\n            break\n          }\n          case \"Text\": {\n            const associatedStrokes: IIStroke[] = []\n            el.range?.forEach(r => {\n              associatedStrokes.push(...this.model.strokes.slice(r.from.stroke, r.to.stroke + 1))\n            })\n            const box = Box.createFromBoxes(associatedStrokes.map(s => s.bounds))\n            this.drawRecognitionBox(box, [`type: ${el.type}`, `label: ${JSON.stringify(el.label || [])}`], \"blue\", \"recognition-box\")\n            break\n          }\n          case \"Math\": {\n            const associatedStrokes: IIStroke[] = []\n            el.range?.forEach(r => {\n              associatedStrokes.push(...this.model.strokes.slice(r.from.stroke, r.to.stroke + 1))\n            })\n            const box = Box.createFromBoxes(associatedStrokes.map(s => s.bounds))\n            let infos: string[] = [`type: ${el.type}`]\n            infos.push(...this.buildInfos(el))\n            const hideProperties = [\"bounding-box\", \"primitives\", \"range\", \"candidates\"]\n            infos = infos.filter(i => !hideProperties.some(h => i.indexOf(h) > -1))\n            this.drawRecognitionBox(box, infos, \"red\", \"recognition-box\")\n            break\n          }\n          default: {\n            this.#logger.warn(\"drawRecognitionBox\", `Unknow jiix element type: ${el.type}`)\n            break\n          }\n        }\n      })\n    }\n    this.#recognitionBoxDrawing = false\n  }\n\n  protected async showRecognitionBoxItems(): Promise<void> {\n    if(this.#recognitionBoxItemsDrawing) return\n    this.#recognitionBoxItemsDrawing = true\n    this.#logger.info(\"showRecognitionBoxItems\")\n    let jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    if (!jiix) {\n      const exports = await this.editor.recognizer.send(this.model.strokes, [\"application/vnd.myscript.jiix\"])\n      jiix = exports[\"application/vnd.myscript.jiix\"]!\n    }\n    this.#logger.debug(\"showRecognitionBoxItems\", { jiix })\n    if (jiix) {\n      jiix.elements?.forEach(el => {\n        switch (el.type) {\n          case \"Shape\": {\n            el.elements.forEach(e => {\n              const associatedStrokes: IIStroke[] = []\n              e.range?.forEach(r => {\n                associatedStrokes.push(...this.model.strokes.slice(r.from.stroke, r.to.stroke + 1))\n              })\n              const box = Box.createFromBoxes(associatedStrokes.map(s => s.bounds))\n              let infos: string[] = [`type: ${el.type}`]\n              infos.push(...this.buildInfos(e))\n              const hideProperties = [\"bounding-box\", \"primitives\", \"range\", \"candidates\"]\n              infos = infos.filter(i => !hideProperties.some(h => i.indexOf(h) > -1))\n              this.drawRecognitionBox(box, infos, \"#ce922a\", \"recognition-box-items\")\n            })\n            break\n          }\n          case \"Math\":\n          case \"Text\": {\n            el.lines?.forEach(e => {\n              e.spans?.forEach(s => {\n                const associatedStrokes: IIStroke[] = []\n                s.range.forEach(r => {\n                  associatedStrokes.push(...this.model.strokes.slice(r.from.stroke, r.to.stroke + 1))\n                })\n                const color = s.type === \"Math\" ? \"#ff6565\" : \"#099df7\"\n                const box = Box.createFromBoxes(associatedStrokes.map(s => s.bounds))\n                this.drawRecognitionBox(box, [`type: ${s.type}`, `label: ${JSON.stringify(s.label || [])}`], color, \"recognition-box-items\")\n              })\n            })\n            break\n          }\n\n          default: {\n            this.#logger.warn(\"drawRecognitionBox\", `Unknow jiix element type: ${el.type}`)\n            break\n          }\n        }\n      })\n    }\n    this.#recognitionBoxItemsDrawing = false\n  }\n\n  protected clearRecognitionBox(): void {\n    this.#logger.info(\"clearRecognitionBox\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-box\" } })\n  }\n\n  protected clearRecognitionBoxItems(): void {\n    this.#logger.info(\"clearRecognitionBoxItems\")\n    this.renderer.clearElements({ attrs: { \"debug\": \"recognition-box-items\" } })\n  }\n\n  async debugRecognitionBox(): Promise<void> {\n    this.clearRecognitionBox()\n    if (this.#recognitionBoxVisibility) {\n      this.showRecognitionBox()\n    }\n  }\n\n  async debugRecognitionBoxItems(): Promise<void> {\n    this.clearRecognitionBoxItems()\n    if (this.#recognitionBoxItemsVisibility) {\n      this.showRecognitionBoxItems()\n    }\n  }\n\n  apply(): void {\n    this.debugRecognitionBox()\n    this.debugRecognitionBoxItems()\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIEraser, TSegment } from \"../symbol\"\nimport { SVGRenderer } from \"../renderer\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\nimport { InkEditor } from \"../editor\"\n\n/**\n * @group Manager\n */\nexport class EraseManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.WRITE)\n  grabber: PointerEventGrabber\n  editor: InteractiveInkEditor | InkEditor\n\n  currentEraser?: IIEraser\n\n  constructor(editor: InteractiveInkEditor | InkEditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.grabber = new PointerEventGrabber(editor.configuration.grabber)\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  attach(layer: HTMLElement): void\n  {\n    this.grabber.attach(layer)\n    this.grabber.onPointerDown = this.start.bind(this)\n    this.grabber.onPointerMove = this.continue.bind(this)\n    this.grabber.onPointerUp = this.end.bind(this)\n  }\n\n  detach(): void\n  {\n    this.grabber.detach()\n  }\n\n  start(info: PointerInfo): void\n  {\n    this.#logger.info(\"startErase\", { info })\n    this.currentEraser = new IIEraser()\n    this.currentEraser.pointers.push(info.pointer)\n    this.renderer.drawSymbol(this.currentEraser!)\n  }\n\n  continue(info: PointerInfo): void\n  {\n    this.#logger.info(\"continueErase\", { info })\n    if (!this.currentEraser) {\n      throw new Error(\"Can't update current eraser because currentEraser is undefined\")\n    }\n    this.currentEraser.pointers.push(info.pointer)\n    this.renderer.drawSymbol(this.currentEraser)\n    const lastSeg: TSegment = {\n      p1: this.currentEraser.pointers.at(-1)!,\n      p2: this.currentEraser.pointers.at(-2)!\n    }\n    if (this.editor instanceof InteractiveInkEditor) {\n      this.editor.model.symbols.forEach(s =>\n      {\n        if (s.isIntersected(lastSeg)) {\n          s.deleting = true\n          this.renderer.drawSymbol(s)\n        }\n      })\n    }\n    else {\n      this.editor.model.strokes.forEach(s =>\n      {\n        if (s.isIntersected(lastSeg)) {\n          s.deleting = true\n          this.renderer.drawSymbol(s)\n        }\n      })\n    }\n  }\n\n  async end(info: PointerInfo): Promise<void>\n  {\n    this.#logger.info(\"finishErasing\", { info })\n    this.continue(info)\n\n    this.renderer.removeSymbol(this.currentEraser!.id)\n    if (this.editor instanceof InteractiveInkEditor) {\n      this.editor.removeSymbols(this.editor.model.symbolsToDelete.map(s => s.id))\n    }\n    else {\n      this.editor.removeStrokes(this.editor.model.strokesToDelete.map(s => s.id))\n    }\n    this.currentEraser = undefined\n  }\n}\n","/**\n * @group History\n */\nexport type THistoryContext = {\n  canUndo: boolean\n  canRedo: boolean\n  empty: boolean\n  stackIndex: number\n  possibleUndoCount: number\n}\n\n/**\n * @group History\n */\nexport const getInitialHistoryContext = (): THistoryContext => {\n  return {\n    stackIndex: 0,\n    possibleUndoCount: 0,\n    canRedo: false,\n    canUndo: false,\n    empty: true,\n  }\n}\n","import { EditorEvent } from \"../editor/EditorEvent\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { Model } from \"../model\"\nimport { THistoryConfiguration } from \"./HistoryConfiguration\"\nimport { THistoryContext, getInitialHistoryContext } from \"./HistoryContext\"\n\n/**\n * @group History\n */\nexport class HistoryManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.HISTORY)\n\n  configuration: THistoryConfiguration\n  event: EditorEvent\n  context: THistoryContext\n  stack: Model[]\n\n  constructor(configuration: THistoryConfiguration, event: EditorEvent)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n    this.event = event\n    this.context = getInitialHistoryContext()\n    this.stack = []\n  }\n\n  private updateContext(): void\n  {\n    this.context.canRedo = this.stack.length - 1 > this.context.stackIndex\n    this.context.canUndo = this.context.stackIndex > 0\n    this.context.empty = this.stack[this.context.stackIndex].symbols.length === 0\n  }\n\n  push(model: Model): void\n  {\n    this.#logger.info(\"push\", { model })\n    if (this.context.stackIndex + 1 < this.stack.length) {\n      this.stack.splice(this.context.stackIndex + 1)\n    }\n\n    this.stack.push(model.clone())\n    this.context.stackIndex = this.stack.length - 1\n\n    if (this.stack.length > this.configuration.maxStackSize) {\n      this.stack.shift()\n      this.context.stackIndex--\n    }\n\n    this.updateContext()\n    this.event.emitChanged(this.context)\n  }\n\n  updateStack(model: Model): void\n  {\n    this.#logger.info(\"updateStack\", { model })\n    const index = this.stack.findIndex(m => m.modificationDate === model.modificationDate)\n    if (index > -1) {\n      this.stack.splice(index, 1, model.clone())\n    }\n    this.updateContext()\n    this.event.emitChanged(this.context)\n  }\n\n  undo(): Model\n  {\n    this.#logger.info(\"undo\")\n    if (this.context.canUndo) {\n      this.context.stackIndex--\n      this.updateContext()\n      this.event.emitChanged(this.context)\n    }\n    const previousModel = this.stack[this.context.stackIndex].clone()\n    this.#logger.debug(\"undo\", previousModel)\n    return previousModel\n  }\n\n  redo(): Model\n  {\n    this.#logger.info(\"redo\")\n    if (this.context.canRedo) {\n      this.context.stackIndex++\n      this.updateContext()\n      this.event.emitChanged(this.context)\n    }\n    const nextModel = this.stack[this.context.stackIndex].clone()\n    this.#logger.debug(\"redo\", nextModel)\n    return nextModel\n  }\n}\n","import { EditorEvent } from \"../editor/EditorEvent\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { IIDecorator, IIStroke, TIISymbol, TPoint } from \"../symbol\"\nimport { TStyle } from \"../style\"\nimport { MatrixTransform, TMatrixTransform } from \"../transform\"\nimport { THistoryContext, getInitialHistoryContext } from \"./HistoryContext\"\nimport { PartialDeep } from \"../utils\"\nimport { THistoryConfiguration } from \"./HistoryConfiguration\"\n\n/**\n * @group History\n */\nexport type TIIHistoryChanges = {\n  added?: TIISymbol[]\n  updated?: TIISymbol[]\n  erased?: TIISymbol[]\n  replaced?: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] }\n  matrix?: { symbols: TIISymbol[], matrix: TMatrixTransform }\n  translate?: { symbols: TIISymbol[], tx: number, ty: number }[]\n  scale?: { symbols: TIISymbol[], scaleX: number, scaleY: number, origin: TPoint }[]\n  rotate?: { symbols: TIISymbol[], angle: number, center: TPoint }[]\n  style?: { symbols: TIISymbol[], style?: PartialDeep<TStyle>, fontSize?: number }\n  order?: { symbols: TIISymbol[], position: \"first\" | \"last\" | \"forward\" | \"backward\" }\n  decorator?: { symbol: TIISymbol, decorator: IIDecorator, added: boolean }[]\n  group?: { symbols: TIISymbol[] }\n  ungroup?: { group: TIISymbol }\n}\n\n/**\n * @group History\n * @remarks used to send messages to the backend on undo or redo\n */\nexport type TIIHistoryBackendChanges = {\n  added?: IIStroke[]\n  erased?: IIStroke[]\n  replaced?: { oldStrokes: IIStroke[], newStrokes: IIStroke[] }\n  matrix?: { strokes: IIStroke[], matrix: TMatrixTransform },\n  translate?: { strokes: IIStroke[], tx: number, ty: number }[]\n  scale?: { strokes: IIStroke[], scaleX: number, scaleY: number, origin: TPoint }[]\n  rotate?: { strokes: IIStroke[], angle: number, center: TPoint }[]\n}\n\n/**\n * @group History\n */\nexport type TIIHistoryStackItem = {\n  changes: TIIHistoryChanges\n  model: IIModel\n}\n\n/**\n * @group History\n */\nexport class IIHistoryManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.HISTORY)\n\n  configuration: THistoryConfiguration\n  event: EditorEvent\n  context: THistoryContext\n  stack: TIIHistoryStackItem[]\n\n  constructor(configuration: THistoryConfiguration, event: EditorEvent)\n  {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n    this.event = event\n    this.context = getInitialHistoryContext()\n    this.stack = []\n  }\n\n  private updateContext(): void\n  {\n    this.context.canRedo = this.stack.length - 1 > this.context.stackIndex\n    this.context.canUndo = this.context.stackIndex > 0\n    this.context.empty = this.stack[this.context.stackIndex].model.symbols.length === 0\n  }\n\n  isChangesEmpty(changes: TIIHistoryChanges): boolean\n  {\n    return !(\n      changes.added?.length ||\n      changes.updated?.length ||\n      changes.erased?.length ||\n      changes.replaced?.oldSymbols.length ||\n      changes.matrix?.symbols.length ||\n      changes.translate?.length ||\n      changes.rotate?.length ||\n      changes.scale?.length ||\n      changes.style?.symbols?.length ||\n      changes.order?.symbols?.length ||\n      changes.decorator?.length ||\n      changes.group?.symbols.length ||\n      changes.ungroup?.group\n    )\n  }\n\n  init(model: IIModel): void\n  {\n    this.stack.push({ model: model.clone(), changes: {} })\n    this.event.emitChanged(this.context)\n  }\n\n  push(model: IIModel, changes: TIIHistoryChanges): void\n  {\n    this.#logger.info(\"push\", { model, changes })\n    if (this.isChangesEmpty(changes)) return\n\n    if (this.context.stackIndex + 1 < this.stack.length) {\n      this.stack.splice(this.context.stackIndex + 1)\n    }\n\n    this.stack.push({ model: model.clone(), changes })\n    this.context.stackIndex = this.stack.length - 1\n\n    if (this.stack.length > this.configuration.maxStackSize) {\n      this.stack.shift()\n      this.context.stackIndex--\n    }\n\n    this.updateContext()\n    this.event.emitChanged(this.context)\n  }\n\n  update(model: IIModel): void\n  {\n    this.#logger.info(\"pop\")\n    const stackIdx = this.stack.findIndex(s => s.model.modificationDate === model.modificationDate)\n    if (stackIdx > -1) {\n      this.stack[stackIdx].model = model\n      this.updateContext()\n    }\n  }\n\n  pop(): void\n  {\n    this.#logger.info(\"pop\")\n    this.stack.pop()\n    this.context.stackIndex = this.stack.length - 1\n    this.updateContext()\n  }\n\n  protected reverseChanges(changes: TIIHistoryChanges): TIIHistoryChanges\n  {\n    const reversedChanges: TIIHistoryChanges = {}\n    if (changes.added) {\n      reversedChanges.erased = changes.added\n    }\n    if (changes.erased) {\n      reversedChanges.added = changes.erased\n    }\n    if (changes.replaced) {\n      reversedChanges.replaced = {\n        newSymbols: changes.replaced.oldSymbols,\n        oldSymbols: changes.replaced.newSymbols\n      }\n    }\n    if (changes.matrix) {\n      reversedChanges.matrix = {\n        symbols: changes.matrix.symbols,\n        matrix: new MatrixTransform(changes.matrix.matrix.xx, changes.matrix.matrix.yx, changes.matrix.matrix.xy, changes.matrix.matrix.yy, changes.matrix.matrix.tx, changes.matrix.matrix.ty).invert()\n      }\n    }\n    if (changes.translate?.length) {\n      reversedChanges.translate = changes.translate.map(tr =>\n      {\n        return {\n          symbols: tr.symbols,\n          tx: -tr.tx,\n          ty: -tr.ty,\n        }\n      })\n    }\n    if (changes.rotate?.length) {\n      reversedChanges.rotate = changes.rotate.map(tr =>\n      {\n        return {\n          symbols: tr.symbols,\n          angle: 2 * Math.PI - tr.angle,\n          center: tr.center\n        }\n      })\n    }\n    if (changes.scale?.length) {\n      reversedChanges.scale = changes.scale.map(tr =>\n      {\n        return {\n          symbols: tr.symbols,\n          origin: tr.origin,\n          scaleX: 1 / tr.scaleX,\n          scaleY: 1 / tr.scaleY\n        }\n      })\n    }\n\n    return reversedChanges\n  }\n\n  undo(): TIIHistoryStackItem\n  {\n    this.#logger.info(\"undo\")\n    const currentStackItem = this.stack[this.context.stackIndex]\n    if (this.context.canUndo) {\n      this.context.stackIndex--\n      this.updateContext()\n      this.event.emitChanged(this.context)\n    }\n    const previousStackItem = this.stack[this.context.stackIndex]\n    this.#logger.debug(\"undo\", previousStackItem)\n    return {\n      model: previousStackItem.model,\n      changes: this.reverseChanges(currentStackItem.changes)\n    }\n  }\n\n  redo(): TIIHistoryStackItem\n  {\n    this.#logger.info(\"redo\")\n    if (this.context.canRedo) {\n      this.context.stackIndex++\n      this.updateContext()\n      this.event.emitChanged(this.context)\n    }\n    const nextStackItem = this.stack[this.context.stackIndex]\n    this.#logger.debug(\"redo\", nextStackItem)\n    return nextStackItem\n  }\n\n  clear(): void\n  {\n    this.context = getInitialHistoryContext()\n    this.stack = []\n  }\n}","import { EditorEvent } from \"../editor/EditorEvent\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IModel } from \"../model\"\nimport { IIStroke, TIISymbol } from \"../symbol\"\nimport { THistoryContext, getInitialHistoryContext } from \"./HistoryContext\"\nimport { THistoryConfiguration } from \"./HistoryConfiguration\"\n\n/**\n * @group History\n */\nexport type TIHistoryChanges = {\n  added?: TIISymbol[]\n  removed?: TIISymbol[]\n}\n\n/**\n * @group History\n * @remarks used to send messages to the backend on undo or redo\n */\nexport type TIHistoryBackendChanges = {\n  added?: IIStroke[]\n  removed?: IIStroke[]\n}\n\n/**\n * @group History\n */\nexport type TIHistoryStackItem = {\n  changes: TIHistoryChanges\n  model: IModel\n}\n\n/**\n * @group History\n */\nexport class IHistoryManager {\n  #logger = LoggerManager.getLogger(LoggerCategory.HISTORY)\n\n  configuration: THistoryConfiguration\n  event: EditorEvent\n  context: THistoryContext\n  stack: TIHistoryStackItem[]\n\n  constructor(configuration: THistoryConfiguration, event: EditorEvent) {\n    this.#logger.info(\"constructor\", { configuration })\n    this.configuration = configuration\n    this.event = event\n    this.context = getInitialHistoryContext()\n    this.stack = []\n  }\n\n  private updateContext(): void {\n    this.context.canRedo = this.stack.length - 1 > this.context.stackIndex\n    this.context.canUndo = this.context.stackIndex > 0\n    this.context.empty = this.stack[this.context.stackIndex].model.strokes.length === 0\n  }\n\n  updateModelStack(model: IModel): void {\n    this.#logger.info(\"updateModelStack\", { model })\n    const stackIdx = this.stack.findIndex(s => s.model.modificationDate === model.modificationDate)\n    if (stackIdx > -1) {\n      this.stack[stackIdx].model = model.clone()\n      this.updateContext()\n    }\n    this.updateContext()\n    this.event.emitChanged(this.context)\n  }\n\n  isChangesEmpty(changes: TIHistoryChanges): boolean {\n    return !(\n      changes.added?.length ||\n      changes.removed?.length\n    )\n  }\n\n  init(model: IModel): void {\n    this.stack.push({ model: model.clone(), changes: {} })\n    this.event.emitChanged(this.context)\n  }\n\n  push(model: IModel, changes: TIHistoryChanges): void {\n    this.#logger.info(\"push\", { model, changes })\n    if (this.isChangesEmpty(changes)) return\n\n    if (this.context.stackIndex + 1 < this.stack.length) {\n      this.stack.splice(this.context.stackIndex + 1)\n    }\n\n    this.stack.push({ model: model.clone(), changes })\n    this.context.stackIndex = this.stack.length - 1\n\n    if (this.stack.length > this.configuration.maxStackSize) {\n      this.stack.shift()\n      this.context.stackIndex--\n    }\n\n    this.updateContext()\n    this.event.emitChanged(this.context)\n  }\n\n  pop(): void {\n    this.#logger.info(\"pop\")\n    this.stack.pop()\n    this.context.stackIndex = this.stack.length - 1\n    this.updateContext()\n  }\n\n  protected reverseChanges(changes: TIHistoryChanges): TIHistoryChanges {\n    const reversedChanges: TIHistoryChanges = {}\n    if (changes.added) {\n      reversedChanges.removed = changes.added\n    }\n    if (changes.removed) {\n      reversedChanges.added = changes.removed\n    }\n    return reversedChanges\n  }\n\n  undo(): TIHistoryStackItem {\n    this.#logger.info(\"undo\")\n    const currentStackItem = this.stack[this.context.stackIndex]\n    if (this.context.canUndo) {\n      this.context.stackIndex--\n      this.updateContext()\n      this.event.emitChanged(this.context)\n    }\n    const previousStackItem = this.stack[this.context.stackIndex]\n    this.#logger.debug(\"undo\", previousStackItem)\n    return {\n      model: previousStackItem.model,\n      changes: this.reverseChanges(currentStackItem.changes)\n    }\n  }\n\n  redo(): TIHistoryStackItem {\n    this.#logger.info(\"redo\")\n    if (this.context.canRedo) {\n      this.context.stackIndex++\n      this.updateContext()\n      this.event.emitChanged(this.context)\n    }\n    const nextStackItem = this.stack[this.context.stackIndex]\n    this.#logger.debug(\"redo\", nextStackItem)\n    return nextStackItem\n  }\n\n  clear(): void {\n    this.context = getInitialHistoryContext()\n    this.stack = []\n  }\n}\n","\n/**\n * @group History\n */\nexport type THistoryConfiguration = {\n  maxStackSize: number\n}\n\n/**\n * @group History\n * @source\n */\nexport const DefaultHistoryConfiguration: THistoryConfiguration = {\n  maxStackSize: 100\n}\n","/**\n * @group Menu\n * @remarks Helper functions to reduce boilerplate code in menu creation\n */\n\n/**\n * Creates a button element with common menu button styling\n * @param id - The button ID\n * @param innerHTML - The button content (can be HTML/SVG icon)\n * @param onClick - The click handler function\n * @param additionalClasses - Optional additional CSS classes\n * @returns The configured button element\n */\nexport function createMenuButton(\n  id: string,\n  innerHTML: string,\n  onClick: () => void,\n  additionalClasses: string[] = []\n): HTMLButtonElement {\n  const btn = document.createElement(\"button\")\n  btn.id = id\n  btn.classList.add(\"ms-menu-button\", \"square\", ...additionalClasses)\n  btn.innerHTML = innerHTML\n  btn.addEventListener(\"pointerup\", onClick)\n  return btn\n}\n\n/**\n * Creates a button with text content instead of HTML\n * @param id - The button ID\n * @param textContent - The button text\n * @param onClick - The click handler function\n * @param additionalClasses - Optional additional CSS classes\n * @returns The configured button element\n */\nexport function createMenuButtonWithText(\n  id: string,\n  textContent: string,\n  onClick: () => void,\n  additionalClasses: string[] = []\n): HTMLButtonElement {\n  const btn = document.createElement(\"button\")\n  btn.id = id\n  btn.classList.add(\"ms-menu-button\", ...additionalClasses)\n  btn.textContent = textContent\n  btn.addEventListener(\"pointerup\", onClick)\n  return btn\n}\n","import ArrowDown from \"../assets/svg/nav-arrow-down.svg\"\nimport { createMenuButtonWithText } from \"./MenuHelper\"\n\n/**\n * @group Menu\n */\nexport type TMenuItem = {\n  id: string,\n  label: string,\n  type: \"button\" | \"checkbox\" | \"select\" | \"list\" | \"colors\"\n  disabled?: boolean\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemButton = TMenuItem & {\n  type: \"button\"\n  icon?: string\n  callback: () => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemButtonList = TMenuItem & {\n  type: \"list\"\n  initValue: string,\n  values: { label: string, value: string }[]\n  callback: (value: string) => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemColorList = TMenuItem & {\n  type: \"colors\"\n  initValue: string,\n  values: string[]\n  fill: boolean\n  callback: (value: string) => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemBoolean = TMenuItem & {\n  type: \"checkbox\",\n  initValue: boolean | \"indeterminate\",\n  callback: (value: boolean) => void\n}\n\n/**\n * @group Menu\n */\nexport type TMenuItemSelect = TMenuItem & {\n  type: \"select\",\n  initValue: string,\n  values: { label: string, value: string }[]\n  callback: (value: string) => void\n}\n\n/**\n * @group Menu\n */\nexport abstract class IIMenu\n{\n  thicknessList = [\n    { label: \"S\", value: 1 },\n    { label: \"M\", value: 2 },\n    { label: \"L\", value: 4 },\n    { label: \"XL\", value: 8 },\n  ]\n\n  fontSizeList = [\n    { label: \"Auto\", value: \"auto\" },\n    { label: \"S\", value: 0.5 },\n    { label: \"M\", value: 0.75 },\n    { label: \"L\", value: 1 },\n  ]\n\n  fontWeightList = [\n    { label: \"Auto\", value: \"auto\" },\n    { label: \"Normal\", value: \"normal\" },\n    { label: \"Bold\", value: \"bold\" },\n  ]\n\n  colors = [\n    \"#000000\", \"#808080\", \"#ffffff\", \"transparent\",\n    \"#ff0000\", \"#ff6400\", \"#ffc800\", \"#ffff00\",\n    \"#0000ff\", \"#0064ff\", \"#00c8ff\", \"#00ffff\",\n    \"#008000\", \"#00af00\", \"#00e100\", \"#00ff00\"\n  ]\n\n  protected createWrapCollapsible(el: Node, title: string): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"collapsible-wrapper\")\n    const head = document.createElement(\"div\")\n    head.classList.add(\"collapsible-header\")\n    head.textContent = title\n    const btn = document.createElement(\"span\")\n    btn.classList.add(\"collapsible-header-icon\")\n    btn.innerHTML = ArrowDown\n    head.appendChild(btn)\n    head.style.setProperty(\"pointer\", \"cursor\")\n    const content = document.createElement(\"div\")\n    content.classList.add(\"collapsible-content\")\n    head.addEventListener(\"pointerup\", () => wrapper.classList.toggle(\"active\"))\n    wrapper.appendChild(head)\n    content.appendChild(el)\n    wrapper.appendChild(content)\n    return wrapper\n  }\n\n  protected createMenuItemBoolean(item: TMenuItemBoolean): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    const checkbox = document.createElement(\"input\")\n    checkbox.id = item.id\n    checkbox.setAttribute(\"type\", \"checkbox\")\n    if (item.disabled) {\n      checkbox.disabled = true\n    }\n    if (item.initValue === \"indeterminate\") {\n      checkbox.indeterminate = true\n    } else {\n      checkbox.checked = item.initValue\n    }\n    checkbox.addEventListener(\"change\", (e) => item.callback((e.target as HTMLInputElement).checked))\n    wrapper.appendChild(checkbox)\n    return wrapper\n  }\n\n  protected createMenuItemSelect(item: TMenuItemSelect): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    const select = document.createElement(\"select\")\n    select.id = item.id\n    if (item.disabled) {\n      select.disabled = true\n    }\n    item.values.forEach(v =>\n    {\n      const selected = v.value === item.initValue\n      const opt = new Option(v.label, v.value.toString(), selected, selected)\n      select.appendChild(opt)\n    })\n    select.addEventListener(\"change\", (e) => item.callback((e.target as HTMLInputElement).value))\n    wrapper.appendChild(select)\n    return wrapper\n  }\n\n  protected createMenuItemButton(item: TMenuItemButton): HTMLElement\n  {\n    const btn = document.createElement(\"button\")\n    btn.classList.add(\"ms-menu-item\", \"ms-menu-button\")\n    btn.innerHTML = item.icon || item.label\n    btn.addEventListener(\"pointerup\", item.callback)\n    return btn\n  }\n\n  protected createMenuItemButtonList(item: TMenuItemButtonList): HTMLElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    wrapper.id = item.id\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    item.values.forEach((v) =>\n    {\n      const btn = createMenuButtonWithText(\n        `${item.id}-${ v.value }-btn`,\n        v.label,\n        () => {\n          item.callback(v.value)\n          wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n          btn.classList.add(\"active\")\n        },\n        item.initValue === v.value ? [\"active\"] : []\n      )\n      if (item.disabled) {\n        btn.disabled = true\n      }\n      wrapper.appendChild(btn)\n    })\n    return wrapper\n  }\n\n  protected createMenuItemColorList(item: TMenuItemColorList): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.classList.add(\"ms-menu-item\", item.type)\n    wrapper.id = item.id\n    const labelEl = document.createElement(\"span\")\n    labelEl.textContent = item.label\n    wrapper.appendChild(labelEl)\n    wrapper.appendChild(this.createColorList(item))\n    return wrapper\n  }\n\n  protected createColorList(item: TMenuItemColorList): HTMLDivElement\n  {\n    const list = document.createElement(\"div\")\n    list.id = `${ item.id }-list`\n    list.classList.add(\"ms-menu-row\", \"color-list\")\n    item.values.forEach((color) =>\n    {\n      const btn = document.createElement(\"button\")\n      if (item.disabled) {\n        btn.disabled = true\n      }\n      btn.id = `${ item.id }-${ color.replace(\"#\", \"\") }-btn`\n      btn.classList.add(\"ms-menu-button\", \"square\")\n      const colorEl = document.createElement(\"div\")\n      colorEl.classList.add(\"color\")\n      if (item.fill) {\n        colorEl.style.setProperty(\"background-color\", color)\n        colorEl.style.setProperty(\"border\", \"1px solid lightgrey\")\n      } else {\n        colorEl.style.setProperty(\"background-color\", \"transparent\")\n        colorEl.style.setProperty(\"border\", `3px solid ${ color }`)\n      }\n      if (color === \"#ffffff\") {\n        colorEl.style.setProperty(\"border\", \"1px solid black\")\n      }\n      if (color === \"transparent\") {\n        colorEl.style.setProperty(\"background-image\", \"linear-gradient(45deg, #AAA 10%, transparent 20%, #AAA 30%, transparent 40%, #AAA 50%, transparent 60%, #AAA 70%, transparent 80%, #AAA 90%, transparent 100%)\")\n      }\n      if (item.initValue === color) {\n        btn.classList.add(\"active\")\n      }\n      btn.appendChild(colorEl)\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        item.callback(color)\n        list.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n      })\n      list!.appendChild(btn)\n    })\n    return list\n  }\n\n  protected createMenuItem(item: TMenuItem): HTMLElement\n  {\n    switch (item.type) {\n      case \"checkbox\":\n        return this.createMenuItemBoolean(item as TMenuItemBoolean)\n      case \"select\":\n        return this.createMenuItemSelect(item as TMenuItemSelect)\n      case \"list\":\n        return this.createMenuItemButtonList(item as TMenuItemButtonList)\n      case \"colors\":\n        return this.createMenuItemColorList(item as TMenuItemColorList)\n      case \"button\":\n      default:\n        return this.createMenuItemButton(item as TMenuItemButton)\n    }\n  }\n\n  abstract render(domElement: HTMLElement): void\n\n  abstract update(): void\n\n  abstract show(): void\n\n  abstract hide(): void\n\n  abstract destroy(): void\n}\n","\n/**\n * @group Gesture\n * @summary List all authorized gestures\n */\nexport type TGestureType = \"UNDERLINE\" | \"SCRATCH\" | \"JOIN\" | \"INSERT\" | \"STRIKETHROUGH\" | \"SURROUND\"\n\n/**\n * @group Gesture\n * @remarks\n *  when gestureType = \"INSERT\", subStrokes represent the two parts\n *  when gestureType = \"SCRATCH\", subStrokes represent the part to substract at the stroke corresponding fullStrokeId\n */\nexport type TGesture = {\n  gestureType: TGestureType\n  gestureStrokeId: string\n  strokeIds: string[]\n  strokeBeforeIds: string[]\n  strokeAfterIds: string[]\n  subStrokes?: { fullStrokeId: string, x: number[], y: number[] }[]\n}\n\n/**\n * @group Gesture\n * @summary\n * List all action allowed on surround detected\n * @remarks\n * only usable in the case of offscreen\n */\nexport enum SurroundAction\n{\n  Select = \"select\",\n  Surround = \"surround\",\n  Highlight = \"highlight\"\n}\n\n/**\n * @group Gesture\n * @summary\n * List all action allowed on strikeThrough detected\n * @remarks\n * only usable in the case of offscreen\n */\nexport enum StrikeThroughAction\n{\n  Erase = \"erase\",\n  Draw = \"draw\"\n}\n\n/**\n * @group Gesture\n * @summary\n * List all action allowed on split detected\n * @remarks\n * only usable in the case of offscreen\n */\nexport enum InsertAction\n{\n  /**\n   * @remarks Add line break on gesture place\n   */\n  LineBreak = \"line-break\",\n  /**\n   * @remarks Insert place in gesture place\n   */\n  Insert = \"insert\"\n}\n","import { InsertAction, StrikeThroughAction, SurroundAction } from \"./Gesture\"\n\n/**\n * @group Gesture\n * @source\n */\nexport type TGestureConfiguration = {\n  surround: SurroundAction\n  strikeThrough: StrikeThroughAction\n  insert: InsertAction\n}\n\n/**\n * @group Gesture\n * @source\n */\nexport const DefaultGestureConfiguration: TGestureConfiguration = {\n  surround: SurroundAction.Select,\n  strikeThrough: StrikeThroughAction.Draw,\n  insert: InsertAction.LineBreak\n}\n","import { EditorTool } from \"../Constants\"\nimport { LoggerManager, LoggerCategory } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport\n{\n  IIDecorator,\n  IIStroke,\n  SymbolType,\n  IIText,\n  DecoratorKind,\n  IISymbolGroup,\n  TIISymbol,\n  Box,\n  TPoint,\n  IIRecognizedText,\n  RecognizedKind,\n} from \"../symbol\"\nimport { RecognizerWebSocket } from \"../recognizer\"\nimport { SVGRenderer } from \"../renderer\"\nimport { IIHistoryManager, TIIHistoryChanges } from \"../history\"\nimport { computeAverage, isBetween, PartialDeep } from \"../utils\"\nimport { IITranslateManager } from \"../manager/IITranslateManager\"\nimport { IITextManager } from \"../manager/IITextManager\"\nimport { InteractiveInkEditor } from \"../editor\"\nimport { InsertAction, StrikeThroughAction, SurroundAction, TGesture } from \"./Gesture\"\nimport { DefaultGestureConfiguration, TGestureConfiguration } from \"./GestureConfiguration\"\n\n/**\n * @group Gesture\n */\nexport class IIGestureManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.GESTURE)\n\n  static readonly #DECORABLE_TYPES = new Set([SymbolType.Group, SymbolType.Stroke, SymbolType.Text, SymbolType.Recognized])\n  static readonly #TEXT_STROKE_GROUP_TYPES = new Set([SymbolType.Text, SymbolType.Stroke, SymbolType.Group])\n  static readonly #SURROUND_SELECT_TYPES = new Set([SymbolType.Group, SymbolType.Stroke, SymbolType.Text])\n  static readonly #ERASE_OVERLAY_TYPES = new Set([SymbolType.Stroke, SymbolType.Text, SymbolType.Group])\n  static readonly #ERASE_CONTAIN_TYPES = new Set([SymbolType.Shape, SymbolType.Edge])\n\n  insertAction: InsertAction = InsertAction.LineBreak\n  surroundAction: SurroundAction = SurroundAction.Select\n  strikeThroughAction: StrikeThroughAction = StrikeThroughAction.Draw\n  editor: InteractiveInkEditor\n\n  constructor(editor: InteractiveInkEditor, gestureAction?: PartialDeep<TGestureConfiguration>)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.surroundAction = gestureAction?.surround || DefaultGestureConfiguration.surround\n    this.strikeThroughAction = gestureAction?.strikeThrough || DefaultGestureConfiguration.strikeThrough\n    this.insertAction = gestureAction?.insert || DefaultGestureConfiguration.insert\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get recognizer(): RecognizerWebSocket\n  {\n    return this.editor.recognizer\n  }\n\n  get translator(): IITranslateManager\n  {\n    return this.editor.translator\n  }\n\n  get texter(): IITextManager\n  {\n    return this.editor.texter\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get history(): IIHistoryManager\n  {\n    return this.editor.history\n  }\n\n  get rowHeight(): number\n  {\n    return this.editor.configuration.rendering.guides.gap\n  }\n\n  get strokeSpaceWidth(): number\n  {\n    return this.editor.configuration.rendering.guides.gap * 2\n  }\n\n  async applySurroundGesture(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.info(\"applySurroundGesture\", { gestureStroke, gesture })\n    const changes: TIIHistoryChanges = {}\n    const ids = this.model.symbols.filter(s => gestureStroke.bounds.contains(s.bounds)).map(s => s.id)\n    switch (this.surroundAction) {\n      case SurroundAction.Select: {\n        if (ids.length) {\n          this.editor.tool = EditorTool.Select\n          this.editor.select(ids)\n        }\n        break\n      }\n      case SurroundAction.Highlight: {\n        const symbolIdSet = new Set<string>()\n        changes.decorator = []\n        ids.forEach(id =>\n        {\n          const sym = this.model.getRootSymbol(id)\n          if (sym && IIGestureManager.#DECORABLE_TYPES.has(sym.type) && !symbolIdSet.has(sym.id)) {\n            const symWithDec = sym as (IIText | IIStroke | IISymbolGroup | IIRecognizedText)\n            const highlight = new IIDecorator(DecoratorKind.Highlight, this.editor.penStyle)\n            const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Highlight)\n            const added = index === -1\n            // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n            added ? symWithDec.decorators.push(highlight) : symWithDec.decorators.splice(index, 1)\n            this.model.updateSymbol(symWithDec)\n            this.renderer.drawSymbol(symWithDec)\n            symbolIdSet.add(symWithDec.id)\n            changes.decorator!.push({ symbol: symWithDec, decorator: highlight, added })\n          }\n        })\n        if (changes.decorator.length) {\n          this.history.push(this.model, changes)\n        }\n        break\n      }\n      case SurroundAction.Surround: {\n        const symbolIdSet = new Set<string>()\n        changes.decorator = []\n        ids.forEach(id =>\n        {\n          const sym = this.model.getRootSymbol(id)\n          if (sym && IIGestureManager.#DECORABLE_TYPES.has(sym.type) && !symbolIdSet.has(sym.id)) {\n            const symWithDec = sym as (IIText | IIStroke | IISymbolGroup | IIRecognizedText)\n            const surround = new IIDecorator(DecoratorKind.Surround, this.editor.penStyle)\n            const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Surround)\n            const added = index === -1\n            // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n            added ? symWithDec.decorators.push(surround) : symWithDec.decorators.splice(index, 1)\n            this.model.updateSymbol(symWithDec)\n            this.renderer.drawSymbol(symWithDec)\n            changes.decorator!.push({ symbol: symWithDec, decorator: surround, added })\n            symbolIdSet.add(symWithDec.id)\n          }\n        })\n        this.history.push(this.model, changes)\n        break\n      }\n      default:\n        this.#logger.error(\"applySurroundGesture\", `Unknow surroundAction: ${ this.surroundAction }, values allowed are: ${ SurroundAction.Highlight }, ${ SurroundAction.Select }, ${ SurroundAction.Surround }`)\n        break\n    }\n    return\n  }\n\n  protected computeScratchOnStrokes(gesture: TGesture, stroke: IIStroke): IIStroke[]\n  {\n    const newStrokes: IIStroke[] = []\n    const partPointersToRemove = gesture.subStrokes?.find(ss => ss.fullStrokeId === stroke.id)\n    if (partPointersToRemove) {\n      const strokePartToErase = new IIStroke()\n      partPointersToRemove.x.forEach((x, i) => strokePartToErase.addPointer({ x, y: partPointersToRemove.y[i], p: 1, t: 1 }))\n      const subStrokes = IIStroke.substract(stroke, strokePartToErase)\n      if (subStrokes.before && subStrokes.before.pointers.length > 1) newStrokes.push(subStrokes.before)\n      if (subStrokes.after && subStrokes.after.pointers.length > 1) newStrokes.push(subStrokes.after)\n    }\n    return newStrokes\n  }\n\n  protected computeScratchOnText(gestureStroke: IIStroke, textSymbol: IIText): IIText | undefined\n  {\n    const charsToRemove = textSymbol.getCharsOverlaps(gestureStroke.pointers)\n    if (textSymbol.chars.length == charsToRemove.length) {\n      return\n    }\n    else {\n      charsToRemove.forEach(c =>\n      {\n        const cIndex = textSymbol.chars.findIndex(c1 => c1.id === c.id)\n        textSymbol.chars.splice(cIndex, 1)\n      })\n      this.texter.updateBounds(textSymbol)\n      return textSymbol\n    }\n  }\n\n  protected computeScratchOnSymbol(gestureStroke: IIStroke, gesture: TGesture, symbol: TIISymbol): { erased?: boolean, replaced?: TIISymbol[] }\n  {\n    switch (symbol.type) {\n      case SymbolType.Stroke: {\n        const strokesScratchedResult = this.computeScratchOnStrokes(gesture, symbol)\n        if (strokesScratchedResult.length) {\n          return {\n            replaced: strokesScratchedResult\n          }\n        }\n        else {\n          return { erased: true }\n        }\n      }\n      case SymbolType.Recognized: {\n        if (symbol.kind === RecognizedKind.Text) {\n          const childrenNotTouch = symbol.strokes.filter(s => !gestureStroke.bounds.overlaps(s.bounds))\n          const childrenTouch = symbol.strokes.filter(s => gestureStroke.bounds.overlaps(s.bounds))\n          const results = childrenTouch.map(s =>\n          {\n            return {\n              symbol: s,\n              result: this.computeScratchOnStrokes(gesture, s)\n            }\n          })\n          if (childrenNotTouch.length === 0 && results.every(r => r.result.length === 0)) {\n            return { erased: true }\n          }\n          else {\n            const strokesToConserve: IIStroke[] = childrenNotTouch.concat(...results.flatMap(r => r.result))\n            const strokeText = new IIRecognizedText(strokesToConserve, { baseline: symbol.baseline, xHeight: symbol.xHeight }, symbol.style)\n            strokeText.decorators = symbol.decorators\n            return {\n              replaced: [strokeText]\n            }\n          }\n        }\n        return {}\n      }\n      case SymbolType.Group: {\n        const childrenNotTouch = symbol.children.filter(s => !gestureStroke.bounds.overlaps(s.bounds))\n        const childrenTouch = symbol.children.filter(s => gestureStroke.bounds.overlaps(s.bounds))\n        const results = childrenTouch.map(s =>\n        {\n          return {\n            symbol: s,\n            result: this.computeScratchOnSymbol(gestureStroke, gesture, s)\n          }\n        })\n        if (childrenNotTouch.length === 0 && results.every(r => r.result.erased)) {\n          return { erased: true }\n        }\n        else {\n          const symbolsGroup: TIISymbol[] = childrenNotTouch\n          results.forEach(r =>\n          {\n            if (r.result.replaced) {\n              symbolsGroup.push(...r.result.replaced)\n            }\n          })\n          const newGroup = new IISymbolGroup(symbolsGroup, symbol.style)\n          newGroup.decorators = symbol.decorators\n          return {\n            replaced: [newGroup]\n          }\n        }\n      }\n      case SymbolType.Text: {\n        const textScratchedResult = this.computeScratchOnText(gestureStroke, symbol)\n        if (textScratchedResult) {\n          return {\n            replaced: [textScratchedResult]\n          }\n        }\n        else {\n          return {\n            erased: true\n          }\n        }\n      }\n      case SymbolType.Shape:\n      case SymbolType.Edge: {\n        return {\n          erased: true\n        }\n      }\n    }\n  }\n\n  async applyScratch(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyScratchGesture\", { gestureStroke, gesture })\n    if (!gesture.strokeIds.length) {\n      this.#logger.warn(\"applyScratchGesture\", \"Unable to apply underline because there are no strokes\")\n      return\n    }\n    const symbolsToUpdate: TIISymbol[] = []\n    const symbolsToErase: TIISymbol[] = []\n    const symbolsToReplace: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    gesture.strokeIds.forEach(id =>\n    {\n      const sym = this.model.getRootSymbol(id)\n      if (sym && !symbolsToErase.some(s => s.id === sym.id) && !symbolsToReplace.oldSymbols.some(s => s.id === sym.id)) {\n        const result = this.computeScratchOnSymbol(gestureStroke, gesture, sym)\n        if (result.erased) symbolsToErase.push(sym)\n        else if (result.replaced) {\n          symbolsToReplace.newSymbols.push(...result.replaced)\n          symbolsToReplace.oldSymbols.push(sym)\n        }\n      }\n    })\n\n    const promises: Promise<void | TIISymbol[]>[] = []\n    const changes: TIIHistoryChanges = {}\n    if (symbolsToUpdate.length) {\n      promises.push(this.editor.updateSymbols(symbolsToUpdate, false))\n      changes.updated = symbolsToUpdate\n    }\n\n    if (symbolsToErase.length) {\n      promises.push(this.editor.removeSymbols(symbolsToErase.map(s => s.id), false))\n      changes.erased = symbolsToErase\n    }\n\n    if (symbolsToReplace.newSymbols.length) {\n      changes.replaced = symbolsToReplace\n      promises.push(this.editor.replaceSymbols(symbolsToReplace.oldSymbols, symbolsToReplace.newSymbols, false))\n    }\n\n    this.history.push(this.model, changes)\n    await Promise.all(promises)\n  }\n\n  async applyJoinGesture(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyJoinGesture\", { gestureStroke, gesture })\n\n    const symbolsAbove = this.model.symbols.filter(s => this.model.isSymbolAbove(gestureStroke, s))\n    const symbolsRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s))\n\n    const symbolsBeforeGestureInRow = symbolsRow.filter(s => s.bounds.xMax <= gestureStroke.bounds.xMid)\n    const symbolsOnGestureInRow = symbolsRow.filter(s => s.bounds.xMax > gestureStroke.bounds.xMid && s.bounds.xMin <= gestureStroke.bounds.xMid)\n    const symbolsAfterGestureInRow = symbolsRow.filter(s => s.bounds.xMin > gestureStroke.bounds.xMid)\n    const symbolsBelow = this.model.symbols.filter(s => this.model.isSymbolBelow(gestureStroke, s))\n\n    const changes: TIIHistoryChanges = {}\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    if (symbolsOnGestureInRow.length) {\n      const symbolToJoin = symbolsOnGestureInRow[0]\n      if (symbolToJoin?.type === SymbolType.Group) {\n        const children = symbolToJoin.children.map(c => c.clone())\n        const childBefore = children.filter(c => c.bounds.xMid <= gestureStroke.bounds.xMid)\n        const childAfter = children.filter(c => c.bounds.xMid > gestureStroke.bounds.xMid)\n        if (childBefore.length && childAfter.length) {\n          const tx = Math.max(...childBefore.map(c => c.bounds.xMax)) - Math.min(...childAfter.map(c => c.bounds.xMin))\n          childAfter.forEach(c => this.translator.applyToSymbol(c, tx, 0))\n          const newGroup = new IISymbolGroup(children, symbolToJoin.style)\n          newGroup.decorators = symbolToJoin.decorators.map(d => d.clone())\n          changes.replaced = {\n            oldSymbols: [symbolToJoin],\n            newSymbols: [newGroup]\n          }\n          if (symbolsAfterGestureInRow.length) {\n            translate.push({ symbols: symbolsAfterGestureInRow, tx, ty: 0 })\n          }\n        }\n        else if (symbolsAfterGestureInRow.length) {\n          const tx = symbolToJoin.bounds.xMax - Math.min(...symbolsAfterGestureInRow.map(s => s.bounds.xMin))\n          translate.push({ symbols: symbolsAfterGestureInRow, tx, ty: 0 })\n        }\n      }\n      else if (symbolToJoin?.type === SymbolType.Recognized) {\n        const strokeText = symbolToJoin.clone()\n        const childBefore = strokeText.strokes.filter(c => c.bounds.xMid <= gestureStroke.bounds.xMid)\n        const childAfter = strokeText.strokes.filter(c => c.bounds.xMid > gestureStroke.bounds.xMid)\n        if (childBefore.length && childAfter.length) {\n          const tx = Math.max(...childBefore.map(c => c.bounds.xMax)) - Math.min(...childAfter.map(c => c.bounds.xMin))\n          childAfter.forEach(c => this.translator.applyToSymbol(c, tx, 0))\n          changes.replaced = {\n            oldSymbols: [symbolToJoin],\n            newSymbols: [strokeText]\n          }\n          if (symbolsAfterGestureInRow.length) {\n            translate.push({ symbols: symbolsAfterGestureInRow, tx, ty: 0 })\n          }\n        }\n        else if (symbolsAfterGestureInRow.length) {\n          const tx = symbolToJoin.bounds.xMax - Math.min(...symbolsAfterGestureInRow.map(s => s.bounds.xMin))\n          translate.push({ symbols: symbolsAfterGestureInRow, tx, ty: 0 })\n        }\n      }\n    }\n    else if (symbolsBeforeGestureInRow.length && symbolsAfterGestureInRow.length) {\n      const lastSymbBefore = this.model.getLastSymbol(symbolsBeforeGestureInRow)!\n      const firstSymbolAfter = this.model.getFirstSymbol(symbolsAfterGestureInRow)!\n\n      let lastXBefore = symbolsBeforeGestureInRow[0].bounds.xMax\n      for (let i = 1; i < symbolsBeforeGestureInRow.length; i++) {\n        const xMax = symbolsBeforeGestureInRow[i].bounds.xMax\n        if (xMax > lastXBefore) lastXBefore = xMax\n      }\n      let firstXAfter = symbolsAfterGestureInRow[0].bounds.xMin\n      for (let i = 1; i < symbolsAfterGestureInRow.length; i++) {\n        const xMin = symbolsAfterGestureInRow[i].bounds.xMin\n        if (xMin < firstXAfter) firstXAfter = xMin\n      }\n      const translateX = lastXBefore - firstXAfter\n\n      const lastSymbBeforeClone = lastSymbBefore.clone()\n      const firstSymbolAfterClone = firstSymbolAfter.clone()\n      this.translator.applyToSymbol(firstSymbolAfterClone, translateX, 0)\n      const symbolsToGroup = lastSymbBefore.type === SymbolType.Group ? (lastSymbBeforeClone as IISymbolGroup).children : [lastSymbBeforeClone]\n      symbolsToGroup.push(...(firstSymbolAfterClone.type === SymbolType.Group ? (firstSymbolAfterClone as IISymbolGroup).children : [firstSymbolAfterClone]))\n\n      if (symbolsToGroup.every(s => s.type === SymbolType.Text)) {\n        const texts = symbolsToGroup as IIText[]\n        const text = new IIText(texts.flatMap(s => s.chars), texts[0].point, Box.createFromBoxes(texts.map(t => t.bounds)))\n        this.texter.setBounds(text)\n        changes.replaced = {\n          oldSymbols: [lastSymbBefore, firstSymbolAfter],\n          newSymbols: [text]\n        }\n      }\n      else if (symbolsToGroup.every(s => s.type === SymbolType.Recognized)) {\n        const strokeTexts = symbolsToGroup as IIRecognizedText[]\n        const strokeText = new IIRecognizedText(strokeTexts.flatMap(s => s.strokes), strokeTexts[0], strokeTexts[0].style)\n        changes.replaced = {\n          oldSymbols: [lastSymbBefore, firstSymbolAfter],\n          newSymbols: [strokeText]\n        }\n      }\n      else {\n        const group = new IISymbolGroup(symbolsToGroup, lastSymbBefore.style)\n        if (IIGestureManager.#DECORABLE_TYPES.has(lastSymbBefore.type)) {\n          (lastSymbBefore as IIStroke).decorators.forEach(d =>\n          {\n            group.decorators.push(new IIDecorator(d.kind, d.style))\n          })\n        }\n        if (IIGestureManager.#DECORABLE_TYPES.has(firstSymbolAfter.type)) {\n          (firstSymbolAfter as IIStroke).decorators.forEach(d =>\n          {\n            if (!group.decorators.some(d1 => d1.kind == d.kind)) {\n              group.decorators.push(new IIDecorator(d.kind, d.style))\n            }\n          })\n        }\n\n        changes.replaced = {\n          oldSymbols: [lastSymbBefore, firstSymbolAfter],\n          newSymbols: [group]\n        }\n      }\n\n      const rest = symbolsAfterGestureInRow.filter(s => s.id !== firstSymbolAfter.id)\n      if (rest.length) {\n        translate.push({ symbols: rest, tx: translateX, ty: 0 })\n      }\n    }\n    else if (symbolsBeforeGestureInRow.length) {\n      const lastSymbolBeforeGesture = this.model.getLastSymbol(symbolsBeforeGestureInRow)!\n      const firstSymbolAfterGesture = this.model.getFirstSymbol(symbolsBelow)\n      if (firstSymbolAfterGesture) {\n        if (this.model.roundToLineGuide(lastSymbolBeforeGesture.bounds.yMid) >= this.model.roundToLineGuide(firstSymbolAfterGesture.bounds.yMid - this.rowHeight)) {\n          const symbolInNextRow = symbolsBelow.filter(s => this.model.isSymbolInRow(firstSymbolAfterGesture, s))\n          if (symbolInNextRow.length) {\n            const translateX = lastSymbolBeforeGesture.bounds.xMax + this.strokeSpaceWidth - firstSymbolAfterGesture.bounds.xMin\n            translate.push({ symbols: symbolInNextRow, tx: translateX, ty: -this.rowHeight })\n          }\n          const symbolsAfterNextRow = symbolsBelow.filter(s => this.model.isSymbolBelow(firstSymbolAfterGesture, s))\n          if (symbolsAfterNextRow.length) {\n            translate.push({ symbols: symbolsAfterNextRow, tx: 0, ty: -this.rowHeight })\n          }\n        }\n      }\n      else {\n        translate.push({ symbols: symbolsBelow, tx: 0, ty: -this.rowHeight })\n      }\n    }\n    else if (symbolsAfterGestureInRow.length) {\n      const firstSymbolAfterGesture = this.model.getFirstSymbol(symbolsAfterGestureInRow)!\n      const lastSymbolAbove = this.model.getLastSymbol(symbolsAbove)\n      if (lastSymbolAbove) {\n        if (this.model.roundToLineGuide(lastSymbolAbove.bounds.yMid) >= this.model.roundToLineGuide(firstSymbolAfterGesture.bounds.yMid - this.rowHeight)) {\n          const translateX = lastSymbolAbove.bounds.xMax + this.strokeSpaceWidth - firstSymbolAfterGesture.bounds.xMin\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: translateX, ty: -this.rowHeight })\n        }\n        else {\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: 0, ty: -this.rowHeight })\n        }\n\n        if (symbolsBelow.length) {\n          translate.push({ symbols: symbolsBelow, tx: 0, ty: -this.rowHeight })\n        }\n      }\n      else {\n        translate.push({ symbols: symbolsAfterGestureInRow.concat(...symbolsBelow), tx: 0, ty: -this.rowHeight })\n      }\n\n    }\n    if (changes.replaced?.oldSymbols.length) {\n      this.editor.replaceSymbols(changes.replaced.oldSymbols, changes.replaced.newSymbols, false)\n    }\n    if (translate.length) {\n      changes.translate = translate\n      Promise.all(translate.map(tr => this.translator.translate(tr.symbols, tr.tx, tr.ty, false)))\n    }\n    this.history.push(this.model, changes)\n  }\n\n  protected createStrokesFromGestureSubStroke(strokeOrigin: IIStroke, subStrokes: { x: number[], y: number[] }[]): IIStroke[]\n  {\n    const strokes: IIStroke[] = []\n    if (subStrokes[0]) {\n      const subStroke = new IIStroke(strokeOrigin.style)\n      subStrokes![0].x.forEach((x, i) =>\n      {\n        subStroke.pointers.push({\n          x,\n          y: subStrokes![0].y[i],\n          p: strokeOrigin.pointers.at(i)?.p || 1,\n          t: strokeOrigin.pointers.at(i)?.t || Math.max(...subStroke.pointers.map(p => p.t + 20))\n        })\n      })\n      strokes.push(subStroke)\n    }\n    if (subStrokes[1]) {\n      const subStroke = new IIStroke(strokeOrigin.style)\n      subStrokes[1].x.forEach((x, i) =>\n      {\n        subStroke.pointers.push({\n          x,\n          y: subStrokes![1].y[i],\n          p: strokeOrigin.pointers.at(subStroke.pointers.length + i)?.p || 1,\n          t: strokeOrigin.pointers.at(subStroke.pointers.length + i)?.t || Math.max(...subStroke.pointers.map(p => p.t + 20))\n        })\n      })\n      strokes.push(subStroke)\n    }\n    return strokes\n  }\n\n  protected computeSplitStroke(strokeOrigin: IIStroke, subStrokes: { x: number[], y: number[] }[]): { before?: IIStroke, after?: IIStroke }\n  {\n    let after: IIStroke | undefined\n    const newStrokes = this.createStrokesFromGestureSubStroke(strokeOrigin, subStrokes)\n\n    if (newStrokes[1]) {\n      after = newStrokes[1]\n      this.translator.applyToSymbol(after, this.strokeSpaceWidth, 0)\n    }\n    return {\n      before: newStrokes[0],\n      after\n    }\n  }\n\n  protected computeSplitStrokeInGroup(gestureStroke: IIStroke, group: IISymbolGroup, subStrokes: { fullStrokeId: string, x: number[], y: number[] }[]): IISymbolGroup[]\n  {\n    const newGroups: IISymbolGroup[] = []\n    const symbolsBefore: TIISymbol[] = []\n    const symbolsAfter: TIISymbol[] = []\n\n    const strokeIdToSplit = subStrokes[0].fullStrokeId\n\n    group.children.forEach(gs =>\n    {\n      if (gs.id === strokeIdToSplit) {\n        const subStroke = this.computeSplitStroke(gs as IIStroke, subStrokes)\n        if (subStroke.before) {\n          symbolsBefore.push(subStroke.before)\n        }\n        if (subStroke.after) {\n          symbolsAfter.push(subStroke.after)\n        }\n      }\n      else if (gs.bounds.xMid < gestureStroke.bounds.xMid) {\n        symbolsBefore.push(gs)\n      }\n      else if (gs.bounds.xMid > gestureStroke.bounds.xMid) {\n        this.translator.applyToSymbol(gs, this.strokeSpaceWidth, 0)\n        symbolsAfter.push(gs)\n      }\n    })\n\n    if (symbolsBefore.length) {\n      newGroups.push(new IISymbolGroup(symbolsBefore, group.style))\n    }\n    if (symbolsAfter.length) {\n      newGroups.push(new IISymbolGroup(symbolsAfter, group.style))\n    }\n    return newGroups\n  }\n\n  protected computeChangesOnSplitStroke(gestureStroke: IIStroke, strokeIdToSplit: string, subStrokes: { fullStrokeId: string, x: number[], y: number[] }[]): TIIHistoryChanges\n  {\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    const replaced: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    const symbolsAfterGestureInRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s) && gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const symbolToSplit = this.model.getRootSymbol(strokeIdToSplit)\n    if (symbolToSplit?.type === SymbolType.Group) {\n      const newGroups = this.computeSplitStrokeInGroup(gestureStroke, symbolToSplit, subStrokes)\n      replaced.newSymbols.push(...newGroups)\n      replaced.oldSymbols.push(symbolToSplit)\n    }\n    else if (symbolToSplit?.type === SymbolType.Stroke) {\n      const newStrokes = this.computeSplitStroke(symbolToSplit, subStrokes)\n      if (newStrokes.before) {\n        replaced.newSymbols.push(newStrokes.before)\n      }\n      if (newStrokes.after) {\n        replaced.newSymbols.push(newStrokes.after)\n      }\n      replaced.oldSymbols.push(symbolToSplit)\n    }\n    else if (symbolToSplit?.type === SymbolType.Recognized) {\n      const strokesToSplit = symbolToSplit.strokes.find(s => s.id === strokeIdToSplit)!\n      const strokesBefore = symbolToSplit.strokes.filter(s => s.id !== strokeIdToSplit && s.bounds.xMid < gestureStroke.bounds.xMid)\n      const strokesAfter = symbolToSplit.strokes.filter(s => s.id !== strokeIdToSplit && s.bounds.xMid > gestureStroke.bounds.xMid)\n      const newStrokes = this.computeSplitStroke(strokesToSplit, subStrokes)\n      if (newStrokes.before) {\n        replaced.newSymbols.push(...strokesBefore, newStrokes.before)\n      }\n      if (newStrokes.after) {\n        replaced.newSymbols.push(newStrokes.after, ...strokesAfter)\n      }\n      replaced.oldSymbols.push(symbolToSplit)\n    }\n    if (symbolsAfterGestureInRow.length) {\n      translate.push({ symbols: symbolsAfterGestureInRow, tx: this.strokeSpaceWidth, ty: 0 })\n    }\n\n    return {\n      translate,\n      replaced\n    }\n  }\n\n  protected computeChangesOnSplitGroup(gestureStroke: IIStroke, groupToSplit: IISymbolGroup): TIIHistoryChanges\n  {\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    const replaced: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    const symbolsAfterGestureInRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s) && gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const groupSymbolsBefore = groupToSplit.children.filter(s => s.bounds.xMid <= gestureStroke.bounds.xMid)\n    const groupsSymbolsAfter = groupToSplit.children.filter(s => s.bounds.xMid > gestureStroke.bounds.xMid)\n\n    replaced.oldSymbols.push(groupToSplit)\n    if (groupSymbolsBefore.length) {\n      const groupBefore = new IISymbolGroup(groupSymbolsBefore.map(s => s.clone()), groupToSplit.style)\n      groupBefore.decorators = groupToSplit.decorators.map(d => new IIDecorator(d.kind, d.style))\n      replaced.newSymbols.push(groupBefore)\n    }\n    if (groupsSymbolsAfter.length) {\n      const grouAfter = new IISymbolGroup(groupsSymbolsAfter.map(s => s.clone()), groupToSplit.style)\n      grouAfter.decorators = groupToSplit.decorators.map(d => new IIDecorator(d.kind, d.style))\n      this.translator.applyToSymbol(grouAfter, this.strokeSpaceWidth, 0)\n      replaced.newSymbols.push(grouAfter)\n    }\n    if (symbolsAfterGestureInRow?.length) {\n      translate.push({ symbols: symbolsAfterGestureInRow.filter(s => s.id !== groupToSplit.id), tx: this.strokeSpaceWidth, ty: 0 })\n    }\n\n    return {\n      translate,\n      replaced\n    }\n  }\n\n  protected computeChangesOnSplitStrokeText(gestureStroke: IIStroke, strokeTextToSplit: IIRecognizedText): TIIHistoryChanges\n  {\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    const replaced: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    const symbolsAfterGestureInRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s) && gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const strokesBefore = strokeTextToSplit.strokes.filter(s => s.bounds.xMid <= gestureStroke.bounds.xMid)\n    const strokesAfter = strokeTextToSplit.strokes.filter(s => s.bounds.xMid > gestureStroke.bounds.xMid)\n\n    replaced.oldSymbols.push(strokeTextToSplit)\n    if (strokesBefore.length) {\n      const strokeTextBefore = new IIRecognizedText(strokesBefore.map(s => s.clone()), strokeTextToSplit, strokeTextToSplit.style)\n      strokeTextBefore.decorators = strokeTextToSplit.decorators.map(d => new IIDecorator(d.kind, d.style))\n      replaced.newSymbols.push(strokeTextBefore)\n    }\n    if (strokesAfter.length) {\n      const strokeTextAfter = new IIRecognizedText(strokesAfter.map(s => s.clone()), strokeTextToSplit, strokeTextToSplit.style)\n      strokeTextAfter.decorators = strokeTextToSplit.decorators.map(d => new IIDecorator(d.kind, d.style))\n      this.translator.applyToSymbol(strokeTextAfter, this.strokeSpaceWidth, 0)\n      replaced.newSymbols.push(strokeTextAfter)\n    }\n    if (symbolsAfterGestureInRow?.length) {\n      translate.push({ symbols: symbolsAfterGestureInRow.filter(s => s.id !== strokeTextToSplit.id), tx: this.strokeSpaceWidth, ty: 0 })\n    }\n\n    return {\n      translate,\n      replaced\n    }\n  }\n\n  protected computeChangesOnSplitText(gestureStroke: IIStroke, textToSplit: IIText): TIIHistoryChanges\n  {\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    const replaced: { oldSymbols: TIISymbol[], newSymbols: TIISymbol[] } = { oldSymbols: [], newSymbols: [] }\n\n    const symbolsAfterGestureInRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s) && gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const charsBefore = textToSplit.chars.filter(c => c.bounds.x + c.bounds.width / 2 <= gestureStroke.bounds.xMid)\n    const charsAfter = textToSplit.chars.filter(c => c.bounds.x + c.bounds.width / 2 > gestureStroke.bounds.xMid)\n    const newTexts: IIText[] = []\n    if (charsBefore.length && charsAfter.length) {\n      const textBefore = new IIText(charsBefore, textToSplit.point, Box.createFromBoxes(charsBefore.map(c => c.bounds)))\n      this.texter.setBounds(textBefore)\n      newTexts.push(textBefore)\n      const pointAfter: TPoint = {\n        x: textBefore.point.x + textBefore.bounds.width + this.texter.getSpaceWidth(computeAverage(textBefore.chars.map(c => c.fontSize))),\n        y: textBefore.point.y\n      }\n      const textAfter = new IIText(charsAfter, pointAfter, Box.createFromBoxes(charsAfter.map(c => c.bounds)))\n      this.texter.setBounds(textAfter)\n      newTexts.push(textAfter)\n      replaced.newSymbols = newTexts\n      replaced.oldSymbols = [textToSplit]\n    }\n    if (symbolsAfterGestureInRow?.length) {\n      translate.push({ symbols: symbolsAfterGestureInRow.filter(s => s.id !== gestureStroke.id), tx: this.strokeSpaceWidth, ty: 0 })\n    }\n\n    return {\n      translate,\n      replaced\n    }\n  }\n\n  async applyInsertGesture(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyInsertGesture\", { gestureStroke, gesture })\n\n    const symbolsRow = this.model.symbols.filter(s => gestureStroke.id !== s.id && this.model.isSymbolInRow(gestureStroke, s))\n    const textToSplit = symbolsRow.find(s => s.type === SymbolType.Text && isBetween(gestureStroke.bounds.xMid, s.bounds.xMin, s.bounds.xMax)) as IIText | undefined\n    const groupToSplit = symbolsRow.find(s => s.type === SymbolType.Group && isBetween(gestureStroke.bounds.xMid, s.bounds.xMin, s.bounds.xMax)) as IISymbolGroup | undefined\n    const strokeTextToSplit = symbolsRow.find(s => s.type === SymbolType.Recognized && isBetween(gestureStroke.bounds.xMid, s.bounds.xMin, s.bounds.xMax)) as IIRecognizedText | undefined\n\n    const symbolsBeforeGestureInRow = symbolsRow.filter(s => gestureStroke.bounds.xMid > s.bounds.xMax)\n    const symbolsAfterGestureInRow = symbolsRow.filter(s => gestureStroke.bounds.xMid < s.bounds.xMin)\n\n    const symbolsBelow = this.model.symbols.filter(s => this.model.isSymbolBelow(gestureStroke, s))\n\n\n    let changes: TIIHistoryChanges | undefined\n    if (gesture.strokeIds.length && gesture.subStrokes?.length) {\n      changes = this.computeChangesOnSplitStroke(gestureStroke, gesture.strokeIds[0], gesture.subStrokes)\n    }\n    else if (groupToSplit) {\n      changes = this.computeChangesOnSplitGroup(gestureStroke, groupToSplit)\n    }\n    else if (textToSplit) {\n      changes = this.computeChangesOnSplitText(gestureStroke, textToSplit)\n    }\n    else if (strokeTextToSplit) {\n      changes = this.computeChangesOnSplitStrokeText(gestureStroke, strokeTextToSplit)\n    }\n    else if (symbolsAfterGestureInRow.length) {\n      const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n      let translateX = 0\n      if (symbolsBeforeGestureInRow.length) {\n        translateX = Math.min(...symbolsBeforeGestureInRow.map(s => s.bounds.xMin)) - Math.min(...symbolsAfterGestureInRow.map(s => s.bounds.xMin))\n      }\n\n      switch (this.insertAction) {\n        case InsertAction.LineBreak:\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: translateX, ty: this.rowHeight })\n          if (symbolsBelow.length) {\n            translate.push({ symbols: symbolsBelow, tx: 0, ty: this.rowHeight })\n          }\n          break\n        case InsertAction.Insert:\n          translate.push({ symbols: symbolsAfterGestureInRow, tx: this.strokeSpaceWidth * 2, ty: 0 })\n          break\n      }\n      changes = { translate }\n    }\n    else if (symbolsBeforeGestureInRow.length && symbolsBelow.length && this.insertAction === InsertAction.LineBreak) {\n      changes = { translate: [{ symbols: symbolsBelow, tx: 0, ty: this.rowHeight }] }\n    }\n\n    if (changes) {\n      this.history.push(this.model, changes)\n      const promises: Promise<void>[] = []\n      if (changes.translate?.length) {\n        promises.push(...changes.translate.map(tr => this.translator.translate(tr.symbols, tr.tx, tr.ty, false)))\n      }\n      if (changes.replaced?.newSymbols.length) {\n        promises.push(this.editor.replaceSymbols(changes.replaced.oldSymbols, changes.replaced.newSymbols, false))\n      }\n      await Promise.all(promises)\n    }\n  }\n\n  async applyUnderlineGesture(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.debug(\"applyUnderlineGesture\", { gestureStroke, gesture })\n    if (!gesture.strokeIds.length) {\n      this.#logger.warn(\"applyUnderlineGesture\", \"Unable to apply underline because there are no strokes\")\n      return\n    }\n\n    const changes: TIIHistoryChanges = { decorator: [] }\n    const symbolIdSet = new Set<string>()\n    gesture.strokeIds.forEach(id =>\n    {\n      const sym = this.model.getRootSymbol(id)\n      if (sym && IIGestureManager.#DECORABLE_TYPES.has(sym.type) && !symbolIdSet.has(sym.id)) {\n        const symWithDec = sym as (IIText | IIStroke | IISymbolGroup | IIRecognizedText)\n        const underline = new IIDecorator(DecoratorKind.Underline, this.editor.penStyle)\n        const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Underline)\n        const added = index === -1\n        // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n        added ? symWithDec.decorators.push(underline) : symWithDec.decorators.splice(index, 1)\n        this.model.updateSymbol(symWithDec)\n        this.renderer.drawSymbol(symWithDec)\n        changes.decorator?.push({ symbol: symWithDec, decorator: underline, added })\n        symbolIdSet.add(symWithDec.id)\n      }\n    })\n    if (changes.decorator?.length) {\n      this.history.push(this.model, changes)\n    }\n  }\n\n  async applyStrikeThroughGesture(gestureStroke: IIStroke, gesture: TGesture): Promise<void | TIISymbol[]>\n  {\n    this.#logger.debug(\"applyStrikeThroughGesture\", { gestureStroke, gesture })\n    if (!gesture.strokeIds.length) {\n      this.#logger.warn(\"applyStrikeThroughGesture\", \"Unable to apply strikethrough because there are no strokes\")\n      return\n    }\n    switch (this.strikeThroughAction) {\n      case StrikeThroughAction.Draw: {\n        const changes: TIIHistoryChanges = { decorator: [] }\n        const symbolIds: string[] = []\n        gesture.strokeIds.forEach(id =>\n        {\n          const symbol = this.model.getRootSymbol(id)\n          if (symbol && [SymbolType.Group, SymbolType.Stroke, SymbolType.Text, SymbolType.Recognized].includes(symbol.type) && !symbolIds.includes(symbol.id)) {\n            const symWithDec = symbol as (IIText | IIStroke | IISymbolGroup | IIRecognizedText)\n            const strikethrough = new IIDecorator(DecoratorKind.Strikethrough, this.editor.penStyle)\n            const index = symWithDec.decorators.findIndex(d => d.kind === DecoratorKind.Strikethrough)\n            const added = index === -1\n            // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n            added ? symWithDec.decorators.push(strikethrough) : symWithDec.decorators.splice(index, 1)\n            this.model.updateSymbol(symWithDec)\n            this.renderer.drawSymbol(symWithDec)\n            changes.decorator?.push({ symbol: symWithDec, decorator: strikethrough, added })\n            symbolIds.push(symWithDec.id)\n          }\n        })\n        if (changes.decorator?.length) {\n          this.history.push(this.model, changes)\n        }\n        break\n      }\n      case StrikeThroughAction.Erase: {\n        return this.editor.removeSymbols(gesture.strokeIds)\n      }\n      default:\n        this.#logger.warn(\"#applyStrikeThroughGesture\", `Unknow OnStrikeThrough: ${ this.strikeThroughAction }, values allowed are: ${ StrikeThroughAction.Draw }, ${ StrikeThroughAction.Erase }`)\n        break\n    }\n  }\n\n  async apply(gestureStroke: IIStroke, gesture: TGesture): Promise<void>\n  {\n    this.#logger.info(\"apply\", { gestureStroke, gesture })\n    this.editor.updateSymbolsStyle([gestureStroke.id], { opacity: (gestureStroke.style.opacity || 1) / 2 }, false)\n    await this.editor.removeSymbol(gestureStroke.id, false)\n    await this.editor.synchronizeStrokesWithJIIX()\n    switch (gesture.gestureType) {\n      case \"UNDERLINE\":\n        await this.applyUnderlineGesture(gestureStroke, gesture)\n        break\n      case \"SCRATCH\":\n        await this.applyScratch(gestureStroke, gesture)\n        break\n      case \"JOIN\":\n        await this.applyJoinGesture(gestureStroke, gesture)\n        break\n      case \"INSERT\":\n        await this.applyInsertGesture(gestureStroke, gesture)\n        break\n      case \"STRIKETHROUGH\":\n        await this.applyStrikeThroughGesture(gestureStroke, gesture)\n        break\n      case \"SURROUND\":\n        await this.applySurroundGesture(gestureStroke, gesture)\n        break\n      default:\n        this.#logger.warn(\"apply\", `Gesture unknow: ${ gesture.gestureType }`)\n        break\n    }\n    this.editor.event.emitGestured({ gestureType: gesture.gestureType, stroke: gestureStroke })\n    this.editor.svgDebugger.apply()\n    return Promise.resolve()\n  }\n\n  async getGestureFromContextLess(gestureStroke: IIStroke): Promise<TGesture | undefined>\n  {\n    const gesture = await this.recognizer.recognizeGesture(gestureStroke)\n    if (!gesture) return\n    switch (gesture.gestureType) {\n      case \"surround\": {\n        const hasSymbolsToSurrond = this.model.symbols.some(s =>\n        {\n          if (s.id !== gestureStroke.id && gestureStroke.bounds.contains(s.bounds)) {\n            return this.surroundAction === SurroundAction.Select || IIGestureManager.#SURROUND_SELECT_TYPES.has(s.type)\n          }\n          return false\n        })\n        if (hasSymbolsToSurrond) {\n          return {\n            gestureType: \"SURROUND\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: [],\n          }\n        }\n        return\n      }\n      case \"left-right\":\n      case \"right-left\": {\n        const symbolsToUnderline = this.model.symbols.filter(s =>\n        {\n          return s.id !== gestureStroke.id && IIGestureManager.#TEXT_STROKE_GROUP_TYPES.has(s.type) &&\n            isBetween(s.bounds.xMid, gestureStroke.bounds.xMin, gestureStroke.bounds.xMax) &&\n            isBetween(gestureStroke.bounds.yMid, s.bounds.y + s.bounds.height * 3 / 4, s.bounds.y + s.bounds.height * 5 / 4)\n        })\n        if (symbolsToUnderline.length) {\n          return {\n            gestureType: \"UNDERLINE\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: symbolsToUnderline.map(s => s.id),\n          }\n        }\n        const symbolsToStrikeThrough = this.model.symbols.filter(s =>\n        {\n          return s.id !== gestureStroke.id && IIGestureManager.#TEXT_STROKE_GROUP_TYPES.has(s.type) &&\n            isBetween(s.bounds.xMid, gestureStroke.bounds.xMin, gestureStroke.bounds.xMax) &&\n            isBetween(gestureStroke.bounds.yMid, s.bounds.y + s.bounds.height / 4, s.bounds.y + s.bounds.height * 3 / 4)\n        })\n        if (symbolsToStrikeThrough.length) {\n          return {\n            gestureType: \"STRIKETHROUGH\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: symbolsToStrikeThrough.map(s => s.id),\n          }\n        }\n        return\n      }\n      case \"scratch\": {\n        const symbolsToErase = this.model.symbols.filter(s =>\n        {\n          return s.id !== gestureStroke.id &&\n            (\n              gestureStroke.bounds.overlaps(s.bounds) && IIGestureManager.#ERASE_OVERLAY_TYPES.has(s.type) ||\n              gestureStroke.bounds.contains(s.bounds) && IIGestureManager.#ERASE_CONTAIN_TYPES.has(s.type)\n            )\n        })\n\n        if (symbolsToErase.length) {\n          return {\n            gestureType: \"SCRATCH\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: symbolsToErase.map(s => s.id),\n          }\n        }\n        return\n      }\n      case \"bottom-top\": {\n        const hasSymbolsInRow = this.model.symbols.some(s =>\n          s.id !== gestureStroke.id &&\n          IIGestureManager.#TEXT_STROKE_GROUP_TYPES.has(s.type) &&\n          isBetween(s.bounds.yMid, gestureStroke.bounds.yMin, gestureStroke.bounds.yMax)\n        )\n        if (hasSymbolsInRow) {\n          return {\n            gestureType: \"JOIN\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: [],\n          }\n        }\n        return\n      }\n      case \"top-bottom\": {\n        const hasSymbolsInRow = this.model.symbols.some(s =>\n          s.id !== gestureStroke.id &&\n          IIGestureManager.#TEXT_STROKE_GROUP_TYPES.has(s.type) &&\n          isBetween(s.bounds.yMid, gestureStroke.bounds.yMin, gestureStroke.bounds.yMax)\n        )\n        if (hasSymbolsInRow) {\n          return {\n            gestureType: \"INSERT\",\n            gestureStrokeId: gestureStroke.id,\n            strokeAfterIds: [],\n            strokeBeforeIds: [],\n            strokeIds: [],\n          }\n        }\n        return\n      }\n      case \"none\":\n      default:\n        return\n    }\n  }\n}\n","/**\n * @group Menu\n */\nexport type TSubMenuParam =\n{\n  trigger: HTMLElement,\n  menuTitle?: string,\n  subMenu: HTMLElement,\n  position: \"top\" | \"left\" | \"right\" | \"right-top\" | \"bottom\" | \"bottom-left\" | \"bottom-right\"\n}\n\n/**\n * @group Menu\n */\nexport class IIMenuSub {\n  element: HTMLDivElement\n  content: HTMLElement\n\n  constructor(param : TSubMenuParam) {\n    this.element = document.createElement(\"div\")\n    this.element.classList.add(\"sub-menu\")\n    this.element.appendChild(param.trigger)\n    this.content = document.createElement(\"div\")\n    if(param.menuTitle) {\n      const menuTitleElement = document.createElement(\"h3\")\n      menuTitleElement.classList.add(\"ms-menu-title\")\n      menuTitleElement.textContent = param.menuTitle\n      this.content.appendChild(menuTitleElement)\n    }\n    this.content.classList.add(\"sub-menu-content\", param.position)\n    this.content.appendChild(param.subMenu)\n    this.element.appendChild(this.content)\n\n    param.trigger.addEventListener(\"pointerdown\", () => this.toggle())\n    document.addEventListener(\"pointerdown\", (e) => {\n      if (!this.element.contains(e.target as HTMLElement)) {\n        this.close()\n      }\n    })\n  }\n\n  open(): void {\n    this.content.classList.add(\"open\")\n  }\n\n  close(): void {\n    this.content.classList.remove(\"open\")\n  }\n\n  toggle(): void {\n    this.content.classList.toggle(\"open\")\n  }\n\n  unwrap(): void {\n    this.content.classList.remove(\"sub-menu-content\")\n    this.element.insertAdjacentElement(\"beforebegin\", this.content)\n    this.element.style.display = \"none\"\n  }\n\n  wrap(): void {\n    this.content.classList.add(\"sub-menu-content\")\n    this.element.appendChild(this.content)\n    this.element.style.display = \"block\"\n  }\n\n}\n","import menuIcon from \"../assets/svg/menu.svg\"\nimport languageIcon from \"../assets/svg/language.svg\"\nimport trashIcon from \"../assets/svg/trash.svg\"\nimport undoIcon from \"../assets/svg/undo.svg\"\nimport redoIcon from \"../assets/svg/redo.svg\"\nimport translateIcon from \"../assets/svg/translate.svg\"\nimport gestureIcon from \"../assets/svg/spock-hand-gesture.svg\"\nimport guideIcon from \"../assets/svg/orthogonal-view.svg\"\nimport snapIcon from \"../assets/svg/arrow-to-dot.svg\"\nimport debugIcon from \"../assets/svg/wolf.svg\"\nimport downloadIcon from \"../assets/svg/download.svg\"\nimport uploadIcon from \"../assets/svg/upload.svg\"\nimport { EditorTool, EditorWriteTool } from \"../Constants\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { IIMenu, TMenuItemBoolean, TMenuItemButton, TMenuItemButtonList, TMenuItemSelect } from \"./IIMenu\"\nimport { TIISymbol } from \"../symbol\"\nimport { InsertAction, StrikeThroughAction, SurroundAction } from \"../gesture\"\nimport { IIMenuSub, TSubMenuParam } from \"./IIMenuSub\"\nimport { createMenuButton } from \"./MenuHelper\"\nimport { getAvailableLanguageList, PartialDeep } from \"../utils\"\nimport { InteractiveInkEditor } from \"../editor\"\n\n/**\n * @group Menu\n */\nexport class IIMenuAction extends IIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MENU)\n\n  editor: InteractiveInkEditor\n  id: string\n  wrapper?: HTMLElement\n  menuLanguage!: IIMenuSub\n  menuClear?: HTMLButtonElement\n  menuUndo?: HTMLButtonElement\n  menuRedo?: HTMLButtonElement\n  menuConvert?: HTMLButtonElement\n\n  guideGaps = [\n    { label: \"S\", value: \"25\" },\n    { label: \"M\", value: \"50\" },\n    { label: \"L\", value: \"100\" },\n    { label: \"XL\", value: \"150\" },\n  ]\n\n  constructor(editor: InteractiveInkEditor, id = \"ms-menu-action\")\n  {\n    super()\n    this.id = id\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get isMobile(): boolean\n  {\n    return this.editor.renderer.parent.clientWidth < 700\n  }\n\n  protected createMenuClear(): HTMLElement\n  {\n    this.menuClear = createMenuButton(\n      `${ this.id }-clear`,\n      trashIcon,\n      () => {\n        this.#logger.info(`${ this.id }.clear`)\n        this.editor.clear()\n      }\n    )\n    return this.menuClear\n  }\n\n  protected createMenuLanguage(): HTMLElement\n  {\n    const triggerBtn = createMenuButton(\n      `${ this.id }-language-trigger`,\n      languageIcon,\n      () => {} // Click handled by IIMenuSub\n    )\n\n    const select = document.createElement(\"select\")\n    select.classList.add(\"select-language\")\n    select.id = `${ this.id }-language`\n    getAvailableLanguageList(this.editor.configuration)\n      .then(json =>\n      {\n        const languages = json.result as { [key: string]: string }\n        for (const key in languages) {\n          const selected = key === this.editor.configuration.recognition.lang\n          const opt = new Option(languages[key], key, selected, selected)\n          select.appendChild(opt)\n        }\n      })\n    select.addEventListener(\"change\", (e) =>\n    {\n      this.#logger.info(`${ this.id }.selectLanguage`)\n      const value = (e.target as HTMLInputElement).value\n      this.editor.changeLanguage(value)\n    })\n    const params: TSubMenuParam = {\n      trigger: triggerBtn,\n      subMenu: select,\n      position: \"bottom-right\"\n    }\n    this.menuLanguage = new IIMenuSub(params)\n    return this.menuLanguage.element\n  }\n\n  protected createMenuUndo(): HTMLElement\n  {\n    this.menuUndo = createMenuButton(\n      `${ this.id }-undo`,\n      undoIcon,\n      async () => {\n        this.#logger.info(`${ this.id }.undo`)\n        await this.editor.undo()\n      }\n    )\n    return this.menuUndo\n  }\n\n  protected createMenuRedo(): HTMLElement\n  {\n    this.menuRedo = createMenuButton(\n      `${ this.id }-redo`,\n      redoIcon,\n      async () => {\n        this.#logger.info(`${ this.id }.redo`)\n        await this.editor.redo()\n      }\n    )\n    return this.menuRedo\n  }\n\n  protected createMenuConvert(): HTMLElement\n  {\n    this.menuConvert = createMenuButton(\n      `${ this.id }-convert`,\n      translateIcon,\n      () => {\n        this.#logger.info(`${ this.id }.convert`)\n        this.editor.convert()\n      }\n    )\n    return this.menuConvert\n  }\n\n  protected createMenuGesture(): HTMLDivElement\n  {\n    const trigger = createMenuButton(\n      `${ this.id }-gesture`,\n      gestureIcon,\n      () => {} // Click handled by IIMenuSub\n    )\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const surroundActionValues: { label: string, value: string }[] = []\n    for (const key in SurroundAction) {\n      const value = SurroundAction[key as keyof typeof SurroundAction]\n      surroundActionValues.push({ label: key, value })\n    }\n    const strikeThroughActionValues: { label: string, value: string }[] = []\n    for (const key in StrikeThroughAction) {\n      const value = StrikeThroughAction[key as keyof typeof StrikeThroughAction]\n      strikeThroughActionValues.push({ label: key, value })\n    }\n    const splitActionValues: { label: string, value: string }[] = []\n    for (const key in InsertAction) {\n      const value = InsertAction[key as keyof typeof InsertAction]\n      splitActionValues.push({ label: key, value })\n    }\n    const menuItems: (TMenuItemBoolean | TMenuItemSelect)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-gesture-detect`,\n        label: \"Detect gesture\",\n        initValue: this.editor.writer.detectGesture,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-detect`, { value })\n          this.editor.writer.detectGesture = value\n          this.editor.tool = EditorTool.Write\n          this.editor.writer.tool = EditorWriteTool.Pencil\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-gesture-surround`,\n        label: \"On surround\",\n        values: surroundActionValues,\n        initValue: this.editor.gesture.surroundAction,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-surround`, { value })\n          this.editor.gesture.surroundAction = value as SurroundAction\n          this.editor.tool = EditorTool.Write\n          this.editor.writer.tool = EditorWriteTool.Pencil\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-gesture-strikethrough`,\n        label: \"On strikethrough\",\n        values: strikeThroughActionValues,\n        initValue: this.editor.gesture.strikeThroughAction,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-strikethrough`, { value })\n          this.editor.gesture.strikeThroughAction = value as StrikeThroughAction\n          this.editor.tool = EditorTool.Write\n          this.editor.writer.tool = EditorWriteTool.Pencil\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-gesture-insert`,\n        label: \"On insert\",\n        values: splitActionValues,\n        initValue: this.editor.gesture.insertAction,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.gesture-InsertAction`, { value })\n          this.editor.gesture.insertAction = value as InsertAction\n          this.editor.tool = EditorTool.Write\n          this.editor.writer.tool = EditorWriteTool.Pencil\n        }\n      },\n    ]\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Gesture\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected createMenuGuide(): HTMLDivElement\n  {\n    const trigger = createMenuButton(\n      `${ this.id }-guide`,\n      guideIcon,\n      () => {} // Click handled by IIMenuSub\n    )\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const menuItems: (TMenuItemBoolean | TMenuItemSelect | TMenuItemButtonList)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-guide-enable`,\n        label: \"Show guide\",\n        initValue: this.editor.configuration.rendering.guides.enable,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.guide-enable`, { value })\n          this.editor.configuration.rendering.guides.enable = value as boolean\n          this.editor.renderingConfiguration = this.editor.configuration.rendering\n        }\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-guide-type`,\n        label: \"Guide style\",\n        values: [\n          { label: \"Line\", value: \"line\" },\n          { label: \"Grid\", value: \"grid\" },\n          { label: \"Point\", value: \"point\" },\n        ],\n        initValue: this.editor.configuration.rendering.guides.type,\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.guide-type`, { value })\n          this.editor.configuration.rendering.guides.type = value as (\"line\" | \"grid\" | \"point\")\n          this.editor.renderingConfiguration = this.editor.configuration.rendering\n        }\n      },\n      {\n        type: \"list\",\n        id: `${ this.id }-guide-size`,\n        label: \"Guide style\",\n        values: this.guideGaps,\n        initValue: this.editor.configuration.rendering.guides.gap.toString(),\n        callback: (value) =>\n        {\n          this.#logger.info(`${ this.id }.guide-size`, { value })\n          this.editor.configuration.rendering.guides.gap = +value\n          this.editor.renderingConfiguration = this.editor.configuration.rendering\n        }\n      },\n    ]\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Guide\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected createMenuSnap(): HTMLDivElement\n  {\n    const trigger = createMenuButton(\n      `${ this.id }-snap`,\n      snapIcon,\n      () => {} // Click handled by IIMenuSub\n    )\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const menuItems: (TMenuItemBoolean | TMenuItemSelect)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-snap-to-guide`,\n        label: \"Snap to guide\",\n        initValue: this.editor.snaps.configuration.guide,\n        callback: (value) => this.editor.snaps.configuration.guide = value\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-snap-to-element`,\n        label: \"Snap to element\",\n        initValue: this.editor.snaps.configuration.symbol,\n        callback: (value) => this.editor.snaps.configuration.symbol = value\n      },\n      {\n        type: \"select\",\n        id: `${ this.id }-snap-angle`,\n        label: \"Snap angle\",\n        values: [\n          { label: \"None\", value: \"0\" },\n          { label: \"10\", value: \"10\" },\n          { label: \"30\", value: \"30\" },\n          { label: \"45\", value: \"45\" },\n          { label: \"90\", value: \"90\" },\n          { label: \"180\", value: \"180\" },\n        ],\n        initValue: this.editor.snaps.configuration.angle.toString(),\n        callback: (angle) => this.editor.snaps.configuration.angle = +angle\n      },\n    ]\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Snap\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected createMenuDebug(): HTMLDivElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-debug`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = debugIcon\n\n    const menuItems: TMenuItemBoolean[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-bounding-box`,\n        label: \"Show bounding box\",\n        initValue: this.editor.svgDebugger.boundingBoxVisibility,\n        callback: (debug) => this.editor.svgDebugger.boundingBoxVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-recognition-box`,\n        label: \"Show recognition box\",\n        initValue: this.editor.svgDebugger.recognitionBoxVisibility,\n        callback: (debug) => this.editor.svgDebugger.recognitionBoxVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-bounding-item-box`,\n        label: \"Show recognition item box\",\n        initValue: this.editor.svgDebugger.recognitionItemBoxVisibility,\n        callback: (debug) => this.editor.svgDebugger.recognitionItemBoxVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-snap-points`,\n        label: \"Show snap points\",\n        initValue: this.editor.svgDebugger.snapPointsVisibility,\n        callback: (debug) => this.editor.svgDebugger.snapPointsVisibility = debug\n      },\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-debug-vertices`,\n        label: \"Show vertices\",\n        initValue: this.editor.svgDebugger.verticesVisibility,\n        callback: (debug) => this.editor.svgDebugger.verticesVisibility = debug\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Debug\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected createMenuExport(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-export`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = downloadIcon\n\n    const menuItems: TMenuItemButton[] = [\n      {\n        type: \"button\",\n        id: `${ this.id }-export-json`,\n        label: \"json\",\n        callback: () =>\n        {\n          this.editor.downloadAsJson()\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-svg`,\n        label: \"svg\",\n        callback: () =>\n        {\n          this.editor.downloadAsSVG()\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-png`,\n        label: \"png\",\n        callback: () =>\n        {\n          this.editor.downloadAsPNG()\n        }\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Export\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected async readFileAsText(file: File): Promise<string>\n  {\n    return new Promise((resolve, reject) =>\n    {\n      const reader = new FileReader()\n      reader.onerror = reject;\n      reader.onload = () => {\n        resolve(reader.result as string)\n      }\n      if (file) {\n        reader.readAsText(file)\n      }\n    })\n  }\n\n  protected createMenuImport(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-import`\n    trigger.classList.add(\"ms-menu-button\", \"square\")\n    trigger.innerHTML = uploadIcon\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n\n    const importInput = document.createElement(\"input\")\n    importInput.type = \"file\"\n    importInput.accept = \".json\"\n    importInput.multiple = false\n    importInput.addEventListener(\"change\", () => {\n      importBtn.disabled = !importInput.files?.length\n    })\n\n    subMenuWrapper.appendChild(importInput)\n    const importBtn = document.createElement(\"button\")\n    importBtn.classList.add(\"ms-menu-button\")\n    importBtn.innerText = \"Import\"\n    importBtn.disabled = true\n    subMenuWrapper.appendChild(importBtn)\n    importBtn.addEventListener(\"pointerup\", async (e) =>\n    {\n      e.preventDefault()\n      e.stopPropagation()\n      if (importInput.files?.length) {\n        const fileString = await this.readFileAsText(importInput.files[0])\n        const symbols = JSON.parse(fileString) as PartialDeep<TIISymbol>[]\n        await this.editor.createSymbols(symbols)\n        importInput.value = \"\"\n        importBtn.disabled = true\n      }\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      menuTitle: \"Import\",\n      subMenu: subMenuWrapper,\n      position: \"right-top\"\n    }\n    return new IIMenuSub(params).element\n  }\n\n  protected unselectAll(): void\n  {\n    this.wrapper?.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n  }\n\n  protected closeAllSubMenu(): void\n  {\n    this.wrapper?.querySelectorAll(\".open\").forEach(e => e.classList.remove(\"open\"))\n  }\n\n  render(layer: HTMLElement): void\n  {\n    if (this.editor.configuration.menu.action.enable) {\n      const menuTrigger = document.createElement(\"button\")\n      menuTrigger.id = this.id\n      menuTrigger.classList.add(\"ms-menu-button\", \"square\")\n      menuTrigger.innerHTML = menuIcon\n\n      const subMenuWrapper = document.createElement(\"div\")\n      subMenuWrapper.classList.add(\"ms-menu-colmun\")\n      subMenuWrapper.appendChild(this.createMenuGesture())\n      subMenuWrapper.appendChild(this.createMenuGuide())\n      subMenuWrapper.appendChild(this.createMenuSnap())\n      subMenuWrapper.appendChild(this.createMenuDebug())\n      subMenuWrapper.appendChild(this.createMenuImport())\n      subMenuWrapper.appendChild(this.createMenuExport())\n\n      this.wrapper = document.createElement(\"div\")\n      this.wrapper.classList.add(\"ms-menu\", \"ms-menu-top-left\", \"ms-menu-row\")\n      this.wrapper.appendChild(new IIMenuSub({ trigger: menuTrigger, subMenu: subMenuWrapper, position: \"bottom\" }).element)\n      this.wrapper.appendChild(this.createMenuLanguage())\n      this.wrapper.appendChild(this.createMenuClear())\n      this.wrapper.appendChild(this.createMenuUndo())\n      this.wrapper.appendChild(this.createMenuRedo())\n      this.wrapper.appendChild(this.createMenuConvert())\n\n      layer.appendChild(this.wrapper)\n      this.update()\n      this.show()\n    }\n  }\n\n  update(): void\n  {\n    if (this.menuLanguage) {\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      this.isMobile ? this.menuLanguage.wrap() : this.menuLanguage.unwrap()\n    }\n    if (this.menuClear) {\n      this.menuClear.disabled = this.editor.history.context.empty\n    }\n    if (this.menuUndo) {\n      this.menuUndo.disabled = !this.editor.history.context.canUndo\n    }\n    if (this.menuRedo) {\n      this.menuRedo.disabled = !this.editor.history.context.canRedo\n    }\n    if (this.menuConvert) {\n      this.menuConvert.disabled = !this.editor.extractStrokesFromSymbols(this.model.symbols).length\n    }\n  }\n\n  show(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"visible\"\n    }\n  }\n\n  hide(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"hidden\"\n    }\n  }\n\n  destroy(): void\n  {\n    if (this.wrapper) {\n      while (this.wrapper.lastChild) {\n        this.wrapper.removeChild(this.wrapper.lastChild)\n      }\n      this.wrapper.remove()\n      this.wrapper = undefined\n      this.menuClear = undefined\n      this.menuUndo = undefined\n      this.menuRedo = undefined\n      this.menuConvert = undefined\n    }\n  }\n}\n","import pencilIcon from \"../assets/svg/edit-pencil.svg\"\nimport cursorIcon from \"../assets/svg/frame-select.svg\"\nimport eraseIcon from \"../assets/svg/erase.svg\"\nimport handIcon from \"../assets/svg/drag-hand-gesture.svg\"\nimport rectangleIcon from \"../assets/svg/rectangle.svg\"\nimport rhombusIcon from \"../assets/svg/rhombus.svg\"\nimport circleIcon from \"../assets/svg/circle.svg\"\nimport ellipseIcon from \"../assets/svg/ellipse.svg\"\nimport triangleIcon from \"../assets/svg/triangle.svg\"\nimport lineIcon from \"../assets/svg/linear.svg\"\nimport arrowIcon from \"../assets/svg/linear-arrow.svg\"\nimport doubleArrowIcon from \"../assets/svg/linear-double-arrow.svg\"\nimport { EditorTool, EditorWriteTool } from \"../Constants\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIMenu } from \"./IIMenu\"\nimport { IIMenuSub } from \"./IIMenuSub\"\nimport { TSubMenuParam } from \"./IIMenuSub\"\nimport { createMenuButton } from \"./MenuHelper\"\nimport { InteractiveInkEditor } from \"../editor\"\n\n/**\n * @group Menu\n */\nexport class IIMenuTool extends IIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MENU)\n\n  editor: InteractiveInkEditor\n  id: string\n  wrapper?: HTMLDivElement\n  writeBtn?: HTMLButtonElement\n  menuSelect?: HTMLButtonElement\n  menuMove?: HTMLButtonElement\n  menuErase?: HTMLButtonElement\n  menuShape?: HTMLButtonElement\n  subMenuShape?: {\n    rectangle: HTMLButtonElement,\n    circle: HTMLButtonElement,\n    triangle: HTMLButtonElement,\n    ellipse: HTMLButtonElement\n    rhombus: HTMLButtonElement\n  }\n  menuEdge?: HTMLButtonElement\n  subMenuEdge?: {\n    line: HTMLButtonElement,\n    arrow: HTMLButtonElement,\n    doubleArrow: HTMLButtonElement,\n  }\n\n  constructor(editor: InteractiveInkEditor, id = \"ms-menu-tool\")\n  {\n    super()\n    this.id = id\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  protected createMenuWrite(): HTMLElement\n  {\n    this.writeBtn = createMenuButton(\n      `${this.id}-write-pencil`,\n      pencilIcon,\n      () => {\n        this.unselectAll()\n        this.writeBtn!.classList.add(\"active\")\n        this.editor.tool = EditorTool.Write\n        this.editor.writer.tool = EditorWriteTool.Pencil\n      }\n    )\n    return this.writeBtn\n  }\n\n  protected createMenuMove(): HTMLElement\n  {\n    this.menuMove = createMenuButton(\n      `${this.id}-move`,\n      handIcon,\n      () => {\n        this.unselectAll()\n        this.menuMove!.classList.add(\"active\")\n        this.editor.tool = EditorTool.Move\n      }\n    )\n    return this.menuMove\n  }\n\n  protected createMenuSelect(): HTMLElement\n  {\n    this.menuSelect = createMenuButton(\n      `${this.id}-select`,\n      cursorIcon,\n      () => {\n        this.unselectAll()\n        this.menuSelect!.classList.add(\"active\")\n        this.editor.tool = EditorTool.Select\n      }\n    )\n    return this.menuSelect\n  }\n\n  protected createMenuErase(): HTMLElement\n  {\n    this.menuErase = createMenuButton(\n      `${this.id}-erase`,\n      eraseIcon,\n      () => {\n        this.unselectAll()\n        this.menuErase!.classList.add(\"active\")\n        this.editor.tool = EditorTool.Erase\n      }\n    )\n    return this.menuErase\n  }\n\n  protected createShapeSubMenu(icon: string, tool: EditorWriteTool): HTMLButtonElement\n  {\n    const subMenuShape = createMenuButton(\n      `${this.id}-write-shape-${tool}`,\n      icon,\n      () => {\n        this.unselectAll()\n        this.editor.tool = EditorTool.Write\n        this.editor.writer.tool = tool\n        subMenuShape.classList.add(\"active\")\n        this.menuShape!.innerHTML = icon\n        this.menuShape!.classList.add(\"active\")\n        const subMenuContent = this.menuShape!.nextSibling\n        if (subMenuContent) {\n          (subMenuContent as HTMLElement).classList.remove(\"open\")\n        }\n      }\n    )\n    return subMenuShape\n  }\n\n  protected createMenuShape(): HTMLElement\n  {\n    this.menuShape = createMenuButton(\n      `${this.id}-write-shape`,\n      rectangleIcon,\n      () => {} // Click handled by IIMenuSub\n    )\n    this.subMenuShape = {\n      circle: this.createShapeSubMenu(circleIcon, EditorWriteTool.Circle),\n      rectangle: this.createShapeSubMenu(rectangleIcon, EditorWriteTool.Rectangle),\n      triangle: this.createShapeSubMenu(triangleIcon, EditorWriteTool.Triangle),\n      ellipse: this.createShapeSubMenu(ellipseIcon, EditorWriteTool.Ellipse),\n      rhombus: this.createShapeSubMenu(rhombusIcon, EditorWriteTool.Rhombus),\n    }\n    const subMenuContent = document.createElement(\"div\")\n    subMenuContent.id = `${this.id}-write-shape-list`\n    subMenuContent.classList.add(\"ms-menu-row\", \"sub-menu-content-shape\")\n    subMenuContent.appendChild(this.subMenuShape.rectangle)\n    subMenuContent.appendChild(this.subMenuShape.circle)\n    subMenuContent.appendChild(this.subMenuShape.ellipse)\n    subMenuContent.appendChild(this.subMenuShape.triangle)\n    subMenuContent.appendChild(this.subMenuShape.rhombus)\n\n    const params: TSubMenuParam = {\n      trigger: this.menuShape,\n      subMenu: subMenuContent,\n      position: \"top\"\n    }\n\n    return new IIMenuSub(params).element\n  }\n\n  protected createEdgeSubMenu(square: string, tool: EditorWriteTool): HTMLButtonElement\n  {\n    const subMenuEdge = createMenuButton(\n      `${this.id}-write-edge-${tool}`,\n      square,\n      () => {\n        this.unselectAll()\n        this.editor.tool = EditorTool.Write\n        this.editor.writer.tool = tool\n        subMenuEdge.classList.add(\"active\")\n        this.menuEdge!.innerHTML = square\n        this.menuEdge!.classList.add(\"active\")\n        const subMenuContent = this.menuEdge!.nextSibling\n        if (subMenuContent) {\n          (subMenuContent as HTMLElement).classList.remove(\"open\")\n        }\n      }\n    )\n    return subMenuEdge\n  }\n\n  protected createMenuEdge(): HTMLElement\n  {\n    this.menuEdge = createMenuButton(\n      `${this.id}-write-edge`,\n      lineIcon,\n      () => {} // Click handled by IIMenuSub\n    )\n    this.subMenuEdge = {\n      line: this.createEdgeSubMenu(lineIcon, EditorWriteTool.Line),\n      arrow: this.createEdgeSubMenu(arrowIcon, EditorWriteTool.Arrow),\n      doubleArrow: this.createEdgeSubMenu(doubleArrowIcon, EditorWriteTool.DoubleArrow),\n    }\n    const subMenuContent = document.createElement(\"div\")\n    subMenuContent.id = `${this.id}-write-edge-list`\n    subMenuContent.classList.add(\"ms-menu-row\", \"sub-menu-content-edge\")\n    subMenuContent.appendChild(this.subMenuEdge.line)\n    subMenuContent.appendChild(this.subMenuEdge.arrow)\n    subMenuContent.appendChild(this.subMenuEdge.doubleArrow)\n\n    const params: TSubMenuParam = {\n      trigger: this.menuEdge,\n      subMenu: subMenuContent,\n      position: \"top\"\n    }\n\n    return new IIMenuSub(params).element\n  }\n\n  protected unselectAll(): void\n  {\n    this.wrapper?.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n  }\n\n  update(): void\n  {\n    this.unselectAll()\n    switch (this.editor.tool) {\n      case EditorTool.Erase:\n        this.menuErase?.classList.add(\"active\")\n        break;\n      case EditorTool.Move:\n        this.menuMove?.classList.add(\"active\")\n        break;\n      case EditorTool.Select:\n        this.menuSelect?.classList.add(\"active\")\n        break;\n      case EditorTool.Write:\n        switch (this.editor.writer.tool) {\n          case EditorWriteTool.Circle:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.circle?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.Ellipse:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.ellipse?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.Triangle:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.triangle?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.Rectangle:\n            this.menuShape?.classList.add(\"active\")\n            this.subMenuShape?.rectangle?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.Line:\n            this.menuEdge?.classList.add(\"active\")\n            this.subMenuEdge?.line?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.Arrow:\n            this.menuEdge?.classList.add(\"active\")\n            this.subMenuEdge?.arrow?.classList.add(\"active\")\n            break;\n          case EditorWriteTool.DoubleArrow:\n            this.menuEdge?.classList.add(\"active\")\n            this.subMenuEdge?.doubleArrow?.classList.add(\"active\")\n            break;\n          default:\n            this.writeBtn?.classList.add(\"active\")\n            break;\n        }\n        break;\n    }\n  }\n\n  render(layer: HTMLElement): void\n  {\n    if (this.editor.configuration.menu.tool.enable) {\n      this.wrapper = document.createElement(\"div\")\n      this.wrapper.classList.add(\"ms-menu\", \"ms-menu-bottom\", \"ms-menu-row\")\n\n      this.wrapper.appendChild(this.createMenuWrite())\n      this.wrapper.appendChild(this.createMenuMove())\n      this.wrapper.appendChild(this.createMenuSelect())\n      this.wrapper.appendChild(this.createMenuErase())\n      this.wrapper.appendChild(this.createMenuEdge())\n      this.wrapper.appendChild(this.createMenuShape())\n\n      layer.appendChild(this.wrapper)\n      this.update()\n      this.show()\n    }\n  }\n\n  show(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"visible\"\n    }\n  }\n\n  hide(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"hidden\"\n    }\n  }\n\n  destroy(): void\n  {\n    if (this.wrapper) {\n      while (this.wrapper.lastChild) {\n        this.wrapper.removeChild(this.wrapper.lastChild)\n      }\n      this.wrapper.remove()\n      this.writeBtn = undefined\n      this.menuSelect = undefined\n      this.menuMove = undefined\n      this.menuErase = undefined\n      this.menuShape = undefined\n      this.subMenuShape = undefined\n      this.menuEdge = undefined\n      this.subMenuEdge = undefined\n      this.wrapper = undefined\n    }\n  }\n}\n","import styleIcon from \"../assets/svg/palette.svg\"\nimport { EditorTool, EditorWriteTool } from \"../Constants\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { SymbolType, TIISymbol } from \"../symbol\"\nimport { IIMenu, TMenuItemColorList } from \"./IIMenu\"\nimport { IIMenuSub } from \"./IIMenuSub\"\nimport { TSubMenuParam } from \"./IIMenuSub\"\nimport { InteractiveInkEditor } from \"../editor\"\n\n/**\n * @group Menu\n */\nexport class IIMenuStyle extends IIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MENU)\n\n  editor: InteractiveInkEditor\n  id: string\n  wrapper?: HTMLDivElement\n  subMenu?: IIMenuSub\n  triggerBtn?: HTMLButtonElement\n  menuColorStroke?: HTMLDivElement\n  menuColorFill?: HTMLDivElement\n  menuThickness?: HTMLDivElement\n  menuFontSize?: HTMLDivElement\n  menuFontWeight?: HTMLDivElement\n  menuStrokeOpacity?: HTMLDivElement\n\n  constructor(editor: InteractiveInkEditor, id = \"ms-menu-style\")\n  {\n    super()\n    this.id = id\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get symbolsSelected(): TIISymbol[]\n  {\n    return this.model.symbolsSelected\n  }\n\n  get writeShape(): boolean\n  {\n    return ![EditorWriteTool.Arrow, EditorWriteTool.DoubleArrow, EditorWriteTool.Line, EditorWriteTool.Pencil].includes(this.editor.writer.tool)\n  }\n\n  get rowHeight(): number\n  {\n    return this.editor.configuration.rendering.guides.gap\n  }\n\n  get isMobile(): boolean\n  {\n    return this.editor.renderer.parent.clientWidth < 700\n  }\n\n  protected createMenuStroke(): HTMLDivElement\n  {\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqColor = symbolsStyles.length && symbolsStyles.every(st => st.color === symbolsStyles[0]?.color)\n    const color = hasUniqColor && symbolsStyles[0]?.color ? symbolsStyles[0]?.color : this.editor.penStyle.color as string\n    const menuColorStrokeDef: TMenuItemColorList = {\n      type: \"colors\",\n      label: \"Colors\",\n      id: `${ this.id }-color`,\n      fill: false,\n      values: this.colors,\n      initValue: color,\n      callback: (color) =>\n      {\n        this.editor.penStyle = { color }\n        this.editor.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { color })\n      },\n    }\n    const menuColor = this.createColorList(menuColorStrokeDef)\n    this.menuColorStroke = this.createWrapCollapsible(menuColor, \"Colors\")\n    this.menuColorStroke.id = `${ this.id }-color`\n    return this.menuColorStroke\n  }\n\n  protected createMenuColorFill(): HTMLDivElement\n  {\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqColor = symbolsStyles.length && symbolsStyles.every(st => st.color === symbolsStyles[0]?.color)\n    const color = hasUniqColor && symbolsStyles[0].color ? symbolsStyles[0].color : this.editor.penStyle.color as string\n    const menuColorStrokeDef: TMenuItemColorList = {\n      type: \"colors\",\n      label: \"Fill\",\n      id: `${ this.id }-fill`,\n      fill: true,\n      values: this.colors,\n      initValue: color,\n      callback: (fill) =>\n      {\n        this.editor.penStyle = { fill }\n        this.editor.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { fill })\n      },\n    }\n    const menuColor = this.createColorList(menuColorStrokeDef)\n    this.menuColorFill = this.createWrapCollapsible(menuColor, \"Fill\")\n    this.menuColorFill.id = `${ this.id }-fill`\n    return this.menuColorFill\n  }\n\n  protected createMenuThickness(): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-thickness-list`\n    wrapper.classList.add(\"ms-menu-row\", \"thickness-list\")\n\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqWidth = symbolsStyles.length && symbolsStyles.every(st => st.width === symbolsStyles[0].width)\n    const width = hasUniqWidth ? symbolsStyles[0].width : this.editor.penStyle.width\n\n    this.thicknessList.forEach((size) =>\n    {\n      const btn = document.createElement(\"button\")\n      btn.id = `${ this.id }-thickness-${ size.label }-btn`\n      btn.classList.add(\"ms-menu-button\", \"square\")\n      btn.textContent = size.label\n      if (width === size.value) {\n        btn.classList.add(\"active\")\n      }\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        this.editor.penStyle = { width: size.value }\n        wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n        if (this.symbolsSelected.length) {\n          this.editor.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { width: size.value })\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      })\n      wrapper.appendChild(btn)\n    })\n    this.menuThickness = this.createWrapCollapsible(wrapper, \"Thickness\")\n    this.menuThickness.id = `${ this.id }-thickness`\n    return this.menuThickness\n  }\n\n  protected createMenuFontSize(): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-font-size-list`\n    wrapper.classList.add(\"ms-menu-row\", \"font-size-list\")\n\n    this.fontSizeList.forEach((size) =>\n    {\n      const btn = document.createElement(\"button\")\n      btn.id = `${ this.id }-font-size-${ size.label }-btn`\n      btn.classList.add(\"ms-menu-button\", \"square\")\n      btn.textContent = size.label\n      if (this.editor.configuration.fontStyle.size === size.value) {\n        btn.classList.add(\"active\")\n      }\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n        if (size.value === \"auto\") {\n          this.editor.configuration.fontStyle.size = \"auto\"\n        }\n        else {\n          const fontSize = (size.value as number)\n          this.editor.configuration.fontStyle.size = fontSize\n          const textSymbols = this.symbolsSelected.filter(s => s.type === SymbolType.Text || (s.type === SymbolType.Group && s.extractText().length))\n          this.editor.updateTextFontStyle(textSymbols.map(s => s.id), { fontSize: fontSize * this.rowHeight })\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      })\n      wrapper.appendChild(btn)\n    })\n    this.menuFontSize = this.createWrapCollapsible(wrapper, \"Font size\")\n    this.menuFontSize.id = `${ this.id }-font-size`\n    return this.menuFontSize\n  }\n\n  protected createMenuFontWeight(): HTMLDivElement\n  {\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-font-weight-list`\n    wrapper.classList.add(\"ms-menu-row\", \"font-weight-list\")\n\n    this.fontWeightList.forEach((weight) =>\n    {\n      const btn = document.createElement(\"button\")\n      btn.id = `${ this.id }-font-weight-${ weight.label }-btn`\n      btn.classList.add(\"ms-menu-button\", \"center\")\n      btn.textContent = weight.label\n      if (this.editor.configuration.fontStyle.weight === weight.value) {\n        btn.classList.add(\"active\")\n      }\n      btn.addEventListener(\"pointerup\", (e) =>\n      {\n        e.preventDefault()\n        e.stopPropagation()\n        wrapper.querySelectorAll(\"*\").forEach(e => e.classList.remove(\"active\"))\n        btn.classList.add(\"active\")\n        this.editor.configuration.fontStyle.weight = weight.value as \"auto\" | \"normal\" | \"bold\"\n        if (this.editor.configuration.fontStyle.weight !== \"auto\") {\n          const textSymbols = this.symbolsSelected.filter(s => s.type === SymbolType.Text || (s.type === SymbolType.Group && s.extractText().length))\n          this.editor.updateTextFontStyle(textSymbols.map(s => s.id), { fontWeight: this.editor.configuration.fontStyle.weight })\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      })\n      wrapper.appendChild(btn)\n    })\n    this.menuFontWeight = this.createWrapCollapsible(wrapper, \"Font weight\")\n    this.menuFontWeight.id = `${ this.id }-font-weight`\n    return this.menuFontWeight\n  }\n\n  protected createMenuOpacity(): HTMLDivElement\n  {\n    const symbolsStyles = this.symbolsSelected.map(s => s.style)\n    const hasUniqOpacity = symbolsStyles.length && symbolsStyles.every(st => st.opacity === symbolsStyles[0]?.opacity)\n    const currentOpacity = (hasUniqOpacity && symbolsStyles[0]?.opacity ? symbolsStyles[0]?.opacity : (this.editor.penStyle.opacity || 1)) * 100 as number\n\n    const wrapper = document.createElement(\"div\")\n    wrapper.id = `${ this.id }-opacity-input-wrapper`\n    const input = document.createElement(\"input\")\n    input.id = `${ this.id }-opacity-input`\n    input.setAttribute(\"name\", `opacity`)\n    input.setAttribute(\"type\", \"range\")\n    input.setAttribute(\"step\", \"1\")\n    input.setAttribute(\"min\", \"1\")\n    input.setAttribute(\"max\", \"100\")\n    wrapper.appendChild(input)\n\n    const output = document.createElement(\"output\")\n    output.setAttribute(\"for\", `opacity`)\n    output.innerHTML = currentOpacity ? `${ currentOpacity }` : \"-\"\n    wrapper.appendChild(output)\n\n    if (currentOpacity) {\n      input.setAttribute(\"value\", currentOpacity.toString())\n    }\n    input.addEventListener(\"input\", (evt) =>\n    {\n      const value = (evt.target as HTMLInputElement).value as unknown as number\n      output.innerHTML = `${ value }%`\n      this.editor.penStyle = { opacity: value / 100 }\n      if (this.symbolsSelected.length) {\n        this.editor.updateSymbolsStyle(this.symbolsSelected.map(s => s.id), { opacity: value / 100 })\n      }\n    })\n    this.menuStrokeOpacity = this.createWrapCollapsible(wrapper, \"Opacity\")\n    this.menuStrokeOpacity.id = `${ this.id }-opacity`\n    return this.menuStrokeOpacity\n  }\n\n  render(layer: HTMLElement): void\n  {\n    if (this.editor.configuration.menu.style.enable) {\n      this.triggerBtn = document.createElement(\"button\")\n      this.triggerBtn.id = this.id\n      this.triggerBtn.classList.add(\"ms-menu-button\", \"square\")\n      this.triggerBtn.innerHTML = styleIcon\n\n      const subMenuContent = document.createElement(\"div\")\n      subMenuContent.classList.add(\"ms-menu-colmun\")\n      subMenuContent.appendChild(this.createMenuStroke())\n      subMenuContent.appendChild(this.createMenuColorFill())\n      subMenuContent.appendChild(this.createMenuThickness())\n      subMenuContent.appendChild(this.createMenuFontSize())\n      subMenuContent.appendChild(this.createMenuFontWeight())\n      subMenuContent.appendChild(this.createMenuOpacity())\n\n      const params: TSubMenuParam = {\n        trigger: this.triggerBtn,\n        subMenu: subMenuContent,\n        position: \"bottom-left\",\n      }\n      this.subMenu = new IIMenuSub(params)\n\n      this.wrapper = document.createElement(\"div\")\n      this.wrapper.classList.add(\"ms-menu\", \"ms-menu-top-right\")\n      this.wrapper.appendChild(this.subMenu.element)\n      layer.appendChild(this.wrapper)\n      this.update()\n    }\n  }\n\n  update(): void\n  {\n    if (this.subMenu) {\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      this.isMobile ? this.subMenu.wrap() : this.subMenu.unwrap()\n    }\n\n    if (this.editor.tool === EditorTool.Write) {\n      this.show()\n      if (this.menuColorStroke) {\n        this.menuColorStroke.style.display = \"block\"\n      }\n      if (this.menuColorFill) {\n        this.menuColorFill.style.display = this.writeShape ? \"block\" : \"none\"\n      }\n      if (this.menuThickness) {\n        this.menuThickness.style.display = \"block\"\n      }\n      if (this.menuFontSize) {\n        this.menuFontSize.style.display = \"block\"\n      }\n      if (this.menuFontWeight) {\n        this.menuFontWeight.style.display = \"block\"\n      }\n      if (this.menuStrokeOpacity) {\n        this.menuStrokeOpacity.style.display = \"block\"\n      }\n    }\n    else if (this.editor.tool === EditorTool.Select) {\n      this.show()\n      if (this.menuColorStroke) {\n        this.menuColorStroke.style.display = \"block\"\n      }\n      if (this.menuColorFill) {\n        const shapeSelected = this.model.symbolsSelected.length && this.model.symbolsSelected.some(s => s.type === SymbolType.Shape)\n        this.menuColorFill.style.display = shapeSelected ? \"block\" : \"none\"\n      }\n      if (this.menuThickness) {\n        this.menuThickness.style.display = \"block\"\n      }\n      if (this.menuFontSize) {\n        this.menuFontSize.style.display = \"block\"\n      }\n      if (this.menuFontWeight) {\n        this.menuFontWeight.style.display = \"block\"\n      }\n      if (this.menuStrokeOpacity) {\n        this.menuStrokeOpacity.style.display = \"block\"\n      }\n    }\n    else {\n      this.hide()\n    }\n  }\n\n  show(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"visible\"\n    }\n  }\n\n  hide(): void\n  {\n    if (this.wrapper) {\n      this.wrapper.style.visibility = \"hidden\"\n    }\n  }\n\n  destroy(): void\n  {\n    if (this.wrapper) {\n      while (this.wrapper.lastChild) {\n        this.wrapper.removeChild(this.wrapper.lastChild)\n      }\n      this.wrapper.remove()\n      this.wrapper = undefined\n      this.subMenu = undefined\n      this.triggerBtn = undefined\n      this.menuColorStroke = undefined\n      this.menuColorFill = undefined\n      this.menuThickness = undefined\n      this.menuFontSize = undefined\n      this.menuFontWeight = undefined\n      this.menuStrokeOpacity = undefined\n    }\n  }\n}\n","import ArrowDown from \"../assets/svg/nav-arrow-down.svg\"\nimport { SELECTION_MARGIN } from \"../Constants\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { DecoratorKind, IIDecorator, IIRecognizedText, IIStroke, IISymbolGroup, IIText, RecognizedKind, SymbolType, TIISymbol } from \"../symbol\"\nimport { IIMenu, TMenuItemBoolean, TMenuItemButton, TMenuItemColorList } from \"./IIMenu\"\nimport { createUUID } from \"../utils\"\nimport { IIMenuSub, TSubMenuParam } from \"./IIMenuSub\"\nimport { InteractiveInkEditor } from \"../editor\"\nimport { createMenuButtonWithText } from \"./MenuHelper\"\n/**\n * @group Menu\n */\nexport class IIMenuContext extends IIMenu\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MENU)\n  static readonly #DECORABLE_TYPES = new Set([SymbolType.Group, SymbolType.Stroke, SymbolType.Text, SymbolType.Recognized])\n  editor: InteractiveInkEditor\n  id: string\n  wrapper?: HTMLElement\n  editMenu?: HTMLDivElement\n  editInput?: HTMLInputElement\n  editSaveBtn?: HTMLButtonElement\n  reorderMenu?: HTMLDivElement\n  decoratorMenu?: HTMLDivElement\n  menuExport?: HTMLDivElement\n  duplicateBtn?: HTMLButtonElement\n  groupBtn?: HTMLButtonElement\n  convertBtn?: HTMLButtonElement\n  removeBtn?: HTMLButtonElement\n\n  position: {\n    x: number,\n    y: number,\n    scrollTop: number,\n    scrollLeft: number\n  }\n\n  constructor(editor: InteractiveInkEditor, id = \"ms-menu-context\")\n  {\n    super()\n    this.id = id\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.position = { x: 0, y: 0, scrollLeft: 0, scrollTop: 0 }\n  }\n\n  get symbolsSelected(): TIISymbol[]\n  {\n    return this.editor.model.symbolsSelected\n  }\n\n  get haveSymbolsSelected(): boolean\n  {\n    return this.symbolsSelected.length > 0\n  }\n\n  get symbolsDecorable(): (IIStroke | IIText | IISymbolGroup | IIRecognizedText)[]\n  {\n    return this.symbolsSelected.filter(s => IIMenuContext.#DECORABLE_TYPES.has(s.type) || (s.type === SymbolType.Recognized && s.kind === RecognizedKind.Text)) as (IIStroke | IIText | IISymbolGroup | IIRecognizedText)[]\n  }\n\n  get showDecorator(): boolean\n  {\n    return this.symbolsDecorable.length > 0\n  }\n\n  protected createMenuEdit(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-edit-trigger`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Edit\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    this.editInput = document.createElement(\"input\")\n    subMenuWrapper.appendChild(this.editInput)\n    this.editSaveBtn = document.createElement(\"button\")\n    this.editSaveBtn.classList.add(\"ms-menu-button\")\n    this.editSaveBtn.innerText = \"Save\"\n    subMenuWrapper.appendChild(this.editSaveBtn)\n    this.editSaveBtn.addEventListener(\"pointerdown\", async (e) =>\n    {\n      e.stopPropagation()\n      const textSymbol = this.editor.model.symbolsSelected.find(s => s.type === SymbolType.Text) as IIText\n      if (textSymbol) {\n        const firstChar = textSymbol.chars[0]\n        textSymbol.chars = []\n        for (let i = 0; i < this.editInput!.value.length; i++) {\n          textSymbol.chars.push({\n            label: this.editInput!.value.charAt(i),\n            id: createUUID(),\n            color: firstChar.color,\n            fontSize: firstChar.fontSize,\n            fontWeight: firstChar.fontWeight,\n            bounds: firstChar.bounds\n          })\n        }\n        await this.editor.updateSymbol(textSymbol)\n        this.editor.selector.resetSelectedGroup([textSymbol])\n      }\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.editMenu = new IIMenuSub(params).element\n\n    return this.editMenu\n  }\n\n  protected createMenuDuplicate(): HTMLElement\n  {\n    this.duplicateBtn = createMenuButtonWithText(\n      `${ this.id }-duplicate`,\n      \"Duplicate\",\n      async () => {\n        const symbolsToDuplicate = this.symbolsSelected\n\n        const updateDeepIdInGroup = (gr: IISymbolGroup) =>\n      {\n        gr.children.forEach(s =>\n        {\n          s.id = s.id.slice(0, -36) + `-${ createUUID() }`\n          switch (s.type) {\n            case SymbolType.Group:\n              updateDeepIdInGroup(s)\n              break\n            case SymbolType.Recognized:\n              s.strokes.forEach(s => s.id = s.id.slice(0, -36) + `-${ createUUID() }`)\n              break\n          }\n        })\n      }\n      const duplicatedSymbols = symbolsToDuplicate.map(s =>\n      {\n        const clone = s.clone()\n        while (this.editor.model.symbols.find(s => s.id === clone.id)) {\n          clone.id = clone.id.slice(0, -36) + `-${ createUUID() }`\n          if (clone.type === SymbolType.Group) {\n            updateDeepIdInGroup(clone)\n          }\n          else if (clone.type === SymbolType.Recognized) {\n            clone.strokes.forEach(s => s.id = s.id.slice(0, -36) + `-${ createUUID() }`)\n          }\n        }\n        clone.selected = true\n        this.editor.translator.applyToSymbol(clone, SELECTION_MARGIN, SELECTION_MARGIN)\n        return clone\n      })\n\n      this.editor.unselectAll()\n      await this.editor.addSymbols(duplicatedSymbols)\n      this.editor.selector.drawSelectedGroup(duplicatedSymbols)\n    }\n    )\n    return this.duplicateBtn\n  }\n\n  protected createMenuGroup(): HTMLElement\n  {\n    this.groupBtn = createMenuButtonWithText(\n      `${ this.id }-duplicate`,\n      \"Group\",\n      async () => {\n        if (this.symbolsSelected.length === 1 && this.symbolsSelected[0].type === SymbolType.Group) {\n          const symbols = this.editor.ungroupSymbol(this.symbolsSelected[0] as IISymbolGroup)\n          this.editor.select(symbols.map(s => s.id))\n        }\n        else {\n          const symbols = this.symbolsSelected.slice()\n          this.editor.unselectAll()\n          const group = this.editor.groupSymbols(symbols)\n          group.selected = true\n          this.editor.select([group.id])\n        }\n      }\n    )\n    return this.groupBtn\n  }\n\n  protected createMenuConvert(): HTMLElement\n  {\n    this.convertBtn = createMenuButtonWithText(\n      `${ this.id }-convert`,\n      \"Convert\",\n      () => this.editor.convertSymbols(this.symbolsSelected)\n    )\n    return this.convertBtn\n  }\n\n  protected createMenuRemove(): HTMLButtonElement\n  {\n    this.removeBtn = createMenuButtonWithText(\n      `${ this.id }-remove`,\n      \"Remove\",\n      async () => {\n        this.editor.selector.removeSelectedGroup()\n        await this.editor.removeSymbols(this.symbolsSelected.map(s => s.id))\n      }\n    )\n    return this.removeBtn\n  }\n\n  protected createMenuReorder(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-reorder`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Reorder\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const menuItems: TMenuItemButton[] = [\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-first`,\n        label: \"Bring to front\",\n        callback: () =>\n        {\n          this.editor.changeOrderSymbols(this.symbolsSelected, \"last\")\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-forward`,\n        label: \"Bring forward\",\n        callback: () =>\n        {\n          this.editor.changeOrderSymbols(this.symbolsSelected, \"forward\")\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-backward`,\n        label: \"Send backward\",\n        callback: () =>\n        {\n          this.editor.changeOrderSymbols(this.symbolsSelected, \"backward\")\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-reorder-last`,\n        label: \"Send to back\",\n        callback: () =>\n        {\n          this.editor.changeOrderSymbols(this.symbolsSelected.slice().reverse(), \"first\")\n          this.editor.selector.resetSelectedGroup(this.symbolsSelected)\n        }\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.reorderMenu = new IIMenuSub(params).element\n    return this.reorderMenu\n  }\n\n  protected createDecoratorSubMenu(label: string, kind: DecoratorKind): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-decorator-${ kind }`\n    trigger.classList.add(\"ms-menu-button\")\n    const labelEL = document.createElement(\"span\")\n    labelEL.innerText = label\n    trigger.appendChild(labelEL)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const menuItems: (TMenuItemBoolean | TMenuItemColorList)[] = [\n      {\n        type: \"checkbox\",\n        id: `${ this.id }-decorator-${ kind }-enable`,\n        label: \"Enable\",\n        initValue: false,\n        callback: (enable) =>\n        {\n          this.symbolsDecorable.forEach(s =>\n          {\n            if (enable) {\n              if (!s.decorators.some(d => d.kind === kind)) {\n                s.decorators.push(new IIDecorator(kind, this.editor.penStyle))\n              }\n            }\n            else {\n              const decoIndex = s.decorators.findIndex(d => d.kind === kind)\n              if (decoIndex > -1) {\n                s.decorators.splice(decoIndex, 1)\n              }\n            }\n            this.editor.model.updateSymbol(s)\n            this.editor.renderer.drawSymbol(s)\n          })\n\n          document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n          {\n            (b as HTMLButtonElement).disabled = !enable\n            b.classList.remove(\"active\")\n          })\n          if (enable) {\n            document.querySelector(`#${ this.id }-decorator-${ kind }-color button`)?.classList.add(\"active\")\n          }\n        }\n      },\n      {\n        type: \"colors\",\n        label: \"Colors\",\n        id: `${ this.id }-decorator-${ kind }-color`,\n        fill: false,\n        values: this.colors.filter((_c, i) => !(i % 4)),\n        initValue: this.colors[0],\n        disabled: true,\n        callback: (color) =>\n        {\n          this.symbolsDecorable.forEach(s =>\n          {\n            const deco = s.decorators.find(d => d.kind === kind)\n            if (deco) {\n              deco.style.color = color\n              this.editor.model.updateSymbol(s)\n              this.editor.renderer.drawSymbol(s)\n            }\n          })\n        },\n      }\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    return this.decoratorMenu = new IIMenuSub(params).element\n  }\n\n  protected createMenuDecorator(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-decorator`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Decorator\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Hightlight\", DecoratorKind.Highlight))\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Surround\", DecoratorKind.Surround))\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Underline\", DecoratorKind.Underline))\n    subMenuWrapper.appendChild(this.createDecoratorSubMenu(\"Strikethrough\", DecoratorKind.Strikethrough))\n\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.decoratorMenu = new IIMenuSub(params).element\n    return this.decoratorMenu\n  }\n\n  protected createMenuExport(): HTMLElement\n  {\n    const trigger = document.createElement(\"button\")\n    trigger.id = `${ this.id }-export`\n    trigger.classList.add(\"ms-menu-button\")\n    const label = document.createElement(\"span\")\n    label.innerText = \"Export\"\n    trigger.appendChild(label)\n    const icon = document.createElement(\"span\")\n    icon.style.setProperty(\"width\", \"32px\")\n    icon.style.setProperty(\"transform\", \"rotate(270deg)\")\n    icon.innerHTML = ArrowDown\n    trigger.appendChild(icon)\n\n    const menuItems: TMenuItemButton[] = [\n      {\n        type: \"button\",\n        id: `${ this.id }-export-json`,\n        label: \"json\",\n        callback: () => this.editor.downloadAsJson(this.haveSymbolsSelected)\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-svg`,\n        label: \"svg\",\n        callback: () => this.editor.downloadAsSVG(this.haveSymbolsSelected)\n      },\n      {\n        type: \"button\",\n        id: `${ this.id }-export-png`,\n        label: \"png\",\n        callback: () => this.editor.downloadAsPNG(this.haveSymbolsSelected)\n      },\n    ]\n    const subMenuWrapper = document.createElement(\"div\")\n    subMenuWrapper.classList.add(\"ms-menu-colmun\")\n    menuItems.forEach(i =>\n    {\n      subMenuWrapper.appendChild(this.createMenuItem(i))\n    })\n    const params: TSubMenuParam = {\n      trigger: trigger,\n      subMenu: subMenuWrapper,\n      position: \"right\"\n    }\n    this.menuExport = new IIMenuSub(params).element\n    return this.menuExport\n  }\n\n  protected createMenuSelectAll(): HTMLElement\n  {\n    const btn = document.createElement(\"button\")\n    btn.id = `${ this.id }-duplicate`\n    btn.textContent = \"Select all\"\n    btn.classList.add(\"ms-menu-button\")\n    btn.addEventListener(\"pointerup\", async () => this.editor.selectAll())\n    return btn\n  }\n\n  protected updateDecoratorSubMenu(): void\n  {\n    if (this.showDecorator) {\n      this.decoratorMenu?.style.removeProperty(\"display\")\n\n      Object.values(DecoratorKind).forEach(kind =>\n      {\n        const checkbox = document.getElementById(`${ this.id }-decorator-${ kind }-enable`) as HTMLInputElement\n        if (checkbox) {\n          document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(e => e.classList.remove(\"active\"))\n          const decos = this.symbolsDecorable.flatMap(s => s.decorators).filter(d => d.kind === kind)\n\n          if (decos.length && decos.every(d => d.style.color === decos[0].style.color)) {\n            const btnToActivate = document.getElementById(`${ this.id }-decorator-${ kind }-color-${ decos[0].style.color?.replace(\"#\", \"\") }-btn`)\n            btnToActivate?.classList.add(\"active\")\n          }\n\n          if (this.symbolsDecorable.filter(s => s.decorators.some(d => d.kind === kind)).length === this.symbolsDecorable.length) {\n            checkbox.checked = true\n\n            document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n            {\n              (b as HTMLButtonElement).disabled = false\n            })\n            checkbox.indeterminate = false\n          }\n          else if (this.symbolsDecorable.filter(s => !s.decorators.some(d => d.kind === kind)).length === this.symbolsDecorable.length) {\n            checkbox.checked = false\n            document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n            {\n              (b as HTMLButtonElement).disabled = true\n            })\n            checkbox.indeterminate = false\n          }\n          else {\n            checkbox.setAttribute(\"indeterminate\", \"true\")\n            checkbox.indeterminate = true\n            document.querySelectorAll(`#${ this.id }-decorator-${ kind }-color button`).forEach(b =>\n            {\n              (b as HTMLButtonElement).disabled = false\n            })\n          }\n        }\n\n      })\n    }\n    else {\n      this.decoratorMenu?.style.setProperty(\"display\", \"none\")\n    }\n  }\n\n  protected updateGroupMenu(): void\n  {\n    if (this.groupBtn && this.haveSymbolsSelected) {\n      this.groupBtn.style.removeProperty(\"display\")\n      if (this.symbolsSelected.length === 1 && this.symbolsSelected[0].type === SymbolType.Group) {\n        this.groupBtn.textContent = \"UnGroup\"\n      }\n      else {\n        this.groupBtn.textContent = \"Group\"\n      }\n    }\n    else {\n      this.groupBtn?.style.setProperty(\"display\", \"none\")\n    }\n  }\n\n  update(): void\n  {\n    this.wrapper?.style.setProperty(\"left\", `${ this.position.x - this.position.scrollLeft }px`)\n    this.wrapper?.style.setProperty(\"top\", `${ this.position.y - this.position.scrollTop }px`)\n\n    if (this.haveSymbolsSelected) {\n      const textSymbol = this.editor.model.symbolsSelected.find(s => s.type === SymbolType.Text)\n      if (this.editMenu && this.editInput && this.editor.model.symbolsSelected.length === 1 && textSymbol) {\n        this.editMenu.style.removeProperty(\"display\")\n        this.editInput.value = (textSymbol as IIText).label\n      }\n      else {\n        this.editMenu?.style.setProperty(\"display\", \"none\")\n      }\n\n      if (this.editor.extractStrokesFromSymbols(this.symbolsSelected).length) {\n        this.convertBtn?.style.removeProperty(\"display\")\n      }\n      else {\n        this.convertBtn?.style.setProperty(\"display\", \"none\")\n      }\n\n\n      this.reorderMenu?.style.removeProperty(\"display\")\n      this.duplicateBtn?.style.removeProperty(\"display\")\n      this.removeBtn?.style.removeProperty(\"display\")\n      this.menuExport?.style.removeProperty(\"display\")\n    }\n    else {\n      this.editMenu?.style.setProperty(\"display\", \"none\")\n      this.convertBtn?.style.setProperty(\"display\", \"none\")\n      this.reorderMenu?.style.setProperty(\"display\", \"none\")\n      this.duplicateBtn?.style.setProperty(\"display\", \"none\")\n      this.removeBtn?.style.setProperty(\"display\", \"none\")\n      this.menuExport?.style.setProperty(\"display\", \"none\")\n    }\n    this.updateDecoratorSubMenu()\n    this.updateGroupMenu()\n  }\n\n  render(layer: HTMLElement): void\n  {\n    this.wrapper = document.createElement(\"div\")\n    this.wrapper.id = `${ this.id }-wrapper`\n    this.wrapper.classList.add(\"ms-menu\", \"ms-menu-context\")\n    this.wrapper.appendChild(this.createMenuEdit())\n    this.wrapper.appendChild(this.createMenuDecorator())\n    this.wrapper.appendChild(this.createMenuReorder())\n    this.wrapper.appendChild(this.createMenuExport())\n    this.wrapper.appendChild(this.createMenuConvert())\n    this.wrapper.appendChild(this.createMenuGroup())\n    this.wrapper.appendChild(this.createMenuDuplicate())\n    this.wrapper.appendChild(this.createMenuRemove())\n    this.wrapper.appendChild(this.createMenuSelectAll())\n    this.wrapper.style.setProperty(\"display\", \"none\")\n    layer.appendChild(this.wrapper)\n\n    this.editor.layers.rendering.addEventListener(\"scroll\", () =>\n    {\n      this.position.scrollLeft = this.editor.layers.rendering.scrollLeft || 0\n      this.position.scrollTop = this.editor.layers.rendering.scrollTop || 0\n      this.update()\n    })\n  }\n\n  show(): void\n  {\n    this.update()\n    this.wrapper?.style.setProperty(\"display\", \"block\")\n  }\n\n  hide(): void\n  {\n    this.wrapper?.style.setProperty(\"display\", \"none\")\n  }\n\n  destroy(): void\n  {\n    while (this.wrapper?.lastChild) {\n      this.wrapper.removeChild(this.wrapper.lastChild)\n    }\n    this.wrapper?.remove()\n  }\n}\n","\n/**\n * @group Menu\n */\nexport type TMenuConfiguration = {\n  enable: boolean,\n  style: {\n    enable: boolean,\n  }\n  tool: {\n    enable: boolean,\n  }\n  action: {\n    enable: boolean,\n  }\n  context: {\n    enable: boolean,\n  }\n}\n\n/**\n * @group Menu\n * @source\n */\nexport const DefaultMenuConfiguration: TMenuConfiguration = {\n  enable: true,\n  style: {\n    enable: true\n  },\n  tool: {\n    enable: true\n  },\n  action: {\n    enable: true\n  },\n  context: {\n    enable: true\n  },\n}\n","import style from \"./menu.css\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { InteractiveInkEditor } from \"../editor\"\nimport { IIMenuAction } from \"./IIMenuAction\"\nimport { IIMenuTool } from \"./IIMenuTool\"\nimport { IIMenuContext } from \"./IIMenuContext\"\nimport { IIMenuStyle } from \"./IIMenuStyle\"\n\n/**\n * @group Manager\n */\nexport class IIMenuManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.MENU)\n  editor: InteractiveInkEditor\n  layer?: HTMLElement\n  action: IIMenuAction\n  tool: IIMenuTool\n  context: IIMenuContext\n  style: IIMenuStyle\n\n  constructor(editor: InteractiveInkEditor, custom?: { style?: IIMenuStyle, tool?: IIMenuTool, action?: IIMenuAction, context?: IIMenuContext })\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n\n    if (custom?.style) {\n      const CustomMenuStyle = custom.style as unknown as typeof IIMenuStyle\n      this.style = new CustomMenuStyle(this.editor)\n    }\n    else {\n      this.style = new IIMenuStyle(this.editor)\n    }\n    if (custom?.tool) {\n      const CustomMenuTool = custom.tool as unknown as typeof IIMenuTool\n      this.tool = new CustomMenuTool(this.editor)\n    }\n    else {\n      this.tool = new IIMenuTool(this.editor)\n    }\n    if (custom?.action) {\n      const CustomMenuAction = custom.action as unknown as typeof IIMenuAction\n      this.action = new CustomMenuAction(this.editor)\n    }\n    else {\n      this.action = new IIMenuAction(this.editor)\n    }\n    if (custom?.context) {\n      const CustomMenuAction = custom.context as unknown as typeof IIMenuContext\n      this.context = new CustomMenuAction(this.editor)\n    }\n    else {\n      this.context = new IIMenuContext(this.editor)\n    }\n  }\n\n  render(layer: HTMLElement): void\n  {\n    if (this.editor.configuration.menu.enable) {\n      this.layer = layer\n\n      const styleElement = document.createElement(\"style\")\n      styleElement.appendChild(document.createTextNode(style as string))\n      this.layer.prepend(styleElement)\n\n      if (this.editor.configuration.menu.action.enable) {\n        this.action.render(this.layer)\n      }\n      if (this.editor.configuration.menu.style.enable) {\n        this.style.render(this.layer)\n      }\n      if (this.editor.configuration.menu.tool.enable) {\n        this.tool.render(this.layer)\n      }\n      if (this.editor.configuration.menu.context.enable) {\n        this.context.render(this.layer)\n      }\n    }\n  }\n\n  update(): void\n  {\n    this.action.update()\n    this.tool.update()\n    this.style.update()\n  }\n\n  show(): void\n  {\n    this.action.show()\n    this.tool.show()\n    this.style.show()\n  }\n\n  hide(): void\n  {\n    this.action.hide()\n    this.tool.hide()\n    this.style.hide()\n  }\n\n  destroy(): void\n  {\n    this.action.destroy()\n    this.tool.destroy()\n    this.style.destroy()\n  }\n}\n","import { PartialDeep } from \"../utils\"\n\n/**\n * @group Snap\n */\nexport type TSnapConfiguration = {\n  guide: boolean\n  symbol: boolean\n  angle: number\n}\n\n/**\n * @group Snap\n * @source\n */\nexport const DefaultSnapConfiguration: TSnapConfiguration = {\n  guide: true,\n  symbol: true,\n  angle: 0\n}\n\n/**\n * @group Snap\n */\nexport class SnapConfiguration implements TSnapConfiguration\n{\n  guide: boolean\n  symbol: boolean\n  angle: number\n\n  constructor(config? : PartialDeep<TSnapConfiguration>)\n  {\n    this.symbol = config?.symbol !== undefined ? config.symbol : DefaultSnapConfiguration.symbol\n    this.guide = config?.guide !== undefined ? config.guide : DefaultSnapConfiguration.guide\n    this.angle = config?.angle !== undefined ? config.angle : DefaultSnapConfiguration.angle\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { IIModel } from \"../model\"\nimport { Box, TPoint, TSegment } from \"../symbol\"\nimport { SVGRenderer } from \"../renderer\"\nimport { SVGRendererConst } from \"../renderer/svg/SVGRendererConst\"\nimport { InteractiveInkEditor } from \"../editor/InteractiveInkEditor\"\nimport { PartialDeep } from \"../utils\"\nimport { SnapConfiguration, TSnapConfiguration } from \"./IISnapConfiguration\"\n\n/**\n * @group Snap\n */\nexport type TSnapNudge = TPoint\n\n/**\n * @group Snap\n */\nexport type TSnapLineInfos = {\n  nudge: TSnapNudge,\n  verticales: TSegment[]\n  horizontales: TSegment[]\n}\n\n/**\n * @group Snap\n */\nexport class IISnapManager\n{\n  #logger = LoggerManager.getLogger(LoggerCategory.CONVERTER)\n  editor: InteractiveInkEditor\n  configuration: SnapConfiguration\n\n  constructor(editor: InteractiveInkEditor, config?: PartialDeep<TSnapConfiguration>)\n  {\n    this.#logger.info(\"constructor\")\n    this.editor = editor\n    this.configuration = new SnapConfiguration(config)\n  }\n\n  get model(): IIModel\n  {\n    return this.editor.model\n  }\n\n  get renderer(): SVGRenderer\n  {\n    return this.editor.renderer\n  }\n\n  get selectionSnapPoints(): TPoint[]\n  {\n    return Box.createFromPoints(this.model.symbolsSelected.flatMap(s => s.snapPoints)).snapPoints\n  }\n\n  get otherSnapPoints(): TPoint[]\n  {\n    const selectSymbolIds = this.model.symbolsSelected.map(s => s.id)\n    return this.model.symbols.filter(s => !selectSymbolIds.includes(s.id)).flatMap(s => s.snapPoints)\n  }\n\n  get snapThreshold(): number\n  {\n    return this.editor.configuration.rendering.guides.gap / 2\n  }\n\n  protected getNearestVerticalGuide(x: number): number\n  {\n    if (this.renderer.verticalGuides.length) {\n      return this.renderer.verticalGuides.reduce((prev, curr) =>\n      {\n        return (Math.abs(curr - x) < Math.abs(prev - x) ? curr : prev)\n      })\n    }\n    return x\n  }\n\n  protected getNearestHorizontalGuide(y: number): number\n  {\n    if (this.renderer.horizontalGuides.length) {\n      return this.renderer.horizontalGuides.reduce((prev, curr) =>\n      {\n        return (Math.abs(curr - y) < Math.abs(prev - y) ? curr : prev)\n      })\n    }\n    return y\n  }\n\n  protected getGuidePointToSnap(point: TPoint): TPoint\n  {\n    return {\n      x: this.getNearestVerticalGuide(point.x),\n      y: this.getNearestHorizontalGuide(point.y)\n    }\n  }\n\n  drawSnapToElementLines(lines: TSegment[]): void\n  {\n    const attrs = {\n      role: \"snap-to-element\",\n      fill: \"transparent\",\n      stroke: \"blue\",\n      \"stroke-width\": \"2\",\n      style: SVGRendererConst.noSelection,\n      \"marker-start\": `url(#${ SVGRendererConst.crossMarker })`,\n      \"marker-end\": `url(#${ SVGRendererConst.crossMarker })`\n    }\n    lines.forEach(seg =>\n    {\n      this.renderer.drawLine(seg.p1, seg.p2, attrs)\n    })\n  }\n\n  clearSnapToElementLines(): void\n  {\n    this.renderer.clearElements({ attrs: { role: \"snap-to-element\" } })\n  }\n\n  protected getSnapLinesInfos(sourcePoints: TPoint[], targetPoints: TPoint[]): TSnapLineInfos\n  {\n    const infos: TSnapLineInfos = {\n      nudge: {\n        x: Infinity,\n        y: Infinity\n      },\n      verticales: [],\n      horizontales: [],\n    }\n    if (!sourcePoints.length || !targetPoints.length) return infos\n\n    sourcePoints.forEach(p1 =>\n    {\n      targetPoints.forEach(p2 =>\n      {\n        if (this.snapThreshold > Math.abs(p2.x - p1.x)) {\n          if (Math.abs(infos.nudge.x) > Math.abs(p2.x - p1.x)) {\n            infos.nudge.x = p2.x - p1.x\n            infos.verticales = [{ p1: { ...p1 }, p2 }]\n          }\n          else if (infos.nudge.x === p2.x - p1.x) {\n            infos.verticales.push({ p1: { ...p1 }, p2 })\n          }\n        }\n        if (this.snapThreshold > Math.abs(p2.y - p1.y)) {\n          if (Math.abs(infos.nudge.y) > Math.abs(p2.y - p1.y)) {\n            infos.nudge.y = p2.y - p1.y\n            infos.horizontales = [{ p1: { ...p1 }, p2 }]\n          }\n          else if (infos.nudge.y === p2.y - p1.y) {\n            infos.horizontales.push({ p1: { ...p1 }, p2 })\n          }\n        }\n      })\n    })\n\n    return infos\n  }\n\n  snapResize(point: TPoint, horizontal = true, vertical = true): TPoint\n  {\n    this.clearSnapToElementLines()\n    if (!this.configuration.symbol && !this.configuration.guide) return point\n\n    let localPoint: TPoint = {\n      x: Infinity,\n      y: Infinity\n    }\n    if (this.configuration.guide) {\n      localPoint = this.getGuidePointToSnap(point)\n    }\n    const snapLines: TSegment[] = []\n\n    if (this.configuration.symbol) {\n      const snapLinesInfos = this.getSnapLinesInfos([point], this.otherSnapPoints)\n      if (horizontal && Math.abs(snapLinesInfos.nudge.x) <= Math.abs(point.x - localPoint.x)) {\n        localPoint.x = point.x + snapLinesInfos.nudge.x\n        snapLines.push(...snapLinesInfos.verticales)\n      }\n      if (vertical && Math.abs(snapLinesInfos.nudge.y) <= Math.abs(point.y - localPoint.y)) {\n        localPoint.y = point.y + snapLinesInfos.nudge.y\n        snapLines.push(...snapLinesInfos.horizontales)\n      }\n    }\n\n    if (localPoint.x === Infinity) localPoint.x = point.x\n    if (localPoint.y === Infinity) localPoint.y = point.y\n\n    snapLines.forEach(s => s.p1 = localPoint)\n    this.drawSnapToElementLines(snapLines)\n    return localPoint\n  }\n\n  snapTranslate(tx: number, ty: number): TSnapNudge\n  {\n    this.clearSnapToElementLines()\n    const nudge: TSnapNudge = { x: tx, y: ty }\n    if (!this.configuration.symbol && !this.configuration.guide) return nudge\n\n    const selectionSymbolPoints = this.selectionSnapPoints.map(p => ({ x: p.x + tx, y: p.y + ty }))\n\n    let lastDeltaX = Infinity\n    let lastDeltaY = Infinity\n\n    if (this.configuration.guide) {\n      selectionSymbolPoints.forEach(p =>\n      {\n        const gridPoint = this.getGuidePointToSnap(p)\n        if (lastDeltaX > Math.abs(gridPoint.x - p.x)) {\n          nudge.x = gridPoint.x - p.x + tx\n          lastDeltaX = Math.abs(gridPoint.x - p.x)\n        }\n        if (lastDeltaY > Math.abs(gridPoint.y - p.y)) {\n          nudge.y = gridPoint.y - p.y + ty\n          lastDeltaY = Math.abs(gridPoint.y - p.y)\n        }\n      })\n    }\n\n    const snapLines: TSegment[] = []\n    if (this.configuration.symbol) {\n      const snapLinesInfos = this.getSnapLinesInfos(selectionSymbolPoints, this.otherSnapPoints)\n      if (lastDeltaX >= Math.abs(snapLinesInfos.nudge.x) && snapLinesInfos.verticales.length) {\n        nudge.x = snapLinesInfos.nudge.x + tx\n        snapLines.push(...snapLinesInfos.verticales)\n      }\n      if (lastDeltaY >= Math.abs(snapLinesInfos.nudge.y) && snapLinesInfos.horizontales.length) {\n        nudge.y = snapLinesInfos.nudge.y + ty\n        snapLines.push(...snapLinesInfos.horizontales)\n      }\n    }\n    if (snapLines.length) {\n      snapLines.forEach(l =>\n      {\n        l.p1.x += nudge.x - tx\n        l.p1.y += nudge.y - ty\n      })\n      this.drawSnapToElementLines(snapLines)\n    }\n    return nudge\n  }\n\n  snapRotation(angleDegree: number): number\n  {\n    if (this.configuration.angle > 0) {\n      return this.configuration.angle * Math.round(angleDegree / this.configuration.angle)\n    }\n    return angleDegree\n  }\n}\n","import { mergeDeep, PartialDeep } from \"../utils\"\nimport { DefaultStyle, TStyle } from \"../style\"\nimport { DefaultLoggerConfiguration, TLoggerConfiguration } from \"../logger\"\nimport { DefaultGrabberConfiguration, TGrabberConfiguration } from \"../grabber\"\nimport { DefaultHistoryConfiguration, THistoryConfiguration } from \"../history\"\nimport { DefaultMenuConfiguration, TMenuConfiguration } from \"../menu\"\nimport { DefaultRecognizerWebSocketConfiguration, RecognizerWebSocketConfiguration, TRecognitionWebSocketConfiguration, TRecognizerWebSocketConfiguration, TServerWebsocketConfiguration } from \"../recognizer\"\nimport { DefaultIIRendererConfiguration, TIIRendererConfiguration } from \"../renderer\"\nimport { DefaultGestureConfiguration, TGestureConfiguration } from \"../gesture\"\nimport { TEditorConfiguration } from \"./AbstractEditor\"\nimport { DefaultSnapConfiguration, SnapConfiguration, TSnapConfiguration } from \"../snap\"\n\n/**\n * @group Editor\n */\nexport type TInteractiveInkEditorConfiguration = TEditorConfiguration & TRecognizerWebSocketConfiguration & {\n \"undo-redo\": THistoryConfiguration\n  rendering: TIIRendererConfiguration\n  grabber: TGrabberConfiguration\n  menu: TMenuConfiguration\n  penStyle: TStyle,\n  fontStyle: {\n    size: number | \"auto\"\n    weight: \"bold\" | \"normal\" | \"auto\"\n  }\n  gesture: TGestureConfiguration\n  snap: TSnapConfiguration\n}\n\n/**\n * @group Editor\n * @source\n */\nexport const DefaultInteractiveInkEditorConfiguration: TInteractiveInkEditorConfiguration = {\n  server: DefaultRecognizerWebSocketConfiguration.server,\n  recognition: DefaultRecognizerWebSocketConfiguration.recognition,\n  menu: DefaultMenuConfiguration,\n  rendering: DefaultIIRendererConfiguration,\n  logger: DefaultLoggerConfiguration,\n  grabber: DefaultGrabberConfiguration,\n  \"undo-redo\": DefaultHistoryConfiguration,\n\n  penStyle: DefaultStyle,\n  fontStyle: {\n    size: \"auto\",\n    weight: \"auto\",\n  },\n  gesture: DefaultGestureConfiguration,\n  snap: DefaultSnapConfiguration\n}\n\n/**\n * @group Editor\n */\nexport class InteractiveInkEditorConfiguration implements TInteractiveInkEditorConfiguration\n{\n  grabber: TGrabberConfiguration\n  logger: TLoggerConfiguration\n  server: TServerWebsocketConfiguration\n  recognition: TRecognitionWebSocketConfiguration\n  rendering: TIIRendererConfiguration\n  \"undo-redo\": THistoryConfiguration\n  menu: TMenuConfiguration\n\n  penStyle: TStyle\n  fontStyle: {\n    size: number | \"auto\"\n    weight: \"bold\" | \"normal\" | \"auto\"\n  }\n  gesture: TGestureConfiguration\n  snap: TSnapConfiguration\n\n  constructor(configuration?: PartialDeep<TInteractiveInkEditorConfiguration>)\n  {\n    const { server, recognition } =  new RecognizerWebSocketConfiguration(configuration)\n    this.recognition = recognition\n    this.server = server\n\n    this.grabber = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.grabber, configuration?.grabber)\n    this.logger = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.logger, configuration?.logger)\n    this.rendering = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.rendering, configuration?.rendering)\n    this[\"undo-redo\"] = mergeDeep({}, DefaultInteractiveInkEditorConfiguration[\"undo-redo\"], configuration?.[\"undo-redo\"])\n    this.menu = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.menu, configuration?.menu)\n    this.gesture = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.gesture, configuration?.gesture)\n    this.snap = new SnapConfiguration(configuration?.snap)\n\n    this.penStyle = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.penStyle, configuration?.penStyle)\n    this.fontStyle = mergeDeep({}, DefaultInteractiveInkEditorConfiguration.fontStyle, configuration?.fontStyle)\n  }\n}\n","import { EditorTool, SELECTION_MARGIN } from \"../Constants\"\nimport { JIIXEdgeKind, JIIXELementType, JIIXNodeKind, IIModel, TExport, TJIIXStrokeItem } from \"../model\"\nimport\n{\n  Box,\n  EdgeKind,\n  IIDecorator,\n  TIIEdge,\n  IIEdgeArc,\n  IIEdgeLine,\n  IIEdgePolyLine,\n  TIIShape,\n  IIShapeCircle,\n  IIShapeEllipse,\n  IIShapePolygon,\n  IIStroke,\n  IIRecognizedText,\n  IISymbolGroup,\n  IIText,\n  ShapeKind,\n  SymbolType,\n  TIISymbol,\n  convertPartialStrokesToOIStrokes,\n  TIIRecognized,\n  IIRecognizedLine,\n  IIRecognizedPolyLine,\n  IIRecognizedArc,\n} from \"../symbol\"\nimport { RecognizerWebSocket } from \"../recognizer\"\nimport { SVGRenderer, SVGBuilder, TIIRendererConfiguration } from \"../renderer\"\nimport { TStyle } from \"../style\"\nimport\n{\n  IIConversionManager,\n  IIWriterManager,\n  IISelectionManager,\n  IIResizeManager,\n  IIRotationManager,\n  IITranslateManager,\n  IITextManager,\n  EraseManager,\n  IIDebugSVGManager,\n  IIMoveManager,\n} from \"../manager\"\nimport { RecognizedKind, IIRecognizedCircle, IIRecognizedEllipse, IIRecognizedPolygon } from \"../symbol\"\nimport { IIHistoryManager, TIIHistoryBackendChanges, TIIHistoryChanges, THistoryContext } from \"../history\"\nimport { PartialDeep, convertMillimeterToPixel, mergeDeep } from \"../utils\"\nimport { IIMenuAction, IIMenuManager, IIMenuStyle, IIMenuTool } from \"../menu\"\nimport { AbstractEditor, EditorOptionsBase } from \"./AbstractEditor\"\nimport { InteractiveInkEditorConfiguration, TInteractiveInkEditorConfiguration } from \"./InteractiveInkEditorConfiguration\"\nimport { IIGestureManager } from \"../gesture\"\nimport { IISnapManager } from \"../snap\"\n\n/**\n * @group Editor\n */\nexport type TInteractiveInkEditorOptions = PartialDeep<EditorOptionsBase &\n  {\n    configuration: TInteractiveInkEditorConfiguration\n  }> &\n  {\n    override?: {\n      recognizer?: RecognizerWebSocket\n      menu?: {\n        style?: IIMenuStyle\n        tool?: IIMenuTool\n        action?: IIMenuAction\n      }\n    }\n  }\n/**\n * @group Editor\n */\nexport class InteractiveInkEditor extends AbstractEditor\n{\n  #configuration: InteractiveInkEditorConfiguration\n  #model: IIModel\n  #tool: EditorTool = EditorTool.Write\n  #layerUITimer?: ReturnType<typeof setTimeout>\n  #recognizeStrokeTimer?: ReturnType<typeof setTimeout>\n\n  renderer: SVGRenderer\n  recognizer: RecognizerWebSocket\n\n  #penStyle: TStyle\n\n  history: IIHistoryManager\n  writer: IIWriterManager\n  eraser: EraseManager\n  gesture: IIGestureManager\n  resizer: IIResizeManager\n  rotator: IIRotationManager\n  translator: IITranslateManager\n  converter: IIConversionManager\n  texter: IITextManager\n  selector: IISelectionManager\n  svgDebugger: IIDebugSVGManager\n  snaps: IISnapManager\n  move: IIMoveManager\n  menu: IIMenuManager\n\n  constructor(rootElement: HTMLElement, options?: TInteractiveInkEditorOptions)\n  {\n    super(rootElement, options)\n\n    this.#configuration = new InteractiveInkEditorConfiguration(options?.configuration)\n    this.#penStyle = Object.assign({}, this.#configuration.penStyle)\n\n    if (options?.override?.recognizer) {\n      const CustomRecognizer = options?.override.recognizer as unknown as typeof RecognizerWebSocket\n      this.recognizer = new CustomRecognizer(this.#configuration)\n    }\n    else {\n      this.recognizer = new RecognizerWebSocket(this.#configuration)\n    }\n    this.recognizer.event.addErrorListener(this.manageError.bind(this))\n    this.recognizer.event.addExportedListener(this.event.emitExported.bind(this.event))\n    this.recognizer.event.addContentChangedListener(this.onContentChanged.bind(this))\n    this.recognizer.event.addSessionOpenedListener(this.event.emitSessionOpened.bind(this.event))\n    this.recognizer.event.addEndInitialization(this.layers.hideMessageModal.bind(this.layers))\n    this.recognizer.event.addIdleListener(this.updateLayerState.bind(this))\n\n    this.renderer = new SVGRenderer(this.#configuration.rendering)\n\n    this.history = new IIHistoryManager(this.#configuration[\"undo-redo\"], this.event)\n\n    this.writer = new IIWriterManager(this)\n    this.eraser = new EraseManager(this)\n    this.selector = new IISelectionManager(this)\n    this.move = new IIMoveManager(this)\n\n    this.gesture = new IIGestureManager(this, this.#configuration.gesture)\n    this.resizer = new IIResizeManager(this)\n    this.rotator = new IIRotationManager(this)\n    this.translator = new IITranslateManager(this)\n    this.converter = new IIConversionManager(this)\n    this.texter = new IITextManager(this)\n    this.svgDebugger = new IIDebugSVGManager(this)\n    this.snaps = new IISnapManager(this, this.#configuration.snap)\n    this.menu = new IIMenuManager(this, options?.override?.menu)\n\n    this.#model = new IIModel(this.#configuration.rendering.minWidth, this.#configuration.rendering.minHeight, this.configuration.rendering.guides.gap)\n  }\n\n  get initializationPromise(): Promise<void>\n  {\n    return this.recognizer.initialized.promise\n  }\n\n  get tool(): EditorTool\n  {\n    return this.#tool\n  }\n  set tool(i: EditorTool)\n  {\n    this.#tool = i\n    this.menu.tool.update()\n    this.setCursorStyle()\n    this.unselectAll()\n\n    this.eraser.detach()\n    this.selector.detach()\n    this.move.detach()\n    this.writer.detach()\n    switch (this.#tool) {\n      case EditorTool.Erase:\n        this.eraser.attach(this.layers.rendering)\n        break\n      case EditorTool.Select:\n        this.selector.attach(this.layers.rendering)\n        break\n      case EditorTool.Move:\n        this.move.attach(this.layers.rendering)\n        break\n      default:\n        this.writer.attach(this.layers.rendering)\n        break\n    }\n    this.event.emitToolChanged(i)\n  }\n\n  get model(): IIModel\n  {\n    return this.#model\n  }\n\n  get configuration(): InteractiveInkEditorConfiguration\n  {\n    return this.#configuration\n  }\n  set renderingConfiguration(renderingConfiguration: TIIRendererConfiguration)\n  {\n    this.configuration.rendering = mergeDeep(this.configuration.rendering, renderingConfiguration)\n    const height = Math.max(this.renderer.parent.clientHeight, this.configuration.rendering.minHeight)\n    const width = Math.max(this.renderer.parent.clientWidth, this.configuration.rendering.minWidth)\n    this.renderer.resize(height, width)\n    this.model.rowHeight = this.configuration.rendering.guides.gap\n    this.history.stack.forEach(i => i.model.rowHeight = this.model.rowHeight)\n    this.event.emitUIpdated()\n  }\n\n  get penStyle(): TStyle\n  {\n    return this.#penStyle\n  }\n  set penStyle(penStyle: PartialDeep<TStyle>)\n  {\n    this.logger.info(\"set penStyle\", { penStyle })\n    this.#penStyle = Object.assign({}, this.#penStyle, penStyle)\n  }\n\n  protected updateLayerState(idle: boolean): void\n  {\n    this.event.emitIdle(idle)\n    this.layers.updateState(idle)\n  }\n\n  updateLayerUI(timeout: number = 500): void\n  {\n    clearTimeout(this.#layerUITimer)\n    this.#layerUITimer = setTimeout(() =>\n    {\n      this.menu.update()\n      this.svgDebugger.apply()\n      this.waitForIdle()\n      this.event.emitUIpdated()\n    }, timeout)\n  }\n\n  manageError(error: Error): void\n  {\n    this.layers.showMessageError(error)\n    this.event.emitError(error)\n  }\n\n  protected setCursorStyle(): void\n  {\n    switch (this.#tool) {\n      case EditorTool.Erase:\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.add(\"erase\")\n        this.layers.root.classList.remove(\"select\")\n        this.layers.root.classList.remove(\"move\")\n        break\n      case EditorTool.Select:\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        this.layers.root.classList.add(\"select\")\n        this.layers.root.classList.remove(\"move\")\n        break\n      case EditorTool.Move:\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        this.layers.root.classList.remove(\"select\")\n        this.layers.root.classList.add(\"move\")\n        break\n      default:\n        this.layers.root.classList.add(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        this.layers.root.classList.remove(\"select\")\n        this.layers.root.classList.remove(\"move\")\n        break\n    }\n  }\n\n  protected async onContentChanged(undoRedoContext: THistoryContext): Promise<void>\n  {\n    clearTimeout(this.#recognizeStrokeTimer)\n    this.#recognizeStrokeTimer = setTimeout(async () =>\n    {\n      await this.synchronizeStrokesWithJIIX()\n      this.updateLayerUI(0)\n      this.event.emitChanged(undoRedoContext)\n    }, 500)\n  }\n\n  async initialize(): Promise<void>\n  {\n    try {\n      this.logger.info(\"initialize\")\n      this.layers.render()\n      this.layers.showLoader()\n      this.tool = EditorTool.Write\n      this.renderer.init(this.layers.rendering)\n      this.menu.render(this.layers.ui.root)\n\n      const compStyles = window.getComputedStyle(this.layers.root)\n      this.model.width = Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.#configuration.rendering.minWidth)\n      this.model.height = Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.#configuration.rendering.minHeight)\n      this.model.rowHeight = this.configuration.rendering.guides.gap\n      this.history.init(this.model)\n\n      if(!this.recognizer.configuration.server.version) {\n        await this.loadInfo(this.configuration.server)\n        this.recognizer.configuration.server.version = this.info!.version\n      }\n      await this.recognizer.init()\n    } catch (error) {\n      this.logger.error(\"initialize\", error)\n      this.layers.showMessageError(error as Error)\n      throw error\n    }\n    finally {\n      this.logger.debug(\"initialize\", \"finally\")\n      this.layers.hideLoader()\n      this.layers.updateState(true)\n    }\n  }\n\n  async changeLanguage(code: string): Promise<void>\n  {\n    try {\n      this.logger.info(\"changeLanguage\", { code })\n      this.updateLayerState(false)\n      this.configuration.recognition.lang = code\n      await this.recognizer.newSession(this.configuration)\n      this.recognizer.addStrokes(this.extractStrokesFromSymbols(this.model.symbols), false)\n      await this.synchronizeStrokesWithJIIX(true)\n      this.layers.hideLoader()\n      this.event.emitLoaded()\n    }\n    catch (error) {\n      this.logger.error(\"changeLanguage\", error)\n      this.manageError(error as Error)\n      throw error\n    }\n    finally {\n      this.updateLayerUI()\n    }\n  }\n\n  protected buildShape(partialShape: PartialDeep<TIIShape>): TIIShape\n  {\n    switch (partialShape.kind) {\n      case ShapeKind.Circle:\n        return IIShapeCircle.create(partialShape as PartialDeep<IIShapeCircle>)\n      case ShapeKind.Ellipse:\n        return IIShapeEllipse.create(partialShape as PartialDeep<IIShapeEllipse>)\n      case ShapeKind.Polygon:\n        return IIShapePolygon.create(partialShape as PartialDeep<IIShapePolygon>)\n      default:\n        throw new Error(`Unable to create shape, kind: \"${ partialShape.kind }\" is unknown`)\n    }\n  }\n\n  protected buildEdge(partialEdge: PartialDeep<TIIEdge>): TIIEdge\n  {\n    switch (partialEdge.kind) {\n      case EdgeKind.Arc:\n        return IIEdgeArc.create(partialEdge as PartialDeep<IIEdgeArc>)\n      case EdgeKind.Line:\n        return IIEdgeLine.create(partialEdge as PartialDeep<IIEdgeLine>)\n      case EdgeKind.PolyEdge:\n        return IIEdgePolyLine.create(partialEdge as PartialDeep<IIEdgePolyLine>)\n      default:\n        throw new Error(`Unable to create edge, kind: \"${ partialEdge.kind }\" is unknown`)\n    }\n  }\n\n  protected buildRecognized(partialSymbol: PartialDeep<TIIRecognized>): TIIRecognized\n  {\n    switch (partialSymbol.kind) {\n      case RecognizedKind.Text:\n        return IIRecognizedText.create(partialSymbol)\n      case RecognizedKind.Arc:\n        return IIRecognizedArc.create(partialSymbol)\n      case RecognizedKind.Circle:\n        return IIRecognizedCircle.create(partialSymbol)\n      case RecognizedKind.Ellipse:\n        return IIRecognizedEllipse.create(partialSymbol)\n      case RecognizedKind.Polygone:\n        return IIRecognizedPolygon.create(partialSymbol)\n      case RecognizedKind.Line:\n        return IIRecognizedLine.create(partialSymbol)\n      case RecognizedKind.PolyEdge:\n        return IIRecognizedPolyLine.create(partialSymbol)\n      default:\n        throw new Error(`Unable to create recognized, symbol type '${ JSON.stringify(partialSymbol) } is unknow`)\n    }\n  }\n\n  protected buildGroup(partialGroup: PartialDeep<IISymbolGroup>): IISymbolGroup\n  {\n    if (!partialGroup.children?.length) {\n      throw new Error(`Unable to create group, no children`)\n    }\n\n    const children = partialGroup.children.map(partialSymbol =>\n    {\n      switch (partialSymbol?.type) {\n        case SymbolType.Stroke:\n          return IIStroke.create(partialSymbol as PartialDeep<IIStroke>)\n        case SymbolType.Shape:\n          return this.buildShape(partialSymbol as PartialDeep<TIIShape>)\n        case SymbolType.Edge:\n          return this.buildEdge(partialSymbol as PartialDeep<TIIEdge>)\n        case SymbolType.Text:\n          return IIText.create(partialSymbol as PartialDeep<IIText>)\n        case SymbolType.Group:\n          return this.buildGroup(partialSymbol as PartialDeep<IISymbolGroup>)\n        case SymbolType.Recognized:\n          return this.buildRecognized(partialSymbol as PartialDeep<TIIRecognized>)\n        default:\n          throw new Error(`Unable to create group, symbol type '${ JSON.stringify(partialSymbol) } is unknow`)\n      }\n    })\n    const group = new IISymbolGroup(children, partialGroup.style)\n    if (partialGroup.id) {\n      group.id = partialGroup.id\n    }\n    if (partialGroup.decorators) {\n      group.decorators = partialGroup.decorators.map(d => new IIDecorator(d!.kind!, d!.style as TStyle))\n    }\n    return group\n  }\n\n  protected buildStroke(partialSymbol: PartialDeep<IIStroke>): IIStroke\n  {\n    return IIStroke.create(partialSymbol as PartialDeep<IIStroke>)\n  }\n\n  protected buildStrokeText(partialSymbol: PartialDeep<IIRecognizedText>): IIRecognizedText\n  {\n    return IIRecognizedText.create(partialSymbol as PartialDeep<IIRecognizedText>)\n  }\n\n  protected buildText(partialSymbol: PartialDeep<IIText>): IIText\n  {\n    return IIText.create(partialSymbol as PartialDeep<IIText>)\n  }\n\n  protected buildSymbol(partialSymbol: PartialDeep<TIISymbol>): TIISymbol\n  {\n    try {\n      switch (partialSymbol.type) {\n        case SymbolType.Stroke:\n          return this.buildStroke(partialSymbol)\n        case SymbolType.Shape:\n          return this.buildShape(partialSymbol)\n        case SymbolType.Edge:\n          return this.buildEdge(partialSymbol)\n        case SymbolType.Text:\n          return this.buildText(partialSymbol)\n        case SymbolType.Group:\n          return this.buildGroup(partialSymbol)\n        case SymbolType.Recognized:\n          return this.buildRecognized(partialSymbol as PartialDeep<TIIRecognized>)\n        default:\n          throw new Error(`Unable to build symbol, type: \"${ partialSymbol.type }\" is unknown`)\n      }\n    }\n    catch (error) {\n      this.logger.error(\"createSymbol\", error)\n      this.manageError(error as Error)\n      throw error\n    }\n  }\n\n  async createSymbol(partialSymbol: PartialDeep<TIISymbol>): Promise<TIISymbol>\n  {\n    try {\n      return await this.addSymbol(this.buildSymbol(partialSymbol))\n    }\n    catch (error) {\n      this.logger.error(\"createSymbol\", error)\n      this.manageError(error as Error)\n      throw error\n    }\n    finally {\n      this.updateLayerUI()\n    }\n  }\n\n  async createSymbols(partialSymbols: PartialDeep<TIISymbol>[]): Promise<TIISymbol[]>\n  {\n    try {\n      const errors: string[] = []\n      const symbols: TIISymbol[] = []\n      partialSymbols.forEach(partialSymbol =>\n      {\n        try {\n          symbols.push(this.buildSymbol(partialSymbol))\n        } catch (error) {\n          errors.push(((error as Error).message || error) as string)\n        }\n      })\n      if (errors.length) {\n        throw new Error(errors.join(\"\\n\"))\n      }\n      return await this.addSymbols(symbols)\n    } catch (error) {\n      this.logger.error(\"createSymbols\", error)\n      this.manageError(error as Error)\n      throw error\n    }\n  }\n\n  /** @hidden */\n  protected updateTextBounds(symbol: TIISymbol): void\n  {\n    if (symbol.type === SymbolType.Text) {\n      this.texter.updateBounds(symbol)\n    }\n    else if (symbol.type === SymbolType.Group) {\n      symbol.extractText().forEach(t => this.texter.updateBounds(t))\n    }\n  }\n\n  /** @hidden */\n  async addSymbol(sym: TIISymbol, addToHistory = true): Promise<TIISymbol>\n  {\n    this.logger.info(\"addSymbol\", { sym })\n    this.updateLayerState(false)\n    this.updateTextBounds(sym)\n    this.model.addSymbol(sym)\n    this.renderer.drawSymbol(sym)\n\n    const strokes = this.extractStrokesFromSymbols([sym])\n    this.recognizer.addStrokes(strokes, false)\n\n    if (addToHistory) {\n      this.history.push(this.model, { added: [sym] })\n    }\n    this.updateLayerUI()\n    return sym\n  }\n\n  /** @hidden */\n  async addSymbols(symList: TIISymbol[], addToHistory = true): Promise<TIISymbol[]>\n  {\n    this.logger.info(\"addSymbol\", { symList })\n    this.updateLayerState(false)\n    symList.forEach(s =>\n    {\n      this.updateTextBounds(s)\n      this.model.addSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n    const strokes = this.extractStrokesFromSymbols(symList)\n    this.recognizer.addStrokes(strokes, false)\n    if (addToHistory) {\n      this.history.push(this.model, { added: symList })\n    }\n    this.updateLayerUI()\n    return symList\n  }\n\n  async updateSymbol(sym: TIISymbol, addToHistory = true): Promise<TIISymbol>\n  {\n    this.logger.info(\"updateSymbol\", { sym })\n    this.updateLayerState(false)\n    this.updateTextBounds(sym)\n    this.model.updateSymbol(sym)\n    this.renderer.drawSymbol(sym)\n    const strokes = this.extractStrokesFromSymbols([sym])\n    this.recognizer.replaceStrokes(strokes.map(s => s.id), strokes)\n    if (addToHistory) {\n      this.history.push(this.model, { updated: [sym] })\n    }\n    this.updateLayerUI()\n    return sym\n  }\n\n  async updateSymbols(symList: TIISymbol[], addToHistory = true): Promise<TIISymbol[]>\n  {\n    this.logger.info(\"updateSymbol\", { symList })\n    this.updateLayerState(false)\n    symList.forEach(s =>\n    {\n      this.updateTextBounds(s)\n      this.model.updateSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n    const strokes = this.extractStrokesFromSymbols(symList)\n    this.recognizer.replaceStrokes(strokes.map(s => s.id), strokes)\n    if (addToHistory) {\n      this.history.push(this.model, { updated: symList })\n    }\n    this.updateLayerUI()\n    return symList\n  }\n\n  updateSymbolsStyle(symbolIds: string[], style: PartialDeep<TStyle>, addToHistory = true): void\n  {\n    this.logger.info(\"updateSymbolsStyle\", { symbolIds, style })\n    const symbols: TIISymbol[] = []\n    this.model.symbols.forEach(s =>\n    {\n      if (symbolIds.includes(s.id)) {\n        s.style = Object.assign({}, s.style, style)\n        if (\n          SymbolType.Text === s.type ||\n          SymbolType.Group === s.type ||\n          SymbolType.Recognized === s.type) {\n          s.updateChildrenStyle()\n        }\n        this.renderer.drawSymbol(s)\n        this.model.updateSymbol(s)\n        s.modificationDate = Date.now()\n        symbols.push(s)\n      }\n    })\n    if (symbols.length) {\n      symbols.forEach(s =>\n      {\n        if (s.type === SymbolType.Text) {\n          const lastWidth = s.bounds.width\n          this.texter.updateBounds(s)\n          const tx = s.bounds.width - lastWidth\n          if (tx !== 0) {\n            this.texter.moveTextAfter(s, tx)\n          }\n        }\n      })\n    }\n    if (addToHistory && symbols.length) {\n      this.history.push(this.model, { style: { symbols, style } })\n    }\n  }\n\n  updateTextFontStyle(textIds: string[], { fontSize, fontWeight }: { fontSize?: number, fontWeight?: \"normal\" | \"bold\" | \"auto\" }): void\n  {\n    this.logger.info(\"updateTextFontStyle\", { textIds, fontSize, fontWeight })\n    const symbols: (IIText | IISymbolGroup)[] = []\n    const translate: { symbols: TIISymbol[], tx: number, ty: number }[] = []\n    this.model.symbols.forEach(s =>\n    {\n      if (textIds.includes(s.id)) {\n        if (s.type === SymbolType.Text) {\n          s.updateChildrenFont({ fontSize, fontWeight: fontWeight === \"auto\" ? undefined : fontWeight })\n          const lastWidth = s.bounds.width\n          this.texter.updateBounds(s)\n          this.renderer.drawSymbol(s)\n          const tx = s.bounds.width - lastWidth\n          if (tx !== 0) {\n            const symbolsTranslated = this.texter.moveTextAfter(s, tx)\n            if (symbolsTranslated?.length) {\n              translate.push({\n                symbols: symbolsTranslated,\n                tx,\n                ty: 0\n              })\n            }\n          }\n          s.modificationDate = Date.now()\n          symbols.push(s)\n        }\n        else if (s.type === SymbolType.Group) {\n          const textChildren = s.extractText()\n          if (textChildren.length) {\n            textChildren.forEach(text =>\n            {\n              text.updateChildrenFont({ fontSize, fontWeight: fontWeight === \"auto\" ? undefined : fontWeight })\n              const lastWidth = s.bounds.width\n              this.texter.updateBounds(text)\n              const tx = s.bounds.width - lastWidth\n              const symbolsTranslated = this.texter.moveTextAfter(text, tx)\n              if (symbolsTranslated?.length) {\n                translate.push({\n                  symbols: symbolsTranslated,\n                  tx,\n                  ty: 0\n                })\n              }\n            })\n            s.modificationDate = Date.now()\n            this.renderer.drawSymbol(s)\n            symbols.push(s)\n          }\n\n        }\n      }\n    })\n    if (symbols.length) {\n      this.history.push(this.model, { style: { symbols, fontSize }, translate })\n    }\n  }\n\n  async replaceSymbols(oldSymbols: TIISymbol[], newSymbols: TIISymbol[], addToHistory = true): Promise<void>\n  {\n    this.logger.info(\"replaceSymbol\", { oldSymbols, newSymbols })\n    this.updateLayerState(false)\n\n    const oldStrokes = this.extractStrokesFromSymbols(oldSymbols)\n    const newStrokes = this.extractStrokesFromSymbols(newSymbols)\n\n    const symToReplace = oldSymbols.shift()\n\n    if (symToReplace) {\n      oldSymbols.forEach(s =>\n      {\n        this.renderer.removeSymbol(s.id)\n        this.model.removeSymbol(s.id)\n      })\n\n      this.model.replaceSymbol(symToReplace.id, newSymbols)\n      this.renderer.replaceSymbol(symToReplace.id, newSymbols)\n\n\n      if (oldStrokes.length && newStrokes.length) {\n        this.recognizer.replaceStrokes(oldStrokes.map(s => s.id), newStrokes)\n      }\n      else if (oldStrokes.length) {\n        this.recognizer.eraseStrokes(oldStrokes.map(s => s.id))\n      }\n      else {\n        this.recognizer.addStrokes(newStrokes, false)\n      }\n\n      if (addToHistory) {\n        this.history.push(this.model, { replaced: { oldSymbols, newSymbols } })\n      }\n      this.updateLayerUI()\n    }\n  }\n\n  changeOrderSymbol(symbol: TIISymbol, position: \"first\" | \"last\" | \"forward\" | \"backward\"): void\n  {\n    this.model.changeOrderSymbol(symbol.id, position)\n    this.renderer.changeOrderSymbol(symbol, position)\n    this.history.push(this.model, { order: { symbols: [symbol], position } })\n  }\n\n  changeOrderSymbols(symbols: TIISymbol[], position: \"first\" | \"last\" | \"forward\" | \"backward\")\n  {\n    symbols.forEach(s =>\n    {\n      this.model.changeOrderSymbol(s.id, position)\n      this.renderer.changeOrderSymbol(s, position)\n    })\n    this.history.push(this.model, { order: { symbols, position } })\n  }\n\n  groupSymbols(symbols: TIISymbol[]): IISymbolGroup\n  {\n    const group = this.buildGroup({ children: symbols })\n    symbols.forEach(s =>\n    {\n      this.model.removeSymbol(s.id)\n      this.renderer.removeSymbol(s.id)\n    })\n    this.model.addSymbol(group)\n    this.history.push(this.model, { group: { symbols } })\n    return group\n  }\n\n  ungroupSymbol(group: IISymbolGroup): TIISymbol[]\n  {\n    group.children.forEach(s => this.renderer.drawSymbol(s))\n    this.renderer.removeSymbol(group.id)\n    this.model.replaceSymbol(group.id, group.children)\n    this.history.push(this.model, { ungroup: { group } })\n    return group.children\n  }\n\n  async synchronizeStrokesWithJIIX(force: boolean = false): Promise<void>\n  {\n    const strokes = this.model.symbols.filter(s => s.type === SymbolType.Stroke)\n    if (!force && !strokes.length) {\n      this.event.emitSynchronized()\n      return\n    }\n    await this.export([\"application/vnd.myscript.jiix\"])\n\n    const getSymbolsAndStrokesAssociatedFromJIIXStrokeItems = (items: TJIIXStrokeItem[] = []): { symbols: TIISymbol[], strokes: IIStroke[] } =>\n    {\n      const symbols: TIISymbol[] = []\n      const strokes: IIStroke[] = []\n      const strokeIdsUsed: string[] = []\n      items.forEach(i =>\n      {\n        const strokeId = i[\"full-id\"]!\n        if (strokeIdsUsed.includes(strokeId)) {\n          return\n        }\n        strokeIdsUsed.push(strokeId)\n        const sym = this.model.getRootSymbol(strokeId)\n        if (sym) {\n          switch (sym?.type) {\n            case SymbolType.Recognized:\n              strokes.push(sym.strokes.find(s => s.id === i[\"full-id\"]!)!)\n              break\n            default:\n              strokes.push(sym as IIStroke)\n              break\n          }\n          const symIdx = symbols.findIndex(s => s.id === sym.id)\n          if (symIdx < 0) {\n            symbols.push(sym)\n          }\n          else {\n            symbols[symIdx] = sym\n          }\n        }\n      })\n      return {\n        symbols,\n        strokes\n      }\n    }\n\n    const jiix = this.model.exports?.[\"application/vnd.myscript.jiix\"]\n    jiix?.elements?.forEach(el =>\n    {\n      switch (el.type) {\n        case JIIXELementType.Text: {\n          el.words?.forEach(w =>\n          {\n            const jiixAssociation = getSymbolsAndStrokesAssociatedFromJIIXStrokeItems(w.items)\n            if (jiixAssociation.strokes.length) {\n              if (jiixAssociation.symbols.length === 1) {\n                const symAsso = jiixAssociation.symbols[0]\n                if (\n                  symAsso.type === SymbolType.Recognized && symAsso.kind === RecognizedKind.Text &&\n                  symAsso.label === w.label &&\n                  symAsso.strokes.length === symAsso.strokes.length\n                ) {\n                  return\n                }\n              }\n              const line = el.lines!.find(l => l[\"first-char\"]! <= w[\"first-char\"]! && l[\"last-char\"]! >= w[\"last-char\"]!)!\n              const recognizedText = new IIRecognizedText(jiixAssociation.strokes, { baseline: convertMillimeterToPixel(line[\"baseline-y\"]), xHeight: convertMillimeterToPixel(line[\"x-height\"]) })\n              recognizedText.label = w.label\n              jiixAssociation.symbols.forEach(sym =>\n              {\n                if (sym.type === SymbolType.Recognized && sym.kind === RecognizedKind.Text) {\n                  sym.decorators.forEach(d =>\n                  {\n                    if (!recognizedText.decorators.some(wd => wd.kind === d.kind)) {\n                      recognizedText.decorators.push(d)\n                    }\n                  })\n                }\n                this.model.removeSymbol(sym.id)\n                this.renderer.removeSymbol(sym.id)\n              })\n              this.model.addSymbol(recognizedText)\n              this.renderer.drawSymbol(recognizedText)\n            }\n          })\n          break\n        }\n        case JIIXELementType.Node: {\n          let symbolRecognized: TIIRecognized | undefined\n          const jiixAssociation = getSymbolsAndStrokesAssociatedFromJIIXStrokeItems(el.items)\n          if (jiixAssociation.strokes.length) {\n            if (jiixAssociation.symbols.length === 1) {\n              const symAsso = jiixAssociation.symbols[0]\n              if (symAsso.type === SymbolType.Recognized &&\n                symAsso.strokes.length === jiixAssociation.strokes.length) {\n                return\n              }\n            }\n            switch (el.kind) {\n              case JIIXNodeKind.Circle: {\n                symbolRecognized = new IIRecognizedCircle(jiixAssociation.strokes)\n                break\n              }\n              case JIIXNodeKind.Ellipse: {\n                symbolRecognized = new IIRecognizedEllipse(jiixAssociation.strokes)\n                break\n              }\n              case JIIXNodeKind.Rectangle:\n              case JIIXNodeKind.Triangle:\n              case JIIXNodeKind.Parallelogram:\n              case JIIXNodeKind.Polygon:\n              case JIIXNodeKind.Rhombus: {\n                symbolRecognized = new IIRecognizedPolygon(jiixAssociation.strokes)\n                break\n              }\n              default:\n                this.logger.warn(\"synchronizeStrokesWithJIIX\", `Can not create recognized shape symbol, kind unknow: ${ el }`)\n                break\n            }\n            if (symbolRecognized) {\n              jiixAssociation.symbols.forEach(sym =>\n              {\n                this.model.removeSymbol(sym.id)\n                this.renderer.removeSymbol(sym.id)\n              })\n              this.model.addSymbol(symbolRecognized)\n              this.renderer.drawSymbol(symbolRecognized)\n            }\n          }\n          break\n        }\n        case JIIXELementType.Edge: {\n          let symbolRecognized: TIIRecognized | undefined\n          const jiixAssociation = getSymbolsAndStrokesAssociatedFromJIIXStrokeItems(el.kind === JIIXEdgeKind.PolyEdge ? el.edges.flatMap(e => e.items!) : el.items)\n          if (jiixAssociation.strokes.length) {\n            if (jiixAssociation.symbols.length === 1) {\n              const symAsso = jiixAssociation.symbols[0]\n              if (symAsso.type === SymbolType.Recognized &&\n                symAsso.strokes.length === jiixAssociation.strokes.length) {\n                return\n              }\n            }\n            switch (el.kind) {\n              case JIIXEdgeKind.Line: {\n                symbolRecognized = new IIRecognizedLine(jiixAssociation.strokes)\n                break\n              }\n              case JIIXEdgeKind.PolyEdge: {\n                symbolRecognized = new IIRecognizedPolyLine(jiixAssociation.strokes)\n                break\n              }\n              case JIIXEdgeKind.Arc: {\n                symbolRecognized = new IIRecognizedArc(jiixAssociation.strokes)\n                break\n              }\n              default:\n                this.logger.warn(\"synchronizeStrokesWithJIIX\", `Can not create recognized edge symbol, kind unknow: ${ el }`)\n                break\n            }\n            if (symbolRecognized) {\n              jiixAssociation.symbols.forEach(sym =>\n              {\n                this.model.removeSymbol(sym.id)\n                this.renderer.removeSymbol(sym.id)\n              })\n              this.model.addSymbol(symbolRecognized)\n              this.renderer.drawSymbol(symbolRecognized)\n            }\n          }\n          break\n        }\n        default:\n          this.logger.warn(\"synchronizeStrokesWithJIIX\", `Can not create recognized symbol, type unknow: ${ el }`)\n          break\n      }\n    })\n\n    this.model.mergeExport({ \"application/vnd.myscript.jiix\": jiix })\n    this.history.update(this.model)\n    this.event.emitSynchronized()\n  }\n\n  async removeSymbol(id: string, addToHistory = true): Promise<void>\n  {\n    this.logger.info(\"removeSymbol\", { id })\n    const symbol = this.model.getRootSymbol(id)\n    if (symbol) {\n      this.updateLayerState(false)\n      if (symbol.type === SymbolType.Group) {\n        const groupStrokeIds = symbol.extractStrokes().map(s => s.id)\n        symbol.removeChilds([id])\n        if (symbol.children.length) {\n          this.model.updateSymbol(symbol)\n          this.renderer.drawSymbol(symbol)\n          if (groupStrokeIds.includes(id)) {\n            this.recognizer.eraseStrokes([id])\n          }\n        }\n        else {\n          this.recognizer.eraseStrokes(groupStrokeIds)\n          this.model.removeSymbol(symbol.id)\n          this.renderer.removeSymbol(symbol.id)\n        }\n      }\n      else {\n        this.recognizer.eraseStrokes([id])\n        this.model.removeSymbol(symbol.id)\n        this.renderer.removeSymbol(symbol.id)\n      }\n      if (addToHistory) {\n        this.history.push(this.model, { erased: [symbol] })\n      }\n      this.updateLayerUI()\n    }\n    else {\n      this.renderer.removeSymbol(id)\n      this.recognizer.eraseStrokes([id])\n    }\n  }\n\n  async removeSymbols(ids: string[], addToHistory = true): Promise<TIISymbol[]>\n  {\n    this.logger.info(\"removeSymbol\", { ids })\n    const symbolsToRemove: TIISymbol[] = []\n    const symbolsToUpdate: TIISymbol[] = []\n    const strokesIds: string[] = []\n    ids.forEach(id =>\n    {\n      const sym = this.model.getRootSymbol(id)\n      if (sym) {\n        /** we remove root element */\n        if (sym.id === id) {\n          symbolsToRemove.push(sym)\n          switch (sym.type) {\n            case SymbolType.Stroke:\n              strokesIds.push(sym.id)\n              break\n            case SymbolType.Recognized:\n              strokesIds.push(...sym.strokes.map(s => s.id))\n              break\n            case SymbolType.Group:\n              strokesIds.push(...sym.extractStrokes().map(s => s.id))\n              break\n          }\n        }\n        else {\n          /** we want to remove child */\n          switch (sym.type) {\n            case SymbolType.Group: {\n              const gr = sym.clone()\n              strokesIds.push(...gr.extractStrokes().map(s => s.id).filter(id => ids.includes(id)))\n              gr.removeChilds(ids)\n              if (gr.children.length) {\n                symbolsToUpdate.push(gr)\n              }\n              else {\n                symbolsToRemove.push(gr)\n              }\n              break\n            }\n            case SymbolType.Recognized: {\n              strokesIds.push(id)\n              const ws = sym.clone()\n              ws.removeStrokes(ids)\n              if (ws.strokes.length) {\n                symbolsToUpdate.push(ws)\n              }\n              else {\n                symbolsToRemove.push(ws)\n              }\n              break\n            }\n          }\n\n        }\n      }\n    })\n    this.recognizer.eraseStrokes(strokesIds)\n    symbolsToRemove.forEach(s =>\n    {\n      this.model.removeSymbol(s.id)\n      this.renderer.removeSymbol(s.id)\n    })\n\n    symbolsToUpdate.forEach(s =>\n    {\n      this.model.updateSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n\n\n    if (addToHistory) {\n      const changes: TIIHistoryChanges = {}\n      if (symbolsToRemove.length || symbolsToUpdate.length) {\n        if (symbolsToRemove.length) {\n          changes.erased = symbolsToRemove\n        }\n        if (symbolsToUpdate.length) {\n          changes.updated = symbolsToUpdate\n        }\n        this.history.push(this.model, changes)\n        this.updateLayerUI()\n      }\n    }\n    this.updateLayerState(false)\n    return symbolsToRemove\n  }\n\n  select(ids: string[]): void\n  {\n    this.selector.removeSelectedGroup()\n    this.model.symbols.forEach(s =>\n    {\n      s.selected = ids.includes(s.id)\n      this.renderer.drawSymbol(s)\n    })\n    this.selector.drawSelectedGroup(this.model.symbolsSelected)\n    this.updateLayerUI()\n    this.event.emitSelected(this.model.symbolsSelected)\n  }\n\n  selectAll(): void\n  {\n    this.selector.removeSelectedGroup()\n    this.model.symbols.forEach(s =>\n    {\n      s.selected = true\n      this.renderer.drawSymbol(s)\n    })\n    this.selector.drawSelectedGroup(this.model.symbolsSelected)\n    this.updateLayerUI()\n    this.event.emitSelected(this.model.symbolsSelected)\n  }\n\n  unselectAll(): void\n  {\n    if (this.model.symbolsSelected.length) {\n      this.model.symbolsSelected.forEach(s =>\n      {\n        s.selected = false\n        this.renderer.drawSymbol(s)\n      })\n      this.selector.removeSelectedGroup()\n      this.updateLayerUI()\n      this.event.emitSelected(this.model.symbolsSelected)\n    }\n  }\n\n  async importPointEvents(partialStrokes: PartialDeep<IIStroke>[]): Promise<IIModel>\n  {\n    this.logger.info(\"importPointEvents\", { partialStrokes })\n    this.updateLayerState(false)\n    const strokes = convertPartialStrokesToOIStrokes(partialStrokes)\n    strokes.forEach(s =>\n    {\n      this.model.addSymbol(s)\n      this.renderer.drawSymbol(s)\n    })\n    this.recognizer.addStrokes(strokes, false)\n    this.history.push(this.model, { added: strokes })\n    this.logger.debug(\"importPointEvents\", this.model)\n    this.updateLayerUI()\n    this.event.emitImported(this.model.exports as TExport)\n    return this.model\n  }\n\n  protected triggerDownload(fileName: string, urlData: string): void\n  {\n    const downloadAnchorNode = document.createElement(\"a\")\n    downloadAnchorNode.setAttribute(\"href\", urlData)\n    downloadAnchorNode.setAttribute(\"download\", fileName)\n    document.body.appendChild(downloadAnchorNode)\n    downloadAnchorNode.click()\n    downloadAnchorNode.remove()\n  }\n\n  getSymbolsBounds(symbols: TIISymbol[], margin: number = SELECTION_MARGIN): Box\n  {\n    const box = Box.createFromBoxes(symbols.map(s => s.bounds))\n    box.x -= margin\n    box.y -= margin\n    box.width += margin * 2\n    box.height += margin * 2\n    return box\n  }\n\n  protected buildBlobFromSymbols(symbols: TIISymbol[], box: Box): Blob\n  {\n    const svgNode = SVGBuilder.createLayer(box)\n    symbols.forEach(s =>\n    {\n      const el = this.renderer.getElementById(s.id)?.cloneNode(true)\n      if (el) {\n        svgNode.appendChild(el)\n      }\n    })\n\n    const svgString = (new XMLSerializer()).serializeToString(svgNode)\n\n    return new Blob([svgString], {\n      type: \"image/svg+xml;charset=utf-8\"\n    })\n  }\n\n  protected getExportName(extension: string): string\n  {\n    const options: Intl.DateTimeFormatOptions = { year: \"numeric\", month: \"numeric\", day: \"numeric\", hour: \"2-digit\", minute: \"2-digit\", second: \"2-digit\" }\n    try {\n      return `iink-ts-${ new Date().toLocaleDateString(navigator.language, options) }.${ extension }`\n    }\n    catch {\n      return `iink-ts-${ new Date().toLocaleDateString(\"en-US\", options) }.${ extension }`\n    }\n  }\n\n  downloadAsSVG(selection = false)\n  {\n    const symbols = selection ? this.model.symbolsSelected : this.model.symbols\n    const box = this.getSymbolsBounds(symbols)\n    const svgBlob = this.buildBlobFromSymbols(symbols, box)\n    const url = URL.createObjectURL(svgBlob)\n    this.triggerDownload(this.getExportName(\"svg\"), url)\n  }\n\n  downloadAsPNG(selection = false)\n  {\n    const symbols = selection ? this.model.symbolsSelected : this.model.symbols\n    const box = this.getSymbolsBounds(symbols)\n    const svgBlob = this.buildBlobFromSymbols(symbols, box)\n\n    const url = URL.createObjectURL(svgBlob)\n    const image = new Image(box.width, box.height)\n    image.src = url\n    image.onload = () =>\n    {\n      const canvas = document.createElement(\"canvas\")\n      canvas.width = image.width\n      canvas.height = image.height\n\n      const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D\n      ctx.drawImage(image, 0, 0)\n      URL.revokeObjectURL(url)\n\n      const imgURI = canvas\n        .toDataURL(\"image/png\")\n        .replace(\"image/png\", \"image/octet-stream\")\n\n      this.triggerDownload(this.getExportName(\"png\"), imgURI)\n    }\n  }\n\n  downloadAsJson(selection = false)\n  {\n    const symbolsToExport = selection ? this.model.symbolsSelected : this.model.symbols\n    const dataStr = \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(symbolsToExport, null, 2))\n    this.triggerDownload(this.getExportName(\"json\"), dataStr)\n  }\n\n  extractStrokesFromSymbols(symbols: TIISymbol[] | undefined): IIStroke[]\n  {\n    if (!symbols?.length) return []\n    const strokes: IIStroke[] = []\n    symbols.forEach(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Stroke:\n          strokes.push(s)\n          break\n        case SymbolType.Recognized:\n          strokes.push(...s.strokes)\n          break\n        case SymbolType.Group:\n          strokes.push(...s.extractStrokes())\n          break\n      }\n    })\n    return strokes\n  }\n\n  extractTextsFromSymbols(symbols: TIISymbol[] | undefined): IIText[]\n  {\n    if (!symbols?.length) return []\n    const texts: IIText[] = []\n    symbols.forEach(s =>\n    {\n      switch (s.type) {\n        case SymbolType.Text:\n          texts.push(s)\n          break\n        case SymbolType.Group:\n          texts.push(...s.extractText())\n          break\n      }\n    })\n    return texts\n  }\n\n  protected extractBackendChanges(changes: TIIHistoryChanges): TIIHistoryBackendChanges\n  {\n    const backendChanges: TIIHistoryBackendChanges = {}\n    backendChanges.added = this.extractStrokesFromSymbols(changes.added)\n    backendChanges.erased = this.extractStrokesFromSymbols(changes.erased)\n\n    const updated = this.extractStrokesFromSymbols(changes.updated)\n\n    const oldStrokes = updated.concat(this.extractStrokesFromSymbols(changes.replaced?.oldSymbols))\n    const newStrokes = updated.concat(this.extractStrokesFromSymbols(changes.replaced?.newSymbols))\n    if (oldStrokes.length && newStrokes.length) {\n      backendChanges.replaced = {\n        oldStrokes,\n        newStrokes\n      }\n    }\n    else {\n      backendChanges.added.push(...newStrokes)\n      backendChanges.erased.push(...oldStrokes)\n    }\n\n    if (changes.matrix) {\n      backendChanges.matrix = {\n        strokes: this.extractStrokesFromSymbols(changes.matrix.symbols),\n        matrix: changes.matrix.matrix,\n      }\n    }\n\n    if (changes.translate?.length) {\n      backendChanges.translate = []\n      changes.translate.forEach(tr =>\n      {\n        const strokes = this.extractStrokesFromSymbols(tr.symbols)\n        if (strokes.length) {\n          backendChanges.translate!.push({\n            strokes,\n            tx: tr.tx,\n            ty: tr.ty\n          })\n        }\n      })\n    }\n    if (changes.scale?.length) {\n      backendChanges.scale = []\n      changes.scale.forEach(tr =>\n      {\n        const strokes = this.extractStrokesFromSymbols(tr.symbols)\n        if (strokes.length) {\n          backendChanges.scale!.push({\n            strokes,\n            origin: tr.origin,\n            scaleX: tr.scaleX,\n            scaleY: tr.scaleY\n          })\n        }\n      })\n    }\n    if (changes.rotate?.length) {\n      backendChanges.rotate = []\n      changes.rotate.forEach(tr =>\n      {\n        const strokes = this.extractStrokesFromSymbols(tr.symbols)\n        if (strokes.length) {\n          backendChanges.rotate!.push({\n            strokes,\n            center: tr.center,\n            angle: tr.angle\n          })\n        }\n      })\n    }\n    return backendChanges\n  }\n\n  async undo(): Promise<IIModel>\n  {\n    this.logger.info(\"undo\")\n    if (this.history.context.canUndo) {\n      this.updateLayerState(false)\n      this.unselectAll()\n      const previousStackItem = this.history.undo()\n      const modifications = previousStackItem.model.extractDifferenceSymbols(this.model)\n      this.#model = previousStackItem.model.clone()\n      this.logger.debug(\"undo\", { previousStackItem })\n      const actionsToBackend = this.extractBackendChanges(previousStackItem.changes)\n      modifications.removed.forEach(s => this.renderer.removeSymbol(s.id))\n      modifications.added.forEach(s => this.renderer.drawSymbol(s))\n      if (\n        actionsToBackend.added?.length ||\n        actionsToBackend.erased?.length ||\n        actionsToBackend.replaced ||\n        actionsToBackend.matrix ||\n        actionsToBackend.translate?.length ||\n        actionsToBackend.scale?.length ||\n        actionsToBackend.rotate?.length\n      ) {\n        await this.recognizer.undo(actionsToBackend)\n      }\n      this.updateLayerUI()\n    }\n    return this.model\n  }\n\n  async redo(): Promise<IIModel>\n  {\n    this.logger.info(\"redo\")\n\n    if (this.history.context.canRedo) {\n      this.updateLayerState(false)\n      this.unselectAll()\n      const nextStackItem = this.history.redo()\n      const modifications = nextStackItem.model.extractDifferenceSymbols(this.model)\n      this.#model = nextStackItem.model.clone()\n      this.logger.debug(\"redo\", { modifications })\n      const actionsToBackend = this.extractBackendChanges(nextStackItem.changes)\n      modifications.removed.forEach(s => this.renderer.removeSymbol(s.id))\n      modifications.added.forEach(s => this.renderer.drawSymbol(s))\n      if (\n        actionsToBackend.added?.length ||\n        actionsToBackend.erased?.length ||\n        actionsToBackend.replaced ||\n        actionsToBackend.matrix ||\n        actionsToBackend.translate?.length ||\n        actionsToBackend.scale?.length ||\n        actionsToBackend.rotate?.length\n      ) {\n        await this.recognizer.redo(actionsToBackend)\n      }\n\n      this.updateLayerUI()\n    }\n    return this.model\n  }\n\n  async export(mimeTypes?: string[]): Promise<IIModel>\n  {\n    try {\n      this.logger.info(\"export\", { mimeTypes })\n      const exports = await this.recognizer.export(mimeTypes)\n      this.model.mergeExport(exports as TExport)\n    }\n    catch (error) {\n      this.logger.error(\"export\", { error })\n      this.manageError(error as Error)\n      throw error\n    }\n    return this.model\n  }\n\n  async convert(): Promise<void>\n  {\n    await this.convertSymbols()\n  }\n\n  async convertSymbols(symbols?: TIISymbol[]): Promise<void>\n  {\n    try {\n      this.updateLayerState(false)\n      await this.converter.apply(symbols)\n      this.event.emitConverted(this.model.converts as TExport)\n    }\n    catch (error) {\n      this.logger.error(\"convert\", error)\n      this.manageError(error as Error)\n      throw error\n    }\n    finally {\n      this.updateLayerUI()\n    }\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    return this.recognizer.waitForIdle()\n  }\n\n  async resize({ height, width }: { height?: number, width?: number } = {}): Promise<void>\n  {\n    try {\n      this.logger.info(\"resize\", { height, width })\n      const compStyles = window.getComputedStyle(this.layers.root)\n      height = height || Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.configuration.rendering.minHeight)\n      width = width || Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.configuration.rendering.minWidth)\n\n      this.updateLayerState(false)\n      this.model.height = height\n      this.model.width = width\n      this.renderer.resize(height, width)\n      this.updateLayerUI(50)\n      this.updateLayerState(true)\n    } catch (error) {\n      this.manageError(error as Error)\n    }\n  }\n\n  async clear(): Promise<void>\n  {\n    try {\n      this.logger.info(\"clear\")\n      this.updateLayerState(false)\n      if (this.model.symbols.length) {\n        this.selector.removeSelectedGroup()\n        const erased = this.model.symbols\n        this.renderer.clear()\n        this.model.clear()\n        this.history.push(this.model, { erased })\n        this.recognizer.clear()\n        this.event.emitSelected(this.model.symbolsSelected)\n      }\n      this.updateLayerUI()\n      this.event.emitCleared()\n    } catch (error) {\n      this.manageError(error as Error)\n    }\n  }\n\n  async destroy(): Promise<void>\n  {\n    this.logger.info(\"destroy\")\n\n    this.layers.root.classList.remove(\"draw\")\n    this.layers.root.classList.remove(\"erase\")\n    this.layers.root.classList.remove(\"select\")\n    this.layers.root.classList.remove(\"move\")\n\n    this.eraser.detach()\n    this.selector.detach()\n    this.move.detach()\n    this.writer.detach()\n\n    this.renderer.destroy()\n    this.layers.destroy()\n    this.menu.destroy()\n    this.recognizer.destroy()\n    this.model.clear()\n    this.history.clear()\n    return Promise.resolve()\n  }\n}\n","/**\n * @group Editor\n * @remarks\n * Configure when the action is triggered.\n *\n * POINTER_UP :   Action is triggered on every PenUP.\n *                This is the recommended mode for CDK V3 WebSocket recognitions.\n *\n * QUIET_PERIOD : Action is triggered after a quiet period in milli-seconds on every pointer up.\n *                The value is set to 1000 for example recognition will be triggered when the user stops writing for 1 seconds.\n *                This is the recommended mode for all REST discoveries.\n *\n * DEMAND :       Action is triggered on external demande\n */\nexport type TEditorTriggerConfiguration = {\n    exportContent: \"QUIET_PERIOD\" | \"POINTER_UP\" | \"DEMAND\"\n    exportContentDelay: number\n    resizeTriggerDelay: number\n  }\n\n  /**\n   * @group Editor\n   * @source\n   */\n  export const DefaulTEditorTriggerConfiguration: TEditorTriggerConfiguration = {\n    exportContent: \"QUIET_PERIOD\",\n    exportContentDelay: 1000,\n    resizeTriggerDelay: 100\n  }\n","import { DefaultGrabberConfiguration, TGrabberConfiguration } from \"../grabber\"\nimport { DefaultHistoryConfiguration, THistoryConfiguration } from \"../history\"\nimport { DefaultLoggerConfiguration, TLoggerConfiguration } from \"../logger\"\nimport { DefaultRecognizerHTTPV1Configuration, RecognizerHTTPV1Configuration, TRecognitionHTTPV1Configuration, TRecognizerHTTPV1Configuration, TServerHTTPConfiguration } from \"../recognizer\"\nimport { DefaultRendererConfiguration, TRendererConfiguration } from \"../renderer\"\nimport { DefaultTheme, TPenStyle, TTheme } from \"../style\"\nimport { mergeDeep, PartialDeep } from \"../utils\"\nimport { TEditorConfiguration } from \"./AbstractEditor\"\nimport { DefaulTEditorTriggerConfiguration, TEditorTriggerConfiguration } from \"./EditorTriggerConfiguration\"\n\n\n/**\n * @group Editor\n */\nexport type TInkEditorDeprecatedConfiguration = TEditorConfiguration & TRecognizerHTTPV1Configuration & {\n  rendering: TRendererConfiguration\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TPenStyle,\n  penStyleClasses?: string\n  theme: TTheme\n}\n\n/**\n * @group Editor\n * @source\n */\nexport const DefaultInkEditorDeprecatedConfiguration: TInkEditorDeprecatedConfiguration = {\n  server: DefaultRecognizerHTTPV1Configuration.server,\n  recognition: DefaultRecognizerHTTPV1Configuration.recognition,\n  rendering: DefaultRendererConfiguration,\n  grabber: DefaultGrabberConfiguration,\n  triggers: DefaulTEditorTriggerConfiguration,\n  \"undo-redo\": DefaultHistoryConfiguration,\n  logger: DefaultLoggerConfiguration,\n  penStyle: {},\n  theme: DefaultTheme\n}\n\n/**\n * @group Editor\n */\nexport class InkEditorDeprecatedConfiguration implements TInkEditorDeprecatedConfiguration\n{\n  server: TServerHTTPConfiguration\n  recognition: TRecognitionHTTPV1Configuration\n  rendering: TRendererConfiguration\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TPenStyle\n  penStyleClasses?: string\n  theme: TTheme\n\n  constructor(configuration?: PartialDeep<TInkEditorDeprecatedConfiguration>)\n  {\n    const { server, recognition } = new RecognizerHTTPV1Configuration(configuration)\n    this.server = server\n    this.recognition = recognition\n    this.rendering = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.rendering, configuration?.rendering)\n    this.grabber = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.grabber, configuration?.grabber)\n    this[\"undo-redo\"] = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration[\"undo-redo\"], configuration?.[\"undo-redo\"])\n    this.triggers = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.triggers, configuration?.triggers)\n    this.logger = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.logger, configuration?.logger)\n    this.penStyle = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.penStyle, configuration?.penStyle)\n    this.penStyleClasses = configuration?.penStyleClasses || this.penStyleClasses\n    this.theme = mergeDeep({}, DefaultInkEditorDeprecatedConfiguration.theme, configuration?.theme)\n  }\n}\n","import { EditorTool } from \"../Constants\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\nimport { Model, TExport } from \"../model\"\nimport { Stroke, TStroke, TPointer } from \"../symbol\"\nimport { RecognizerHTTPV1, TConverstionState } from \"../recognizer\"\nimport { CanvasRenderer } from \"../renderer\"\nimport { DefaultPenStyle, StyleManager, TPenStyle, TTheme } from \"../style\"\nimport { HistoryManager } from \"../history\"\nimport { DeferredPromise, PartialDeep } from \"../utils\"\nimport { AbstractEditor, EditorOptionsBase } from \"./AbstractEditor\"\nimport { InkEditorDeprecatedConfiguration, TInkEditorDeprecatedConfiguration } from \"./InkEditorDeprecatedConfiguration\"\n\n/**\n * @group Editor\n */\nexport type TInkEditorDeprecatedOptions = PartialDeep<EditorOptionsBase &\n{\n  configuration: TInkEditorDeprecatedConfiguration\n}> &\n{\n  override?: {\n    grabber?: PointerEventGrabber\n    recognizer?: RecognizerHTTPV1\n  }\n}\n\n/**\n * @group Editor\n * @deprecated Use {@link InkEditor} instead.\n */\nexport class InkEditorDeprecated extends AbstractEditor\n{\n  #configuration: InkEditorDeprecatedConfiguration\n  #model: Model\n  #resizeTimer?: ReturnType<typeof setTimeout>\n  #exportTimer?: ReturnType<typeof setTimeout>\n\n  grabber: PointerEventGrabber\n  renderer: CanvasRenderer\n  recognizer: RecognizerHTTPV1\n  history: HistoryManager\n  styleManager: StyleManager\n  #tool: EditorTool = EditorTool.Write\n\n  constructor(rootElement: HTMLElement, options?: TInkEditorDeprecatedOptions)\n  {\n    super(rootElement, options)\n\n    this.#configuration = new InkEditorDeprecatedConfiguration(options?.configuration)\n    this.styleManager = new StyleManager(options?.configuration?.penStyle, options?.configuration?.theme)\n\n    if (options?.override?.grabber) {\n      const CustomGrabber = options.override.grabber as unknown as typeof PointerEventGrabber\n      this.grabber = new CustomGrabber(this.#configuration.grabber)\n    }\n    else {\n      this.grabber = new PointerEventGrabber(this.#configuration.grabber)\n    }\n    this.grabber.onPointerDown = this.onPointerDown.bind(this)\n    this.grabber.onPointerMove = this.onPointerMove.bind(this)\n    this.grabber.onPointerUp = this.onPointerUp.bind(this)\n\n    if (options?.override?.recognizer) {\n      const CustomRecognizer = options.override.recognizer as unknown as typeof RecognizerHTTPV1\n      this.recognizer = new CustomRecognizer(this.#configuration)\n    }\n    else {\n      this.recognizer = new RecognizerHTTPV1(this.#configuration)\n    }\n    this.renderer = new CanvasRenderer(this.#configuration.rendering)\n\n    this.tool = EditorTool.Write\n    this.#model = new Model()\n    this.history = new HistoryManager(this.#configuration[\"undo-redo\"], this.event)\n  }\n\n  protected onPointerDown(info: PointerInfo): void\n  {\n    this.logger.info(\"onPointerDown\", { tool: this.tool, info })\n    const style: TPenStyle = Object.assign({}, this.theme?.ink, this.currentPenStyle)\n    switch (this.tool) {\n      case EditorTool.Erase: {\n        if (this.model.removeStrokesFromPoint(info.pointer).length > 0) {\n          this.renderer.drawModel(this.model)\n        }\n        break\n      }\n      case EditorTool.Write:\n        this.model.initCurrentStroke(info.pointer, info.pointerType, style)\n        this.drawCurrentStroke()\n        break\n      default:\n        this.logger.warn(\"#onPointerDown\", `onPointerDown tool unknow: \"${ this.tool }\"`)\n        break\n    }\n  }\n\n  protected onPointerMove(info: PointerInfo): void\n  {\n    this.logger.info(\"onPointerMove\", { tool: this.tool, info })\n    switch (this.tool) {\n      case EditorTool.Erase: {\n        if (this.model.removeStrokesFromPoint(info.pointer).length > 0) {\n          this.renderer.drawModel(this.model)\n        }\n        break\n      }\n      case EditorTool.Write:\n        this.model.appendToCurrentStroke(info.pointer)\n        this.drawCurrentStroke()\n        break\n      default:\n        this.logger.warn(\"#onPointerMove\", `onPointerMove tool unknow: \"${ this.tool }\"`)\n        break\n    }\n  }\n\n  protected async onPointerUp(info: PointerInfo): Promise<void>\n  {\n    try {\n      this.logger.info(\"onPointerUp\", { tool: this.tool, info })\n      switch (this.tool) {\n        case EditorTool.Erase:\n          this.model.removeStrokesFromPoint(info.pointer)\n          if (this.history.stack.at(-1)?.modificationDate !== this.model.modificationDate) {\n            await this.updateModelRendering()\n          }\n          break\n        case EditorTool.Write:\n          this.model.endCurrentStroke(info.pointer)\n          await this.updateModelRendering()\n          break\n        default:\n          this.logger.warn(\"#onPointerUp\", `onPointerUp tool unknow: \"${ this.tool }\"`)\n          break\n      }\n    } catch (error) {\n      this.layers.showMessageError(error as Error)\n      this.event.emitError(error as Error)\n      throw error\n    }\n  }\n\n  get initializationPromise(): Promise<void>\n  {\n    return Promise.resolve()\n  }\n\n  get tool(): EditorTool\n  {\n    return this.#tool\n  }\n  set tool(i: EditorTool)\n  {\n    this.#tool = i\n    this.setCursorStyle()\n  }\n\n  protected setCursorStyle(): void\n  {\n    switch (this.tool) {\n      case EditorTool.Erase:\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.add(\"erase\")\n        break\n      default:\n        this.layers.root.classList.add(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        break\n    }\n  }\n\n  get model(): Model\n  {\n    return this.#model\n  }\n\n  get currentPenStyle(): TPenStyle\n  {\n    return this.styleManager.currentPenStyle\n  }\n\n  get penStyle(): TPenStyle\n  {\n    return this.styleManager.penStyle\n  }\n  set penStyle(penStyle: TPenStyle | undefined)\n  {\n    this.logger.info(\"setPenStyle\", { penStyle })\n    this.styleManager.setPenStyle(penStyle)\n  }\n\n  get penStyleClasses(): string\n  {\n    return this.styleManager.penStyleClasses\n  }\n  set penStyleClasses(penStyleClasses: string | undefined)\n  {\n    this.logger.info(\"setPenStyleClasses\", { penStyleClasses })\n    this.styleManager.setPenStyleClasses(penStyleClasses)\n  }\n\n  get theme(): TTheme\n  {\n    return this.styleManager.theme\n  }\n  set theme(theme: PartialDeep<TTheme>)\n  {\n    this.logger.info(\"setTheme\", { theme })\n    this.styleManager.setTheme(theme)\n  }\n\n  get configuration(): InkEditorDeprecatedConfiguration\n  {\n    return this.#configuration\n  }\n\n  async initialize(): Promise<void>\n  {\n    try {\n      this.logger.info(\"initialize\")\n      this.layers.render()\n      this.layers.showLoader()\n\n      const compStyles = window.getComputedStyle(this.layers.root)\n      this.model.width = Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.#configuration.rendering.minWidth)\n      this.model.height = Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.#configuration.rendering.minHeight)\n      this.history.push(this.model)\n      this.layers.rendering.classList.add(this.configuration.recognition.type.toLowerCase().replace(\" \", \"-\"))\n      this.renderer.init(this.layers.rendering, { x: 50, y: 50 })\n      this.grabber.attach(this.layers.rendering)\n    } catch (error) {\n      this.logger.error(\"initialize\", error)\n      this.layers.showMessageError(error as Error)\n      throw error\n    }\n    finally {\n      this.logger.debug(\"initialize\", \"finally\")\n      this.layers.hideLoader()\n      this.layers.updateState(true)\n    }\n  }\n\n  drawCurrentStroke(): void\n  {\n    this.logger.debug(\"drawCurrentStroke\", { stroke: this.model.currentSymbol })\n    this.renderer.drawPendingStroke(this.model.currentSymbol)\n  }\n\n  async updateModelRendering(): Promise<Model>\n  {\n    this.logger.info(\"updateModelRendering\")\n    this.renderer.drawModel(this.model)\n    const deferred = new DeferredPromise<Model>()\n    this.history.push(this.model)\n    if (this.#configuration.triggers.exportContent !== \"DEMAND\") {\n      clearTimeout(this.#exportTimer)\n      let currentModel = this.model.clone()\n      this.#exportTimer = setTimeout(async () =>\n      {\n        try {\n          currentModel = await this.recognizer.export(currentModel)\n          this.history.updateStack(currentModel)\n          if (this.model.modificationDate === currentModel.modificationDate) {\n            this.model.exports = currentModel.exports\n          }\n          deferred.resolve(this.model)\n        } catch (error) {\n          this.logger.error(\"updateModelRendering\", { error })\n          this.event.emitError(error as Error)\n          deferred.reject(error as Error)\n        }\n      }, this.#configuration.triggers.exportContent === \"QUIET_PERIOD\" ? this.#configuration.triggers.exportContentDelay : 0)\n    } else {\n      deferred.resolve(this.model)\n    }\n    await deferred.promise\n    this.event.emitExported(this.model.exports as TExport)\n    this.logger.debug(\"updateModelRendering\", this.model.exports)\n    return deferred.promise\n  }\n\n  async export(mimeTypes?: string[]): Promise<Model>\n  {\n    this.logger.info(\"export\", { mimeTypes })\n    const newModel = await this.recognizer.export(this.model.clone(), mimeTypes)\n    if (this.model.modificationDate === newModel.modificationDate) {\n      this.model.mergeExport(newModel.exports as TExport)\n    }\n    this.history.updateStack(newModel)\n    this.event.emitExported(this.model.exports as TExport)\n    this.logger.debug(\"export\", this.model)\n    return this.model\n  }\n\n  async convert(params?: { conversionState?: TConverstionState, mimeTypes?: string[] }): Promise<Model>\n  {\n    this.logger.info(\"convert\", { params })\n    const newModel = await this.recognizer.convert(this.model, params?.conversionState, params?.mimeTypes)\n    Object.assign(this.#model, newModel)\n    this.event.emitConverted(this.model.converts as TExport)\n    this.logger.debug(\"convert\", this.model)\n    return this.model\n  }\n\n  async importPointEvents(strokes: PartialDeep<TStroke>[]): Promise<Model>\n  {\n    const errors: string[] = []\n    strokes.forEach((s, strokeIndex) =>\n    {\n      let flag = true\n      const stroke = new Stroke(s.style || DefaultPenStyle, s.pointerType)\n      if (s.id) stroke.id = s.id\n      if (!s.pointers?.length) {\n        errors.push(`stroke ${ strokeIndex + 1 } has not pointers`)\n        flag = false\n        return\n      }\n      s.pointers?.forEach((pp, pIndex) =>\n      {\n        if (!pp) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no pointer at ${ pIndex }`)\n          flag = false\n          return\n        }\n        const pointer: TPointer = {\n          p: pp.p || 1,\n          t: pp.t || pIndex,\n          x: 0,\n          y: 0\n        }\n        if (pp?.x == undefined || pp?.x == null) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no x at pointer at ${ pIndex }`)\n          flag = false\n          return\n        }\n        else {\n          pointer.x = pp.x\n        }\n        if (pp?.y == undefined || pp?.y == null) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no y at pointer at ${ pIndex }`)\n          flag = false\n          return\n        }\n        else {\n          pointer.y = pp.y\n        }\n        if (flag) {\n          stroke.pointers.push(pointer)\n        }\n      })\n      if (flag) {\n        this.model.addStroke(stroke)\n      }\n    })\n\n    if (errors.length) {\n      this.event.emitError(new Error(errors.join(\"\\n\")))\n    }\n    try {\n      const newModel = await this.updateModelRendering()\n      Object.assign(this.#model, newModel)\n      this.event.emitImported(this.model.exports as TExport)\n      return this.model\n    } catch (error) {\n      this.event.emitError(error as Error)\n      throw error as Error\n    }\n  }\n  async resize({ height, width }: { height?: number, width?: number } = {}): Promise<void>\n  {\n    this.logger.info(\"resize\", { height, width })\n    const deferredResize = new DeferredPromise<Model>()\n    const compStyles = window.getComputedStyle(this.layers.root)\n    this.model.height = height || Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.configuration.rendering.minHeight)\n    this.model.width = width || Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.configuration.rendering.minWidth)\n    this.renderer.resize(this.model)\n    if (this.model.symbols.length) {\n      clearTimeout(this.#resizeTimer)\n      this.#resizeTimer = setTimeout(async () =>\n      {\n        const resizeModel = await this.recognizer.resize(this.model)\n        deferredResize.resolve(resizeModel)\n      }, this.#configuration.triggers.resizeTriggerDelay)\n    } else {\n      deferredResize.resolve(this.model)\n    }\n    this.#model = await deferredResize.promise\n    this.logger.debug(\"resize\", { model: this.model })\n    this.event.emitExported(this.model.exports as TExport)\n  }\n\n  async undo(): Promise<void>\n  {\n    this.logger.info(\"undo\")\n    this.#model = this.history.undo() as Model\n    this.renderer.drawModel(this.#model)\n    this.#model = await this.recognizer.export(this.#model)\n    this.history.updateStack(this.#model)\n    this.event.emitExported(this.#model.exports as TExport)\n    this.logger.debug(\"undo\", this.#model)\n  }\n\n  async redo(): Promise<void>\n  {\n    this.logger.info(\"redo\")\n    this.#model = this.history.redo() as Model\n    this.renderer.drawModel(this.#model)\n    this.#model = await this.recognizer.export(this.#model)\n    this.history.updateStack(this.#model)\n    this.event.emitExported(this.#model.exports as TExport)\n    this.logger.debug(\"redo\", this.#model)\n  }\n\n  async clear(): Promise<void>\n  {\n    this.logger.info(\"clear\")\n    this.model.clear()\n    this.history.push(this.model)\n    this.renderer.drawModel(this.model)\n    this.event.emitExported(this.model.exports as TExport)\n    this.event.emitCleared()\n    this.logger.debug(\"clear\", this.model)\n  }\n\n  async destroy(): Promise<void>\n  {\n    this.logger.info(\"destroy\")\n    this.event.removeAllListeners()\n    this.grabber.detach()\n    this.layers.destroy()\n    this.renderer.destroy()\n    return Promise.resolve()\n  }\n}\n","import style from \"./InteractiveInkSSRSmartGuide.css\"\nimport { InteractiveInkSSREditor } from \"../editor\"\nimport { LoggerCategory, LoggerManager } from \"../logger\"\nimport { ExportType, TJIIXExport, TJIIXWord } from \"../model\"\nimport { convertMillimeterToPixel, createUUID } from \"../utils\"\nimport { TMarginConfiguration } from \"../recognizer\"\n\n/**\n * @group InteractiveInkSSRSmartGuide\n */\nexport class InteractiveInkSSRSmartGuide\n{\n  uuid: string\n  #smartGuideElement!: HTMLDivElement\n  #wrapperElement!: HTMLDivElement\n  #prompterContainerElement!: HTMLDivElement\n  #prompterTextElement!: HTMLDivElement\n  #ellipsisElement!: HTMLDivElement\n  #tagElement!: HTMLDivElement\n  #candidatesElement!: HTMLDivElement\n  #menuElement!: HTMLDivElement\n  #convertElement!: HTMLButtonElement\n  #copyElement!: HTMLButtonElement\n  #deleteElement!: HTMLButtonElement\n  #isMenuOpen!: boolean\n  editor: InteractiveInkSSREditor\n  margin: TMarginConfiguration\n  jiix?: TJIIXExport\n  lastWord?: TJIIXWord\n  wordToChange?: TJIIXWord\n  #logger = LoggerManager.getLogger(LoggerCategory.SMARTGUIDE)\n\n  constructor(editor: InteractiveInkSSREditor)\n  {\n    this.#logger.info(\"constructor\")\n    this.uuid = createUUID()\n    this.editor = editor\n    this.margin = {\n      bottom: 0,\n      left: 0,\n      right: 0,\n      top: 0\n    }\n    this.#createRootElement()\n    this.#createWrapperElement()\n    this.#createPrompterContainerElement()\n    this.#createPrompterTextElement()\n    this.#createEllipsisElement()\n    this.#createTagElement()\n    this.#createCandidatesElement()\n    this.#createMoreMenuElement()\n    this.#createConvertElement()\n    this.#createCopyElement()\n    this.#createDeleteElement()\n  }\n\n  #createRootElement(): void\n  {\n    this.#smartGuideElement = document.createElement(\"div\")\n    this.#smartGuideElement.id = `smartguide-${ this.uuid }`\n    this.#smartGuideElement.classList.add(\"smartguide\")\n    this.#smartGuideElement.addEventListener(\"pointerdown\", e => {\n      e.preventDefault()\n      e.stopPropagation()\n    })\n  }\n\n  #createWrapperElement(): void\n  {\n    this.#wrapperElement = document.createElement(\"div\")\n    this.#wrapperElement.id = `smartguide-wrapper-${ this.uuid }`\n    this.#wrapperElement.classList.add(\"smartguide-wrapper\")\n  }\n\n  #createPrompterContainerElement(): void\n  {\n    this.#prompterContainerElement = document.createElement(\"div\")\n    this.#prompterContainerElement.id = `prompter-container-${ this.uuid }`\n    this.#prompterContainerElement.classList.add(\"prompter-container\")\n  }\n\n  #createPrompterTextElement(): void\n  {\n    this.#prompterTextElement = document.createElement(\"div\")\n    this.#prompterTextElement.id = `prompter-text-${ this.uuid }`\n    this.#prompterTextElement.classList.add(\"prompter-text\")\n    this.#prompterTextElement.setAttribute(\"touch-action\", \"none\")\n  }\n\n  #createEllipsisElement(): void\n  {\n    this.#ellipsisElement = document.createElement(\"div\")\n    this.#ellipsisElement.id = `ellipsis-${ this.uuid }`\n    this.#ellipsisElement.classList.add(\"ellipsis\")\n    this.#ellipsisElement.innerHTML = \"...\"\n  }\n\n  #createTagElement(): void\n  {\n    this.#tagElement = document.createElement(\"div\")\n    this.#tagElement.id = `tag-icon-${ this.uuid }`\n    this.#tagElement.classList.add(\"tag-icon\")\n    this.#tagElement.innerHTML = \"&#182;\"\n  }\n\n  #createCandidatesElement(): void\n  {\n    this.#candidatesElement = document.createElement(\"div\")\n    this.#candidatesElement.id = `candidates-${ this.uuid }`\n    this.#candidatesElement.classList.add(\"candidates\")\n  }\n\n  #createMoreMenuElement(): void\n  {\n    this.#menuElement = document.createElement(\"div\")\n    this.#menuElement.id = `more-menu-${ this.uuid }`\n    this.#menuElement.classList.add(\"more-menu\")\n  }\n\n  #createConvertElement(): void\n  {\n    this.#convertElement = document.createElement(\"button\")\n    this.#convertElement.id = `convert-${ this.uuid }`\n    this.#convertElement.classList.add(\"options-label-button\")\n    this.#convertElement.innerHTML = \"Convert\"\n  }\n\n  #createCopyElement(): void\n  {\n    this.#copyElement = document.createElement(\"button\")\n    this.#copyElement.id = `copy-${ this.uuid }`\n    this.#copyElement.classList.add(\"options-label-button\")\n    this.#copyElement.innerHTML = \"Copy\"\n  }\n\n  #createDeleteElement(): void\n  {\n    this.#deleteElement = document.createElement(\"button\")\n    this.#deleteElement.id = `delete-${ this.uuid }`\n    this.#deleteElement.classList.add(\"options-label-button\")\n    this.#deleteElement.innerHTML = \"Delete\"\n  }\n\n  init(domElement: HTMLElement, margin: TMarginConfiguration): void\n  {\n    this.#logger.info(\"init\", { domElement, margin })\n\n    const styleElement = document.createElement(\"style\")\n    styleElement.appendChild(document.createTextNode(style as string))\n    domElement.appendChild(styleElement)\n\n\n    domElement.appendChild(this.#smartGuideElement)\n    this.#smartGuideElement.appendChild(this.#wrapperElement)\n\n    this.#wrapperElement.appendChild(this.#tagElement)\n\n    this.#prompterContainerElement.appendChild(this.#prompterTextElement)\n    this.#wrapperElement.appendChild(this.#prompterContainerElement)\n\n    this.#wrapperElement.appendChild(this.#ellipsisElement)\n\n    this.#menuElement.appendChild(this.#convertElement)\n    this.#menuElement.appendChild(this.#copyElement)\n    this.#menuElement.appendChild(this.#deleteElement)\n    this.#menuElement.classList.add(\"close\")\n    this.#wrapperElement.appendChild(this.#menuElement)\n    this.#isMenuOpen = false\n\n    this.#candidatesElement.style.display = \"none\"\n    this.#wrapperElement.appendChild(this.#candidatesElement)\n    this.margin = margin\n    this.#addListeners()\n\n    this.resize()\n  }\n\n  #showCandidates = (target: HTMLElement) =>\n  {\n    this.#logger.info(\"showCandidates\", { target })\n    const wordId = parseInt(target.id.replace(\"word-\", \"\").replace(this.uuid, \"\"))\n    const words = this.jiix?.words as TJIIXWord[]\n    this.wordToChange = words[wordId]\n    if (this.wordToChange) {\n      this.wordToChange.id = wordId.toString()\n      this.#candidatesElement.innerHTML = \"\"\n      if (this.wordToChange?.candidates) {\n        this.#candidatesElement.style.display = \"flex\"\n        this.wordToChange.candidates.forEach((word, index) =>\n        {\n          if (this.wordToChange?.label === word) {\n            this.#candidatesElement.innerHTML += `<span id=\"cdt-${ index }${ this.uuid }\" class=\"selected-word\">${ word }</span>`\n          } else {\n            this.#candidatesElement.innerHTML += `<span id=\"cdt-${ index }${ this.uuid }\">${ word }</span>`\n          }\n        })\n\n        target.appendChild(this.#candidatesElement)\n      }\n    }\n  }\n  #hideCandidates(): void\n  {\n    this.#candidatesElement.style.display = \"none\"\n  }\n\n  #openMenu(): void\n  {\n    this.#menuElement.classList.add(\"open\")\n    this.#menuElement.classList.remove(\"close\")\n    this.#isMenuOpen = true\n  }\n  #closeMenu(): void\n  {\n    this.#menuElement.classList.add(\"close\")\n    this.#menuElement.classList.remove(\"open\")\n    this.#isMenuOpen = false\n  }\n\n  #onClickEllipsis = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickEllipsis\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n    this.#isMenuOpen ? this.#closeMenu() : this.#openMenu()\n    this.#hideCandidates()\n  }\n\n  #onClickConvert = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickConvert\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    this.editor.convert()\n    this.#closeMenu()\n  }\n\n  #createTextAreaElement(value: string): HTMLTextAreaElement\n  {\n    const isRTL = document.documentElement.getAttribute(\"dir\") === \"rtl\"\n    const textArea = document.createElement(\"textarea\")\n    textArea.style.fontSize = \"12pt\"\n    textArea.style.display = \"absolute\"\n    textArea.style[isRTL ? \"right\" : \"left\"] = \"-9999px\"\n    const yPosition = window.pageYOffset || document.documentElement.scrollTop\n    textArea.style.top = `${ yPosition }px`\n    textArea.setAttribute(\"readonly\", \"\")\n    textArea.value = value\n    return textArea\n  }\n\n  #selectText(textArea: HTMLTextAreaElement)\n  {\n    if (navigator.userAgent.match(/ipad|iphone/i)) {\n      const range = document.createRange()\n      range.selectNodeContents(textArea)\n      const selection = window.getSelection()\n      if (selection) {\n        selection.removeAllRanges()\n        selection.addRange(range)\n        textArea.setSelectionRange(0, 999999)\n      }\n    } else {\n      textArea.select()\n    }\n  }\n\n  #onClickCopy = async (evt: Event): Promise<void> =>\n  {\n    this.#logger.info(\"onClickCopy\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    try {\n      this.#closeMenu()\n      let message = \"Nothing to copy\"\n      if (this.#prompterTextElement.innerText) {\n        message = `\"${ this.#prompterTextElement.innerText }\" copied to clipboard`\n        const fakeEl = this.#createTextAreaElement(this.#prompterTextElement.innerText)\n        this.#prompterContainerElement.appendChild(fakeEl)\n        this.#selectText(fakeEl)\n        document.execCommand(\"copy\")\n        fakeEl.remove()\n      }\n      this.editor.event.emitNotif({ message, timeout: 1500 })\n    } catch (error) {\n      this.#logger.error(\"onClickCopy\", error)\n      this.editor.event.emitError(error as Error)\n    }\n  }\n\n  #onClickDelete = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickDelete\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    this.editor.clear()\n    this.#closeMenu()\n  }\n\n  #onClickCandidate = (evt: Event) =>\n  {\n    this.#logger.info(\"onClickCandidate\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    const target = evt.target as HTMLElement\n    const candidate = target.innerText\n    if (this.jiix?.words && candidate !== this.wordToChange?.label && this.wordToChange?.candidates?.includes(candidate)) {\n      this.jiix.words[parseInt(this.wordToChange?.id as string)].label = candidate\n      this.editor.import(new Blob([JSON.stringify(this.jiix)], { type: ExportType.JIIX }), ExportType.JIIX)\n    }\n    this.#candidatesElement.style.display = \"none\"\n  }\n\n  #onClickPrompter = (evt: Event): void =>\n  {\n    this.#logger.info(\"onClickPrompter\", { evt })\n    evt.preventDefault()\n    evt.stopPropagation()\n    this.#closeMenu()\n    const target = evt.target as HTMLElement\n    if (target.id !== this.#prompterTextElement.id) {\n      this.#showCandidates(target)\n    } else {\n      this.#hideCandidates()\n    }\n  }\n\n  #stopPropagation = (evt: Event) =>\n  {\n    evt.preventDefault()\n    evt.stopPropagation()\n  }\n\n  #onClickOutSide = () =>\n  {\n    this.#hideCandidates()\n    this.#closeMenu()\n  }\n\n  #addListeners(): void\n  {\n    this.#smartGuideElement.addEventListener(\"pointerdown\", this.#stopPropagation.bind(this))\n    this.#ellipsisElement.addEventListener(\"pointerdown\", this.#onClickEllipsis.bind(this))\n    this.#convertElement.addEventListener(\"pointerdown\", this.#onClickConvert.bind(this))\n    this.#copyElement.addEventListener(\"pointerdown\", this.#onClickCopy.bind(this))\n    this.#deleteElement.addEventListener(\"pointerdown\", this.#onClickDelete.bind(this))\n    this.#prompterTextElement.addEventListener(\"pointerdown\", this.#onClickPrompter.bind(this))\n    this.#candidatesElement.addEventListener(\"pointerdown\", this.#onClickCandidate.bind(this))\n    document.addEventListener(\"pointerdown\", this.#onClickOutSide.bind(this))\n  }\n\n  #removeListeners(): void\n  {\n    this.#smartGuideElement.addEventListener(\"pointerdown\", this.#stopPropagation)\n    this.#ellipsisElement.removeEventListener(\"pointerdown\", this.#onClickEllipsis)\n    this.#convertElement.removeEventListener(\"pointerdown\", this.#onClickConvert)\n    this.#copyElement.removeEventListener(\"pointerdown\", this.#onClickCopy)\n    this.#deleteElement.removeEventListener(\"pointerdown\", this.#onClickDelete)\n    this.#prompterTextElement.removeEventListener(\"pointerdown\", this.#onClickPrompter)\n    this.#candidatesElement.removeEventListener(\"pointerdown\", this.#onClickCandidate)\n    document.removeEventListener(\"pointerdown\", this.#onClickOutSide)\n  }\n\n  resize(): void\n  {\n    this.#logger.info(\"resize\")\n    const marginLeft = convertMillimeterToPixel(this.margin.left)\n    const marginRight = convertMillimeterToPixel(this.margin.right)\n    this.#wrapperElement.style.marginLeft = `${ marginLeft }px`\n    this.#wrapperElement.style.marginRight = `${ marginRight }px`\n  }\n\n  update(exports: TJIIXExport): void\n  {\n    this.#logger.info(\"update\", { exports })\n    this.jiix = exports\n    const createWordSpan = (index: number, word?: TJIIXWord) =>\n    {\n      const span = document.createElement(\"span\")\n      span.id = `word-${ index }${ this.uuid }`\n      if (word) {\n        span.textContent = word.label\n      } else {\n        span.innerHTML = \"&nbsp;\"\n      }\n      this.#logger.debug(\"update\", { span })\n      return span\n    }\n\n    const populatePrompter = () =>\n    {\n      this.#logger.info(\"populatePrompter\")\n      this.#prompterTextElement.innerHTML = \"\"\n      if (this.jiix?.words) {\n        const words = this.jiix.words as TJIIXWord[]\n        const myFragment = document.createDocumentFragment()\n        words.forEach((word, index) =>\n        {\n          if (word.label === \" \" || word.label.includes(\"\\n\")) {\n            myFragment.appendChild(createWordSpan(index))\n          } else if (index !== words.length - 1) {\n            myFragment.appendChild(createWordSpan(index, word))\n          } else {\n            this.#prompterTextElement.appendChild(myFragment)\n            if (this.lastWord) {\n              this.lastWord = word\n            }\n            const span = createWordSpan(index, word)\n\n            if ((this.lastWord?.candidates !== word.candidates) && (this.lastWord?.label !== word.label)) {\n              this.lastWord = word\n            }\n            if (this.wordToChange?.id === index.toString()) {\n              span.classList.add(\"modified-word\")\n              this.wordToChange = undefined\n            }\n            else {\n              span.classList.add(\"added-word\")\n            }\n            this.#prompterTextElement.appendChild(span)\n            this.#prompterContainerElement.scrollLeft = span.offsetLeft\n            this.#logger.debug(\"update => populatePrompter\", { span, lastWord: this.lastWord })\n          }\n        })\n      }\n    }\n    populatePrompter()\n    if (this.jiix?.words?.length) {\n      this.#ellipsisElement.style.setProperty(\"pointer-events\", \"auto\")\n    }\n    else {\n      this.#ellipsisElement.style.setProperty(\"pointer-events\", \"none\")\n    }\n  }\n\n  clear(): void\n  {\n    this.#logger.info(\"clear\")\n    this.#prompterTextElement.innerHTML = \"\"\n    this.#candidatesElement.innerHTML = \"\"\n  }\n\n  destroy(): void\n  {\n    this.#logger.info(\"destroy\")\n    this.#removeListeners()\n    this.#smartGuideElement.remove()\n  }\n}","import { DefaultGrabberConfiguration, TGrabberConfiguration } from \"../grabber\"\nimport { DefaultHistoryConfiguration, THistoryConfiguration } from \"../history\"\nimport { DefaultLoggerConfiguration, TLoggerConfiguration } from \"../logger\"\nimport { DefaultRecognizerWebSocketSSRConfiguration, TRecognizerWebSocketSSRRecognitionConfiguration, TRecognizerWebSocketSSRConfiguration, RecognizerWebSocketSSRConfiguration, TServerWebsocketConfiguration } from \"../recognizer\"\nimport { DefaultRendererConfiguration, TRendererConfiguration } from \"../renderer\"\nimport { DefaultTheme, TPenStyle, TTheme } from \"../style\"\nimport { mergeDeep, PartialDeep } from \"../utils\"\nimport { TEditorConfiguration } from \"./AbstractEditor\"\nimport { DefaulTEditorTriggerConfiguration, TEditorTriggerConfiguration } from \"./EditorTriggerConfiguration\"\n\n/**\n * @group Editor\n */\nexport type TInteractiveInkSSREditorConfiguration = TEditorConfiguration & TRecognizerWebSocketSSRConfiguration & {\n  rendering: TRendererConfiguration\n  smartGuide: {\n    enable: boolean\n  },\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TPenStyle,\n  penStyleClasses?: string\n  theme: TTheme\n}\n\n/**\n * @group Editor\n * @source\n */\nexport const DefaultInteractiveInkSSREditorConfiguration: TInteractiveInkSSREditorConfiguration = {\n  server: DefaultRecognizerWebSocketSSRConfiguration.server,\n  recognition: DefaultRecognizerWebSocketSSRConfiguration.recognition,\n  rendering: DefaultRendererConfiguration,\n  smartGuide: {\n    enable: true\n  },\n  grabber: DefaultGrabberConfiguration,\n  triggers: DefaulTEditorTriggerConfiguration,\n  \"undo-redo\": DefaultHistoryConfiguration,\n  logger: DefaultLoggerConfiguration,\n  penStyle: {},\n  theme: DefaultTheme\n}\n\n/**\n * @group Editor\n */\nexport class InteractiveInkSSREditorConfiguration implements TInteractiveInkSSREditorConfiguration\n{\n  server: TServerWebsocketConfiguration\n  recognition: TRecognizerWebSocketSSRRecognitionConfiguration\n  rendering: TRendererConfiguration\n  smartGuide: {\n    enable: boolean\n  }\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TPenStyle\n  penStyleClasses?: string\n  theme: TTheme\n\n  constructor(configuration?: PartialDeep<TInteractiveInkSSREditorConfiguration>)\n  {\n    const { server, recognition } = new RecognizerWebSocketSSRConfiguration(configuration)\n    this.server = server\n    this.recognition = recognition\n\n    this.rendering = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.rendering, configuration?.rendering)\n    this.smartGuide = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.smartGuide, configuration?.smartGuide)\n    this[\"undo-redo\"] = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration[\"undo-redo\"], configuration?.[\"undo-redo\"])\n    this.grabber = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.grabber, configuration?.grabber)\n    this.triggers = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.triggers, configuration?.triggers)\n    this.logger = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.logger, configuration?.logger)\n    this.penStyle = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.penStyle, configuration?.penStyle)\n    this.penStyleClasses = configuration?.penStyleClasses || this.penStyleClasses\n    this.theme = mergeDeep({}, DefaultInteractiveInkSSREditorConfiguration.theme, configuration?.theme)\n\n    if (this.recognition.type !== \"TEXT\") {\n      this.smartGuide.enable = false\n    }\n    if (this.smartGuide.enable && !this.recognition.text.mimeTypes.includes(\"application/vnd.myscript.jiix\")) {\n      this.recognition.text.mimeTypes.push(\"application/vnd.myscript.jiix\")\n    }\n\n  }\n}\n","import { EditorTool } from \"../Constants\"\nimport { PointerEventGrabber, PointerInfo } from \"../grabber\"\nimport { Model, TExport, TJIIXExport } from \"../model\"\nimport { TRecognizerWebSocketSSRMessageSVGPatch, RecognizerWebSocketSSR, DefaultMarginConfiguration, TConverstionState, TMarginConfiguration } from \"../recognizer\"\nimport { InteractiveInkSSRSmartGuide } from \"../smartguide\"\nimport { InteractiveInkSSRSVGRenderer } from \"../renderer\"\nimport { DefaultPenStyle, StyleManager, TPenStyle, TTheme } from \"../style\"\nimport { HistoryManager, THistoryContext } from \"../history\"\nimport { DeferredPromise, PartialDeep } from \"../utils\"\nimport { Stroke, TStroke, TPointer } from \"../symbol\"\nimport { AbstractEditor, EditorOptionsBase } from \"./AbstractEditor\"\nimport { InteractiveInkSSREditorConfiguration } from \"./InteractiveInkSSREditorConfiguration\"\n\n/**\n * @group Editor\n */\nexport type TInteractiveInkSSREditorOptions = PartialDeep<EditorOptionsBase &\n  {\n    configuration: InteractiveInkSSREditorConfiguration\n  }> &\n  {\n    override?: {\n      grabber?: PointerEventGrabber\n      recognizer?: RecognizerWebSocketSSR\n    }\n  }\n\n/**\n * @group Editor\n */\nexport class InteractiveInkSSREditor extends AbstractEditor\n{\n  #configuration: InteractiveInkSSREditorConfiguration\n  #model: Model\n  #resizeTimer?: ReturnType<typeof setTimeout>\n\n  smartGuide?: InteractiveInkSSRSmartGuide\n  grabber: PointerEventGrabber\n  renderer: InteractiveInkSSRSVGRenderer\n  recognizer: RecognizerWebSocketSSR\n  history: HistoryManager\n  styleManager: StyleManager\n  #tool: EditorTool = EditorTool.Write\n\n  constructor(rootElement: HTMLElement, options?: TInteractiveInkSSREditorOptions)\n  {\n    super(rootElement, options)\n\n    this.#configuration = new InteractiveInkSSREditorConfiguration(options?.configuration)\n    this.styleManager = new StyleManager(options?.configuration?.penStyle, options?.configuration?.theme)\n\n    if (options?.override?.grabber) {\n      const CustomGrabber = options.override.grabber as unknown as typeof PointerEventGrabber\n      this.grabber = new CustomGrabber(this.#configuration.grabber)\n    }\n    else {\n      this.grabber = new PointerEventGrabber(this.#configuration.grabber)\n    }\n\n    if (options?.override?.recognizer) {\n      const CustomRecognizer = options.override.recognizer as unknown as typeof RecognizerWebSocketSSR\n      this.recognizer = new CustomRecognizer(this.#configuration)\n    }\n    else {\n      this.recognizer = new RecognizerWebSocketSSR(this.#configuration)\n    }\n\n    this.renderer = new InteractiveInkSSRSVGRenderer(this.#configuration.rendering)\n\n    this.tool = EditorTool.Write\n    this.#model = new Model()\n    this.history = new HistoryManager(this.#configuration[\"undo-redo\"], this.event)\n  }\n\n  get initializationPromise(): Promise<void>\n  {\n    return this.recognizer.initialized.promise\n  }\n\n  get tool(): EditorTool\n  {\n    return this.#tool\n  }\n  set tool(i: EditorTool)\n  {\n    this.#tool = i\n    this.setCursorStyle()\n  }\n\n  protected setCursorStyle(): void\n  {\n    switch (this.tool) {\n      case EditorTool.Erase:\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.add(\"erase\")\n        break\n      default:\n        this.layers.root.classList.add(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        break\n    }\n  }\n\n  get model(): Model\n  {\n    return this.#model\n  }\n\n  get configuration(): InteractiveInkSSREditorConfiguration\n  {\n    return this.#configuration\n  }\n\n  get currentPenStyle(): TPenStyle\n  {\n    return this.styleManager.currentPenStyle\n  }\n\n  get penStyle(): TPenStyle\n  {\n    return this.styleManager.penStyle\n  }\n  set penStyle(penStyle: PartialDeep<TPenStyle>)\n  {\n    this.logger.info(\"setPenStyle\", { penStyle })\n    this.styleManager.setPenStyle(penStyle)\n    this.logger.debug(\"setPenStyle\", this.styleManager.penStyle)\n    this.recognizer.setPenStyle(this.styleManager.penStyle)\n  }\n\n  get penStyleClasses(): string\n  {\n    return this.styleManager.penStyleClasses\n  }\n  set penStyleClasses(penClass: string)\n  {\n    this.logger.info(\"setPenStyleClasses\", { penClass })\n    this.styleManager.setPenStyleClasses(penClass)\n    this.logger.debug(\"setPenStyleClasses\", this.styleManager.penStyleClasses)\n    this.recognizer.setPenStyleClasses(this.styleManager.penStyleClasses)\n  }\n\n  get theme(): TTheme\n  {\n    return this.styleManager.theme\n  }\n  set theme(theme: PartialDeep<TTheme>)\n  {\n    this.logger.info(\"setTheme\", { theme })\n    this.styleManager.setTheme(theme)\n    this.logger.debug(\"setTheme\", this.styleManager.theme)\n    this.recognizer.setTheme(this.styleManager.theme)\n  }\n\n  protected async syncStyle(): Promise<void>\n  {\n    await Promise.all([\n      this.recognizer.setPenStyle(this.styleManager.penStyle),\n      this.recognizer.setPenStyleClasses(this.styleManager.penStyleClasses),\n      this.recognizer.setTheme(this.styleManager.theme)\n    ])\n  }\n\n  protected onExport(exports: TExport): void\n  {\n    this.logger.debug(\"onExport\", { exports })\n    if (this.smartGuide && exports?.[\"application/vnd.myscript.jiix\"]) {\n      const jjix = exports[\"application/vnd.myscript.jiix\"] as TJIIXExport\n      this.smartGuide.update(jjix)\n    }\n    this.model.mergeExport(exports)\n    this.event.emitExported(exports)\n  }\n\n  protected onPointerDown(info: PointerInfo): void\n  {\n    this.logger.info(\"onPointerDown\", { tool: this.tool, info })\n    const style: TPenStyle = Object.assign({}, this.theme?.ink, this.currentPenStyle)\n    this.model.initCurrentStroke(info.pointer, this.tool === EditorTool.Erase ? \"eraser\" : info.pointerType, style)\n    this.drawCurrentStroke()\n  }\n\n  protected onPointerMove(info: PointerInfo): void\n  {\n    this.logger.info(\"onPointerMove\", { tool: this.tool, info })\n    this.model.appendToCurrentStroke(info.pointer)\n    this.drawCurrentStroke()\n  }\n\n  protected async onPointerUp(info: PointerInfo): Promise<void>\n  {\n    try {\n      this.logger.info(\"onPointerUp\", { tool: this.tool, info })\n      this.model.endCurrentStroke(info.pointer)\n      await this.synchronizeModelWithBackend()\n    } catch (error) {\n      this.event.emitError(error as Error)\n    }\n  }\n\n  protected onSVGPatch(evt: TRecognizerWebSocketSSRMessageSVGPatch): void\n  {\n    this.logger.info(\"onSVGPatch\", { evt })\n    this.renderer.updatesLayer(evt.layer, evt.updates)\n  }\n\n  protected initializeSmartGuide(): void\n  {\n    this.smartGuide?.destroy()\n    this.logger.info(\"initializeSmartGuide\", { smartGuide: this.configuration.smartGuide })\n    if (this.configuration.smartGuide.enable) {\n      this.smartGuide = new InteractiveInkSSRSmartGuide(this)\n      let margin: TMarginConfiguration = DefaultMarginConfiguration\n      switch (this.configuration.recognition.type) {\n        case \"TEXT\":\n          margin = this.configuration.recognition.text.margin\n          break\n        case \"MATH\":\n          margin = this.configuration.recognition.math.margin\n          break\n      }\n      this.smartGuide.init(this.layers.ui.root, margin)\n    }\n  }\n\n  protected onContentChanged(undoRedoContext: THistoryContext): void\n  {\n    this.history.context = undoRedoContext\n    this.event.emitChanged(undoRedoContext)\n  }\n\n  protected onError(error: Error): void\n  {\n    this.layers.showMessageError(error)\n    this.event.emitError(error)\n  }\n\n  async initialize(): Promise<void>\n  {\n    try {\n      this.logger.info(\"initialize\")\n      this.layers.render()\n      this.layers.showLoader()\n\n      const compStyles = window.getComputedStyle(this.layers.root)\n      this.model.width = Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.#configuration.rendering.minWidth)\n      this.model.height = Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.#configuration.rendering.minHeight)\n      this.history.push(this.model)\n      this.renderer.init(this.layers.rendering)\n\n      this.grabber.attach(this.layers.rendering)\n      this.grabber.onPointerDown = this.onPointerDown.bind(this)\n      this.grabber.onPointerMove = this.onPointerMove.bind(this)\n      this.grabber.onPointerUp = this.onPointerUp.bind(this)\n\n      this.initializeSmartGuide()\n\n      if(!this.recognizer.configuration.server.version) {\n        await this.loadInfo(this.configuration.server)\n        this.recognizer.configuration.server.version = this.info!.version\n      }\n      await this.recognizer.init(this.model.height, this.model.width)\n      this.recognizer.event.addExportedListener(this.onExport.bind(this))\n      this.recognizer.event.addSVGPatchListener(this.onSVGPatch.bind(this))\n      this.recognizer.event.addContentChangedListener(this.onContentChanged.bind(this))\n      this.recognizer.event.addIdleListener(this.event.emitIdle.bind(this.event))\n      this.recognizer.event.addErrorListener(this.onError.bind(this))\n\n      await this.syncStyle()\n    } catch (error) {\n      this.logger.error(\"initialize\", error)\n      this.layers.showMessageError(error as Error)\n      throw error\n    }\n    finally {\n      this.logger.debug(\"initialize\", \"finally\")\n      this.layers.hideLoader()\n      this.layers.updateState(true)\n    }\n  }\n\n  drawCurrentStroke(): void\n  {\n    this.logger.debug(\"drawCurrentStroke\", { stroke: this.model.currentSymbol })\n    const currentSymbol = this.model.currentSymbol as Stroke\n    if (currentSymbol) {\n      this.renderer.drawPendingStroke(currentSymbol)\n    }\n  }\n\n  async synchronizeModelWithBackend(): Promise<Model>\n  {\n    this.logger.info(\"synchronizeModelWithBackend\")\n    if (this.#configuration.triggers.exportContent !== \"DEMAND\") {\n      const unsentStrokes = this.model.extractUnsentStrokes()\n      this.model.updatePositionSent()\n      this.history.push(this.model)\n      this.renderer.clearErasingStrokes()\n      const exports = await this.recognizer.addStrokes(unsentStrokes)\n      this.model.mergeExport(exports)\n      this.history.updateStack(this.model)\n    }\n    this.logger.debug(\"synchronizeModelWithBackend\", this.model)\n    return this.model\n  }\n\n  async waitForIdle(): Promise<void>\n  {\n    return this.recognizer.waitForIdle()\n  }\n\n  async export(mimeTypes?: string[]): Promise<Model>\n  {\n    this.logger.info(\"export\", { mimeTypes })\n    try {\n      if (this.#configuration.triggers.exportContent === \"DEMAND\") {\n        const unsentStrokes = this.model.extractUnsentStrokes()\n        this.history.push(this.model)\n        this.history.stack.push(this.model.clone())\n        this.model.updatePositionSent()\n        const exports = await this.recognizer.addStrokes(unsentStrokes)\n        this.model.updatePositionReceived()\n        this.model.mergeExport(exports)\n        this.logger.debug(\"export\", this.model)\n      } else {\n        return await this.recognizer.export(this.model, mimeTypes)\n      }\n    } catch (error) {\n      this.logger.error(\"export\", { error })\n      this.event.emitError(error as Error)\n      return Promise.reject(error)\n    }\n    return this.model\n  }\n\n  async convert(params?: { conversionState?: TConverstionState }): Promise<Model>\n  {\n    this.logger.info(\"convert\", { params })\n    this.history.push(this.model)\n    this.history.stack.push(this.model.clone())\n    this.#model = await this.recognizer.convert(this.model, params?.conversionState)\n    this.logger.debug(\"convert\", this.model)\n    this.history.push(this.model)\n    this.event.emitConverted(this.model.converts as TExport)\n    return this.model\n  }\n\n  async import(data: Blob | string | TJIIXExport, mimeType?: string): Promise<Model>\n  {\n    let blobToImport: Blob\n    if (data instanceof Blob) {\n      blobToImport = data\n    }\n    else if (typeof data === \"string\") {\n      blobToImport = new Blob([data])\n    }\n    else {\n      blobToImport = new Blob([JSON.stringify(data)])\n    }\n    this.logger.info(\"import\", { data, mimeType })\n    this.history.stack.push(this.model.clone())\n    this.#model = await this.recognizer.import(this.model, blobToImport, mimeType)\n    this.history.push(this.model)\n    this.event.emitImported(this.model.exports as TExport)\n    return this.model\n  }\n\n  async importPointEvents(strokes: PartialDeep<TStroke>[]): Promise<Model>\n  {\n    this.logger.info(\"importPointEvents\", { strokes })\n    const errors: string[] = []\n    const strokesToImport = strokes.map((s, strokeIndex) =>\n    {\n      const str = new Stroke(s.style || DefaultPenStyle, s.pointerType)\n      if (s.id) str.id = s.id\n      if (s.pointerType) str.pointerType = s.pointerType\n      if (!s.pointers?.length) {\n        errors.push(`stroke ${ strokeIndex + 1 } has not pointers`)\n      }\n      let flag = true\n      s.pointers?.forEach((pp, pIndex) =>\n      {\n        flag = true\n        if (!pp) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no pointer at ${ pIndex }`)\n          return\n        }\n        const pointer: TPointer = {\n          p: pp.p || 1,\n          t: pp.t || pIndex,\n          x: 0,\n          y: 0\n        }\n        if (pp?.x == undefined || pp?.x == null) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no x at pointer at ${ pIndex }`)\n          flag = false\n        }\n        else {\n          pointer.x = pp.x\n        }\n        if (pp?.y == undefined || pp?.y == null) {\n          errors.push(`stroke ${ strokeIndex + 1 } has no y at pointer at ${ pIndex }`)\n          flag = false\n        }\n        else {\n          pointer.y = pp.y\n        }\n        if (flag) {\n          str.pointers.push(pointer)\n        }\n      })\n      return str\n    })\n    if (errors.length) {\n      this.event.emitError(new Error(errors.join(\"\\n\")))\n    }\n    strokesToImport.map(s => this.model.addStroke(s))\n    const exportPoints = await this.recognizer.importPointEvents(strokesToImport)\n    this.model.mergeExport(exportPoints)\n    this.event.emitImported(this.model.exports as TExport)\n    this.logger.debug(\"importPointEvents\", this.model)\n    return this.model\n  }\n\n  async resize({ height, width }: { height?: number, width?: number } = {}): Promise<void>\n  {\n    this.logger.info(\"resize\", { height, width })\n    const deferredResize = new DeferredPromise<Model>()\n    const compStyles = window.getComputedStyle(this.layers.root)\n    this.model.height = height || Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.configuration.rendering.minHeight)\n    this.model.width = width || Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.configuration.rendering.minWidth)\n    const clonedModel = this.model.clone()\n    this.renderer.resize(clonedModel)\n    clearTimeout(this.#resizeTimer)\n    this.#resizeTimer = setTimeout(async () =>\n    {\n      try {\n        const resizeModel = await this.recognizer.resize(clonedModel)\n        deferredResize.resolve(resizeModel)\n      } catch (error) {\n        this.logger.error(\"resize\", { height, width, error })\n        deferredResize.reject(error as Error)\n      }\n    }, this.#configuration.triggers.resizeTriggerDelay)\n\n    this.#model = await deferredResize.promise\n    this.smartGuide?.resize()\n    this.event.emitExported(this.model.exports as TExport)\n    this.logger.debug(\"resize\", this.model)\n  }\n\n  async undo(): Promise<Model>\n  {\n    this.logger.info(\"undo\")\n    if (this.history.context.canUndo) {\n      this.#model = this.history.undo() as Model\n      return this.recognizer.undo(this.model)\n    }\n    else {\n      throw new Error(\"Undo not allowed\")\n    }\n  }\n\n  async redo(): Promise<Model>\n  {\n    this.logger.info(\"redo\")\n    if (this.history.context.canRedo) {\n      this.#model = this.history.redo() as Model\n      this.logger.debug(\"undo\", this.#model)\n      return this.recognizer.redo(this.model)\n    }\n    else {\n      throw new Error(\"Redo not allowed\")\n    }\n  }\n\n  async clear(): Promise<void>\n  {\n    this.logger.info(\"clear\")\n    this.model.clear()\n    this.history.push(this.model)\n    await this.recognizer.clear(this.model)\n    this.event.emitCleared()\n  }\n\n  async destroy(): Promise<void>\n  {\n    this.logger.info(\"destroy\")\n    this.event.removeAllListeners()\n    this.grabber.detach()\n    this.layers.destroy()\n    this.renderer.destroy()\n    this.recognizer.destroy()\n    this.smartGuide?.destroy()\n    return Promise.resolve()\n  }\n}\n","import { DefaultGrabberConfiguration, TGrabberConfiguration } from \"../grabber\"\nimport { DefaultHistoryConfiguration, THistoryConfiguration } from \"../history\"\nimport { DefaultLoggerConfiguration, TLoggerConfiguration } from \"../logger\"\nimport { DefaultRecognizerHTTPV2Configuration, RecognizerHTTPV2Configuration, TRecognizerHTTPV2Configuration, TRecognizerHTTPV2RecognitionConfiguration, TServerHTTPConfiguration } from \"../recognizer\"\nimport { DefaultIIRendererConfiguration, TIIRendererConfiguration } from \"../renderer\"\nimport { DefaultStyle, TStyle } from \"../style\"\nimport { convertPixelToMillimeter, mergeDeep, PartialDeep } from \"../utils\"\nimport { TEditorConfiguration } from \"./AbstractEditor\"\nimport { DefaulTEditorTriggerConfiguration, TEditorTriggerConfiguration } from \"./EditorTriggerConfiguration\"\n\n\n/**\n * @group Editor\n */\nexport type TInkEditorConfiguration = TEditorConfiguration & TRecognizerHTTPV2Configuration & {\n  rendering: TIIRendererConfiguration\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TStyle\n}\n\n/**\n * @group Editor\n * @source\n */\nexport const DefaultInkEditorConfiguration: TInkEditorConfiguration = {\n  server: DefaultRecognizerHTTPV2Configuration.server,\n  recognition: DefaultRecognizerHTTPV2Configuration.recognition,\n  rendering: DefaultIIRendererConfiguration,\n  grabber: DefaultGrabberConfiguration,\n  triggers: DefaulTEditorTriggerConfiguration,\n  \"undo-redo\": DefaultHistoryConfiguration,\n  logger: DefaultLoggerConfiguration,\n  penStyle: DefaultStyle,\n}\n\n/**\n * @group Editor\n */\nexport class InkEditorConfiguration implements TInkEditorConfiguration\n{\n  server: TServerHTTPConfiguration\n  recognition: TRecognizerHTTPV2RecognitionConfiguration\n  rendering: TIIRendererConfiguration\n  \"undo-redo\": THistoryConfiguration\n  grabber: TGrabberConfiguration\n  triggers: TEditorTriggerConfiguration\n  logger: TLoggerConfiguration\n  penStyle: TStyle\n\n  constructor(configuration?: PartialDeep<InkEditorConfiguration>)\n  {\n    const { server, recognition } = new RecognizerHTTPV2Configuration(configuration)\n    this.server = server\n    this.recognition = recognition\n    this.rendering = mergeDeep({}, DefaultInkEditorConfiguration.rendering, configuration?.rendering)\n    this.recognition.text.guides.enable = this.rendering.guides.enable\n    if (this.rendering.guides.enable)\n    {\n      this.recognition.text.guides[\"line-gap-mm\"] = convertPixelToMillimeter(this.rendering.guides.gap)\n    }\n    this.grabber = mergeDeep({}, DefaultInkEditorConfiguration.grabber, configuration?.grabber)\n    this[\"undo-redo\"] = mergeDeep({}, DefaultInkEditorConfiguration[\"undo-redo\"], configuration?.[\"undo-redo\"])\n    this.triggers = mergeDeep({}, DefaultInkEditorConfiguration.triggers, configuration?.triggers)\n    this.logger = mergeDeep({}, DefaultInkEditorConfiguration.logger, configuration?.logger)\n    this.penStyle = mergeDeep({}, DefaultInkEditorConfiguration.penStyle, configuration?.penStyle)\n  }\n}\n","import { InkEditor } from \"../editor\";\nimport { PointerInfo } from \"../grabber\";\nimport { IModel } from \"../model\";\nimport { TStyle } from \"../style\";\nimport { IIStroke, SymbolType, TIISymbol, TPointer } from \"../symbol\";\nimport { DeferredPromise } from \"../utils\";\nimport { AbstractWriterManager } from \"./AbstractWriterManager\";\n\nexport class IWriterManager extends AbstractWriterManager {\n  editor: InkEditor\n  #exportTimer?: ReturnType<typeof setTimeout>\n\n  constructor(editor: InkEditor) {\n    super(editor)\n    this.editor = editor\n  }\n\n  get model(): IModel {\n    return this.editor.model\n  }\n\n  protected createCurrentSymbol(pointer: TPointer, style: TStyle, pointerType: string): TIISymbol {\n    this.model.currentStroke = new IIStroke(style, pointerType)\n    this.model.currentStroke.addPointer(pointer)\n    return this.model.currentStroke\n  }\n\n  protected updateCurrentSymbol(pointer: TPointer): IIStroke {\n    if (this.model.currentStroke?.type === SymbolType.Stroke) {\n      this.model.currentStroke.addPointer(pointer)\n    }\n    return this.model.currentStroke!\n  }\n\n  async end(info: PointerInfo): Promise<void> {\n    const localPointer = info.pointer\n    const localSymbol = this.updateCurrentSymbol(localPointer)\n    this.model.currentStroke = undefined\n    this.renderer.drawSymbol(localSymbol)\n    this.model.addStroke(localSymbol)\n    this.editor.history.push(this.model, { added: [localSymbol] })\n    const deferred = new DeferredPromise<void>()\n\n    if (this.editor.configuration.triggers.exportContent !== \"DEMAND\") {\n      clearTimeout(this.#exportTimer)\n      this.#exportTimer = setTimeout(async () => {\n        this.editor.export()\n      }, this.editor.configuration.triggers.exportContent === \"QUIET_PERIOD\" ? this.editor.configuration.triggers.exportContentDelay : 0)\n    } else {\n      deferred.resolve()\n    }\n    return deferred.promise\n\n  }\n}\n","import { EditorTool } from \"../Constants\"\nimport { PointerEventGrabber } from \"../grabber\"\nimport { IModel, TExport, TExportV2 } from \"../model\"\nimport { RecognizerHTTPV2 } from \"../recognizer\"\nimport { SVGRenderer } from \"../renderer\"\nimport { TStyle } from \"../style\"\nimport { IHistoryManager } from \"../history\"\nimport { PartialDeep } from \"../utils\"\nimport { AbstractEditor, EditorOptionsBase } from \"./AbstractEditor\"\nimport { InkEditorConfiguration, TInkEditorConfiguration } from \"./InkEditorConfiguration\"\nimport { IWriterManager } from \"../manager/IWriterManager\"\nimport { IDebugSVGManager, EraseManager } from \"../manager\"\n\n/**\n * @group Editor\n */\nexport type TInkEditorOptions = PartialDeep<EditorOptionsBase &\n{\n  configuration: TInkEditorConfiguration\n}> &\n{\n  override?: {\n    grabber?: PointerEventGrabber\n    recognizer?: RecognizerHTTPV2\n  }\n}\n\n/**\n * @group Editor\n */\nexport class InkEditor extends AbstractEditor\n{\n  #configuration: InkEditorConfiguration\n  #model: IModel\n  #penStyle: TStyle\n  renderer: SVGRenderer\n  recognizer: RecognizerHTTPV2\n  history: IHistoryManager\n  writer: IWriterManager\n  eraser: EraseManager\n  debugger: IDebugSVGManager\n  #tool: EditorTool = EditorTool.Write\n\n  constructor(rootElement: HTMLElement, options?: TInkEditorOptions)\n  {\n    super(rootElement, options)\n\n    this.#configuration = new InkEditorConfiguration(options?.configuration)\n\n    this.#penStyle = Object.assign({}, this.#configuration.penStyle)\n\n    if (options?.override?.recognizer) {\n      const CustomRecognizer = options.override.recognizer as unknown as typeof RecognizerHTTPV2\n      this.recognizer = new CustomRecognizer(this.#configuration)\n    }\n    else {\n      this.recognizer = new RecognizerHTTPV2(this.#configuration)\n    }\n    this.renderer = new SVGRenderer(this.#configuration.rendering)\n\n    this.#model = new IModel()\n    this.writer = new IWriterManager(this)\n    this.eraser = new EraseManager(this)\n    this.debugger = new IDebugSVGManager(this)\n    this.tool = EditorTool.Write\n    this.history = new IHistoryManager(this.#configuration[\"undo-redo\"], this.event)\n  }\n\n  get penStyle(): TStyle\n  {\n    return this.#penStyle\n  }\n  set penStyle(penStyle: PartialDeep<TStyle>)\n  {\n    this.logger.info(\"set penStyle\", { penStyle })\n    this.#penStyle = Object.assign({}, this.#penStyle, penStyle)\n  }\n\n  get initializationPromise(): Promise<void>\n  {\n    return Promise.resolve()\n  }\n\n  get tool(): EditorTool\n  {\n    return this.#tool\n  }\n  set tool(i: EditorTool)\n  {\n    this.#tool = i\n    this.writer.detach()\n    this.eraser.detach()\n\n    switch (this.tool) {\n      case EditorTool.Erase:\n        this.eraser.attach(this.layers.root)\n        this.layers.root.classList.remove(\"draw\")\n        this.layers.root.classList.add(\"erase\")\n        break\n      default:\n        this.writer.attach(this.layers.root)\n        this.layers.root.classList.add(\"draw\")\n        this.layers.root.classList.remove(\"erase\")\n        break\n    }\n\n  }\n\n  get model(): IModel\n  {\n    return this.#model\n  }\n\n  get configuration(): InkEditorConfiguration\n  {\n    return this.#configuration\n  }\n\n  async initialize(): Promise<void>\n  {\n    try {\n      this.logger.info(\"initialize\")\n      this.layers.render()\n      this.layers.showLoader()\n      this.tool = EditorTool.Write\n      this.renderer.init(this.layers.rendering)\n\n      const compStyles = window.getComputedStyle(this.layers.root)\n      this.model.width = Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.#configuration.rendering.minWidth)\n      this.model.height = Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.#configuration.rendering.minHeight)\n      this.model.rowHeight = this.configuration.rendering.guides.gap\n      this.history.init(this.model)\n\n      if (!this.recognizer.configuration.server.version) {\n        await this.loadInfo(this.configuration.server)\n        this.recognizer.configuration.server.version = this.info!.version\n      }\n    } catch (error) {\n      this.logger.error(\"initialize\", error)\n      this.layers.showMessageError(error as Error)\n      throw error\n    }\n    finally {\n      this.logger.debug(\"initialize\", \"finally\")\n      this.layers.hideLoader()\n      this.layers.updateState(true)\n    }\n  }\n\n  updateSymbolsStyle(symbolIds: string[], style: PartialDeep<TStyle>): void\n  {\n    this.logger.info(\"updateSymbolsStyle\", { symbolIds, style })\n    const symbolIdSet = new Set(symbolIds)\n    this.model.strokes.forEach(s =>\n    {\n      if (symbolIdSet.has(s.id)) {\n        s.style = Object.assign({}, s.style, style)\n        this.renderer.drawSymbol(s)\n        this.model.updateStroke(s)\n        s.modificationDate = Date.now()\n      }\n    })\n  }\n\n  async export(requestedMimeTypes?: string[]): Promise<TExportV2>\n  {\n    try {\n      this.logger.info(\"export\")\n      const currentModel = this.model.clone()\n\n      const exports = await this.recognizer.send(currentModel.strokes, requestedMimeTypes)\n      currentModel.mergeExport(exports)\n      if (this.model.modificationDate === currentModel.modificationDate) {\n        this.model.exports = currentModel.exports\n      }\n      this.history.updateModelStack(currentModel)\n      this.event.emitExported(this.model.exports || {})\n      if (this.debugger.recognitionBoxItemsVisibility) {\n        this.debugger.debugRecognitionBoxItems()\n      }\n      if (this.debugger.recognitionBoxVisibility) {\n        this.debugger.debugRecognitionBox()\n      }\n      return exports\n    } catch (error) {\n      this.logger.error(\"export\", error)\n      this.layers.showMessageError(error as Error)\n      this.event.emitError(error as Error)\n      throw error\n    }\n  }\n\n  async resize({ height, width }: { height?: number, width?: number } = {}): Promise<void>\n  {\n    this.logger.info(\"resize\", { height, width })\n    const compStyles = window.getComputedStyle(this.layers.root)\n    this.model.height = height || Math.max(parseInt(compStyles.height.replace(\"px\", \"\")), this.configuration.rendering.minHeight)\n    this.model.width = width || Math.max(parseInt(compStyles.width.replace(\"px\", \"\")), this.configuration.rendering.minWidth)\n    this.renderer.resize(this.model.height, this.model.width)\n    this.logger.debug(\"resize\", { model: this.model })\n    this.event.emitExported(this.model.exports || {})\n  }\n\n  async removeStrokes(strokeIds: string[]): Promise<void>\n  {\n    this.logger.info(\"removeStrokes\", { strokeIds })\n    const strokeIdSet = new Set(strokeIds)\n    const removedStrokes = this.model.strokes.filter(s => strokeIdSet.has(s.id))\n    if (removedStrokes.length === 0) {\n      this.logger.warn(\"removeStrokes\", \"No strokes found to remove\")\n      return\n    }\n    this.#model = this.model.clone()\n    removedStrokes.forEach(s => {\n      this.renderer.removeSymbol(s.id)\n      this.model.removeStroke(s.id)\n    })\n    this.history.push(this.#model, { removed: removedStrokes })\n    const exports = await this.recognizer.send(this.model.strokes)\n    this.model.mergeExport(exports)\n    this.history.updateModelStack(this.model)\n    this.event.emitExported(this.#model.exports as TExport)\n    this.logger.debug(\"removeStrokes\", { model: this.#model })\n  }\n\n  async undo(): Promise<void>\n  {\n    this.logger.info(\"undo\")\n    const previousStackItem = this.history.undo()\n    const modifications = previousStackItem.model.extractDifferenceStrokes(this.model)\n    this.#model = previousStackItem.model.clone()\n    modifications.removed.forEach(s => this.renderer.removeSymbol(s.id))\n    modifications.added.forEach(s => this.renderer.drawSymbol(s))\n    await this.export()\n  }\n\n  async redo(): Promise<void>\n  {\n    this.logger.info(\"redo\")\n    const previousStackItem = this.history.redo()\n    const modifications = previousStackItem.model.extractDifferenceStrokes(this.model)\n    this.#model = previousStackItem.model.clone()\n    modifications.removed.forEach(s => this.renderer.removeSymbol(s.id))\n    modifications.added.forEach(s => this.renderer.drawSymbol(s))\n    await this.export()\n  }\n\n  async clear(): Promise<void>\n  {\n    this.logger.info(\"clear\")\n    const erased = this.model.strokes\n    this.model.clear()\n    this.history.push(this.model, { removed: erased })\n    this.renderer.clear()\n    this.event.emitExported(this.#model.exports as TExport)\n  }\n\n  async destroy(): Promise<void>\n  {\n    this.logger.info(\"destroy\")\n    this.event.removeAllListeners()\n    this.writer.detach()\n    this.layers.destroy()\n    this.renderer.destroy()\n    return Promise.resolve()\n  }\n}\n","import { LoggerCategory, LoggerManager } from \"../logger\"\nimport { EditorType } from \"./AbstractEditor\"\nimport { InteractiveInkEditor, TInteractiveInkEditorOptions } from \"./InteractiveInkEditor\"\nimport { InkEditorDeprecated, TInkEditorDeprecatedOptions } from \"./InkEditorDeprecated\"\nimport { InteractiveInkSSREditor, TInteractiveInkSSREditorOptions } from \"./InteractiveInkSSREditor\"\nimport { InkEditor, TInkEditorOptions } from \"./InkEditor\"\n\n/**\n * @group Editor\n * @hideconstructor\n */\nexport class Editor\n{\n  protected static logger = LoggerManager.getLogger(LoggerCategory.EDITOR)\n  protected static instance: InteractiveInkEditor | InkEditorDeprecated | InteractiveInkSSREditor | InkEditor |undefined\n\n  static async load<T extends EditorType>(rootElement: HTMLElement, type: T, options: T extends \"INTERACTIVEINK\" ? TInteractiveInkEditorOptions : T extends \"INKV1\" ? TInkEditorDeprecatedOptions : TInteractiveInkSSREditorOptions extends \"INKV2\" ? TInkEditorOptions : TInteractiveInkSSREditorOptions):\n    Promise<T extends \"INTERACTIVEINK\" ? InteractiveInkEditor : T extends \"INKV1\" ? InkEditorDeprecated : InteractiveInkSSREditor extends \"INKV2\" ? InkEditor : InteractiveInkSSREditor>\n  {\n    Editor.logger.info(\"load\", { type, options })\n    if (!options) {\n        throw new Error(`Param 'options' missing`)\n    }\n    if (Editor.instance) {\n      await Editor.instance.destroy()\n    }\n\n    switch (type) {\n      case \"INTERACTIVEINK\":\n        Editor.instance = new InteractiveInkEditor(rootElement, options as TInteractiveInkEditorOptions)\n        break\n      case \"INKV1\":\n        Editor.instance = new InkEditorDeprecated(rootElement, options as TInkEditorDeprecatedOptions)\n        break\n      case \"INKV2\":\n        Editor.instance = new InkEditor(rootElement, options as TInkEditorOptions)\n        break;\n      // case \"INTERACTIVEINKSSR\":\n      default:\n        Editor.instance = new InteractiveInkSSREditor(rootElement, options as TInteractiveInkSSREditorOptions)\n        break\n    }\n\n    await Editor.instance.initialize()\n\n    return Editor.instance as T extends \"INTERACTIVEINK\" ? InteractiveInkEditor : T extends \"INKV1\" ? InkEditorDeprecated : InteractiveInkSSREditor extends \"INKV2\" ? InkEditor : InteractiveInkSSREditor\n  }\n\n  static getInstance(): InteractiveInkEditor | InkEditorDeprecated | InteractiveInkSSREditor | InkEditor | undefined\n  {\n    return Editor.instance\n  }\n\n}\n"],"names":["EditorTool","EditorWriteTool","SvgElementRole","ResizeDirection","SELECTION_MARGIN","DeferredPromise","promise","resolve","reject","isFullFilled","isPending","constructor","this","Promise","async","v","isValidNumber","x","isNaN","parseFloat","toString","isFinite","isBetween","val","min","max","computeAverage","arr","reduce","p","c","length","computeDistance","p1","p2","distance","Math","hypot","y","computeDistanceSquared","dx","dy","computeAngleAxeRadian","begin","end","atan2","createPointsOnSegment","spaceBetweenPoint","points","globalDistance","spaceWithP1","push","scalaire","v1","v2","computeNearestPointOnSegment","seg","vectP1P","vectP1P2","scalaireP1P_P1P2","scalaireP1P2_P1P2","t","isPointInsideBox","point","box","width","height","convertRadianToDegree","radian","PI","toFixed","convertDegreeToRadian","degree","computeRotatedPoint","center","cos","sin","computePointOnEllipse","radiusX","radiusY","phi","theta","cosPhi","sinPhi","M","abs","N","computeDistanceBetweenPointAndSegment","findIntersectionBetween2Segment","seg1","seg2","S1dx","S1dy","S2dx","S2dy","S1S2dx","S1S2dy","ua_t","ub_t","u_b","ua","ub","findIntersectBetweenSegmentAndCircle","r","result","fx","fy","a","b","cc","deter","pow","e","sqrt","u1","u2","computeAngleRadian","p1c","p2c","p1p2","acos","getClosestPoints","points1","points2","minDistanceSquared","Number","MAX_SAFE_INTEGER","_p1","_p2","dSquared","getClosestPoint","closest","index","i","isPointInsidePolygon","inside","j","isVersionSuperiorOrEqual","source","target","sourceParts","split","targetParts","computeHmac","message","applicationKey","hmacKey","enc","TextEncoder","messageEncoded","encode","keyEncoded","key","crypto","subtle","importKey","name","hash","signature","sign","buffer","Uint8Array","Array","prototype","map","call","padStart","join","MM_TO_PX_RATIO","PX_TO_MM_RATIO","convertMillimeterToPixel","mm","convertPixelToMillimeter","px","convertBoundingBoxMillimeterToPixel","createUUID","dt","Date","now","replace","random","floor","mergeDeep","sources","isObject","item","isArray","shift","Object","assign","concat","isDeepEqual","object1","object2","objKeys1","keys","objKeys2","value1","value2","isObjects","object","getAvailableFontList","configuration","server","scheme","host","recognition","lang","serverConfig","response","fetch","json","sort","getAvailableLanguageList","computeLinksPointers","angle","radius","computeMiddlePointer","point1","point2","getApiInfos","ok","version","gitCommit","nativeVersion","LoggerLevel","LoggerCategory","Logger","category","level","debug","functionName","data","DEBUG","dataLog","from","console","info","INFO","warn","WARN","error","LoggerManager","static","Map","getLogger","loggerMap","has","set","ERROR","get","setLoggerLevel","config","lc","DefaultLoggerConfiguration","EDITOR","RECOGNIZER","GRABBER","RENDERER","EDITOR_EVENT","MODEL","SYMBOL","SMARTGUIDE","GESTURE","STYLE","HISTORY","TRANSFORMER","CONVERTER","WRITE","SELECTION","SVGDEBUG","MENU","EditorEventName","EditorEvent","EventTarget","logger","abortController","element","super","AbortController","removeAllListeners","abort","emit","type","evt","CustomEvent","bubbles","composed","detail","undefined","dispatchEvent","emitSessionOpened","sessionId","SESSION_OPENED","addSessionOpenedListener","callback","addEventListener","signal","emitLoaded","LOADED","addLoadedListener","emitNotif","notif","NOTIF","addNotifListener","emitError","err","addErrorListener","emitExported","exports","EXPORTED","addExportedListener","emitChanged","undoRedoContext","CHANGED","canClear","empty","addChangedListener","emitIdle","idle","IDLE","addIdleListener","emitCleared","CLEARED","addClearedListener","emitConverted","CONVERTED","addConvertedListener","emitImported","IMPORTED","addImportedListener","emitSelected","symbols","SELECTED","addSelectedListener","emitToolChanged","mode","TOOL_CHANGED","addToolChangedListener","emitUIpdated","UI_UPDATED","addUIpdatedListener","emitSynchronized","SYNCHRONIZED","addSynchronizedListener","emitGestured","gesture","GESTURED","addGesturedListener","ExportType","JIIXELementType","JIIXNodeKind","JIIXEdgeKind","ExportV2Type","JIIXV2ShapeKind","EditorLayer","root","ui","rendering","onCloseModal","rootClassCss","classList","add","createLayerRender","createLayerUI","render","styleElement","document","createElement","appendChild","createTextNode","prepend","createLoader","loaderHTML","style","display","showLoader","loader","hideLoader","createMessageOverlay","overlay","closeMessageModal","modal","contains","hideMessageModal","text","innerText","remove","createMessageModal","closeBtn","bind","createMessage","showMessageInfo","setTimeout","timeout","showMessageError","createBusy","busy","createState","showState","state","hideState","updateState","destroy","lastChild","removeChild","AbstractEditor","layers","event","loggerConfiguration","rootElement","options","override","cssClass","editor","loggerConfig","loadInfo","Box","boundindBox","Error","createFromBoxes","boxes","minX","maxX","minY","maxY","createFromPoints","getCorners","getSide","getCenter","getSides","vertices","isContained","wrapper","containsPoint","child","overlaps","box1","box2","xMin","xMid","xMax","yMin","yMid","yMax","corners","side","snapPoints","boundaries","DefaultStyle","color","DefaultPenStyle","DefaultTheme","ink","module","o","n","l","m","d","defineProperty","configurable","enumerable","__esModule","default","hasOwnProperty","s","TypeError","value","Symbol","iterator","toJSON","u","forEach","trim","indexOf","substring","_trimSemiColon","toCSS","slice","parser","JsonCSS","StyleHelper","themeToCSS","themeToJSON","theme","penStyleToCSS","penStyle","css","penStyleToJSON","penStyleString","stringToJSON","JSONToString","entries","k","StyleManager","penStyleClasses","currentPenStyle","setTheme","setPenStyleClasses","setPenStyle","structuredClone","penStyleClass","DecoratorKind","SymbolType","EdgeKind","EdgeDecoration","ShapeKind","RecognizedKind","IIDecorator","id","kind","clone","MatrixTransform","xx","yx","xy","yy","tx","ty","identity","applyToPoint","mat","rotation","hypotAc","hypotBd","toCssString","matrix","invert","denom","multiply","translate","rotate","cosAngle","round","sinAngle","scale","IISymbolBase","creationTime","modificationDate","selected","deleting","transform","opacity","edges","isClosed","isIntersected","some","edge","OIEdgeBase","startDecoration","endDecoration","Edge","bounds","bb","e1","e2","isValidPoint","IIEdgeArc","startAngle","sweepAngle","_vertices","Arc","verticesId","computedVertices","nbVertices","angleStep","endAngle","at","create","partial","arc","IIEdgeLine","start","Line","line","IIEdgePolyLine","PolyEdge","polyline","OIShapeBase","Shape","IIShapeCircle","_bounds","Circle","computedBondingBox","firstPoint","perimeter","nbPoint","rad","boundingBox","createBetweenPoints","origin","updateBetweenPoints","circle","IIShapeEllipse","orientation","Ellipse","ellipse","IIShapePolygon","Polygon","polygon","createTriangleBetweenPoints","updateTriangleBetweenPoints","poly","createParallelogramBetweenPoints","updateParallelogramBetweenPoints","createRectangleBetweenPoints","updateRectangleBetweenPoints","createRhombusBetweenPoints","updateRhombusBetweenPoints","IIStroke","pointerType","decorators","pointers","Stroke","strokeToSplit","before","after","substract","stroke","partStroke","lastPointBeforeStroke","closestLastPointBeforeStroke","newStrokes","strokeAfter","firstPointAfterStroke","closestFirstPointStrokeAfter","computePressure","ratio","pressure","filterPointByAcquisitionDelta","lastPointer","delta","addPointer","pointer","formatToSend","errors","flag","pp","pIndex","convertPartialStrokesToOIStrokes","strokes","IIRecognizedBase","Recognized","flatMap","updateChildrenStyle","containsStroke","strokeId","removeStrokes","strokeIds","strokeRemoved","filter","includes","IIRecognizedArc","ws","IIRecognizedCircle","IIRecognizedEllipse","IIRecognizedLine","IIRecognizedPolyLine","IIRecognizedPolygon","Polygone","IIRecognizedText","baseline","xHeight","label","lines","Text","IISymbolGroup","children","Group","chars","containsSymbol","containsOnlyStroke","extractText","extractStrokes","removeChilds","symbolIds","group","every","texts","symbolId","symbol","s1","IIText","offsetY","getCharCorners","char","boxBox","updateChildrenFont","fontSize","fontWeight","getCharsOverlaps","charCorners","fill","IIEraser","Eraser","convertPartialStrokesToStrokes","ji","Model","positions","currentSymbol","converts","rowHeight","creationDate","lastSentPosition","lastReceivedPosition","getStrokeFromPoint","_strokeList","strokePointer","addPoint","addStroke","updateStroke","updatedStroke","strokeIndex","findIndex","splice","removeStroke","removeStrokesFromPoint","strokeToRemove","extractUnsentStrokes","initCurrentStroke","dpi","pxWidth","appendToCurrentStroke","endCurrentStroke","updatePositionSent","position","updatePositionReceived","mergeExport","mergeConvert","clonedModel","clear","IIModel","symbolsMap","syncMap","size","symbolsSelected","symbolsToDelete","selectSymbol","find","unselectSymbol","resetSelection","getRootSymbol","directMatch","getSymbolRowIndex","getSymbolsByRowOrdered","rowsMap","rowIndex","row","rows","s2","r1","r2","roundToLineGuide","isSymbolAbove","isSymbolInRow","isSymbolBelow","getFirstSymbol","previous","current","getLastSymbol","addSymbol","updateSymbol","updatedSymbol","sIndex","replaceSymbol","delete","changeOrderSymbol","fromIndex","toIndex","sym","removeSymbol","symbolIndex","extractDifferenceSymbols","model","modelKeys","Set","thisKeys","added","removed","IModel","currentStroke","strokesToDelete","extractDifferenceStrokes","modelStrokeKeys","thisStrokeKeys","DefaultServerHTTPConfiguration","DefaultServerWebsocketConfiguration","websocket","pingEnabled","pingDelay","maxPingLostCount","autoReconnect","maxRetryCount","fileChunkSize","DefaultEraserConfiguration","DefaultDiagramConvertConfiguration","types","DefaultDiagramConfiguration","convert","eraser","mimeTypes","DefaultJiixConfiguration","ids","words","DefaultExportConfiguration","jiix","DefaultMarginConfiguration","top","left","right","bottom","DefaultSolverConfiguration","enable","DefaultMathUndoRedoConfiguration","DefaultMathConfiguration","solver","margin","DefaultRawContentConfiguration","classification","DefaultDebugConfiguration","DefaultRecognitionRendererConfiguration","DefaultTextGuidesConfiguration","DefaultTextConfiguration","guides","DefaultTextGuidesConfigurationV2","DefaultTexConfigurationV2","DefaultConvertionConfiguration","force","DefaultShapeConvertConfiguration","DefaultShapeBeautificationConfiguration","DefaultShapeConfiguration","beautification","DefaultMathV2Configuration","DefaultRawContentV2Configuration","RecognizerEventName","RecognizerError","RecognizerEvent","emitStartInitialization","START_INITIALIZATION","addStartInitialization","emitEndtInitialization","END_INITIALIZATION","addEndInitialization","emitContentChanged","CONTENT_CHANGED","addContentChangedListener","emitConnectionClose","code","CONNECTION_CLOSE","addConnectionCloseListener","emitSVGPatch","svgPatch","SVG_PATCH","addSVGPatchListener","DefaulRecognitionHTTPV1ConfigurationConfiguration","export","math","diagram","renderer","DefaultRecognizerHTTPV1Configuration","RecognizerHTTPV1Configuration","RecognizerHTTPV1","url","postConfig","buildData","strokeGroupByPenStyle","groupIndex","sg","isPenStyleEqual","ps1","ps2","strokeGroupsToSend","newGroup","JSON","stringify","contentType","charAt","toUpperCase","toLowerCase","xDPI","yDPI","strokeGroups","post","mimeType","headers","Headers","append","hmac","reqInit","method","body","credentials","request","Request","blob","catch","tryFetch","then","res","UNKNOW","WRONG_CREDENTIALS","CANT_ESTABLISH","getMimeTypes","requestedMimeTypes","conversionState","myModel","dataToConcert","promises","mt","all","String","mimeTypesRequiringExport","resize","DefaultRecognizerHTTPV2RecognitionConfiguration","shape","DefaultRecognizerHTTPV2Configuration","RecognizerHTTPV2Configuration","RecognizerHTTPV2","formatStrokes","scaleX","scaleY","send","TRecognizerWebSocketMessageType","DefaultRecognitionWebSocketConfiguration","gestures","ignoreGestureStrokes","DefaultRecognizerWebSocketConfiguration","RecognizerWebSocketConfiguration","RecognizerWebSocket","socket","pingWorker","pingCount","reconnectionCount","currentPartId","currentErrorCode","addStrokeDeferred","contextlessGestureDeferred","transformStrokeDeferred","eraseStrokeDeferred","replaceStrokeDeferred","exportDeferredMap","closeDeferred","waitForIdleDeferred","undoDeferred","redoDeferred","clearDeferred","initialized","readyState","OPEN","rejectDeferredPending","values","resetAllDeferred","clearSocketListener","removeEventListener","openCallback","closeCallback","messageCallback","reason","GOING_AWAY","PROTOCOL_ERROR","UNSUPPORTED_DATA","ABNORMAL_CLOSURE","INVALID_FRAME_PAYLOAD","POLICY_VIOLATION","MESSAGE_TOO_BIG","INTERNAL_ERROR","SERVICE_RESTART","TRY_AGAIN","BAD_GATEWAY","TLS_HANDSHAKE","terminate","manageHMACChallenge","hmacChallengeMessage","hmacChallenge","initPing","PingWorker","postMessage","onmessage","close","manageAuthenticated","pixelTomm","iinkSessionId","manageSessionDescriptionMessage","sessionDescriptionMessage","manageNewPartMessage","newPartMessage","managePartChangeMessage","partChangeMessage","partId","manageContentChangedMessage","contentChangeMessage","canRedo","canUndo","manageExportMessage","exportMessage","parse","manageWaitForIdle","manageErrorMessage","errorMessage","NO_ACTIVITY","TOO_OLD","NO_SESSION_FOUND","manageGestureDetected","gestureMessage","manageContextlessGesture","websocketMessage","Pong","HMAC_Challenge","Authenticated","SessionDescription","NewPart","PartChanged","ContentChanged","Exported","GestureDetected","ContextlessGesture","Idle","newSession","init","WebSocket","CONNECTING","CLOSING","CLOSED","waitForIdle","buildAddStrokesMessage","processGestures","addStrokes","buildReplaceStrokesMessage","oldStrokeIds","replaceStrokes","buildTransformTranslateMessage","transformationType","transformTranslate","buildTransformRotateMessage","x0","y0","transformRotate","buildTransformScaleMessage","transformScale","buildTransformMatrixMessage","transformMatrix","buildEraseStrokesMessage","eraseStrokes","recognizeGesture","buildUndoRedoChanges","changes","changesMessages","erased","replaced","oldStrokes","tr","undo","actions","redo","DefaultRecognizerWebSocketSSRRecognitionConfiguration","DefaultRecognizerWebSocketSSRConfiguration","RecognizerWebSocketSSRConfiguration","RecognizerWebSocketSSR","viewSizeHeight","viewSizeWidth","connected","ackDeferred","exportDeferred","convertDeferred","importDeferred","resizeDeferred","importPointEventsDeferred","toLocaleLowerCase","infinitePing","params","xDpi","yDpi","manageAckMessage","manageContentPackageDescriptionMessage","manageContentChangeMessage","context","stackIndex","undoStackIndex","possibleUndoCount","manageSVGPatchMessage","svgPatchMessage","styleClasses","localModel","import","chunkSize","importFileId","readBlob","fileReader","FileReader","onloadend","ev","onerror","readAsText","importFileMessage","blobPart","fileChuckMessage","lastChunk","importPointEvents","events","myExportConverted","undoExports","redoExports","clearExports","CanvasRendererShape","table","returnedAngle","drawEllipseArc","context2D","shapeEllipse","centerPoint","maxRadius","minRadius","z1","z2","z3","z4","boundariesPoints","save","beginPath","alpha","cosAlpha","sinAlpha","moveTo","lineTo","restore","drawLine","drawArrowHead","headPoint","beta","fillStyle","strokeStyle","drawShapeEllipse","beginDecoration","beginTangentAngle","endTangentAngle","drawShapeLine","shapeLine","lastPoint","draw","lineWidth","CanvasRendererStroke","renderArc","context2d","renderLine","linkPoints1","linkPoints2","renderFinal","linkPoints","newAngle","renderQuadratic","ctrl","linkPoints3","quadraticCurveTo","NUMBER_POINTS","NUMBER_QUADRATICS","secondPoint","beginLine","endLine","beginFinal","endFinal","closePath","CanvasRendererText","string","textLine","drawUnderline","textUnderline","underline","topLeftPoint","firstCharacter","lastCharacter","drawText","font","textHeight","textAlign","justificationType","textBaseline","fillText","drawTextLine","underlineList","CanvasRenderer","strokeRenderer","shapeRenderer","textRenderer","createCanvas","canvas","resizeContent","pixelRatio","window","devicePixelRatio","renderingCanvas","capturingCanvas","domElement","parentNode","minWidth","clientWidth","minHeight","clientHeight","getContext","drawSymbol","guide","setAttribute","backgroundSize","parent","renderingCanvasContext","capturingCanvasContext","drawModel","clearRect","drawPendingStroke","innerHTML","SVGRendererConst","arrowHeadStartMarker","arrowHeadEndMaker","selectionFilterId","removalFilterId","crossMarker","noSelection","XMLNS","SVGBuilder","createLayer","attrs","svgEl","createElementNS","createFilter","createDefs","createMarker","marker","createComponentTransfert","createDropShadow","deviation","shadow","createTransfertFunctionTable","feFunc","createGroup","groupEl","createLine","lineEl","createCircle","circleEl","createPath","pathEl","createPolygon","polygonEl","createRect","rectEl","createTSpan","tSpanEl","textContent","createForeignObject","node","objEl","createText","textEl","SVGRendererEdgeUtil","getLinePath","getPolyLinePath","path","getArcPath","getSVGPath","getSVGElement","pathAttrs","Arrow","SVGRendererEraserUtil","startPath","strokeWith","acc","shadowBlur","SVGRendererDecoratorUtil","decorator","Highlight","Surround","Strikethrough","Underline","SVGRendererShapeUtil","getPolygonePath","getCirclePath","getEllipsePath","SVGRendererStrokeUtil","getFinalPath","parts","getQuadraticPath","central","STROKE_LENGTH","STROKE_WIDTH","NB_QUADRATICS","beforeLastPoint","strokeGroup","strokeAttrs","deco","SVGRendererTextUtil","textGroup","textElement","SVGRendererRecognizedUtil","recognizedSymbol","SVGRendererGroupUtil","getChildElement","symbolGroup","SVGRenderer","groupGuidesId","layer","definitionGroup","verticalGuides","horizontalGuides","initLayer","setProperty","createSVGTools","defs","REFX","SIZE","REFY","arrowHeadMarkerAttrs","markerWidth","markerHeight","refX","refY","arrowHeadStart","orient","arrowHeadEnd","crossMarkerAttrs","viewBox","cross","createFilters","filtersGroup","removalFilter","filterUnits","bfeComponentTransfer","bfeFuncA","selectionFilter","drawGuides","getAttribute","offSet","gap","subOffSet","role","Guide","guidesGroup","svgLine","subY","subX","svgPoint","removeGuides","querySelector","oncontextmenu","buildElementFromSymbol","prependElement","el","symbolToMove","moveEl","insertAdjacentElement","nextElementSibling","previousElementSibling","appendElement","removeElement","oldStroke","oldNode","replaceWith","elements","drawCircle","drawRect","drawConnectionBetweenBox","attrsLine","getElementById","getElements","tagName","query","querySelectorAll","clearElements","firstChild","SVGStroker","buildSVGPath","drawStroke","svgElement","svgPathElement","svgPath","InteractiveInkSSRSVGRenderer","stroker","replaceAll","layerName","update","oldLayer","insertAdjacentHTML","svg","pendingStrokesGroup","replaceElement","elementToRemove","parentSelector","parentId","insertBefore","refId","selector","removeAttribute","updateLayer","updatesLayer","updates","clearPendingStroke","pendingStrokeGroup","clearErasingStrokes","erasingStroke","rect","getBoundingClientRect","svgList","DefaultGuidesConfiguration","DefaultRendererConfiguration","DefaultIIRendererConfiguration","DefaultListenerConfiguration","capture","passive","DefaultGrabberConfiguration","listenerOptions","xyFloatPrecision","timestampFloatPrecision","delayLongTouch","PointerEventGrabber","layerCapture","capturing","prevent","preventDefault","onPointerDown","onPointerMove","onPointerUp","onContextMenu","roundFloat","oneFloat","requestedFloatPrecision","floatPrecision","extractPointer","clientX","clientY","changedTouches","clientLeft","scrollLeft","clientTop","scrollTop","getPointerInfos","isPrimary","button","buttons","pointerDownHandler","pointerInfo","pointerMoveHandler","pointerUpHandler","pointerOutHandler","contextMenuHandler","stopPointerEvent","attach","detach","removeProperty","AbstractWriterManager","grabber","detectGesture","continue","localPointer","createCurrentSymbol","updateCurrentSymbol","IIConversionManager","fontStyle","computeFontSize","buildChar","grid","weight","buildText","word","charSymbols","charFontSize","charStrokes","items","hightlight","strikethrough","surround","convertText","onlyText","jiixWords","jiixChars","textFontSize","isNewLine","currentY","leftX","currentX","texter","getSpaceWidth","wordStrokes","wordSymbol","nbRow","setBounds","buildCircle","cx","cy","buildEllipse","rx","ry","buildRectangle","rectangle","buildPolygon","buildRhombus","buildTriangle","buildParallelogram","convertNode","associatedStroke","uniqStrokes","Rectangle","Triangle","Parallelogram","Rhombus","buildLine","x1","y1","x2","y2","p1Decoration","p2Decoration","buildPolyEdge","unshift","buildArc","convertEdge","apply","removeSelectedGroup","strokesToConvert","extractStrokesFromSymbols","conversionResults","conversion","addSymbols","cs","removeSymbols","history","IIResizeManager","interactElementsGroup","direction","transformOrigin","keepRatio","applyToStroke","applyToShape","applyToEdge","applyOnText","updateBounds","applyOnGroup","applyToSymbol","applyOnRecognizedSymbol","setTransformOrigin","originX","originY","scaleElement","sx","sy","InteractElementsGroup","localPoint","horizontalResize","verticalResize","snaps","snapResize","deltaX","deltaY","clearSnapToElementLines","oldSymbols","strokesFromSymbols","recognizer","svgDebugger","IIRotationManager","angleRad","strokeText","rotateElement","angleDegree","snapRotation","IISelectionManager","selectingId","startSelectionPoint","endSelectionPoint","selectedGroup","rotator","translator","resizer","selectionBox","drawSelectingRect","clearSelectingRect","getPoint","createTranslateRect","Translate","boxWithMarge","translateEl","handler","stopPropagation","endHandler","cursor","resetSelectedGroup","hideInteractElements","createRotateGroup","Rotate","attrs1","attrs2","attrs3","createResizeGroup","Resize","P_NW","P_NE","P_SE","P_SW","bindEl","def","lineResize","cornerResize","createInteractElementsGroup","symbolElementMap","surroundGroup","SURROUND_ATTRS","createEdgeResizeGroup","pointIndex","pointEl","createInteractEdgeGroup","drawSelectedGroup","groupBox","getBBox","menu","show","hide","updatedSymbols","found","currentEl","symbolTypesAllowed","parentElement","unselectAll","updateLayerUI","IITextManager","drawSymbolHidden","setCharsBounds","textGroupEl","getNumberOfChars","ext","getExtentOfChar","getElementBoundingBox","markers","clipped","getBoundingBox","charSymbol","textSymbol","moveTextAfter","textsAfter","IITranslateManager","addToHistory","translateElement","nudge","snapTranslate","IIWriterManager","tool","Pencil","currentSymbolOrigin","wt","gestureManager","needContextLessGesture","strokeBoundsWithMargin","getSymbolsBounds","DoubleArrow","updateCurrentSymbolShape","updateCurrentSymbolEdge","interactWithBackend","localStroke","gestureFromContextLess","getGestureFromContextLess","pop","localSymbol","IIDebugSVGManager","snapPointsVisibility","verticesVisibility","boundingBoxVisibility","recognitionBoxVisibility","recognitionItemBoxVisibility","debugSnapPoints","debugVertices","showBoundingBox","hideBoundingBox","debugRecognitionBox","debugRecognitionItemBox","showSnapPoints","hideSnapPoints","showVertices","hideVertices","drawBoundingBox","symbolAttrs","charAttrs","symEl","ca","sa","debugBoundingBox","drawRecognitionBox","infos","COLOR","recognitionGroup","infosGroup","infoX","infoY","TEXT_HEIGHT","w","infosGroupBox","rectBox","rectTranslate","newRectBox","showRecognitionBox","hideProperties","candidates","inf","clearRecognitionBox","drawRecognitionItemBox","recognitionItemGroup","charX","charY","charsGroup","charsGroupBox","showRecognitionItemBox","clearRecognitionItemBox","IIMoveManager","IDebugSVGManager","recognitionBoxItemsVisibility","recognitionBoxDrawing","recognitionBoxItemsDrawing","debugRecognitionBoxItems","debugAttr","rectAttr","buildInfos","obj","currentPath","localPath","associatedStrokes","range","to","h","showRecognitionBoxItems","spans","clearRecognitionBoxItems","EraseManager","currentEraser","lastSeg","InteractiveInkEditor","getInitialHistoryContext","HistoryManager","stack","updateContext","maxStackSize","updateStack","previousModel","nextModel","IIHistoryManager","isChangesEmpty","updated","order","ungroup","stackIdx","reverseChanges","reversedChanges","newSymbols","currentStackItem","previousStackItem","nextStackItem","IHistoryManager","updateModelStack","DefaultHistoryConfiguration","createMenuButton","onClick","additionalClasses","btn","createMenuButtonWithText","IIMenu","thicknessList","fontSizeList","fontWeightList","colors","createWrapCollapsible","title","head","ArrowDown","content","toggle","createMenuItemBoolean","labelEl","checkbox","disabled","initValue","indeterminate","checked","createMenuItemSelect","select","opt","Option","createMenuItemButton","icon","createMenuItemButtonList","createMenuItemColorList","createColorList","list","colorEl","createMenuItem","SurroundAction","StrikeThroughAction","InsertAction","DefaultGestureConfiguration","Select","strikeThrough","Draw","insert","LineBreak","IIGestureManager","insertAction","surroundAction","strikeThroughAction","gestureAction","strokeSpaceWidth","applySurroundGesture","gestureStroke","symbolIdSet","DECORABLE_TYPES","symWithDec","highlight","computeScratchOnStrokes","partPointersToRemove","subStrokes","ss","fullStrokeId","strokePartToErase","computeScratchOnText","charsToRemove","cIndex","c1","computeScratchOnSymbol","strokesScratchedResult","childrenNotTouch","results","strokesToConserve","symbolsGroup","textScratchedResult","applyScratch","symbolsToUpdate","symbolsToErase","symbolsToReplace","updateSymbols","replaceSymbols","applyJoinGesture","symbolsAbove","symbolsRow","symbolsBeforeGestureInRow","symbolsOnGestureInRow","symbolsAfterGestureInRow","symbolsBelow","symbolToJoin","childBefore","childAfter","lastSymbBefore","firstSymbolAfter","lastXBefore","firstXAfter","translateX","lastSymbBeforeClone","firstSymbolAfterClone","symbolsToGroup","strokeTexts","d1","rest","lastSymbolBeforeGesture","firstSymbolAfterGesture","symbolInNextRow","symbolsAfterNextRow","lastSymbolAbove","createStrokesFromGestureSubStroke","strokeOrigin","subStroke","computeSplitStroke","computeSplitStrokeInGroup","newGroups","symbolsBefore","symbolsAfter","strokeIdToSplit","gs","computeChangesOnSplitStroke","symbolToSplit","strokesToSplit","strokesBefore","strokesAfter","computeChangesOnSplitGroup","groupToSplit","groupSymbolsBefore","groupsSymbolsAfter","groupBefore","grouAfter","computeChangesOnSplitStrokeText","strokeTextToSplit","strokeTextBefore","strokeTextAfter","computeChangesOnSplitText","textToSplit","charsBefore","charsAfter","newTexts","textBefore","pointAfter","textAfter","applyInsertGesture","Insert","applyUnderlineGesture","applyStrikeThroughGesture","Erase","updateSymbolsStyle","synchronizeStrokesWithJIIX","gestureType","SURROUND_SELECT_TYPES","gestureStrokeId","strokeAfterIds","strokeBeforeIds","symbolsToUnderline","TEXT_STROKE_GROUP_TYPES","symbolsToStrikeThrough","ERASE_OVERLAY_TYPES","ERASE_CONTAIN_TYPES","IIMenuSub","param","trigger","menuTitle","menuTitleElement","subMenu","open","unwrap","wrap","IIMenuAction","menuLanguage","menuClear","menuUndo","menuRedo","menuConvert","guideGaps","isMobile","createMenuClear","createMenuLanguage","triggerBtn","languages","changeLanguage","createMenuUndo","createMenuRedo","createMenuConvert","createMenuGesture","subMenuWrapper","surroundActionValues","strikeThroughActionValues","splitActionValues","writer","Write","createMenuGuide","renderingConfiguration","createMenuSnap","createMenuDebug","menuItems","createMenuExport","downloadAsJson","downloadAsSVG","downloadAsPNG","readFileAsText","file","reader","onload","createMenuImport","importInput","accept","multiple","importBtn","files","fileString","createSymbols","closeAllSubMenu","action","menuTrigger","visibility","IIMenuTool","writeBtn","menuSelect","menuMove","menuErase","menuShape","subMenuShape","menuEdge","subMenuEdge","createMenuWrite","createMenuMove","Move","createMenuSelect","createMenuErase","createShapeSubMenu","subMenuContent","nextSibling","createMenuShape","rectangleIcon","triangle","rhombus","createEdgeSubMenu","square","createMenuEdge","lineIcon","arrow","doubleArrow","IIMenuStyle","menuColorStroke","menuColorFill","menuThickness","menuFontSize","menuFontWeight","menuStrokeOpacity","writeShape","createMenuStroke","symbolsStyles","st","menuColorStrokeDef","menuColor","createMenuColorFill","createMenuThickness","createMenuFontSize","textSymbols","updateTextFontStyle","createMenuFontWeight","createMenuOpacity","currentOpacity","input","output","shapeSelected","IIMenuContext","editMenu","editInput","editSaveBtn","reorderMenu","decoratorMenu","menuExport","duplicateBtn","groupBtn","convertBtn","removeBtn","haveSymbolsSelected","symbolsDecorable","showDecorator","createMenuEdit","firstChar","createMenuDuplicate","symbolsToDuplicate","updateDeepIdInGroup","gr","duplicatedSymbols","createMenuGroup","ungroupSymbol","groupSymbols","convertSymbols","createMenuRemove","createMenuReorder","changeOrderSymbols","reverse","createDecoratorSubMenu","labelEL","decoIndex","_c","createMenuDecorator","createMenuSelectAll","selectAll","updateDecoratorSubMenu","decos","btnToActivate","updateGroupMenu","DefaultMenuConfiguration","IIMenuManager","custom","CustomMenuStyle","CustomMenuTool","CustomMenuAction","DefaultSnapConfiguration","SnapConfiguration","IISnapManager","selectionSnapPoints","otherSnapPoints","selectSymbolIds","snapThreshold","getNearestVerticalGuide","prev","curr","getNearestHorizontalGuide","getGuidePointToSnap","drawSnapToElementLines","getSnapLinesInfos","sourcePoints","targetPoints","Infinity","verticales","horizontales","horizontal","vertical","snapLines","snapLinesInfos","selectionSymbolPoints","lastDeltaX","lastDeltaY","gridPoint","DefaultInteractiveInkEditorConfiguration","snap","InteractiveInkEditorConfiguration","layerUITimer","recognizeStrokeTimer","converter","move","CustomRecognizer","manageError","onContentChanged","updateLayerState","initializationPromise","setCursorStyle","clearTimeout","initialize","compStyles","getComputedStyle","parseInt","buildShape","partialShape","buildEdge","partialEdge","buildRecognized","partialSymbol","buildGroup","partialGroup","buildStroke","buildStrokeText","buildSymbol","createSymbol","partialSymbols","updateTextBounds","symList","lastWidth","textIds","symbolsTranslated","textChildren","symToReplace","getSymbolsAndStrokesAssociatedFromJIIXStrokeItems","strokeIdsUsed","symIdx","jiixAssociation","symAsso","recognizedText","wd","Node","symbolRecognized","groupStrokeIds","symbolsToRemove","strokesIds","partialStrokes","triggerDownload","fileName","urlData","downloadAnchorNode","click","buildBlobFromSymbols","svgNode","cloneNode","svgString","XMLSerializer","serializeToString","Blob","getExportName","extension","year","month","day","hour","minute","second","toLocaleDateString","navigator","language","selection","svgBlob","URL","createObjectURL","image","Image","src","drawImage","revokeObjectURL","imgURI","toDataURL","symbolsToExport","dataStr","encodeURIComponent","extractTextsFromSymbols","extractBackendChanges","backendChanges","modifications","actionsToBackend","DefaulTEditorTriggerConfiguration","exportContent","exportContentDelay","resizeTriggerDelay","DefaultInkEditorDeprecatedConfiguration","triggers","InkEditorDeprecatedConfiguration","InkEditorDeprecated","resizeTimer","exportTimer","styleManager","CustomGrabber","drawCurrentStroke","updateModelRendering","deferred","currentModel","newModel","deferredResize","resizeModel","InteractiveInkSSRSmartGuide","uuid","smartGuideElement","wrapperElement","prompterContainerElement","prompterTextElement","ellipsisElement","tagElement","candidatesElement","menuElement","convertElement","copyElement","deleteElement","isMenuOpen","lastWord","wordToChange","createRootElement","createWrapperElement","createPrompterContainerElement","createPrompterTextElement","createEllipsisElement","createTagElement","createCandidatesElement","createMoreMenuElement","createConvertElement","createCopyElement","createDeleteElement","addListeners","showCandidates","wordId","hideCandidates","openMenu","closeMenu","onClickEllipsis","onClickConvert","createTextAreaElement","isRTL","documentElement","textArea","yPosition","pageYOffset","selectText","userAgent","match","createRange","selectNodeContents","getSelection","removeAllRanges","addRange","setSelectionRange","onClickCopy","fakeEl","execCommand","onClickDelete","onClickCandidate","candidate","JIIX","onClickPrompter","onClickOutSide","removeListeners","marginLeft","marginRight","createWordSpan","span","myFragment","createDocumentFragment","offsetLeft","populatePrompter","DefaultInteractiveInkSSREditorConfiguration","smartGuide","InteractiveInkSSREditorConfiguration","InteractiveInkSSREditor","penClass","syncStyle","onExport","jjix","synchronizeModelWithBackend","onSVGPatch","initializeSmartGuide","onError","unsentStrokes","blobToImport","strokesToImport","str","exportPoints","DefaultInkEditorConfiguration","InkEditorConfiguration","IWriterManager","InkEditor","debugger","strokeIdSet","removedStrokes","Editor","load","instance","getInstance"],"mappings":"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","x_google_ignoreList":[25]}