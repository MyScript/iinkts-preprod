var OU=Object.defineProperty;var MT=r=>{throw TypeError(r)};var LU=(r,e,t)=>e in r?OU(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var NU=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var k=(r,e,t)=>LU(r,typeof e!="symbol"?e+"":e,t),_x=(r,e,t)=>e.has(r)||MT("Cannot "+t);var j=(r,e,t)=>(_x(r,e,"read from private field"),t?t.call(r):e.get(r)),De=(r,e,t)=>e.has(r)?MT("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),Je=(r,e,t,n)=>(_x(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),an=(r,e,t)=>(_x(r,e,"access private method"),t);var Ige=NU((ime,jv)=>{function FU(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const s in n)if(s!=="default"&&!(s in r)){const o=Object.getOwnPropertyDescriptor(n,s);o&&Object.defineProperty(r,s,o.get?o:{enumerable:!0,get:()=>n[s]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();var $o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ec(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Tx={exports:{}},Vp={},Mx={exports:{}},Ft={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var AT;function zU(){if(AT)return Ft;AT=1;var r=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),i=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),p=Symbol.iterator;function f(q){return q===null||typeof q!="object"?null:(q=p&&q[p]||q["@@iterator"],typeof q=="function"?q:null)}var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,b={};function S(q,se,xe){this.props=q,this.context=se,this.refs=b,this.updater=xe||m}S.prototype.isReactComponent={},S.prototype.setState=function(q,se){if(typeof q!="object"&&typeof q!="function"&&q!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,q,se,"setState")},S.prototype.forceUpdate=function(q){this.updater.enqueueForceUpdate(this,q,"forceUpdate")};function C(){}C.prototype=S.prototype;function E(q,se,xe){this.props=q,this.context=se,this.refs=b,this.updater=xe||m}var T=E.prototype=new C;T.constructor=E,v(T,S.prototype),T.isPureReactComponent=!0;var w=Array.isArray,M=Object.prototype.hasOwnProperty,R={current:null},D={key:!0,ref:!0,__self:!0,__source:!0};function N(q,se,xe){var Oe,Ee={},Ue=null,Be=null;if(se!=null)for(Oe in se.ref!==void 0&&(Be=se.ref),se.key!==void 0&&(Ue=""+se.key),se)M.call(se,Oe)&&!D.hasOwnProperty(Oe)&&(Ee[Oe]=se[Oe]);var Te=arguments.length-2;if(Te===1)Ee.children=xe;else if(1<Te){for(var Le=Array(Te),Xe=0;Xe<Te;Xe++)Le[Xe]=arguments[Xe+2];Ee.children=Le}if(q&&q.defaultProps)for(Oe in Te=q.defaultProps,Te)Ee[Oe]===void 0&&(Ee[Oe]=Te[Oe]);return{$$typeof:r,type:q,key:Ue,ref:Be,props:Ee,_owner:R.current}}function z(q,se){return{$$typeof:r,type:q.type,key:se,ref:q.ref,props:q.props,_owner:q._owner}}function L(q){return typeof q=="object"&&q!==null&&q.$$typeof===r}function B(q){var se={"=":"=0",":":"=2"};return"$"+q.replace(/[=:]/g,function(xe){return se[xe]})}var K=/\/+/g;function O(q,se){return typeof q=="object"&&q!==null&&q.key!=null?B(""+q.key):se.toString(36)}function U(q,se,xe,Oe,Ee){var Ue=typeof q;(Ue==="undefined"||Ue==="boolean")&&(q=null);var Be=!1;if(q===null)Be=!0;else switch(Ue){case"string":case"number":Be=!0;break;case"object":switch(q.$$typeof){case r:case e:Be=!0}}if(Be)return Be=q,Ee=Ee(Be),q=Oe===""?"."+O(Be,0):Oe,w(Ee)?(xe="",q!=null&&(xe=q.replace(K,"$&/")+"/"),U(Ee,se,xe,"",function(Xe){return Xe})):Ee!=null&&(L(Ee)&&(Ee=z(Ee,xe+(!Ee.key||Be&&Be.key===Ee.key?"":(""+Ee.key).replace(K,"$&/")+"/")+q)),se.push(Ee)),1;if(Be=0,Oe=Oe===""?".":Oe+":",w(q))for(var Te=0;Te<q.length;Te++){Ue=q[Te];var Le=Oe+O(Ue,Te);Be+=U(Ue,se,xe,Le,Ee)}else if(Le=f(q),typeof Le=="function")for(q=Le.call(q),Te=0;!(Ue=q.next()).done;)Ue=Ue.value,Le=Oe+O(Ue,Te++),Be+=U(Ue,se,xe,Le,Ee);else if(Ue==="object")throw se=String(q),Error("Objects are not valid as a React child (found: "+(se==="[object Object]"?"object with keys {"+Object.keys(q).join(", ")+"}":se)+"). If you meant to render a collection of children, use an array instead.");return Be}function X(q,se,xe){if(q==null)return q;var Oe=[],Ee=0;return U(q,Oe,"","",function(Ue){return se.call(xe,Ue,Ee++)}),Oe}function H(q){if(q._status===-1){var se=q._result;se=se(),se.then(function(xe){(q._status===0||q._status===-1)&&(q._status=1,q._result=xe)},function(xe){(q._status===0||q._status===-1)&&(q._status=2,q._result=xe)}),q._status===-1&&(q._status=0,q._result=se)}if(q._status===1)return q._result.default;throw q._result}var ee={current:null},J={transition:null},ne={ReactCurrentDispatcher:ee,ReactCurrentBatchConfig:J,ReactCurrentOwner:R};function ae(){throw Error("act(...) is not supported in production builds of React.")}return Ft.Children={map:X,forEach:function(q,se,xe){X(q,function(){se.apply(this,arguments)},xe)},count:function(q){var se=0;return X(q,function(){se++}),se},toArray:function(q){return X(q,function(se){return se})||[]},only:function(q){if(!L(q))throw Error("React.Children.only expected to receive a single React element child.");return q}},Ft.Component=S,Ft.Fragment=t,Ft.Profiler=s,Ft.PureComponent=E,Ft.StrictMode=n,Ft.Suspense=l,Ft.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ne,Ft.act=ae,Ft.cloneElement=function(q,se,xe){if(q==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+q+".");var Oe=v({},q.props),Ee=q.key,Ue=q.ref,Be=q._owner;if(se!=null){if(se.ref!==void 0&&(Ue=se.ref,Be=R.current),se.key!==void 0&&(Ee=""+se.key),q.type&&q.type.defaultProps)var Te=q.type.defaultProps;for(Le in se)M.call(se,Le)&&!D.hasOwnProperty(Le)&&(Oe[Le]=se[Le]===void 0&&Te!==void 0?Te[Le]:se[Le])}var Le=arguments.length-2;if(Le===1)Oe.children=xe;else if(1<Le){Te=Array(Le);for(var Xe=0;Xe<Le;Xe++)Te[Xe]=arguments[Xe+2];Oe.children=Te}return{$$typeof:r,type:q.type,key:Ee,ref:Ue,props:Oe,_owner:Be}},Ft.createContext=function(q){return q={$$typeof:i,_currentValue:q,_currentValue2:q,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},q.Provider={$$typeof:o,_context:q},q.Consumer=q},Ft.createElement=N,Ft.createFactory=function(q){var se=N.bind(null,q);return se.type=q,se},Ft.createRef=function(){return{current:null}},Ft.forwardRef=function(q){return{$$typeof:a,render:q}},Ft.isValidElement=L,Ft.lazy=function(q){return{$$typeof:u,_payload:{_status:-1,_result:q},_init:H}},Ft.memo=function(q,se){return{$$typeof:c,type:q,compare:se===void 0?null:se}},Ft.startTransition=function(q){var se=J.transition;J.transition={};try{q()}finally{J.transition=se}},Ft.unstable_act=ae,Ft.useCallback=function(q,se){return ee.current.useCallback(q,se)},Ft.useContext=function(q){return ee.current.useContext(q)},Ft.useDebugValue=function(){},Ft.useDeferredValue=function(q){return ee.current.useDeferredValue(q)},Ft.useEffect=function(q,se){return ee.current.useEffect(q,se)},Ft.useId=function(){return ee.current.useId()},Ft.useImperativeHandle=function(q,se,xe){return ee.current.useImperativeHandle(q,se,xe)},Ft.useInsertionEffect=function(q,se){return ee.current.useInsertionEffect(q,se)},Ft.useLayoutEffect=function(q,se){return ee.current.useLayoutEffect(q,se)},Ft.useMemo=function(q,se){return ee.current.useMemo(q,se)},Ft.useReducer=function(q,se,xe){return ee.current.useReducer(q,se,xe)},Ft.useRef=function(q){return ee.current.useRef(q)},Ft.useState=function(q){return ee.current.useState(q)},Ft.useSyncExternalStore=function(q,se,xe){return ee.current.useSyncExternalStore(q,se,xe)},Ft.useTransition=function(){return ee.current.useTransition()},Ft.version="18.3.1",Ft}var jT;function Ag(){return jT||(jT=1,Mx.exports=zU()),Mx.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var RT;function $U(){if(RT)return Vp;RT=1;var r=Ag(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function i(a,l,c){var u,p={},f=null,m=null;c!==void 0&&(f=""+c),l.key!==void 0&&(f=""+l.key),l.ref!==void 0&&(m=l.ref);for(u in l)n.call(l,u)&&!o.hasOwnProperty(u)&&(p[u]=l[u]);if(a&&a.defaultProps)for(u in l=a.defaultProps,l)p[u]===void 0&&(p[u]=l[u]);return{$$typeof:e,type:a,key:f,ref:m,props:p,_owner:s.current}}return Vp.Fragment=t,Vp.jsx=i,Vp.jsxs=i,Vp}var DT;function BU(){return DT||(DT=1,Tx.exports=$U()),Tx.exports}var g=BU(),I=Ag();const Ht=ec(I),rE=FU({__proto__:null,default:Ht},[I]);var ay={},Ax={exports:{}},Eo={},jx={exports:{}},Rx={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var OT;function UU(){return OT||(OT=1,function(r){function e(J,ne){var ae=J.length;J.push(ne);e:for(;0<ae;){var q=ae-1>>>1,se=J[q];if(0<s(se,ne))J[q]=ne,J[ae]=se,ae=q;else break e}}function t(J){return J.length===0?null:J[0]}function n(J){if(J.length===0)return null;var ne=J[0],ae=J.pop();if(ae!==ne){J[0]=ae;e:for(var q=0,se=J.length,xe=se>>>1;q<xe;){var Oe=2*(q+1)-1,Ee=J[Oe],Ue=Oe+1,Be=J[Ue];if(0>s(Ee,ae))Ue<se&&0>s(Be,Ee)?(J[q]=Be,J[Ue]=ae,q=Ue):(J[q]=Ee,J[Oe]=ae,q=Oe);else if(Ue<se&&0>s(Be,ae))J[q]=Be,J[Ue]=ae,q=Ue;else break e}}return ne}function s(J,ne){var ae=J.sortIndex-ne.sortIndex;return ae!==0?ae:J.id-ne.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;r.unstable_now=function(){return o.now()}}else{var i=Date,a=i.now();r.unstable_now=function(){return i.now()-a}}var l=[],c=[],u=1,p=null,f=3,m=!1,v=!1,b=!1,S=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,E=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(J){for(var ne=t(c);ne!==null;){if(ne.callback===null)n(c);else if(ne.startTime<=J)n(c),ne.sortIndex=ne.expirationTime,e(l,ne);else break;ne=t(c)}}function w(J){if(b=!1,T(J),!v)if(t(l)!==null)v=!0,H(M);else{var ne=t(c);ne!==null&&ee(w,ne.startTime-J)}}function M(J,ne){v=!1,b&&(b=!1,C(N),N=-1),m=!0;var ae=f;try{for(T(ne),p=t(l);p!==null&&(!(p.expirationTime>ne)||J&&!B());){var q=p.callback;if(typeof q=="function"){p.callback=null,f=p.priorityLevel;var se=q(p.expirationTime<=ne);ne=r.unstable_now(),typeof se=="function"?p.callback=se:p===t(l)&&n(l),T(ne)}else n(l);p=t(l)}if(p!==null)var xe=!0;else{var Oe=t(c);Oe!==null&&ee(w,Oe.startTime-ne),xe=!1}return xe}finally{p=null,f=ae,m=!1}}var R=!1,D=null,N=-1,z=5,L=-1;function B(){return!(r.unstable_now()-L<z)}function K(){if(D!==null){var J=r.unstable_now();L=J;var ne=!0;try{ne=D(!0,J)}finally{ne?O():(R=!1,D=null)}}else R=!1}var O;if(typeof E=="function")O=function(){E(K)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,X=U.port2;U.port1.onmessage=K,O=function(){X.postMessage(null)}}else O=function(){S(K,0)};function H(J){D=J,R||(R=!0,O())}function ee(J,ne){N=S(function(){J(r.unstable_now())},ne)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(J){J.callback=null},r.unstable_continueExecution=function(){v||m||(v=!0,H(M))},r.unstable_forceFrameRate=function(J){0>J||125<J?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):z=0<J?Math.floor(1e3/J):5},r.unstable_getCurrentPriorityLevel=function(){return f},r.unstable_getFirstCallbackNode=function(){return t(l)},r.unstable_next=function(J){switch(f){case 1:case 2:case 3:var ne=3;break;default:ne=f}var ae=f;f=ne;try{return J()}finally{f=ae}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(J,ne){switch(J){case 1:case 2:case 3:case 4:case 5:break;default:J=3}var ae=f;f=J;try{return ne()}finally{f=ae}},r.unstable_scheduleCallback=function(J,ne,ae){var q=r.unstable_now();switch(typeof ae=="object"&&ae!==null?(ae=ae.delay,ae=typeof ae=="number"&&0<ae?q+ae:q):ae=q,J){case 1:var se=-1;break;case 2:se=250;break;case 5:se=1073741823;break;case 4:se=1e4;break;default:se=5e3}return se=ae+se,J={id:u++,callback:ne,priorityLevel:J,startTime:ae,expirationTime:se,sortIndex:-1},ae>q?(J.sortIndex=ae,e(c,J),t(l)===null&&J===t(c)&&(b?(C(N),N=-1):b=!0,ee(w,ae-q))):(J.sortIndex=se,e(l,J),v||m||(v=!0,H(M))),J},r.unstable_shouldYield=B,r.unstable_wrapCallback=function(J){var ne=f;return function(){var ae=f;f=ne;try{return J.apply(this,arguments)}finally{f=ae}}}}(Rx)),Rx}var LT;function HU(){return LT||(LT=1,jx.exports=UU()),jx.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var NT;function GU(){if(NT)return Eo;NT=1;var r=Ag(),e=HU();function t(d){for(var h="https://reactjs.org/docs/error-decoder.html?invariant="+d,y=1;y<arguments.length;y++)h+="&args[]="+encodeURIComponent(arguments[y]);return"Minified React error #"+d+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,s={};function o(d,h){i(d,h),i(d+"Capture",h)}function i(d,h){for(s[d]=h,d=0;d<h.length;d++)n.add(h[d])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,c=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,u={},p={};function f(d){return l.call(p,d)?!0:l.call(u,d)?!1:c.test(d)?p[d]=!0:(u[d]=!0,!1)}function m(d,h,y,x){if(y!==null&&y.type===0)return!1;switch(typeof h){case"function":case"symbol":return!0;case"boolean":return x?!1:y!==null?!y.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function v(d,h,y,x){if(h===null||typeof h>"u"||m(d,h,y,x))return!0;if(x)return!1;if(y!==null)switch(y.type){case 3:return!h;case 4:return h===!1;case 5:return isNaN(h);case 6:return isNaN(h)||1>h}return!1}function b(d,h,y,x,_,A,F){this.acceptsBooleans=h===2||h===3||h===4,this.attributeName=x,this.attributeNamespace=_,this.mustUseProperty=y,this.propertyName=d,this.type=h,this.sanitizeURL=A,this.removeEmptyString=F}var S={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){S[d]=new b(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var h=d[0];S[h]=new b(h,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){S[d]=new b(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){S[d]=new b(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){S[d]=new b(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){S[d]=new b(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){S[d]=new b(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){S[d]=new b(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){S[d]=new b(d,5,!1,d.toLowerCase(),null,!1,!1)});var C=/[\-:]([a-z])/g;function E(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var h=d.replace(C,E);S[h]=new b(h,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var h=d.replace(C,E);S[h]=new b(h,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var h=d.replace(C,E);S[h]=new b(h,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){S[d]=new b(d,1,!1,d.toLowerCase(),null,!1,!1)}),S.xlinkHref=new b("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){S[d]=new b(d,1,!1,d.toLowerCase(),null,!0,!0)});function T(d,h,y,x){var _=S.hasOwnProperty(h)?S[h]:null;(_!==null?_.type!==0:x||!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(v(h,y,_,x)&&(y=null),x||_===null?f(h)&&(y===null?d.removeAttribute(h):d.setAttribute(h,""+y)):_.mustUseProperty?d[_.propertyName]=y===null?_.type===3?!1:"":y:(h=_.attributeName,x=_.attributeNamespace,y===null?d.removeAttribute(h):(_=_.type,y=_===3||_===4&&y===!0?"":""+y,x?d.setAttributeNS(x,h,y):d.setAttribute(h,y))))}var w=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,M=Symbol.for("react.element"),R=Symbol.for("react.portal"),D=Symbol.for("react.fragment"),N=Symbol.for("react.strict_mode"),z=Symbol.for("react.profiler"),L=Symbol.for("react.provider"),B=Symbol.for("react.context"),K=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),U=Symbol.for("react.suspense_list"),X=Symbol.for("react.memo"),H=Symbol.for("react.lazy"),ee=Symbol.for("react.offscreen"),J=Symbol.iterator;function ne(d){return d===null||typeof d!="object"?null:(d=J&&d[J]||d["@@iterator"],typeof d=="function"?d:null)}var ae=Object.assign,q;function se(d){if(q===void 0)try{throw Error()}catch(y){var h=y.stack.trim().match(/\n( *(at )?)/);q=h&&h[1]||""}return`
`+q+d}var xe=!1;function Oe(d,h){if(!d||xe)return"";xe=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(h)if(h=function(){throw Error()},Object.defineProperty(h.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(h,[])}catch(ve){var x=ve}Reflect.construct(d,[],h)}else{try{h.call()}catch(ve){x=ve}d.call(h.prototype)}else{try{throw Error()}catch(ve){x=ve}d()}}catch(ve){if(ve&&x&&typeof ve.stack=="string"){for(var _=ve.stack.split(`
`),A=x.stack.split(`
`),F=_.length-1,Q=A.length-1;1<=F&&0<=Q&&_[F]!==A[Q];)Q--;for(;1<=F&&0<=Q;F--,Q--)if(_[F]!==A[Q]){if(F!==1||Q!==1)do if(F--,Q--,0>Q||_[F]!==A[Q]){var te=`
`+_[F].replace(" at new "," at ");return d.displayName&&te.includes("<anonymous>")&&(te=te.replace("<anonymous>",d.displayName)),te}while(1<=F&&0<=Q);break}}}finally{xe=!1,Error.prepareStackTrace=y}return(d=d?d.displayName||d.name:"")?se(d):""}function Ee(d){switch(d.tag){case 5:return se(d.type);case 16:return se("Lazy");case 13:return se("Suspense");case 19:return se("SuspenseList");case 0:case 2:case 15:return d=Oe(d.type,!1),d;case 11:return d=Oe(d.type.render,!1),d;case 1:return d=Oe(d.type,!0),d;default:return""}}function Ue(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case D:return"Fragment";case R:return"Portal";case z:return"Profiler";case N:return"StrictMode";case O:return"Suspense";case U:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case B:return(d.displayName||"Context")+".Consumer";case L:return(d._context.displayName||"Context")+".Provider";case K:var h=d.render;return d=d.displayName,d||(d=h.displayName||h.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case X:return h=d.displayName||null,h!==null?h:Ue(d.type)||"Memo";case H:h=d._payload,d=d._init;try{return Ue(d(h))}catch{}}return null}function Be(d){var h=d.type;switch(d.tag){case 24:return"Cache";case 9:return(h.displayName||"Context")+".Consumer";case 10:return(h._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=h.render,d=d.displayName||d.name||"",h.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return h;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ue(h);case 8:return h===N?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h}return null}function Te(d){switch(typeof d){case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function Le(d){var h=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(h==="checkbox"||h==="radio")}function Xe(d){var h=Le(d)?"checked":"value",y=Object.getOwnPropertyDescriptor(d.constructor.prototype,h),x=""+d[h];if(!d.hasOwnProperty(h)&&typeof y<"u"&&typeof y.get=="function"&&typeof y.set=="function"){var _=y.get,A=y.set;return Object.defineProperty(d,h,{configurable:!0,get:function(){return _.call(this)},set:function(F){x=""+F,A.call(this,F)}}),Object.defineProperty(d,h,{enumerable:y.enumerable}),{getValue:function(){return x},setValue:function(F){x=""+F},stopTracking:function(){d._valueTracker=null,delete d[h]}}}}function pt(d){d._valueTracker||(d._valueTracker=Xe(d))}function gn(d){if(!d)return!1;var h=d._valueTracker;if(!h)return!0;var y=h.getValue(),x="";return d&&(x=Le(d)?d.checked?"true":"false":d.value),d=x,d!==y?(h.setValue(d),!0):!1}function Dt(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function sn(d,h){var y=h.checked;return ae({},h,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:y??d._wrapperState.initialChecked})}function Kt(d,h){var y=h.defaultValue==null?"":h.defaultValue,x=h.checked!=null?h.checked:h.defaultChecked;y=Te(h.value!=null?h.value:y),d._wrapperState={initialChecked:x,initialValue:y,controlled:h.type==="checkbox"||h.type==="radio"?h.checked!=null:h.value!=null}}function Nt(d,h){h=h.checked,h!=null&&T(d,"checked",h,!1)}function vr(d,h){Nt(d,h);var y=Te(h.value),x=h.type;if(y!=null)x==="number"?(y===0&&d.value===""||d.value!=y)&&(d.value=""+y):d.value!==""+y&&(d.value=""+y);else if(x==="submit"||x==="reset"){d.removeAttribute("value");return}h.hasOwnProperty("value")?Qn(d,h.type,y):h.hasOwnProperty("defaultValue")&&Qn(d,h.type,Te(h.defaultValue)),h.checked==null&&h.defaultChecked!=null&&(d.defaultChecked=!!h.defaultChecked)}function br(d,h,y){if(h.hasOwnProperty("value")||h.hasOwnProperty("defaultValue")){var x=h.type;if(!(x!=="submit"&&x!=="reset"||h.value!==void 0&&h.value!==null))return;h=""+d._wrapperState.initialValue,y||h===d.value||(d.value=h),d.defaultValue=h}y=d.name,y!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,y!==""&&(d.name=y)}function Qn(d,h,y){(h!=="number"||Dt(d.ownerDocument)!==d)&&(y==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+y&&(d.defaultValue=""+y))}var Sr=Array.isArray;function dr(d,h,y,x){if(d=d.options,h){h={};for(var _=0;_<y.length;_++)h["$"+y[_]]=!0;for(y=0;y<d.length;y++)_=h.hasOwnProperty("$"+d[y].value),d[y].selected!==_&&(d[y].selected=_),_&&x&&(d[y].defaultSelected=!0)}else{for(y=""+Te(y),h=null,_=0;_<d.length;_++){if(d[_].value===y){d[_].selected=!0,x&&(d[_].defaultSelected=!0);return}h!==null||d[_].disabled||(h=d[_])}h!==null&&(h.selected=!0)}}function Rr(d,h){if(h.dangerouslySetInnerHTML!=null)throw Error(t(91));return ae({},h,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function qn(d,h){var y=h.value;if(y==null){if(y=h.children,h=h.defaultValue,y!=null){if(h!=null)throw Error(t(92));if(Sr(y)){if(1<y.length)throw Error(t(93));y=y[0]}h=y}h==null&&(h=""),y=h}d._wrapperState={initialValue:Te(y)}}function Zs(d,h){var y=Te(h.value),x=Te(h.defaultValue);y!=null&&(y=""+y,y!==d.value&&(d.value=y),h.defaultValue==null&&d.defaultValue!==y&&(d.defaultValue=y)),x!=null&&(d.defaultValue=""+x)}function ke(d){var h=d.textContent;h===d._wrapperState.initialValue&&h!==""&&h!==null&&(d.value=h)}function ge(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function he(d,h){return d==null||d==="http://www.w3.org/1999/xhtml"?ge(h):d==="http://www.w3.org/2000/svg"&&h==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var Ce,$e=function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(h,y,x,_){MSApp.execUnsafeLocalFunction(function(){return d(h,y,x,_)})}:d}(function(d,h){if(d.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in d)d.innerHTML=h;else{for(Ce=Ce||document.createElement("div"),Ce.innerHTML="<svg>"+h.valueOf().toString()+"</svg>",h=Ce.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;h.firstChild;)d.appendChild(h.firstChild)}});function re(d,h){if(h){var y=d.firstChild;if(y&&y===d.lastChild&&y.nodeType===3){y.nodeValue=h;return}}d.textContent=h}var we={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Fe=["Webkit","ms","Moz","O"];Object.keys(we).forEach(function(d){Fe.forEach(function(h){h=h+d.charAt(0).toUpperCase()+d.substring(1),we[h]=we[d]})});function ct(d,h,y){return h==null||typeof h=="boolean"||h===""?"":y||typeof h!="number"||h===0||we.hasOwnProperty(d)&&we[d]?(""+h).trim():h+"px"}function tn(d,h){d=d.style;for(var y in h)if(h.hasOwnProperty(y)){var x=y.indexOf("--")===0,_=ct(y,h[y],x);y==="float"&&(y="cssFloat"),x?d.setProperty(y,_):d[y]=_}}var Vt=ae({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Tn(d,h){if(h){if(Vt[d]&&(h.children!=null||h.dangerouslySetInnerHTML!=null))throw Error(t(137,d));if(h.dangerouslySetInnerHTML!=null){if(h.children!=null)throw Error(t(60));if(typeof h.dangerouslySetInnerHTML!="object"||!("__html"in h.dangerouslySetInnerHTML))throw Error(t(61))}if(h.style!=null&&typeof h.style!="object")throw Error(t(62))}}function qt(d,h){if(d.indexOf("-")===-1)return typeof h.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var En=null;function kn(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var Yn=null,Mn=null,mn=null;function At(d){if(d=jp(d)){if(typeof Yn!="function")throw Error(t(280));var h=d.stateNode;h&&(h=wm(h),Yn(d.stateNode,d.type,h))}}function On(d){Mn?mn?mn.push(d):mn=[d]:Mn=d}function ur(){if(Mn){var d=Mn,h=mn;if(mn=Mn=null,At(d),h)for(d=0;d<h.length;d++)At(h[d])}}function is(d,h){return d(h)}function Vr(){}var er=!1;function Cs(d,h,y){if(er)return d(h,y);er=!0;try{return is(d,h,y)}finally{er=!1,(Mn!==null||mn!==null)&&(Vr(),ur())}}function go(d,h){var y=d.stateNode;if(y===null)return null;var x=wm(y);if(x===null)return null;y=x[h];e:switch(h){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(x=!x.disabled)||(d=d.type,x=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!x;break e;default:d=!1}if(d)return null;if(y&&typeof y!="function")throw Error(t(231,h,typeof y));return y}var Hi=!1;if(a)try{var bl={};Object.defineProperty(bl,"passive",{get:function(){Hi=!0}}),window.addEventListener("test",bl,bl),window.removeEventListener("test",bl,bl)}catch{Hi=!1}function ac(d,h,y,x,_,A,F,Q,te){var ve=Array.prototype.slice.call(arguments,3);try{h.apply(y,ve)}catch(je){this.onError(je)}}var wa=!1,Ca=null,mo=!1,xd=null,lc={onError:function(d){wa=!0,Ca=d}};function Y(d,h,y,x,_,A,F,Q,te){wa=!1,Ca=null,ac.apply(lc,arguments)}function Z(d,h,y,x,_,A,F,Q,te){if(Y.apply(this,arguments),wa){if(wa){var ve=Ca;wa=!1,Ca=null}else throw Error(t(198));mo||(mo=!0,xd=ve)}}function $(d){var h=d,y=d;if(d.alternate)for(;h.return;)h=h.return;else{d=h;do h=d,h.flags&4098&&(y=h.return),d=h.return;while(d)}return h.tag===3?y:null}function G(d){if(d.tag===13){var h=d.memoizedState;if(h===null&&(d=d.alternate,d!==null&&(h=d.memoizedState)),h!==null)return h.dehydrated}return null}function W(d){if($(d)!==d)throw Error(t(188))}function de(d){var h=d.alternate;if(!h){if(h=$(d),h===null)throw Error(t(188));return h!==d?null:d}for(var y=d,x=h;;){var _=y.return;if(_===null)break;var A=_.alternate;if(A===null){if(x=_.return,x!==null){y=x;continue}break}if(_.child===A.child){for(A=_.child;A;){if(A===y)return W(_),d;if(A===x)return W(_),h;A=A.sibling}throw Error(t(188))}if(y.return!==x.return)y=_,x=A;else{for(var F=!1,Q=_.child;Q;){if(Q===y){F=!0,y=_,x=A;break}if(Q===x){F=!0,x=_,y=A;break}Q=Q.sibling}if(!F){for(Q=A.child;Q;){if(Q===y){F=!0,y=A,x=_;break}if(Q===x){F=!0,x=A,y=_;break}Q=Q.sibling}if(!F)throw Error(t(189))}}if(y.alternate!==x)throw Error(t(190))}if(y.tag!==3)throw Error(t(188));return y.stateNode.current===y?d:h}function Se(d){return d=de(d),d!==null?be(d):null}function be(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var h=be(d);if(h!==null)return h;d=d.sibling}return null}var ce=e.unstable_scheduleCallback,_e=e.unstable_cancelCallback,et=e.unstable_shouldYield,jt=e.unstable_requestPaint,dt=e.unstable_now,dn=e.unstable_getCurrentPriorityLevel,Ct=e.unstable_ImmediatePriority,Yt=e.unstable_UserBlockingPriority,Pn=e.unstable_NormalPriority,St=e.unstable_LowPriority,bn=e.unstable_IdlePriority,Dr=null,hr=null;function cc(d){if(hr&&typeof hr.onCommitFiberRoot=="function")try{hr.onCommitFiberRoot(Dr,d,void 0,(d.current.flags&128)===128)}catch{}}var tr=Math.clz32?Math.clz32:nr,dc=Math.log,Ea=Math.LN2;function nr(d){return d>>>=0,d===0?32:31-(dc(d)/Ea|0)|0}var qo=64,Es=4194304;function Js(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function ka(d,h){var y=d.pendingLanes;if(y===0)return 0;var x=0,_=d.suspendedLanes,A=d.pingedLanes,F=y&268435455;if(F!==0){var Q=F&~_;Q!==0?x=Js(Q):(A&=F,A!==0&&(x=Js(A)))}else F=y&~_,F!==0?x=Js(F):A!==0&&(x=Js(A));if(x===0)return 0;if(h!==0&&h!==x&&!(h&_)&&(_=x&-x,A=h&-h,_>=A||_===16&&(A&4194240)!==0))return h;if(x&4&&(x|=y&16),h=d.entangledLanes,h!==0)for(d=d.entanglements,h&=x;0<h;)y=31-tr(h),_=1<<y,x|=d[y],h&=~_;return x}function uc(d,h){switch(d){case 1:case 2:case 4:return h+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wd(d,h){for(var y=d.suspendedLanes,x=d.pingedLanes,_=d.expirationTimes,A=d.pendingLanes;0<A;){var F=31-tr(A),Q=1<<F,te=_[F];te===-1?(!(Q&y)||Q&x)&&(_[F]=uc(Q,h)):te<=h&&(d.expiredLanes|=Q),A&=~Q}}function Sl(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function hc(){var d=qo;return qo<<=1,!(qo&4194240)&&(qo=64),d}function Pa(d){for(var h=[],y=0;31>y;y++)h.push(d);return h}function yo(d,h,y){d.pendingLanes|=h,h!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,h=31-tr(h),d[h]=y}function Mu(d,h){var y=d.pendingLanes&~h;d.pendingLanes=h,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=h,d.mutableReadLanes&=h,d.entangledLanes&=h,h=d.entanglements;var x=d.eventTimes;for(d=d.expirationTimes;0<y;){var _=31-tr(y),A=1<<_;h[_]=0,x[_]=-1,d[_]=-1,y&=~A}}function Au(d,h){var y=d.entangledLanes|=h;for(d=d.entanglements;y;){var x=31-tr(y),_=1<<x;_&h|d[x]&h&&(d[x]|=h),y&=~_}}var nn=0;function xl(d){return d&=-d,1<d?4<d?d&268435455?16:536870912:4:1}var cm,yp,Gi,dm,um,vp=!1,ju=[],Ia=null,ks=null,Wi=null,Cd=new Map,_a=new Map,Ta=[],bp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function hm(d,h){switch(d){case"focusin":case"focusout":Ia=null;break;case"dragenter":case"dragleave":ks=null;break;case"mouseover":case"mouseout":Wi=null;break;case"pointerover":case"pointerout":Cd.delete(h.pointerId);break;case"gotpointercapture":case"lostpointercapture":_a.delete(h.pointerId)}}function pc(d,h,y,x,_,A){return d===null||d.nativeEvent!==A?(d={blockedOn:h,domEventName:y,eventSystemFlags:x,nativeEvent:A,targetContainers:[_]},h!==null&&(h=jp(h),h!==null&&yp(h)),d):(d.eventSystemFlags|=x,h=d.targetContainers,_!==null&&h.indexOf(_)===-1&&h.push(_),d)}function pm(d,h,y,x,_){switch(h){case"focusin":return Ia=pc(Ia,d,h,y,x,_),!0;case"dragenter":return ks=pc(ks,d,h,y,x,_),!0;case"mouseover":return Wi=pc(Wi,d,h,y,x,_),!0;case"pointerover":var A=_.pointerId;return Cd.set(A,pc(Cd.get(A)||null,d,h,y,x,_)),!0;case"gotpointercapture":return A=_.pointerId,_a.set(A,pc(_a.get(A)||null,d,h,y,x,_)),!0}return!1}function Sp(d){var h=Pd(d.target);if(h!==null){var y=$(h);if(y!==null){if(h=y.tag,h===13){if(h=G(y),h!==null){d.blockedOn=h,um(d.priority,function(){Gi(y)});return}}else if(h===3&&y.stateNode.current.memoizedState.isDehydrated){d.blockedOn=y.tag===3?y.stateNode.containerInfo:null;return}}}d.blockedOn=null}function Ma(d){if(d.blockedOn!==null)return!1;for(var h=d.targetContainers;0<h.length;){var y=Ln(d.domEventName,d.eventSystemFlags,h[0],d.nativeEvent);if(y===null){y=d.nativeEvent;var x=new y.constructor(y.type,y);En=x,y.target.dispatchEvent(x),En=null}else return h=jp(y),h!==null&&yp(h),d.blockedOn=y,!1;h.shift()}return!0}function xp(d,h,y){Ma(d)&&y.delete(h)}function sS(){vp=!1,Ia!==null&&Ma(Ia)&&(Ia=null),ks!==null&&Ma(ks)&&(ks=null),Wi!==null&&Ma(Wi)&&(Wi=null),Cd.forEach(xp),_a.forEach(xp)}function Ed(d,h){d.blockedOn===h&&(d.blockedOn=null,vp||(vp=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,sS)))}function kd(d){function h(_){return Ed(_,d)}if(0<ju.length){Ed(ju[0],d);for(var y=1;y<ju.length;y++){var x=ju[y];x.blockedOn===d&&(x.blockedOn=null)}}for(Ia!==null&&Ed(Ia,d),ks!==null&&Ed(ks,d),Wi!==null&&Ed(Wi,d),Cd.forEach(h),_a.forEach(h),y=0;y<Ta.length;y++)x=Ta[y],x.blockedOn===d&&(x.blockedOn=null);for(;0<Ta.length&&(y=Ta[0],y.blockedOn===null);)Sp(y),y.blockedOn===null&&Ta.shift()}var V=w.ReactCurrentBatchConfig,le=!0;function Me(d,h,y,x){var _=nn,A=V.transition;V.transition=null;try{nn=1,wn(d,h,y,x)}finally{nn=_,V.transition=A}}function Ye(d,h,y,x){var _=nn,A=V.transition;V.transition=null;try{nn=4,wn(d,h,y,x)}finally{nn=_,V.transition=A}}function wn(d,h,y,x){if(le){var _=Ln(d,h,y,x);if(_===null)vS(d,h,x,wt,y),hm(d,x);else if(pm(_,d,h,y,x))x.stopPropagation();else if(hm(d,x),h&4&&-1<bp.indexOf(d)){for(;_!==null;){var A=jp(_);if(A!==null&&cm(A),A=Ln(d,h,y,x),A===null&&vS(d,h,x,wt,y),A===_)break;_=A}_!==null&&x.stopPropagation()}else vS(d,h,x,null,y)}}var wt=null;function Ln(d,h,y,x){if(wt=null,d=kn(x),d=Pd(d),d!==null)if(h=$(d),h===null)d=null;else if(y=h.tag,y===13){if(d=G(h),d!==null)return d;d=null}else if(y===3){if(h.stateNode.current.memoizedState.isDehydrated)return h.tag===3?h.stateNode.containerInfo:null;d=null}else h!==d&&(d=null);return wt=d,null}function xr(d){switch(d){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(dn()){case Ct:return 1;case Yt:return 4;case Pn:case St:return 16;case bn:return 536870912;default:return 16}default:return 16}}var Nn=null,An=null,qr=null;function vo(){if(qr)return qr;var d,h=An,y=h.length,x,_="value"in Nn?Nn.value:Nn.textContent,A=_.length;for(d=0;d<y&&h[d]===_[d];d++);var F=y-d;for(x=1;x<=F&&h[y-x]===_[A-x];x++);return qr=_.slice(d,1<x?1-x:void 0)}function wr(d){var h=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&h===13&&(d=13)):d=h,d===10&&(d=13),32<=d||d===13?d:0}function as(){return!0}function Qs(){return!1}function pr(d){function h(y,x,_,A,F){this._reactName=y,this._targetInst=_,this.type=x,this.nativeEvent=A,this.target=F,this.currentTarget=null;for(var Q in d)d.hasOwnProperty(Q)&&(y=d[Q],this[Q]=y?y(A):A[Q]);return this.isDefaultPrevented=(A.defaultPrevented!=null?A.defaultPrevented:A.returnValue===!1)?as:Qs,this.isPropagationStopped=Qs,this}return ae(h.prototype,{preventDefault:function(){this.defaultPrevented=!0;var y=this.nativeEvent;y&&(y.preventDefault?y.preventDefault():typeof y.returnValue!="unknown"&&(y.returnValue=!1),this.isDefaultPrevented=as)},stopPropagation:function(){var y=this.nativeEvent;y&&(y.stopPropagation?y.stopPropagation():typeof y.cancelBubble!="unknown"&&(y.cancelBubble=!0),this.isPropagationStopped=as)},persist:function(){},isPersistent:as}),h}var Ps={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ki=pr(Ps),fc=ae({},Ps,{view:0,detail:0}),Ru=pr(fc),gc,oS,wp,fm=ae({},fc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:aS,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==wp&&(wp&&d.type==="mousemove"?(gc=d.screenX-wp.screenX,oS=d.screenY-wp.screenY):oS=gc=0,wp=d),gc)},movementY:function(d){return"movementY"in d?d.movementY:oS}}),bI=pr(fm),cB=ae({},fm,{dataTransfer:0}),dB=pr(cB),uB=ae({},fc,{relatedTarget:0}),iS=pr(uB),hB=ae({},Ps,{animationName:0,elapsedTime:0,pseudoElement:0}),pB=pr(hB),fB=ae({},Ps,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),gB=pr(fB),mB=ae({},Ps,{data:0}),SI=pr(mB),yB={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},vB={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},bB={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function SB(d){var h=this.nativeEvent;return h.getModifierState?h.getModifierState(d):(d=bB[d])?!!h[d]:!1}function aS(){return SB}var xB=ae({},fc,{key:function(d){if(d.key){var h=yB[d.key]||d.key;if(h!=="Unidentified")return h}return d.type==="keypress"?(d=wr(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?vB[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:aS,charCode:function(d){return d.type==="keypress"?wr(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?wr(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),wB=pr(xB),CB=ae({},fm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),xI=pr(CB),EB=ae({},fc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:aS}),kB=pr(EB),PB=ae({},Ps,{propertyName:0,elapsedTime:0,pseudoElement:0}),IB=pr(PB),_B=ae({},fm,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),TB=pr(_B),MB=[9,13,27,32],lS=a&&"CompositionEvent"in window,Cp=null;a&&"documentMode"in document&&(Cp=document.documentMode);var AB=a&&"TextEvent"in window&&!Cp,wI=a&&(!lS||Cp&&8<Cp&&11>=Cp),CI=" ",EI=!1;function kI(d,h){switch(d){case"keyup":return MB.indexOf(h.keyCode)!==-1;case"keydown":return h.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function PI(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var Du=!1;function jB(d,h){switch(d){case"compositionend":return PI(h);case"keypress":return h.which!==32?null:(EI=!0,CI);case"textInput":return d=h.data,d===CI&&EI?null:d;default:return null}}function RB(d,h){if(Du)return d==="compositionend"||!lS&&kI(d,h)?(d=vo(),qr=An=Nn=null,Du=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(h.ctrlKey||h.altKey||h.metaKey)||h.ctrlKey&&h.altKey){if(h.char&&1<h.char.length)return h.char;if(h.which)return String.fromCharCode(h.which)}return null;case"compositionend":return wI&&h.locale!=="ko"?null:h.data;default:return null}}var DB={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function II(d){var h=d&&d.nodeName&&d.nodeName.toLowerCase();return h==="input"?!!DB[d.type]:h==="textarea"}function _I(d,h,y,x){On(x),h=bm(h,"onChange"),0<h.length&&(y=new Ki("onChange","change",null,y,x),d.push({event:y,listeners:h}))}var Ep=null,kp=null;function OB(d){KI(d,0)}function gm(d){var h=zu(d);if(gn(h))return d}function LB(d,h){if(d==="change")return h}var TI=!1;if(a){var cS;if(a){var dS="oninput"in document;if(!dS){var MI=document.createElement("div");MI.setAttribute("oninput","return;"),dS=typeof MI.oninput=="function"}cS=dS}else cS=!1;TI=cS&&(!document.documentMode||9<document.documentMode)}function AI(){Ep&&(Ep.detachEvent("onpropertychange",jI),kp=Ep=null)}function jI(d){if(d.propertyName==="value"&&gm(kp)){var h=[];_I(h,kp,d,kn(d)),Cs(OB,h)}}function NB(d,h,y){d==="focusin"?(AI(),Ep=h,kp=y,Ep.attachEvent("onpropertychange",jI)):d==="focusout"&&AI()}function FB(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return gm(kp)}function zB(d,h){if(d==="click")return gm(h)}function $B(d,h){if(d==="input"||d==="change")return gm(h)}function BB(d,h){return d===h&&(d!==0||1/d===1/h)||d!==d&&h!==h}var Vi=typeof Object.is=="function"?Object.is:BB;function Pp(d,h){if(Vi(d,h))return!0;if(typeof d!="object"||d===null||typeof h!="object"||h===null)return!1;var y=Object.keys(d),x=Object.keys(h);if(y.length!==x.length)return!1;for(x=0;x<y.length;x++){var _=y[x];if(!l.call(h,_)||!Vi(d[_],h[_]))return!1}return!0}function RI(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function DI(d,h){var y=RI(d);d=0;for(var x;y;){if(y.nodeType===3){if(x=d+y.textContent.length,d<=h&&x>=h)return{node:y,offset:h-d};d=x}e:{for(;y;){if(y.nextSibling){y=y.nextSibling;break e}y=y.parentNode}y=void 0}y=RI(y)}}function OI(d,h){return d&&h?d===h?!0:d&&d.nodeType===3?!1:h&&h.nodeType===3?OI(d,h.parentNode):"contains"in d?d.contains(h):d.compareDocumentPosition?!!(d.compareDocumentPosition(h)&16):!1:!1}function LI(){for(var d=window,h=Dt();h instanceof d.HTMLIFrameElement;){try{var y=typeof h.contentWindow.location.href=="string"}catch{y=!1}if(y)d=h.contentWindow;else break;h=Dt(d.document)}return h}function uS(d){var h=d&&d.nodeName&&d.nodeName.toLowerCase();return h&&(h==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||h==="textarea"||d.contentEditable==="true")}function UB(d){var h=LI(),y=d.focusedElem,x=d.selectionRange;if(h!==y&&y&&y.ownerDocument&&OI(y.ownerDocument.documentElement,y)){if(x!==null&&uS(y)){if(h=x.start,d=x.end,d===void 0&&(d=h),"selectionStart"in y)y.selectionStart=h,y.selectionEnd=Math.min(d,y.value.length);else if(d=(h=y.ownerDocument||document)&&h.defaultView||window,d.getSelection){d=d.getSelection();var _=y.textContent.length,A=Math.min(x.start,_);x=x.end===void 0?A:Math.min(x.end,_),!d.extend&&A>x&&(_=x,x=A,A=_),_=DI(y,A);var F=DI(y,x);_&&F&&(d.rangeCount!==1||d.anchorNode!==_.node||d.anchorOffset!==_.offset||d.focusNode!==F.node||d.focusOffset!==F.offset)&&(h=h.createRange(),h.setStart(_.node,_.offset),d.removeAllRanges(),A>x?(d.addRange(h),d.extend(F.node,F.offset)):(h.setEnd(F.node,F.offset),d.addRange(h)))}}for(h=[],d=y;d=d.parentNode;)d.nodeType===1&&h.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof y.focus=="function"&&y.focus(),y=0;y<h.length;y++)d=h[y],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var HB=a&&"documentMode"in document&&11>=document.documentMode,Ou=null,hS=null,Ip=null,pS=!1;function NI(d,h,y){var x=y.window===y?y.document:y.nodeType===9?y:y.ownerDocument;pS||Ou==null||Ou!==Dt(x)||(x=Ou,"selectionStart"in x&&uS(x)?x={start:x.selectionStart,end:x.selectionEnd}:(x=(x.ownerDocument&&x.ownerDocument.defaultView||window).getSelection(),x={anchorNode:x.anchorNode,anchorOffset:x.anchorOffset,focusNode:x.focusNode,focusOffset:x.focusOffset}),Ip&&Pp(Ip,x)||(Ip=x,x=bm(hS,"onSelect"),0<x.length&&(h=new Ki("onSelect","select",null,h,y),d.push({event:h,listeners:x}),h.target=Ou)))}function mm(d,h){var y={};return y[d.toLowerCase()]=h.toLowerCase(),y["Webkit"+d]="webkit"+h,y["Moz"+d]="moz"+h,y}var Lu={animationend:mm("Animation","AnimationEnd"),animationiteration:mm("Animation","AnimationIteration"),animationstart:mm("Animation","AnimationStart"),transitionend:mm("Transition","TransitionEnd")},fS={},FI={};a&&(FI=document.createElement("div").style,"AnimationEvent"in window||(delete Lu.animationend.animation,delete Lu.animationiteration.animation,delete Lu.animationstart.animation),"TransitionEvent"in window||delete Lu.transitionend.transition);function ym(d){if(fS[d])return fS[d];if(!Lu[d])return d;var h=Lu[d],y;for(y in h)if(h.hasOwnProperty(y)&&y in FI)return fS[d]=h[y];return d}var zI=ym("animationend"),$I=ym("animationiteration"),BI=ym("animationstart"),UI=ym("transitionend"),HI=new Map,GI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function mc(d,h){HI.set(d,h),o(h,[d])}for(var gS=0;gS<GI.length;gS++){var mS=GI[gS],GB=mS.toLowerCase(),WB=mS[0].toUpperCase()+mS.slice(1);mc(GB,"on"+WB)}mc(zI,"onAnimationEnd"),mc($I,"onAnimationIteration"),mc(BI,"onAnimationStart"),mc("dblclick","onDoubleClick"),mc("focusin","onFocus"),mc("focusout","onBlur"),mc(UI,"onTransitionEnd"),i("onMouseEnter",["mouseout","mouseover"]),i("onMouseLeave",["mouseout","mouseover"]),i("onPointerEnter",["pointerout","pointerover"]),i("onPointerLeave",["pointerout","pointerover"]),o("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),o("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),o("onBeforeInput",["compositionend","keypress","textInput","paste"]),o("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var _p="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),KB=new Set("cancel close invalid load scroll toggle".split(" ").concat(_p));function WI(d,h,y){var x=d.type||"unknown-event";d.currentTarget=y,Z(x,h,void 0,d),d.currentTarget=null}function KI(d,h){h=(h&4)!==0;for(var y=0;y<d.length;y++){var x=d[y],_=x.event;x=x.listeners;e:{var A=void 0;if(h)for(var F=x.length-1;0<=F;F--){var Q=x[F],te=Q.instance,ve=Q.currentTarget;if(Q=Q.listener,te!==A&&_.isPropagationStopped())break e;WI(_,Q,ve),A=te}else for(F=0;F<x.length;F++){if(Q=x[F],te=Q.instance,ve=Q.currentTarget,Q=Q.listener,te!==A&&_.isPropagationStopped())break e;WI(_,Q,ve),A=te}}}if(mo)throw d=xd,mo=!1,xd=null,d}function Hn(d,h){var y=h[ES];y===void 0&&(y=h[ES]=new Set);var x=d+"__bubble";y.has(x)||(VI(h,d,2,!1),y.add(x))}function yS(d,h,y){var x=0;h&&(x|=4),VI(y,d,x,h)}var vm="_reactListening"+Math.random().toString(36).slice(2);function Tp(d){if(!d[vm]){d[vm]=!0,n.forEach(function(y){y!=="selectionchange"&&(KB.has(y)||yS(y,!1,d),yS(y,!0,d))});var h=d.nodeType===9?d:d.ownerDocument;h===null||h[vm]||(h[vm]=!0,yS("selectionchange",!1,h))}}function VI(d,h,y,x){switch(xr(h)){case 1:var _=Me;break;case 4:_=Ye;break;default:_=wn}y=_.bind(null,h,y,d),_=void 0,!Hi||h!=="touchstart"&&h!=="touchmove"&&h!=="wheel"||(_=!0),x?_!==void 0?d.addEventListener(h,y,{capture:!0,passive:_}):d.addEventListener(h,y,!0):_!==void 0?d.addEventListener(h,y,{passive:_}):d.addEventListener(h,y,!1)}function vS(d,h,y,x,_){var A=x;if(!(h&1)&&!(h&2)&&x!==null)e:for(;;){if(x===null)return;var F=x.tag;if(F===3||F===4){var Q=x.stateNode.containerInfo;if(Q===_||Q.nodeType===8&&Q.parentNode===_)break;if(F===4)for(F=x.return;F!==null;){var te=F.tag;if((te===3||te===4)&&(te=F.stateNode.containerInfo,te===_||te.nodeType===8&&te.parentNode===_))return;F=F.return}for(;Q!==null;){if(F=Pd(Q),F===null)return;if(te=F.tag,te===5||te===6){x=A=F;continue e}Q=Q.parentNode}}x=x.return}Cs(function(){var ve=A,je=kn(y),Re=[];e:{var Ae=HI.get(d);if(Ae!==void 0){var qe=Ki,tt=d;switch(d){case"keypress":if(wr(y)===0)break e;case"keydown":case"keyup":qe=wB;break;case"focusin":tt="focus",qe=iS;break;case"focusout":tt="blur",qe=iS;break;case"beforeblur":case"afterblur":qe=iS;break;case"click":if(y.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":qe=bI;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":qe=dB;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":qe=kB;break;case zI:case $I:case BI:qe=pB;break;case UI:qe=IB;break;case"scroll":qe=Ru;break;case"wheel":qe=TB;break;case"copy":case"cut":case"paste":qe=gB;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":qe=xI}var rt=(h&4)!==0,Cr=!rt&&d==="scroll",pe=rt?Ae!==null?Ae+"Capture":null:Ae;rt=[];for(var ie=ve,me;ie!==null;){me=ie;var ze=me.stateNode;if(me.tag===5&&ze!==null&&(me=ze,pe!==null&&(ze=go(ie,pe),ze!=null&&rt.push(Mp(ie,ze,me)))),Cr)break;ie=ie.return}0<rt.length&&(Ae=new qe(Ae,tt,null,y,je),Re.push({event:Ae,listeners:rt}))}}if(!(h&7)){e:{if(Ae=d==="mouseover"||d==="pointerover",qe=d==="mouseout"||d==="pointerout",Ae&&y!==En&&(tt=y.relatedTarget||y.fromElement)&&(Pd(tt)||tt[wl]))break e;if((qe||Ae)&&(Ae=je.window===je?je:(Ae=je.ownerDocument)?Ae.defaultView||Ae.parentWindow:window,qe?(tt=y.relatedTarget||y.toElement,qe=ve,tt=tt?Pd(tt):null,tt!==null&&(Cr=$(tt),tt!==Cr||tt.tag!==5&&tt.tag!==6)&&(tt=null)):(qe=null,tt=ve),qe!==tt)){if(rt=bI,ze="onMouseLeave",pe="onMouseEnter",ie="mouse",(d==="pointerout"||d==="pointerover")&&(rt=xI,ze="onPointerLeave",pe="onPointerEnter",ie="pointer"),Cr=qe==null?Ae:zu(qe),me=tt==null?Ae:zu(tt),Ae=new rt(ze,ie+"leave",qe,y,je),Ae.target=Cr,Ae.relatedTarget=me,ze=null,Pd(je)===ve&&(rt=new rt(pe,ie+"enter",tt,y,je),rt.target=me,rt.relatedTarget=Cr,ze=rt),Cr=ze,qe&&tt)t:{for(rt=qe,pe=tt,ie=0,me=rt;me;me=Nu(me))ie++;for(me=0,ze=pe;ze;ze=Nu(ze))me++;for(;0<ie-me;)rt=Nu(rt),ie--;for(;0<me-ie;)pe=Nu(pe),me--;for(;ie--;){if(rt===pe||pe!==null&&rt===pe.alternate)break t;rt=Nu(rt),pe=Nu(pe)}rt=null}else rt=null;qe!==null&&qI(Re,Ae,qe,rt,!1),tt!==null&&Cr!==null&&qI(Re,Cr,tt,rt,!0)}}e:{if(Ae=ve?zu(ve):window,qe=Ae.nodeName&&Ae.nodeName.toLowerCase(),qe==="select"||qe==="input"&&Ae.type==="file")var st=LB;else if(II(Ae))if(TI)st=$B;else{st=FB;var ft=NB}else(qe=Ae.nodeName)&&qe.toLowerCase()==="input"&&(Ae.type==="checkbox"||Ae.type==="radio")&&(st=zB);if(st&&(st=st(d,ve))){_I(Re,st,y,je);break e}ft&&ft(d,Ae,ve),d==="focusout"&&(ft=Ae._wrapperState)&&ft.controlled&&Ae.type==="number"&&Qn(Ae,"number",Ae.value)}switch(ft=ve?zu(ve):window,d){case"focusin":(II(ft)||ft.contentEditable==="true")&&(Ou=ft,hS=ve,Ip=null);break;case"focusout":Ip=hS=Ou=null;break;case"mousedown":pS=!0;break;case"contextmenu":case"mouseup":case"dragend":pS=!1,NI(Re,y,je);break;case"selectionchange":if(HB)break;case"keydown":case"keyup":NI(Re,y,je)}var gt;if(lS)e:{switch(d){case"compositionstart":var xt="onCompositionStart";break e;case"compositionend":xt="onCompositionEnd";break e;case"compositionupdate":xt="onCompositionUpdate";break e}xt=void 0}else Du?kI(d,y)&&(xt="onCompositionEnd"):d==="keydown"&&y.keyCode===229&&(xt="onCompositionStart");xt&&(wI&&y.locale!=="ko"&&(Du||xt!=="onCompositionStart"?xt==="onCompositionEnd"&&Du&&(gt=vo()):(Nn=je,An="value"in Nn?Nn.value:Nn.textContent,Du=!0)),ft=bm(ve,xt),0<ft.length&&(xt=new SI(xt,d,null,y,je),Re.push({event:xt,listeners:ft}),gt?xt.data=gt:(gt=PI(y),gt!==null&&(xt.data=gt)))),(gt=AB?jB(d,y):RB(d,y))&&(ve=bm(ve,"onBeforeInput"),0<ve.length&&(je=new SI("onBeforeInput","beforeinput",null,y,je),Re.push({event:je,listeners:ve}),je.data=gt))}KI(Re,h)})}function Mp(d,h,y){return{instance:d,listener:h,currentTarget:y}}function bm(d,h){for(var y=h+"Capture",x=[];d!==null;){var _=d,A=_.stateNode;_.tag===5&&A!==null&&(_=A,A=go(d,y),A!=null&&x.unshift(Mp(d,A,_)),A=go(d,h),A!=null&&x.push(Mp(d,A,_))),d=d.return}return x}function Nu(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function qI(d,h,y,x,_){for(var A=h._reactName,F=[];y!==null&&y!==x;){var Q=y,te=Q.alternate,ve=Q.stateNode;if(te!==null&&te===x)break;Q.tag===5&&ve!==null&&(Q=ve,_?(te=go(y,A),te!=null&&F.unshift(Mp(y,te,Q))):_||(te=go(y,A),te!=null&&F.push(Mp(y,te,Q)))),y=y.return}F.length!==0&&d.push({event:h,listeners:F})}var VB=/\r\n?/g,qB=/\u0000|\uFFFD/g;function YI(d){return(typeof d=="string"?d:""+d).replace(VB,`
`).replace(qB,"")}function Sm(d,h,y){if(h=YI(h),YI(d)!==h&&y)throw Error(t(425))}function xm(){}var bS=null,SS=null;function xS(d,h){return d==="textarea"||d==="noscript"||typeof h.children=="string"||typeof h.children=="number"||typeof h.dangerouslySetInnerHTML=="object"&&h.dangerouslySetInnerHTML!==null&&h.dangerouslySetInnerHTML.__html!=null}var wS=typeof setTimeout=="function"?setTimeout:void 0,YB=typeof clearTimeout=="function"?clearTimeout:void 0,XI=typeof Promise=="function"?Promise:void 0,XB=typeof queueMicrotask=="function"?queueMicrotask:typeof XI<"u"?function(d){return XI.resolve(null).then(d).catch(ZB)}:wS;function ZB(d){setTimeout(function(){throw d})}function CS(d,h){var y=h,x=0;do{var _=y.nextSibling;if(d.removeChild(y),_&&_.nodeType===8)if(y=_.data,y==="/$"){if(x===0){d.removeChild(_),kd(h);return}x--}else y!=="$"&&y!=="$?"&&y!=="$!"||x++;y=_}while(y);kd(h)}function yc(d){for(;d!=null;d=d.nextSibling){var h=d.nodeType;if(h===1||h===3)break;if(h===8){if(h=d.data,h==="$"||h==="$!"||h==="$?")break;if(h==="/$")return null}}return d}function ZI(d){d=d.previousSibling;for(var h=0;d;){if(d.nodeType===8){var y=d.data;if(y==="$"||y==="$!"||y==="$?"){if(h===0)return d;h--}else y==="/$"&&h++}d=d.previousSibling}return null}var Fu=Math.random().toString(36).slice(2),Aa="__reactFiber$"+Fu,Ap="__reactProps$"+Fu,wl="__reactContainer$"+Fu,ES="__reactEvents$"+Fu,JB="__reactListeners$"+Fu,QB="__reactHandles$"+Fu;function Pd(d){var h=d[Aa];if(h)return h;for(var y=d.parentNode;y;){if(h=y[wl]||y[Aa]){if(y=h.alternate,h.child!==null||y!==null&&y.child!==null)for(d=ZI(d);d!==null;){if(y=d[Aa])return y;d=ZI(d)}return h}d=y,y=d.parentNode}return null}function jp(d){return d=d[Aa]||d[wl],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function zu(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(t(33))}function wm(d){return d[Ap]||null}var kS=[],$u=-1;function vc(d){return{current:d}}function Gn(d){0>$u||(d.current=kS[$u],kS[$u]=null,$u--)}function Fn(d,h){$u++,kS[$u]=d.current,d.current=h}var bc={},Is=vc(bc),bo=vc(!1),Id=bc;function Bu(d,h){var y=d.type.contextTypes;if(!y)return bc;var x=d.stateNode;if(x&&x.__reactInternalMemoizedUnmaskedChildContext===h)return x.__reactInternalMemoizedMaskedChildContext;var _={},A;for(A in y)_[A]=h[A];return x&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=h,d.__reactInternalMemoizedMaskedChildContext=_),_}function So(d){return d=d.childContextTypes,d!=null}function Cm(){Gn(bo),Gn(Is)}function JI(d,h,y){if(Is.current!==bc)throw Error(t(168));Fn(Is,h),Fn(bo,y)}function QI(d,h,y){var x=d.stateNode;if(h=h.childContextTypes,typeof x.getChildContext!="function")return y;x=x.getChildContext();for(var _ in x)if(!(_ in h))throw Error(t(108,Be(d)||"Unknown",_));return ae({},y,x)}function Em(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||bc,Id=Is.current,Fn(Is,d),Fn(bo,bo.current),!0}function e_(d,h,y){var x=d.stateNode;if(!x)throw Error(t(169));y?(d=QI(d,h,Id),x.__reactInternalMemoizedMergedChildContext=d,Gn(bo),Gn(Is),Fn(Is,d)):Gn(bo),Fn(bo,y)}var Cl=null,km=!1,PS=!1;function t_(d){Cl===null?Cl=[d]:Cl.push(d)}function eU(d){km=!0,t_(d)}function Sc(){if(!PS&&Cl!==null){PS=!0;var d=0,h=nn;try{var y=Cl;for(nn=1;d<y.length;d++){var x=y[d];do x=x(!0);while(x!==null)}Cl=null,km=!1}catch(_){throw Cl!==null&&(Cl=Cl.slice(d+1)),ce(Ct,Sc),_}finally{nn=h,PS=!1}}return null}var Uu=[],Hu=0,Pm=null,Im=0,yi=[],vi=0,_d=null,El=1,kl="";function Td(d,h){Uu[Hu++]=Im,Uu[Hu++]=Pm,Pm=d,Im=h}function n_(d,h,y){yi[vi++]=El,yi[vi++]=kl,yi[vi++]=_d,_d=d;var x=El;d=kl;var _=32-tr(x)-1;x&=~(1<<_),y+=1;var A=32-tr(h)+_;if(30<A){var F=_-_%5;A=(x&(1<<F)-1).toString(32),x>>=F,_-=F,El=1<<32-tr(h)+_|y<<_|x,kl=A+d}else El=1<<A|y<<_|x,kl=d}function IS(d){d.return!==null&&(Td(d,1),n_(d,1,0))}function _S(d){for(;d===Pm;)Pm=Uu[--Hu],Uu[Hu]=null,Im=Uu[--Hu],Uu[Hu]=null;for(;d===_d;)_d=yi[--vi],yi[vi]=null,kl=yi[--vi],yi[vi]=null,El=yi[--vi],yi[vi]=null}var Yo=null,Xo=null,Xn=!1,qi=null;function r_(d,h){var y=wi(5,null,null,0);y.elementType="DELETED",y.stateNode=h,y.return=d,h=d.deletions,h===null?(d.deletions=[y],d.flags|=16):h.push(y)}function s_(d,h){switch(d.tag){case 5:var y=d.type;return h=h.nodeType!==1||y.toLowerCase()!==h.nodeName.toLowerCase()?null:h,h!==null?(d.stateNode=h,Yo=d,Xo=yc(h.firstChild),!0):!1;case 6:return h=d.pendingProps===""||h.nodeType!==3?null:h,h!==null?(d.stateNode=h,Yo=d,Xo=null,!0):!1;case 13:return h=h.nodeType!==8?null:h,h!==null?(y=_d!==null?{id:El,overflow:kl}:null,d.memoizedState={dehydrated:h,treeContext:y,retryLane:1073741824},y=wi(18,null,null,0),y.stateNode=h,y.return=d,d.child=y,Yo=d,Xo=null,!0):!1;default:return!1}}function TS(d){return(d.mode&1)!==0&&(d.flags&128)===0}function MS(d){if(Xn){var h=Xo;if(h){var y=h;if(!s_(d,h)){if(TS(d))throw Error(t(418));h=yc(y.nextSibling);var x=Yo;h&&s_(d,h)?r_(x,y):(d.flags=d.flags&-4097|2,Xn=!1,Yo=d)}}else{if(TS(d))throw Error(t(418));d.flags=d.flags&-4097|2,Xn=!1,Yo=d}}}function o_(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;Yo=d}function _m(d){if(d!==Yo)return!1;if(!Xn)return o_(d),Xn=!0,!1;var h;if((h=d.tag!==3)&&!(h=d.tag!==5)&&(h=d.type,h=h!=="head"&&h!=="body"&&!xS(d.type,d.memoizedProps)),h&&(h=Xo)){if(TS(d))throw i_(),Error(t(418));for(;h;)r_(d,h),h=yc(h.nextSibling)}if(o_(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(t(317));e:{for(d=d.nextSibling,h=0;d;){if(d.nodeType===8){var y=d.data;if(y==="/$"){if(h===0){Xo=yc(d.nextSibling);break e}h--}else y!=="$"&&y!=="$!"&&y!=="$?"||h++}d=d.nextSibling}Xo=null}}else Xo=Yo?yc(d.stateNode.nextSibling):null;return!0}function i_(){for(var d=Xo;d;)d=yc(d.nextSibling)}function Gu(){Xo=Yo=null,Xn=!1}function AS(d){qi===null?qi=[d]:qi.push(d)}var tU=w.ReactCurrentBatchConfig;function Rp(d,h,y){if(d=y.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(y._owner){if(y=y._owner,y){if(y.tag!==1)throw Error(t(309));var x=y.stateNode}if(!x)throw Error(t(147,d));var _=x,A=""+d;return h!==null&&h.ref!==null&&typeof h.ref=="function"&&h.ref._stringRef===A?h.ref:(h=function(F){var Q=_.refs;F===null?delete Q[A]:Q[A]=F},h._stringRef=A,h)}if(typeof d!="string")throw Error(t(284));if(!y._owner)throw Error(t(290,d))}return d}function Tm(d,h){throw d=Object.prototype.toString.call(h),Error(t(31,d==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":d))}function a_(d){var h=d._init;return h(d._payload)}function l_(d){function h(pe,ie){if(d){var me=pe.deletions;me===null?(pe.deletions=[ie],pe.flags|=16):me.push(ie)}}function y(pe,ie){if(!d)return null;for(;ie!==null;)h(pe,ie),ie=ie.sibling;return null}function x(pe,ie){for(pe=new Map;ie!==null;)ie.key!==null?pe.set(ie.key,ie):pe.set(ie.index,ie),ie=ie.sibling;return pe}function _(pe,ie){return pe=_c(pe,ie),pe.index=0,pe.sibling=null,pe}function A(pe,ie,me){return pe.index=me,d?(me=pe.alternate,me!==null?(me=me.index,me<ie?(pe.flags|=2,ie):me):(pe.flags|=2,ie)):(pe.flags|=1048576,ie)}function F(pe){return d&&pe.alternate===null&&(pe.flags|=2),pe}function Q(pe,ie,me,ze){return ie===null||ie.tag!==6?(ie=wx(me,pe.mode,ze),ie.return=pe,ie):(ie=_(ie,me),ie.return=pe,ie)}function te(pe,ie,me,ze){var st=me.type;return st===D?je(pe,ie,me.props.children,ze,me.key):ie!==null&&(ie.elementType===st||typeof st=="object"&&st!==null&&st.$$typeof===H&&a_(st)===ie.type)?(ze=_(ie,me.props),ze.ref=Rp(pe,ie,me),ze.return=pe,ze):(ze=Qm(me.type,me.key,me.props,null,pe.mode,ze),ze.ref=Rp(pe,ie,me),ze.return=pe,ze)}function ve(pe,ie,me,ze){return ie===null||ie.tag!==4||ie.stateNode.containerInfo!==me.containerInfo||ie.stateNode.implementation!==me.implementation?(ie=Cx(me,pe.mode,ze),ie.return=pe,ie):(ie=_(ie,me.children||[]),ie.return=pe,ie)}function je(pe,ie,me,ze,st){return ie===null||ie.tag!==7?(ie=Nd(me,pe.mode,ze,st),ie.return=pe,ie):(ie=_(ie,me),ie.return=pe,ie)}function Re(pe,ie,me){if(typeof ie=="string"&&ie!==""||typeof ie=="number")return ie=wx(""+ie,pe.mode,me),ie.return=pe,ie;if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case M:return me=Qm(ie.type,ie.key,ie.props,null,pe.mode,me),me.ref=Rp(pe,null,ie),me.return=pe,me;case R:return ie=Cx(ie,pe.mode,me),ie.return=pe,ie;case H:var ze=ie._init;return Re(pe,ze(ie._payload),me)}if(Sr(ie)||ne(ie))return ie=Nd(ie,pe.mode,me,null),ie.return=pe,ie;Tm(pe,ie)}return null}function Ae(pe,ie,me,ze){var st=ie!==null?ie.key:null;if(typeof me=="string"&&me!==""||typeof me=="number")return st!==null?null:Q(pe,ie,""+me,ze);if(typeof me=="object"&&me!==null){switch(me.$$typeof){case M:return me.key===st?te(pe,ie,me,ze):null;case R:return me.key===st?ve(pe,ie,me,ze):null;case H:return st=me._init,Ae(pe,ie,st(me._payload),ze)}if(Sr(me)||ne(me))return st!==null?null:je(pe,ie,me,ze,null);Tm(pe,me)}return null}function qe(pe,ie,me,ze,st){if(typeof ze=="string"&&ze!==""||typeof ze=="number")return pe=pe.get(me)||null,Q(ie,pe,""+ze,st);if(typeof ze=="object"&&ze!==null){switch(ze.$$typeof){case M:return pe=pe.get(ze.key===null?me:ze.key)||null,te(ie,pe,ze,st);case R:return pe=pe.get(ze.key===null?me:ze.key)||null,ve(ie,pe,ze,st);case H:var ft=ze._init;return qe(pe,ie,me,ft(ze._payload),st)}if(Sr(ze)||ne(ze))return pe=pe.get(me)||null,je(ie,pe,ze,st,null);Tm(ie,ze)}return null}function tt(pe,ie,me,ze){for(var st=null,ft=null,gt=ie,xt=ie=0,Zr=null;gt!==null&&xt<me.length;xt++){gt.index>xt?(Zr=gt,gt=null):Zr=gt.sibling;var un=Ae(pe,gt,me[xt],ze);if(un===null){gt===null&&(gt=Zr);break}d&&gt&&un.alternate===null&&h(pe,gt),ie=A(un,ie,xt),ft===null?st=un:ft.sibling=un,ft=un,gt=Zr}if(xt===me.length)return y(pe,gt),Xn&&Td(pe,xt),st;if(gt===null){for(;xt<me.length;xt++)gt=Re(pe,me[xt],ze),gt!==null&&(ie=A(gt,ie,xt),ft===null?st=gt:ft.sibling=gt,ft=gt);return Xn&&Td(pe,xt),st}for(gt=x(pe,gt);xt<me.length;xt++)Zr=qe(gt,pe,xt,me[xt],ze),Zr!==null&&(d&&Zr.alternate!==null&&gt.delete(Zr.key===null?xt:Zr.key),ie=A(Zr,ie,xt),ft===null?st=Zr:ft.sibling=Zr,ft=Zr);return d&&gt.forEach(function(Tc){return h(pe,Tc)}),Xn&&Td(pe,xt),st}function rt(pe,ie,me,ze){var st=ne(me);if(typeof st!="function")throw Error(t(150));if(me=st.call(me),me==null)throw Error(t(151));for(var ft=st=null,gt=ie,xt=ie=0,Zr=null,un=me.next();gt!==null&&!un.done;xt++,un=me.next()){gt.index>xt?(Zr=gt,gt=null):Zr=gt.sibling;var Tc=Ae(pe,gt,un.value,ze);if(Tc===null){gt===null&&(gt=Zr);break}d&&gt&&Tc.alternate===null&&h(pe,gt),ie=A(Tc,ie,xt),ft===null?st=Tc:ft.sibling=Tc,ft=Tc,gt=Zr}if(un.done)return y(pe,gt),Xn&&Td(pe,xt),st;if(gt===null){for(;!un.done;xt++,un=me.next())un=Re(pe,un.value,ze),un!==null&&(ie=A(un,ie,xt),ft===null?st=un:ft.sibling=un,ft=un);return Xn&&Td(pe,xt),st}for(gt=x(pe,gt);!un.done;xt++,un=me.next())un=qe(gt,pe,xt,un.value,ze),un!==null&&(d&&un.alternate!==null&&gt.delete(un.key===null?xt:un.key),ie=A(un,ie,xt),ft===null?st=un:ft.sibling=un,ft=un);return d&&gt.forEach(function(DU){return h(pe,DU)}),Xn&&Td(pe,xt),st}function Cr(pe,ie,me,ze){if(typeof me=="object"&&me!==null&&me.type===D&&me.key===null&&(me=me.props.children),typeof me=="object"&&me!==null){switch(me.$$typeof){case M:e:{for(var st=me.key,ft=ie;ft!==null;){if(ft.key===st){if(st=me.type,st===D){if(ft.tag===7){y(pe,ft.sibling),ie=_(ft,me.props.children),ie.return=pe,pe=ie;break e}}else if(ft.elementType===st||typeof st=="object"&&st!==null&&st.$$typeof===H&&a_(st)===ft.type){y(pe,ft.sibling),ie=_(ft,me.props),ie.ref=Rp(pe,ft,me),ie.return=pe,pe=ie;break e}y(pe,ft);break}else h(pe,ft);ft=ft.sibling}me.type===D?(ie=Nd(me.props.children,pe.mode,ze,me.key),ie.return=pe,pe=ie):(ze=Qm(me.type,me.key,me.props,null,pe.mode,ze),ze.ref=Rp(pe,ie,me),ze.return=pe,pe=ze)}return F(pe);case R:e:{for(ft=me.key;ie!==null;){if(ie.key===ft)if(ie.tag===4&&ie.stateNode.containerInfo===me.containerInfo&&ie.stateNode.implementation===me.implementation){y(pe,ie.sibling),ie=_(ie,me.children||[]),ie.return=pe,pe=ie;break e}else{y(pe,ie);break}else h(pe,ie);ie=ie.sibling}ie=Cx(me,pe.mode,ze),ie.return=pe,pe=ie}return F(pe);case H:return ft=me._init,Cr(pe,ie,ft(me._payload),ze)}if(Sr(me))return tt(pe,ie,me,ze);if(ne(me))return rt(pe,ie,me,ze);Tm(pe,me)}return typeof me=="string"&&me!==""||typeof me=="number"?(me=""+me,ie!==null&&ie.tag===6?(y(pe,ie.sibling),ie=_(ie,me),ie.return=pe,pe=ie):(y(pe,ie),ie=wx(me,pe.mode,ze),ie.return=pe,pe=ie),F(pe)):y(pe,ie)}return Cr}var Wu=l_(!0),c_=l_(!1),Mm=vc(null),Am=null,Ku=null,jS=null;function RS(){jS=Ku=Am=null}function DS(d){var h=Mm.current;Gn(Mm),d._currentValue=h}function OS(d,h,y){for(;d!==null;){var x=d.alternate;if((d.childLanes&h)!==h?(d.childLanes|=h,x!==null&&(x.childLanes|=h)):x!==null&&(x.childLanes&h)!==h&&(x.childLanes|=h),d===y)break;d=d.return}}function Vu(d,h){Am=d,jS=Ku=null,d=d.dependencies,d!==null&&d.firstContext!==null&&(d.lanes&h&&(xo=!0),d.firstContext=null)}function bi(d){var h=d._currentValue;if(jS!==d)if(d={context:d,memoizedValue:h,next:null},Ku===null){if(Am===null)throw Error(t(308));Ku=d,Am.dependencies={lanes:0,firstContext:d}}else Ku=Ku.next=d;return h}var Md=null;function LS(d){Md===null?Md=[d]:Md.push(d)}function d_(d,h,y,x){var _=h.interleaved;return _===null?(y.next=y,LS(h)):(y.next=_.next,_.next=y),h.interleaved=y,Pl(d,x)}function Pl(d,h){d.lanes|=h;var y=d.alternate;for(y!==null&&(y.lanes|=h),y=d,d=d.return;d!==null;)d.childLanes|=h,y=d.alternate,y!==null&&(y.childLanes|=h),y=d,d=d.return;return y.tag===3?y.stateNode:null}var xc=!1;function NS(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function u_(d,h){d=d.updateQueue,h.updateQueue===d&&(h.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function Il(d,h){return{eventTime:d,lane:h,tag:0,payload:null,callback:null,next:null}}function wc(d,h,y){var x=d.updateQueue;if(x===null)return null;if(x=x.shared,on&2){var _=x.pending;return _===null?h.next=h:(h.next=_.next,_.next=h),x.pending=h,Pl(d,y)}return _=x.interleaved,_===null?(h.next=h,LS(x)):(h.next=_.next,_.next=h),x.interleaved=h,Pl(d,y)}function jm(d,h,y){if(h=h.updateQueue,h!==null&&(h=h.shared,(y&4194240)!==0)){var x=h.lanes;x&=d.pendingLanes,y|=x,h.lanes=y,Au(d,y)}}function h_(d,h){var y=d.updateQueue,x=d.alternate;if(x!==null&&(x=x.updateQueue,y===x)){var _=null,A=null;if(y=y.firstBaseUpdate,y!==null){do{var F={eventTime:y.eventTime,lane:y.lane,tag:y.tag,payload:y.payload,callback:y.callback,next:null};A===null?_=A=F:A=A.next=F,y=y.next}while(y!==null);A===null?_=A=h:A=A.next=h}else _=A=h;y={baseState:x.baseState,firstBaseUpdate:_,lastBaseUpdate:A,shared:x.shared,effects:x.effects},d.updateQueue=y;return}d=y.lastBaseUpdate,d===null?y.firstBaseUpdate=h:d.next=h,y.lastBaseUpdate=h}function Rm(d,h,y,x){var _=d.updateQueue;xc=!1;var A=_.firstBaseUpdate,F=_.lastBaseUpdate,Q=_.shared.pending;if(Q!==null){_.shared.pending=null;var te=Q,ve=te.next;te.next=null,F===null?A=ve:F.next=ve,F=te;var je=d.alternate;je!==null&&(je=je.updateQueue,Q=je.lastBaseUpdate,Q!==F&&(Q===null?je.firstBaseUpdate=ve:Q.next=ve,je.lastBaseUpdate=te))}if(A!==null){var Re=_.baseState;F=0,je=ve=te=null,Q=A;do{var Ae=Q.lane,qe=Q.eventTime;if((x&Ae)===Ae){je!==null&&(je=je.next={eventTime:qe,lane:0,tag:Q.tag,payload:Q.payload,callback:Q.callback,next:null});e:{var tt=d,rt=Q;switch(Ae=h,qe=y,rt.tag){case 1:if(tt=rt.payload,typeof tt=="function"){Re=tt.call(qe,Re,Ae);break e}Re=tt;break e;case 3:tt.flags=tt.flags&-65537|128;case 0:if(tt=rt.payload,Ae=typeof tt=="function"?tt.call(qe,Re,Ae):tt,Ae==null)break e;Re=ae({},Re,Ae);break e;case 2:xc=!0}}Q.callback!==null&&Q.lane!==0&&(d.flags|=64,Ae=_.effects,Ae===null?_.effects=[Q]:Ae.push(Q))}else qe={eventTime:qe,lane:Ae,tag:Q.tag,payload:Q.payload,callback:Q.callback,next:null},je===null?(ve=je=qe,te=Re):je=je.next=qe,F|=Ae;if(Q=Q.next,Q===null){if(Q=_.shared.pending,Q===null)break;Ae=Q,Q=Ae.next,Ae.next=null,_.lastBaseUpdate=Ae,_.shared.pending=null}}while(!0);if(je===null&&(te=Re),_.baseState=te,_.firstBaseUpdate=ve,_.lastBaseUpdate=je,h=_.shared.interleaved,h!==null){_=h;do F|=_.lane,_=_.next;while(_!==h)}else A===null&&(_.shared.lanes=0);Rd|=F,d.lanes=F,d.memoizedState=Re}}function p_(d,h,y){if(d=h.effects,h.effects=null,d!==null)for(h=0;h<d.length;h++){var x=d[h],_=x.callback;if(_!==null){if(x.callback=null,x=y,typeof _!="function")throw Error(t(191,_));_.call(x)}}}var Dp={},ja=vc(Dp),Op=vc(Dp),Lp=vc(Dp);function Ad(d){if(d===Dp)throw Error(t(174));return d}function FS(d,h){switch(Fn(Lp,h),Fn(Op,d),Fn(ja,Dp),d=h.nodeType,d){case 9:case 11:h=(h=h.documentElement)?h.namespaceURI:he(null,"");break;default:d=d===8?h.parentNode:h,h=d.namespaceURI||null,d=d.tagName,h=he(h,d)}Gn(ja),Fn(ja,h)}function qu(){Gn(ja),Gn(Op),Gn(Lp)}function f_(d){Ad(Lp.current);var h=Ad(ja.current),y=he(h,d.type);h!==y&&(Fn(Op,d),Fn(ja,y))}function zS(d){Op.current===d&&(Gn(ja),Gn(Op))}var rr=vc(0);function Dm(d){for(var h=d;h!==null;){if(h.tag===13){var y=h.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||y.data==="$?"||y.data==="$!"))return h}else if(h.tag===19&&h.memoizedProps.revealOrder!==void 0){if(h.flags&128)return h}else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===d)break;for(;h.sibling===null;){if(h.return===null||h.return===d)return null;h=h.return}h.sibling.return=h.return,h=h.sibling}return null}var $S=[];function BS(){for(var d=0;d<$S.length;d++)$S[d]._workInProgressVersionPrimary=null;$S.length=0}var Om=w.ReactCurrentDispatcher,US=w.ReactCurrentBatchConfig,jd=0,sr=null,Br=null,Yr=null,Lm=!1,Np=!1,Fp=0,nU=0;function _s(){throw Error(t(321))}function HS(d,h){if(h===null)return!1;for(var y=0;y<h.length&&y<d.length;y++)if(!Vi(d[y],h[y]))return!1;return!0}function GS(d,h,y,x,_,A){if(jd=A,sr=h,h.memoizedState=null,h.updateQueue=null,h.lanes=0,Om.current=d===null||d.memoizedState===null?iU:aU,d=y(x,_),Np){A=0;do{if(Np=!1,Fp=0,25<=A)throw Error(t(301));A+=1,Yr=Br=null,h.updateQueue=null,Om.current=lU,d=y(x,_)}while(Np)}if(Om.current=zm,h=Br!==null&&Br.next!==null,jd=0,Yr=Br=sr=null,Lm=!1,h)throw Error(t(300));return d}function WS(){var d=Fp!==0;return Fp=0,d}function Ra(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Yr===null?sr.memoizedState=Yr=d:Yr=Yr.next=d,Yr}function Si(){if(Br===null){var d=sr.alternate;d=d!==null?d.memoizedState:null}else d=Br.next;var h=Yr===null?sr.memoizedState:Yr.next;if(h!==null)Yr=h,Br=d;else{if(d===null)throw Error(t(310));Br=d,d={memoizedState:Br.memoizedState,baseState:Br.baseState,baseQueue:Br.baseQueue,queue:Br.queue,next:null},Yr===null?sr.memoizedState=Yr=d:Yr=Yr.next=d}return Yr}function zp(d,h){return typeof h=="function"?h(d):h}function KS(d){var h=Si(),y=h.queue;if(y===null)throw Error(t(311));y.lastRenderedReducer=d;var x=Br,_=x.baseQueue,A=y.pending;if(A!==null){if(_!==null){var F=_.next;_.next=A.next,A.next=F}x.baseQueue=_=A,y.pending=null}if(_!==null){A=_.next,x=x.baseState;var Q=F=null,te=null,ve=A;do{var je=ve.lane;if((jd&je)===je)te!==null&&(te=te.next={lane:0,action:ve.action,hasEagerState:ve.hasEagerState,eagerState:ve.eagerState,next:null}),x=ve.hasEagerState?ve.eagerState:d(x,ve.action);else{var Re={lane:je,action:ve.action,hasEagerState:ve.hasEagerState,eagerState:ve.eagerState,next:null};te===null?(Q=te=Re,F=x):te=te.next=Re,sr.lanes|=je,Rd|=je}ve=ve.next}while(ve!==null&&ve!==A);te===null?F=x:te.next=Q,Vi(x,h.memoizedState)||(xo=!0),h.memoizedState=x,h.baseState=F,h.baseQueue=te,y.lastRenderedState=x}if(d=y.interleaved,d!==null){_=d;do A=_.lane,sr.lanes|=A,Rd|=A,_=_.next;while(_!==d)}else _===null&&(y.lanes=0);return[h.memoizedState,y.dispatch]}function VS(d){var h=Si(),y=h.queue;if(y===null)throw Error(t(311));y.lastRenderedReducer=d;var x=y.dispatch,_=y.pending,A=h.memoizedState;if(_!==null){y.pending=null;var F=_=_.next;do A=d(A,F.action),F=F.next;while(F!==_);Vi(A,h.memoizedState)||(xo=!0),h.memoizedState=A,h.baseQueue===null&&(h.baseState=A),y.lastRenderedState=A}return[A,x]}function g_(){}function m_(d,h){var y=sr,x=Si(),_=h(),A=!Vi(x.memoizedState,_);if(A&&(x.memoizedState=_,xo=!0),x=x.queue,qS(b_.bind(null,y,x,d),[d]),x.getSnapshot!==h||A||Yr!==null&&Yr.memoizedState.tag&1){if(y.flags|=2048,$p(9,v_.bind(null,y,x,_,h),void 0,null),Xr===null)throw Error(t(349));jd&30||y_(y,h,_)}return _}function y_(d,h,y){d.flags|=16384,d={getSnapshot:h,value:y},h=sr.updateQueue,h===null?(h={lastEffect:null,stores:null},sr.updateQueue=h,h.stores=[d]):(y=h.stores,y===null?h.stores=[d]:y.push(d))}function v_(d,h,y,x){h.value=y,h.getSnapshot=x,S_(h)&&x_(d)}function b_(d,h,y){return y(function(){S_(h)&&x_(d)})}function S_(d){var h=d.getSnapshot;d=d.value;try{var y=h();return!Vi(d,y)}catch{return!0}}function x_(d){var h=Pl(d,1);h!==null&&Ji(h,d,1,-1)}function w_(d){var h=Ra();return typeof d=="function"&&(d=d()),h.memoizedState=h.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:zp,lastRenderedState:d},h.queue=d,d=d.dispatch=oU.bind(null,sr,d),[h.memoizedState,d]}function $p(d,h,y,x){return d={tag:d,create:h,destroy:y,deps:x,next:null},h=sr.updateQueue,h===null?(h={lastEffect:null,stores:null},sr.updateQueue=h,h.lastEffect=d.next=d):(y=h.lastEffect,y===null?h.lastEffect=d.next=d:(x=y.next,y.next=d,d.next=x,h.lastEffect=d)),d}function C_(){return Si().memoizedState}function Nm(d,h,y,x){var _=Ra();sr.flags|=d,_.memoizedState=$p(1|h,y,void 0,x===void 0?null:x)}function Fm(d,h,y,x){var _=Si();x=x===void 0?null:x;var A=void 0;if(Br!==null){var F=Br.memoizedState;if(A=F.destroy,x!==null&&HS(x,F.deps)){_.memoizedState=$p(h,y,A,x);return}}sr.flags|=d,_.memoizedState=$p(1|h,y,A,x)}function E_(d,h){return Nm(8390656,8,d,h)}function qS(d,h){return Fm(2048,8,d,h)}function k_(d,h){return Fm(4,2,d,h)}function P_(d,h){return Fm(4,4,d,h)}function I_(d,h){if(typeof h=="function")return d=d(),h(d),function(){h(null)};if(h!=null)return d=d(),h.current=d,function(){h.current=null}}function __(d,h,y){return y=y!=null?y.concat([d]):null,Fm(4,4,I_.bind(null,h,d),y)}function YS(){}function T_(d,h){var y=Si();h=h===void 0?null:h;var x=y.memoizedState;return x!==null&&h!==null&&HS(h,x[1])?x[0]:(y.memoizedState=[d,h],d)}function M_(d,h){var y=Si();h=h===void 0?null:h;var x=y.memoizedState;return x!==null&&h!==null&&HS(h,x[1])?x[0]:(d=d(),y.memoizedState=[d,h],d)}function A_(d,h,y){return jd&21?(Vi(y,h)||(y=hc(),sr.lanes|=y,Rd|=y,d.baseState=!0),h):(d.baseState&&(d.baseState=!1,xo=!0),d.memoizedState=y)}function rU(d,h){var y=nn;nn=y!==0&&4>y?y:4,d(!0);var x=US.transition;US.transition={};try{d(!1),h()}finally{nn=y,US.transition=x}}function j_(){return Si().memoizedState}function sU(d,h,y){var x=Pc(d);if(y={lane:x,action:y,hasEagerState:!1,eagerState:null,next:null},R_(d))D_(h,y);else if(y=d_(d,h,y,x),y!==null){var _=to();Ji(y,d,x,_),O_(y,h,x)}}function oU(d,h,y){var x=Pc(d),_={lane:x,action:y,hasEagerState:!1,eagerState:null,next:null};if(R_(d))D_(h,_);else{var A=d.alternate;if(d.lanes===0&&(A===null||A.lanes===0)&&(A=h.lastRenderedReducer,A!==null))try{var F=h.lastRenderedState,Q=A(F,y);if(_.hasEagerState=!0,_.eagerState=Q,Vi(Q,F)){var te=h.interleaved;te===null?(_.next=_,LS(h)):(_.next=te.next,te.next=_),h.interleaved=_;return}}catch{}finally{}y=d_(d,h,_,x),y!==null&&(_=to(),Ji(y,d,x,_),O_(y,h,x))}}function R_(d){var h=d.alternate;return d===sr||h!==null&&h===sr}function D_(d,h){Np=Lm=!0;var y=d.pending;y===null?h.next=h:(h.next=y.next,y.next=h),d.pending=h}function O_(d,h,y){if(y&4194240){var x=h.lanes;x&=d.pendingLanes,y|=x,h.lanes=y,Au(d,y)}}var zm={readContext:bi,useCallback:_s,useContext:_s,useEffect:_s,useImperativeHandle:_s,useInsertionEffect:_s,useLayoutEffect:_s,useMemo:_s,useReducer:_s,useRef:_s,useState:_s,useDebugValue:_s,useDeferredValue:_s,useTransition:_s,useMutableSource:_s,useSyncExternalStore:_s,useId:_s,unstable_isNewReconciler:!1},iU={readContext:bi,useCallback:function(d,h){return Ra().memoizedState=[d,h===void 0?null:h],d},useContext:bi,useEffect:E_,useImperativeHandle:function(d,h,y){return y=y!=null?y.concat([d]):null,Nm(4194308,4,I_.bind(null,h,d),y)},useLayoutEffect:function(d,h){return Nm(4194308,4,d,h)},useInsertionEffect:function(d,h){return Nm(4,2,d,h)},useMemo:function(d,h){var y=Ra();return h=h===void 0?null:h,d=d(),y.memoizedState=[d,h],d},useReducer:function(d,h,y){var x=Ra();return h=y!==void 0?y(h):h,x.memoizedState=x.baseState=h,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:h},x.queue=d,d=d.dispatch=sU.bind(null,sr,d),[x.memoizedState,d]},useRef:function(d){var h=Ra();return d={current:d},h.memoizedState=d},useState:w_,useDebugValue:YS,useDeferredValue:function(d){return Ra().memoizedState=d},useTransition:function(){var d=w_(!1),h=d[0];return d=rU.bind(null,d[1]),Ra().memoizedState=d,[h,d]},useMutableSource:function(){},useSyncExternalStore:function(d,h,y){var x=sr,_=Ra();if(Xn){if(y===void 0)throw Error(t(407));y=y()}else{if(y=h(),Xr===null)throw Error(t(349));jd&30||y_(x,h,y)}_.memoizedState=y;var A={value:y,getSnapshot:h};return _.queue=A,E_(b_.bind(null,x,A,d),[d]),x.flags|=2048,$p(9,v_.bind(null,x,A,y,h),void 0,null),y},useId:function(){var d=Ra(),h=Xr.identifierPrefix;if(Xn){var y=kl,x=El;y=(x&~(1<<32-tr(x)-1)).toString(32)+y,h=":"+h+"R"+y,y=Fp++,0<y&&(h+="H"+y.toString(32)),h+=":"}else y=nU++,h=":"+h+"r"+y.toString(32)+":";return d.memoizedState=h},unstable_isNewReconciler:!1},aU={readContext:bi,useCallback:T_,useContext:bi,useEffect:qS,useImperativeHandle:__,useInsertionEffect:k_,useLayoutEffect:P_,useMemo:M_,useReducer:KS,useRef:C_,useState:function(){return KS(zp)},useDebugValue:YS,useDeferredValue:function(d){var h=Si();return A_(h,Br.memoizedState,d)},useTransition:function(){var d=KS(zp)[0],h=Si().memoizedState;return[d,h]},useMutableSource:g_,useSyncExternalStore:m_,useId:j_,unstable_isNewReconciler:!1},lU={readContext:bi,useCallback:T_,useContext:bi,useEffect:qS,useImperativeHandle:__,useInsertionEffect:k_,useLayoutEffect:P_,useMemo:M_,useReducer:VS,useRef:C_,useState:function(){return VS(zp)},useDebugValue:YS,useDeferredValue:function(d){var h=Si();return Br===null?h.memoizedState=d:A_(h,Br.memoizedState,d)},useTransition:function(){var d=VS(zp)[0],h=Si().memoizedState;return[d,h]},useMutableSource:g_,useSyncExternalStore:m_,useId:j_,unstable_isNewReconciler:!1};function Yi(d,h){if(d&&d.defaultProps){h=ae({},h),d=d.defaultProps;for(var y in d)h[y]===void 0&&(h[y]=d[y]);return h}return h}function XS(d,h,y,x){h=d.memoizedState,y=y(x,h),y=y==null?h:ae({},h,y),d.memoizedState=y,d.lanes===0&&(d.updateQueue.baseState=y)}var $m={isMounted:function(d){return(d=d._reactInternals)?$(d)===d:!1},enqueueSetState:function(d,h,y){d=d._reactInternals;var x=to(),_=Pc(d),A=Il(x,_);A.payload=h,y!=null&&(A.callback=y),h=wc(d,A,_),h!==null&&(Ji(h,d,_,x),jm(h,d,_))},enqueueReplaceState:function(d,h,y){d=d._reactInternals;var x=to(),_=Pc(d),A=Il(x,_);A.tag=1,A.payload=h,y!=null&&(A.callback=y),h=wc(d,A,_),h!==null&&(Ji(h,d,_,x),jm(h,d,_))},enqueueForceUpdate:function(d,h){d=d._reactInternals;var y=to(),x=Pc(d),_=Il(y,x);_.tag=2,h!=null&&(_.callback=h),h=wc(d,_,x),h!==null&&(Ji(h,d,x,y),jm(h,d,x))}};function L_(d,h,y,x,_,A,F){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(x,A,F):h.prototype&&h.prototype.isPureReactComponent?!Pp(y,x)||!Pp(_,A):!0}function N_(d,h,y){var x=!1,_=bc,A=h.contextType;return typeof A=="object"&&A!==null?A=bi(A):(_=So(h)?Id:Is.current,x=h.contextTypes,A=(x=x!=null)?Bu(d,_):bc),h=new h(y,A),d.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,h.updater=$m,d.stateNode=h,h._reactInternals=d,x&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=_,d.__reactInternalMemoizedMaskedChildContext=A),h}function F_(d,h,y,x){d=h.state,typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps(y,x),typeof h.UNSAFE_componentWillReceiveProps=="function"&&h.UNSAFE_componentWillReceiveProps(y,x),h.state!==d&&$m.enqueueReplaceState(h,h.state,null)}function ZS(d,h,y,x){var _=d.stateNode;_.props=y,_.state=d.memoizedState,_.refs={},NS(d);var A=h.contextType;typeof A=="object"&&A!==null?_.context=bi(A):(A=So(h)?Id:Is.current,_.context=Bu(d,A)),_.state=d.memoizedState,A=h.getDerivedStateFromProps,typeof A=="function"&&(XS(d,h,A,y),_.state=d.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(h=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),h!==_.state&&$m.enqueueReplaceState(_,_.state,null),Rm(d,y,_,x),_.state=d.memoizedState),typeof _.componentDidMount=="function"&&(d.flags|=4194308)}function Yu(d,h){try{var y="",x=h;do y+=Ee(x),x=x.return;while(x);var _=y}catch(A){_=`
Error generating stack: `+A.message+`
`+A.stack}return{value:d,source:h,stack:_,digest:null}}function JS(d,h,y){return{value:d,source:null,stack:y??null,digest:h??null}}function QS(d,h){try{console.error(h.value)}catch(y){setTimeout(function(){throw y})}}var cU=typeof WeakMap=="function"?WeakMap:Map;function z_(d,h,y){y=Il(-1,y),y.tag=3,y.payload={element:null};var x=h.value;return y.callback=function(){Vm||(Vm=!0,fx=x),QS(d,h)},y}function $_(d,h,y){y=Il(-1,y),y.tag=3;var x=d.type.getDerivedStateFromError;if(typeof x=="function"){var _=h.value;y.payload=function(){return x(_)},y.callback=function(){QS(d,h)}}var A=d.stateNode;return A!==null&&typeof A.componentDidCatch=="function"&&(y.callback=function(){QS(d,h),typeof x!="function"&&(Ec===null?Ec=new Set([this]):Ec.add(this));var F=h.stack;this.componentDidCatch(h.value,{componentStack:F!==null?F:""})}),y}function B_(d,h,y){var x=d.pingCache;if(x===null){x=d.pingCache=new cU;var _=new Set;x.set(h,_)}else _=x.get(h),_===void 0&&(_=new Set,x.set(h,_));_.has(y)||(_.add(y),d=CU.bind(null,d,h,y),h.then(d,d))}function U_(d){do{var h;if((h=d.tag===13)&&(h=d.memoizedState,h=h!==null?h.dehydrated!==null:!0),h)return d;d=d.return}while(d!==null);return null}function H_(d,h,y,x,_){return d.mode&1?(d.flags|=65536,d.lanes=_,d):(d===h?d.flags|=65536:(d.flags|=128,y.flags|=131072,y.flags&=-52805,y.tag===1&&(y.alternate===null?y.tag=17:(h=Il(-1,1),h.tag=2,wc(y,h,1))),y.lanes|=1),d)}var dU=w.ReactCurrentOwner,xo=!1;function eo(d,h,y,x){h.child=d===null?c_(h,null,y,x):Wu(h,d.child,y,x)}function G_(d,h,y,x,_){y=y.render;var A=h.ref;return Vu(h,_),x=GS(d,h,y,x,A,_),y=WS(),d!==null&&!xo?(h.updateQueue=d.updateQueue,h.flags&=-2053,d.lanes&=~_,_l(d,h,_)):(Xn&&y&&IS(h),h.flags|=1,eo(d,h,x,_),h.child)}function W_(d,h,y,x,_){if(d===null){var A=y.type;return typeof A=="function"&&!xx(A)&&A.defaultProps===void 0&&y.compare===null&&y.defaultProps===void 0?(h.tag=15,h.type=A,K_(d,h,A,x,_)):(d=Qm(y.type,null,x,h,h.mode,_),d.ref=h.ref,d.return=h,h.child=d)}if(A=d.child,!(d.lanes&_)){var F=A.memoizedProps;if(y=y.compare,y=y!==null?y:Pp,y(F,x)&&d.ref===h.ref)return _l(d,h,_)}return h.flags|=1,d=_c(A,x),d.ref=h.ref,d.return=h,h.child=d}function K_(d,h,y,x,_){if(d!==null){var A=d.memoizedProps;if(Pp(A,x)&&d.ref===h.ref)if(xo=!1,h.pendingProps=x=A,(d.lanes&_)!==0)d.flags&131072&&(xo=!0);else return h.lanes=d.lanes,_l(d,h,_)}return ex(d,h,y,x,_)}function V_(d,h,y){var x=h.pendingProps,_=x.children,A=d!==null?d.memoizedState:null;if(x.mode==="hidden")if(!(h.mode&1))h.memoizedState={baseLanes:0,cachePool:null,transitions:null},Fn(Zu,Zo),Zo|=y;else{if(!(y&1073741824))return d=A!==null?A.baseLanes|y:y,h.lanes=h.childLanes=1073741824,h.memoizedState={baseLanes:d,cachePool:null,transitions:null},h.updateQueue=null,Fn(Zu,Zo),Zo|=d,null;h.memoizedState={baseLanes:0,cachePool:null,transitions:null},x=A!==null?A.baseLanes:y,Fn(Zu,Zo),Zo|=x}else A!==null?(x=A.baseLanes|y,h.memoizedState=null):x=y,Fn(Zu,Zo),Zo|=x;return eo(d,h,_,y),h.child}function q_(d,h){var y=h.ref;(d===null&&y!==null||d!==null&&d.ref!==y)&&(h.flags|=512,h.flags|=2097152)}function ex(d,h,y,x,_){var A=So(y)?Id:Is.current;return A=Bu(h,A),Vu(h,_),y=GS(d,h,y,x,A,_),x=WS(),d!==null&&!xo?(h.updateQueue=d.updateQueue,h.flags&=-2053,d.lanes&=~_,_l(d,h,_)):(Xn&&x&&IS(h),h.flags|=1,eo(d,h,y,_),h.child)}function Y_(d,h,y,x,_){if(So(y)){var A=!0;Em(h)}else A=!1;if(Vu(h,_),h.stateNode===null)Um(d,h),N_(h,y,x),ZS(h,y,x,_),x=!0;else if(d===null){var F=h.stateNode,Q=h.memoizedProps;F.props=Q;var te=F.context,ve=y.contextType;typeof ve=="object"&&ve!==null?ve=bi(ve):(ve=So(y)?Id:Is.current,ve=Bu(h,ve));var je=y.getDerivedStateFromProps,Re=typeof je=="function"||typeof F.getSnapshotBeforeUpdate=="function";Re||typeof F.UNSAFE_componentWillReceiveProps!="function"&&typeof F.componentWillReceiveProps!="function"||(Q!==x||te!==ve)&&F_(h,F,x,ve),xc=!1;var Ae=h.memoizedState;F.state=Ae,Rm(h,x,F,_),te=h.memoizedState,Q!==x||Ae!==te||bo.current||xc?(typeof je=="function"&&(XS(h,y,je,x),te=h.memoizedState),(Q=xc||L_(h,y,Q,x,Ae,te,ve))?(Re||typeof F.UNSAFE_componentWillMount!="function"&&typeof F.componentWillMount!="function"||(typeof F.componentWillMount=="function"&&F.componentWillMount(),typeof F.UNSAFE_componentWillMount=="function"&&F.UNSAFE_componentWillMount()),typeof F.componentDidMount=="function"&&(h.flags|=4194308)):(typeof F.componentDidMount=="function"&&(h.flags|=4194308),h.memoizedProps=x,h.memoizedState=te),F.props=x,F.state=te,F.context=ve,x=Q):(typeof F.componentDidMount=="function"&&(h.flags|=4194308),x=!1)}else{F=h.stateNode,u_(d,h),Q=h.memoizedProps,ve=h.type===h.elementType?Q:Yi(h.type,Q),F.props=ve,Re=h.pendingProps,Ae=F.context,te=y.contextType,typeof te=="object"&&te!==null?te=bi(te):(te=So(y)?Id:Is.current,te=Bu(h,te));var qe=y.getDerivedStateFromProps;(je=typeof qe=="function"||typeof F.getSnapshotBeforeUpdate=="function")||typeof F.UNSAFE_componentWillReceiveProps!="function"&&typeof F.componentWillReceiveProps!="function"||(Q!==Re||Ae!==te)&&F_(h,F,x,te),xc=!1,Ae=h.memoizedState,F.state=Ae,Rm(h,x,F,_);var tt=h.memoizedState;Q!==Re||Ae!==tt||bo.current||xc?(typeof qe=="function"&&(XS(h,y,qe,x),tt=h.memoizedState),(ve=xc||L_(h,y,ve,x,Ae,tt,te)||!1)?(je||typeof F.UNSAFE_componentWillUpdate!="function"&&typeof F.componentWillUpdate!="function"||(typeof F.componentWillUpdate=="function"&&F.componentWillUpdate(x,tt,te),typeof F.UNSAFE_componentWillUpdate=="function"&&F.UNSAFE_componentWillUpdate(x,tt,te)),typeof F.componentDidUpdate=="function"&&(h.flags|=4),typeof F.getSnapshotBeforeUpdate=="function"&&(h.flags|=1024)):(typeof F.componentDidUpdate!="function"||Q===d.memoizedProps&&Ae===d.memoizedState||(h.flags|=4),typeof F.getSnapshotBeforeUpdate!="function"||Q===d.memoizedProps&&Ae===d.memoizedState||(h.flags|=1024),h.memoizedProps=x,h.memoizedState=tt),F.props=x,F.state=tt,F.context=te,x=ve):(typeof F.componentDidUpdate!="function"||Q===d.memoizedProps&&Ae===d.memoizedState||(h.flags|=4),typeof F.getSnapshotBeforeUpdate!="function"||Q===d.memoizedProps&&Ae===d.memoizedState||(h.flags|=1024),x=!1)}return tx(d,h,y,x,A,_)}function tx(d,h,y,x,_,A){q_(d,h);var F=(h.flags&128)!==0;if(!x&&!F)return _&&e_(h,y,!1),_l(d,h,A);x=h.stateNode,dU.current=h;var Q=F&&typeof y.getDerivedStateFromError!="function"?null:x.render();return h.flags|=1,d!==null&&F?(h.child=Wu(h,d.child,null,A),h.child=Wu(h,null,Q,A)):eo(d,h,Q,A),h.memoizedState=x.state,_&&e_(h,y,!0),h.child}function X_(d){var h=d.stateNode;h.pendingContext?JI(d,h.pendingContext,h.pendingContext!==h.context):h.context&&JI(d,h.context,!1),FS(d,h.containerInfo)}function Z_(d,h,y,x,_){return Gu(),AS(_),h.flags|=256,eo(d,h,y,x),h.child}var nx={dehydrated:null,treeContext:null,retryLane:0};function rx(d){return{baseLanes:d,cachePool:null,transitions:null}}function J_(d,h,y){var x=h.pendingProps,_=rr.current,A=!1,F=(h.flags&128)!==0,Q;if((Q=F)||(Q=d!==null&&d.memoizedState===null?!1:(_&2)!==0),Q?(A=!0,h.flags&=-129):(d===null||d.memoizedState!==null)&&(_|=1),Fn(rr,_&1),d===null)return MS(h),d=h.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?(h.mode&1?d.data==="$!"?h.lanes=8:h.lanes=1073741824:h.lanes=1,null):(F=x.children,d=x.fallback,A?(x=h.mode,A=h.child,F={mode:"hidden",children:F},!(x&1)&&A!==null?(A.childLanes=0,A.pendingProps=F):A=ey(F,x,0,null),d=Nd(d,x,y,null),A.return=h,d.return=h,A.sibling=d,h.child=A,h.child.memoizedState=rx(y),h.memoizedState=nx,d):sx(h,F));if(_=d.memoizedState,_!==null&&(Q=_.dehydrated,Q!==null))return uU(d,h,F,x,Q,_,y);if(A){A=x.fallback,F=h.mode,_=d.child,Q=_.sibling;var te={mode:"hidden",children:x.children};return!(F&1)&&h.child!==_?(x=h.child,x.childLanes=0,x.pendingProps=te,h.deletions=null):(x=_c(_,te),x.subtreeFlags=_.subtreeFlags&14680064),Q!==null?A=_c(Q,A):(A=Nd(A,F,y,null),A.flags|=2),A.return=h,x.return=h,x.sibling=A,h.child=x,x=A,A=h.child,F=d.child.memoizedState,F=F===null?rx(y):{baseLanes:F.baseLanes|y,cachePool:null,transitions:F.transitions},A.memoizedState=F,A.childLanes=d.childLanes&~y,h.memoizedState=nx,x}return A=d.child,d=A.sibling,x=_c(A,{mode:"visible",children:x.children}),!(h.mode&1)&&(x.lanes=y),x.return=h,x.sibling=null,d!==null&&(y=h.deletions,y===null?(h.deletions=[d],h.flags|=16):y.push(d)),h.child=x,h.memoizedState=null,x}function sx(d,h){return h=ey({mode:"visible",children:h},d.mode,0,null),h.return=d,d.child=h}function Bm(d,h,y,x){return x!==null&&AS(x),Wu(h,d.child,null,y),d=sx(h,h.pendingProps.children),d.flags|=2,h.memoizedState=null,d}function uU(d,h,y,x,_,A,F){if(y)return h.flags&256?(h.flags&=-257,x=JS(Error(t(422))),Bm(d,h,F,x)):h.memoizedState!==null?(h.child=d.child,h.flags|=128,null):(A=x.fallback,_=h.mode,x=ey({mode:"visible",children:x.children},_,0,null),A=Nd(A,_,F,null),A.flags|=2,x.return=h,A.return=h,x.sibling=A,h.child=x,h.mode&1&&Wu(h,d.child,null,F),h.child.memoizedState=rx(F),h.memoizedState=nx,A);if(!(h.mode&1))return Bm(d,h,F,null);if(_.data==="$!"){if(x=_.nextSibling&&_.nextSibling.dataset,x)var Q=x.dgst;return x=Q,A=Error(t(419)),x=JS(A,x,void 0),Bm(d,h,F,x)}if(Q=(F&d.childLanes)!==0,xo||Q){if(x=Xr,x!==null){switch(F&-F){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}_=_&(x.suspendedLanes|F)?0:_,_!==0&&_!==A.retryLane&&(A.retryLane=_,Pl(d,_),Ji(x,d,_,-1))}return Sx(),x=JS(Error(t(421))),Bm(d,h,F,x)}return _.data==="$?"?(h.flags|=128,h.child=d.child,h=EU.bind(null,d),_._reactRetry=h,null):(d=A.treeContext,Xo=yc(_.nextSibling),Yo=h,Xn=!0,qi=null,d!==null&&(yi[vi++]=El,yi[vi++]=kl,yi[vi++]=_d,El=d.id,kl=d.overflow,_d=h),h=sx(h,x.children),h.flags|=4096,h)}function Q_(d,h,y){d.lanes|=h;var x=d.alternate;x!==null&&(x.lanes|=h),OS(d.return,h,y)}function ox(d,h,y,x,_){var A=d.memoizedState;A===null?d.memoizedState={isBackwards:h,rendering:null,renderingStartTime:0,last:x,tail:y,tailMode:_}:(A.isBackwards=h,A.rendering=null,A.renderingStartTime=0,A.last=x,A.tail=y,A.tailMode=_)}function eT(d,h,y){var x=h.pendingProps,_=x.revealOrder,A=x.tail;if(eo(d,h,x.children,y),x=rr.current,x&2)x=x&1|2,h.flags|=128;else{if(d!==null&&d.flags&128)e:for(d=h.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&Q_(d,y,h);else if(d.tag===19)Q_(d,y,h);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===h)break e;for(;d.sibling===null;){if(d.return===null||d.return===h)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}x&=1}if(Fn(rr,x),!(h.mode&1))h.memoizedState=null;else switch(_){case"forwards":for(y=h.child,_=null;y!==null;)d=y.alternate,d!==null&&Dm(d)===null&&(_=y),y=y.sibling;y=_,y===null?(_=h.child,h.child=null):(_=y.sibling,y.sibling=null),ox(h,!1,_,y,A);break;case"backwards":for(y=null,_=h.child,h.child=null;_!==null;){if(d=_.alternate,d!==null&&Dm(d)===null){h.child=_;break}d=_.sibling,_.sibling=y,y=_,_=d}ox(h,!0,y,null,A);break;case"together":ox(h,!1,null,null,void 0);break;default:h.memoizedState=null}return h.child}function Um(d,h){!(h.mode&1)&&d!==null&&(d.alternate=null,h.alternate=null,h.flags|=2)}function _l(d,h,y){if(d!==null&&(h.dependencies=d.dependencies),Rd|=h.lanes,!(y&h.childLanes))return null;if(d!==null&&h.child!==d.child)throw Error(t(153));if(h.child!==null){for(d=h.child,y=_c(d,d.pendingProps),h.child=y,y.return=h;d.sibling!==null;)d=d.sibling,y=y.sibling=_c(d,d.pendingProps),y.return=h;y.sibling=null}return h.child}function hU(d,h,y){switch(h.tag){case 3:X_(h),Gu();break;case 5:f_(h);break;case 1:So(h.type)&&Em(h);break;case 4:FS(h,h.stateNode.containerInfo);break;case 10:var x=h.type._context,_=h.memoizedProps.value;Fn(Mm,x._currentValue),x._currentValue=_;break;case 13:if(x=h.memoizedState,x!==null)return x.dehydrated!==null?(Fn(rr,rr.current&1),h.flags|=128,null):y&h.child.childLanes?J_(d,h,y):(Fn(rr,rr.current&1),d=_l(d,h,y),d!==null?d.sibling:null);Fn(rr,rr.current&1);break;case 19:if(x=(y&h.childLanes)!==0,d.flags&128){if(x)return eT(d,h,y);h.flags|=128}if(_=h.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),Fn(rr,rr.current),x)break;return null;case 22:case 23:return h.lanes=0,V_(d,h,y)}return _l(d,h,y)}var tT,ix,nT,rT;tT=function(d,h){for(var y=h.child;y!==null;){if(y.tag===5||y.tag===6)d.appendChild(y.stateNode);else if(y.tag!==4&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===h)break;for(;y.sibling===null;){if(y.return===null||y.return===h)return;y=y.return}y.sibling.return=y.return,y=y.sibling}},ix=function(){},nT=function(d,h,y,x){var _=d.memoizedProps;if(_!==x){d=h.stateNode,Ad(ja.current);var A=null;switch(y){case"input":_=sn(d,_),x=sn(d,x),A=[];break;case"select":_=ae({},_,{value:void 0}),x=ae({},x,{value:void 0}),A=[];break;case"textarea":_=Rr(d,_),x=Rr(d,x),A=[];break;default:typeof _.onClick!="function"&&typeof x.onClick=="function"&&(d.onclick=xm)}Tn(y,x);var F;y=null;for(ve in _)if(!x.hasOwnProperty(ve)&&_.hasOwnProperty(ve)&&_[ve]!=null)if(ve==="style"){var Q=_[ve];for(F in Q)Q.hasOwnProperty(F)&&(y||(y={}),y[F]="")}else ve!=="dangerouslySetInnerHTML"&&ve!=="children"&&ve!=="suppressContentEditableWarning"&&ve!=="suppressHydrationWarning"&&ve!=="autoFocus"&&(s.hasOwnProperty(ve)?A||(A=[]):(A=A||[]).push(ve,null));for(ve in x){var te=x[ve];if(Q=_!=null?_[ve]:void 0,x.hasOwnProperty(ve)&&te!==Q&&(te!=null||Q!=null))if(ve==="style")if(Q){for(F in Q)!Q.hasOwnProperty(F)||te&&te.hasOwnProperty(F)||(y||(y={}),y[F]="");for(F in te)te.hasOwnProperty(F)&&Q[F]!==te[F]&&(y||(y={}),y[F]=te[F])}else y||(A||(A=[]),A.push(ve,y)),y=te;else ve==="dangerouslySetInnerHTML"?(te=te?te.__html:void 0,Q=Q?Q.__html:void 0,te!=null&&Q!==te&&(A=A||[]).push(ve,te)):ve==="children"?typeof te!="string"&&typeof te!="number"||(A=A||[]).push(ve,""+te):ve!=="suppressContentEditableWarning"&&ve!=="suppressHydrationWarning"&&(s.hasOwnProperty(ve)?(te!=null&&ve==="onScroll"&&Hn("scroll",d),A||Q===te||(A=[])):(A=A||[]).push(ve,te))}y&&(A=A||[]).push("style",y);var ve=A;(h.updateQueue=ve)&&(h.flags|=4)}},rT=function(d,h,y,x){y!==x&&(h.flags|=4)};function Bp(d,h){if(!Xn)switch(d.tailMode){case"hidden":h=d.tail;for(var y=null;h!==null;)h.alternate!==null&&(y=h),h=h.sibling;y===null?d.tail=null:y.sibling=null;break;case"collapsed":y=d.tail;for(var x=null;y!==null;)y.alternate!==null&&(x=y),y=y.sibling;x===null?h||d.tail===null?d.tail=null:d.tail.sibling=null:x.sibling=null}}function Ts(d){var h=d.alternate!==null&&d.alternate.child===d.child,y=0,x=0;if(h)for(var _=d.child;_!==null;)y|=_.lanes|_.childLanes,x|=_.subtreeFlags&14680064,x|=_.flags&14680064,_.return=d,_=_.sibling;else for(_=d.child;_!==null;)y|=_.lanes|_.childLanes,x|=_.subtreeFlags,x|=_.flags,_.return=d,_=_.sibling;return d.subtreeFlags|=x,d.childLanes=y,h}function pU(d,h,y){var x=h.pendingProps;switch(_S(h),h.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ts(h),null;case 1:return So(h.type)&&Cm(),Ts(h),null;case 3:return x=h.stateNode,qu(),Gn(bo),Gn(Is),BS(),x.pendingContext&&(x.context=x.pendingContext,x.pendingContext=null),(d===null||d.child===null)&&(_m(h)?h.flags|=4:d===null||d.memoizedState.isDehydrated&&!(h.flags&256)||(h.flags|=1024,qi!==null&&(yx(qi),qi=null))),ix(d,h),Ts(h),null;case 5:zS(h);var _=Ad(Lp.current);if(y=h.type,d!==null&&h.stateNode!=null)nT(d,h,y,x,_),d.ref!==h.ref&&(h.flags|=512,h.flags|=2097152);else{if(!x){if(h.stateNode===null)throw Error(t(166));return Ts(h),null}if(d=Ad(ja.current),_m(h)){x=h.stateNode,y=h.type;var A=h.memoizedProps;switch(x[Aa]=h,x[Ap]=A,d=(h.mode&1)!==0,y){case"dialog":Hn("cancel",x),Hn("close",x);break;case"iframe":case"object":case"embed":Hn("load",x);break;case"video":case"audio":for(_=0;_<_p.length;_++)Hn(_p[_],x);break;case"source":Hn("error",x);break;case"img":case"image":case"link":Hn("error",x),Hn("load",x);break;case"details":Hn("toggle",x);break;case"input":Kt(x,A),Hn("invalid",x);break;case"select":x._wrapperState={wasMultiple:!!A.multiple},Hn("invalid",x);break;case"textarea":qn(x,A),Hn("invalid",x)}Tn(y,A),_=null;for(var F in A)if(A.hasOwnProperty(F)){var Q=A[F];F==="children"?typeof Q=="string"?x.textContent!==Q&&(A.suppressHydrationWarning!==!0&&Sm(x.textContent,Q,d),_=["children",Q]):typeof Q=="number"&&x.textContent!==""+Q&&(A.suppressHydrationWarning!==!0&&Sm(x.textContent,Q,d),_=["children",""+Q]):s.hasOwnProperty(F)&&Q!=null&&F==="onScroll"&&Hn("scroll",x)}switch(y){case"input":pt(x),br(x,A,!0);break;case"textarea":pt(x),ke(x);break;case"select":case"option":break;default:typeof A.onClick=="function"&&(x.onclick=xm)}x=_,h.updateQueue=x,x!==null&&(h.flags|=4)}else{F=_.nodeType===9?_:_.ownerDocument,d==="http://www.w3.org/1999/xhtml"&&(d=ge(y)),d==="http://www.w3.org/1999/xhtml"?y==="script"?(d=F.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof x.is=="string"?d=F.createElement(y,{is:x.is}):(d=F.createElement(y),y==="select"&&(F=d,x.multiple?F.multiple=!0:x.size&&(F.size=x.size))):d=F.createElementNS(d,y),d[Aa]=h,d[Ap]=x,tT(d,h,!1,!1),h.stateNode=d;e:{switch(F=qt(y,x),y){case"dialog":Hn("cancel",d),Hn("close",d),_=x;break;case"iframe":case"object":case"embed":Hn("load",d),_=x;break;case"video":case"audio":for(_=0;_<_p.length;_++)Hn(_p[_],d);_=x;break;case"source":Hn("error",d),_=x;break;case"img":case"image":case"link":Hn("error",d),Hn("load",d),_=x;break;case"details":Hn("toggle",d),_=x;break;case"input":Kt(d,x),_=sn(d,x),Hn("invalid",d);break;case"option":_=x;break;case"select":d._wrapperState={wasMultiple:!!x.multiple},_=ae({},x,{value:void 0}),Hn("invalid",d);break;case"textarea":qn(d,x),_=Rr(d,x),Hn("invalid",d);break;default:_=x}Tn(y,_),Q=_;for(A in Q)if(Q.hasOwnProperty(A)){var te=Q[A];A==="style"?tn(d,te):A==="dangerouslySetInnerHTML"?(te=te?te.__html:void 0,te!=null&&$e(d,te)):A==="children"?typeof te=="string"?(y!=="textarea"||te!=="")&&re(d,te):typeof te=="number"&&re(d,""+te):A!=="suppressContentEditableWarning"&&A!=="suppressHydrationWarning"&&A!=="autoFocus"&&(s.hasOwnProperty(A)?te!=null&&A==="onScroll"&&Hn("scroll",d):te!=null&&T(d,A,te,F))}switch(y){case"input":pt(d),br(d,x,!1);break;case"textarea":pt(d),ke(d);break;case"option":x.value!=null&&d.setAttribute("value",""+Te(x.value));break;case"select":d.multiple=!!x.multiple,A=x.value,A!=null?dr(d,!!x.multiple,A,!1):x.defaultValue!=null&&dr(d,!!x.multiple,x.defaultValue,!0);break;default:typeof _.onClick=="function"&&(d.onclick=xm)}switch(y){case"button":case"input":case"select":case"textarea":x=!!x.autoFocus;break e;case"img":x=!0;break e;default:x=!1}}x&&(h.flags|=4)}h.ref!==null&&(h.flags|=512,h.flags|=2097152)}return Ts(h),null;case 6:if(d&&h.stateNode!=null)rT(d,h,d.memoizedProps,x);else{if(typeof x!="string"&&h.stateNode===null)throw Error(t(166));if(y=Ad(Lp.current),Ad(ja.current),_m(h)){if(x=h.stateNode,y=h.memoizedProps,x[Aa]=h,(A=x.nodeValue!==y)&&(d=Yo,d!==null))switch(d.tag){case 3:Sm(x.nodeValue,y,(d.mode&1)!==0);break;case 5:d.memoizedProps.suppressHydrationWarning!==!0&&Sm(x.nodeValue,y,(d.mode&1)!==0)}A&&(h.flags|=4)}else x=(y.nodeType===9?y:y.ownerDocument).createTextNode(x),x[Aa]=h,h.stateNode=x}return Ts(h),null;case 13:if(Gn(rr),x=h.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(Xn&&Xo!==null&&h.mode&1&&!(h.flags&128))i_(),Gu(),h.flags|=98560,A=!1;else if(A=_m(h),x!==null&&x.dehydrated!==null){if(d===null){if(!A)throw Error(t(318));if(A=h.memoizedState,A=A!==null?A.dehydrated:null,!A)throw Error(t(317));A[Aa]=h}else Gu(),!(h.flags&128)&&(h.memoizedState=null),h.flags|=4;Ts(h),A=!1}else qi!==null&&(yx(qi),qi=null),A=!0;if(!A)return h.flags&65536?h:null}return h.flags&128?(h.lanes=y,h):(x=x!==null,x!==(d!==null&&d.memoizedState!==null)&&x&&(h.child.flags|=8192,h.mode&1&&(d===null||rr.current&1?Ur===0&&(Ur=3):Sx())),h.updateQueue!==null&&(h.flags|=4),Ts(h),null);case 4:return qu(),ix(d,h),d===null&&Tp(h.stateNode.containerInfo),Ts(h),null;case 10:return DS(h.type._context),Ts(h),null;case 17:return So(h.type)&&Cm(),Ts(h),null;case 19:if(Gn(rr),A=h.memoizedState,A===null)return Ts(h),null;if(x=(h.flags&128)!==0,F=A.rendering,F===null)if(x)Bp(A,!1);else{if(Ur!==0||d!==null&&d.flags&128)for(d=h.child;d!==null;){if(F=Dm(d),F!==null){for(h.flags|=128,Bp(A,!1),x=F.updateQueue,x!==null&&(h.updateQueue=x,h.flags|=4),h.subtreeFlags=0,x=y,y=h.child;y!==null;)A=y,d=x,A.flags&=14680066,F=A.alternate,F===null?(A.childLanes=0,A.lanes=d,A.child=null,A.subtreeFlags=0,A.memoizedProps=null,A.memoizedState=null,A.updateQueue=null,A.dependencies=null,A.stateNode=null):(A.childLanes=F.childLanes,A.lanes=F.lanes,A.child=F.child,A.subtreeFlags=0,A.deletions=null,A.memoizedProps=F.memoizedProps,A.memoizedState=F.memoizedState,A.updateQueue=F.updateQueue,A.type=F.type,d=F.dependencies,A.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),y=y.sibling;return Fn(rr,rr.current&1|2),h.child}d=d.sibling}A.tail!==null&&dt()>Ju&&(h.flags|=128,x=!0,Bp(A,!1),h.lanes=4194304)}else{if(!x)if(d=Dm(F),d!==null){if(h.flags|=128,x=!0,y=d.updateQueue,y!==null&&(h.updateQueue=y,h.flags|=4),Bp(A,!0),A.tail===null&&A.tailMode==="hidden"&&!F.alternate&&!Xn)return Ts(h),null}else 2*dt()-A.renderingStartTime>Ju&&y!==1073741824&&(h.flags|=128,x=!0,Bp(A,!1),h.lanes=4194304);A.isBackwards?(F.sibling=h.child,h.child=F):(y=A.last,y!==null?y.sibling=F:h.child=F,A.last=F)}return A.tail!==null?(h=A.tail,A.rendering=h,A.tail=h.sibling,A.renderingStartTime=dt(),h.sibling=null,y=rr.current,Fn(rr,x?y&1|2:y&1),h):(Ts(h),null);case 22:case 23:return bx(),x=h.memoizedState!==null,d!==null&&d.memoizedState!==null!==x&&(h.flags|=8192),x&&h.mode&1?Zo&1073741824&&(Ts(h),h.subtreeFlags&6&&(h.flags|=8192)):Ts(h),null;case 24:return null;case 25:return null}throw Error(t(156,h.tag))}function fU(d,h){switch(_S(h),h.tag){case 1:return So(h.type)&&Cm(),d=h.flags,d&65536?(h.flags=d&-65537|128,h):null;case 3:return qu(),Gn(bo),Gn(Is),BS(),d=h.flags,d&65536&&!(d&128)?(h.flags=d&-65537|128,h):null;case 5:return zS(h),null;case 13:if(Gn(rr),d=h.memoizedState,d!==null&&d.dehydrated!==null){if(h.alternate===null)throw Error(t(340));Gu()}return d=h.flags,d&65536?(h.flags=d&-65537|128,h):null;case 19:return Gn(rr),null;case 4:return qu(),null;case 10:return DS(h.type._context),null;case 22:case 23:return bx(),null;case 24:return null;default:return null}}var Hm=!1,Ms=!1,gU=typeof WeakSet=="function"?WeakSet:Set,Ze=null;function Xu(d,h){var y=d.ref;if(y!==null)if(typeof y=="function")try{y(null)}catch(x){fr(d,h,x)}else y.current=null}function ax(d,h,y){try{y()}catch(x){fr(d,h,x)}}var sT=!1;function mU(d,h){if(bS=le,d=LI(),uS(d)){if("selectionStart"in d)var y={start:d.selectionStart,end:d.selectionEnd};else e:{y=(y=d.ownerDocument)&&y.defaultView||window;var x=y.getSelection&&y.getSelection();if(x&&x.rangeCount!==0){y=x.anchorNode;var _=x.anchorOffset,A=x.focusNode;x=x.focusOffset;try{y.nodeType,A.nodeType}catch{y=null;break e}var F=0,Q=-1,te=-1,ve=0,je=0,Re=d,Ae=null;t:for(;;){for(var qe;Re!==y||_!==0&&Re.nodeType!==3||(Q=F+_),Re!==A||x!==0&&Re.nodeType!==3||(te=F+x),Re.nodeType===3&&(F+=Re.nodeValue.length),(qe=Re.firstChild)!==null;)Ae=Re,Re=qe;for(;;){if(Re===d)break t;if(Ae===y&&++ve===_&&(Q=F),Ae===A&&++je===x&&(te=F),(qe=Re.nextSibling)!==null)break;Re=Ae,Ae=Re.parentNode}Re=qe}y=Q===-1||te===-1?null:{start:Q,end:te}}else y=null}y=y||{start:0,end:0}}else y=null;for(SS={focusedElem:d,selectionRange:y},le=!1,Ze=h;Ze!==null;)if(h=Ze,d=h.child,(h.subtreeFlags&1028)!==0&&d!==null)d.return=h,Ze=d;else for(;Ze!==null;){h=Ze;try{var tt=h.alternate;if(h.flags&1024)switch(h.tag){case 0:case 11:case 15:break;case 1:if(tt!==null){var rt=tt.memoizedProps,Cr=tt.memoizedState,pe=h.stateNode,ie=pe.getSnapshotBeforeUpdate(h.elementType===h.type?rt:Yi(h.type,rt),Cr);pe.__reactInternalSnapshotBeforeUpdate=ie}break;case 3:var me=h.stateNode.containerInfo;me.nodeType===1?me.textContent="":me.nodeType===9&&me.documentElement&&me.removeChild(me.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(ze){fr(h,h.return,ze)}if(d=h.sibling,d!==null){d.return=h.return,Ze=d;break}Ze=h.return}return tt=sT,sT=!1,tt}function Up(d,h,y){var x=h.updateQueue;if(x=x!==null?x.lastEffect:null,x!==null){var _=x=x.next;do{if((_.tag&d)===d){var A=_.destroy;_.destroy=void 0,A!==void 0&&ax(h,y,A)}_=_.next}while(_!==x)}}function Gm(d,h){if(h=h.updateQueue,h=h!==null?h.lastEffect:null,h!==null){var y=h=h.next;do{if((y.tag&d)===d){var x=y.create;y.destroy=x()}y=y.next}while(y!==h)}}function lx(d){var h=d.ref;if(h!==null){var y=d.stateNode;switch(d.tag){case 5:d=y;break;default:d=y}typeof h=="function"?h(d):h.current=d}}function oT(d){var h=d.alternate;h!==null&&(d.alternate=null,oT(h)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(h=d.stateNode,h!==null&&(delete h[Aa],delete h[Ap],delete h[ES],delete h[JB],delete h[QB])),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function iT(d){return d.tag===5||d.tag===3||d.tag===4}function aT(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||iT(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function cx(d,h,y){var x=d.tag;if(x===5||x===6)d=d.stateNode,h?y.nodeType===8?y.parentNode.insertBefore(d,h):y.insertBefore(d,h):(y.nodeType===8?(h=y.parentNode,h.insertBefore(d,y)):(h=y,h.appendChild(d)),y=y._reactRootContainer,y!=null||h.onclick!==null||(h.onclick=xm));else if(x!==4&&(d=d.child,d!==null))for(cx(d,h,y),d=d.sibling;d!==null;)cx(d,h,y),d=d.sibling}function dx(d,h,y){var x=d.tag;if(x===5||x===6)d=d.stateNode,h?y.insertBefore(d,h):y.appendChild(d);else if(x!==4&&(d=d.child,d!==null))for(dx(d,h,y),d=d.sibling;d!==null;)dx(d,h,y),d=d.sibling}var ls=null,Xi=!1;function Cc(d,h,y){for(y=y.child;y!==null;)lT(d,h,y),y=y.sibling}function lT(d,h,y){if(hr&&typeof hr.onCommitFiberUnmount=="function")try{hr.onCommitFiberUnmount(Dr,y)}catch{}switch(y.tag){case 5:Ms||Xu(y,h);case 6:var x=ls,_=Xi;ls=null,Cc(d,h,y),ls=x,Xi=_,ls!==null&&(Xi?(d=ls,y=y.stateNode,d.nodeType===8?d.parentNode.removeChild(y):d.removeChild(y)):ls.removeChild(y.stateNode));break;case 18:ls!==null&&(Xi?(d=ls,y=y.stateNode,d.nodeType===8?CS(d.parentNode,y):d.nodeType===1&&CS(d,y),kd(d)):CS(ls,y.stateNode));break;case 4:x=ls,_=Xi,ls=y.stateNode.containerInfo,Xi=!0,Cc(d,h,y),ls=x,Xi=_;break;case 0:case 11:case 14:case 15:if(!Ms&&(x=y.updateQueue,x!==null&&(x=x.lastEffect,x!==null))){_=x=x.next;do{var A=_,F=A.destroy;A=A.tag,F!==void 0&&(A&2||A&4)&&ax(y,h,F),_=_.next}while(_!==x)}Cc(d,h,y);break;case 1:if(!Ms&&(Xu(y,h),x=y.stateNode,typeof x.componentWillUnmount=="function"))try{x.props=y.memoizedProps,x.state=y.memoizedState,x.componentWillUnmount()}catch(Q){fr(y,h,Q)}Cc(d,h,y);break;case 21:Cc(d,h,y);break;case 22:y.mode&1?(Ms=(x=Ms)||y.memoizedState!==null,Cc(d,h,y),Ms=x):Cc(d,h,y);break;default:Cc(d,h,y)}}function cT(d){var h=d.updateQueue;if(h!==null){d.updateQueue=null;var y=d.stateNode;y===null&&(y=d.stateNode=new gU),h.forEach(function(x){var _=kU.bind(null,d,x);y.has(x)||(y.add(x),x.then(_,_))})}}function Zi(d,h){var y=h.deletions;if(y!==null)for(var x=0;x<y.length;x++){var _=y[x];try{var A=d,F=h,Q=F;e:for(;Q!==null;){switch(Q.tag){case 5:ls=Q.stateNode,Xi=!1;break e;case 3:ls=Q.stateNode.containerInfo,Xi=!0;break e;case 4:ls=Q.stateNode.containerInfo,Xi=!0;break e}Q=Q.return}if(ls===null)throw Error(t(160));lT(A,F,_),ls=null,Xi=!1;var te=_.alternate;te!==null&&(te.return=null),_.return=null}catch(ve){fr(_,h,ve)}}if(h.subtreeFlags&12854)for(h=h.child;h!==null;)dT(h,d),h=h.sibling}function dT(d,h){var y=d.alternate,x=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:if(Zi(h,d),Da(d),x&4){try{Up(3,d,d.return),Gm(3,d)}catch(rt){fr(d,d.return,rt)}try{Up(5,d,d.return)}catch(rt){fr(d,d.return,rt)}}break;case 1:Zi(h,d),Da(d),x&512&&y!==null&&Xu(y,y.return);break;case 5:if(Zi(h,d),Da(d),x&512&&y!==null&&Xu(y,y.return),d.flags&32){var _=d.stateNode;try{re(_,"")}catch(rt){fr(d,d.return,rt)}}if(x&4&&(_=d.stateNode,_!=null)){var A=d.memoizedProps,F=y!==null?y.memoizedProps:A,Q=d.type,te=d.updateQueue;if(d.updateQueue=null,te!==null)try{Q==="input"&&A.type==="radio"&&A.name!=null&&Nt(_,A),qt(Q,F);var ve=qt(Q,A);for(F=0;F<te.length;F+=2){var je=te[F],Re=te[F+1];je==="style"?tn(_,Re):je==="dangerouslySetInnerHTML"?$e(_,Re):je==="children"?re(_,Re):T(_,je,Re,ve)}switch(Q){case"input":vr(_,A);break;case"textarea":Zs(_,A);break;case"select":var Ae=_._wrapperState.wasMultiple;_._wrapperState.wasMultiple=!!A.multiple;var qe=A.value;qe!=null?dr(_,!!A.multiple,qe,!1):Ae!==!!A.multiple&&(A.defaultValue!=null?dr(_,!!A.multiple,A.defaultValue,!0):dr(_,!!A.multiple,A.multiple?[]:"",!1))}_[Ap]=A}catch(rt){fr(d,d.return,rt)}}break;case 6:if(Zi(h,d),Da(d),x&4){if(d.stateNode===null)throw Error(t(162));_=d.stateNode,A=d.memoizedProps;try{_.nodeValue=A}catch(rt){fr(d,d.return,rt)}}break;case 3:if(Zi(h,d),Da(d),x&4&&y!==null&&y.memoizedState.isDehydrated)try{kd(h.containerInfo)}catch(rt){fr(d,d.return,rt)}break;case 4:Zi(h,d),Da(d);break;case 13:Zi(h,d),Da(d),_=d.child,_.flags&8192&&(A=_.memoizedState!==null,_.stateNode.isHidden=A,!A||_.alternate!==null&&_.alternate.memoizedState!==null||(px=dt())),x&4&&cT(d);break;case 22:if(je=y!==null&&y.memoizedState!==null,d.mode&1?(Ms=(ve=Ms)||je,Zi(h,d),Ms=ve):Zi(h,d),Da(d),x&8192){if(ve=d.memoizedState!==null,(d.stateNode.isHidden=ve)&&!je&&d.mode&1)for(Ze=d,je=d.child;je!==null;){for(Re=Ze=je;Ze!==null;){switch(Ae=Ze,qe=Ae.child,Ae.tag){case 0:case 11:case 14:case 15:Up(4,Ae,Ae.return);break;case 1:Xu(Ae,Ae.return);var tt=Ae.stateNode;if(typeof tt.componentWillUnmount=="function"){x=Ae,y=Ae.return;try{h=x,tt.props=h.memoizedProps,tt.state=h.memoizedState,tt.componentWillUnmount()}catch(rt){fr(x,y,rt)}}break;case 5:Xu(Ae,Ae.return);break;case 22:if(Ae.memoizedState!==null){pT(Re);continue}}qe!==null?(qe.return=Ae,Ze=qe):pT(Re)}je=je.sibling}e:for(je=null,Re=d;;){if(Re.tag===5){if(je===null){je=Re;try{_=Re.stateNode,ve?(A=_.style,typeof A.setProperty=="function"?A.setProperty("display","none","important"):A.display="none"):(Q=Re.stateNode,te=Re.memoizedProps.style,F=te!=null&&te.hasOwnProperty("display")?te.display:null,Q.style.display=ct("display",F))}catch(rt){fr(d,d.return,rt)}}}else if(Re.tag===6){if(je===null)try{Re.stateNode.nodeValue=ve?"":Re.memoizedProps}catch(rt){fr(d,d.return,rt)}}else if((Re.tag!==22&&Re.tag!==23||Re.memoizedState===null||Re===d)&&Re.child!==null){Re.child.return=Re,Re=Re.child;continue}if(Re===d)break e;for(;Re.sibling===null;){if(Re.return===null||Re.return===d)break e;je===Re&&(je=null),Re=Re.return}je===Re&&(je=null),Re.sibling.return=Re.return,Re=Re.sibling}}break;case 19:Zi(h,d),Da(d),x&4&&cT(d);break;case 21:break;default:Zi(h,d),Da(d)}}function Da(d){var h=d.flags;if(h&2){try{e:{for(var y=d.return;y!==null;){if(iT(y)){var x=y;break e}y=y.return}throw Error(t(160))}switch(x.tag){case 5:var _=x.stateNode;x.flags&32&&(re(_,""),x.flags&=-33);var A=aT(d);dx(d,A,_);break;case 3:case 4:var F=x.stateNode.containerInfo,Q=aT(d);cx(d,Q,F);break;default:throw Error(t(161))}}catch(te){fr(d,d.return,te)}d.flags&=-3}h&4096&&(d.flags&=-4097)}function yU(d,h,y){Ze=d,uT(d)}function uT(d,h,y){for(var x=(d.mode&1)!==0;Ze!==null;){var _=Ze,A=_.child;if(_.tag===22&&x){var F=_.memoizedState!==null||Hm;if(!F){var Q=_.alternate,te=Q!==null&&Q.memoizedState!==null||Ms;Q=Hm;var ve=Ms;if(Hm=F,(Ms=te)&&!ve)for(Ze=_;Ze!==null;)F=Ze,te=F.child,F.tag===22&&F.memoizedState!==null?fT(_):te!==null?(te.return=F,Ze=te):fT(_);for(;A!==null;)Ze=A,uT(A),A=A.sibling;Ze=_,Hm=Q,Ms=ve}hT(d)}else _.subtreeFlags&8772&&A!==null?(A.return=_,Ze=A):hT(d)}}function hT(d){for(;Ze!==null;){var h=Ze;if(h.flags&8772){var y=h.alternate;try{if(h.flags&8772)switch(h.tag){case 0:case 11:case 15:Ms||Gm(5,h);break;case 1:var x=h.stateNode;if(h.flags&4&&!Ms)if(y===null)x.componentDidMount();else{var _=h.elementType===h.type?y.memoizedProps:Yi(h.type,y.memoizedProps);x.componentDidUpdate(_,y.memoizedState,x.__reactInternalSnapshotBeforeUpdate)}var A=h.updateQueue;A!==null&&p_(h,A,x);break;case 3:var F=h.updateQueue;if(F!==null){if(y=null,h.child!==null)switch(h.child.tag){case 5:y=h.child.stateNode;break;case 1:y=h.child.stateNode}p_(h,F,y)}break;case 5:var Q=h.stateNode;if(y===null&&h.flags&4){y=Q;var te=h.memoizedProps;switch(h.type){case"button":case"input":case"select":case"textarea":te.autoFocus&&y.focus();break;case"img":te.src&&(y.src=te.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(h.memoizedState===null){var ve=h.alternate;if(ve!==null){var je=ve.memoizedState;if(je!==null){var Re=je.dehydrated;Re!==null&&kd(Re)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Ms||h.flags&512&&lx(h)}catch(Ae){fr(h,h.return,Ae)}}if(h===d){Ze=null;break}if(y=h.sibling,y!==null){y.return=h.return,Ze=y;break}Ze=h.return}}function pT(d){for(;Ze!==null;){var h=Ze;if(h===d){Ze=null;break}var y=h.sibling;if(y!==null){y.return=h.return,Ze=y;break}Ze=h.return}}function fT(d){for(;Ze!==null;){var h=Ze;try{switch(h.tag){case 0:case 11:case 15:var y=h.return;try{Gm(4,h)}catch(te){fr(h,y,te)}break;case 1:var x=h.stateNode;if(typeof x.componentDidMount=="function"){var _=h.return;try{x.componentDidMount()}catch(te){fr(h,_,te)}}var A=h.return;try{lx(h)}catch(te){fr(h,A,te)}break;case 5:var F=h.return;try{lx(h)}catch(te){fr(h,F,te)}}}catch(te){fr(h,h.return,te)}if(h===d){Ze=null;break}var Q=h.sibling;if(Q!==null){Q.return=h.return,Ze=Q;break}Ze=h.return}}var vU=Math.ceil,Wm=w.ReactCurrentDispatcher,ux=w.ReactCurrentOwner,xi=w.ReactCurrentBatchConfig,on=0,Xr=null,Or=null,cs=0,Zo=0,Zu=vc(0),Ur=0,Hp=null,Rd=0,Km=0,hx=0,Gp=null,wo=null,px=0,Ju=1/0,Tl=null,Vm=!1,fx=null,Ec=null,qm=!1,kc=null,Ym=0,Wp=0,gx=null,Xm=-1,Zm=0;function to(){return on&6?dt():Xm!==-1?Xm:Xm=dt()}function Pc(d){return d.mode&1?on&2&&cs!==0?cs&-cs:tU.transition!==null?(Zm===0&&(Zm=hc()),Zm):(d=nn,d!==0||(d=window.event,d=d===void 0?16:xr(d.type)),d):1}function Ji(d,h,y,x){if(50<Wp)throw Wp=0,gx=null,Error(t(185));yo(d,y,x),(!(on&2)||d!==Xr)&&(d===Xr&&(!(on&2)&&(Km|=y),Ur===4&&Ic(d,cs)),Co(d,x),y===1&&on===0&&!(h.mode&1)&&(Ju=dt()+500,km&&Sc()))}function Co(d,h){var y=d.callbackNode;wd(d,h);var x=ka(d,d===Xr?cs:0);if(x===0)y!==null&&_e(y),d.callbackNode=null,d.callbackPriority=0;else if(h=x&-x,d.callbackPriority!==h){if(y!=null&&_e(y),h===1)d.tag===0?eU(mT.bind(null,d)):t_(mT.bind(null,d)),XB(function(){!(on&6)&&Sc()}),y=null;else{switch(xl(x)){case 1:y=Ct;break;case 4:y=Yt;break;case 16:y=Pn;break;case 536870912:y=bn;break;default:y=Pn}y=ET(y,gT.bind(null,d))}d.callbackPriority=h,d.callbackNode=y}}function gT(d,h){if(Xm=-1,Zm=0,on&6)throw Error(t(327));var y=d.callbackNode;if(Qu()&&d.callbackNode!==y)return null;var x=ka(d,d===Xr?cs:0);if(x===0)return null;if(x&30||x&d.expiredLanes||h)h=Jm(d,x);else{h=x;var _=on;on|=2;var A=vT();(Xr!==d||cs!==h)&&(Tl=null,Ju=dt()+500,Od(d,h));do try{xU();break}catch(Q){yT(d,Q)}while(!0);RS(),Wm.current=A,on=_,Or!==null?h=0:(Xr=null,cs=0,h=Ur)}if(h!==0){if(h===2&&(_=Sl(d),_!==0&&(x=_,h=mx(d,_))),h===1)throw y=Hp,Od(d,0),Ic(d,x),Co(d,dt()),y;if(h===6)Ic(d,x);else{if(_=d.current.alternate,!(x&30)&&!bU(_)&&(h=Jm(d,x),h===2&&(A=Sl(d),A!==0&&(x=A,h=mx(d,A))),h===1))throw y=Hp,Od(d,0),Ic(d,x),Co(d,dt()),y;switch(d.finishedWork=_,d.finishedLanes=x,h){case 0:case 1:throw Error(t(345));case 2:Ld(d,wo,Tl);break;case 3:if(Ic(d,x),(x&130023424)===x&&(h=px+500-dt(),10<h)){if(ka(d,0)!==0)break;if(_=d.suspendedLanes,(_&x)!==x){to(),d.pingedLanes|=d.suspendedLanes&_;break}d.timeoutHandle=wS(Ld.bind(null,d,wo,Tl),h);break}Ld(d,wo,Tl);break;case 4:if(Ic(d,x),(x&4194240)===x)break;for(h=d.eventTimes,_=-1;0<x;){var F=31-tr(x);A=1<<F,F=h[F],F>_&&(_=F),x&=~A}if(x=_,x=dt()-x,x=(120>x?120:480>x?480:1080>x?1080:1920>x?1920:3e3>x?3e3:4320>x?4320:1960*vU(x/1960))-x,10<x){d.timeoutHandle=wS(Ld.bind(null,d,wo,Tl),x);break}Ld(d,wo,Tl);break;case 5:Ld(d,wo,Tl);break;default:throw Error(t(329))}}}return Co(d,dt()),d.callbackNode===y?gT.bind(null,d):null}function mx(d,h){var y=Gp;return d.current.memoizedState.isDehydrated&&(Od(d,h).flags|=256),d=Jm(d,h),d!==2&&(h=wo,wo=y,h!==null&&yx(h)),d}function yx(d){wo===null?wo=d:wo.push.apply(wo,d)}function bU(d){for(var h=d;;){if(h.flags&16384){var y=h.updateQueue;if(y!==null&&(y=y.stores,y!==null))for(var x=0;x<y.length;x++){var _=y[x],A=_.getSnapshot;_=_.value;try{if(!Vi(A(),_))return!1}catch{return!1}}}if(y=h.child,h.subtreeFlags&16384&&y!==null)y.return=h,h=y;else{if(h===d)break;for(;h.sibling===null;){if(h.return===null||h.return===d)return!0;h=h.return}h.sibling.return=h.return,h=h.sibling}}return!0}function Ic(d,h){for(h&=~hx,h&=~Km,d.suspendedLanes|=h,d.pingedLanes&=~h,d=d.expirationTimes;0<h;){var y=31-tr(h),x=1<<y;d[y]=-1,h&=~x}}function mT(d){if(on&6)throw Error(t(327));Qu();var h=ka(d,0);if(!(h&1))return Co(d,dt()),null;var y=Jm(d,h);if(d.tag!==0&&y===2){var x=Sl(d);x!==0&&(h=x,y=mx(d,x))}if(y===1)throw y=Hp,Od(d,0),Ic(d,h),Co(d,dt()),y;if(y===6)throw Error(t(345));return d.finishedWork=d.current.alternate,d.finishedLanes=h,Ld(d,wo,Tl),Co(d,dt()),null}function vx(d,h){var y=on;on|=1;try{return d(h)}finally{on=y,on===0&&(Ju=dt()+500,km&&Sc())}}function Dd(d){kc!==null&&kc.tag===0&&!(on&6)&&Qu();var h=on;on|=1;var y=xi.transition,x=nn;try{if(xi.transition=null,nn=1,d)return d()}finally{nn=x,xi.transition=y,on=h,!(on&6)&&Sc()}}function bx(){Zo=Zu.current,Gn(Zu)}function Od(d,h){d.finishedWork=null,d.finishedLanes=0;var y=d.timeoutHandle;if(y!==-1&&(d.timeoutHandle=-1,YB(y)),Or!==null)for(y=Or.return;y!==null;){var x=y;switch(_S(x),x.tag){case 1:x=x.type.childContextTypes,x!=null&&Cm();break;case 3:qu(),Gn(bo),Gn(Is),BS();break;case 5:zS(x);break;case 4:qu();break;case 13:Gn(rr);break;case 19:Gn(rr);break;case 10:DS(x.type._context);break;case 22:case 23:bx()}y=y.return}if(Xr=d,Or=d=_c(d.current,null),cs=Zo=h,Ur=0,Hp=null,hx=Km=Rd=0,wo=Gp=null,Md!==null){for(h=0;h<Md.length;h++)if(y=Md[h],x=y.interleaved,x!==null){y.interleaved=null;var _=x.next,A=y.pending;if(A!==null){var F=A.next;A.next=_,x.next=F}y.pending=x}Md=null}return d}function yT(d,h){do{var y=Or;try{if(RS(),Om.current=zm,Lm){for(var x=sr.memoizedState;x!==null;){var _=x.queue;_!==null&&(_.pending=null),x=x.next}Lm=!1}if(jd=0,Yr=Br=sr=null,Np=!1,Fp=0,ux.current=null,y===null||y.return===null){Ur=1,Hp=h,Or=null;break}e:{var A=d,F=y.return,Q=y,te=h;if(h=cs,Q.flags|=32768,te!==null&&typeof te=="object"&&typeof te.then=="function"){var ve=te,je=Q,Re=je.tag;if(!(je.mode&1)&&(Re===0||Re===11||Re===15)){var Ae=je.alternate;Ae?(je.updateQueue=Ae.updateQueue,je.memoizedState=Ae.memoizedState,je.lanes=Ae.lanes):(je.updateQueue=null,je.memoizedState=null)}var qe=U_(F);if(qe!==null){qe.flags&=-257,H_(qe,F,Q,A,h),qe.mode&1&&B_(A,ve,h),h=qe,te=ve;var tt=h.updateQueue;if(tt===null){var rt=new Set;rt.add(te),h.updateQueue=rt}else tt.add(te);break e}else{if(!(h&1)){B_(A,ve,h),Sx();break e}te=Error(t(426))}}else if(Xn&&Q.mode&1){var Cr=U_(F);if(Cr!==null){!(Cr.flags&65536)&&(Cr.flags|=256),H_(Cr,F,Q,A,h),AS(Yu(te,Q));break e}}A=te=Yu(te,Q),Ur!==4&&(Ur=2),Gp===null?Gp=[A]:Gp.push(A),A=F;do{switch(A.tag){case 3:A.flags|=65536,h&=-h,A.lanes|=h;var pe=z_(A,te,h);h_(A,pe);break e;case 1:Q=te;var ie=A.type,me=A.stateNode;if(!(A.flags&128)&&(typeof ie.getDerivedStateFromError=="function"||me!==null&&typeof me.componentDidCatch=="function"&&(Ec===null||!Ec.has(me)))){A.flags|=65536,h&=-h,A.lanes|=h;var ze=$_(A,Q,h);h_(A,ze);break e}}A=A.return}while(A!==null)}ST(y)}catch(st){h=st,Or===y&&y!==null&&(Or=y=y.return);continue}break}while(!0)}function vT(){var d=Wm.current;return Wm.current=zm,d===null?zm:d}function Sx(){(Ur===0||Ur===3||Ur===2)&&(Ur=4),Xr===null||!(Rd&268435455)&&!(Km&268435455)||Ic(Xr,cs)}function Jm(d,h){var y=on;on|=2;var x=vT();(Xr!==d||cs!==h)&&(Tl=null,Od(d,h));do try{SU();break}catch(_){yT(d,_)}while(!0);if(RS(),on=y,Wm.current=x,Or!==null)throw Error(t(261));return Xr=null,cs=0,Ur}function SU(){for(;Or!==null;)bT(Or)}function xU(){for(;Or!==null&&!et();)bT(Or)}function bT(d){var h=CT(d.alternate,d,Zo);d.memoizedProps=d.pendingProps,h===null?ST(d):Or=h,ux.current=null}function ST(d){var h=d;do{var y=h.alternate;if(d=h.return,h.flags&32768){if(y=fU(y,h),y!==null){y.flags&=32767,Or=y;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{Ur=6,Or=null;return}}else if(y=pU(y,h,Zo),y!==null){Or=y;return}if(h=h.sibling,h!==null){Or=h;return}Or=h=d}while(h!==null);Ur===0&&(Ur=5)}function Ld(d,h,y){var x=nn,_=xi.transition;try{xi.transition=null,nn=1,wU(d,h,y,x)}finally{xi.transition=_,nn=x}return null}function wU(d,h,y,x){do Qu();while(kc!==null);if(on&6)throw Error(t(327));y=d.finishedWork;var _=d.finishedLanes;if(y===null)return null;if(d.finishedWork=null,d.finishedLanes=0,y===d.current)throw Error(t(177));d.callbackNode=null,d.callbackPriority=0;var A=y.lanes|y.childLanes;if(Mu(d,A),d===Xr&&(Or=Xr=null,cs=0),!(y.subtreeFlags&2064)&&!(y.flags&2064)||qm||(qm=!0,ET(Pn,function(){return Qu(),null})),A=(y.flags&15990)!==0,y.subtreeFlags&15990||A){A=xi.transition,xi.transition=null;var F=nn;nn=1;var Q=on;on|=4,ux.current=null,mU(d,y),dT(y,d),UB(SS),le=!!bS,SS=bS=null,d.current=y,yU(y),jt(),on=Q,nn=F,xi.transition=A}else d.current=y;if(qm&&(qm=!1,kc=d,Ym=_),A=d.pendingLanes,A===0&&(Ec=null),cc(y.stateNode),Co(d,dt()),h!==null)for(x=d.onRecoverableError,y=0;y<h.length;y++)_=h[y],x(_.value,{componentStack:_.stack,digest:_.digest});if(Vm)throw Vm=!1,d=fx,fx=null,d;return Ym&1&&d.tag!==0&&Qu(),A=d.pendingLanes,A&1?d===gx?Wp++:(Wp=0,gx=d):Wp=0,Sc(),null}function Qu(){if(kc!==null){var d=xl(Ym),h=xi.transition,y=nn;try{if(xi.transition=null,nn=16>d?16:d,kc===null)var x=!1;else{if(d=kc,kc=null,Ym=0,on&6)throw Error(t(331));var _=on;for(on|=4,Ze=d.current;Ze!==null;){var A=Ze,F=A.child;if(Ze.flags&16){var Q=A.deletions;if(Q!==null){for(var te=0;te<Q.length;te++){var ve=Q[te];for(Ze=ve;Ze!==null;){var je=Ze;switch(je.tag){case 0:case 11:case 15:Up(8,je,A)}var Re=je.child;if(Re!==null)Re.return=je,Ze=Re;else for(;Ze!==null;){je=Ze;var Ae=je.sibling,qe=je.return;if(oT(je),je===ve){Ze=null;break}if(Ae!==null){Ae.return=qe,Ze=Ae;break}Ze=qe}}}var tt=A.alternate;if(tt!==null){var rt=tt.child;if(rt!==null){tt.child=null;do{var Cr=rt.sibling;rt.sibling=null,rt=Cr}while(rt!==null)}}Ze=A}}if(A.subtreeFlags&2064&&F!==null)F.return=A,Ze=F;else e:for(;Ze!==null;){if(A=Ze,A.flags&2048)switch(A.tag){case 0:case 11:case 15:Up(9,A,A.return)}var pe=A.sibling;if(pe!==null){pe.return=A.return,Ze=pe;break e}Ze=A.return}}var ie=d.current;for(Ze=ie;Ze!==null;){F=Ze;var me=F.child;if(F.subtreeFlags&2064&&me!==null)me.return=F,Ze=me;else e:for(F=ie;Ze!==null;){if(Q=Ze,Q.flags&2048)try{switch(Q.tag){case 0:case 11:case 15:Gm(9,Q)}}catch(st){fr(Q,Q.return,st)}if(Q===F){Ze=null;break e}var ze=Q.sibling;if(ze!==null){ze.return=Q.return,Ze=ze;break e}Ze=Q.return}}if(on=_,Sc(),hr&&typeof hr.onPostCommitFiberRoot=="function")try{hr.onPostCommitFiberRoot(Dr,d)}catch{}x=!0}return x}finally{nn=y,xi.transition=h}}return!1}function xT(d,h,y){h=Yu(y,h),h=z_(d,h,1),d=wc(d,h,1),h=to(),d!==null&&(yo(d,1,h),Co(d,h))}function fr(d,h,y){if(d.tag===3)xT(d,d,y);else for(;h!==null;){if(h.tag===3){xT(h,d,y);break}else if(h.tag===1){var x=h.stateNode;if(typeof h.type.getDerivedStateFromError=="function"||typeof x.componentDidCatch=="function"&&(Ec===null||!Ec.has(x))){d=Yu(y,d),d=$_(h,d,1),h=wc(h,d,1),d=to(),h!==null&&(yo(h,1,d),Co(h,d));break}}h=h.return}}function CU(d,h,y){var x=d.pingCache;x!==null&&x.delete(h),h=to(),d.pingedLanes|=d.suspendedLanes&y,Xr===d&&(cs&y)===y&&(Ur===4||Ur===3&&(cs&130023424)===cs&&500>dt()-px?Od(d,0):hx|=y),Co(d,h)}function wT(d,h){h===0&&(d.mode&1?(h=Es,Es<<=1,!(Es&130023424)&&(Es=4194304)):h=1);var y=to();d=Pl(d,h),d!==null&&(yo(d,h,y),Co(d,y))}function EU(d){var h=d.memoizedState,y=0;h!==null&&(y=h.retryLane),wT(d,y)}function kU(d,h){var y=0;switch(d.tag){case 13:var x=d.stateNode,_=d.memoizedState;_!==null&&(y=_.retryLane);break;case 19:x=d.stateNode;break;default:throw Error(t(314))}x!==null&&x.delete(h),wT(d,y)}var CT;CT=function(d,h,y){if(d!==null)if(d.memoizedProps!==h.pendingProps||bo.current)xo=!0;else{if(!(d.lanes&y)&&!(h.flags&128))return xo=!1,hU(d,h,y);xo=!!(d.flags&131072)}else xo=!1,Xn&&h.flags&1048576&&n_(h,Im,h.index);switch(h.lanes=0,h.tag){case 2:var x=h.type;Um(d,h),d=h.pendingProps;var _=Bu(h,Is.current);Vu(h,y),_=GS(null,h,x,d,_,y);var A=WS();return h.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(h.tag=1,h.memoizedState=null,h.updateQueue=null,So(x)?(A=!0,Em(h)):A=!1,h.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,NS(h),_.updater=$m,h.stateNode=_,_._reactInternals=h,ZS(h,x,d,y),h=tx(null,h,x,!0,A,y)):(h.tag=0,Xn&&A&&IS(h),eo(null,h,_,y),h=h.child),h;case 16:x=h.elementType;e:{switch(Um(d,h),d=h.pendingProps,_=x._init,x=_(x._payload),h.type=x,_=h.tag=IU(x),d=Yi(x,d),_){case 0:h=ex(null,h,x,d,y);break e;case 1:h=Y_(null,h,x,d,y);break e;case 11:h=G_(null,h,x,d,y);break e;case 14:h=W_(null,h,x,Yi(x.type,d),y);break e}throw Error(t(306,x,""))}return h;case 0:return x=h.type,_=h.pendingProps,_=h.elementType===x?_:Yi(x,_),ex(d,h,x,_,y);case 1:return x=h.type,_=h.pendingProps,_=h.elementType===x?_:Yi(x,_),Y_(d,h,x,_,y);case 3:e:{if(X_(h),d===null)throw Error(t(387));x=h.pendingProps,A=h.memoizedState,_=A.element,u_(d,h),Rm(h,x,null,y);var F=h.memoizedState;if(x=F.element,A.isDehydrated)if(A={element:x,isDehydrated:!1,cache:F.cache,pendingSuspenseBoundaries:F.pendingSuspenseBoundaries,transitions:F.transitions},h.updateQueue.baseState=A,h.memoizedState=A,h.flags&256){_=Yu(Error(t(423)),h),h=Z_(d,h,x,y,_);break e}else if(x!==_){_=Yu(Error(t(424)),h),h=Z_(d,h,x,y,_);break e}else for(Xo=yc(h.stateNode.containerInfo.firstChild),Yo=h,Xn=!0,qi=null,y=c_(h,null,x,y),h.child=y;y;)y.flags=y.flags&-3|4096,y=y.sibling;else{if(Gu(),x===_){h=_l(d,h,y);break e}eo(d,h,x,y)}h=h.child}return h;case 5:return f_(h),d===null&&MS(h),x=h.type,_=h.pendingProps,A=d!==null?d.memoizedProps:null,F=_.children,xS(x,_)?F=null:A!==null&&xS(x,A)&&(h.flags|=32),q_(d,h),eo(d,h,F,y),h.child;case 6:return d===null&&MS(h),null;case 13:return J_(d,h,y);case 4:return FS(h,h.stateNode.containerInfo),x=h.pendingProps,d===null?h.child=Wu(h,null,x,y):eo(d,h,x,y),h.child;case 11:return x=h.type,_=h.pendingProps,_=h.elementType===x?_:Yi(x,_),G_(d,h,x,_,y);case 7:return eo(d,h,h.pendingProps,y),h.child;case 8:return eo(d,h,h.pendingProps.children,y),h.child;case 12:return eo(d,h,h.pendingProps.children,y),h.child;case 10:e:{if(x=h.type._context,_=h.pendingProps,A=h.memoizedProps,F=_.value,Fn(Mm,x._currentValue),x._currentValue=F,A!==null)if(Vi(A.value,F)){if(A.children===_.children&&!bo.current){h=_l(d,h,y);break e}}else for(A=h.child,A!==null&&(A.return=h);A!==null;){var Q=A.dependencies;if(Q!==null){F=A.child;for(var te=Q.firstContext;te!==null;){if(te.context===x){if(A.tag===1){te=Il(-1,y&-y),te.tag=2;var ve=A.updateQueue;if(ve!==null){ve=ve.shared;var je=ve.pending;je===null?te.next=te:(te.next=je.next,je.next=te),ve.pending=te}}A.lanes|=y,te=A.alternate,te!==null&&(te.lanes|=y),OS(A.return,y,h),Q.lanes|=y;break}te=te.next}}else if(A.tag===10)F=A.type===h.type?null:A.child;else if(A.tag===18){if(F=A.return,F===null)throw Error(t(341));F.lanes|=y,Q=F.alternate,Q!==null&&(Q.lanes|=y),OS(F,y,h),F=A.sibling}else F=A.child;if(F!==null)F.return=A;else for(F=A;F!==null;){if(F===h){F=null;break}if(A=F.sibling,A!==null){A.return=F.return,F=A;break}F=F.return}A=F}eo(d,h,_.children,y),h=h.child}return h;case 9:return _=h.type,x=h.pendingProps.children,Vu(h,y),_=bi(_),x=x(_),h.flags|=1,eo(d,h,x,y),h.child;case 14:return x=h.type,_=Yi(x,h.pendingProps),_=Yi(x.type,_),W_(d,h,x,_,y);case 15:return K_(d,h,h.type,h.pendingProps,y);case 17:return x=h.type,_=h.pendingProps,_=h.elementType===x?_:Yi(x,_),Um(d,h),h.tag=1,So(x)?(d=!0,Em(h)):d=!1,Vu(h,y),N_(h,x,_),ZS(h,x,_,y),tx(null,h,x,!0,d,y);case 19:return eT(d,h,y);case 22:return V_(d,h,y)}throw Error(t(156,h.tag))};function ET(d,h){return ce(d,h)}function PU(d,h,y,x){this.tag=d,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=h,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=x,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function wi(d,h,y,x){return new PU(d,h,y,x)}function xx(d){return d=d.prototype,!(!d||!d.isReactComponent)}function IU(d){if(typeof d=="function")return xx(d)?1:0;if(d!=null){if(d=d.$$typeof,d===K)return 11;if(d===X)return 14}return 2}function _c(d,h){var y=d.alternate;return y===null?(y=wi(d.tag,h,d.key,d.mode),y.elementType=d.elementType,y.type=d.type,y.stateNode=d.stateNode,y.alternate=d,d.alternate=y):(y.pendingProps=h,y.type=d.type,y.flags=0,y.subtreeFlags=0,y.deletions=null),y.flags=d.flags&14680064,y.childLanes=d.childLanes,y.lanes=d.lanes,y.child=d.child,y.memoizedProps=d.memoizedProps,y.memoizedState=d.memoizedState,y.updateQueue=d.updateQueue,h=d.dependencies,y.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},y.sibling=d.sibling,y.index=d.index,y.ref=d.ref,y}function Qm(d,h,y,x,_,A){var F=2;if(x=d,typeof d=="function")xx(d)&&(F=1);else if(typeof d=="string")F=5;else e:switch(d){case D:return Nd(y.children,_,A,h);case N:F=8,_|=8;break;case z:return d=wi(12,y,h,_|2),d.elementType=z,d.lanes=A,d;case O:return d=wi(13,y,h,_),d.elementType=O,d.lanes=A,d;case U:return d=wi(19,y,h,_),d.elementType=U,d.lanes=A,d;case ee:return ey(y,_,A,h);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case L:F=10;break e;case B:F=9;break e;case K:F=11;break e;case X:F=14;break e;case H:F=16,x=null;break e}throw Error(t(130,d==null?d:typeof d,""))}return h=wi(F,y,h,_),h.elementType=d,h.type=x,h.lanes=A,h}function Nd(d,h,y,x){return d=wi(7,d,x,h),d.lanes=y,d}function ey(d,h,y,x){return d=wi(22,d,x,h),d.elementType=ee,d.lanes=y,d.stateNode={isHidden:!1},d}function wx(d,h,y){return d=wi(6,d,null,h),d.lanes=y,d}function Cx(d,h,y){return h=wi(4,d.children!==null?d.children:[],d.key,h),h.lanes=y,h.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},h}function _U(d,h,y,x,_){this.tag=h,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Pa(0),this.expirationTimes=Pa(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Pa(0),this.identifierPrefix=x,this.onRecoverableError=_,this.mutableSourceEagerHydrationData=null}function Ex(d,h,y,x,_,A,F,Q,te){return d=new _U(d,h,y,Q,te),h===1?(h=1,A===!0&&(h|=8)):h=0,A=wi(3,null,null,h),d.current=A,A.stateNode=d,A.memoizedState={element:x,isDehydrated:y,cache:null,transitions:null,pendingSuspenseBoundaries:null},NS(A),d}function TU(d,h,y){var x=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:R,key:x==null?null:""+x,children:d,containerInfo:h,implementation:y}}function kT(d){if(!d)return bc;d=d._reactInternals;e:{if($(d)!==d||d.tag!==1)throw Error(t(170));var h=d;do{switch(h.tag){case 3:h=h.stateNode.context;break e;case 1:if(So(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break e}}h=h.return}while(h!==null);throw Error(t(171))}if(d.tag===1){var y=d.type;if(So(y))return QI(d,y,h)}return h}function PT(d,h,y,x,_,A,F,Q,te){return d=Ex(y,x,!0,d,_,A,F,Q,te),d.context=kT(null),y=d.current,x=to(),_=Pc(y),A=Il(x,_),A.callback=h??null,wc(y,A,_),d.current.lanes=_,yo(d,_,x),Co(d,x),d}function ty(d,h,y,x){var _=h.current,A=to(),F=Pc(_);return y=kT(y),h.context===null?h.context=y:h.pendingContext=y,h=Il(A,F),h.payload={element:d},x=x===void 0?null:x,x!==null&&(h.callback=x),d=wc(_,h,F),d!==null&&(Ji(d,_,F,A),jm(d,_,F)),F}function ny(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 5:return d.child.stateNode;default:return d.child.stateNode}}function IT(d,h){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var y=d.retryLane;d.retryLane=y!==0&&y<h?y:h}}function kx(d,h){IT(d,h),(d=d.alternate)&&IT(d,h)}function MU(){return null}var _T=typeof reportError=="function"?reportError:function(d){console.error(d)};function Px(d){this._internalRoot=d}ry.prototype.render=Px.prototype.render=function(d){var h=this._internalRoot;if(h===null)throw Error(t(409));ty(d,h,null,null)},ry.prototype.unmount=Px.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var h=d.containerInfo;Dd(function(){ty(null,d,null,null)}),h[wl]=null}};function ry(d){this._internalRoot=d}ry.prototype.unstable_scheduleHydration=function(d){if(d){var h=dm();d={blockedOn:null,target:d,priority:h};for(var y=0;y<Ta.length&&h!==0&&h<Ta[y].priority;y++);Ta.splice(y,0,d),y===0&&Sp(d)}};function Ix(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function sy(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function TT(){}function AU(d,h,y,x,_){if(_){if(typeof x=="function"){var A=x;x=function(){var ve=ny(F);A.call(ve)}}var F=PT(h,x,d,0,null,!1,!1,"",TT);return d._reactRootContainer=F,d[wl]=F.current,Tp(d.nodeType===8?d.parentNode:d),Dd(),F}for(;_=d.lastChild;)d.removeChild(_);if(typeof x=="function"){var Q=x;x=function(){var ve=ny(te);Q.call(ve)}}var te=Ex(d,0,!1,null,null,!1,!1,"",TT);return d._reactRootContainer=te,d[wl]=te.current,Tp(d.nodeType===8?d.parentNode:d),Dd(function(){ty(h,te,y,x)}),te}function oy(d,h,y,x,_){var A=y._reactRootContainer;if(A){var F=A;if(typeof _=="function"){var Q=_;_=function(){var te=ny(F);Q.call(te)}}ty(h,F,d,_)}else F=AU(y,h,d,_,x);return ny(F)}cm=function(d){switch(d.tag){case 3:var h=d.stateNode;if(h.current.memoizedState.isDehydrated){var y=Js(h.pendingLanes);y!==0&&(Au(h,y|1),Co(h,dt()),!(on&6)&&(Ju=dt()+500,Sc()))}break;case 13:Dd(function(){var x=Pl(d,1);if(x!==null){var _=to();Ji(x,d,1,_)}}),kx(d,1)}},yp=function(d){if(d.tag===13){var h=Pl(d,134217728);if(h!==null){var y=to();Ji(h,d,134217728,y)}kx(d,134217728)}},Gi=function(d){if(d.tag===13){var h=Pc(d),y=Pl(d,h);if(y!==null){var x=to();Ji(y,d,h,x)}kx(d,h)}},dm=function(){return nn},um=function(d,h){var y=nn;try{return nn=d,h()}finally{nn=y}},Yn=function(d,h,y){switch(h){case"input":if(vr(d,y),h=y.name,y.type==="radio"&&h!=null){for(y=d;y.parentNode;)y=y.parentNode;for(y=y.querySelectorAll("input[name="+JSON.stringify(""+h)+'][type="radio"]'),h=0;h<y.length;h++){var x=y[h];if(x!==d&&x.form===d.form){var _=wm(x);if(!_)throw Error(t(90));gn(x),vr(x,_)}}}break;case"textarea":Zs(d,y);break;case"select":h=y.value,h!=null&&dr(d,!!y.multiple,h,!1)}},is=vx,Vr=Dd;var jU={usingClientEntryPoint:!1,Events:[jp,zu,wm,On,ur,vx]},Kp={findFiberByHostInstance:Pd,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},RU={bundleType:Kp.bundleType,version:Kp.version,rendererPackageName:Kp.rendererPackageName,rendererConfig:Kp.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:w.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=Se(d),d===null?null:d.stateNode},findFiberByHostInstance:Kp.findFiberByHostInstance||MU,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var iy=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!iy.isDisabled&&iy.supportsFiber)try{Dr=iy.inject(RU),hr=iy}catch{}}return Eo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=jU,Eo.createPortal=function(d,h){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ix(h))throw Error(t(200));return TU(d,h,null,y)},Eo.createRoot=function(d,h){if(!Ix(d))throw Error(t(299));var y=!1,x="",_=_T;return h!=null&&(h.unstable_strictMode===!0&&(y=!0),h.identifierPrefix!==void 0&&(x=h.identifierPrefix),h.onRecoverableError!==void 0&&(_=h.onRecoverableError)),h=Ex(d,1,!1,null,null,y,!1,x,_),d[wl]=h.current,Tp(d.nodeType===8?d.parentNode:d),new Px(h)},Eo.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var h=d._reactInternals;if(h===void 0)throw typeof d.render=="function"?Error(t(188)):(d=Object.keys(d).join(","),Error(t(268,d)));return d=Se(h),d=d===null?null:d.stateNode,d},Eo.flushSync=function(d){return Dd(d)},Eo.hydrate=function(d,h,y){if(!sy(h))throw Error(t(200));return oy(null,d,h,!0,y)},Eo.hydrateRoot=function(d,h,y){if(!Ix(d))throw Error(t(405));var x=y!=null&&y.hydratedSources||null,_=!1,A="",F=_T;if(y!=null&&(y.unstable_strictMode===!0&&(_=!0),y.identifierPrefix!==void 0&&(A=y.identifierPrefix),y.onRecoverableError!==void 0&&(F=y.onRecoverableError)),h=PT(h,null,d,1,y??null,_,!1,A,F),d[wl]=h.current,Tp(d),x)for(d=0;d<x.length;d++)y=x[d],_=y._getVersion,_=_(y._source),h.mutableSourceEagerHydrationData==null?h.mutableSourceEagerHydrationData=[y,_]:h.mutableSourceEagerHydrationData.push(y,_);return new ry(h)},Eo.render=function(d,h,y){if(!sy(h))throw Error(t(200));return oy(null,d,h,!1,y)},Eo.unmountComponentAtNode=function(d){if(!sy(d))throw Error(t(40));return d._reactRootContainer?(Dd(function(){oy(null,null,d,!1,function(){d._reactRootContainer=null,d[wl]=null})}),!0):!1},Eo.unstable_batchedUpdates=vx,Eo.unstable_renderSubtreeIntoContainer=function(d,h,y,x){if(!sy(y))throw Error(t(200));if(d==null||d._reactInternals===void 0)throw Error(t(38));return oy(d,h,y,!1,x)},Eo.version="18.3.1-next-f1338f8080-20240426",Eo}var FT;function CO(){if(FT)return Ax.exports;FT=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),Ax.exports=GU(),Ax.exports}var zT;function WU(){if(zT)return ay;zT=1;var r=CO();return ay.createRoot=r.createRoot,ay.hydrateRoot=r.hydrateRoot,ay}var EO=WU(),Dx={exports:{}},Ox={};/**
 * @license React
 * use-sync-external-store-with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $T;function KU(){if($T)return Ox;$T=1;var r=Ag();function e(l,c){return l===c&&(l!==0||1/l===1/c)||l!==l&&c!==c}var t=typeof Object.is=="function"?Object.is:e,n=r.useSyncExternalStore,s=r.useRef,o=r.useEffect,i=r.useMemo,a=r.useDebugValue;return Ox.useSyncExternalStoreWithSelector=function(l,c,u,p,f){var m=s(null);if(m.current===null){var v={hasValue:!1,value:null};m.current=v}else v=m.current;m=i(function(){function S(M){if(!C){if(C=!0,E=M,M=p(M),f!==void 0&&v.hasValue){var R=v.value;if(f(R,M))return T=R}return T=M}if(R=T,t(E,M))return R;var D=p(M);return f!==void 0&&f(R,D)?R:(E=M,T=D)}var C=!1,E,T,w=u===void 0?null:u;return[function(){return S(c())},w===null?void 0:function(){return S(w())}]},[c,u,p,f]);var b=n(l,m[0],m[1]);return o(function(){v.hasValue=!0,v.value=b},[b]),a(b),b},Ox}var BT;function VU(){return BT||(BT=1,Dx.exports=KU()),Dx.exports}var qU=VU(),ni="default"in rE?Ht:rE,UT=Symbol.for("react-redux-context"),HT=typeof globalThis<"u"?globalThis:{};function YU(){if(!ni.createContext)return{};const r=HT[UT]??(HT[UT]=new Map);let e=r.get(ni.createContext);return e||(e=ni.createContext(null),r.set(ni.createContext,e)),e}var nd=YU(),XU=()=>{throw new Error("uSES not initialized!")};function jk(r=nd){return function(){return ni.useContext(r)}}var kO=jk(),PO=XU,ZU=r=>{PO=r},JU=(r,e)=>r===e;function QU(r=nd){const e=r===nd?kO:jk(r),t=(n,s={})=>{const{equalityFn:o=JU,devModeChecks:i={}}=typeof s=="function"?{equalityFn:s}:s,{store:a,subscription:l,getServerState:c,stabilityCheck:u,identityFunctionCheck:p}=e();ni.useRef(!0);const f=ni.useCallback({[n.name](v){return n(v)}}[n.name],[n,u,i.stabilityCheck]),m=PO(l.addNestedSub,a.getState,c||a.getState,f,o);return ni.useDebugValue(m),m};return Object.assign(t,{withTypes:()=>t}),t}var GT=QU();function eH(r){r()}function tH(){let r=null,e=null;return{clear(){r=null,e=null},notify(){eH(()=>{let t=r;for(;t;)t.callback(),t=t.next})},get(){const t=[];let n=r;for(;n;)t.push(n),n=n.next;return t},subscribe(t){let n=!0;const s=e={callback:t,next:null,prev:e};return s.prev?s.prev.next=s:r=s,function(){!n||r===null||(n=!1,s.next?s.next.prev=s.prev:e=s.prev,s.prev?s.prev.next=s.next:r=s.next)}}}}var WT={notify(){},get:()=>[]};function nH(r,e){let t,n=WT,s=0,o=!1;function i(b){u();const S=n.subscribe(b);let C=!1;return()=>{C||(C=!0,S(),p())}}function a(){n.notify()}function l(){v.onStateChange&&v.onStateChange()}function c(){return o}function u(){s++,t||(t=r.subscribe(l),n=tH())}function p(){s--,t&&s===0&&(t(),t=void 0,n.clear(),n=WT)}function f(){o||(o=!0,u())}function m(){o&&(o=!1,p())}const v={addNestedSub:i,notifyNestedSubs:a,handleChangeWrapper:l,isSubscribed:c,trySubscribe:f,tryUnsubscribe:m,getListeners:()=>n};return v}var rH=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",sH=typeof navigator<"u"&&navigator.product==="ReactNative",oH=rH||sH?ni.useLayoutEffect:ni.useEffect;function iH({store:r,context:e,children:t,serverState:n,stabilityCheck:s="once",identityFunctionCheck:o="once"}){const i=ni.useMemo(()=>{const c=nH(r);return{store:r,subscription:c,getServerState:n?()=>n:void 0,stabilityCheck:s,identityFunctionCheck:o}},[r,n,s,o]),a=ni.useMemo(()=>r.getState(),[r]);oH(()=>{const{subscription:c}=i;return c.onStateChange=c.notifyNestedSubs,c.trySubscribe(),a!==r.getState()&&c.notifyNestedSubs(),()=>{c.tryUnsubscribe(),c.onStateChange=void 0}},[i,a]);const l=e||nd;return ni.createElement(l.Provider,{value:i},t)}var aH=iH;function IO(r=nd){const e=r===nd?kO:jk(r),t=()=>{const{store:n}=e();return n};return Object.assign(t,{withTypes:()=>t}),t}var lH=IO();function cH(r=nd){const e=r===nd?lH:IO(r),t=()=>e().dispatch;return Object.assign(t,{withTypes:()=>t}),t}var dH=cH();ZU(qU.useSyncExternalStoreWithSelector);var Ky={exports:{}},uH=Ky.exports,KT;function hH(){return KT||(KT=1,function(r,e){(function(t,n){r.exports=n(Ag())})(uH,function(t){return function(n){var s={};function o(i){if(s[i])return s[i].exports;var a=s[i]={i,l:!1,exports:{}};return n[i].call(a.exports,a,a.exports,o),a.l=!0,a.exports}return o.m=n,o.c=s,o.d=function(i,a,l){o.o(i,a)||Object.defineProperty(i,a,{enumerable:!0,get:l})},o.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},o.t=function(i,a){if(1&a&&(i=o(i)),8&a||4&a&&typeof i=="object"&&i&&i.__esModule)return i;var l=Object.create(null);if(o.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:i}),2&a&&typeof i!="string")for(var c in i)o.d(l,c,(function(u){return i[u]}).bind(null,c));return l},o.n=function(i){var a=i&&i.__esModule?function(){return i.default}:function(){return i};return o.d(a,"a",a),a},o.o=function(i,a){return Object.prototype.hasOwnProperty.call(i,a)},o.p="",o(o.s=48)}([function(n,s){n.exports=t},function(n,s){var o=n.exports={version:"2.6.12"};typeof __e=="number"&&(__e=o)},function(n,s,o){var i=o(26)("wks"),a=o(17),l=o(3).Symbol,c=typeof l=="function";(n.exports=function(u){return i[u]||(i[u]=c&&l[u]||(c?l:a)("Symbol."+u))}).store=i},function(n,s){var o=n.exports=typeof window<"u"&&window.Math==Math?window:typeof self<"u"&&self.Math==Math?self:Function("return this")();typeof __g=="number"&&(__g=o)},function(n,s,o){n.exports=!o(8)(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7})},function(n,s){var o={}.hasOwnProperty;n.exports=function(i,a){return o.call(i,a)}},function(n,s,o){var i=o(7),a=o(16);n.exports=o(4)?function(l,c,u){return i.f(l,c,a(1,u))}:function(l,c,u){return l[c]=u,l}},function(n,s,o){var i=o(10),a=o(35),l=o(23),c=Object.defineProperty;s.f=o(4)?Object.defineProperty:function(u,p,f){if(i(u),p=l(p,!0),i(f),a)try{return c(u,p,f)}catch{}if("get"in f||"set"in f)throw TypeError("Accessors not supported!");return"value"in f&&(u[p]=f.value),u}},function(n,s){n.exports=function(o){try{return!!o()}catch{return!0}}},function(n,s,o){var i=o(40),a=o(22);n.exports=function(l){return i(a(l))}},function(n,s,o){var i=o(11);n.exports=function(a){if(!i(a))throw TypeError(a+" is not an object!");return a}},function(n,s){n.exports=function(o){return typeof o=="object"?o!==null:typeof o=="function"}},function(n,s){n.exports={}},function(n,s,o){var i=o(39),a=o(27);n.exports=Object.keys||function(l){return i(l,a)}},function(n,s){n.exports=!0},function(n,s,o){var i=o(3),a=o(1),l=o(53),c=o(6),u=o(5),p=function(f,m,v){var b,S,C,E=f&p.F,T=f&p.G,w=f&p.S,M=f&p.P,R=f&p.B,D=f&p.W,N=T?a:a[m]||(a[m]={}),z=N.prototype,L=T?i:w?i[m]:(i[m]||{}).prototype;for(b in T&&(v=m),v)(S=!E&&L&&L[b]!==void 0)&&u(N,b)||(C=S?L[b]:v[b],N[b]=T&&typeof L[b]!="function"?v[b]:R&&S?l(C,i):D&&L[b]==C?function(B){var K=function(O,U,X){if(this instanceof B){switch(arguments.length){case 0:return new B;case 1:return new B(O);case 2:return new B(O,U)}return new B(O,U,X)}return B.apply(this,arguments)};return K.prototype=B.prototype,K}(C):M&&typeof C=="function"?l(Function.call,C):C,M&&((N.virtual||(N.virtual={}))[b]=C,f&p.R&&z&&!z[b]&&c(z,b,C)))};p.F=1,p.G=2,p.S=4,p.P=8,p.B=16,p.W=32,p.U=64,p.R=128,n.exports=p},function(n,s){n.exports=function(o,i){return{enumerable:!(1&o),configurable:!(2&o),writable:!(4&o),value:i}}},function(n,s){var o=0,i=Math.random();n.exports=function(a){return"Symbol(".concat(a===void 0?"":a,")_",(++o+i).toString(36))}},function(n,s,o){var i=o(22);n.exports=function(a){return Object(i(a))}},function(n,s){s.f={}.propertyIsEnumerable},function(n,s,o){var i=o(52)(!0);o(34)(String,"String",function(a){this._t=String(a),this._i=0},function(){var a,l=this._t,c=this._i;return c>=l.length?{value:void 0,done:!0}:(a=i(l,c),this._i+=a.length,{value:a,done:!1})})},function(n,s){var o=Math.ceil,i=Math.floor;n.exports=function(a){return isNaN(a=+a)?0:(a>0?i:o)(a)}},function(n,s){n.exports=function(o){if(o==null)throw TypeError("Can't call method on  "+o);return o}},function(n,s,o){var i=o(11);n.exports=function(a,l){if(!i(a))return a;var c,u;if(l&&typeof(c=a.toString)=="function"&&!i(u=c.call(a))||typeof(c=a.valueOf)=="function"&&!i(u=c.call(a))||!l&&typeof(c=a.toString)=="function"&&!i(u=c.call(a)))return u;throw TypeError("Can't convert object to primitive value")}},function(n,s){var o={}.toString;n.exports=function(i){return o.call(i).slice(8,-1)}},function(n,s,o){var i=o(26)("keys"),a=o(17);n.exports=function(l){return i[l]||(i[l]=a(l))}},function(n,s,o){var i=o(1),a=o(3),l=a["__core-js_shared__"]||(a["__core-js_shared__"]={});(n.exports=function(c,u){return l[c]||(l[c]=u!==void 0?u:{})})("versions",[]).push({version:i.version,mode:o(14)?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},function(n,s){n.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(n,s,o){var i=o(7).f,a=o(5),l=o(2)("toStringTag");n.exports=function(c,u,p){c&&!a(c=p?c:c.prototype,l)&&i(c,l,{configurable:!0,value:u})}},function(n,s,o){o(62);for(var i=o(3),a=o(6),l=o(12),c=o(2)("toStringTag"),u="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),p=0;p<u.length;p++){var f=u[p],m=i[f],v=m&&m.prototype;v&&!v[c]&&a(v,c,f),l[f]=l.Array}},function(n,s,o){s.f=o(2)},function(n,s,o){var i=o(3),a=o(1),l=o(14),c=o(30),u=o(7).f;n.exports=function(p){var f=a.Symbol||(a.Symbol=l?{}:i.Symbol||{});p.charAt(0)=="_"||p in f||u(f,p,{value:c.f(p)})}},function(n,s){s.f=Object.getOwnPropertySymbols},function(n,s){n.exports=function(o,i,a){return Math.min(Math.max(o,i),a)}},function(n,s,o){var i=o(14),a=o(15),l=o(37),c=o(6),u=o(12),p=o(55),f=o(28),m=o(61),v=o(2)("iterator"),b=!([].keys&&"next"in[].keys()),S=function(){return this};n.exports=function(C,E,T,w,M,R,D){p(T,E,w);var N,z,L,B=function(ae){if(!b&&ae in X)return X[ae];switch(ae){case"keys":case"values":return function(){return new T(this,ae)}}return function(){return new T(this,ae)}},K=E+" Iterator",O=M=="values",U=!1,X=C.prototype,H=X[v]||X["@@iterator"]||M&&X[M],ee=H||B(M),J=M?O?B("entries"):ee:void 0,ne=E=="Array"&&X.entries||H;if(ne&&(L=m(ne.call(new C)))!==Object.prototype&&L.next&&(f(L,K,!0),i||typeof L[v]=="function"||c(L,v,S)),O&&H&&H.name!=="values"&&(U=!0,ee=function(){return H.call(this)}),i&&!D||!b&&!U&&X[v]||c(X,v,ee),u[E]=ee,u[K]=S,M)if(N={values:O?ee:B("values"),keys:R?ee:B("keys"),entries:J},D)for(z in N)z in X||l(X,z,N[z]);else a(a.P+a.F*(b||U),E,N);return N}},function(n,s,o){n.exports=!o(4)&&!o(8)(function(){return Object.defineProperty(o(36)("div"),"a",{get:function(){return 7}}).a!=7})},function(n,s,o){var i=o(11),a=o(3).document,l=i(a)&&i(a.createElement);n.exports=function(c){return l?a.createElement(c):{}}},function(n,s,o){n.exports=o(6)},function(n,s,o){var i=o(10),a=o(56),l=o(27),c=o(25)("IE_PROTO"),u=function(){},p=function(){var f,m=o(36)("iframe"),v=l.length;for(m.style.display="none",o(60).appendChild(m),m.src="javascript:",(f=m.contentWindow.document).open(),f.write("<script>document.F=Object<\/script>"),f.close(),p=f.F;v--;)delete p.prototype[l[v]];return p()};n.exports=Object.create||function(f,m){var v;return f!==null?(u.prototype=i(f),v=new u,u.prototype=null,v[c]=f):v=p(),m===void 0?v:a(v,m)}},function(n,s,o){var i=o(5),a=o(9),l=o(57)(!1),c=o(25)("IE_PROTO");n.exports=function(u,p){var f,m=a(u),v=0,b=[];for(f in m)f!=c&&i(m,f)&&b.push(f);for(;p.length>v;)i(m,f=p[v++])&&(~l(b,f)||b.push(f));return b}},function(n,s,o){var i=o(24);n.exports=Object("z").propertyIsEnumerable(0)?Object:function(a){return i(a)=="String"?a.split(""):Object(a)}},function(n,s,o){var i=o(39),a=o(27).concat("length","prototype");s.f=Object.getOwnPropertyNames||function(l){return i(l,a)}},function(n,s,o){var i=o(24),a=o(2)("toStringTag"),l=i(function(){return arguments}())=="Arguments";n.exports=function(c){var u,p,f;return c===void 0?"Undefined":c===null?"Null":typeof(p=function(m,v){try{return m[v]}catch{}}(u=Object(c),a))=="string"?p:l?i(u):(f=i(u))=="Object"&&typeof u.callee=="function"?"Arguments":f}},function(n,s){var o;o=function(){return this}();try{o=o||new Function("return this")()}catch{typeof window=="object"&&(o=window)}n.exports=o},function(n,s){var o=/-?\d+(\.\d+)?%?/g;n.exports=function(i){return i.match(o)}},function(n,s,o){Object.defineProperty(s,"__esModule",{value:!0}),s.getBase16Theme=s.createStyling=s.invertTheme=void 0;var i=S(o(49)),a=S(o(76)),l=S(o(81)),c=S(o(89)),u=S(o(93)),p=function(z){if(z&&z.__esModule)return z;var L={};if(z!=null)for(var B in z)Object.prototype.hasOwnProperty.call(z,B)&&(L[B]=z[B]);return L.default=z,L}(o(94)),f=S(o(132)),m=S(o(133)),v=S(o(138)),b=o(139);function S(z){return z&&z.__esModule?z:{default:z}}var C=p.default,E=(0,c.default)(C),T=(0,v.default)(m.default,b.rgb2yuv,function(z){var L,B=(0,l.default)(z,3),K=B[0],O=B[1],U=B[2];return[(L=K,L<.25?1:L<.5?.9-L:1.1-L),O,U]},b.yuv2rgb,f.default),w=function(z){return function(L){return{className:[L.className,z.className].filter(Boolean).join(" "),style:(0,a.default)({},L.style||{},z.style||{})}}},M=function(z,L){var B=(0,c.default)(L);for(var K in z)B.indexOf(K)===-1&&B.push(K);return B.reduce(function(O,U){return O[U]=function(X,H){if(X===void 0)return H;if(H===void 0)return X;var ee=X===void 0?"undefined":(0,i.default)(X),J=H===void 0?"undefined":(0,i.default)(H);switch(ee){case"string":switch(J){case"string":return[H,X].filter(Boolean).join(" ");case"object":return w({className:X,style:H});case"function":return function(ne){for(var ae=arguments.length,q=Array(ae>1?ae-1:0),se=1;se<ae;se++)q[se-1]=arguments[se];return w({className:X})(H.apply(void 0,[ne].concat(q)))}}case"object":switch(J){case"string":return w({className:H,style:X});case"object":return(0,a.default)({},H,X);case"function":return function(ne){for(var ae=arguments.length,q=Array(ae>1?ae-1:0),se=1;se<ae;se++)q[se-1]=arguments[se];return w({style:X})(H.apply(void 0,[ne].concat(q)))}}case"function":switch(J){case"string":return function(ne){for(var ae=arguments.length,q=Array(ae>1?ae-1:0),se=1;se<ae;se++)q[se-1]=arguments[se];return X.apply(void 0,[w(ne)({className:H})].concat(q))};case"object":return function(ne){for(var ae=arguments.length,q=Array(ae>1?ae-1:0),se=1;se<ae;se++)q[se-1]=arguments[se];return X.apply(void 0,[w(ne)({style:H})].concat(q))};case"function":return function(ne){for(var ae=arguments.length,q=Array(ae>1?ae-1:0),se=1;se<ae;se++)q[se-1]=arguments[se];return X.apply(void 0,[H.apply(void 0,[ne].concat(q))].concat(q))}}}}(z[U],L[U]),O},{})},R=function(z,L){for(var B=arguments.length,K=Array(B>2?B-2:0),O=2;O<B;O++)K[O-2]=arguments[O];if(L===null)return z;Array.isArray(L)||(L=[L]);var U=L.map(function(H){return z[H]}).filter(Boolean),X=U.reduce(function(H,ee){return typeof ee=="string"?H.className=[H.className,ee].filter(Boolean).join(" "):(ee===void 0?"undefined":(0,i.default)(ee))==="object"?H.style=(0,a.default)({},H.style,ee):typeof ee=="function"&&(H=(0,a.default)({},H,ee.apply(void 0,[H].concat(K)))),H},{className:"",style:{}});return X.className||delete X.className,(0,c.default)(X.style).length===0&&delete X.style,X},D=s.invertTheme=function(z){return(0,c.default)(z).reduce(function(L,B){return L[B]=/^base/.test(B)?T(z[B]):B==="scheme"?z[B]+":inverted":z[B],L},{})},N=(s.createStyling=(0,u.default)(function(z){for(var L=arguments.length,B=Array(L>3?L-3:0),K=3;K<L;K++)B[K-3]=arguments[K];var O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},U=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},X=O.defaultBase16,H=X===void 0?C:X,ee=O.base16Themes,J=ee===void 0?null:ee,ne=N(U,J);ne&&(U=(0,a.default)({},ne,U));var ae=E.reduce(function(Oe,Ee){return Oe[Ee]=U[Ee]||H[Ee],Oe},{}),q=(0,c.default)(U).reduce(function(Oe,Ee){return E.indexOf(Ee)===-1&&(Oe[Ee]=U[Ee]),Oe},{}),se=z(ae),xe=M(q,se);return(0,u.default)(R,2).apply(void 0,[xe].concat(B))},3),s.getBase16Theme=function(z,L){if(z&&z.extend&&(z=z.extend),typeof z=="string"){var B=z.split(":"),K=(0,l.default)(B,2),O=K[0],U=K[1];z=(L||{})[O]||p[O],U==="inverted"&&(z=D(z))}return z&&z.hasOwnProperty("base00")?z:void 0})},function(n,s,o){var i,a=typeof Reflect=="object"?Reflect:null,l=a&&typeof a.apply=="function"?a.apply:function(w,M,R){return Function.prototype.apply.call(w,M,R)};i=a&&typeof a.ownKeys=="function"?a.ownKeys:Object.getOwnPropertySymbols?function(w){return Object.getOwnPropertyNames(w).concat(Object.getOwnPropertySymbols(w))}:function(w){return Object.getOwnPropertyNames(w)};var c=Number.isNaN||function(w){return w!=w};function u(){u.init.call(this)}n.exports=u,n.exports.once=function(w,M){return new Promise(function(R,D){function N(){z!==void 0&&w.removeListener("error",z),R([].slice.call(arguments))}var z;M!=="error"&&(z=function(L){w.removeListener(M,N),D(L)},w.once("error",z)),w.once(M,N)})},u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var p=10;function f(w){if(typeof w!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof w)}function m(w){return w._maxListeners===void 0?u.defaultMaxListeners:w._maxListeners}function v(w,M,R,D){var N,z,L,B;if(f(R),(z=w._events)===void 0?(z=w._events=Object.create(null),w._eventsCount=0):(z.newListener!==void 0&&(w.emit("newListener",M,R.listener?R.listener:R),z=w._events),L=z[M]),L===void 0)L=z[M]=R,++w._eventsCount;else if(typeof L=="function"?L=z[M]=D?[R,L]:[L,R]:D?L.unshift(R):L.push(R),(N=m(w))>0&&L.length>N&&!L.warned){L.warned=!0;var K=new Error("Possible EventEmitter memory leak detected. "+L.length+" "+String(M)+" listeners added. Use emitter.setMaxListeners() to increase limit");K.name="MaxListenersExceededWarning",K.emitter=w,K.type=M,K.count=L.length,B=K,console&&console.warn&&console.warn(B)}return w}function b(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function S(w,M,R){var D={fired:!1,wrapFn:void 0,target:w,type:M,listener:R},N=b.bind(D);return N.listener=R,D.wrapFn=N,N}function C(w,M,R){var D=w._events;if(D===void 0)return[];var N=D[M];return N===void 0?[]:typeof N=="function"?R?[N.listener||N]:[N]:R?function(z){for(var L=new Array(z.length),B=0;B<L.length;++B)L[B]=z[B].listener||z[B];return L}(N):T(N,N.length)}function E(w){var M=this._events;if(M!==void 0){var R=M[w];if(typeof R=="function")return 1;if(R!==void 0)return R.length}return 0}function T(w,M){for(var R=new Array(M),D=0;D<M;++D)R[D]=w[D];return R}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return p},set:function(w){if(typeof w!="number"||w<0||c(w))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+w+".");p=w}}),u.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(w){if(typeof w!="number"||w<0||c(w))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+w+".");return this._maxListeners=w,this},u.prototype.getMaxListeners=function(){return m(this)},u.prototype.emit=function(w){for(var M=[],R=1;R<arguments.length;R++)M.push(arguments[R]);var D=w==="error",N=this._events;if(N!==void 0)D=D&&N.error===void 0;else if(!D)return!1;if(D){var z;if(M.length>0&&(z=M[0]),z instanceof Error)throw z;var L=new Error("Unhandled error."+(z?" ("+z.message+")":""));throw L.context=z,L}var B=N[w];if(B===void 0)return!1;if(typeof B=="function")l(B,this,M);else{var K=B.length,O=T(B,K);for(R=0;R<K;++R)l(O[R],this,M)}return!0},u.prototype.addListener=function(w,M){return v(this,w,M,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(w,M){return v(this,w,M,!0)},u.prototype.once=function(w,M){return f(M),this.on(w,S(this,w,M)),this},u.prototype.prependOnceListener=function(w,M){return f(M),this.prependListener(w,S(this,w,M)),this},u.prototype.removeListener=function(w,M){var R,D,N,z,L;if(f(M),(D=this._events)===void 0)return this;if((R=D[w])===void 0)return this;if(R===M||R.listener===M)--this._eventsCount==0?this._events=Object.create(null):(delete D[w],D.removeListener&&this.emit("removeListener",w,R.listener||M));else if(typeof R!="function"){for(N=-1,z=R.length-1;z>=0;z--)if(R[z]===M||R[z].listener===M){L=R[z].listener,N=z;break}if(N<0)return this;N===0?R.shift():function(B,K){for(;K+1<B.length;K++)B[K]=B[K+1];B.pop()}(R,N),R.length===1&&(D[w]=R[0]),D.removeListener!==void 0&&this.emit("removeListener",w,L||M)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(w){var M,R,D;if((R=this._events)===void 0)return this;if(R.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):R[w]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete R[w]),this;if(arguments.length===0){var N,z=Object.keys(R);for(D=0;D<z.length;++D)(N=z[D])!=="removeListener"&&this.removeAllListeners(N);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(M=R[w])=="function")this.removeListener(w,M);else if(M!==void 0)for(D=M.length-1;D>=0;D--)this.removeListener(w,M[D]);return this},u.prototype.listeners=function(w){return C(this,w,!0)},u.prototype.rawListeners=function(w){return C(this,w,!1)},u.listenerCount=function(w,M){return typeof w.listenerCount=="function"?w.listenerCount(M):E.call(w,M)},u.prototype.listenerCount=E,u.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},function(n,s,o){n.exports.Dispatcher=o(140)},function(n,s,o){n.exports=o(142)},function(n,s,o){s.__esModule=!0;var i=c(o(50)),a=c(o(65)),l=typeof a.default=="function"&&typeof i.default=="symbol"?function(u){return typeof u}:function(u){return u&&typeof a.default=="function"&&u.constructor===a.default&&u!==a.default.prototype?"symbol":typeof u};function c(u){return u&&u.__esModule?u:{default:u}}s.default=typeof a.default=="function"&&l(i.default)==="symbol"?function(u){return u===void 0?"undefined":l(u)}:function(u){return u&&typeof a.default=="function"&&u.constructor===a.default&&u!==a.default.prototype?"symbol":u===void 0?"undefined":l(u)}},function(n,s,o){n.exports={default:o(51),__esModule:!0}},function(n,s,o){o(20),o(29),n.exports=o(30).f("iterator")},function(n,s,o){var i=o(21),a=o(22);n.exports=function(l){return function(c,u){var p,f,m=String(a(c)),v=i(u),b=m.length;return v<0||v>=b?l?"":void 0:(p=m.charCodeAt(v))<55296||p>56319||v+1===b||(f=m.charCodeAt(v+1))<56320||f>57343?l?m.charAt(v):p:l?m.slice(v,v+2):f-56320+(p-55296<<10)+65536}}},function(n,s,o){var i=o(54);n.exports=function(a,l,c){if(i(a),l===void 0)return a;switch(c){case 1:return function(u){return a.call(l,u)};case 2:return function(u,p){return a.call(l,u,p)};case 3:return function(u,p,f){return a.call(l,u,p,f)}}return function(){return a.apply(l,arguments)}}},function(n,s){n.exports=function(o){if(typeof o!="function")throw TypeError(o+" is not a function!");return o}},function(n,s,o){var i=o(38),a=o(16),l=o(28),c={};o(6)(c,o(2)("iterator"),function(){return this}),n.exports=function(u,p,f){u.prototype=i(c,{next:a(1,f)}),l(u,p+" Iterator")}},function(n,s,o){var i=o(7),a=o(10),l=o(13);n.exports=o(4)?Object.defineProperties:function(c,u){a(c);for(var p,f=l(u),m=f.length,v=0;m>v;)i.f(c,p=f[v++],u[p]);return c}},function(n,s,o){var i=o(9),a=o(58),l=o(59);n.exports=function(c){return function(u,p,f){var m,v=i(u),b=a(v.length),S=l(f,b);if(c&&p!=p){for(;b>S;)if((m=v[S++])!=m)return!0}else for(;b>S;S++)if((c||S in v)&&v[S]===p)return c||S||0;return!c&&-1}}},function(n,s,o){var i=o(21),a=Math.min;n.exports=function(l){return l>0?a(i(l),9007199254740991):0}},function(n,s,o){var i=o(21),a=Math.max,l=Math.min;n.exports=function(c,u){return(c=i(c))<0?a(c+u,0):l(c,u)}},function(n,s,o){var i=o(3).document;n.exports=i&&i.documentElement},function(n,s,o){var i=o(5),a=o(18),l=o(25)("IE_PROTO"),c=Object.prototype;n.exports=Object.getPrototypeOf||function(u){return u=a(u),i(u,l)?u[l]:typeof u.constructor=="function"&&u instanceof u.constructor?u.constructor.prototype:u instanceof Object?c:null}},function(n,s,o){var i=o(63),a=o(64),l=o(12),c=o(9);n.exports=o(34)(Array,"Array",function(u,p){this._t=c(u),this._i=0,this._k=p},function(){var u=this._t,p=this._k,f=this._i++;return!u||f>=u.length?(this._t=void 0,a(1)):a(0,p=="keys"?f:p=="values"?u[f]:[f,u[f]])},"values"),l.Arguments=l.Array,i("keys"),i("values"),i("entries")},function(n,s){n.exports=function(){}},function(n,s){n.exports=function(o,i){return{value:i,done:!!o}}},function(n,s,o){n.exports={default:o(66),__esModule:!0}},function(n,s,o){o(67),o(73),o(74),o(75),n.exports=o(1).Symbol},function(n,s,o){var i=o(3),a=o(5),l=o(4),c=o(15),u=o(37),p=o(68).KEY,f=o(8),m=o(26),v=o(28),b=o(17),S=o(2),C=o(30),E=o(31),T=o(69),w=o(70),M=o(10),R=o(11),D=o(18),N=o(9),z=o(23),L=o(16),B=o(38),K=o(71),O=o(72),U=o(32),X=o(7),H=o(13),ee=O.f,J=X.f,ne=K.f,ae=i.Symbol,q=i.JSON,se=q&&q.stringify,xe=S("_hidden"),Oe=S("toPrimitive"),Ee={}.propertyIsEnumerable,Ue=m("symbol-registry"),Be=m("symbols"),Te=m("op-symbols"),Le=Object.prototype,Xe=typeof ae=="function"&&!!U.f,pt=i.QObject,gn=!pt||!pt.prototype||!pt.prototype.findChild,Dt=l&&f(function(){return B(J({},"a",{get:function(){return J(this,"a",{value:7}).a}})).a!=7})?function(he,Ce,$e){var re=ee(Le,Ce);re&&delete Le[Ce],J(he,Ce,$e),re&&he!==Le&&J(Le,Ce,re)}:J,sn=function(he){var Ce=Be[he]=B(ae.prototype);return Ce._k=he,Ce},Kt=Xe&&typeof ae.iterator=="symbol"?function(he){return typeof he=="symbol"}:function(he){return he instanceof ae},Nt=function(he,Ce,$e){return he===Le&&Nt(Te,Ce,$e),M(he),Ce=z(Ce,!0),M($e),a(Be,Ce)?($e.enumerable?(a(he,xe)&&he[xe][Ce]&&(he[xe][Ce]=!1),$e=B($e,{enumerable:L(0,!1)})):(a(he,xe)||J(he,xe,L(1,{})),he[xe][Ce]=!0),Dt(he,Ce,$e)):J(he,Ce,$e)},vr=function(he,Ce){M(he);for(var $e,re=T(Ce=N(Ce)),we=0,Fe=re.length;Fe>we;)Nt(he,$e=re[we++],Ce[$e]);return he},br=function(he){var Ce=Ee.call(this,he=z(he,!0));return!(this===Le&&a(Be,he)&&!a(Te,he))&&(!(Ce||!a(this,he)||!a(Be,he)||a(this,xe)&&this[xe][he])||Ce)},Qn=function(he,Ce){if(he=N(he),Ce=z(Ce,!0),he!==Le||!a(Be,Ce)||a(Te,Ce)){var $e=ee(he,Ce);return!$e||!a(Be,Ce)||a(he,xe)&&he[xe][Ce]||($e.enumerable=!0),$e}},Sr=function(he){for(var Ce,$e=ne(N(he)),re=[],we=0;$e.length>we;)a(Be,Ce=$e[we++])||Ce==xe||Ce==p||re.push(Ce);return re},dr=function(he){for(var Ce,$e=he===Le,re=ne($e?Te:N(he)),we=[],Fe=0;re.length>Fe;)!a(Be,Ce=re[Fe++])||$e&&!a(Le,Ce)||we.push(Be[Ce]);return we};Xe||(u((ae=function(){if(this instanceof ae)throw TypeError("Symbol is not a constructor!");var he=b(arguments.length>0?arguments[0]:void 0),Ce=function($e){this===Le&&Ce.call(Te,$e),a(this,xe)&&a(this[xe],he)&&(this[xe][he]=!1),Dt(this,he,L(1,$e))};return l&&gn&&Dt(Le,he,{configurable:!0,set:Ce}),sn(he)}).prototype,"toString",function(){return this._k}),O.f=Qn,X.f=Nt,o(41).f=K.f=Sr,o(19).f=br,U.f=dr,l&&!o(14)&&u(Le,"propertyIsEnumerable",br,!0),C.f=function(he){return sn(S(he))}),c(c.G+c.W+c.F*!Xe,{Symbol:ae});for(var Rr="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),qn=0;Rr.length>qn;)S(Rr[qn++]);for(var Zs=H(S.store),ke=0;Zs.length>ke;)E(Zs[ke++]);c(c.S+c.F*!Xe,"Symbol",{for:function(he){return a(Ue,he+="")?Ue[he]:Ue[he]=ae(he)},keyFor:function(he){if(!Kt(he))throw TypeError(he+" is not a symbol!");for(var Ce in Ue)if(Ue[Ce]===he)return Ce},useSetter:function(){gn=!0},useSimple:function(){gn=!1}}),c(c.S+c.F*!Xe,"Object",{create:function(he,Ce){return Ce===void 0?B(he):vr(B(he),Ce)},defineProperty:Nt,defineProperties:vr,getOwnPropertyDescriptor:Qn,getOwnPropertyNames:Sr,getOwnPropertySymbols:dr});var ge=f(function(){U.f(1)});c(c.S+c.F*ge,"Object",{getOwnPropertySymbols:function(he){return U.f(D(he))}}),q&&c(c.S+c.F*(!Xe||f(function(){var he=ae();return se([he])!="[null]"||se({a:he})!="{}"||se(Object(he))!="{}"})),"JSON",{stringify:function(he){for(var Ce,$e,re=[he],we=1;arguments.length>we;)re.push(arguments[we++]);if($e=Ce=re[1],(R(Ce)||he!==void 0)&&!Kt(he))return w(Ce)||(Ce=function(Fe,ct){if(typeof $e=="function"&&(ct=$e.call(this,Fe,ct)),!Kt(ct))return ct}),re[1]=Ce,se.apply(q,re)}}),ae.prototype[Oe]||o(6)(ae.prototype,Oe,ae.prototype.valueOf),v(ae,"Symbol"),v(Math,"Math",!0),v(i.JSON,"JSON",!0)},function(n,s,o){var i=o(17)("meta"),a=o(11),l=o(5),c=o(7).f,u=0,p=Object.isExtensible||function(){return!0},f=!o(8)(function(){return p(Object.preventExtensions({}))}),m=function(b){c(b,i,{value:{i:"O"+ ++u,w:{}}})},v=n.exports={KEY:i,NEED:!1,fastKey:function(b,S){if(!a(b))return typeof b=="symbol"?b:(typeof b=="string"?"S":"P")+b;if(!l(b,i)){if(!p(b))return"F";if(!S)return"E";m(b)}return b[i].i},getWeak:function(b,S){if(!l(b,i)){if(!p(b))return!0;if(!S)return!1;m(b)}return b[i].w},onFreeze:function(b){return f&&v.NEED&&p(b)&&!l(b,i)&&m(b),b}}},function(n,s,o){var i=o(13),a=o(32),l=o(19);n.exports=function(c){var u=i(c),p=a.f;if(p)for(var f,m=p(c),v=l.f,b=0;m.length>b;)v.call(c,f=m[b++])&&u.push(f);return u}},function(n,s,o){var i=o(24);n.exports=Array.isArray||function(a){return i(a)=="Array"}},function(n,s,o){var i=o(9),a=o(41).f,l={}.toString,c=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];n.exports.f=function(u){return c&&l.call(u)=="[object Window]"?function(p){try{return a(p)}catch{return c.slice()}}(u):a(i(u))}},function(n,s,o){var i=o(19),a=o(16),l=o(9),c=o(23),u=o(5),p=o(35),f=Object.getOwnPropertyDescriptor;s.f=o(4)?f:function(m,v){if(m=l(m),v=c(v,!0),p)try{return f(m,v)}catch{}if(u(m,v))return a(!i.f.call(m,v),m[v])}},function(n,s){},function(n,s,o){o(31)("asyncIterator")},function(n,s,o){o(31)("observable")},function(n,s,o){s.__esModule=!0;var i,a=o(77),l=(i=a)&&i.__esModule?i:{default:i};s.default=l.default||function(c){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var f in p)Object.prototype.hasOwnProperty.call(p,f)&&(c[f]=p[f])}return c}},function(n,s,o){n.exports={default:o(78),__esModule:!0}},function(n,s,o){o(79),n.exports=o(1).Object.assign},function(n,s,o){var i=o(15);i(i.S+i.F,"Object",{assign:o(80)})},function(n,s,o){var i=o(4),a=o(13),l=o(32),c=o(19),u=o(18),p=o(40),f=Object.assign;n.exports=!f||o(8)(function(){var m={},v={},b=Symbol(),S="abcdefghijklmnopqrst";return m[b]=7,S.split("").forEach(function(C){v[C]=C}),f({},m)[b]!=7||Object.keys(f({},v)).join("")!=S})?function(m,v){for(var b=u(m),S=arguments.length,C=1,E=l.f,T=c.f;S>C;)for(var w,M=p(arguments[C++]),R=E?a(M).concat(E(M)):a(M),D=R.length,N=0;D>N;)w=R[N++],i&&!T.call(M,w)||(b[w]=M[w]);return b}:f},function(n,s,o){s.__esModule=!0;var i=l(o(82)),a=l(o(85));function l(c){return c&&c.__esModule?c:{default:c}}s.default=function(c,u){if(Array.isArray(c))return c;if((0,i.default)(Object(c)))return function(p,f){var m=[],v=!0,b=!1,S=void 0;try{for(var C,E=(0,a.default)(p);!(v=(C=E.next()).done)&&(m.push(C.value),!f||m.length!==f);v=!0);}catch(T){b=!0,S=T}finally{try{!v&&E.return&&E.return()}finally{if(b)throw S}}return m}(c,u);throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(n,s,o){n.exports={default:o(83),__esModule:!0}},function(n,s,o){o(29),o(20),n.exports=o(84)},function(n,s,o){var i=o(42),a=o(2)("iterator"),l=o(12);n.exports=o(1).isIterable=function(c){var u=Object(c);return u[a]!==void 0||"@@iterator"in u||l.hasOwnProperty(i(u))}},function(n,s,o){n.exports={default:o(86),__esModule:!0}},function(n,s,o){o(29),o(20),n.exports=o(87)},function(n,s,o){var i=o(10),a=o(88);n.exports=o(1).getIterator=function(l){var c=a(l);if(typeof c!="function")throw TypeError(l+" is not iterable!");return i(c.call(l))}},function(n,s,o){var i=o(42),a=o(2)("iterator"),l=o(12);n.exports=o(1).getIteratorMethod=function(c){if(c!=null)return c[a]||c["@@iterator"]||l[i(c)]}},function(n,s,o){n.exports={default:o(90),__esModule:!0}},function(n,s,o){o(91),n.exports=o(1).Object.keys},function(n,s,o){var i=o(18),a=o(13);o(92)("keys",function(){return function(l){return a(i(l))}})},function(n,s,o){var i=o(15),a=o(1),l=o(8);n.exports=function(c,u){var p=(a.Object||{})[c]||Object[c],f={};f[c]=u(p),i(i.S+i.F*l(function(){p(1)}),"Object",f)}},function(n,s,o){(function(i){var a=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],l=/^\s+|\s+$/g,c=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,u=/\{\n\/\* \[wrapped with (.+)\] \*/,p=/,? & /,f=/^[-+]0x[0-9a-f]+$/i,m=/^0b[01]+$/i,v=/^\[object .+?Constructor\]$/,b=/^0o[0-7]+$/i,S=/^(?:0|[1-9]\d*)$/,C=parseInt,E=typeof i=="object"&&i&&i.Object===Object&&i,T=typeof self=="object"&&self&&self.Object===Object&&self,w=E||T||Function("return this")();function M(ke,ge,he){switch(he.length){case 0:return ke.call(ge);case 1:return ke.call(ge,he[0]);case 2:return ke.call(ge,he[0],he[1]);case 3:return ke.call(ge,he[0],he[1],he[2])}return ke.apply(ge,he)}function R(ke,ge){return!!(ke&&ke.length)&&function(he,Ce,$e){if(Ce!=Ce)return function(Fe,ct,tn,Vt){for(var Tn=Fe.length,qt=tn+-1;++qt<Tn;)if(ct(Fe[qt],qt,Fe))return qt;return-1}(he,D,$e);for(var re=$e-1,we=he.length;++re<we;)if(he[re]===Ce)return re;return-1}(ke,ge,0)>-1}function D(ke){return ke!=ke}function N(ke,ge){for(var he=ke.length,Ce=0;he--;)ke[he]===ge&&Ce++;return Ce}function z(ke,ge){for(var he=-1,Ce=ke.length,$e=0,re=[];++he<Ce;){var we=ke[he];we!==ge&&we!=="__lodash_placeholder__"||(ke[he]="__lodash_placeholder__",re[$e++]=he)}return re}var L,B,K,O=Function.prototype,U=Object.prototype,X=w["__core-js_shared__"],H=(L=/[^.]+$/.exec(X&&X.keys&&X.keys.IE_PROTO||""))?"Symbol(src)_1."+L:"",ee=O.toString,J=U.hasOwnProperty,ne=U.toString,ae=RegExp("^"+ee.call(J).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),q=Object.create,se=Math.max,xe=Math.min,Oe=(B=sn(Object,"defineProperty"),(K=sn.name)&&K.length>2?B:void 0);function Ee(ke){return Rr(ke)?q(ke):{}}function Ue(ke){return!(!Rr(ke)||function(ge){return!!H&&H in ge}(ke))&&(function(ge){var he=Rr(ge)?ne.call(ge):"";return he=="[object Function]"||he=="[object GeneratorFunction]"}(ke)||function(ge){var he=!1;if(ge!=null&&typeof ge.toString!="function")try{he=!!(ge+"")}catch{}return he}(ke)?ae:v).test(function(ge){if(ge!=null){try{return ee.call(ge)}catch{}try{return ge+""}catch{}}return""}(ke))}function Be(ke,ge,he,Ce){for(var $e=-1,re=ke.length,we=he.length,Fe=-1,ct=ge.length,tn=se(re-we,0),Vt=Array(ct+tn),Tn=!Ce;++Fe<ct;)Vt[Fe]=ge[Fe];for(;++$e<we;)(Tn||$e<re)&&(Vt[he[$e]]=ke[$e]);for(;tn--;)Vt[Fe++]=ke[$e++];return Vt}function Te(ke,ge,he,Ce){for(var $e=-1,re=ke.length,we=-1,Fe=he.length,ct=-1,tn=ge.length,Vt=se(re-Fe,0),Tn=Array(Vt+tn),qt=!Ce;++$e<Vt;)Tn[$e]=ke[$e];for(var En=$e;++ct<tn;)Tn[En+ct]=ge[ct];for(;++we<Fe;)(qt||$e<re)&&(Tn[En+he[we]]=ke[$e++]);return Tn}function Le(ke){return function(){var ge=arguments;switch(ge.length){case 0:return new ke;case 1:return new ke(ge[0]);case 2:return new ke(ge[0],ge[1]);case 3:return new ke(ge[0],ge[1],ge[2]);case 4:return new ke(ge[0],ge[1],ge[2],ge[3]);case 5:return new ke(ge[0],ge[1],ge[2],ge[3],ge[4]);case 6:return new ke(ge[0],ge[1],ge[2],ge[3],ge[4],ge[5]);case 7:return new ke(ge[0],ge[1],ge[2],ge[3],ge[4],ge[5],ge[6])}var he=Ee(ke.prototype),Ce=ke.apply(he,ge);return Rr(Ce)?Ce:he}}function Xe(ke,ge,he,Ce,$e,re,we,Fe,ct,tn){var Vt=128&ge,Tn=1&ge,qt=2&ge,En=24&ge,kn=512&ge,Yn=qt?void 0:Le(ke);return function Mn(){for(var mn=arguments.length,At=Array(mn),On=mn;On--;)At[On]=arguments[On];if(En)var ur=Dt(Mn),is=N(At,ur);if(Ce&&(At=Be(At,Ce,$e,En)),re&&(At=Te(At,re,we,En)),mn-=is,En&&mn<tn){var Vr=z(At,ur);return pt(ke,ge,Xe,Mn.placeholder,he,At,Vr,Fe,ct,tn-mn)}var er=Tn?he:this,Cs=qt?er[ke]:ke;return mn=At.length,Fe?At=br(At,Fe):kn&&mn>1&&At.reverse(),Vt&&ct<mn&&(At.length=ct),this&&this!==w&&this instanceof Mn&&(Cs=Yn||Le(Cs)),Cs.apply(er,At)}}function pt(ke,ge,he,Ce,$e,re,we,Fe,ct,tn){var Vt=8&ge;ge|=Vt?32:64,4&(ge&=~(Vt?64:32))||(ge&=-4);var Tn=he(ke,ge,$e,Vt?re:void 0,Vt?we:void 0,Vt?void 0:re,Vt?void 0:we,Fe,ct,tn);return Tn.placeholder=Ce,Qn(Tn,ke,ge)}function gn(ke,ge,he,Ce,$e,re,we,Fe){var ct=2&ge;if(!ct&&typeof ke!="function")throw new TypeError("Expected a function");var tn=Ce?Ce.length:0;if(tn||(ge&=-97,Ce=$e=void 0),we=we===void 0?we:se(Zs(we),0),Fe=Fe===void 0?Fe:Zs(Fe),tn-=$e?$e.length:0,64&ge){var Vt=Ce,Tn=$e;Ce=$e=void 0}var qt=[ke,ge,he,Ce,$e,Vt,Tn,re,we,Fe];if(ke=qt[0],ge=qt[1],he=qt[2],Ce=qt[3],$e=qt[4],!(Fe=qt[9]=qt[9]==null?ct?0:ke.length:se(qt[9]-tn,0))&&24&ge&&(ge&=-25),ge&&ge!=1)En=ge==8||ge==16?function(kn,Yn,Mn){var mn=Le(kn);return function At(){for(var On=arguments.length,ur=Array(On),is=On,Vr=Dt(At);is--;)ur[is]=arguments[is];var er=On<3&&ur[0]!==Vr&&ur[On-1]!==Vr?[]:z(ur,Vr);if((On-=er.length)<Mn)return pt(kn,Yn,Xe,At.placeholder,void 0,ur,er,void 0,void 0,Mn-On);var Cs=this&&this!==w&&this instanceof At?mn:kn;return M(Cs,this,ur)}}(ke,ge,Fe):ge!=32&&ge!=33||$e.length?Xe.apply(void 0,qt):function(kn,Yn,Mn,mn){var At=1&Yn,On=Le(kn);return function ur(){for(var is=-1,Vr=arguments.length,er=-1,Cs=mn.length,go=Array(Cs+Vr),Hi=this&&this!==w&&this instanceof ur?On:kn;++er<Cs;)go[er]=mn[er];for(;Vr--;)go[er++]=arguments[++is];return M(Hi,At?Mn:this,go)}}(ke,ge,he,Ce);else var En=function(kn,Yn,Mn){var mn=1&Yn,At=Le(kn);return function On(){var ur=this&&this!==w&&this instanceof On?At:kn;return ur.apply(mn?Mn:this,arguments)}}(ke,ge,he);return Qn(En,ke,ge)}function Dt(ke){return ke.placeholder}function sn(ke,ge){var he=function(Ce,$e){return Ce==null?void 0:Ce[$e]}(ke,ge);return Ue(he)?he:void 0}function Kt(ke){var ge=ke.match(u);return ge?ge[1].split(p):[]}function Nt(ke,ge){var he=ge.length,Ce=he-1;return ge[Ce]=(he>1?"& ":"")+ge[Ce],ge=ge.join(he>2?", ":" "),ke.replace(c,`{
/* [wrapped with `+ge+`] */
`)}function vr(ke,ge){return!!(ge=ge??9007199254740991)&&(typeof ke=="number"||S.test(ke))&&ke>-1&&ke%1==0&&ke<ge}function br(ke,ge){for(var he=ke.length,Ce=xe(ge.length,he),$e=function(we,Fe){var ct=-1,tn=we.length;for(Fe||(Fe=Array(tn));++ct<tn;)Fe[ct]=we[ct];return Fe}(ke);Ce--;){var re=ge[Ce];ke[Ce]=vr(re,he)?$e[re]:void 0}return ke}var Qn=Oe?function(ke,ge,he){var Ce,$e=ge+"";return Oe(ke,"toString",{configurable:!0,enumerable:!1,value:(Ce=Nt($e,Sr(Kt($e),he)),function(){return Ce})})}:function(ke){return ke};function Sr(ke,ge){return function(he,Ce){for(var $e=-1,re=he?he.length:0;++$e<re&&Ce(he[$e],$e,he)!==!1;);}(a,function(he){var Ce="_."+he[0];ge&he[1]&&!R(ke,Ce)&&ke.push(Ce)}),ke.sort()}function dr(ke,ge,he){var Ce=gn(ke,8,void 0,void 0,void 0,void 0,void 0,ge=he?void 0:ge);return Ce.placeholder=dr.placeholder,Ce}function Rr(ke){var ge=typeof ke;return!!ke&&(ge=="object"||ge=="function")}function qn(ke){return ke?(ke=function(ge){if(typeof ge=="number")return ge;if(function($e){return typeof $e=="symbol"||function(re){return!!re&&typeof re=="object"}($e)&&ne.call($e)=="[object Symbol]"}(ge))return NaN;if(Rr(ge)){var he=typeof ge.valueOf=="function"?ge.valueOf():ge;ge=Rr(he)?he+"":he}if(typeof ge!="string")return ge===0?ge:+ge;ge=ge.replace(l,"");var Ce=m.test(ge);return Ce||b.test(ge)?C(ge.slice(2),Ce?2:8):f.test(ge)?NaN:+ge}(ke))===1/0||ke===-1/0?17976931348623157e292*(ke<0?-1:1):ke==ke?ke:0:ke===0?ke:0}function Zs(ke){var ge=qn(ke),he=ge%1;return ge==ge?he?ge-he:ge:0}dr.placeholder={},n.exports=dr}).call(this,o(43))},function(n,s,o){function i(Te){return Te&&Te.__esModule?Te.default:Te}s.__esModule=!0;var a=o(95);s.threezerotwofour=i(a);var l=o(96);s.apathy=i(l);var c=o(97);s.ashes=i(c);var u=o(98);s.atelierDune=i(u);var p=o(99);s.atelierForest=i(p);var f=o(100);s.atelierHeath=i(f);var m=o(101);s.atelierLakeside=i(m);var v=o(102);s.atelierSeaside=i(v);var b=o(103);s.bespin=i(b);var S=o(104);s.brewer=i(S);var C=o(105);s.bright=i(C);var E=o(106);s.chalk=i(E);var T=o(107);s.codeschool=i(T);var w=o(108);s.colors=i(w);var M=o(109);s.default=i(M);var R=o(110);s.eighties=i(R);var D=o(111);s.embers=i(D);var N=o(112);s.flat=i(N);var z=o(113);s.google=i(z);var L=o(114);s.grayscale=i(L);var B=o(115);s.greenscreen=i(B);var K=o(116);s.harmonic=i(K);var O=o(117);s.hopscotch=i(O);var U=o(118);s.isotope=i(U);var X=o(119);s.marrakesh=i(X);var H=o(120);s.mocha=i(H);var ee=o(121);s.monokai=i(ee);var J=o(122);s.ocean=i(J);var ne=o(123);s.paraiso=i(ne);var ae=o(124);s.pop=i(ae);var q=o(125);s.railscasts=i(q);var se=o(126);s.shapeshifter=i(se);var xe=o(127);s.solarized=i(xe);var Oe=o(128);s.summerfruit=i(Oe);var Ee=o(129);s.tomorrow=i(Ee);var Ue=o(130);s.tube=i(Ue);var Be=o(131);s.twilight=i(Be)},function(n,s,o){s.__esModule=!0,s.default={scheme:"threezerotwofour",author:"jan t. sott (http://github.com/idleberg)",base00:"#090300",base01:"#3a3432",base02:"#4a4543",base03:"#5c5855",base04:"#807d7c",base05:"#a5a2a2",base06:"#d6d5d4",base07:"#f7f7f7",base08:"#db2d20",base09:"#e8bbd0",base0A:"#fded02",base0B:"#01a252",base0C:"#b5e4f4",base0D:"#01a0e4",base0E:"#a16a94",base0F:"#cdab53"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"apathy",author:"jannik siebert (https://github.com/janniks)",base00:"#031A16",base01:"#0B342D",base02:"#184E45",base03:"#2B685E",base04:"#5F9C92",base05:"#81B5AC",base06:"#A7CEC8",base07:"#D2E7E4",base08:"#3E9688",base09:"#3E7996",base0A:"#3E4C96",base0B:"#883E96",base0C:"#963E4C",base0D:"#96883E",base0E:"#4C963E",base0F:"#3E965B"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"ashes",author:"jannik siebert (https://github.com/janniks)",base00:"#1C2023",base01:"#393F45",base02:"#565E65",base03:"#747C84",base04:"#ADB3BA",base05:"#C7CCD1",base06:"#DFE2E5",base07:"#F3F4F5",base08:"#C7AE95",base09:"#C7C795",base0A:"#AEC795",base0B:"#95C7AE",base0C:"#95AEC7",base0D:"#AE95C7",base0E:"#C795AE",base0F:"#C79595"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"atelier dune",author:"bram de haan (http://atelierbram.github.io/syntax-highlighting/atelier-schemes/dune)",base00:"#20201d",base01:"#292824",base02:"#6e6b5e",base03:"#7d7a68",base04:"#999580",base05:"#a6a28c",base06:"#e8e4cf",base07:"#fefbec",base08:"#d73737",base09:"#b65611",base0A:"#cfb017",base0B:"#60ac39",base0C:"#1fad83",base0D:"#6684e1",base0E:"#b854d4",base0F:"#d43552"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"atelier forest",author:"bram de haan (http://atelierbram.github.io/syntax-highlighting/atelier-schemes/forest)",base00:"#1b1918",base01:"#2c2421",base02:"#68615e",base03:"#766e6b",base04:"#9c9491",base05:"#a8a19f",base06:"#e6e2e0",base07:"#f1efee",base08:"#f22c40",base09:"#df5320",base0A:"#d5911a",base0B:"#5ab738",base0C:"#00ad9c",base0D:"#407ee7",base0E:"#6666ea",base0F:"#c33ff3"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"atelier heath",author:"bram de haan (http://atelierbram.github.io/syntax-highlighting/atelier-schemes/heath)",base00:"#1b181b",base01:"#292329",base02:"#695d69",base03:"#776977",base04:"#9e8f9e",base05:"#ab9bab",base06:"#d8cad8",base07:"#f7f3f7",base08:"#ca402b",base09:"#a65926",base0A:"#bb8a35",base0B:"#379a37",base0C:"#159393",base0D:"#516aec",base0E:"#7b59c0",base0F:"#cc33cc"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"atelier lakeside",author:"bram de haan (http://atelierbram.github.io/syntax-highlighting/atelier-schemes/lakeside/)",base00:"#161b1d",base01:"#1f292e",base02:"#516d7b",base03:"#5a7b8c",base04:"#7195a8",base05:"#7ea2b4",base06:"#c1e4f6",base07:"#ebf8ff",base08:"#d22d72",base09:"#935c25",base0A:"#8a8a0f",base0B:"#568c3b",base0C:"#2d8f6f",base0D:"#257fad",base0E:"#5d5db1",base0F:"#b72dd2"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"atelier seaside",author:"bram de haan (http://atelierbram.github.io/syntax-highlighting/atelier-schemes/seaside/)",base00:"#131513",base01:"#242924",base02:"#5e6e5e",base03:"#687d68",base04:"#809980",base05:"#8ca68c",base06:"#cfe8cf",base07:"#f0fff0",base08:"#e6193c",base09:"#87711d",base0A:"#c3c322",base0B:"#29a329",base0C:"#1999b3",base0D:"#3d62f5",base0E:"#ad2bee",base0F:"#e619c3"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"bespin",author:"jan t. sott",base00:"#28211c",base01:"#36312e",base02:"#5e5d5c",base03:"#666666",base04:"#797977",base05:"#8a8986",base06:"#9d9b97",base07:"#baae9e",base08:"#cf6a4c",base09:"#cf7d34",base0A:"#f9ee98",base0B:"#54be0d",base0C:"#afc4db",base0D:"#5ea6ea",base0E:"#9b859d",base0F:"#937121"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"brewer",author:"timothée poisot (http://github.com/tpoisot)",base00:"#0c0d0e",base01:"#2e2f30",base02:"#515253",base03:"#737475",base04:"#959697",base05:"#b7b8b9",base06:"#dadbdc",base07:"#fcfdfe",base08:"#e31a1c",base09:"#e6550d",base0A:"#dca060",base0B:"#31a354",base0C:"#80b1d3",base0D:"#3182bd",base0E:"#756bb1",base0F:"#b15928"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"bright",author:"chris kempson (http://chriskempson.com)",base00:"#000000",base01:"#303030",base02:"#505050",base03:"#b0b0b0",base04:"#d0d0d0",base05:"#e0e0e0",base06:"#f5f5f5",base07:"#ffffff",base08:"#fb0120",base09:"#fc6d24",base0A:"#fda331",base0B:"#a1c659",base0C:"#76c7b7",base0D:"#6fb3d2",base0E:"#d381c3",base0F:"#be643c"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"chalk",author:"chris kempson (http://chriskempson.com)",base00:"#151515",base01:"#202020",base02:"#303030",base03:"#505050",base04:"#b0b0b0",base05:"#d0d0d0",base06:"#e0e0e0",base07:"#f5f5f5",base08:"#fb9fb1",base09:"#eda987",base0A:"#ddb26f",base0B:"#acc267",base0C:"#12cfc0",base0D:"#6fc2ef",base0E:"#e1a3ee",base0F:"#deaf8f"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"codeschool",author:"brettof86",base00:"#232c31",base01:"#1c3657",base02:"#2a343a",base03:"#3f4944",base04:"#84898c",base05:"#9ea7a6",base06:"#a7cfa3",base07:"#b5d8f6",base08:"#2a5491",base09:"#43820d",base0A:"#a03b1e",base0B:"#237986",base0C:"#b02f30",base0D:"#484d79",base0E:"#c59820",base0F:"#c98344"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"colors",author:"mrmrs (http://clrs.cc)",base00:"#111111",base01:"#333333",base02:"#555555",base03:"#777777",base04:"#999999",base05:"#bbbbbb",base06:"#dddddd",base07:"#ffffff",base08:"#ff4136",base09:"#ff851b",base0A:"#ffdc00",base0B:"#2ecc40",base0C:"#7fdbff",base0D:"#0074d9",base0E:"#b10dc9",base0F:"#85144b"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"default",author:"chris kempson (http://chriskempson.com)",base00:"#181818",base01:"#282828",base02:"#383838",base03:"#585858",base04:"#b8b8b8",base05:"#d8d8d8",base06:"#e8e8e8",base07:"#f8f8f8",base08:"#ab4642",base09:"#dc9656",base0A:"#f7ca88",base0B:"#a1b56c",base0C:"#86c1b9",base0D:"#7cafc2",base0E:"#ba8baf",base0F:"#a16946"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"eighties",author:"chris kempson (http://chriskempson.com)",base00:"#2d2d2d",base01:"#393939",base02:"#515151",base03:"#747369",base04:"#a09f93",base05:"#d3d0c8",base06:"#e8e6df",base07:"#f2f0ec",base08:"#f2777a",base09:"#f99157",base0A:"#ffcc66",base0B:"#99cc99",base0C:"#66cccc",base0D:"#6699cc",base0E:"#cc99cc",base0F:"#d27b53"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"embers",author:"jannik siebert (https://github.com/janniks)",base00:"#16130F",base01:"#2C2620",base02:"#433B32",base03:"#5A5047",base04:"#8A8075",base05:"#A39A90",base06:"#BEB6AE",base07:"#DBD6D1",base08:"#826D57",base09:"#828257",base0A:"#6D8257",base0B:"#57826D",base0C:"#576D82",base0D:"#6D5782",base0E:"#82576D",base0F:"#825757"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"flat",author:"chris kempson (http://chriskempson.com)",base00:"#2C3E50",base01:"#34495E",base02:"#7F8C8D",base03:"#95A5A6",base04:"#BDC3C7",base05:"#e0e0e0",base06:"#f5f5f5",base07:"#ECF0F1",base08:"#E74C3C",base09:"#E67E22",base0A:"#F1C40F",base0B:"#2ECC71",base0C:"#1ABC9C",base0D:"#3498DB",base0E:"#9B59B6",base0F:"#be643c"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"google",author:"seth wright (http://sethawright.com)",base00:"#1d1f21",base01:"#282a2e",base02:"#373b41",base03:"#969896",base04:"#b4b7b4",base05:"#c5c8c6",base06:"#e0e0e0",base07:"#ffffff",base08:"#CC342B",base09:"#F96A38",base0A:"#FBA922",base0B:"#198844",base0C:"#3971ED",base0D:"#3971ED",base0E:"#A36AC7",base0F:"#3971ED"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"grayscale",author:"alexandre gavioli (https://github.com/alexx2/)",base00:"#101010",base01:"#252525",base02:"#464646",base03:"#525252",base04:"#ababab",base05:"#b9b9b9",base06:"#e3e3e3",base07:"#f7f7f7",base08:"#7c7c7c",base09:"#999999",base0A:"#a0a0a0",base0B:"#8e8e8e",base0C:"#868686",base0D:"#686868",base0E:"#747474",base0F:"#5e5e5e"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"green screen",author:"chris kempson (http://chriskempson.com)",base00:"#001100",base01:"#003300",base02:"#005500",base03:"#007700",base04:"#009900",base05:"#00bb00",base06:"#00dd00",base07:"#00ff00",base08:"#007700",base09:"#009900",base0A:"#007700",base0B:"#00bb00",base0C:"#005500",base0D:"#009900",base0E:"#00bb00",base0F:"#005500"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"harmonic16",author:"jannik siebert (https://github.com/janniks)",base00:"#0b1c2c",base01:"#223b54",base02:"#405c79",base03:"#627e99",base04:"#aabcce",base05:"#cbd6e2",base06:"#e5ebf1",base07:"#f7f9fb",base08:"#bf8b56",base09:"#bfbf56",base0A:"#8bbf56",base0B:"#56bf8b",base0C:"#568bbf",base0D:"#8b56bf",base0E:"#bf568b",base0F:"#bf5656"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"hopscotch",author:"jan t. sott",base00:"#322931",base01:"#433b42",base02:"#5c545b",base03:"#797379",base04:"#989498",base05:"#b9b5b8",base06:"#d5d3d5",base07:"#ffffff",base08:"#dd464c",base09:"#fd8b19",base0A:"#fdcc59",base0B:"#8fc13e",base0C:"#149b93",base0D:"#1290bf",base0E:"#c85e7c",base0F:"#b33508"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"isotope",author:"jan t. sott",base00:"#000000",base01:"#404040",base02:"#606060",base03:"#808080",base04:"#c0c0c0",base05:"#d0d0d0",base06:"#e0e0e0",base07:"#ffffff",base08:"#ff0000",base09:"#ff9900",base0A:"#ff0099",base0B:"#33ff00",base0C:"#00ffff",base0D:"#0066ff",base0E:"#cc00ff",base0F:"#3300ff"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"marrakesh",author:"alexandre gavioli (http://github.com/alexx2/)",base00:"#201602",base01:"#302e00",base02:"#5f5b17",base03:"#6c6823",base04:"#86813b",base05:"#948e48",base06:"#ccc37a",base07:"#faf0a5",base08:"#c35359",base09:"#b36144",base0A:"#a88339",base0B:"#18974e",base0C:"#75a738",base0D:"#477ca1",base0E:"#8868b3",base0F:"#b3588e"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"mocha",author:"chris kempson (http://chriskempson.com)",base00:"#3B3228",base01:"#534636",base02:"#645240",base03:"#7e705a",base04:"#b8afad",base05:"#d0c8c6",base06:"#e9e1dd",base07:"#f5eeeb",base08:"#cb6077",base09:"#d28b71",base0A:"#f4bc87",base0B:"#beb55b",base0C:"#7bbda4",base0D:"#8ab3b5",base0E:"#a89bb9",base0F:"#bb9584"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"monokai",author:"wimer hazenberg (http://www.monokai.nl)",base00:"#272822",base01:"#383830",base02:"#49483e",base03:"#75715e",base04:"#a59f85",base05:"#f8f8f2",base06:"#f5f4f1",base07:"#f9f8f5",base08:"#f92672",base09:"#fd971f",base0A:"#f4bf75",base0B:"#a6e22e",base0C:"#a1efe4",base0D:"#66d9ef",base0E:"#ae81ff",base0F:"#cc6633"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"ocean",author:"chris kempson (http://chriskempson.com)",base00:"#2b303b",base01:"#343d46",base02:"#4f5b66",base03:"#65737e",base04:"#a7adba",base05:"#c0c5ce",base06:"#dfe1e8",base07:"#eff1f5",base08:"#bf616a",base09:"#d08770",base0A:"#ebcb8b",base0B:"#a3be8c",base0C:"#96b5b4",base0D:"#8fa1b3",base0E:"#b48ead",base0F:"#ab7967"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"paraiso",author:"jan t. sott",base00:"#2f1e2e",base01:"#41323f",base02:"#4f424c",base03:"#776e71",base04:"#8d8687",base05:"#a39e9b",base06:"#b9b6b0",base07:"#e7e9db",base08:"#ef6155",base09:"#f99b15",base0A:"#fec418",base0B:"#48b685",base0C:"#5bc4bf",base0D:"#06b6ef",base0E:"#815ba4",base0F:"#e96ba8"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"pop",author:"chris kempson (http://chriskempson.com)",base00:"#000000",base01:"#202020",base02:"#303030",base03:"#505050",base04:"#b0b0b0",base05:"#d0d0d0",base06:"#e0e0e0",base07:"#ffffff",base08:"#eb008a",base09:"#f29333",base0A:"#f8ca12",base0B:"#37b349",base0C:"#00aabb",base0D:"#0e5a94",base0E:"#b31e8d",base0F:"#7a2d00"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"railscasts",author:"ryan bates (http://railscasts.com)",base00:"#2b2b2b",base01:"#272935",base02:"#3a4055",base03:"#5a647e",base04:"#d4cfc9",base05:"#e6e1dc",base06:"#f4f1ed",base07:"#f9f7f3",base08:"#da4939",base09:"#cc7833",base0A:"#ffc66d",base0B:"#a5c261",base0C:"#519f50",base0D:"#6d9cbe",base0E:"#b6b3eb",base0F:"#bc9458"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"shapeshifter",author:"tyler benziger (http://tybenz.com)",base00:"#000000",base01:"#040404",base02:"#102015",base03:"#343434",base04:"#555555",base05:"#ababab",base06:"#e0e0e0",base07:"#f9f9f9",base08:"#e92f2f",base09:"#e09448",base0A:"#dddd13",base0B:"#0ed839",base0C:"#23edda",base0D:"#3b48e3",base0E:"#f996e2",base0F:"#69542d"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"solarized",author:"ethan schoonover (http://ethanschoonover.com/solarized)",base00:"#002b36",base01:"#073642",base02:"#586e75",base03:"#657b83",base04:"#839496",base05:"#93a1a1",base06:"#eee8d5",base07:"#fdf6e3",base08:"#dc322f",base09:"#cb4b16",base0A:"#b58900",base0B:"#859900",base0C:"#2aa198",base0D:"#268bd2",base0E:"#6c71c4",base0F:"#d33682"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"summerfruit",author:"christopher corley (http://cscorley.github.io/)",base00:"#151515",base01:"#202020",base02:"#303030",base03:"#505050",base04:"#B0B0B0",base05:"#D0D0D0",base06:"#E0E0E0",base07:"#FFFFFF",base08:"#FF0086",base09:"#FD8900",base0A:"#ABA800",base0B:"#00C918",base0C:"#1faaaa",base0D:"#3777E6",base0E:"#AD00A1",base0F:"#cc6633"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"tomorrow",author:"chris kempson (http://chriskempson.com)",base00:"#1d1f21",base01:"#282a2e",base02:"#373b41",base03:"#969896",base04:"#b4b7b4",base05:"#c5c8c6",base06:"#e0e0e0",base07:"#ffffff",base08:"#cc6666",base09:"#de935f",base0A:"#f0c674",base0B:"#b5bd68",base0C:"#8abeb7",base0D:"#81a2be",base0E:"#b294bb",base0F:"#a3685a"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"london tube",author:"jan t. sott",base00:"#231f20",base01:"#1c3f95",base02:"#5a5758",base03:"#737171",base04:"#959ca1",base05:"#d9d8d8",base06:"#e7e7e8",base07:"#ffffff",base08:"#ee2e24",base09:"#f386a1",base0A:"#ffd204",base0B:"#00853e",base0C:"#85cebc",base0D:"#009ddc",base0E:"#98005d",base0F:"#b06110"},n.exports=s.default},function(n,s,o){s.__esModule=!0,s.default={scheme:"twilight",author:"david hart (http://hart-dev.com)",base00:"#1e1e1e",base01:"#323537",base02:"#464b50",base03:"#5f5a60",base04:"#838184",base05:"#a7a7a7",base06:"#c3c3c3",base07:"#ffffff",base08:"#cf6a4c",base09:"#cda869",base0A:"#f9ee98",base0B:"#8f9d6a",base0C:"#afc4db",base0D:"#7587a6",base0E:"#9b859d",base0F:"#9b703f"},n.exports=s.default},function(n,s,o){var i=o(33);function a(l){var c=Math.round(i(l,0,255)).toString(16);return c.length==1?"0"+c:c}n.exports=function(l){var c=l.length===4?a(255*l[3]):"";return"#"+a(l[0])+a(l[1])+a(l[2])+c}},function(n,s,o){var i=o(134),a=o(135),l=o(136),c=o(137),u={"#":a,hsl:function(f){var m=i(f),v=c(m);return m.length===4&&v.push(m[3]),v},rgb:l};function p(f){for(var m in u)if(f.indexOf(m)===0)return u[m](f)}p.rgb=l,p.hsl=i,p.hex=a,n.exports=p},function(n,s,o){var i=o(44),a=o(33);function l(c,u){switch(c=parseFloat(c),u){case 0:return a(c,0,360);case 1:case 2:return a(c,0,100);case 3:return a(c,0,1)}}n.exports=function(c){return i(c).map(l)}},function(n,s){n.exports=function(o){o.length!==4&&o.length!==5||(o=function(l){for(var c="#",u=1;u<l.length;u++){var p=l.charAt(u);c+=p+p}return c}(o));var i=[parseInt(o.substring(1,3),16),parseInt(o.substring(3,5),16),parseInt(o.substring(5,7),16)];if(o.length===9){var a=parseFloat((parseInt(o.substring(7,9),16)/255).toFixed(2));i.push(a)}return i}},function(n,s,o){var i=o(44),a=o(33);function l(c,u){return u<3?c.indexOf("%")!=-1?Math.round(255*a(parseInt(c,10),0,100)/100):a(parseInt(c,10),0,255):a(parseFloat(c),0,1)}n.exports=function(c){return i(c).map(l)}},function(n,s){n.exports=function(o){var i,a,l,c,u,p=o[0]/360,f=o[1]/100,m=o[2]/100;if(f==0)return[u=255*m,u,u];i=2*m-(a=m<.5?m*(1+f):m+f-m*f),c=[0,0,0];for(var v=0;v<3;v++)(l=p+1/3*-(v-1))<0&&l++,l>1&&l--,u=6*l<1?i+6*(a-i)*l:2*l<1?a:3*l<2?i+(a-i)*(2/3-l)*6:i,c[v]=255*u;return c}},function(n,s,o){(function(i){var a=typeof i=="object"&&i&&i.Object===Object&&i,l=typeof self=="object"&&self&&self.Object===Object&&self,c=a||l||Function("return this")();function u(z,L,B){switch(B.length){case 0:return z.call(L);case 1:return z.call(L,B[0]);case 2:return z.call(L,B[0],B[1]);case 3:return z.call(L,B[0],B[1],B[2])}return z.apply(L,B)}function p(z,L){for(var B=-1,K=L.length,O=z.length;++B<K;)z[O+B]=L[B];return z}var f=Object.prototype,m=f.hasOwnProperty,v=f.toString,b=c.Symbol,S=f.propertyIsEnumerable,C=b?b.isConcatSpreadable:void 0,E=Math.max;function T(z){return w(z)||function(L){return function(B){return function(K){return!!K&&typeof K=="object"}(B)&&function(K){return K!=null&&function(O){return typeof O=="number"&&O>-1&&O%1==0&&O<=9007199254740991}(K.length)&&!function(O){var U=function(X){var H=typeof X;return!!X&&(H=="object"||H=="function")}(O)?v.call(O):"";return U=="[object Function]"||U=="[object GeneratorFunction]"}(K)}(B)}(L)&&m.call(L,"callee")&&(!S.call(L,"callee")||v.call(L)=="[object Arguments]")}(z)||!!(C&&z&&z[C])}var w=Array.isArray,M,R,D,N=(R=function(z){var L=(z=function(O,U,X,H,ee){var J=-1,ne=O.length;for(X||(X=T),ee||(ee=[]);++J<ne;){var ae=O[J];X(ae)?p(ee,ae):ee[ee.length]=ae}return ee}(z)).length,B=L;for(M;B--;)if(typeof z[B]!="function")throw new TypeError("Expected a function");return function(){for(var K=0,O=L?z[K].apply(this,arguments):arguments[0];++K<L;)O=z[K].call(this,O);return O}},D=E(D===void 0?R.length-1:D,0),function(){for(var z=arguments,L=-1,B=E(z.length-D,0),K=Array(B);++L<B;)K[L]=z[D+L];L=-1;for(var O=Array(D+1);++L<D;)O[L]=z[L];return O[D]=K,u(R,this,O)});n.exports=N}).call(this,o(43))},function(n,s,o){Object.defineProperty(s,"__esModule",{value:!0}),s.yuv2rgb=function(i){var a,l,c,u=i[0],p=i[1],f=i[2];return a=1*u+0*p+1.13983*f,l=1*u+-.39465*p+-.5806*f,c=1*u+2.02311*p+0*f,a=Math.min(Math.max(0,a),1),l=Math.min(Math.max(0,l),1),c=Math.min(Math.max(0,c),1),[255*a,255*l,255*c]},s.rgb2yuv=function(i){var a=i[0]/255,l=i[1]/255,c=i[2]/255;return[.299*a+.587*l+.114*c,-.14713*a+-.28886*l+.436*c,.615*a+-.51499*l+-.10001*c]}},function(n,s,o){function i(c,u,p){return u in c?Object.defineProperty(c,u,{value:p,enumerable:!0,configurable:!0,writable:!0}):c[u]=p,c}var a=o(141),l=function(){function c(){i(this,"_callbacks",void 0),i(this,"_isDispatching",void 0),i(this,"_isHandled",void 0),i(this,"_isPending",void 0),i(this,"_lastID",void 0),i(this,"_pendingPayload",void 0),this._callbacks={},this._isDispatching=!1,this._isHandled={},this._isPending={},this._lastID=1}var u=c.prototype;return u.register=function(p){var f="ID_"+this._lastID++;return this._callbacks[f]=p,f},u.unregister=function(p){this._callbacks[p]||a(!1),delete this._callbacks[p]},u.waitFor=function(p){this._isDispatching||a(!1);for(var f=0;f<p.length;f++){var m=p[f];this._isPending[m]?this._isHandled[m]||a(!1):(this._callbacks[m]||a(!1),this._invokeCallback(m))}},u.dispatch=function(p){this._isDispatching&&a(!1),this._startDispatching(p);try{for(var f in this._callbacks)this._isPending[f]||this._invokeCallback(f)}finally{this._stopDispatching()}},u.isDispatching=function(){return this._isDispatching},u._invokeCallback=function(p){this._isPending[p]=!0,this._callbacks[p](this._pendingPayload),this._isHandled[p]=!0},u._startDispatching=function(p){for(var f in this._callbacks)this._isPending[f]=!1,this._isHandled[f]=!1;this._pendingPayload=p,this._isDispatching=!0},u._stopDispatching=function(){delete this._pendingPayload,this._isDispatching=!1},c}();n.exports=l},function(n,s,o){n.exports=function(i,a){for(var l=arguments.length,c=new Array(l>2?l-2:0),u=2;u<l;u++)c[u-2]=arguments[u];if(!i){var p;if(a===void 0)p=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var f=0;(p=new Error(a.replace(/%s/g,function(){return String(c[f++])}))).name="Invariant Violation"}throw p.framesToPop=1,p}}},function(n,s,o){function i(Y,Z,$){return Z in Y?Object.defineProperty(Y,Z,{value:$,enumerable:!0,configurable:!0,writable:!0}):Y[Z]=$,Y}function a(Y,Z){var $=Object.keys(Y);if(Object.getOwnPropertySymbols){var G=Object.getOwnPropertySymbols(Y);Z&&(G=G.filter(function(W){return Object.getOwnPropertyDescriptor(Y,W).enumerable})),$.push.apply($,G)}return $}function l(Y){for(var Z=1;Z<arguments.length;Z++){var $=arguments[Z]!=null?arguments[Z]:{};Z%2?a(Object($),!0).forEach(function(G){i(Y,G,$[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Y,Object.getOwnPropertyDescriptors($)):a(Object($)).forEach(function(G){Object.defineProperty(Y,G,Object.getOwnPropertyDescriptor($,G))})}return Y}function c(Y,Z){if(!(Y instanceof Z))throw new TypeError("Cannot call a class as a function")}function u(Y,Z){for(var $=0;$<Z.length;$++){var G=Z[$];G.enumerable=G.enumerable||!1,G.configurable=!0,"value"in G&&(G.writable=!0),Object.defineProperty(Y,G.key,G)}}function p(Y,Z,$){return Z&&u(Y.prototype,Z),$&&u(Y,$),Y}function f(Y,Z){return(f=Object.setPrototypeOf||function($,G){return $.__proto__=G,$})(Y,Z)}function m(Y,Z){if(typeof Z!="function"&&Z!==null)throw new TypeError("Super expression must either be null or a function");Y.prototype=Object.create(Z&&Z.prototype,{constructor:{value:Y,writable:!0,configurable:!0}}),Z&&f(Y,Z)}function v(Y){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(Z){return Z.__proto__||Object.getPrototypeOf(Z)})(Y)}function b(Y){return(b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Z){return typeof Z}:function(Z){return Z&&typeof Symbol=="function"&&Z.constructor===Symbol&&Z!==Symbol.prototype?"symbol":typeof Z})(Y)}function S(Y){if(Y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Y}function C(Y,Z){return!Z||b(Z)!=="object"&&typeof Z!="function"?S(Y):Z}function E(Y){var Z=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}();return function(){var $,G=v(Y);if(Z){var W=v(this).constructor;$=Reflect.construct(G,arguments,W)}else $=G.apply(this,arguments);return C(this,$)}}o.r(s);var T=o(0),w=o.n(T);function M(){var Y=this.constructor.getDerivedStateFromProps(this.props,this.state);Y!=null&&this.setState(Y)}function R(Y){this.setState((function(Z){var $=this.constructor.getDerivedStateFromProps(Y,Z);return $??null}).bind(this))}function D(Y,Z){try{var $=this.props,G=this.state;this.props=Y,this.state=Z,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate($,G)}finally{this.props=$,this.state=G}}function N(Y){var Z=Y.prototype;if(!Z||!Z.isReactComponent)throw new Error("Can only polyfill class components");if(typeof Y.getDerivedStateFromProps!="function"&&typeof Z.getSnapshotBeforeUpdate!="function")return Y;var $=null,G=null,W=null;if(typeof Z.componentWillMount=="function"?$="componentWillMount":typeof Z.UNSAFE_componentWillMount=="function"&&($="UNSAFE_componentWillMount"),typeof Z.componentWillReceiveProps=="function"?G="componentWillReceiveProps":typeof Z.UNSAFE_componentWillReceiveProps=="function"&&(G="UNSAFE_componentWillReceiveProps"),typeof Z.componentWillUpdate=="function"?W="componentWillUpdate":typeof Z.UNSAFE_componentWillUpdate=="function"&&(W="UNSAFE_componentWillUpdate"),$!==null||G!==null||W!==null){var de=Y.displayName||Y.name,Se=typeof Y.getDerivedStateFromProps=="function"?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error(`Unsafe legacy lifecycles will not be called for components using new component APIs.

`+de+" uses "+Se+" but also contains the following legacy lifecycles:"+($!==null?`
  `+$:"")+(G!==null?`
  `+G:"")+(W!==null?`
  `+W:"")+`

The above lifecycles should be removed. Learn more about this warning here:
https://fb.me/react-async-component-lifecycle-hooks`)}if(typeof Y.getDerivedStateFromProps=="function"&&(Z.componentWillMount=M,Z.componentWillReceiveProps=R),typeof Z.getSnapshotBeforeUpdate=="function"){if(typeof Z.componentDidUpdate!="function")throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");Z.componentWillUpdate=D;var be=Z.componentDidUpdate;Z.componentDidUpdate=function(ce,_e,et){var jt=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:et;be.call(this,ce,_e,jt)}}return Y}function z(Y,Z){if(Y==null)return{};var $,G,W=function(Se,be){if(Se==null)return{};var ce,_e,et={},jt=Object.keys(Se);for(_e=0;_e<jt.length;_e++)ce=jt[_e],be.indexOf(ce)>=0||(et[ce]=Se[ce]);return et}(Y,Z);if(Object.getOwnPropertySymbols){var de=Object.getOwnPropertySymbols(Y);for(G=0;G<de.length;G++)$=de[G],Z.indexOf($)>=0||Object.prototype.propertyIsEnumerable.call(Y,$)&&(W[$]=Y[$])}return W}function L(Y){var Z=function($){return{}.toString.call($).match(/\s([a-zA-Z]+)/)[1].toLowerCase()}(Y);return Z==="number"&&(Z=isNaN(Y)?"nan":(0|Y)!=Y?"float":"integer"),Z}M.__suppressDeprecationWarning=!0,R.__suppressDeprecationWarning=!0,D.__suppressDeprecationWarning=!0;var B={scheme:"rjv-default",author:"mac gainor",base00:"rgba(0, 0, 0, 0)",base01:"rgb(245, 245, 245)",base02:"rgb(235, 235, 235)",base03:"#93a1a1",base04:"rgba(0, 0, 0, 0.3)",base05:"#586e75",base06:"#073642",base07:"#002b36",base08:"#d33682",base09:"#cb4b16",base0A:"#dc322f",base0B:"#859900",base0C:"#6c71c4",base0D:"#586e75",base0E:"#2aa198",base0F:"#268bd2"},K={scheme:"rjv-grey",author:"mac gainor",base00:"rgba(1, 1, 1, 0)",base01:"rgba(1, 1, 1, 0.1)",base02:"rgba(0, 0, 0, 0.2)",base03:"rgba(1, 1, 1, 0.3)",base04:"rgba(0, 0, 0, 0.4)",base05:"rgba(1, 1, 1, 0.5)",base06:"rgba(1, 1, 1, 0.6)",base07:"rgba(1, 1, 1, 0.7)",base08:"rgba(1, 1, 1, 0.8)",base09:"rgba(1, 1, 1, 0.8)",base0A:"rgba(1, 1, 1, 0.8)",base0B:"rgba(1, 1, 1, 0.8)",base0C:"rgba(1, 1, 1, 0.8)",base0D:"rgba(1, 1, 1, 0.8)",base0E:"rgba(1, 1, 1, 0.8)",base0F:"rgba(1, 1, 1, 0.8)"},O={white:"#fff",black:"#000",transparent:"rgba(1, 1, 1, 0)",globalFontFamily:"monospace",globalCursor:"default",indentBlockWidth:"5px",braceFontWeight:"bold",braceCursor:"pointer",ellipsisFontSize:"18px",ellipsisLineHeight:"10px",ellipsisCursor:"pointer",keyMargin:"0px 5px",keyLetterSpacing:"0.5px",keyFontStyle:"none",keyBorderRadius:"3px",keyColonWeight:"bold",keyVerticalAlign:"top",keyOpacity:"0.85",keyOpacityHover:"1",keyValPaddingTop:"3px",keyValPaddingBottom:"3px",keyValPaddingRight:"5px",keyValBorderLeft:"1px solid",keyValBorderHover:"2px solid",keyValPaddingHover:"3px 5px 3px 4px",pushedContentMarginLeft:"6px",variableValuePaddingRight:"6px",nullFontSize:"11px",nullFontWeight:"bold",nullPadding:"1px 2px",nullBorderRadius:"3px",nanFontSize:"11px",nanFontWeight:"bold",nanPadding:"1px 2px",nanBorderRadius:"3px",undefinedFontSize:"11px",undefinedFontWeight:"bold",undefinedPadding:"1px 2px",undefinedBorderRadius:"3px",dataTypeFontSize:"11px",dataTypeMarginRight:"4px",datatypeOpacity:"0.8",objectSizeBorderRadius:"3px",objectSizeFontStyle:"italic",objectSizeMargin:"0px 6px 0px 0px",clipboardCursor:"pointer",clipboardCheckMarginLeft:"-12px",metaDataPadding:"0px 0px 0px 10px",arrayGroupMetaPadding:"0px 0px 0px 4px",iconContainerWidth:"17px",tooltipPadding:"4px",editInputMinWidth:"130px",editInputBorderRadius:"2px",editInputPadding:"5px",editInputMarginRight:"4px",editInputFontFamily:"monospace",iconCursor:"pointer",iconFontSize:"15px",iconPaddingRight:"1px",dateValueMarginLeft:"2px",iconMarginRight:"3px",detectedRowPaddingTop:"3px",addKeyCoverBackground:"rgba(255, 255, 255, 0.3)",addKeyCoverPosition:"absolute",addKeyCoverPositionPx:"0px",addKeyModalWidth:"200px",addKeyModalMargin:"auto",addKeyModalPadding:"10px",addKeyModalRadius:"3px"},U=o(45),X=function(Y){var Z=function($){return{backgroundColor:$.base00,ellipsisColor:$.base09,braceColor:$.base07,expandedIcon:$.base0D,collapsedIcon:$.base0E,keyColor:$.base07,arrayKeyColor:$.base0C,objectSize:$.base04,copyToClipboard:$.base0F,copyToClipboardCheck:$.base0D,objectBorder:$.base02,dataTypes:{boolean:$.base0E,date:$.base0D,float:$.base0B,function:$.base0D,integer:$.base0F,string:$.base09,nan:$.base08,null:$.base0A,undefined:$.base05,regexp:$.base0A,background:$.base02},editVariable:{editIcon:$.base0E,cancelIcon:$.base09,removeIcon:$.base09,addIcon:$.base0E,checkIcon:$.base0E,background:$.base01,color:$.base0A,border:$.base07},addKeyModal:{background:$.base05,border:$.base04,color:$.base0A,labelColor:$.base01},validationFailure:{background:$.base09,iconColor:$.base01,fontColor:$.base01}}}(Y);return{"app-container":{fontFamily:O.globalFontFamily,cursor:O.globalCursor,backgroundColor:Z.backgroundColor,position:"relative"},ellipsis:{display:"inline-block",color:Z.ellipsisColor,fontSize:O.ellipsisFontSize,lineHeight:O.ellipsisLineHeight,cursor:O.ellipsisCursor},"brace-row":{display:"inline-block",cursor:"pointer"},brace:{display:"inline-block",cursor:O.braceCursor,fontWeight:O.braceFontWeight,color:Z.braceColor},"expanded-icon":{color:Z.expandedIcon},"collapsed-icon":{color:Z.collapsedIcon},colon:{display:"inline-block",margin:O.keyMargin,color:Z.keyColor,verticalAlign:"top"},objectKeyVal:function($,G){return{style:l({paddingTop:O.keyValPaddingTop,paddingRight:O.keyValPaddingRight,paddingBottom:O.keyValPaddingBottom,borderLeft:O.keyValBorderLeft+" "+Z.objectBorder,":hover":{paddingLeft:G.paddingLeft-1+"px",borderLeft:O.keyValBorderHover+" "+Z.objectBorder}},G)}},"object-key-val-no-border":{padding:O.keyValPadding},"pushed-content":{marginLeft:O.pushedContentMarginLeft},variableValue:function($,G){return{style:l({display:"inline-block",paddingRight:O.variableValuePaddingRight,position:"relative"},G)}},"object-name":{display:"inline-block",color:Z.keyColor,letterSpacing:O.keyLetterSpacing,fontStyle:O.keyFontStyle,verticalAlign:O.keyVerticalAlign,opacity:O.keyOpacity,":hover":{opacity:O.keyOpacityHover}},"array-key":{display:"inline-block",color:Z.arrayKeyColor,letterSpacing:O.keyLetterSpacing,fontStyle:O.keyFontStyle,verticalAlign:O.keyVerticalAlign,opacity:O.keyOpacity,":hover":{opacity:O.keyOpacityHover}},"object-size":{color:Z.objectSize,borderRadius:O.objectSizeBorderRadius,fontStyle:O.objectSizeFontStyle,margin:O.objectSizeMargin,cursor:"default"},"data-type-label":{fontSize:O.dataTypeFontSize,marginRight:O.dataTypeMarginRight,opacity:O.datatypeOpacity},boolean:{display:"inline-block",color:Z.dataTypes.boolean},date:{display:"inline-block",color:Z.dataTypes.date},"date-value":{marginLeft:O.dateValueMarginLeft},float:{display:"inline-block",color:Z.dataTypes.float},function:{display:"inline-block",color:Z.dataTypes.function,cursor:"pointer",whiteSpace:"pre-line"},"function-value":{fontStyle:"italic"},integer:{display:"inline-block",color:Z.dataTypes.integer},string:{display:"inline-block",color:Z.dataTypes.string},nan:{display:"inline-block",color:Z.dataTypes.nan,fontSize:O.nanFontSize,fontWeight:O.nanFontWeight,backgroundColor:Z.dataTypes.background,padding:O.nanPadding,borderRadius:O.nanBorderRadius},null:{display:"inline-block",color:Z.dataTypes.null,fontSize:O.nullFontSize,fontWeight:O.nullFontWeight,backgroundColor:Z.dataTypes.background,padding:O.nullPadding,borderRadius:O.nullBorderRadius},undefined:{display:"inline-block",color:Z.dataTypes.undefined,fontSize:O.undefinedFontSize,padding:O.undefinedPadding,borderRadius:O.undefinedBorderRadius,backgroundColor:Z.dataTypes.background},regexp:{display:"inline-block",color:Z.dataTypes.regexp},"copy-to-clipboard":{cursor:O.clipboardCursor},"copy-icon":{color:Z.copyToClipboard,fontSize:O.iconFontSize,marginRight:O.iconMarginRight,verticalAlign:"top"},"copy-icon-copied":{color:Z.copyToClipboardCheck,marginLeft:O.clipboardCheckMarginLeft},"array-group-meta-data":{display:"inline-block",padding:O.arrayGroupMetaPadding},"object-meta-data":{display:"inline-block",padding:O.metaDataPadding},"icon-container":{display:"inline-block",width:O.iconContainerWidth},tooltip:{padding:O.tooltipPadding},removeVarIcon:{verticalAlign:"top",display:"inline-block",color:Z.editVariable.removeIcon,cursor:O.iconCursor,fontSize:O.iconFontSize,marginRight:O.iconMarginRight},addVarIcon:{verticalAlign:"top",display:"inline-block",color:Z.editVariable.addIcon,cursor:O.iconCursor,fontSize:O.iconFontSize,marginRight:O.iconMarginRight},editVarIcon:{verticalAlign:"top",display:"inline-block",color:Z.editVariable.editIcon,cursor:O.iconCursor,fontSize:O.iconFontSize,marginRight:O.iconMarginRight},"edit-icon-container":{display:"inline-block",verticalAlign:"top"},"check-icon":{display:"inline-block",cursor:O.iconCursor,color:Z.editVariable.checkIcon,fontSize:O.iconFontSize,paddingRight:O.iconPaddingRight},"cancel-icon":{display:"inline-block",cursor:O.iconCursor,color:Z.editVariable.cancelIcon,fontSize:O.iconFontSize,paddingRight:O.iconPaddingRight},"edit-input":{display:"inline-block",minWidth:O.editInputMinWidth,borderRadius:O.editInputBorderRadius,backgroundColor:Z.editVariable.background,color:Z.editVariable.color,padding:O.editInputPadding,marginRight:O.editInputMarginRight,fontFamily:O.editInputFontFamily},"detected-row":{paddingTop:O.detectedRowPaddingTop},"key-modal-request":{position:O.addKeyCoverPosition,top:O.addKeyCoverPositionPx,left:O.addKeyCoverPositionPx,right:O.addKeyCoverPositionPx,bottom:O.addKeyCoverPositionPx,backgroundColor:O.addKeyCoverBackground},"key-modal":{width:O.addKeyModalWidth,backgroundColor:Z.addKeyModal.background,marginLeft:O.addKeyModalMargin,marginRight:O.addKeyModalMargin,padding:O.addKeyModalPadding,borderRadius:O.addKeyModalRadius,marginTop:"15px",position:"relative"},"key-modal-label":{color:Z.addKeyModal.labelColor,marginLeft:"2px",marginBottom:"5px",fontSize:"11px"},"key-modal-input-container":{overflow:"hidden"},"key-modal-input":{width:"100%",padding:"3px 6px",fontFamily:"monospace",color:Z.addKeyModal.color,border:"none",boxSizing:"border-box",borderRadius:"2px"},"key-modal-cancel":{backgroundColor:Z.editVariable.removeIcon,position:"absolute",top:"0px",right:"0px",borderRadius:"0px 3px 0px 3px",cursor:"pointer"},"key-modal-cancel-icon":{color:Z.addKeyModal.labelColor,fontSize:O.iconFontSize,transform:"rotate(45deg)"},"key-modal-submit":{color:Z.editVariable.addIcon,fontSize:O.iconFontSize,position:"absolute",right:"2px",top:"3px",cursor:"pointer"},"function-ellipsis":{display:"inline-block",color:Z.ellipsisColor,fontSize:O.ellipsisFontSize,lineHeight:O.ellipsisLineHeight,cursor:O.ellipsisCursor},"validation-failure":{float:"right",padding:"3px 6px",borderRadius:"2px",cursor:"pointer",color:Z.validationFailure.fontColor,backgroundColor:Z.validationFailure.background},"validation-failure-label":{marginRight:"6px"},"validation-failure-clear":{position:"relative",verticalAlign:"top",cursor:"pointer",color:Z.validationFailure.iconColor,fontSize:O.iconFontSize,transform:"rotate(45deg)"}}};function H(Y,Z,$){return Y||console.error("theme has not been set"),function(G){var W=B;return G!==!1&&G!=="none"||(W=K),Object(U.createStyling)(X,{defaultBase16:W})(G)}(Y)(Z,$)}var ee=function(Y){m($,Y);var Z=E($);function $(){return c(this,$),Z.apply(this,arguments)}return p($,[{key:"render",value:function(){var G=this.props,W=(G.rjvId,G.type_name),de=G.displayDataTypes,Se=G.theme;return de?w.a.createElement("span",Object.assign({className:"data-type-label"},H(Se,"data-type-label")),W):null}}]),$}(w.a.PureComponent),J=function(Y){m($,Y);var Z=E($);function $(){return c(this,$),Z.apply(this,arguments)}return p($,[{key:"render",value:function(){var G=this.props;return w.a.createElement("div",H(G.theme,"boolean"),w.a.createElement(ee,Object.assign({type_name:"bool"},G)),G.value?"true":"false")}}]),$}(w.a.PureComponent),ne=function(Y){m($,Y);var Z=E($);function $(){return c(this,$),Z.apply(this,arguments)}return p($,[{key:"render",value:function(){var G=this.props;return w.a.createElement("div",H(G.theme,"date"),w.a.createElement(ee,Object.assign({type_name:"date"},G)),w.a.createElement("span",Object.assign({className:"date-value"},H(G.theme,"date-value")),G.value.toLocaleTimeString("en-us",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})))}}]),$}(w.a.PureComponent),ae=function(Y){m($,Y);var Z=E($);function $(){return c(this,$),Z.apply(this,arguments)}return p($,[{key:"render",value:function(){var G=this.props;return w.a.createElement("div",H(G.theme,"float"),w.a.createElement(ee,Object.assign({type_name:"float"},G)),this.props.value)}}]),$}(w.a.PureComponent);function q(Y,Z){(Z==null||Z>Y.length)&&(Z=Y.length);for(var $=0,G=new Array(Z);$<Z;$++)G[$]=Y[$];return G}function se(Y,Z){if(Y){if(typeof Y=="string")return q(Y,Z);var $=Object.prototype.toString.call(Y).slice(8,-1);return $==="Object"&&Y.constructor&&($=Y.constructor.name),$==="Map"||$==="Set"?Array.from(Y):$==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test($)?q(Y,Z):void 0}}function xe(Y,Z){var $;if(typeof Symbol>"u"||Y[Symbol.iterator]==null){if(Array.isArray(Y)||($=se(Y))||Z){$&&(Y=$);var G=0,W=function(){};return{s:W,n:function(){return G>=Y.length?{done:!0}:{done:!1,value:Y[G++]}},e:function(ce){throw ce},f:W}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var de,Se=!0,be=!1;return{s:function(){$=Y[Symbol.iterator]()},n:function(){var ce=$.next();return Se=ce.done,ce},e:function(ce){be=!0,de=ce},f:function(){try{Se||$.return==null||$.return()}finally{if(be)throw de}}}}function Oe(Y){return function(Z){if(Array.isArray(Z))return q(Z)}(Y)||function(Z){if(typeof Symbol<"u"&&Symbol.iterator in Object(Z))return Array.from(Z)}(Y)||se(Y)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}var Ee=o(46),Ue=new(o(47)).Dispatcher,Be=new(function(Y){m($,Y);var Z=E($);function $(){var G;c(this,$);for(var W=arguments.length,de=new Array(W),Se=0;Se<W;Se++)de[Se]=arguments[Se];return(G=Z.call.apply(Z,[this].concat(de))).objects={},G.set=function(be,ce,_e,et){G.objects[be]===void 0&&(G.objects[be]={}),G.objects[be][ce]===void 0&&(G.objects[be][ce]={}),G.objects[be][ce][_e]=et},G.get=function(be,ce,_e,et){return G.objects[be]===void 0||G.objects[be][ce]===void 0||G.objects[be][ce][_e]==null?et:G.objects[be][ce][_e]},G.handleAction=function(be){var ce=be.rjvId,_e=be.data;switch(be.name){case"RESET":G.emit("reset-"+ce);break;case"VARIABLE_UPDATED":be.data.updated_src=G.updateSrc(ce,_e),G.set(ce,"action","variable-update",l(l({},_e),{},{type:"variable-edited"})),G.emit("variable-update-"+ce);break;case"VARIABLE_REMOVED":be.data.updated_src=G.updateSrc(ce,_e),G.set(ce,"action","variable-update",l(l({},_e),{},{type:"variable-removed"})),G.emit("variable-update-"+ce);break;case"VARIABLE_ADDED":be.data.updated_src=G.updateSrc(ce,_e),G.set(ce,"action","variable-update",l(l({},_e),{},{type:"variable-added"})),G.emit("variable-update-"+ce);break;case"ADD_VARIABLE_KEY_REQUEST":G.set(ce,"action","new-key-request",_e),G.emit("add-key-request-"+ce)}},G.updateSrc=function(be,ce){var _e=ce.name,et=ce.namespace,jt=ce.new_value,dt=(ce.existing_value,ce.variable_removed);et.shift();var dn,Ct=G.get(be,"global","src"),Yt=G.deepCopy(Ct,Oe(et)),Pn=Yt,St=xe(et);try{for(St.s();!(dn=St.n()).done;)Pn=Pn[dn.value]}catch(bn){St.e(bn)}finally{St.f()}return dt?L(Pn)=="array"?Pn.splice(_e,1):delete Pn[_e]:_e!==null?Pn[_e]=jt:Yt=jt,G.set(be,"global","src",Yt),Yt},G.deepCopy=function(be,ce){var _e,et=L(be),jt=ce.shift();return et=="array"?_e=Oe(be):et=="object"&&(_e=l({},be)),jt!==void 0&&(_e[jt]=G.deepCopy(be[jt],ce)),_e},G}return $}(Ee.EventEmitter));Ue.register(Be.handleAction.bind(Be));var Te=Be,Le=function(Y){m($,Y);var Z=E($);function $(G){var W;return c(this,$),(W=Z.call(this,G)).toggleCollapsed=function(){W.setState({collapsed:!W.state.collapsed},function(){Te.set(W.props.rjvId,W.props.namespace,"collapsed",W.state.collapsed)})},W.getFunctionDisplay=function(de){var Se=S(W).props;return de?w.a.createElement("span",null,W.props.value.toString().slice(9,-1).replace(/\{[\s\S]+/,""),w.a.createElement("span",{className:"function-collapsed",style:{fontWeight:"bold"}},w.a.createElement("span",null,"{"),w.a.createElement("span",H(Se.theme,"ellipsis"),"..."),w.a.createElement("span",null,"}"))):W.props.value.toString().slice(9,-1)},W.state={collapsed:Te.get(G.rjvId,G.namespace,"collapsed",!0)},W}return p($,[{key:"render",value:function(){var G=this.props,W=this.state.collapsed;return w.a.createElement("div",H(G.theme,"function"),w.a.createElement(ee,Object.assign({type_name:"function"},G)),w.a.createElement("span",Object.assign({},H(G.theme,"function-value"),{className:"rjv-function-container",onClick:this.toggleCollapsed}),this.getFunctionDisplay(W)))}}]),$}(w.a.PureComponent),Xe=function(Y){m($,Y);var Z=E($);function $(){return c(this,$),Z.apply(this,arguments)}return p($,[{key:"render",value:function(){return w.a.createElement("div",H(this.props.theme,"nan"),"NaN")}}]),$}(w.a.PureComponent),pt=function(Y){m($,Y);var Z=E($);function $(){return c(this,$),Z.apply(this,arguments)}return p($,[{key:"render",value:function(){return w.a.createElement("div",H(this.props.theme,"null"),"NULL")}}]),$}(w.a.PureComponent),gn=function(Y){m($,Y);var Z=E($);function $(){return c(this,$),Z.apply(this,arguments)}return p($,[{key:"render",value:function(){var G=this.props;return w.a.createElement("div",H(G.theme,"integer"),w.a.createElement(ee,Object.assign({type_name:"int"},G)),this.props.value)}}]),$}(w.a.PureComponent),Dt=function(Y){m($,Y);var Z=E($);function $(){return c(this,$),Z.apply(this,arguments)}return p($,[{key:"render",value:function(){var G=this.props;return w.a.createElement("div",H(G.theme,"regexp"),w.a.createElement(ee,Object.assign({type_name:"regexp"},G)),this.props.value.toString())}}]),$}(w.a.PureComponent),sn=function(Y){m($,Y);var Z=E($);function $(G){var W;return c(this,$),(W=Z.call(this,G)).toggleCollapsed=function(){W.setState({collapsed:!W.state.collapsed},function(){Te.set(W.props.rjvId,W.props.namespace,"collapsed",W.state.collapsed)})},W.state={collapsed:Te.get(G.rjvId,G.namespace,"collapsed",!0)},W}return p($,[{key:"render",value:function(){this.state.collapsed;var G=this.props,W=G.collapseStringsAfterLength,de=G.theme,Se=G.value,be={style:{cursor:"default"}};return L(W)==="integer"&&Se.length>W&&(be.style.cursor="pointer",this.state.collapsed&&(Se=w.a.createElement("span",null,Se.substring(0,W),w.a.createElement("span",H(de,"ellipsis")," ...")))),w.a.createElement("div",H(de,"string"),w.a.createElement(ee,Object.assign({type_name:"string"},G)),w.a.createElement("span",Object.assign({className:"string-value"},be,{onClick:this.toggleCollapsed}),'"',Se,'"'))}}]),$}(w.a.PureComponent),Kt=function(Y){m($,Y);var Z=E($);function $(){return c(this,$),Z.apply(this,arguments)}return p($,[{key:"render",value:function(){return w.a.createElement("div",H(this.props.theme,"undefined"),"undefined")}}]),$}(w.a.PureComponent);function Nt(){return(Nt=Object.assign||function(Y){for(var Z=1;Z<arguments.length;Z++){var $=arguments[Z];for(var G in $)Object.prototype.hasOwnProperty.call($,G)&&(Y[G]=$[G])}return Y}).apply(this,arguments)}var vr=T.useLayoutEffect,br=function(Y){var Z=Object(T.useRef)(Y);return vr(function(){Z.current=Y}),Z},Qn=function(Y,Z){typeof Y!="function"?Y.current=Z:Y(Z)},Sr=function(Y,Z){var $=Object(T.useRef)();return Object(T.useCallback)(function(G){Y.current=G,$.current&&Qn($.current,null),$.current=Z,Z&&Qn(Z,G)},[Z])},dr={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0"},Rr=function(Y){Object.keys(dr).forEach(function(Z){Y.style.setProperty(Z,dr[Z],"important")})},qn=null,Zs=function(){},ke=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width"],ge=!!document.documentElement.currentStyle,he=function(Y,Z){var $=Y.cacheMeasurements,G=Y.maxRows,W=Y.minRows,de=Y.onChange,Se=de===void 0?Zs:de,be=Y.onHeightChange,ce=be===void 0?Zs:be,_e=function(St,bn){if(St==null)return{};var Dr,hr,cc={},tr=Object.keys(St);for(hr=0;hr<tr.length;hr++)Dr=tr[hr],bn.indexOf(Dr)>=0||(cc[Dr]=St[Dr]);return cc}(Y,["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"]),et,jt=_e.value!==void 0,dt=Object(T.useRef)(null),dn=Sr(dt,Z),Ct=Object(T.useRef)(0),Yt=Object(T.useRef)(),Pn=function(){var St=dt.current,bn=$&&Yt.current?Yt.current:function(tr){var dc=window.getComputedStyle(tr);if(dc===null)return null;var Ea,nr=(Ea=dc,ke.reduce(function(Es,Js){return Es[Js]=Ea[Js],Es},{})),qo=nr.boxSizing;return qo===""?null:(ge&&qo==="border-box"&&(nr.width=parseFloat(nr.width)+parseFloat(nr.borderRightWidth)+parseFloat(nr.borderLeftWidth)+parseFloat(nr.paddingRight)+parseFloat(nr.paddingLeft)+"px"),{sizingStyle:nr,paddingSize:parseFloat(nr.paddingBottom)+parseFloat(nr.paddingTop),borderSize:parseFloat(nr.borderBottomWidth)+parseFloat(nr.borderTopWidth)})}(St);if(bn){Yt.current=bn;var Dr=function(tr,dc,Ea,nr){Ea===void 0&&(Ea=1),nr===void 0&&(nr=1/0),qn||((qn=document.createElement("textarea")).setAttribute("tab-index","-1"),qn.setAttribute("aria-hidden","true"),Rr(qn)),qn.parentNode===null&&document.body.appendChild(qn);var qo=tr.paddingSize,Es=tr.borderSize,Js=tr.sizingStyle,ka=Js.boxSizing;Object.keys(Js).forEach(function(Pa){var yo=Pa;qn.style[yo]=Js[yo]}),Rr(qn),qn.value=dc;var uc=function(Pa,yo){var Mu=Pa.scrollHeight;return yo.sizingStyle.boxSizing==="border-box"?Mu+yo.borderSize:Mu-yo.paddingSize}(qn,tr);qn.value="x";var wd=qn.scrollHeight-qo,Sl=wd*Ea;ka==="border-box"&&(Sl=Sl+qo+Es),uc=Math.max(Sl,uc);var hc=wd*nr;return ka==="border-box"&&(hc=hc+qo+Es),[uc=Math.min(hc,uc),wd]}(bn,St.value||St.placeholder||"x",W,G),hr=Dr[0],cc=Dr[1];Ct.current!==hr&&(Ct.current=hr,St.style.setProperty("height",hr+"px","important"),ce(hr,{rowHeight:cc}))}};return Object(T.useLayoutEffect)(Pn),et=br(Pn),Object(T.useLayoutEffect)(function(){var St=function(bn){et.current(bn)};return window.addEventListener("resize",St),function(){window.removeEventListener("resize",St)}},[]),Object(T.createElement)("textarea",Nt({},_e,{onChange:function(St){jt||Pn(),Se(St)},ref:dn}))},Ce=Object(T.forwardRef)(he);function $e(Y){Y=Y.trim();try{if((Y=JSON.stringify(JSON.parse(Y)))[0]==="[")return re("array",JSON.parse(Y));if(Y[0]==="{")return re("object",JSON.parse(Y));if(Y.match(/\-?\d+\.\d+/)&&Y.match(/\-?\d+\.\d+/)[0]===Y)return re("float",parseFloat(Y));if(Y.match(/\-?\d+e-\d+/)&&Y.match(/\-?\d+e-\d+/)[0]===Y)return re("float",Number(Y));if(Y.match(/\-?\d+/)&&Y.match(/\-?\d+/)[0]===Y)return re("integer",parseInt(Y));if(Y.match(/\-?\d+e\+\d+/)&&Y.match(/\-?\d+e\+\d+/)[0]===Y)return re("integer",Number(Y))}catch{}switch(Y=Y.toLowerCase()){case"undefined":return re("undefined",void 0);case"nan":return re("nan",NaN);case"null":return re("null",null);case"true":return re("boolean",!0);case"false":return re("boolean",!1);default:if(Y=Date.parse(Y))return re("date",new Date(Y))}return re(!1,null)}function re(Y,Z){return{type:Y,value:Z}}var we=function(Y){m($,Y);var Z=E($);function $(){return c(this,$),Z.apply(this,arguments)}return p($,[{key:"render",value:function(){var G=this.props,W=G.style,de=z(G,["style"]);return w.a.createElement("span",de,w.a.createElement("svg",Object.assign({},At(W),{viewBox:"0 0 24 24",fill:"currentColor",preserveAspectRatio:"xMidYMid meet"}),w.a.createElement("path",{d:"M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M7,13H17V11H7"})))}}]),$}(w.a.PureComponent),Fe=function(Y){m($,Y);var Z=E($);function $(){return c(this,$),Z.apply(this,arguments)}return p($,[{key:"render",value:function(){var G=this.props,W=G.style,de=z(G,["style"]);return w.a.createElement("span",de,w.a.createElement("svg",Object.assign({},At(W),{viewBox:"0 0 24 24",fill:"currentColor",preserveAspectRatio:"xMidYMid meet"}),w.a.createElement("path",{d:"M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M13,7H11V11H7V13H11V17H13V13H17V11H13V7Z"})))}}]),$}(w.a.PureComponent),ct=function(Y){m($,Y);var Z=E($);function $(){return c(this,$),Z.apply(this,arguments)}return p($,[{key:"render",value:function(){var G=this.props,W=G.style,de=z(G,["style"]),Se=At(W).style;return w.a.createElement("span",de,w.a.createElement("svg",{fill:Se.color,width:Se.height,height:Se.width,style:Se,viewBox:"0 0 1792 1792"},w.a.createElement("path",{d:"M1344 800v64q0 14-9 23t-23 9h-832q-14 0-23-9t-9-23v-64q0-14 9-23t23-9h832q14 0 23 9t9 23zm128 448v-832q0-66-47-113t-113-47h-832q-66 0-113 47t-47 113v832q0 66 47 113t113 47h832q66 0 113-47t47-113zm128-832v832q0 119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119 84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z"})))}}]),$}(w.a.PureComponent),tn=function(Y){m($,Y);var Z=E($);function $(){return c(this,$),Z.apply(this,arguments)}return p($,[{key:"render",value:function(){var G=this.props,W=G.style,de=z(G,["style"]),Se=At(W).style;return w.a.createElement("span",de,w.a.createElement("svg",{fill:Se.color,width:Se.height,height:Se.width,style:Se,viewBox:"0 0 1792 1792"},w.a.createElement("path",{d:"M1344 800v64q0 14-9 23t-23 9h-352v352q0 14-9 23t-23 9h-64q-14 0-23-9t-9-23v-352h-352q-14 0-23-9t-9-23v-64q0-14 9-23t23-9h352v-352q0-14 9-23t23-9h64q14 0 23 9t9 23v352h352q14 0 23 9t9 23zm128 448v-832q0-66-47-113t-113-47h-832q-66 0-113 47t-47 113v832q0 66 47 113t113 47h832q66 0 113-47t47-113zm128-832v832q0 119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119 84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z"})))}}]),$}(w.a.PureComponent),Vt=function(Y){m($,Y);var Z=E($);function $(){return c(this,$),Z.apply(this,arguments)}return p($,[{key:"render",value:function(){var G=this.props,W=G.style,de=z(G,["style"]);return w.a.createElement("span",de,w.a.createElement("svg",{style:l(l({},At(W).style),{},{paddingLeft:"2px",verticalAlign:"top"}),viewBox:"0 0 15 15",fill:"currentColor"},w.a.createElement("path",{d:"M0 14l6-6-6-6z"})))}}]),$}(w.a.PureComponent),Tn=function(Y){m($,Y);var Z=E($);function $(){return c(this,$),Z.apply(this,arguments)}return p($,[{key:"render",value:function(){var G=this.props,W=G.style,de=z(G,["style"]);return w.a.createElement("span",de,w.a.createElement("svg",{style:l(l({},At(W).style),{},{paddingLeft:"2px",verticalAlign:"top"}),viewBox:"0 0 15 15",fill:"currentColor"},w.a.createElement("path",{d:"M0 5l6 6 6-6z"})))}}]),$}(w.a.PureComponent),qt=function(Y){m($,Y);var Z=E($);function $(){return c(this,$),Z.apply(this,arguments)}return p($,[{key:"render",value:function(){var G=this.props,W=G.style,de=z(G,["style"]);return w.a.createElement("span",de,w.a.createElement("svg",Object.assign({},At(W),{viewBox:"0 0 40 40",fill:"currentColor",preserveAspectRatio:"xMidYMid meet"}),w.a.createElement("g",null,w.a.createElement("path",{d:"m30 35h-25v-22.5h25v7.5h2.5v-12.5c0-1.4-1.1-2.5-2.5-2.5h-7.5c0-2.8-2.2-5-5-5s-5 2.2-5 5h-7.5c-1.4 0-2.5 1.1-2.5 2.5v27.5c0 1.4 1.1 2.5 2.5 2.5h25c1.4 0 2.5-1.1 2.5-2.5v-5h-2.5v5z m-20-27.5h2.5s2.5-1.1 2.5-2.5 1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5 1.3 2.5 2.5 2.5h2.5s2.5 1.1 2.5 2.5h-20c0-1.5 1.1-2.5 2.5-2.5z m-2.5 20h5v-2.5h-5v2.5z m17.5-5v-5l-10 7.5 10 7.5v-5h12.5v-5h-12.5z m-17.5 10h7.5v-2.5h-7.5v2.5z m12.5-17.5h-12.5v2.5h12.5v-2.5z m-7.5 5h-5v2.5h5v-2.5z"}))))}}]),$}(w.a.PureComponent),En=function(Y){m($,Y);var Z=E($);function $(){return c(this,$),Z.apply(this,arguments)}return p($,[{key:"render",value:function(){var G=this.props,W=G.style,de=z(G,["style"]);return w.a.createElement("span",de,w.a.createElement("svg",Object.assign({},At(W),{viewBox:"0 0 40 40",fill:"currentColor",preserveAspectRatio:"xMidYMid meet"}),w.a.createElement("g",null,w.a.createElement("path",{d:"m28.6 25q0-0.5-0.4-1l-4-4 4-4q0.4-0.5 0.4-1 0-0.6-0.4-1.1l-2-2q-0.4-0.4-1-0.4-0.6 0-1 0.4l-4.1 4.1-4-4.1q-0.4-0.4-1-0.4-0.6 0-1 0.4l-2 2q-0.5 0.5-0.5 1.1 0 0.5 0.5 1l4 4-4 4q-0.5 0.5-0.5 1 0 0.7 0.5 1.1l2 2q0.4 0.4 1 0.4 0.6 0 1-0.4l4-4.1 4.1 4.1q0.4 0.4 1 0.4 0.6 0 1-0.4l2-2q0.4-0.4 0.4-1z m8.7-5q0 4.7-2.3 8.6t-6.3 6.2-8.6 2.3-8.6-2.3-6.2-6.2-2.3-8.6 2.3-8.6 6.2-6.2 8.6-2.3 8.6 2.3 6.3 6.2 2.3 8.6z"}))))}}]),$}(w.a.PureComponent),kn=function(Y){m($,Y);var Z=E($);function $(){return c(this,$),Z.apply(this,arguments)}return p($,[{key:"render",value:function(){var G=this.props,W=G.style,de=z(G,["style"]);return w.a.createElement("span",de,w.a.createElement("svg",Object.assign({},At(W),{viewBox:"0 0 40 40",fill:"currentColor",preserveAspectRatio:"xMidYMid meet"}),w.a.createElement("g",null,w.a.createElement("path",{d:"m30.1 21.4v-2.8q0-0.6-0.4-1t-1-0.5h-5.7v-5.7q0-0.6-0.4-1t-1-0.4h-2.9q-0.6 0-1 0.4t-0.4 1v5.7h-5.7q-0.6 0-1 0.5t-0.5 1v2.8q0 0.6 0.5 1t1 0.5h5.7v5.7q0 0.5 0.4 1t1 0.4h2.9q0.6 0 1-0.4t0.4-1v-5.7h5.7q0.6 0 1-0.5t0.4-1z m7.2-1.4q0 4.7-2.3 8.6t-6.3 6.2-8.6 2.3-8.6-2.3-6.2-6.2-2.3-8.6 2.3-8.6 6.2-6.2 8.6-2.3 8.6 2.3 6.3 6.2 2.3 8.6z"}))))}}]),$}(w.a.PureComponent),Yn=function(Y){m($,Y);var Z=E($);function $(){return c(this,$),Z.apply(this,arguments)}return p($,[{key:"render",value:function(){var G=this.props,W=G.style,de=z(G,["style"]);return w.a.createElement("span",de,w.a.createElement("svg",Object.assign({},At(W),{viewBox:"0 0 40 40",fill:"currentColor",preserveAspectRatio:"xMidYMid meet"}),w.a.createElement("g",null,w.a.createElement("path",{d:"m31.6 21.6h-10v10h-3.2v-10h-10v-3.2h10v-10h3.2v10h10v3.2z"}))))}}]),$}(w.a.PureComponent),Mn=function(Y){m($,Y);var Z=E($);function $(){return c(this,$),Z.apply(this,arguments)}return p($,[{key:"render",value:function(){var G=this.props,W=G.style,de=z(G,["style"]);return w.a.createElement("span",de,w.a.createElement("svg",Object.assign({},At(W),{viewBox:"0 0 40 40",fill:"currentColor",preserveAspectRatio:"xMidYMid meet"}),w.a.createElement("g",null,w.a.createElement("path",{d:"m19.8 26.4l2.6-2.6-3.4-3.4-2.6 2.6v1.3h2.2v2.1h1.2z m9.8-16q-0.3-0.4-0.7 0l-7.8 7.8q-0.4 0.4 0 0.7t0.7 0l7.8-7.8q0.4-0.4 0-0.7z m1.8 13.2v4.3q0 2.6-1.9 4.5t-4.5 1.9h-18.6q-2.6 0-4.5-1.9t-1.9-4.5v-18.6q0-2.7 1.9-4.6t4.5-1.8h18.6q1.4 0 2.6 0.5 0.3 0.2 0.4 0.5 0.1 0.4-0.2 0.7l-1.1 1.1q-0.3 0.3-0.7 0.1-0.5-0.1-1-0.1h-18.6q-1.4 0-2.5 1.1t-1 2.5v18.6q0 1.4 1 2.5t2.5 1h18.6q1.5 0 2.5-1t1.1-2.5v-2.9q0-0.2 0.2-0.4l1.4-1.5q0.3-0.3 0.8-0.1t0.4 0.6z m-2.1-16.5l6.4 6.5-15 15h-6.4v-6.5z m9.9 3l-2.1 2-6.4-6.4 2.1-2q0.6-0.7 1.5-0.7t1.5 0.7l3.4 3.4q0.6 0.6 0.6 1.5t-0.6 1.5z"}))))}}]),$}(w.a.PureComponent),mn=function(Y){m($,Y);var Z=E($);function $(){return c(this,$),Z.apply(this,arguments)}return p($,[{key:"render",value:function(){var G=this.props,W=G.style,de=z(G,["style"]);return w.a.createElement("span",de,w.a.createElement("svg",Object.assign({},At(W),{viewBox:"0 0 40 40",fill:"currentColor",preserveAspectRatio:"xMidYMid meet"}),w.a.createElement("g",null,w.a.createElement("path",{d:"m31.7 16.4q0-0.6-0.4-1l-2.1-2.1q-0.4-0.4-1-0.4t-1 0.4l-9.1 9.1-5-5q-0.5-0.4-1-0.4t-1 0.4l-2.1 2q-0.4 0.4-0.4 1 0 0.6 0.4 1l8.1 8.1q0.4 0.4 1 0.4 0.6 0 1-0.4l12.2-12.1q0.4-0.4 0.4-1z m5.6 3.6q0 4.7-2.3 8.6t-6.3 6.2-8.6 2.3-8.6-2.3-6.2-6.2-2.3-8.6 2.3-8.6 6.2-6.2 8.6-2.3 8.6 2.3 6.3 6.2 2.3 8.6z"}))))}}]),$}(w.a.PureComponent);function At(Y){return Y||(Y={}),{style:l(l({verticalAlign:"middle"},Y),{},{color:Y.color?Y.color:"#000000",height:"1em",width:"1em"})}}var On=function(Y){m($,Y);var Z=E($);function $(G){var W;return c(this,$),(W=Z.call(this,G)).copiedTimer=null,W.handleCopy=function(){var de=document.createElement("textarea"),Se=W.props,be=Se.clickCallback,ce=Se.src,_e=Se.namespace;de.innerHTML=JSON.stringify(W.clipboardValue(ce),null,"  "),document.body.appendChild(de),de.select(),document.execCommand("copy"),document.body.removeChild(de),W.copiedTimer=setTimeout(function(){W.setState({copied:!1})},5500),W.setState({copied:!0},function(){typeof be=="function"&&be({src:ce,namespace:_e,name:_e[_e.length-1]})})},W.getClippyIcon=function(){var de=W.props.theme;return W.state.copied?w.a.createElement("span",null,w.a.createElement(qt,Object.assign({className:"copy-icon"},H(de,"copy-icon"))),w.a.createElement("span",H(de,"copy-icon-copied"),"✔")):w.a.createElement(qt,Object.assign({className:"copy-icon"},H(de,"copy-icon")))},W.clipboardValue=function(de){switch(L(de)){case"function":case"regexp":return de.toString();default:return de}},W.state={copied:!1},W}return p($,[{key:"componentWillUnmount",value:function(){this.copiedTimer&&(clearTimeout(this.copiedTimer),this.copiedTimer=null)}},{key:"render",value:function(){var G=this.props,W=(G.src,G.theme),de=G.hidden,Se=G.rowHovered,be=H(W,"copy-to-clipboard").style,ce="inline";return de&&(ce="none"),w.a.createElement("span",{className:"copy-to-clipboard-container",title:"Copy to clipboard",style:{verticalAlign:"top",display:Se?"inline-block":"none"}},w.a.createElement("span",{style:l(l({},be),{},{display:ce}),onClick:this.handleCopy},this.getClippyIcon()))}}]),$}(w.a.PureComponent),ur=function(Y){m($,Y);var Z=E($);function $(G){var W;return c(this,$),(W=Z.call(this,G)).getEditIcon=function(){var de=W.props,Se=de.variable,be=de.theme;return w.a.createElement("div",{className:"click-to-edit",style:{verticalAlign:"top",display:W.state.hovered?"inline-block":"none"}},w.a.createElement(Mn,Object.assign({className:"click-to-edit-icon"},H(be,"editVarIcon"),{onClick:function(){W.prepopInput(Se)}})))},W.prepopInput=function(de){if(W.props.onEdit!==!1){var Se=function(ce){var _e;switch(L(ce)){case"undefined":_e="undefined";break;case"nan":_e="NaN";break;case"string":_e=ce;break;case"date":case"function":case"regexp":_e=ce.toString();break;default:try{_e=JSON.stringify(ce,null,"  ")}catch{_e=""}}return _e}(de.value),be=$e(Se);W.setState({editMode:!0,editValue:Se,parsedInput:{type:be.type,value:be.value}})}},W.getRemoveIcon=function(){var de=W.props,Se=de.variable,be=de.namespace,ce=de.theme,_e=de.rjvId;return w.a.createElement("div",{className:"click-to-remove",style:{verticalAlign:"top",display:W.state.hovered?"inline-block":"none"}},w.a.createElement(En,Object.assign({className:"click-to-remove-icon"},H(ce,"removeVarIcon"),{onClick:function(){Ue.dispatch({name:"VARIABLE_REMOVED",rjvId:_e,data:{name:Se.name,namespace:be,existing_value:Se.value,variable_removed:!0}})}})))},W.getValue=function(de,Se){var be=!Se&&de.type,ce=S(W).props;switch(be){case!1:return W.getEditInput();case"string":return w.a.createElement(sn,Object.assign({value:de.value},ce));case"integer":return w.a.createElement(gn,Object.assign({value:de.value},ce));case"float":return w.a.createElement(ae,Object.assign({value:de.value},ce));case"boolean":return w.a.createElement(J,Object.assign({value:de.value},ce));case"function":return w.a.createElement(Le,Object.assign({value:de.value},ce));case"null":return w.a.createElement(pt,ce);case"nan":return w.a.createElement(Xe,ce);case"undefined":return w.a.createElement(Kt,ce);case"date":return w.a.createElement(ne,Object.assign({value:de.value},ce));case"regexp":return w.a.createElement(Dt,Object.assign({value:de.value},ce));default:return w.a.createElement("div",{className:"object-value"},JSON.stringify(de.value))}},W.getEditInput=function(){var de=W.props.theme,Se=W.state.editValue;return w.a.createElement("div",null,w.a.createElement(Ce,Object.assign({type:"text",inputRef:function(be){return be&&be.focus()},value:Se,className:"variable-editor",onChange:function(be){var ce=be.target.value,_e=$e(ce);W.setState({editValue:ce,parsedInput:{type:_e.type,value:_e.value}})},onKeyDown:function(be){switch(be.key){case"Escape":W.setState({editMode:!1,editValue:""});break;case"Enter":(be.ctrlKey||be.metaKey)&&W.submitEdit(!0)}be.stopPropagation()},placeholder:"update this value",minRows:2},H(de,"edit-input"))),w.a.createElement("div",H(de,"edit-icon-container"),w.a.createElement(En,Object.assign({className:"edit-cancel"},H(de,"cancel-icon"),{onClick:function(){W.setState({editMode:!1,editValue:""})}})),w.a.createElement(mn,Object.assign({className:"edit-check string-value"},H(de,"check-icon"),{onClick:function(){W.submitEdit()}})),w.a.createElement("div",null,W.showDetected())))},W.submitEdit=function(de){var Se=W.props,be=Se.variable,ce=Se.namespace,_e=Se.rjvId,et=W.state,jt=et.editValue,dt=et.parsedInput,dn=jt;de&&dt.type&&(dn=dt.value),W.setState({editMode:!1}),Ue.dispatch({name:"VARIABLE_UPDATED",rjvId:_e,data:{name:be.name,namespace:ce,existing_value:be.value,new_value:dn,variable_removed:!1}})},W.showDetected=function(){var de=W.props,Se=de.theme,be=(de.variable,de.namespace,de.rjvId,W.state.parsedInput),ce=(be.type,be.value,W.getDetectedInput());if(ce)return w.a.createElement("div",null,w.a.createElement("div",H(Se,"detected-row"),ce,w.a.createElement(mn,{className:"edit-check detected",style:l({verticalAlign:"top",paddingLeft:"3px"},H(Se,"check-icon").style),onClick:function(){W.submitEdit(!0)}})))},W.getDetectedInput=function(){var de=W.state.parsedInput,Se=de.type,be=de.value,ce=S(W).props,_e=ce.theme;if(Se!==!1)switch(Se.toLowerCase()){case"object":return w.a.createElement("span",null,w.a.createElement("span",{style:l(l({},H(_e,"brace").style),{},{cursor:"default"})},"{"),w.a.createElement("span",{style:l(l({},H(_e,"ellipsis").style),{},{cursor:"default"})},"..."),w.a.createElement("span",{style:l(l({},H(_e,"brace").style),{},{cursor:"default"})},"}"));case"array":return w.a.createElement("span",null,w.a.createElement("span",{style:l(l({},H(_e,"brace").style),{},{cursor:"default"})},"["),w.a.createElement("span",{style:l(l({},H(_e,"ellipsis").style),{},{cursor:"default"})},"..."),w.a.createElement("span",{style:l(l({},H(_e,"brace").style),{},{cursor:"default"})},"]"));case"string":return w.a.createElement(sn,Object.assign({value:be},ce));case"integer":return w.a.createElement(gn,Object.assign({value:be},ce));case"float":return w.a.createElement(ae,Object.assign({value:be},ce));case"boolean":return w.a.createElement(J,Object.assign({value:be},ce));case"function":return w.a.createElement(Le,Object.assign({value:be},ce));case"null":return w.a.createElement(pt,ce);case"nan":return w.a.createElement(Xe,ce);case"undefined":return w.a.createElement(Kt,ce);case"date":return w.a.createElement(ne,Object.assign({value:new Date(be)},ce))}},W.state={editMode:!1,editValue:"",hovered:!1,renameKey:!1,parsedInput:{type:!1,value:null}},W}return p($,[{key:"render",value:function(){var G=this,W=this.props,de=W.variable,Se=W.singleIndent,be=W.type,ce=W.theme,_e=W.namespace,et=W.indentWidth,jt=W.enableClipboard,dt=W.onEdit,dn=W.onDelete,Ct=W.onSelect,Yt=W.displayArrayKey,Pn=W.quotesOnKeys,St=this.state.editMode;return w.a.createElement("div",Object.assign({},H(ce,"objectKeyVal",{paddingLeft:et*Se}),{onMouseEnter:function(){return G.setState(l(l({},G.state),{},{hovered:!0}))},onMouseLeave:function(){return G.setState(l(l({},G.state),{},{hovered:!1}))},className:"variable-row",key:de.name}),be=="array"?Yt?w.a.createElement("span",Object.assign({},H(ce,"array-key"),{key:de.name+"_"+_e}),de.name,w.a.createElement("div",H(ce,"colon"),":")):null:w.a.createElement("span",null,w.a.createElement("span",Object.assign({},H(ce,"object-name"),{className:"object-key",key:de.name+"_"+_e}),!!Pn&&w.a.createElement("span",{style:{verticalAlign:"top"}},'"'),w.a.createElement("span",{style:{display:"inline-block"}},de.name),!!Pn&&w.a.createElement("span",{style:{verticalAlign:"top"}},'"')),w.a.createElement("span",H(ce,"colon"),":")),w.a.createElement("div",Object.assign({className:"variable-value",onClick:Ct===!1&&dt===!1?null:function(bn){var Dr=Oe(_e);(bn.ctrlKey||bn.metaKey)&&dt!==!1?G.prepopInput(de):Ct!==!1&&(Dr.shift(),Ct(l(l({},de),{},{namespace:Dr})))}},H(ce,"variableValue",{cursor:Ct===!1?"default":"pointer"})),this.getValue(de,St)),jt?w.a.createElement(On,{rowHovered:this.state.hovered,hidden:St,src:de.value,clickCallback:jt,theme:ce,namespace:[].concat(Oe(_e),[de.name])}):null,dt!==!1&&St==0?this.getEditIcon():null,dn!==!1&&St==0?this.getRemoveIcon():null)}}]),$}(w.a.PureComponent),is=function(Y){m($,Y);var Z=E($);function $(){var G;c(this,$);for(var W=arguments.length,de=new Array(W),Se=0;Se<W;Se++)de[Se]=arguments[Se];return(G=Z.call.apply(Z,[this].concat(de))).getObjectSize=function(){var be=G.props,ce=be.size,_e=be.theme;if(be.displayObjectSize)return w.a.createElement("span",Object.assign({className:"object-size"},H(_e,"object-size")),ce," item",ce===1?"":"s")},G.getAddAttribute=function(be){var ce=G.props,_e=ce.theme,et=ce.namespace,jt=ce.name,dt=ce.src,dn=ce.rjvId,Ct=ce.depth;return w.a.createElement("span",{className:"click-to-add",style:{verticalAlign:"top",display:be?"inline-block":"none"}},w.a.createElement(kn,Object.assign({className:"click-to-add-icon"},H(_e,"addVarIcon"),{onClick:function(){var Yt={name:Ct>0?jt:null,namespace:et.splice(0,et.length-1),existing_value:dt,variable_removed:!1,key_name:null};L(dt)==="object"?Ue.dispatch({name:"ADD_VARIABLE_KEY_REQUEST",rjvId:dn,data:Yt}):Ue.dispatch({name:"VARIABLE_ADDED",rjvId:dn,data:l(l({},Yt),{},{new_value:[].concat(Oe(dt),[null])})})}})))},G.getRemoveObject=function(be){var ce=G.props,_e=ce.theme,et=(ce.hover,ce.namespace),jt=ce.name,dt=ce.src,dn=ce.rjvId;if(et.length!==1)return w.a.createElement("span",{className:"click-to-remove",style:{display:be?"inline-block":"none"}},w.a.createElement(En,Object.assign({className:"click-to-remove-icon"},H(_e,"removeVarIcon"),{onClick:function(){Ue.dispatch({name:"VARIABLE_REMOVED",rjvId:dn,data:{name:jt,namespace:et.splice(0,et.length-1),existing_value:dt,variable_removed:!0}})}})))},G.render=function(){var be=G.props,ce=be.theme,_e=be.onDelete,et=be.onAdd,jt=be.enableClipboard,dt=be.src,dn=be.namespace,Ct=be.rowHovered;return w.a.createElement("div",Object.assign({},H(ce,"object-meta-data"),{className:"object-meta-data",onClick:function(Yt){Yt.stopPropagation()}}),G.getObjectSize(),jt?w.a.createElement(On,{rowHovered:Ct,clickCallback:jt,src:dt,theme:ce,namespace:dn}):null,et!==!1?G.getAddAttribute(Ct):null,_e!==!1?G.getRemoveObject(Ct):null)},G}return $}(w.a.PureComponent);function Vr(Y){var Z=Y.parent_type,$=Y.namespace,G=Y.quotesOnKeys,W=Y.theme,de=Y.jsvRoot,Se=Y.name,be=Y.displayArrayKey,ce=Y.name?Y.name:"";return!de||Se!==!1&&Se!==null?Z=="array"?be?w.a.createElement("span",Object.assign({},H(W,"array-key"),{key:$}),w.a.createElement("span",{className:"array-key"},ce),w.a.createElement("span",H(W,"colon"),":")):w.a.createElement("span",null):w.a.createElement("span",Object.assign({},H(W,"object-name"),{key:$}),w.a.createElement("span",{className:"object-key"},G&&w.a.createElement("span",{style:{verticalAlign:"top"}},'"'),w.a.createElement("span",null,ce),G&&w.a.createElement("span",{style:{verticalAlign:"top"}},'"')),w.a.createElement("span",H(W,"colon"),":")):w.a.createElement("span",null)}function er(Y){var Z=Y.theme;switch(Y.iconStyle){case"triangle":return w.a.createElement(Tn,Object.assign({},H(Z,"expanded-icon"),{className:"expanded-icon"}));case"square":return w.a.createElement(ct,Object.assign({},H(Z,"expanded-icon"),{className:"expanded-icon"}));default:return w.a.createElement(we,Object.assign({},H(Z,"expanded-icon"),{className:"expanded-icon"}))}}function Cs(Y){var Z=Y.theme;switch(Y.iconStyle){case"triangle":return w.a.createElement(Vt,Object.assign({},H(Z,"collapsed-icon"),{className:"collapsed-icon"}));case"square":return w.a.createElement(tn,Object.assign({},H(Z,"collapsed-icon"),{className:"collapsed-icon"}));default:return w.a.createElement(Fe,Object.assign({},H(Z,"collapsed-icon"),{className:"collapsed-icon"}))}}var go=function(Y){m($,Y);var Z=E($);function $(G){var W;return c(this,$),(W=Z.call(this,G)).toggleCollapsed=function(de){var Se=[];for(var be in W.state.expanded)Se.push(W.state.expanded[be]);Se[de]=!Se[de],W.setState({expanded:Se})},W.state={expanded:[]},W}return p($,[{key:"getExpandedIcon",value:function(G){var W=this.props,de=W.theme,Se=W.iconStyle;return this.state.expanded[G]?w.a.createElement(er,{theme:de,iconStyle:Se}):w.a.createElement(Cs,{theme:de,iconStyle:Se})}},{key:"render",value:function(){var G=this,W=this.props,de=W.src,Se=W.groupArraysAfterLength,be=(W.depth,W.name),ce=W.theme,_e=W.jsvRoot,et=W.namespace,jt=(W.parent_type,z(W,["src","groupArraysAfterLength","depth","name","theme","jsvRoot","namespace","parent_type"])),dt=0,dn=5*this.props.indentWidth;_e||(dt=5*this.props.indentWidth);var Ct=Se,Yt=Math.ceil(de.length/Ct);return w.a.createElement("div",Object.assign({className:"object-key-val"},H(ce,_e?"jsv-root":"objectKeyVal",{paddingLeft:dt})),w.a.createElement(Vr,this.props),w.a.createElement("span",null,w.a.createElement(is,Object.assign({size:de.length},this.props))),Oe(Array(Yt)).map(function(Pn,St){return w.a.createElement("div",Object.assign({key:St,className:"object-key-val array-group"},H(ce,"objectKeyVal",{marginLeft:6,paddingLeft:dn})),w.a.createElement("span",H(ce,"brace-row"),w.a.createElement("div",Object.assign({className:"icon-container"},H(ce,"icon-container"),{onClick:function(bn){G.toggleCollapsed(St)}}),G.getExpandedIcon(St)),G.state.expanded[St]?w.a.createElement(ac,Object.assign({key:be+St,depth:0,name:!1,collapsed:!1,groupArraysAfterLength:Ct,index_offset:St*Ct,src:de.slice(St*Ct,St*Ct+Ct),namespace:et,type:"array",parent_type:"array_group",theme:ce},jt)):w.a.createElement("span",Object.assign({},H(ce,"brace"),{onClick:function(bn){G.toggleCollapsed(St)},className:"array-group-brace"}),"[",w.a.createElement("div",Object.assign({},H(ce,"array-group-meta-data"),{className:"array-group-meta-data"}),w.a.createElement("span",Object.assign({className:"object-size"},H(ce,"object-size")),St*Ct," - ",St*Ct+Ct>de.length?de.length:St*Ct+Ct)),"]")))}))}}]),$}(w.a.PureComponent),Hi=function(Y){m($,Y);var Z=E($);function $(G){var W;c(this,$),(W=Z.call(this,G)).toggleCollapsed=function(){W.setState({expanded:!W.state.expanded},function(){Te.set(W.props.rjvId,W.props.namespace,"expanded",W.state.expanded)})},W.getObjectContent=function(Se,be,ce){return w.a.createElement("div",{className:"pushed-content object-container"},w.a.createElement("div",Object.assign({className:"object-content"},H(W.props.theme,"pushed-content")),W.renderObjectContents(be,ce)))},W.getEllipsis=function(){return W.state.size===0?null:w.a.createElement("div",Object.assign({},H(W.props.theme,"ellipsis"),{className:"node-ellipsis",onClick:W.toggleCollapsed}),"...")},W.getObjectMetaData=function(Se){var be=W.props,ce=(be.rjvId,be.theme,W.state),_e=ce.size,et=ce.hovered;return w.a.createElement(is,Object.assign({rowHovered:et,size:_e},W.props))},W.renderObjectContents=function(Se,be){var ce,_e=W.props,et=_e.depth,jt=_e.parent_type,dt=_e.index_offset,dn=_e.groupArraysAfterLength,Ct=_e.namespace,Yt=W.state.object_type,Pn=[],St=Object.keys(Se||{});return W.props.sortKeys&&Yt!=="array"&&(St=St.sort()),St.forEach(function(bn){if(ce=new bl(bn,Se[bn]),jt==="array_group"&&dt&&(ce.name=parseInt(ce.name)+dt),Se.hasOwnProperty(bn))if(ce.type==="object")Pn.push(w.a.createElement(ac,Object.assign({key:ce.name,depth:et+1,name:ce.name,src:ce.value,namespace:Ct.concat(ce.name),parent_type:Yt},be)));else if(ce.type==="array"){var Dr=ac;dn&&ce.value.length>dn&&(Dr=go),Pn.push(w.a.createElement(Dr,Object.assign({key:ce.name,depth:et+1,name:ce.name,src:ce.value,namespace:Ct.concat(ce.name),type:"array",parent_type:Yt},be)))}else Pn.push(w.a.createElement(ur,Object.assign({key:ce.name+"_"+Ct,variable:ce,singleIndent:5,namespace:Ct,type:W.props.type},be)))}),Pn};var de=$.getState(G);return W.state=l(l({},de),{},{prevProps:{}}),W}return p($,[{key:"getBraceStart",value:function(G,W){var de=this,Se=this.props,be=Se.src,ce=Se.theme,_e=Se.iconStyle;if(Se.parent_type==="array_group")return w.a.createElement("span",null,w.a.createElement("span",H(ce,"brace"),G==="array"?"[":"{"),W?this.getObjectMetaData(be):null);var et=W?er:Cs;return w.a.createElement("span",null,w.a.createElement("span",Object.assign({onClick:function(jt){de.toggleCollapsed()}},H(ce,"brace-row")),w.a.createElement("div",Object.assign({className:"icon-container"},H(ce,"icon-container")),w.a.createElement(et,{theme:ce,iconStyle:_e})),w.a.createElement(Vr,this.props),w.a.createElement("span",H(ce,"brace"),G==="array"?"[":"{")),W?this.getObjectMetaData(be):null)}},{key:"render",value:function(){var G=this,W=this.props,de=W.depth,Se=W.src,be=(W.namespace,W.name,W.type,W.parent_type),ce=W.theme,_e=W.jsvRoot,et=W.iconStyle,jt=z(W,["depth","src","namespace","name","type","parent_type","theme","jsvRoot","iconStyle"]),dt=this.state,dn=dt.object_type,Ct=dt.expanded,Yt={};return _e||be==="array_group"?be==="array_group"&&(Yt.borderLeft=0,Yt.display="inline"):Yt.paddingLeft=5*this.props.indentWidth,w.a.createElement("div",Object.assign({className:"object-key-val",onMouseEnter:function(){return G.setState(l(l({},G.state),{},{hovered:!0}))},onMouseLeave:function(){return G.setState(l(l({},G.state),{},{hovered:!1}))}},H(ce,_e?"jsv-root":"objectKeyVal",Yt)),this.getBraceStart(dn,Ct),Ct?this.getObjectContent(de,Se,l({theme:ce,iconStyle:et},jt)):this.getEllipsis(),w.a.createElement("span",{className:"brace-row"},w.a.createElement("span",{style:l(l({},H(ce,"brace").style),{},{paddingLeft:Ct?"3px":"0px"})},dn==="array"?"]":"}"),Ct?null:this.getObjectMetaData(Se)))}}],[{key:"getDerivedStateFromProps",value:function(G,W){var de=W.prevProps;return G.src!==de.src||G.collapsed!==de.collapsed||G.name!==de.name||G.namespace!==de.namespace||G.rjvId!==de.rjvId?l(l({},$.getState(G)),{},{prevProps:G}):null}}]),$}(w.a.PureComponent);Hi.getState=function(Y){var Z=Object.keys(Y.src).length,$=(Y.collapsed===!1||Y.collapsed!==!0&&Y.collapsed>Y.depth)&&(!Y.shouldCollapse||Y.shouldCollapse({name:Y.name,src:Y.src,type:L(Y.src),namespace:Y.namespace})===!1)&&Z!==0;return{expanded:Te.get(Y.rjvId,Y.namespace,"expanded",$),object_type:Y.type==="array"?"array":"object",parent_type:Y.type==="array"?"array":"object",size:Z,hovered:!1}};var bl=function Y(Z,$){c(this,Y),this.name=Z,this.value=$,this.type=L($)};N(Hi);var ac=Hi,wa=function(Y){m($,Y);var Z=E($);function $(){var G;c(this,$);for(var W=arguments.length,de=new Array(W),Se=0;Se<W;Se++)de[Se]=arguments[Se];return(G=Z.call.apply(Z,[this].concat(de))).render=function(){var be=S(G).props,ce=[be.name],_e=ac;return Array.isArray(be.src)&&be.groupArraysAfterLength&&be.src.length>be.groupArraysAfterLength&&(_e=go),w.a.createElement("div",{className:"pretty-json-container object-container"},w.a.createElement("div",{className:"object-content"},w.a.createElement(_e,Object.assign({namespace:ce,depth:0,jsvRoot:!0},be))))},G}return $}(w.a.PureComponent),Ca=function(Y){m($,Y);var Z=E($);function $(G){var W;return c(this,$),(W=Z.call(this,G)).closeModal=function(){Ue.dispatch({rjvId:W.props.rjvId,name:"RESET"})},W.submit=function(){W.props.submit(W.state.input)},W.state={input:G.input?G.input:""},W}return p($,[{key:"render",value:function(){var G=this,W=this.props,de=W.theme,Se=W.rjvId,be=W.isValid,ce=this.state.input,_e=be(ce);return w.a.createElement("div",Object.assign({className:"key-modal-request"},H(de,"key-modal-request"),{onClick:this.closeModal}),w.a.createElement("div",Object.assign({},H(de,"key-modal"),{onClick:function(et){et.stopPropagation()}}),w.a.createElement("div",H(de,"key-modal-label"),"Key Name:"),w.a.createElement("div",{style:{position:"relative"}},w.a.createElement("input",Object.assign({},H(de,"key-modal-input"),{className:"key-modal-input",ref:function(et){return et&&et.focus()},spellCheck:!1,value:ce,placeholder:"...",onChange:function(et){G.setState({input:et.target.value})},onKeyPress:function(et){_e&&et.key==="Enter"?G.submit():et.key==="Escape"&&G.closeModal()}})),_e?w.a.createElement(mn,Object.assign({},H(de,"key-modal-submit"),{className:"key-modal-submit",onClick:function(et){return G.submit()}})):null),w.a.createElement("span",H(de,"key-modal-cancel"),w.a.createElement(Yn,Object.assign({},H(de,"key-modal-cancel-icon"),{className:"key-modal-cancel",onClick:function(){Ue.dispatch({rjvId:Se,name:"RESET"})}})))))}}]),$}(w.a.PureComponent),mo=function(Y){m($,Y);var Z=E($);function $(){var G;c(this,$);for(var W=arguments.length,de=new Array(W),Se=0;Se<W;Se++)de[Se]=arguments[Se];return(G=Z.call.apply(Z,[this].concat(de))).isValid=function(be){var ce=G.props.rjvId,_e=Te.get(ce,"action","new-key-request");return be!=""&&Object.keys(_e.existing_value).indexOf(be)===-1},G.submit=function(be){var ce=G.props.rjvId,_e=Te.get(ce,"action","new-key-request");_e.new_value=l({},_e.existing_value),_e.new_value[be]=G.props.defaultValue,Ue.dispatch({name:"VARIABLE_ADDED",rjvId:ce,data:_e})},G}return p($,[{key:"render",value:function(){var G=this.props,W=G.active,de=G.theme,Se=G.rjvId;return W?w.a.createElement(Ca,{rjvId:Se,theme:de,isValid:this.isValid,submit:this.submit}):null}}]),$}(w.a.PureComponent),xd=function(Y){m($,Y);var Z=E($);function $(){return c(this,$),Z.apply(this,arguments)}return p($,[{key:"render",value:function(){var G=this.props,W=G.message,de=G.active,Se=G.theme,be=G.rjvId;return de?w.a.createElement("div",Object.assign({className:"validation-failure"},H(Se,"validation-failure"),{onClick:function(){Ue.dispatch({rjvId:be,name:"RESET"})}}),w.a.createElement("span",H(Se,"validation-failure-label"),W),w.a.createElement(Yn,H(Se,"validation-failure-clear"))):null}}]),$}(w.a.PureComponent),lc=function(Y){m($,Y);var Z=E($);function $(G){var W;return c(this,$),(W=Z.call(this,G)).rjvId=Date.now().toString(),W.getListeners=function(){return{reset:W.resetState,"variable-update":W.updateSrc,"add-key-request":W.addKeyRequest}},W.updateSrc=function(){var de,Se=Te.get(W.rjvId,"action","variable-update"),be=Se.name,ce=Se.namespace,_e=Se.new_value,et=Se.existing_value,jt=(Se.variable_removed,Se.updated_src),dt=Se.type,dn=W.props,Ct=dn.onEdit,Yt=dn.onDelete,Pn=dn.onAdd,St={existing_src:W.state.src,new_value:_e,updated_src:jt,name:be,namespace:ce,existing_value:et};switch(dt){case"variable-added":de=Pn(St);break;case"variable-edited":de=Ct(St);break;case"variable-removed":de=Yt(St)}de!==!1?(Te.set(W.rjvId,"global","src",jt),W.setState({src:jt})):W.setState({validationFailure:!0})},W.addKeyRequest=function(){W.setState({addKeyRequest:!0})},W.resetState=function(){W.setState({validationFailure:!1,addKeyRequest:!1})},W.state={addKeyRequest:!1,editKeyRequest:!1,validationFailure:!1,src:$.defaultProps.src,name:$.defaultProps.name,theme:$.defaultProps.theme,validationMessage:$.defaultProps.validationMessage,prevSrc:$.defaultProps.src,prevName:$.defaultProps.name,prevTheme:$.defaultProps.theme},W}return p($,[{key:"componentDidMount",value:function(){Te.set(this.rjvId,"global","src",this.state.src);var G=this.getListeners();for(var W in G)Te.on(W+"-"+this.rjvId,G[W]);this.setState({addKeyRequest:!1,editKeyRequest:!1})}},{key:"componentDidUpdate",value:function(G,W){W.addKeyRequest!==!1&&this.setState({addKeyRequest:!1}),W.editKeyRequest!==!1&&this.setState({editKeyRequest:!1}),G.src!==this.state.src&&Te.set(this.rjvId,"global","src",this.state.src)}},{key:"componentWillUnmount",value:function(){var G=this.getListeners();for(var W in G)Te.removeListener(W+"-"+this.rjvId,G[W])}},{key:"render",value:function(){var G=this.state,W=G.validationFailure,de=G.validationMessage,Se=G.addKeyRequest,be=G.theme,ce=G.src,_e=G.name,et=this.props,jt=et.style,dt=et.defaultValue;return w.a.createElement("div",{className:"react-json-view",style:l(l({},H(be,"app-container").style),jt)},w.a.createElement(xd,{message:de,active:W,theme:be,rjvId:this.rjvId}),w.a.createElement(wa,Object.assign({},this.props,{src:ce,name:_e,theme:be,type:L(ce),rjvId:this.rjvId})),w.a.createElement(mo,{active:Se,theme:be,rjvId:this.rjvId,defaultValue:dt}))}}],[{key:"getDerivedStateFromProps",value:function(G,W){if(G.src!==W.prevSrc||G.name!==W.prevName||G.theme!==W.prevTheme){var de={src:G.src,name:G.name,theme:G.theme,validationMessage:G.validationMessage,prevSrc:G.src,prevName:G.name,prevTheme:G.theme};return $.validateState(de)}return null}}]),$}(w.a.PureComponent);lc.defaultProps={src:{},name:"root",theme:"rjv-default",collapsed:!1,collapseStringsAfterLength:!1,shouldCollapse:!1,sortKeys:!1,quotesOnKeys:!0,groupArraysAfterLength:100,indentWidth:4,enableClipboard:!0,displayObjectSize:!0,displayDataTypes:!0,onEdit:!1,onDelete:!1,onAdd:!1,onSelect:!1,iconStyle:"triangle",style:{},validationMessage:"Validation Error",defaultValue:null,displayArrayKey:!0},lc.validateState=function(Y){var Z={};return L(Y.theme)!=="object"||function($){var G=["base00","base01","base02","base03","base04","base05","base06","base07","base08","base09","base0A","base0B","base0C","base0D","base0E","base0F"];if(L($)==="object"){for(var W=0;W<G.length;W++)if(!(G[W]in $))return!1;return!0}return!1}(Y.theme)||(console.error("react-json-view error:","theme prop must be a theme name or valid base-16 theme object.",'defaulting to "rjv-default" theme'),Z.theme="rjv-default"),L(Y.src)!=="object"&&L(Y.src)!=="array"&&(console.error("react-json-view error:","src property must be a valid json object"),Z.name="ERROR",Z.src={message:"src property must be a valid json object"}),l(l({},Y),Z)},N(lc),s.default=lc}])})}(Ky)),Ky.exports}var pH=hH();const Lx=ec(pH),Nx="__TLDRAW_LIBRARY_VERSIONS__";function fH(){if(globalThis[Nx])return globalThis[Nx];const r={versions:[],didWarn:!1,scheduledNotice:null};return Object.defineProperty(globalThis,Nx,{value:r,writable:!1,configurable:!1,enumerable:!1}),r}function dd(r,e,t){if(!r||!e||!t)throw new Error("Missing name/version/module system in built version of tldraw library");const n=fH();if(n.versions.push({name:r,version:e,modules:t}),!n.scheduledNotice)try{n.scheduledNotice=setTimeout(()=>{n.scheduledNotice=null,VT(n)},100)}catch{VT(n)}}function VT(r){if(!r.versions.length||r.didWarn)return;const e=r.versions.sort((a,l)=>qT(a.version,l.version)),t=e[e.length-1].version,n=new Set,s=new Map;for(const a of e){if(s.has(a.name)){n.delete(a.name),Fx(s,a.name,new Set).add(a.version);continue}a.version===t?n.add(a.name):(n.delete(a.name),Fx(s,a.name,new Set).add(a.version))}if(s.size>0){const a=[`${Ml("[tldraw]",["bold","bgRed","textWhite"])} ${Ml("You have multiple versions of tldraw libraries installed. This can lead to bugs and unexpected behavior.",["textRed","bold"])}`,"",`The latest version you have installed is ${Ml(`v${t}`,["bold","textBlue"])}. The following libraries are on the latest version:`,...Array.from(n,l=>`  • ✅ ${Ml(l,["bold"])}`),"","The following libraries are not on the latest version, or have multiple versions installed:",...Array.from(s,([l,c])=>{const u=Array.from(c).sort(qT).map(p=>Ml(`v${p}`,p===t?["textGreen"]:["textRed"]));return`  • ❌ ${Ml(l,["bold"])} (${u.join(", ")})`})];console.log(a.join(`
`)),r.didWarn=!0;return}const o=new Map;for(const a of e)Fx(o,a.name,{version:a.version,modules:[]}).modules.push(a.modules);const i=new Map;for(const[a,l]of o)l.modules.length>1&&i.set(a,l);if(i.size>0){const a=[`${Ml("[tldraw]",["bold","bgRed","textWhite"])} ${Ml("You have multiple instances of some tldraw libraries active. This can lead to bugs and unexpected behavior. ",["textRed","bold"])}`,"","This usually means that your bundler is misconfigured, and is importing the same library multiple times - usually once as an ES Module, and once as a CommonJS module.","","The following libraries have been imported multiple times:",...Array.from(i,([l,c])=>{const u=c.modules.map((p,f)=>p==="esm"?`      ${f+1}. ES Modules`:`      ${f+1}. CommonJS`).join(`
`);return`  • ❌ ${Ml(l,["bold"])} v${c.version}: 
${u}`}),"","You should configure your bundler to only import one version of each library."];console.log(a.join(`
`)),r.didWarn=!0;return}}function qT(r,e){const t=r.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/),n=e.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/);return!t||!n?r.localeCompare(e):t[1]!==n[1]?Number(t[1])-Number(n[1]):t[2]!==n[2]?Number(t[2])-Number(n[2]):t[3]!==n[3]?Number(t[3])-Number(n[3]):t[4]&&n[4]?t[4].localeCompare(n[4]):t[4]?1:n[4]?-1:0}const gH={bold:"1",textBlue:"94",textRed:"31",textGreen:"32",bgRed:"41",textWhite:"97"};function Ml(r,e=[]){return`\x1B[${e.map(t=>gH[t]).join(";")}m${r}\x1B[m`}function Fx(r,e,t){return r.has(e)?r.get(e):(r.set(e,t),t)}var zx,YT;function mH(){if(YT)return zx;YT=1;var r="Expected a function",e=NaN,t="[object Symbol]",n=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,i=/^0o[0-7]+$/i,a=parseInt,l=typeof $o=="object"&&$o&&$o.Object===Object&&$o,c=typeof self=="object"&&self&&self.Object===Object&&self,u=l||c||Function("return this")(),p=Object.prototype,f=p.toString,m=Math.max,v=Math.min,b=function(){return u.Date.now()};function S(R,D,N){var z,L,B,K,O,U,X=0,H=!1,ee=!1,J=!0;if(typeof R!="function")throw new TypeError(r);D=M(D)||0,E(N)&&(H=!!N.leading,ee="maxWait"in N,B=ee?m(M(N.maxWait)||0,D):B,J="trailing"in N?!!N.trailing:J);function ne(Te){var Le=z,Xe=L;return z=L=void 0,X=Te,K=R.apply(Xe,Le),K}function ae(Te){return X=Te,O=setTimeout(xe,D),H?ne(Te):K}function q(Te){var Le=Te-U,Xe=Te-X,pt=D-Le;return ee?v(pt,B-Xe):pt}function se(Te){var Le=Te-U,Xe=Te-X;return U===void 0||Le>=D||Le<0||ee&&Xe>=B}function xe(){var Te=b();if(se(Te))return Oe(Te);O=setTimeout(xe,q(Te))}function Oe(Te){return O=void 0,J&&z?ne(Te):(z=L=void 0,K)}function Ee(){O!==void 0&&clearTimeout(O),X=0,z=U=L=O=void 0}function Ue(){return O===void 0?K:Oe(b())}function Be(){var Te=b(),Le=se(Te);if(z=arguments,L=this,U=Te,Le){if(O===void 0)return ae(U);if(ee)return O=setTimeout(xe,D),ne(U)}return O===void 0&&(O=setTimeout(xe,D)),K}return Be.cancel=Ee,Be.flush=Ue,Be}function C(R,D,N){var z=!0,L=!0;if(typeof R!="function")throw new TypeError(r);return E(N)&&(z="leading"in N?!!N.leading:z,L="trailing"in N?!!N.trailing:L),S(R,D,{leading:z,maxWait:D,trailing:L})}function E(R){var D=typeof R;return!!R&&(D=="object"||D=="function")}function T(R){return!!R&&typeof R=="object"}function w(R){return typeof R=="symbol"||T(R)&&f.call(R)==t}function M(R){if(typeof R=="number")return R;if(w(R))return e;if(E(R)){var D=typeof R.valueOf=="function"?R.valueOf():R;R=E(D)?D+"":D}if(typeof R!="string")return R===0?R:+R;R=R.replace(n,"");var N=o.test(R);return N||i.test(R)?a(R.slice(2),N?2:8):s.test(R)?e:+R}return zx=C,zx}var yH=mH();const _O=ec(yH);var $x,XT;function vH(){if(XT)return $x;XT=1;var r=200,e="__lodash_hash_undefined__",t=1/0,n="[object Function]",s="[object GeneratorFunction]",o=/[\\^$.*+?()[\]{}|]/g,i=/^\[object .+?Constructor\]$/,a=typeof $o=="object"&&$o&&$o.Object===Object&&$o,l=typeof self=="object"&&self&&self.Object===Object&&self,c=a||l||Function("return this")();function u(re,we){var Fe=re?re.length:0;return!!Fe&&f(re,we,0)>-1}function p(re,we,Fe,ct){for(var tn=re.length,Vt=Fe+-1;++Vt<tn;)if(we(re[Vt],Vt,re))return Vt;return-1}function f(re,we,Fe){if(we!==we)return p(re,m,Fe);for(var ct=Fe-1,tn=re.length;++ct<tn;)if(re[ct]===we)return ct;return-1}function m(re){return re!==re}function v(re,we){return re.has(we)}function b(re,we){return re==null?void 0:re[we]}function S(re){var we=!1;if(re!=null&&typeof re.toString!="function")try{we=!!(re+"")}catch{}return we}function C(re){var we=-1,Fe=Array(re.size);return re.forEach(function(ct){Fe[++we]=ct}),Fe}var E=Array.prototype,T=Function.prototype,w=Object.prototype,M=c["__core-js_shared__"],R=function(){var re=/[^.]+$/.exec(M&&M.keys&&M.keys.IE_PROTO||"");return re?"Symbol(src)_1."+re:""}(),D=T.toString,N=w.hasOwnProperty,z=w.toString,L=RegExp("^"+D.call(N).replace(o,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),B=E.splice,K=dr(c,"Map"),O=dr(c,"Set"),U=dr(Object,"create");function X(re){var we=-1,Fe=re?re.length:0;for(this.clear();++we<Fe;){var ct=re[we];this.set(ct[0],ct[1])}}function H(){this.__data__=U?U(null):{}}function ee(re){return this.has(re)&&delete this.__data__[re]}function J(re){var we=this.__data__;if(U){var Fe=we[re];return Fe===e?void 0:Fe}return N.call(we,re)?we[re]:void 0}function ne(re){var we=this.__data__;return U?we[re]!==void 0:N.call(we,re)}function ae(re,we){var Fe=this.__data__;return Fe[re]=U&&we===void 0?e:we,this}X.prototype.clear=H,X.prototype.delete=ee,X.prototype.get=J,X.prototype.has=ne,X.prototype.set=ae;function q(re){var we=-1,Fe=re?re.length:0;for(this.clear();++we<Fe;){var ct=re[we];this.set(ct[0],ct[1])}}function se(){this.__data__=[]}function xe(re){var we=this.__data__,Fe=Nt(we,re);if(Fe<0)return!1;var ct=we.length-1;return Fe==ct?we.pop():B.call(we,Fe,1),!0}function Oe(re){var we=this.__data__,Fe=Nt(we,re);return Fe<0?void 0:we[Fe][1]}function Ee(re){return Nt(this.__data__,re)>-1}function Ue(re,we){var Fe=this.__data__,ct=Nt(Fe,re);return ct<0?Fe.push([re,we]):Fe[ct][1]=we,this}q.prototype.clear=se,q.prototype.delete=xe,q.prototype.get=Oe,q.prototype.has=Ee,q.prototype.set=Ue;function Be(re){var we=-1,Fe=re?re.length:0;for(this.clear();++we<Fe;){var ct=re[we];this.set(ct[0],ct[1])}}function Te(){this.__data__={hash:new X,map:new(K||q),string:new X}}function Le(re){return Sr(this,re).delete(re)}function Xe(re){return Sr(this,re).get(re)}function pt(re){return Sr(this,re).has(re)}function gn(re,we){return Sr(this,re).set(re,we),this}Be.prototype.clear=Te,Be.prototype.delete=Le,Be.prototype.get=Xe,Be.prototype.has=pt,Be.prototype.set=gn;function Dt(re){var we=-1,Fe=re?re.length:0;for(this.__data__=new Be;++we<Fe;)this.add(re[we])}function sn(re){return this.__data__.set(re,e),this}function Kt(re){return this.__data__.has(re)}Dt.prototype.add=Dt.prototype.push=sn,Dt.prototype.has=Kt;function Nt(re,we){for(var Fe=re.length;Fe--;)if(ge(re[Fe][0],we))return Fe;return-1}function vr(re){if(!Ce(re)||qn(re))return!1;var we=he(re)||S(re)?L:i;return we.test(Zs(re))}function br(re,we,Fe){var ct=-1,tn=u,Vt=re.length,Tn=!0,qt=[],En=qt;if(Vt>=r){var kn=Qn(re);if(kn)return C(kn);Tn=!1,tn=v,En=new Dt}else En=qt;e:for(;++ct<Vt;){var Yn=re[ct],Mn=Yn;if(Yn=Yn!==0?Yn:0,Tn&&Mn===Mn){for(var mn=En.length;mn--;)if(En[mn]===Mn)continue e;qt.push(Yn)}else tn(En,Mn,Fe)||(En!==qt&&En.push(Mn),qt.push(Yn))}return qt}var Qn=O&&1/C(new O([,-0]))[1]==t?function(re){return new O(re)}:$e;function Sr(re,we){var Fe=re.__data__;return Rr(we)?Fe[typeof we=="string"?"string":"hash"]:Fe.map}function dr(re,we){var Fe=b(re,we);return vr(Fe)?Fe:void 0}function Rr(re){var we=typeof re;return we=="string"||we=="number"||we=="symbol"||we=="boolean"?re!=="__proto__":re===null}function qn(re){return!!R&&R in re}function Zs(re){if(re!=null){try{return D.call(re)}catch{}try{return re+""}catch{}}return""}function ke(re){return re&&re.length?br(re):[]}function ge(re,we){return re===we||re!==re&&we!==we}function he(re){var we=Ce(re)?z.call(re):"";return we==n||we==s}function Ce(re){var we=typeof re;return!!re&&(we=="object"||we=="function")}function $e(){}return $x=ke,$x}var bH=vH();const SH=ec(bH);function TO(r){const e=(...t)=>{try{return r(...t)}catch(n){throw n instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(n,e),n}};return e}const Nf=()=>{},Xc={ok(r){return{ok:!0,value:r}},err(r){return{ok:!1,error:r}}};function rs(r,e){const t=e&&r&&typeof r=="object"&&e in r?r[e]:r;throw new Error(`Unknown switch case ${t}`)}const fn=TO((r,e)=>{if(!r)throw new Error(e||"Assertion Error")}),Lo=TO((r,e)=>{if(r==null)throw new Error(e??"value must be defined");return r});function Rk(){let r,e;const t=new Promise((n,s)=>{r=n,e=s});return Object.assign(t,{resolve:r,reject:e})}function sE(r){return new Promise(e=>setTimeout(e,r))}const uf={Good:"#40C057",Mid:"#FFC078",Poor:"#E03131"},xH=uf.Good;class MO{constructor(){k(this,"startTime",0);k(this,"name","");k(this,"frames",0);k(this,"started",!1);k(this,"frame",null);k(this,"recordFrame",()=>{this.frames++,this.started&&(this.frame=requestAnimationFrame(this.recordFrame))})}start(e){this.name=e,this.frames=0,this.started=!0,this.frame!==null&&cancelAnimationFrame(this.frame),this.frame=requestAnimationFrame(this.recordFrame),this.startTime=performance.now()}stop(){this.started=!1,this.frame!==null&&cancelAnimationFrame(this.frame);const e=(performance.now()-this.startTime)/1e3,t=e===0?0:Math.floor(this.frames/e),n=t>55?uf.Good:t>30?uf.Mid:uf.Poor,s=n===uf.Mid?"black":"white",o=this.name[0].toUpperCase()+this.name.slice(1);console.debug(`%cPerf%c ${o} %c${t}%c fps`,`color: white; background: ${xH};padding: 2px;border-radius: 3px;`,"font-weight: normal",`font-weight: bold; padding: 2px; background: ${n};color: ${s};`,"font-weight: normal")}isStarted(){return this.started}}function Dk(r,e){const t=[];e:for(const n of r){for(const s of t)if(e?e(n,s):n===s)continue e;t.push(n)}return t}function kt(r){return r.filter(e=>e!=null)}function gs(r){return r[r.length-1]}function wH(r,e){let t,n=1/0;for(const s of r){const o=e(s);o<n&&(t=s,n=o)}return t}function CH(r,e){let t,n=-1/0;for(const s of r){const o=e(s);o>n&&(t=s,n=o)}return t}function AO(r,e){if(r===e)return!0;if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(!Object.is(r[t],e[t]))return!1;return!0}function Bo(...r){if(r.length===2){const[e,t]=r;t.addInitializer(function(){fn(Reflect.isExtensible(this),"Cannot bind to a non-extensible class.");const s=e.bind(this),o=Reflect.defineProperty(this,t.name,{value:s,writable:!0,configurable:!0});fn(o,"Cannot bind a non-configurable class method.")})}else{const[e,t,n]=r;if(!n||typeof n.value!="function")throw new TypeError(`Only methods can be decorated with @bind. <${t}> is not a method!`);return{configurable:!0,get(){const s=n.value.bind(this);return Object.defineProperty(this,t,{value:s,configurable:!0,writable:!0}),s}}}}class il{constructor(){k(this,"items",new WeakMap)}get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}}function z0(r,e){let t;const n=(...s)=>(t||(t={},t.promise=new Promise((o,i)=>{t.resolve=o,t.reject=i})),clearTimeout(t.timeout),t.latestArgs=s,t.timeout=setTimeout(()=>{const o=t;t=void 0;try{o.resolve(r(...o.latestArgs))}catch(i){o.reject(i)}},e),t.promise);return n.cancel=()=>{t&&clearTimeout(t.timeout)},n}const ZT=new WeakMap;function Ok(r,e){if(typeof r!="object"||r===null)return;let t=ZT.get(r);t||(t={tags:{},extras:{}},ZT.set(r,t)),e.tags&&(t.tags={...t.tags,...e.tags}),e.extras&&(t.extras={...t.extras,...e.extras})}async function al(r,e){return window.fetch(r,{referrerPolicy:"strict-origin-when-cross-origin",...e})}const Ff=(r,e)=>{const t=new window.Image(r,e);return t.referrerPolicy="strict-origin-when-cross-origin",t};class aa{static async dataUrlToArrayBuffer(e){return al(e).then(function(t){return t.arrayBuffer()})}static async blobToDataUrl(e){return await new Promise((t,n)=>{if(e){const s=new FileReader;s.onload=()=>t(s.result),s.onerror=o=>n(o),s.onabort=o=>n(o),s.readAsDataURL(e)}})}static async blobToText(e){return await new Promise((t,n)=>{if(e){const s=new FileReader;s.onload=()=>t(s.result),s.onerror=o=>n(o),s.onabort=o=>n(o),s.readAsText(e)}})}static rewriteMimeType(e,t){return e.type===t?e:e instanceof File?new File([e],e.name,{type:t}):new Blob([e],{type:t})}}function oE(r){let e=0;for(let t=0;t<r.length;t++)e=(e<<5)-e+r.charCodeAt(t),e|=0;return e+""}function JT(r){const e=new DataView(r);let t=0;for(let n=0;n<e.byteLength;n++)t=(t<<5)-t+e.getUint8(n),t|=0;return t+""}/*!
 * MIT License: https://github.com/ai/nanoid/blob/main/LICENSE
 * Modified code originally from <https://github.com/ai/nanoid>
 * Copyright 2017 Andrey Sitnik <andrey@sitnik.ru>
 *
 * `nanoid` is currently only distributed as an ES module. Some tools (jest, playwright) don't
 * properly support ESM-only code yet, and tldraw itself is distributed as both an ES module and a
 * CommonJS module. By including nanoid here, we can make sure it works well in every environment
 * where tldraw is used. We can also remove some unused features like custom alphabets.
 */const QT=globalThis.crypto,EH="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",kH=128;let $d,gh;function PH(r){!$d||$d.length<r?($d=new Uint8Array(r*kH),QT.getRandomValues($d),gh=0):gh+r>$d.length&&(QT.getRandomValues($d),gh=0),gh+=r}function IH(r=21){PH(r-=0);let e="";for(let t=gh-r;t<gh;t++)e+=EH[$d[t]&63];return e}let _H=IH;function Cn(r){return _H(r)}/*!
 * MIT License: https://github.com/vHeemstra/is-apng/blob/main/license
 * Copyright (c) Philip van Heemstra
 */function TH(r){const e=new Uint8Array(r);if(!e||!(typeof Buffer<"u"&&Buffer.isBuffer(e)||e instanceof Uint8Array)||e.length<16||!(e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10))return!1;function n(o,i,a,l,c=1024){if(!i)return-1;i=new RegExp(i,"g");const u=i.source.length,p=new TextDecoder,f=o.length;if(typeof l>"u"&&(l=f),a>=f||l<=0||a>=l)return-1;o=o.subarray(a,l);let m=-1,v=0,b=0,S="";e:for(;v<o.length;){const C=v+c,E=o.subarray(v,C),T=p.decode(E,{stream:!0}),w=S+T;let M,R=-1;for(;(M=i.exec(w))!==null;){R=M.index-S.length,m=b+R;break e}v=C,b+=T.length;const D=R>-1?R+u:T.length-u;S=T.slice(D)}return m>=0&&(m+=a>=0?a:f+a),m}const s=n(e,"IDAT",12);return s>=12?n(e,"acTL",8,s)>=8:!1}const MH=r=>new Uint8Array(r)[3]===44;/*!
 * MIT License
 * Modified code originally from <https://github.com/qzb/is-animated>
 * Copyright (c) 2016 Józef Sokołowski <j.k.sokolowski@gmail.com>
 */function eM(r,e){let t=0;for(;r[e+t];)t+=r[e+t]+1;return t+1}function AH(r){return new TextDecoder("ascii").decode(r.slice(0,3))==="GIF"}function jH(r){const e=new Uint8Array(r);let t,n,s=0,o=0;if(!AH(r))return!1;for(t=e[10]&128,n=e[10]&7,s+=6,s+=7,s+=t?3*Math.pow(2,n+1):0;o<2&&s<e.length;)switch(e[s]){case 44:o+=1,t=e[s+9]&128,n=e[s+9]&7,s+=10,s+=t?3*Math.pow(2,n+1):0,s+=eM(e,s+1)+1;break;case 33:s+=2,s+=eM(e,s);break;case 59:s=e.length;break;default:s=e.length;break}return o>1}/*!
 * MIT License: https://github.com/alexgorbatchev/crc/blob/master/LICENSE
 * Copyright: 2014 Alex Gorbatchev
 * Code: crc32, https://github.com/alexgorbatchev/crc/blob/master/src/calculators/crc32.ts
 */let iE=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(iE=new Int32Array(iE));const RH=(r,e)=>{let t=~~e^-1;for(let n=0;n<r.length;n++)t=iE[(t^r[n])&255]^t>>>8;return t^-1},tM=4,nM=4;class qa{static isPng(e,t){return e.getUint8(t+0)===137&&e.getUint8(t+1)===80&&e.getUint8(t+2)===78&&e.getUint8(t+3)===71&&e.getUint8(t+4)===13&&e.getUint8(t+5)===10&&e.getUint8(t+6)===26&&e.getUint8(t+7)===10}static getChunkType(e,t){return[String.fromCharCode(e.getUint8(t)),String.fromCharCode(e.getUint8(t+1)),String.fromCharCode(e.getUint8(t+2)),String.fromCharCode(e.getUint8(t+3))].join("")}static readChunks(e,t=0){const n={};if(!qa.isPng(e,t))throw new Error("Not a PNG");for(t+=8;t<=e.buffer.byteLength;){const s=t,o=e.getInt32(t);t+=4;const i=qa.getChunkType(e,t);if(i==="IDAT"&&n[i]){t+=o+tM+nM;continue}if(i==="IEND")break;n[i]={start:s,dataOffset:t+4,size:o},t+=o+tM+nM}return n}static parsePhys(e,t){return{ppux:e.getUint32(t),ppuy:e.getUint32(t+4),unit:e.getUint8(t+4)}}static findChunk(e,t){return qa.readChunks(e)[t]}static setPhysChunk(e,t=1,n){let s=46,o=0;const i=qa.findChunk(e,"pHYs");i&&(s=i.start,o=i.size);const a=qa.findChunk(e,"IDAT");a&&(s=a.start,o=0);const l=new ArrayBuffer(21),c=new DataView(l);c.setUint32(0,9),c.setUint8(4,112),c.setUint8(5,72),c.setUint8(6,89),c.setUint8(7,115);const u=2835.5;c.setInt32(8,u*t),c.setInt32(12,u*t),c.setInt8(16,1);const p=new Uint8Array(l.slice(4,17));c.setInt32(17,RH(p));const f=e.buffer.slice(0,s),m=e.buffer.slice(s+o);return new Blob([f,l,m],n)}}/*!
 * MIT License: https://github.com/sindresorhus/is-webp/blob/main/license
 * Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)
 */function DH(r){return!r||r.length<12?!1:r[8]===87&&r[9]===69&&r[10]===66&&r[11]===80}function OH(r){const e=new Uint8Array(r);return!DH(e)||!e||e.length<21?!1:(e[20]>>1&1)===1}const jO=Object.freeze(["image/svg+xml"]),RO=Object.freeze(["image/jpeg","image/png","image/webp"]),DO=Object.freeze(["image/gif","image/apng","image/avif"]),$0=Object.freeze([...RO,...jO,...DO]),Lk=Object.freeze(["video/mp4","video/webm","video/quicktime"]),LH=[...$0,...Lk].join(",");class ri{static loadVideo(e){return new Promise((t,n)=>{const s=document.createElement("video");s.onloadeddata=()=>t(s),s.onerror=o=>{console.error(o),n(new Error("Could not load video"))},s.crossOrigin="anonymous",s.src=e})}static async getVideoFrameAsDataUrl(e,t=0){const n=Rk();let s=!1;const o=()=>{if(!s)if(e.readyState>=e.HAVE_METADATA)s=!0,e.currentTime=t;else return;if(e.readyState>=e.HAVE_CURRENT_DATA){const a=document.createElement("canvas");a.width=e.videoWidth,a.height=e.videoHeight;const l=a.getContext("2d");if(!l)throw new Error("Could not get 2d context");l.drawImage(e,0,0),n.resolve(a.toDataURL())}},i=a=>{console.error(a),n.reject(new Error("Could not get video frame"))};e.addEventListener("loadedmetadata",o),e.addEventListener("loadeddata",o),e.addEventListener("canplay",o),e.addEventListener("seeked",o),e.addEventListener("error",i),e.addEventListener("stalled",i),o();try{return await n}finally{e.removeEventListener("loadedmetadata",o),e.removeEventListener("loadeddata",o),e.removeEventListener("canplay",o),e.removeEventListener("seeked",o),e.removeEventListener("error",i),e.removeEventListener("stalled",i)}}static loadImage(e){return new Promise((t,n)=>{const s=Ff();s.onload=()=>t(s),s.onerror=o=>{console.error(o),n(new Error("Could not load image"))},s.crossOrigin="anonymous",s.referrerPolicy="strict-origin-when-cross-origin",s.src=e})}static async getVideoSize(e){return ri.usingObjectURL(e,async t=>{const n=await ri.loadVideo(t);return{w:n.videoWidth,h:n.videoHeight}})}static async getImageSize(e){const t=await ri.usingObjectURL(e,ri.loadImage);try{if(e.type==="image/png"){const n=new DataView(await e.arrayBuffer());if(qa.isPng(n,0)){const s=qa.findChunk(n,"pHYs");if(s){const o=qa.parsePhys(n,s.dataOffset);if(o.unit===0&&o.ppux===o.ppuy){const i=Math.max(o.ppux/2834.5,1);return{w:Math.round(t.naturalWidth/i),h:Math.round(t.naturalHeight/i)}}}}}}catch(n){return console.error(n),{w:t.naturalWidth,h:t.naturalHeight}}return{w:t.naturalWidth,h:t.naturalHeight}}static async isAnimated(e){return e.type==="image/gif"?jH(await e.arrayBuffer()):e.type==="image/avif"?MH(await e.arrayBuffer()):e.type==="image/webp"?OH(await e.arrayBuffer()):e.type==="image/apng"?TH(await e.arrayBuffer()):!1}static isAnimatedImageType(e){return DO.includes(e||"")}static isStaticImageType(e){return RO.includes(e||"")}static isVectorImageType(e){return jO.includes(e||"")}static isImageType(e){return $0.includes(e)}static async usingObjectURL(e,t){const n=URL.createObjectURL(e);try{return await t(n)}finally{URL.revokeObjectURL(n)}}}function Gt(r,e,t){return r+(e-r)*t}function ya(r=""){let e=0,t=0,n=0,s=0;function o(){const i=e^e<<11;return e=t,t=n,n=s,s^=(s>>>19^i^i>>>8)>>>0,s/4294967296*2}for(let i=0;i<r.length+64;i++)e^=r.charCodeAt(i)|0,o();return o}function Bh(r,e,t,n=!1){const[s,o]=e,[i,a]=t,l=i+(r-s)/(o-s)*(a-i);return n?i<a?Math.max(Math.min(l,a),i):Math.max(Math.min(l,i),a):l}function ua(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function Ws(r,e){if(ua(r,e))return r[e]}function rM(r){return Object.keys(r)}function ir(r){return Object.values(r)}function Ho(r){return Object.entries(r)}function Nk(r){return Object.fromEntries(r)}function Pf(r,e){const t={};let n=!1;for(const[s,o]of Ho(r))e(s,o)?t[s]=o:n=!0;return n?t:r}function jg(r,e){const t={};for(const[n,s]of Ho(r)){const o=e(n,s);t[n]=o}return t}function OO(r,e){if(r===e)return!0;const t=new Set(Object.keys(r)),n=new Set(Object.keys(e));if(t.size!==n.size)return!1;for(const s of t)if(!n.has(s)||!Object.is(r[s],e[s]))return!1;return!0}function NH(r){const e=FH(r.chars),t=zH(e,r.firstPositive,r.mostPositive,r.mostNegative),n=r.jitterRange??Math.floor(Math.pow(e.length,3)/5),s=$H(n,e.length);return{chars:r.chars,byChar:e.byChar,byCode:e.byCode,length:e.length,first:e.byCode[0],last:e.byCode[e.length-1],firstPositive:t.firstPositive,mostPositive:t.mostPositive,firstNegative:t.firstNegative,mostNegative:t.mostNegative,jitterRange:n,paddingDict:s}}function FH(r){const e={},t={},n=r.length;for(let s=0;s<n;s++){const o=r[s];e[s]=o,t[o]=s}return{byCode:e,byChar:t,length:n}}function zH(r,e,t,n){const s=e?r.byChar[e]:Math.ceil(r.length/2),o=t?r.byChar[t]:r.length-1,i=n?r.byChar[n]:0;if(s===void 0||o===void 0||i===void 0)throw new Error("invalid charSet");if(o-s<3)throw new Error("mostPositive must be at least 3 characters away from neutral");if(s-i<3)throw new Error("mostNegative must be at least 3 characters away from neutral");return{firstPositive:r.byCode[s],mostPositive:r.byCode[o],firstNegative:r.byCode[s-1],mostNegative:r.byCode[i]}}function $H(r,e){const t={};for(let n=0;n<100&&(t[n]=Math.pow(e,n),!(t[n]>r));n++);return t}var Bx=null;function Fk(){return Bx||(Bx=NH({chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",firstPositive:"a",mostPositive:"z",mostNegative:"A"}))}function Vc(r,e,t){const n=t.byChar[r],s=t.byChar[e];return Math.abs(n-s)}function zk(r,e){const t=r[0];if(t>e.mostPositive||t<e.mostNegative)throw new Error("invalid firstChar on key");return t===e.mostPositive?Vc(t,e.firstPositive,e)+1+Rv(r.slice(1),"positive",e):t===e.mostNegative?Vc(t,e.firstNegative,e)+1+Rv(r.slice(1),"negative",e):t>=e.firstPositive?Vc(t,e.firstPositive,e)+2:Vc(t,e.firstNegative,e)+2}function Rv(r,e,t){const n=r[0];if(n>t.mostPositive||n<t.mostNegative)throw new Error("invalid firstChar on key");return n===t.mostPositive&&e==="positive"?Vc(n,t.mostNegative,t)+1+Rv(r.slice(1),e,t):n===t.mostNegative&&e==="negative"?Vc(n,t.mostPositive,t)+1+Rv(r.slice(1),e,t):e==="positive"?Vc(n,t.mostNegative,t)+2:Vc(n,t.mostPositive,t)+2}function B0(r,e,t,n,s){const o=Math.max(r.length,e.length);return t==="start"?[r.padStart(o,n),e.padStart(o,n)]:[r.padEnd(o,n),e.padEnd(o,n)]}function BH(r,e,t){let[n,s]=B0(r,e,"end",t.first),o=aE(n,s,t);o===1&&(n=n.padEnd(n.length+1,t.first),o=t.length);const i=FO(Math.floor(o/2),t);return $k(n,i,t)}function aE(r,e,t){const[n,s]=B0(r,e,"end",t.first).sort(),o=LO(s,n,t);return UH(o,t)}function $k(r,e,t){const n=t.length,[s,o]=B0(r,e,"start",t.first),i=[];let a=0;for(let l=s.length-1;l>=0;l--){const c=t.byChar[s[l]],u=t.byChar[o[l]],p=c+u+a;a=Math.floor(p/n);const f=p%n;i.unshift(t.byCode[f])}return a>0&&i.unshift(t.byCode[a]),i.join("")}function LO(r,e,t){const n=t.length,[s,o]=B0(r,e,"start",t.first),i=[];let a=0;for(let l=s.length-1;l>=0;l--){let c=t.byChar[s[l]];const u=t.byChar[o[l]]+a;c<u?(a=1,c+=n):a=0;const p=c-u;i.unshift(t.byCode[p])}if(a>0)throw new Error("Subtraction result is negative. Ensure a is greater than or equal to b.");for(;i.length>1&&i[0]===t.byCode[0];)i.shift();return i.join("")}function NO(r,e){return $k(r,e.byCode[1],e)}function lE(r,e){return LO(r,e.byCode[1],e)}function FO(r,e){if(r===0)return e.byCode[0];let t="";const n=e.length;for(;r>0;)t=e.byCode[r%n]+t,r=Math.floor(r/n);return t}function UH(r,e){let t=0;const n=r.length,s=e.length;for(let o=0;o<n;o++)t+=e.byChar[r[o]]*Math.pow(s,n-o-1);return t}function HH(r){return r.firstPositive+r.byCode[0]}function GH(r,e){return zk(r,e)===r.length}function sM(r,e){Dv(r,e)}function Dv(r,e){const t=BO(r,e),n=zk(t,e);if(n>r.length)throw new Error("invalid order key length: "+r);return r.slice(0,n)}function zO(r,e){if(!GH(r,e))throw new Error("invalid integer length: "+r)}function $O(r,e){zO(r,e);const[t,n]=UO(r,e);if(n.split("").some(i=>i!==e.byCode[e.length-1])){const i=NO(n,e);return t+i}const o=KH(t,e);return HO(o,"lower",e)}function WH(r,e){zO(r,e);const[t,n]=UO(r,e);if(n.split("").some(i=>i!==e.byCode[0])){const i=lE(n,e);return t+i}const o=VH(t,e);return HO(o,"upper",e)}function BO(r,e){let t=0;if(r[0]===e.mostPositive)for(;r[t]===e.mostPositive;)t=t+1;if(r[0]===e.mostNegative)for(;r[t]===e.mostNegative;)t=t+1;return r.slice(0,t+1)}function UO(r,e){const t=BO(r,e),n=r.slice(t.length);return[t,n]}function KH(r,e){const t=r>=e.firstPositive,n=NO(r,e),s=r[r.length-1]===e.mostPositive,o=n[n.length-1]===e.mostPositive;return t&&o?n+e.mostNegative:!t&&s?r.slice(0,r.length-1):n}function VH(r,e){const t=r>=e.firstPositive,n=r[r.length-1]===e.mostNegative;if(t&&n){const s=r.slice(0,r.length-1);return lE(s,e)}return!t&&n?r+e.mostPositive:lE(r,e)}function HO(r,e,t){const n=zk(r,t),s=e==="upper"?t.byCode[t.length-1]:t.byCode[0];return r+s.repeat(n-r.length)}function GO(r,e){const t=FO(Math.floor(Math.random()*e.jitterRange),e);return $k(r,t,e)}function qH(r,e,t){const n=r.padEnd(r.length+e,t.first);return GO(n,t)}function YH(r,e,t){const n=Dv(r,t),s=$O(n,t);let o=0;if(e!==null){const a=aE(r,e,t);a<t.jitterRange+1&&(o=Math.max(o,oM(a,t)))}const i=aE(r,s,t);return i<t.jitterRange+1&&(o=Math.max(o,oM(i,t))),o}function oM(r,e){const t=e.jitterRange-r,n=Object.entries(e.paddingDict).find(([s,o])=>o>t);return n?parseInt(n[0]):0}function XH(r,e,t=Fk()){if(r!==null&&sM(r,t),e!==null&&sM(e,t),r===null&&e===null)return HH(t);if(r===null){const n=Dv(e,t);return WH(n,t)}if(e===null){const n=Dv(r,t);return $O(n,t)}if(r>=e)throw new Error(r+" >= "+e);return BH(r,e,t)}function WO(r,e,t=Fk()){const n=XH(r,e,t),s=YH(n,e,t);return s?qH(n,s,t):GO(n,t)}function KO(r,e,t,n=Fk()){return ZH(r,e,t,n,WO,KO)}function ZH(r,e,t,n,s,o){if(t===0)return[];if(t===1)return[s(r,e,n)];if(e==null){let l=s(r,e,n);const c=[l];for(let u=0;u<t-1;u++)l=s(l,e,n),c.push(l);return c}if(r==null){let l=s(r,e,n);const c=[l];for(let u=0;u<t-1;u++)l=s(r,l,n),c.push(l);return c.reverse(),c}const i=Math.floor(t/2),a=s(r,e,n);return[...o(r,a,i,n),a,...o(a,e,t-i-1,n)]}const Qh=KO,VO="a0";function JH(r){try{WO(r,null)}catch{throw new Error("invalid index: "+r)}}function Uh(r,e,t){return Qh(r??null,e??null,t)}function Ux(r,e){return Qh(r??null,null,e)}function zf(r,e){return Qh(r??null,e??null,1)[0]}function Za(r=null){return Qh(r,null,1)[0]}function QH(r=null){return Qh(null,r,1)[0]}function $f(r,e="a1"){return[e,...Qh(e,null,r)]}function Hs(r,e){return r.index<e.index?-1:r.index>e.index?1:0}function eG(r,e){return r.id>e.id?1:-1}function Bk(r){try{return localStorage.getItem(r)}catch{return null}}function Uk(r,e){try{localStorage.setItem(r,e)}catch{}}function tG(){try{localStorage.clear()}catch{}}function qO(r){try{return sessionStorage.getItem(r)}catch{return null}}function Hk(r,e){try{sessionStorage.setItem(r,e)}catch{}}function YO(r){try{sessionStorage.removeItem(r)}catch{}}function nG(){try{sessionStorage.clear()}catch{}}const rG=()=>typeof process<"u"&&!1,mh=[],sG=60,Vy=Math.ceil(1e3/sG);let qp,Hx=0,cE=0;const oG=()=>{const r=mh.splice(0,mh.length);for(const e of r)e()};function XO(){if(qp)return;const r=Date.now(),e=r-cE;if(Hx+e<Vy){qp=requestAnimationFrame(()=>{qp=void 0,XO()});return}qp=requestAnimationFrame(()=>{qp=void 0,cE=r,Hx=Math.min(Hx+e-Vy,Vy*10),oG()})}let iM=!1;function ZO(r){return rG()?(r(),()=>{}):(mh.includes(r)||(mh.push(r),iM||(iM=!0,cE=Date.now()-Vy-1),XO()),()=>{const e=mh.indexOf(r);e>-1&&mh.splice(e,1)})}class iG{constructor(){k(this,"timeouts",new Map);k(this,"intervals",new Map);k(this,"rafs",new Map);this.setTimeout=this.setTimeout.bind(this),this.setInterval=this.setInterval.bind(this),this.requestAnimationFrame=this.requestAnimationFrame.bind(this),this.dispose=this.dispose.bind(this)}setTimeout(e,t,n,...s){const o=window.setTimeout(t,n,s),i=this.timeouts.get(e)??[];return this.timeouts.set(e,[...i,o]),o}setInterval(e,t,n,...s){const o=window.setInterval(t,n,s),i=this.intervals.get(e)??[];return this.intervals.set(e,[...i,o]),o}requestAnimationFrame(e,t){const n=window.requestAnimationFrame(t),s=this.rafs.get(e)??[];return this.rafs.set(e,[...s,n]),n}dispose(e){var t,n,s;(t=this.timeouts.get(e))==null||t.forEach(o=>clearTimeout(o)),(n=this.intervals.get(e))==null||n.forEach(o=>clearInterval(o)),(s=this.rafs.get(e))==null||s.forEach(o=>cancelAnimationFrame(o)),this.timeouts.delete(e),this.intervals.delete(e),this.rafs.delete(e)}disposeAll(){for(const e of this.timeouts.keys())this.dispose(e)}forContext(e){return{setTimeout:(t,n,...s)=>this.setTimeout(e,t,n,s),setInterval:(t,n,...s)=>this.setInterval(e,t,n,s),requestAnimationFrame:t=>this.requestAnimationFrame(e,t),dispose:()=>this.dispose(e)}}}const vt=(r,e)=>{try{return new URL(r,e)}catch{return}};function aG(r){return r!==void 0}function lG(){return typeof globalThis<"u"&&globalThis.structuredClone?[globalThis.structuredClone,!0]:typeof global<"u"&&global.structuredClone?[global.structuredClone,!0]:typeof window<"u"&&window.structuredClone?[window.structuredClone,!0]:[r=>r&&JSON.parse(JSON.stringify(r)),!1]}const JO=lG(),Kn=JO[0];JO[1];const cG=Object.getPrototypeOf(Kn({}));dd("@tldraw/utils","3.7.0","esm");var aM={},Yp,lM;function ao(){if(lM)return Yp;lM=1;var r=function(e){return e&&e.Math===Math&&e};return Yp=r(typeof globalThis=="object"&&globalThis)||r(typeof window=="object"&&window)||r(typeof self=="object"&&self)||r(typeof $o=="object"&&$o)||r(typeof Yp=="object"&&Yp)||function(){return this}()||Function("return this")(),Yp}var Gx={},Wx,cM;function lo(){return cM||(cM=1,Wx=function(r){try{return!!r()}catch{return!0}}),Wx}var Kx,dM;function ud(){if(dM)return Kx;dM=1;var r=lo();return Kx=!r(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Kx}var Vx,uM;function U0(){if(uM)return Vx;uM=1;var r=lo();return Vx=!r(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),Vx}var qx,hM;function tc(){if(hM)return qx;hM=1;var r=U0(),e=Function.prototype.call;return qx=r?e.bind(e):function(){return e.apply(e,arguments)},qx}var Yx={},pM;function dG(){if(pM)return Yx;pM=1;var r={}.propertyIsEnumerable,e=Object.getOwnPropertyDescriptor,t=e&&!r.call({1:2},1);return Yx.f=t?function(s){var o=e(this,s);return!!o&&o.enumerable}:r,Yx}var Xx,fM;function QO(){return fM||(fM=1,Xx=function(r,e){return{enumerable:!(r&1),configurable:!(r&2),writable:!(r&4),value:e}}),Xx}var Zx,gM;function os(){if(gM)return Zx;gM=1;var r=U0(),e=Function.prototype,t=e.call,n=r&&e.bind.bind(t,t);return Zx=r?n:function(s){return function(){return t.apply(s,arguments)}},Zx}var Jx,mM;function ep(){if(mM)return Jx;mM=1;var r=os(),e=r({}.toString),t=r("".slice);return Jx=function(n){return t(e(n),8,-1)},Jx}var Qx,yM;function uG(){if(yM)return Qx;yM=1;var r=os(),e=lo(),t=ep(),n=Object,s=r("".split);return Qx=e(function(){return!n("z").propertyIsEnumerable(0)})?function(o){return t(o)==="String"?s(o,""):n(o)}:n,Qx}var ew,vM;function H0(){return vM||(vM=1,ew=function(r){return r==null}),ew}var tw,bM;function tp(){if(bM)return tw;bM=1;var r=H0(),e=TypeError;return tw=function(t){if(r(t))throw new e("Can't call method on "+t);return t},tw}var nw,SM;function G0(){if(SM)return nw;SM=1;var r=uG(),e=tp();return nw=function(t){return r(e(t))},nw}var rw,xM;function co(){if(xM)return rw;xM=1;var r=typeof document=="object"&&document.all;return rw=typeof r>"u"&&r!==void 0?function(e){return typeof e=="function"||e===r}:function(e){return typeof e=="function"},rw}var sw,wM;function xu(){if(wM)return sw;wM=1;var r=co();return sw=function(e){return typeof e=="object"?e!==null:r(e)},sw}var ow,CM;function W0(){if(CM)return ow;CM=1;var r=ao(),e=co(),t=function(n){return e(n)?n:void 0};return ow=function(n,s){return arguments.length<2?t(r[n]):r[n]&&r[n][s]},ow}var iw,EM;function e3(){if(EM)return iw;EM=1;var r=os();return iw=r({}.isPrototypeOf),iw}var aw,kM;function hG(){if(kM)return aw;kM=1;var r=ao(),e=r.navigator,t=e&&e.userAgent;return aw=t?String(t):"",aw}var lw,PM;function pG(){if(PM)return lw;PM=1;var r=ao(),e=hG(),t=r.process,n=r.Deno,s=t&&t.versions||n&&n.version,o=s&&s.v8,i,a;return o&&(i=o.split("."),a=i[0]>0&&i[0]<4?1:+(i[0]+i[1])),!a&&e&&(i=e.match(/Edge\/(\d+)/),(!i||i[1]>=74)&&(i=e.match(/Chrome\/(\d+)/),i&&(a=+i[1]))),lw=a,lw}var cw,IM;function t3(){if(IM)return cw;IM=1;var r=pG(),e=lo(),t=ao(),n=t.String;return cw=!!Object.getOwnPropertySymbols&&!e(function(){var s=Symbol("symbol detection");return!n(s)||!(Object(s)instanceof Symbol)||!Symbol.sham&&r&&r<41}),cw}var dw,_M;function n3(){if(_M)return dw;_M=1;var r=t3();return dw=r&&!Symbol.sham&&typeof Symbol.iterator=="symbol",dw}var uw,TM;function r3(){if(TM)return uw;TM=1;var r=W0(),e=co(),t=e3(),n=n3(),s=Object;return uw=n?function(o){return typeof o=="symbol"}:function(o){var i=r("Symbol");return e(i)&&t(i.prototype,s(o))},uw}var hw,MM;function fG(){if(MM)return hw;MM=1;var r=String;return hw=function(e){try{return r(e)}catch{return"Object"}},hw}var pw,AM;function Gk(){if(AM)return pw;AM=1;var r=co(),e=fG(),t=TypeError;return pw=function(n){if(r(n))return n;throw new t(e(n)+" is not a function")},pw}var fw,jM;function Wk(){if(jM)return fw;jM=1;var r=Gk(),e=H0();return fw=function(t,n){var s=t[n];return e(s)?void 0:r(s)},fw}var gw,RM;function gG(){if(RM)return gw;RM=1;var r=tc(),e=co(),t=xu(),n=TypeError;return gw=function(s,o){var i,a;if(o==="string"&&e(i=s.toString)&&!t(a=r(i,s))||e(i=s.valueOf)&&!t(a=r(i,s))||o!=="string"&&e(i=s.toString)&&!t(a=r(i,s)))return a;throw new n("Can't convert object to primitive value")},gw}var mw={exports:{}},yw,DM;function s3(){return DM||(DM=1,yw=!1),yw}var vw,OM;function Kk(){if(OM)return vw;OM=1;var r=ao(),e=Object.defineProperty;return vw=function(t,n){try{e(r,t,{value:n,configurable:!0,writable:!0})}catch{r[t]=n}return n},vw}var LM;function Vk(){if(LM)return mw.exports;LM=1;var r=s3(),e=ao(),t=Kk(),n="__core-js_shared__",s=mw.exports=e[n]||t(n,{});return(s.versions||(s.versions=[])).push({version:"3.39.0",mode:r?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.39.0/LICENSE",source:"https://github.com/zloirock/core-js"}),mw.exports}var bw,NM;function qk(){if(NM)return bw;NM=1;var r=Vk();return bw=function(e,t){return r[e]||(r[e]=t||{})},bw}var Sw,FM;function Rg(){if(FM)return Sw;FM=1;var r=tp(),e=Object;return Sw=function(t){return e(r(t))},Sw}var xw,zM;function hd(){if(zM)return xw;zM=1;var r=os(),e=Rg(),t=r({}.hasOwnProperty);return xw=Object.hasOwn||function(s,o){return t(e(s),o)},xw}var ww,$M;function o3(){if($M)return ww;$M=1;var r=os(),e=0,t=Math.random(),n=r(1 .toString);return ww=function(s){return"Symbol("+(s===void 0?"":s)+")_"+n(++e+t,36)},ww}var Cw,BM;function nc(){if(BM)return Cw;BM=1;var r=ao(),e=qk(),t=hd(),n=o3(),s=t3(),o=n3(),i=r.Symbol,a=e("wks"),l=o?i.for||i:i&&i.withoutSetter||n;return Cw=function(c){return t(a,c)||(a[c]=s&&t(i,c)?i[c]:l("Symbol."+c)),a[c]},Cw}var Ew,UM;function mG(){if(UM)return Ew;UM=1;var r=tc(),e=xu(),t=r3(),n=Wk(),s=gG(),o=nc(),i=TypeError,a=o("toPrimitive");return Ew=function(l,c){if(!e(l)||t(l))return l;var u=n(l,a),p;if(u){if(c===void 0&&(c="default"),p=r(u,l,c),!e(p)||t(p))return p;throw new i("Can't convert object to primitive value")}return c===void 0&&(c="number"),s(l,c)},Ew}var kw,HM;function i3(){if(HM)return kw;HM=1;var r=mG(),e=r3();return kw=function(t){var n=r(t,"string");return e(n)?n:n+""},kw}var Pw,GM;function a3(){if(GM)return Pw;GM=1;var r=ao(),e=xu(),t=r.document,n=e(t)&&e(t.createElement);return Pw=function(s){return n?t.createElement(s):{}},Pw}var Iw,WM;function l3(){if(WM)return Iw;WM=1;var r=ud(),e=lo(),t=a3();return Iw=!r&&!e(function(){return Object.defineProperty(t("div"),"a",{get:function(){return 7}}).a!==7}),Iw}var KM;function c3(){if(KM)return Gx;KM=1;var r=ud(),e=tc(),t=dG(),n=QO(),s=G0(),o=i3(),i=hd(),a=l3(),l=Object.getOwnPropertyDescriptor;return Gx.f=r?l:function(u,p){if(u=s(u),p=o(p),a)try{return l(u,p)}catch{}if(i(u,p))return n(!e(t.f,u,p),u[p])},Gx}var _w={},Tw,VM;function d3(){if(VM)return Tw;VM=1;var r=ud(),e=lo();return Tw=r&&e(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Tw}var Mw,qM;function wu(){if(qM)return Mw;qM=1;var r=xu(),e=String,t=TypeError;return Mw=function(n){if(r(n))return n;throw new t(e(n)+" is not an object")},Mw}var YM;function Dg(){if(YM)return _w;YM=1;var r=ud(),e=l3(),t=d3(),n=wu(),s=i3(),o=TypeError,i=Object.defineProperty,a=Object.getOwnPropertyDescriptor,l="enumerable",c="configurable",u="writable";return _w.f=r?t?function(f,m,v){if(n(f),m=s(m),n(v),typeof f=="function"&&m==="prototype"&&"value"in v&&u in v&&!v[u]){var b=a(f,m);b&&b[u]&&(f[m]=v.value,v={configurable:c in v?v[c]:b[c],enumerable:l in v?v[l]:b[l],writable:!1})}return i(f,m,v)}:i:function(f,m,v){if(n(f),m=s(m),n(v),e)try{return i(f,m,v)}catch{}if("get"in v||"set"in v)throw new o("Accessors not supported");return"value"in v&&(f[m]=v.value),f},_w}var Aw,XM;function Yk(){if(XM)return Aw;XM=1;var r=ud(),e=Dg(),t=QO();return Aw=r?function(n,s,o){return e.f(n,s,t(1,o))}:function(n,s,o){return n[s]=o,n},Aw}var jw={exports:{}},Rw,ZM;function yG(){if(ZM)return Rw;ZM=1;var r=ud(),e=hd(),t=Function.prototype,n=r&&Object.getOwnPropertyDescriptor,s=e(t,"name"),o=s&&(function(){}).name==="something",i=s&&(!r||r&&n(t,"name").configurable);return Rw={EXISTS:s,PROPER:o,CONFIGURABLE:i},Rw}var Dw,JM;function u3(){if(JM)return Dw;JM=1;var r=os(),e=co(),t=Vk(),n=r(Function.toString);return e(t.inspectSource)||(t.inspectSource=function(s){return n(s)}),Dw=t.inspectSource,Dw}var Ow,QM;function vG(){if(QM)return Ow;QM=1;var r=ao(),e=co(),t=r.WeakMap;return Ow=e(t)&&/native code/.test(String(t)),Ow}var Lw,eA;function h3(){if(eA)return Lw;eA=1;var r=qk(),e=o3(),t=r("keys");return Lw=function(n){return t[n]||(t[n]=e(n))},Lw}var Nw,tA;function Xk(){return tA||(tA=1,Nw={}),Nw}var Fw,nA;function p3(){if(nA)return Fw;nA=1;var r=vG(),e=ao(),t=xu(),n=Yk(),s=hd(),o=Vk(),i=h3(),a=Xk(),l="Object already initialized",c=e.TypeError,u=e.WeakMap,p,f,m,v=function(E){return m(E)?f(E):p(E,{})},b=function(E){return function(T){var w;if(!t(T)||(w=f(T)).type!==E)throw new c("Incompatible receiver, "+E+" required");return w}};if(r||o.state){var S=o.state||(o.state=new u);S.get=S.get,S.has=S.has,S.set=S.set,p=function(E,T){if(S.has(E))throw new c(l);return T.facade=E,S.set(E,T),T},f=function(E){return S.get(E)||{}},m=function(E){return S.has(E)}}else{var C=i("state");a[C]=!0,p=function(E,T){if(s(E,C))throw new c(l);return T.facade=E,n(E,C,T),T},f=function(E){return s(E,C)?E[C]:{}},m=function(E){return s(E,C)}}return Fw={set:p,get:f,has:m,enforce:v,getterFor:b},Fw}var rA;function bG(){if(rA)return jw.exports;rA=1;var r=os(),e=lo(),t=co(),n=hd(),s=ud(),o=yG().CONFIGURABLE,i=u3(),a=p3(),l=a.enforce,c=a.get,u=String,p=Object.defineProperty,f=r("".slice),m=r("".replace),v=r([].join),b=s&&!e(function(){return p(function(){},"length",{value:8}).length!==8}),S=String(String).split("String"),C=jw.exports=function(E,T,w){f(u(T),0,7)==="Symbol("&&(T="["+m(u(T),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),w&&w.getter&&(T="get "+T),w&&w.setter&&(T="set "+T),(!n(E,"name")||o&&E.name!==T)&&(s?p(E,"name",{value:T,configurable:!0}):E.name=T),b&&w&&n(w,"arity")&&E.length!==w.arity&&p(E,"length",{value:w.arity});try{w&&n(w,"constructor")&&w.constructor?s&&p(E,"prototype",{writable:!1}):E.prototype&&(E.prototype=void 0)}catch{}var M=l(E);return n(M,"source")||(M.source=v(S,typeof T=="string"?T:"")),E};return Function.prototype.toString=C(function(){return t(this)&&c(this).source||i(this)},"toString"),jw.exports}var zw,sA;function f3(){if(sA)return zw;sA=1;var r=co(),e=Dg(),t=bG(),n=Kk();return zw=function(s,o,i,a){a||(a={});var l=a.enumerable,c=a.name!==void 0?a.name:o;if(r(i)&&t(i,c,a),a.global)l?s[o]=i:n(o,i);else{try{a.unsafe?s[o]&&(l=!0):delete s[o]}catch{}l?s[o]=i:e.f(s,o,{value:i,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return s},zw}var $w={},Bw,oA;function SG(){if(oA)return Bw;oA=1;var r=Math.ceil,e=Math.floor;return Bw=Math.trunc||function(n){var s=+n;return(s>0?e:r)(s)},Bw}var Uw,iA;function Cu(){if(iA)return Uw;iA=1;var r=SG();return Uw=function(e){var t=+e;return t!==t||t===0?0:r(t)},Uw}var Hw,aA;function xG(){if(aA)return Hw;aA=1;var r=Cu(),e=Math.max,t=Math.min;return Hw=function(n,s){var o=r(n);return o<0?e(o+s,0):t(o,s)},Hw}var Gw,lA;function g3(){if(lA)return Gw;lA=1;var r=Cu(),e=Math.min;return Gw=function(t){var n=r(t);return n>0?e(n,9007199254740991):0},Gw}var Ww,cA;function Og(){if(cA)return Ww;cA=1;var r=g3();return Ww=function(e){return r(e.length)},Ww}var Kw,dA;function wG(){if(dA)return Kw;dA=1;var r=G0(),e=xG(),t=Og(),n=function(s){return function(o,i,a){var l=r(o),c=t(l);if(c===0)return!s&&-1;var u=e(a,c),p;if(s&&i!==i){for(;c>u;)if(p=l[u++],p!==p)return!0}else for(;c>u;u++)if((s||u in l)&&l[u]===i)return s||u||0;return!s&&-1}};return Kw={includes:n(!0),indexOf:n(!1)},Kw}var Vw,uA;function m3(){if(uA)return Vw;uA=1;var r=os(),e=hd(),t=G0(),n=wG().indexOf,s=Xk(),o=r([].push);return Vw=function(i,a){var l=t(i),c=0,u=[],p;for(p in l)!e(s,p)&&e(l,p)&&o(u,p);for(;a.length>c;)e(l,p=a[c++])&&(~n(u,p)||o(u,p));return u},Vw}var qw,hA;function Zk(){return hA||(hA=1,qw=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),qw}var pA;function CG(){if(pA)return $w;pA=1;var r=m3(),e=Zk(),t=e.concat("length","prototype");return $w.f=Object.getOwnPropertyNames||function(s){return r(s,t)},$w}var Yw={},fA;function EG(){return fA||(fA=1,Yw.f=Object.getOwnPropertySymbols),Yw}var Xw,gA;function kG(){if(gA)return Xw;gA=1;var r=W0(),e=os(),t=CG(),n=EG(),s=wu(),o=e([].concat);return Xw=r("Reflect","ownKeys")||function(a){var l=t.f(s(a)),c=n.f;return c?o(l,c(a)):l},Xw}var Zw,mA;function PG(){if(mA)return Zw;mA=1;var r=hd(),e=kG(),t=c3(),n=Dg();return Zw=function(s,o,i){for(var a=e(o),l=n.f,c=t.f,u=0;u<a.length;u++){var p=a[u];!r(s,p)&&!(i&&r(i,p))&&l(s,p,c(o,p))}},Zw}var Jw,yA;function IG(){if(yA)return Jw;yA=1;var r=lo(),e=co(),t=/#|\.prototype\./,n=function(l,c){var u=o[s(l)];return u===a?!0:u===i?!1:e(c)?r(c):!!c},s=n.normalize=function(l){return String(l).replace(t,".").toLowerCase()},o=n.data={},i=n.NATIVE="N",a=n.POLYFILL="P";return Jw=n,Jw}var Qw,vA;function np(){if(vA)return Qw;vA=1;var r=ao(),e=c3().f,t=Yk(),n=f3(),s=Kk(),o=PG(),i=IG();return Qw=function(a,l){var c=a.target,u=a.global,p=a.stat,f,m,v,b,S,C;if(u?m=r:p?m=r[c]||s(c,{}):m=r[c]&&r[c].prototype,m)for(v in l){if(S=l[v],a.dontCallGetSet?(C=e(m,v),b=C&&C.value):b=m[v],f=i(u?v:c+(p?".":"#")+v,a.forced),!f&&b!==void 0){if(typeof S==typeof b)continue;o(S,b)}(a.sham||b&&b.sham)&&t(S,"sham",!0),n(m,v,S,a)}},Qw}var e1={},t1,bA;function _G(){if(bA)return t1;bA=1;var r=m3(),e=Zk();return t1=Object.keys||function(n){return r(n,e)},t1}var SA;function TG(){if(SA)return e1;SA=1;var r=ud(),e=d3(),t=Dg(),n=wu(),s=G0(),o=_G();return e1.f=r&&!e?Object.defineProperties:function(a,l){n(a);for(var c=s(l),u=o(l),p=u.length,f=0,m;p>f;)t.f(a,m=u[f++],c[m]);return a},e1}var n1,xA;function MG(){if(xA)return n1;xA=1;var r=W0();return n1=r("document","documentElement"),n1}var r1,wA;function y3(){if(wA)return r1;wA=1;var r=wu(),e=TG(),t=Zk(),n=Xk(),s=MG(),o=a3(),i=h3(),a=">",l="<",c="prototype",u="script",p=i("IE_PROTO"),f=function(){},m=function(E){return l+u+a+E+l+"/"+u+a},v=function(E){E.write(m("")),E.close();var T=E.parentWindow.Object;return E=null,T},b=function(){var E=o("iframe"),T="java"+u+":",w;return E.style.display="none",s.appendChild(E),E.src=String(T),w=E.contentWindow.document,w.open(),w.write(m("document.F=Object")),w.close(),w.F},S,C=function(){try{S=new ActiveXObject("htmlfile")}catch{}C=typeof document<"u"?document.domain&&S?v(S):b():v(S);for(var E=t.length;E--;)delete C[c][t[E]];return C()};return n[p]=!0,r1=Object.create||function(T,w){var M;return T!==null?(f[c]=r(T),M=new f,f[c]=null,M[p]=T):M=C(),w===void 0?M:e.f(M,w)},r1}var s1,CA;function Jk(){if(CA)return s1;CA=1;var r=nc(),e=y3(),t=Dg().f,n=r("unscopables"),s=Array.prototype;return s[n]===void 0&&t(s,n,{configurable:!0,value:e(null)}),s1=function(o){s[n][o]=!0},s1}var EA;function AG(){if(EA)return aM;EA=1;var r=np(),e=Rg(),t=Og(),n=Cu(),s=Jk();return r({target:"Array",proto:!0},{at:function(i){var a=e(this),l=t(a),c=n(i),u=c>=0?c:l+c;return u<0||u>=l?void 0:a[u]}}),s("at"),aM}var o1,kA;function Lg(){if(kA)return o1;kA=1;var r=ao(),e=os();return o1=function(t,n){return e(r[t].prototype[n])},o1}var i1,PA;function jG(){if(PA)return i1;PA=1,AG();var r=Lg();return i1=r("Array","at"),i1}var a1,IA;function RG(){if(IA)return a1;IA=1;var r=jG();return a1=r,a1}RG();var _A={},l1,TA;function v3(){if(TA)return l1;TA=1;var r=ep();return l1=Array.isArray||function(t){return r(t)==="Array"},l1}var c1,MA;function DG(){if(MA)return c1;MA=1;var r=TypeError,e=9007199254740991;return c1=function(t){if(t>e)throw r("Maximum allowed index exceeded");return t},c1}var d1,AA;function OG(){if(AA)return d1;AA=1;var r=ep(),e=os();return d1=function(t){if(r(t)==="Function")return e(t)},d1}var u1,jA;function LG(){if(jA)return u1;jA=1;var r=OG(),e=Gk(),t=U0(),n=r(r.bind);return u1=function(s,o){return e(s),o===void 0?s:t?n(s,o):function(){return s.apply(o,arguments)}},u1}var h1,RA;function b3(){if(RA)return h1;RA=1;var r=v3(),e=Og(),t=DG(),n=LG(),s=function(o,i,a,l,c,u,p,f){for(var m=c,v=0,b=p?n(p,f):!1,S,C;v<l;)v in a&&(S=b?b(a[v],v,i):a[v],u>0&&r(S)?(C=e(S),m=s(o,i,S,C,m,u-1)-1):(t(m+1),o[m]=S),m++),v++;return m};return h1=s,h1}var p1,DA;function NG(){if(DA)return p1;DA=1;var r=nc(),e=r("toStringTag"),t={};return t[e]="z",p1=String(t)==="[object z]",p1}var f1,OA;function S3(){if(OA)return f1;OA=1;var r=NG(),e=co(),t=ep(),n=nc(),s=n("toStringTag"),o=Object,i=t(function(){return arguments}())==="Arguments",a=function(l,c){try{return l[c]}catch{}};return f1=r?t:function(l){var c,u,p;return l===void 0?"Undefined":l===null?"Null":typeof(u=a(c=o(l),s))=="string"?u:i?t(c):(p=t(c))==="Object"&&e(c.callee)?"Arguments":p},f1}var g1,LA;function FG(){if(LA)return g1;LA=1;var r=os(),e=lo(),t=co(),n=S3(),s=W0(),o=u3(),i=function(){},a=s("Reflect","construct"),l=/^\s*(?:class|function)\b/,c=r(l.exec),u=!l.test(i),p=function(v){if(!t(v))return!1;try{return a(i,[],v),!0}catch{return!1}},f=function(v){if(!t(v))return!1;switch(n(v)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return u||!!c(l,o(v))}catch{return!0}};return f.sham=!0,g1=!a||e(function(){var m;return p(p.call)||!p(Object)||!p(function(){m=!0})||m})?f:p,g1}var m1,NA;function zG(){if(NA)return m1;NA=1;var r=v3(),e=FG(),t=xu(),n=nc(),s=n("species"),o=Array;return m1=function(i){var a;return r(i)&&(a=i.constructor,e(a)&&(a===o||r(a.prototype))?a=void 0:t(a)&&(a=a[s],a===null&&(a=void 0))),a===void 0?o:a},m1}var y1,FA;function x3(){if(FA)return y1;FA=1;var r=zG();return y1=function(e,t){return new(r(e))(t===0?0:t)},y1}var zA;function $G(){if(zA)return _A;zA=1;var r=np(),e=b3(),t=Gk(),n=Rg(),s=Og(),o=x3();return r({target:"Array",proto:!0},{flatMap:function(a){var l=n(this),c=s(l),u;return t(a),u=o(l,0),u.length=e(u,l,l,c,0,1,a,arguments.length>1?arguments[1]:void 0),u}}),_A}var $A={},BA;function BG(){if(BA)return $A;BA=1;var r=Jk();return r("flatMap"),$A}var v1,UA;function UG(){if(UA)return v1;UA=1,$G(),BG();var r=Lg();return v1=r("Array","flatMap"),v1}var b1,HA;function HG(){if(HA)return b1;HA=1;var r=UG();return b1=r,b1}HG();var GA={},WA;function GG(){if(WA)return GA;WA=1;var r=np(),e=b3(),t=Rg(),n=Og(),s=Cu(),o=x3();return r({target:"Array",proto:!0},{flat:function(){var a=arguments.length?arguments[0]:void 0,l=t(this),c=n(l),u=o(l,0);return u.length=e(u,l,l,c,0,a===void 0?1:s(a)),u}}),GA}var KA={},VA;function WG(){if(VA)return KA;VA=1;var r=Jk();return r("flat"),KA}var S1,qA;function KG(){if(qA)return S1;qA=1,GG(),WG();var r=Lg();return S1=r("Array","flat"),S1}var x1,YA;function VG(){if(YA)return x1;YA=1;var r=KG();return x1=r,x1}VG();var XA={},w1,ZA;function Ng(){if(ZA)return w1;ZA=1;var r=S3(),e=String;return w1=function(t){if(r(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return e(t)},w1}var JA;function qG(){if(JA)return XA;JA=1;var r=np(),e=os(),t=tp(),n=Cu(),s=Ng(),o=lo(),i=e("".charAt),a=o(function(){return"𠮷".at(-2)!=="\uD842"});return r({target:"String",proto:!0,forced:a},{at:function(c){var u=s(t(this)),p=u.length,f=n(c),m=f>=0?f:p+f;return m<0||m>=p?void 0:i(u,m)}}),XA}var C1,QA;function YG(){if(QA)return C1;QA=1,qG();var r=Lg();return C1=r("String","at"),C1}var E1,ej;function XG(){if(ej)return E1;ej=1;var r=YG();return E1=r,E1}XG();var tj={},k1,nj;function w3(){if(nj)return k1;nj=1;var r=wu();return k1=function(){var e=r(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},k1}var P1,rj;function ZG(){if(rj)return P1;rj=1;var r=lo(),e=ao(),t=e.RegExp,n=r(function(){var i=t("a","y");return i.lastIndex=2,i.exec("abcd")!==null}),s=n||r(function(){return!t("a","y").sticky}),o=n||r(function(){var i=t("^r","gy");return i.lastIndex=2,i.exec("str")!==null});return P1={BROKEN_CARET:o,MISSED_STICKY:s,UNSUPPORTED_Y:n},P1}var I1,sj;function JG(){if(sj)return I1;sj=1;var r=lo(),e=ao(),t=e.RegExp;return I1=r(function(){var n=t(".","s");return!(n.dotAll&&n.test(`
`)&&n.flags==="s")}),I1}var _1,oj;function QG(){if(oj)return _1;oj=1;var r=lo(),e=ao(),t=e.RegExp;return _1=r(function(){var n=t("(?<a>b)","g");return n.exec("b").groups.a!=="b"||"b".replace(n,"$<a>c")!=="bc"}),_1}var T1,ij;function Qk(){if(ij)return T1;ij=1;var r=tc(),e=os(),t=Ng(),n=w3(),s=ZG(),o=qk(),i=y3(),a=p3().get,l=JG(),c=QG(),u=o("native-string-replace",String.prototype.replace),p=RegExp.prototype.exec,f=p,m=e("".charAt),v=e("".indexOf),b=e("".replace),S=e("".slice),C=function(){var M=/a/,R=/b*/g;return r(p,M,"a"),r(p,R,"a"),M.lastIndex!==0||R.lastIndex!==0}(),E=s.BROKEN_CARET,T=/()??/.exec("")[1]!==void 0,w=C||T||E||l||c;return w&&(f=function(R){var D=this,N=a(D),z=t(R),L=N.raw,B,K,O,U,X,H,ee;if(L)return L.lastIndex=D.lastIndex,B=r(f,L,z),D.lastIndex=L.lastIndex,B;var J=N.groups,ne=E&&D.sticky,ae=r(n,D),q=D.source,se=0,xe=z;if(ne&&(ae=b(ae,"y",""),v(ae,"g")===-1&&(ae+="g"),xe=S(z,D.lastIndex),D.lastIndex>0&&(!D.multiline||D.multiline&&m(z,D.lastIndex-1)!==`
`)&&(q="(?: "+q+")",xe=" "+xe,se++),K=new RegExp("^(?:"+q+")",ae)),T&&(K=new RegExp("^"+q+"$(?!\\s)",ae)),C&&(O=D.lastIndex),U=r(p,ne?K:D,xe),ne?U?(U.input=S(U.input,se),U[0]=S(U[0],se),U.index=D.lastIndex,D.lastIndex+=U[0].length):D.lastIndex=0:C&&U&&(D.lastIndex=D.global?U.index+U[0].length:O),T&&U&&U.length>1&&r(u,U[0],K,function(){for(X=1;X<arguments.length-2;X++)arguments[X]===void 0&&(U[X]=void 0)}),U&&J)for(U.groups=H=i(null),X=0;X<J.length;X++)ee=J[X],H[ee[0]]=U[ee[1]];return U}),T1=f,T1}var aj;function C3(){if(aj)return tj;aj=1;var r=np(),e=Qk();return r({target:"RegExp",proto:!0,forced:/./.exec!==e},{exec:e}),tj}var lj={},M1,cj;function eW(){if(cj)return M1;cj=1;var r=U0(),e=Function.prototype,t=e.apply,n=e.call;return M1=typeof Reflect=="object"&&Reflect.apply||(r?n.bind(t):function(){return n.apply(t,arguments)}),M1}var A1,dj;function tW(){if(dj)return A1;dj=1,C3();var r=tc(),e=f3(),t=Qk(),n=lo(),s=nc(),o=Yk(),i=s("species"),a=RegExp.prototype;return A1=function(l,c,u,p){var f=s(l),m=!n(function(){var C={};return C[f]=function(){return 7},""[l](C)!==7}),v=m&&!n(function(){var C=!1,E=/a/;return l==="split"&&(E={},E.constructor={},E.constructor[i]=function(){return E},E.flags="",E[f]=/./[f]),E.exec=function(){return C=!0,null},E[f](""),!C});if(!m||!v||u){var b=/./[f],S=c(f,""[l],function(C,E,T,w,M){var R=E.exec;return R===t||R===a.exec?m&&!M?{done:!0,value:r(b,E,T,w)}:{done:!0,value:r(C,T,E,w)}:{done:!1}});e(String.prototype,l,S[0]),e(a,f,S[1])}p&&o(a[f],"sham",!0)},A1}var j1,uj;function nW(){if(uj)return j1;uj=1;var r=os(),e=Cu(),t=Ng(),n=tp(),s=r("".charAt),o=r("".charCodeAt),i=r("".slice),a=function(l){return function(c,u){var p=t(n(c)),f=e(u),m=p.length,v,b;return f<0||f>=m?l?"":void 0:(v=o(p,f),v<55296||v>56319||f+1===m||(b=o(p,f+1))<56320||b>57343?l?s(p,f):v:l?i(p,f,f+2):(v-55296<<10)+(b-56320)+65536)}};return j1={codeAt:a(!1),charAt:a(!0)},j1}var R1,hj;function rW(){if(hj)return R1;hj=1;var r=nW().charAt;return R1=function(e,t,n){return t+(n?r(e,t).length:1)},R1}var D1,pj;function E3(){if(pj)return D1;pj=1;var r=os(),e=Rg(),t=Math.floor,n=r("".charAt),s=r("".replace),o=r("".slice),i=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,a=/\$([$&'`]|\d{1,2})/g;return D1=function(l,c,u,p,f,m){var v=u+l.length,b=p.length,S=a;return f!==void 0&&(f=e(f),S=i),s(m,S,function(C,E){var T;switch(n(E,0)){case"$":return"$";case"&":return l;case"`":return o(c,0,u);case"'":return o(c,v);case"<":T=f[o(E,1,-1)];break;default:var w=+E;if(w===0)return C;if(w>b){var M=t(w/10);return M===0?C:M<=b?p[M-1]===void 0?n(E,1):p[M-1]+n(E,1):C}T=p[w-1]}return T===void 0?"":T})},D1}var O1,fj;function sW(){if(fj)return O1;fj=1;var r=tc(),e=wu(),t=co(),n=ep(),s=Qk(),o=TypeError;return O1=function(i,a){var l=i.exec;if(t(l)){var c=r(l,i,a);return c!==null&&e(c),c}if(n(i)==="RegExp")return r(s,i,a);throw new o("RegExp#exec called on incompatible receiver")},O1}var gj;function oW(){if(gj)return lj;gj=1;var r=eW(),e=tc(),t=os(),n=tW(),s=lo(),o=wu(),i=co(),a=H0(),l=Cu(),c=g3(),u=Ng(),p=tp(),f=rW(),m=Wk(),v=E3(),b=sW(),S=nc(),C=S("replace"),E=Math.max,T=Math.min,w=t([].concat),M=t([].push),R=t("".indexOf),D=t("".slice),N=function(K){return K===void 0?K:String(K)},z=function(){return"a".replace(/./,"$0")==="$0"}(),L=function(){return/./[C]?/./[C]("a","$0")==="":!1}(),B=!s(function(){var K=/./;return K.exec=function(){var O=[];return O.groups={a:"7"},O},"".replace(K,"$<a>")!=="7"});return n("replace",function(K,O,U){var X=L?"$":"$0";return[function(ee,J){var ne=p(this),ae=a(ee)?void 0:m(ee,C);return ae?e(ae,ee,ne,J):e(O,u(ne),ee,J)},function(H,ee){var J=o(this),ne=u(H);if(typeof ee=="string"&&R(ee,X)===-1&&R(ee,"$<")===-1){var ae=U(O,J,ne,ee);if(ae.done)return ae.value}var q=i(ee);q||(ee=u(ee));var se=J.global,xe;se&&(xe=J.unicode,J.lastIndex=0);for(var Oe=[],Ee;Ee=b(J,ne),!(Ee===null||(M(Oe,Ee),!se));){var Ue=u(Ee[0]);Ue===""&&(J.lastIndex=f(ne,c(J.lastIndex),xe))}for(var Be="",Te=0,Le=0;Le<Oe.length;Le++){Ee=Oe[Le];for(var Xe=u(Ee[0]),pt=E(T(l(Ee.index),ne.length),0),gn=[],Dt,sn=1;sn<Ee.length;sn++)M(gn,N(Ee[sn]));var Kt=Ee.groups;if(q){var Nt=w([Xe],gn,pt,ne);Kt!==void 0&&M(Nt,Kt),Dt=u(r(ee,void 0,Nt))}else Dt=v(Xe,ne,pt,gn,Kt,ee);pt>=Te&&(Be+=D(ne,Te,pt)+Dt,Te=pt+Xe.length)}return Be+D(ne,Te)}]},!B||!z||L),lj}var mj={},L1,yj;function iW(){if(yj)return L1;yj=1;var r=xu(),e=ep(),t=nc(),n=t("match");return L1=function(s){var o;return r(s)&&((o=s[n])!==void 0?!!o:e(s)==="RegExp")},L1}var N1,vj;function aW(){if(vj)return N1;vj=1;var r=tc(),e=hd(),t=e3(),n=w3(),s=RegExp.prototype;return N1=function(o){var i=o.flags;return i===void 0&&!("flags"in s)&&!e(o,"flags")&&t(s,o)?r(n,o):i},N1}var bj;function lW(){if(bj)return mj;bj=1;var r=np(),e=tc(),t=os(),n=tp(),s=co(),o=H0(),i=iW(),a=Ng(),l=Wk(),c=aW(),u=E3(),p=nc(),f=s3(),m=p("replace"),v=TypeError,b=t("".indexOf),S=t("".replace),C=t("".slice),E=Math.max;return r({target:"String",proto:!0},{replaceAll:function(w,M){var R=n(this),D,N,z,L,B,K,O,U,X,H,ee=0,J="";if(!o(w)){if(D=i(w),D&&(N=a(n(c(w))),!~b(N,"g")))throw new v("`.replaceAll` does not allow non-global regexes");if(z=l(w,m),z)return e(z,w,R,M);if(f&&D)return S(a(R),w,M)}for(L=a(R),B=a(w),K=s(M),K||(M=a(M)),O=B.length,U=E(1,O),X=b(L,B);X!==-1;)H=K?a(M(B,X,L)):u(B,L,X,[],void 0,M),J+=C(L,ee,X)+H,ee=X+O,X=X+U>L.length?-1:b(L,B,X+U);return ee<L.length&&(J+=C(L,ee)),J}}),mj}var F1,Sj;function cW(){if(Sj)return F1;Sj=1,C3(),oW(),lW();var r=Lg();return F1=r("String","replaceAll"),F1}var z1,xj;function dW(){if(xj)return z1;xj=1;var r=cW();return z1=r,z1}dW();function k3(r){return r&&typeof r=="object"&&"parents"in r}function P3(r){for(let e=0,t=r.parents.length;e<t;e++)if(r.parents[e].__unsafe__getWithoutCapture(!0),r.parents[e].lastChangedEpoch!==r.parentEpochs[e])return!0;return!1}function Ov(r,e){if(r.children.remove(e)&&r.children.isEmpty&&k3(r))for(let t=0,n=r.parents.length;t<n;t++)Ov(r.parents[t],r)}function e2(r,e){if(r.children.add(e)&&k3(r))for(let t=0,n=r.parents.length;t<n;t++)e2(r.parents[t],r)}function I3(r,e){return r===e||Object.is(r,e)||!!(r&&e&&typeof r.equals=="function"&&r.equals(e))}function pd(r,e){const t=Symbol.for(`com.tldraw.state/${r}`),n=globalThis;return n[t]??(n[t]=e()),n[t]}const Gl=pd("empty_array",()=>Object.freeze([])),wj=8;class Lv{constructor(){k(this,"arraySize",0);k(this,"array",Array(wj));k(this,"set",null)}get isEmpty(){if(this.array)return this.arraySize===0;if(this.set)return this.set.size===0;throw new Error("no set or array")}add(e){if(this.array)return this.array.indexOf(e)!==-1?!1:this.arraySize<wj?(this.array[this.arraySize]=e,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(e),!0);if(this.set)return this.set.has(e)?!1:(this.set.add(e),!0);throw new Error("no set or array")}remove(e){if(this.array){const t=this.array.indexOf(e);return t===-1?!1:(this.array[t]=void 0,this.arraySize--,t!==this.arraySize&&(this.array[t]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return this.set.has(e)?(this.set.delete(e),!0):!1;throw new Error("no set or array")}visit(e){if(this.array){for(let t=0;t<this.arraySize;t++){const n=this.array[t];typeof n<"u"&&e(n)}return}if(this.set){this.set.forEach(e);return}throw new Error("no set or array")}has(e){return this.array?this.array.indexOf(e)!==-1:this.set.has(e)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}}const oi=Symbol.for("com.tldraw.state/RESET_VALUE");class _3{constructor(e){k(this,"index",0);k(this,"buffer");this.capacity=e,this.buffer=new Array(e)}pushEntry(e,t,n){if(n!==void 0){if(n===oi){this.clear();return}this.buffer[this.index]=[e,t,n],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){const{index:t,capacity:n,buffer:s}=this;for(let o=0;o<n;o++){const i=(t-1+n-o)%n,a=s[i];if(!a)return oi;const[l,c]=a;if(o===0&&e>=c)return[];if(l<=e&&e<c){const u=o+1,p=new Array(u);for(let f=0;f<u;f++)p[f]=s[(i+f)%n][2];return p}}return oi}}class uW{constructor(e,t){k(this,"offset",0);k(this,"maybeRemoved");this.below=e,this.child=t}}const Zn=pd("capture",()=>({stack:null}));function ly(r){const e=Zn.stack;Zn.stack=null;try{return r()}finally{Zn.stack=e}}function T3(r){Zn.stack=new uW(Zn.stack,r),r.parentSet.clear()}function M3(){const r=Zn.stack;if(Zn.stack=r.below,r.offset<r.child.parents.length){for(let e=r.offset;e<r.child.parents.length;e++){const t=r.child.parents[e];r.child.parentSet.has(t)||Ov(t,r.child)}r.child.parents.length=r.offset,r.child.parentEpochs.length=r.offset}if(r.maybeRemoved)for(let e=0;e<r.maybeRemoved.length;e++){const t=r.maybeRemoved[e];r.child.parentSet.has(t)||Ov(t,r.child)}}function Nv(r){if(Zn.stack){if(Zn.stack.child.parentSet.has(r))return;if(Zn.stack.child.parentSet.add(r),Zn.stack.child.isActivelyListening&&e2(r,Zn.stack.child),Zn.stack.offset<Zn.stack.child.parents.length){const t=Zn.stack.child.parents[Zn.stack.offset];t!==r&&(Zn.stack.maybeRemoved?Zn.stack.maybeRemoved.push(t):Zn.stack.maybeRemoved=[t])}Zn.stack.child.parents[Zn.stack.offset]=r,Zn.stack.child.parentEpochs[Zn.stack.offset]=r.lastChangedEpoch,Zn.stack.offset++}}const qc=-1;class hW{constructor(e,t,n){k(this,"_isActivelyListening",!1);k(this,"lastTraversedEpoch",qc);k(this,"lastReactedEpoch",qc);k(this,"_scheduleCount",0);k(this,"parentSet",new Lv);k(this,"parentEpochs",[]);k(this,"parents",[]);k(this,"_scheduleEffect");k(this,"maybeExecute",()=>{this._isActivelyListening&&this.execute()});this.name=e,this.runEffect=t,this._scheduleEffect=n==null?void 0:n.scheduleEffect}get isActivelyListening(){return this._isActivelyListening}get scheduleCount(){return this._scheduleCount}maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==Do()){if(this.parents.length&&!P3(this)){this.lastReactedEpoch=Do();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}attach(){this._isActivelyListening=!0;for(let e=0,t=this.parents.length;e<t;e++)e2(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,t=this.parents.length;e<t;e++)Ov(this.parents[e],this)}execute(){try{T3(this);const e=Do(),t=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=e,t}finally{M3()}}}const rp=pd("EffectScheduler",()=>hW);function nl(r,e,t){const n=new rp(r,e,t);return n.attach(),n.scheduleEffect(),()=>{n.detach()}}function pW(r,e,t){const n=new rp(r,e,t);return{scheduler:n,start:s=>{const o=(s==null?void 0:s.force)??!1;n.attach(),o?n.scheduleEffect():n.maybeScheduleEffect()},stop:()=>{n.detach()}}}class fW{constructor(e){k(this,"initialAtomValues",new Map);this.parent=e}get isRoot(){return this.parent===null}commit(){if(pn.globalIsReacting)for(const e of this.initialAtomValues.keys())j3(e);else this.isRoot?A3(this.initialAtomValues.keys()):this.initialAtomValues.forEach((e,t)=>{this.parent.initialAtomValues.has(t)||this.parent.initialAtomValues.set(t,e)})}abort(){pn.globalEpoch++,this.initialAtomValues.forEach((e,t)=>{var n;t.set(e),(n=t.historyBuffer)==null||n.clear()}),this.commit()}}const pn=pd("transactions",()=>({globalEpoch:qc+1,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:qc+1}));function gW(){return pn.reactionEpoch}function Do(){return pn.globalEpoch}function mW(){return pn.globalIsReacting}function t2(r,e){e.lastTraversedEpoch!==pn.globalEpoch&&(e.lastTraversedEpoch=pn.globalEpoch,e instanceof rp?r.add(e):e.children.visit(t=>t2(r,t)))}function A3(r){var t;if(pn.globalIsReacting)throw new Error("flushChanges cannot be called during a reaction");const e=pn.currentTransaction;try{pn.currentTransaction=null,pn.globalIsReacting=!0,pn.reactionEpoch=pn.globalEpoch;const n=new Set;for(const o of r)o.children.visit(i=>t2(n,i));for(const o of n)o.maybeScheduleEffect();let s=0;for(;(t=pn.cleanupReactors)!=null&&t.size;){if(s++>1e3)throw new Error("Reaction update depth limit exceeded");const o=pn.cleanupReactors;pn.cleanupReactors=null;for(const i of o)i.maybeScheduleEffect()}}finally{pn.cleanupReactors=null,pn.globalIsReacting=!1,pn.currentTransaction=e}}function yW(r,e){pn.currentTransaction?pn.currentTransaction.initialAtomValues.has(r)||pn.currentTransaction.initialAtomValues.set(r,e):pn.globalIsReacting?j3(r):A3([r])}function j3(r){const e=pn.cleanupReactors??(pn.cleanupReactors=new Set);r.children.visit(t=>t2(e,t))}function vW(){pn.globalEpoch++}function bW(r){const e=new fW(pn.currentTransaction);pn.currentTransaction=e;try{let t,n=!1;try{t=r(()=>n=!0)}catch(s){throw e.abort(),s}return n?e.abort():e.commit(),t}finally{pn.currentTransaction=pn.currentTransaction.parent}}function rl(r){return pn.currentTransaction?r():bW(r)}class SW{constructor(e,t,n){k(this,"isEqual");k(this,"computeDiff");k(this,"lastChangedEpoch",Do());k(this,"children",new Lv);k(this,"historyBuffer");this.name=e,this.current=t,this.isEqual=(n==null?void 0:n.isEqual)??null,n&&(n.historyLength&&(this.historyBuffer=new _3(n.historyLength)),this.computeDiff=n.computeDiff)}__unsafe__getWithoutCapture(e){return this.current}get(){return Nv(this),this.current}set(e,t){var s,o;if(((s=this.isEqual)==null?void 0:s.call(this,this.current,e))??I3(this.current,e))return this.current;vW(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,Do(),t??((o=this.computeDiff)==null?void 0:o.call(this,this.current,e,this.lastChangedEpoch,Do()))??oi),this.lastChangedEpoch=Do();const n=this.current;return this.current=e,yW(this,n),e}update(e){return this.set(e(this.current))}getDiffSince(e){var t;return Nv(this),e>=this.lastChangedEpoch?Gl:((t=this.historyBuffer)==null?void 0:t.getChangesSince(e))??oi}}const xW=pd("Atom",()=>SW);function $r(r,e,t){return new xW(r,e,t)}let Cj=!1;function wW(){Cj||(Cj=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`))}const hf=Symbol.for("com.tldraw.state/UNINITIALIZED");function tu(r){return r===hf}const dE=pd("WithDiff",()=>class{constructor(e,t){this.value=e,this.diff=t}});function pf(r,e){return new dE(r,e)}class CW{constructor(e,t,n){k(this,"lastChangedEpoch",qc);k(this,"lastTraversedEpoch",qc);k(this,"lastCheckedEpoch",qc);k(this,"parentSet",new Lv);k(this,"parents",[]);k(this,"parentEpochs",[]);k(this,"children",new Lv);k(this,"historyBuffer");k(this,"state",hf);k(this,"error",null);k(this,"computeDiff");k(this,"isEqual");this.name=e,this.derive=t,n!=null&&n.historyLength&&(this.historyBuffer=new _3(n.historyLength)),this.computeDiff=n==null?void 0:n.computeDiff,this.isEqual=(n==null?void 0:n.isEqual)??I3}get isActivelyListening(){return!this.children.isEmpty}__unsafe__getWithoutCapture(e){var s;const t=this.lastChangedEpoch===qc,n=Do();if(!t&&(this.lastCheckedEpoch===n||this.isActivelyListening&&mW()&&this.lastTraversedEpoch<gW()||!P3(this)))if(this.lastCheckedEpoch=n,this.error){if(e)return this.state;throw this.error.thrownValue}else return this.state;try{T3(this);const o=this.derive(this.state,this.lastCheckedEpoch),i=o instanceof dE?o.value:o,a=this.state===hf;if(a||!this.isEqual(i,this.state)){if(this.historyBuffer&&!a){const l=o instanceof dE?o.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,Do(),l??((s=this.computeDiff)==null?void 0:s.call(this,this.state,i,this.lastCheckedEpoch,Do()))??oi)}this.lastChangedEpoch=Do(),this.state=i}return this.error=null,this.lastCheckedEpoch=Do(),this.state}catch(o){if(this.state!==hf&&(this.state=hf,this.lastChangedEpoch=Do()),this.lastCheckedEpoch=Do(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:o},!e)throw o;return this.state}finally{M3()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{Nv(this)}}getDiffSince(e){var t;return this.__unsafe__getWithoutCapture(!0),Nv(this),e>=this.lastChangedEpoch?Gl:((t=this.historyBuffer)==null?void 0:t.getChangesSince(e))??oi}}const K0=pd("Computed",()=>CW);function EW(r={},e,t,n){const s=n.value,o=Symbol.for("__@tldraw/state__computed__"+t);return n.value=function(){let i=this[o];return i||(i=new K0(t,s.bind(this),r),Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:i})),i.get()},n.value[R3]=!0,n}function kW(r={},e,t,n){const s=n.get,o=Symbol.for("__@tldraw/state__computed__"+t);return n.get=function(){let i=this[o];return i||(i=new K0(t,s.bind(this),r),Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:i})),i.get()},n}function PW(r,e,t){fn(t.kind==="method","@computed can only be used on methods");const n=Symbol.for("__@tldraw/state__computed__"+String(t.name)),s=function(){let o=this[n];return o||(o=new K0(String(t.name),e.bind(this),r),Object.defineProperty(this,n,{enumerable:!1,configurable:!1,writable:!1,value:o})),o.get()};return s[R3]=!0,s}function Ej(r={},e){if(e.length===2){const[t,n]=e;return PW(r,t,n)}else{const[t,n,s]=e;return s.get?(wW(),kW(r,t,n,s)):EW(r,t,n,s)}}const R3="@@__isComputedMethod__@@";function Ie(){if(arguments.length===1){const r=arguments[0];return(...e)=>Ej(r,e)}else return typeof arguments[0]=="string"?new K0(arguments[0],arguments[1],arguments[2]):Ej(void 0,arguments)}const D3=1,IW=pd("apiVersion",()=>D3);if(IW!==D3)throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");dd("@tldraw/state","3.7.0","esm");function V0(r,e,t=[]){const n=Ht.useRef(e);n.current=e;const[s,o,i]=Ht.useMemo(()=>{let a=null;const l=p=>(a=p,()=>{a=null}),c=new rp(`useStateTracking(${r})`,()=>{var p;return(p=n.current)==null?void 0:p.call(n)},{scheduleEffect(){a==null||a()}});return[c,l,()=>c.scheduleCount]},[r,...t]);return Ht.useSyncExternalStore(o,i,i),Ht.useEffect(()=>(s.attach(),s.maybeScheduleEffect(),()=>{s.detach()}),[s]),s.execute()}const kj={apply(r,e,t){return V0(r.displayName??r.name??"tracked(???)",()=>r.apply(e,t))}},_W=Symbol.for("react.memo"),TW=Symbol.for("react.forward_ref");function Ss(r){let e=null;const t=r.$$typeof;return t===_W&&(r=r.type,e=r.compare),t===TW?I.memo(I.forwardRef(new Proxy(r.render,kj))):I.memo(new Proxy(r,kj),e)}function n2(r,e,t){return I.useState(()=>{const n=typeof e=="function"?e():e;return $r(`useAtom(${r})`,n,t)})[0]}function MW(){const r=arguments[0],e=arguments[1],t=arguments.length===3?void 0:arguments[2],n=arguments.length===3?arguments[2]:arguments[3];return I.useMemo(()=>Ie(`useComputed(${r})`,e,t),n)}function Zc(r,e,t=Gl){I.useEffect(()=>{const n=new rp(r,e);return n.attach(),n.execute(),()=>{n.detach()}},t)}function ye(){const r=arguments,e=r.length===3?r[2]:[r[0]],t=r.length===3?r[0]:`useValue(${r[0].name})`,n=I.useRef(!0);n.current=!0;const s=I.useMemo(()=>r.length===1?r[0]:Ie(t,()=>{if(n.current)return r[1]();try{return r[1]()}catch{return{}}}),e);try{const{subscribe:o,getSnapshot:i}=I.useMemo(()=>({subscribe:a=>nl(`useValue(${t})`,()=>{s.get(),a()}),getSnapshot:()=>s.get()}),[s]);return I.useSyncExternalStore(o,i,i)}finally{n.current=!1}}dd("@tldraw/state-react","3.7.0","esm");const AW=(r,e)=>e.some(t=>r instanceof t);let Pj,Ij;function jW(){return Pj||(Pj=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function RW(){return Ij||(Ij=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const O3=new WeakMap,uE=new WeakMap,L3=new WeakMap,$1=new WeakMap,r2=new WeakMap;function DW(r){const e=new Promise((t,n)=>{const s=()=>{r.removeEventListener("success",o),r.removeEventListener("error",i)},o=()=>{t(Wl(r.result)),s()},i=()=>{n(r.error),s()};r.addEventListener("success",o),r.addEventListener("error",i)});return e.then(t=>{t instanceof IDBCursor&&O3.set(t,r)}).catch(()=>{}),r2.set(e,r),e}function OW(r){if(uE.has(r))return;const e=new Promise((t,n)=>{const s=()=>{r.removeEventListener("complete",o),r.removeEventListener("error",i),r.removeEventListener("abort",i)},o=()=>{t(),s()},i=()=>{n(r.error||new DOMException("AbortError","AbortError")),s()};r.addEventListener("complete",o),r.addEventListener("error",i),r.addEventListener("abort",i)});uE.set(r,e)}let hE={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return uE.get(r);if(e==="objectStoreNames")return r.objectStoreNames||L3.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Wl(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function LW(r){hE=r(hE)}function NW(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=r.call(B1(this),e,...t);return L3.set(n,e.sort?e.sort():[e]),Wl(n)}:RW().includes(r)?function(...e){return r.apply(B1(this),e),Wl(O3.get(this))}:function(...e){return Wl(r.apply(B1(this),e))}}function FW(r){return typeof r=="function"?NW(r):(r instanceof IDBTransaction&&OW(r),AW(r,jW())?new Proxy(r,hE):r)}function Wl(r){if(r instanceof IDBRequest)return DW(r);if($1.has(r))return $1.get(r);const e=FW(r);return e!==r&&($1.set(r,e),r2.set(e,r)),e}const B1=r=>r2.get(r);function N3(r,e,{blocked:t,upgrade:n,blocking:s,terminated:o}={}){const i=indexedDB.open(r,e),a=Wl(i);return n&&i.addEventListener("upgradeneeded",l=>{n(Wl(i.result),l.oldVersion,l.newVersion,Wl(i.transaction),l)}),t&&i.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{o&&l.addEventListener("close",()=>o()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function F3(r,{blocked:e}={}){const t=indexedDB.deleteDatabase(r);return e&&t.addEventListener("blocked",n=>e(n.oldVersion,n)),Wl(t).then(()=>{})}const zW=["get","getKey","getAll","getAllKeys","count"],$W=["put","add","delete","clear"],U1=new Map;function _j(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(U1.get(e))return U1.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,s=$W.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(s||zW.includes(t)))return;const o=async function(i,...a){const l=this.transaction(i,s?"readwrite":"readonly");let c=l.store;return n&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return U1.set(e,o),o}LW(r=>({...r,get:(e,t,n)=>_j(e,t)||r.get(e,t,n),has:(e,t)=>!!_j(e,t)||r.has(e,t)}));const BW="TLDRAW_DOCUMENT_v2",UW="TLDRAW_ASSET_STORE_v1",z3="TLDRAW_DB_NAME_INDEX_v2",Ut={Records:"records",Schema:"schema",SessionState:"session_state",Assets:"assets"};async function $3(r){const e=BW+r;return GW(e),await N3(e,4,{upgrade(t){t.objectStoreNames.contains(Ut.Records)||t.createObjectStore(Ut.Records),t.objectStoreNames.contains(Ut.Schema)||t.createObjectStore(Ut.Schema),t.objectStoreNames.contains(Ut.SessionState)||t.createObjectStore(Ut.SessionState),t.objectStoreNames.contains(Ut.Assets)||t.createObjectStore(Ut.Assets)}})}async function HW(r){const e=window.indexedDB.databases?(await window.indexedDB.databases()).map(f=>f.name):s2(),t=UW+r;if(!e.find(f=>f===t))return;const s=await N3(t,1,{upgrade(f){f.objectStoreNames.contains("assets")||f.createObjectStore("assets")}});if(!s.objectStoreNames.contains("assets"))return;const o=s.transaction(["assets"],"readonly"),i=o.objectStore("assets"),a=await i.getAllKeys(),l=await Promise.all(a.map(async f=>[f,await i.get(f)]));await o.done;const c=await $3(r),u=c.transaction([Ut.Assets],"readwrite"),p=u.objectStore(Ut.Assets);for(const[f,m]of l)p.put(m,f);await u.done,s.close(),c.close(),await F3(t)}const Of=class Of{constructor(e){k(this,"getDbPromise");k(this,"isClosed",!1);k(this,"pendingTransactionSet",new Set);Of.connectedInstances.add(this),this.getDbPromise=(async()=>(await HW(e),await $3(e)))()}getDb(){return this.getDbPromise}pending(){return Promise.allSettled([this.getDbPromise,...this.pendingTransactionSet]).then(Nf)}async close(){this.isClosed||(this.isClosed=!0,await this.pending(),(await this.getDb()).close(),Of.connectedInstances.delete(this))}tx(e,t,n){const s=(async()=>{fn(!this.isClosed,"db is closed");const i=(await this.getDb()).transaction(t,e),a=i.done.catch(l=>{if(!this.isClosed)throw l});try{return await n(i)}finally{this.isClosed?i.abort():await a}})();return this.pendingTransactionSet.add(s),s.finally(()=>this.pendingTransactionSet.delete(s)),s}async load({sessionId:e}={}){return await this.tx("readonly",[Ut.Records,Ut.Schema,Ut.SessionState],async t=>{var l,c;const n=t.objectStore(Ut.Records),s=t.objectStore(Ut.Schema),o=t.objectStore(Ut.SessionState);let i=e?(l=await o.get(e))==null?void 0:l.snapshot:null;return i||(i=(c=(await o.getAll()).sort((p,f)=>p.updatedAt-f.updatedAt).pop())==null?void 0:c.snapshot),{records:await n.getAll(),schema:await s.get(Ut.Schema),sessionStateSnapshot:i}})}async storeChanges({schema:e,changes:t,sessionId:n,sessionStateSnapshot:s}){await this.tx("readwrite",[Ut.Records,Ut.Schema,Ut.SessionState],async o=>{const i=o.objectStore(Ut.Records),a=o.objectStore(Ut.Schema),l=o.objectStore(Ut.SessionState);for(const[c,u]of Object.entries(t.added))await i.put(u,c);for(const[c,u]of Object.values(t.updated))await i.put(u,u.id);for(const c of Object.keys(t.removed))await i.delete(c);a.put(e.serialize(),Ut.Schema),s&&n?l.put({snapshot:s,updatedAt:Date.now(),id:n},n):(s||n)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async storeSnapshot({schema:e,snapshot:t,sessionId:n,sessionStateSnapshot:s}){await this.tx("readwrite",[Ut.Records,Ut.Schema,Ut.SessionState],async o=>{const i=o.objectStore(Ut.Records),a=o.objectStore(Ut.Schema),l=o.objectStore(Ut.SessionState);await i.clear();for(const[c,u]of Object.entries(t))await i.put(u,c);a.put(e.serialize(),Ut.Schema),s&&n?l.put({snapshot:s,updatedAt:Date.now(),id:n},n):(s||n)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async pruneSessions(){await this.tx("readwrite",[Ut.SessionState],async e=>{const t=e.objectStore(Ut.SessionState),n=(await t.getAll()).sort((o,i)=>o.updatedAt-i.updatedAt);if(n.length<10){await e.done;return}const s=n.slice(0,n.length-10);for(const{id:o}of s)await t.delete(o)})}async getAsset(e){return await this.tx("readonly",[Ut.Assets],async t=>await t.objectStore(Ut.Assets).get(e))}async storeAsset(e,t){await this.tx("readwrite",[Ut.Assets],async n=>{await n.objectStore(Ut.Assets).put(t,e)})}};k(Of,"connectedInstances",new Set);let Fv=Of;function s2(){const r=JSON.parse(Bk(z3)||"[]")??[];return Array.isArray(r)?r:[]}function GW(r){const e=new Set(s2());e.add(r),Uk(z3,JSON.stringify([...e]))}class qy{constructor(e){k(this,"nextValue");k(this,"diff");this.previousValue=e}get(){var n,s,o,i;const e=((s=(n=this.diff)==null?void 0:n.removed)==null?void 0:s.size)??0,t=((i=(o=this.diff)==null?void 0:o.added)==null?void 0:i.size)??0;if(!(e===0&&t===0))return{value:this.nextValue,diff:this.diff}}_add(e,t){var n,s;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.add(e),this.diff??(this.diff={}),t?(n=this.diff.removed)==null||n.delete(e):((s=this.diff).added??(s.added=new Set),this.diff.added.add(e))}add(e){var s,o,i;const t=this.previousValue.has(e);if(t)return((o=(s=this.diff)==null?void 0:s.removed)==null?void 0:o.has(e))?this._add(e,t):void 0;(i=this.nextValue)!=null&&i.has(e)||this._add(e,t)}_remove(e,t){var n,s;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.delete(e),this.diff??(this.diff={}),t?((n=this.diff).removed??(n.removed=new Set),this.diff.removed.add(e)):(s=this.diff.added)==null||s.delete(e)}remove(e){var s,o,i,a;const t=this.previousValue.has(e);if(!t)return((o=(s=this.diff)==null?void 0:s.added)==null?void 0:o.has(e))?this._remove(e,t):void 0;(a=(i=this.diff)==null?void 0:i.removed)!=null&&a.has(e)||this._remove(e,t)}}class q0{constructor(e,t){k(this,"createDefaultProperties");k(this,"validator");k(this,"ephemeralKeys");k(this,"ephemeralKeySet");k(this,"scope");this.typeName=e,this.createDefaultProperties=t.createDefaultProperties,this.validator=t.validator??{validate:s=>s},this.scope=t.scope??"document",this.ephemeralKeys=t.ephemeralKeys;const n=new Set;if(t.ephemeralKeys)for(const[s,o]of Ho(t.ephemeralKeys))o&&n.add(s);this.ephemeralKeySet=n}create(e){const t={...this.createDefaultProperties(),id:this.createId()};for(const[n,s]of Object.entries(e))s!==void 0&&(t[n]=s);return t.typeName=this.typeName,t}clone(e){return{...Kn(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??Cn())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw new Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isInstance(e){return(e==null?void 0:e.typeName)===this.typeName}isId(e){if(!e)return!1;for(let t=0;t<this.typeName.length;t++)if(e[t]!==this.typeName[t])return!1;return e[this.typeName.length]===":"}withDefaultProperties(e){return new q0(this.typeName,{createDefaultProperties:e,validator:this.validator,scope:this.scope,ephemeralKeys:this.ephemeralKeys})}validate(e,t){return t&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(t,e):this.validator.validate(e)}}function gl(r,e){return new q0(r,{createDefaultProperties:()=>({}),validator:e.validator,scope:e.scope,ephemeralKeys:e.ephemeralKeys})}function zv(){return{added:{},updated:{},removed:{}}}function pE(r){const e={added:r.removed,removed:r.added,updated:{}};for(const[t,n]of Object.values(r.updated))e.updated[t.id]=[n,t];return e}function B3(r){return Object.keys(r.added).length===0&&Object.keys(r.updated).length===0&&Object.keys(r.removed).length===0}function o2(r){const e={added:{},removed:{},updated:{}};return If(e,r),e}function If(r,e){for(const t of e){for(const[n,s]of Ho(t.added))if(r.removed[n]){const o=r.removed[n];delete r.removed[n],o!==s&&(r.updated[n]=[o,s])}else r.added[n]=s;for(const[n,[s,o]]of Ho(t.updated)){if(r.added[n]){r.added[n]=o,delete r.updated[n],delete r.removed[n];continue}if(r.updated[n]){r.updated[n]=[r.updated[n][0],o],delete r.removed[n];continue}r.updated[n]=t.updated[n],delete r.removed[n]}for(const[n,s]of Ho(t.removed))r.added[n]?delete r.added[n]:r.updated[n]?(r.removed[n]=r.updated[n][0],delete r.updated[n]):r.removed[n]=s}}var ff={exports:{}};ff.exports;var Tj;function WW(){return Tj||(Tj=1,function(r,e){var t=200,n="__lodash_hash_undefined__",s=1,o=2,i=9007199254740991,a="[object Arguments]",l="[object Array]",c="[object AsyncFunction]",u="[object Boolean]",p="[object Date]",f="[object Error]",m="[object Function]",v="[object GeneratorFunction]",b="[object Map]",S="[object Number]",C="[object Null]",E="[object Object]",T="[object Promise]",w="[object Proxy]",M="[object RegExp]",R="[object Set]",D="[object String]",N="[object Symbol]",z="[object Undefined]",L="[object WeakMap]",B="[object ArrayBuffer]",K="[object DataView]",O="[object Float32Array]",U="[object Float64Array]",X="[object Int8Array]",H="[object Int16Array]",ee="[object Int32Array]",J="[object Uint8Array]",ne="[object Uint8ClampedArray]",ae="[object Uint16Array]",q="[object Uint32Array]",se=/[\\^$.*+?()[\]{}|]/g,xe=/^\[object .+?Constructor\]$/,Oe=/^(?:0|[1-9]\d*)$/,Ee={};Ee[O]=Ee[U]=Ee[X]=Ee[H]=Ee[ee]=Ee[J]=Ee[ne]=Ee[ae]=Ee[q]=!0,Ee[a]=Ee[l]=Ee[B]=Ee[u]=Ee[K]=Ee[p]=Ee[f]=Ee[m]=Ee[b]=Ee[S]=Ee[E]=Ee[M]=Ee[R]=Ee[D]=Ee[L]=!1;var Ue=typeof $o=="object"&&$o&&$o.Object===Object&&$o,Be=typeof self=="object"&&self&&self.Object===Object&&self,Te=Ue||Be||Function("return this")(),Le=e&&!e.nodeType&&e,Xe=Le&&!0&&r&&!r.nodeType&&r,pt=Xe&&Xe.exports===Le,gn=pt&&Ue.process,Dt=function(){try{return gn&&gn.binding&&gn.binding("util")}catch{}}(),sn=Dt&&Dt.isTypedArray;function Kt(V,le){for(var Me=-1,Ye=V==null?0:V.length,wn=0,wt=[];++Me<Ye;){var Ln=V[Me];le(Ln,Me,V)&&(wt[wn++]=Ln)}return wt}function Nt(V,le){for(var Me=-1,Ye=le.length,wn=V.length;++Me<Ye;)V[wn+Me]=le[Me];return V}function vr(V,le){for(var Me=-1,Ye=V==null?0:V.length;++Me<Ye;)if(le(V[Me],Me,V))return!0;return!1}function br(V,le){for(var Me=-1,Ye=Array(V);++Me<V;)Ye[Me]=le(Me);return Ye}function Qn(V){return function(le){return V(le)}}function Sr(V,le){return V.has(le)}function dr(V,le){return V==null?void 0:V[le]}function Rr(V){var le=-1,Me=Array(V.size);return V.forEach(function(Ye,wn){Me[++le]=[wn,Ye]}),Me}function qn(V,le){return function(Me){return V(le(Me))}}function Zs(V){var le=-1,Me=Array(V.size);return V.forEach(function(Ye){Me[++le]=Ye}),Me}var ke=Array.prototype,ge=Function.prototype,he=Object.prototype,Ce=Te["__core-js_shared__"],$e=ge.toString,re=he.hasOwnProperty,we=function(){var V=/[^.]+$/.exec(Ce&&Ce.keys&&Ce.keys.IE_PROTO||"");return V?"Symbol(src)_1."+V:""}(),Fe=he.toString,ct=RegExp("^"+$e.call(re).replace(se,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),tn=pt?Te.Buffer:void 0,Vt=Te.Symbol,Tn=Te.Uint8Array,qt=he.propertyIsEnumerable,En=ke.splice,kn=Vt?Vt.toStringTag:void 0,Yn=Object.getOwnPropertySymbols,Mn=tn?tn.isBuffer:void 0,mn=qn(Object.keys,Object),At=xl(Te,"DataView"),On=xl(Te,"Map"),ur=xl(Te,"Promise"),is=xl(Te,"Set"),Vr=xl(Te,"WeakMap"),er=xl(Object,"create"),Cs=ks(At),go=ks(On),Hi=ks(ur),bl=ks(is),ac=ks(Vr),wa=Vt?Vt.prototype:void 0,Ca=wa?wa.valueOf:void 0;function mo(V){var le=-1,Me=V==null?0:V.length;for(this.clear();++le<Me;){var Ye=V[le];this.set(Ye[0],Ye[1])}}function xd(){this.__data__=er?er(null):{},this.size=0}function lc(V){var le=this.has(V)&&delete this.__data__[V];return this.size-=le?1:0,le}function Y(V){var le=this.__data__;if(er){var Me=le[V];return Me===n?void 0:Me}return re.call(le,V)?le[V]:void 0}function Z(V){var le=this.__data__;return er?le[V]!==void 0:re.call(le,V)}function $(V,le){var Me=this.__data__;return this.size+=this.has(V)?0:1,Me[V]=er&&le===void 0?n:le,this}mo.prototype.clear=xd,mo.prototype.delete=lc,mo.prototype.get=Y,mo.prototype.has=Z,mo.prototype.set=$;function G(V){var le=-1,Me=V==null?0:V.length;for(this.clear();++le<Me;){var Ye=V[le];this.set(Ye[0],Ye[1])}}function W(){this.__data__=[],this.size=0}function de(V){var le=this.__data__,Me=nr(le,V);if(Me<0)return!1;var Ye=le.length-1;return Me==Ye?le.pop():En.call(le,Me,1),--this.size,!0}function Se(V){var le=this.__data__,Me=nr(le,V);return Me<0?void 0:le[Me][1]}function be(V){return nr(this.__data__,V)>-1}function ce(V,le){var Me=this.__data__,Ye=nr(Me,V);return Ye<0?(++this.size,Me.push([V,le])):Me[Ye][1]=le,this}G.prototype.clear=W,G.prototype.delete=de,G.prototype.get=Se,G.prototype.has=be,G.prototype.set=ce;function _e(V){var le=-1,Me=V==null?0:V.length;for(this.clear();++le<Me;){var Ye=V[le];this.set(Ye[0],Ye[1])}}function et(){this.size=0,this.__data__={hash:new mo,map:new(On||G),string:new mo}}function jt(V){var le=nn(this,V).delete(V);return this.size-=le?1:0,le}function dt(V){return nn(this,V).get(V)}function dn(V){return nn(this,V).has(V)}function Ct(V,le){var Me=nn(this,V),Ye=Me.size;return Me.set(V,le),this.size+=Me.size==Ye?0:1,this}_e.prototype.clear=et,_e.prototype.delete=jt,_e.prototype.get=dt,_e.prototype.has=dn,_e.prototype.set=Ct;function Yt(V){var le=-1,Me=V==null?0:V.length;for(this.__data__=new _e;++le<Me;)this.add(V[le])}function Pn(V){return this.__data__.set(V,n),this}function St(V){return this.__data__.has(V)}Yt.prototype.add=Yt.prototype.push=Pn,Yt.prototype.has=St;function bn(V){var le=this.__data__=new G(V);this.size=le.size}function Dr(){this.__data__=new G,this.size=0}function hr(V){var le=this.__data__,Me=le.delete(V);return this.size=le.size,Me}function cc(V){return this.__data__.get(V)}function tr(V){return this.__data__.has(V)}function dc(V,le){var Me=this.__data__;if(Me instanceof G){var Ye=Me.__data__;if(!On||Ye.length<t-1)return Ye.push([V,le]),this.size=++Me.size,this;Me=this.__data__=new _e(Ye)}return Me.set(V,le),this.size=Me.size,this}bn.prototype.clear=Dr,bn.prototype.delete=hr,bn.prototype.get=cc,bn.prototype.has=tr,bn.prototype.set=dc;function Ea(V,le){var Me=_a(V),Ye=!Me&&Cd(V),wn=!Me&&!Ye&&bp(V),wt=!Me&&!Ye&&!wn&&xp(V),Ln=Me||Ye||wn||wt,xr=Ln?br(V.length,String):[],Nn=xr.length;for(var An in V)re.call(V,An)&&!(Ln&&(An=="length"||wn&&(An=="offset"||An=="parent")||wt&&(An=="buffer"||An=="byteLength"||An=="byteOffset")||dm(An,Nn)))&&xr.push(An);return xr}function nr(V,le){for(var Me=V.length;Me--;)if(Wi(V[Me][0],le))return Me;return-1}function qo(V,le,Me){var Ye=le(V);return _a(V)?Ye:Nt(Ye,Me(V))}function Es(V){return V==null?V===void 0?z:C:kn&&kn in Object(V)?cm(V):Ia(V)}function Js(V){return Ma(V)&&Es(V)==a}function ka(V,le,Me,Ye,wn){return V===le?!0:V==null||le==null||!Ma(V)&&!Ma(le)?V!==V&&le!==le:uc(V,le,Me,Ye,ka,wn)}function uc(V,le,Me,Ye,wn,wt){var Ln=_a(V),xr=_a(le),Nn=Ln?l:Gi(V),An=xr?l:Gi(le);Nn=Nn==a?E:Nn,An=An==a?E:An;var qr=Nn==E,vo=An==E,wr=Nn==An;if(wr&&bp(V)){if(!bp(le))return!1;Ln=!0,qr=!1}if(wr&&!qr)return wt||(wt=new bn),Ln||xp(V)?Pa(V,le,Me,Ye,wn,wt):yo(V,le,Nn,Me,Ye,wn,wt);if(!(Me&s)){var as=qr&&re.call(V,"__wrapped__"),Qs=vo&&re.call(le,"__wrapped__");if(as||Qs){var pr=as?V.value():V,Ps=Qs?le.value():le;return wt||(wt=new bn),wn(pr,Ps,Me,Ye,wt)}}return wr?(wt||(wt=new bn),Mu(V,le,Me,Ye,wn,wt)):!1}function wd(V){if(!Sp(V)||vp(V))return!1;var le=pc(V)?ct:xe;return le.test(ks(V))}function Sl(V){return Ma(V)&&pm(V.length)&&!!Ee[Es(V)]}function hc(V){if(!ju(V))return mn(V);var le=[];for(var Me in Object(V))re.call(V,Me)&&Me!="constructor"&&le.push(Me);return le}function Pa(V,le,Me,Ye,wn,wt){var Ln=Me&s,xr=V.length,Nn=le.length;if(xr!=Nn&&!(Ln&&Nn>xr))return!1;var An=wt.get(V);if(An&&wt.get(le))return An==le;var qr=-1,vo=!0,wr=Me&o?new Yt:void 0;for(wt.set(V,le),wt.set(le,V);++qr<xr;){var as=V[qr],Qs=le[qr];if(Ye)var pr=Ln?Ye(Qs,as,qr,le,V,wt):Ye(as,Qs,qr,V,le,wt);if(pr!==void 0){if(pr)continue;vo=!1;break}if(wr){if(!vr(le,function(Ps,Ki){if(!Sr(wr,Ki)&&(as===Ps||wn(as,Ps,Me,Ye,wt)))return wr.push(Ki)})){vo=!1;break}}else if(!(as===Qs||wn(as,Qs,Me,Ye,wt))){vo=!1;break}}return wt.delete(V),wt.delete(le),vo}function yo(V,le,Me,Ye,wn,wt,Ln){switch(Me){case K:if(V.byteLength!=le.byteLength||V.byteOffset!=le.byteOffset)return!1;V=V.buffer,le=le.buffer;case B:return!(V.byteLength!=le.byteLength||!wt(new Tn(V),new Tn(le)));case u:case p:case S:return Wi(+V,+le);case f:return V.name==le.name&&V.message==le.message;case M:case D:return V==le+"";case b:var xr=Rr;case R:var Nn=Ye&s;if(xr||(xr=Zs),V.size!=le.size&&!Nn)return!1;var An=Ln.get(V);if(An)return An==le;Ye|=o,Ln.set(V,le);var qr=Pa(xr(V),xr(le),Ye,wn,wt,Ln);return Ln.delete(V),qr;case N:if(Ca)return Ca.call(V)==Ca.call(le)}return!1}function Mu(V,le,Me,Ye,wn,wt){var Ln=Me&s,xr=Au(V),Nn=xr.length,An=Au(le),qr=An.length;if(Nn!=qr&&!Ln)return!1;for(var vo=Nn;vo--;){var wr=xr[vo];if(!(Ln?wr in le:re.call(le,wr)))return!1}var as=wt.get(V);if(as&&wt.get(le))return as==le;var Qs=!0;wt.set(V,le),wt.set(le,V);for(var pr=Ln;++vo<Nn;){wr=xr[vo];var Ps=V[wr],Ki=le[wr];if(Ye)var fc=Ln?Ye(Ki,Ps,wr,le,V,wt):Ye(Ps,Ki,wr,V,le,wt);if(!(fc===void 0?Ps===Ki||wn(Ps,Ki,Me,Ye,wt):fc)){Qs=!1;break}pr||(pr=wr=="constructor")}if(Qs&&!pr){var Ru=V.constructor,gc=le.constructor;Ru!=gc&&"constructor"in V&&"constructor"in le&&!(typeof Ru=="function"&&Ru instanceof Ru&&typeof gc=="function"&&gc instanceof gc)&&(Qs=!1)}return wt.delete(V),wt.delete(le),Qs}function Au(V){return qo(V,sS,yp)}function nn(V,le){var Me=V.__data__;return um(le)?Me[typeof le=="string"?"string":"hash"]:Me.map}function xl(V,le){var Me=dr(V,le);return wd(Me)?Me:void 0}function cm(V){var le=re.call(V,kn),Me=V[kn];try{V[kn]=void 0;var Ye=!0}catch{}var wn=Fe.call(V);return Ye&&(le?V[kn]=Me:delete V[kn]),wn}var yp=Yn?function(V){return V==null?[]:(V=Object(V),Kt(Yn(V),function(le){return qt.call(V,le)}))}:Ed,Gi=Es;(At&&Gi(new At(new ArrayBuffer(1)))!=K||On&&Gi(new On)!=b||ur&&Gi(ur.resolve())!=T||is&&Gi(new is)!=R||Vr&&Gi(new Vr)!=L)&&(Gi=function(V){var le=Es(V),Me=le==E?V.constructor:void 0,Ye=Me?ks(Me):"";if(Ye)switch(Ye){case Cs:return K;case go:return b;case Hi:return T;case bl:return R;case ac:return L}return le});function dm(V,le){return le=le??i,!!le&&(typeof V=="number"||Oe.test(V))&&V>-1&&V%1==0&&V<le}function um(V){var le=typeof V;return le=="string"||le=="number"||le=="symbol"||le=="boolean"?V!=="__proto__":V===null}function vp(V){return!!we&&we in V}function ju(V){var le=V&&V.constructor,Me=typeof le=="function"&&le.prototype||he;return V===Me}function Ia(V){return Fe.call(V)}function ks(V){if(V!=null){try{return $e.call(V)}catch{}try{return V+""}catch{}}return""}function Wi(V,le){return V===le||V!==V&&le!==le}var Cd=Js(function(){return arguments}())?Js:function(V){return Ma(V)&&re.call(V,"callee")&&!qt.call(V,"callee")},_a=Array.isArray;function Ta(V){return V!=null&&pm(V.length)&&!pc(V)}var bp=Mn||kd;function hm(V,le){return ka(V,le)}function pc(V){if(!Sp(V))return!1;var le=Es(V);return le==m||le==v||le==c||le==w}function pm(V){return typeof V=="number"&&V>-1&&V%1==0&&V<=i}function Sp(V){var le=typeof V;return V!=null&&(le=="object"||le=="function")}function Ma(V){return V!=null&&typeof V=="object"}var xp=sn?Qn(sn):Sl;function sS(V){return Ta(V)?Ea(V):hc(V)}function Ed(){return[]}function kd(){return!1}r.exports=hm}(ff,ff.exports)),ff.exports}var KW=WW();const U3=ec(KW);function VW(r){if(r.length===0)return new Set;const e=r[0],t=r.slice(1),n=new Set;for(const s of e)t.every(o=>o.has(s))&&n.add(s);return n}function qW(r,e){const t={};for(const n of e)r.has(n)||(t.added??(t.added=new Set),t.added.add(n));for(const n of r)e.has(n)||(t.removed??(t.removed=new Set),t.removed.add(n));return t.added||t.removed?t:void 0}function Mj(r,e){for(const[t,n]of Object.entries(r)){const s=n,o=e[t];if("eq"in s&&o!==s.eq||"neq"in s&&o===s.neq||"gt"in s&&(typeof o!="number"||o<=s.gt))return!1}return!0}function Aj(r,e,t){const n=Object.fromEntries(Object.keys(t).map(s=>[s,new Set]));for(const[s,o]of Object.entries(t))if("eq"in o){const a=r.index(e,s).get().get(o.eq);if(a)for(const l of a)n[s].add(l)}else if("neq"in o){const i=r.index(e,s);for(const[a,l]of i.get())if(a!==o.neq)for(const c of l)n[s].add(c)}else if("gt"in o){const i=r.index(e,s);for(const[a,l]of i.get())if(a>o.gt)for(const c of l)n[s].add(c)}return VW(Object.values(n))}class YW{constructor(e,t){k(this,"indexCache",new Map);k(this,"historyCache",new Map);this.atoms=e,this.history=t}filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);const t=Ie("filterHistory:"+e,(n,s)=>{if(tu(n))return this.history.get();const o=this.history.getDiffSince(s);if(o===oi)return this.history.get();const i={added:{},removed:{},updated:{}};let a=0,l=0,c=0;for(const u of o){for(const p of ir(u.added))if(p.typeName===e)if(i.removed[p.id]){const f=i.removed[p.id];delete i.removed[p.id],l--,f!==p&&(i.updated[p.id]=[f,p],c++)}else i.added[p.id]=p,a++;for(const[p,f]of ir(u.updated))f.typeName===e&&(i.added[f.id]?i.added[f.id]=f:i.updated[f.id]?i.updated[f.id]=[i.updated[f.id][0],f]:(i.updated[f.id]=[p,f],c++));for(const p of ir(u.removed))p.typeName===e&&(i.added[p.id]?(delete i.added[p.id],a--):i.updated[p.id]?(i.removed[p.id]=i.updated[p.id][0],delete i.updated[p.id],c--,l++):(i.removed[p.id]=p,l++))}return a||l||c?pf(this.history.get(),i):n},{historyLength:100});return this.historyCache.set(e,t),t}index(e,t){const n=e+":"+t;if(this.indexCache.has(n))return this.indexCache.get(n);const s=this.__uncached_createIndex(e,t);return this.indexCache.set(n,s),s}__uncached_createIndex(e,t){const n=this.filterHistory(e),s=()=>{n.get();const o=new Map;for(const i of ir(this.atoms.get())){const a=i.get();if(a.typeName===e){const l=a[t];o.has(l)||o.set(l,new Set),o.get(l).add(a.id)}}return o};return Ie("index:"+e+":"+t,(o,i)=>{if(tu(o))return s();const a=n.getDiffSince(i);if(a===oi)return s();const l=new Map,c=(m,v)=>{let b=l.get(m);b||(b=new qy(o.get(m)??new Set)),b.add(v),l.set(m,b)},u=(m,v)=>{let b=l.get(m);b||(b=new qy(o.get(m)??new Set)),b.remove(v),l.set(m,b)};for(const m of a){for(const v of ir(m.added))if(v.typeName===e){const b=v[t];c(b,v.id)}for(const[v,b]of ir(m.updated))if(b.typeName===e){const S=v[t],C=b[t];S!==C&&(u(S,b.id),c(C,b.id))}for(const v of ir(m.removed))if(v.typeName===e){const b=v[t];u(b,v.id)}}let p,f;for(const[m,v]of l){const b=v.get();b&&(p||(p=new Map(o)),f||(f=new Map),b.value.size===0?p.delete(m):p.set(m,b.value),f.set(m,b.diff))}return p&&f?pf(p,f):o},{historyLength:100})}record(e,t=()=>({}),n="record:"+e+(t?":"+t.toString():"")){const s=this.ids(e,t,n);return Ie(n,()=>{var o;for(const i of s.get())return(o=this.atoms.get()[i])==null?void 0:o.get()})}records(e,t=()=>({}),n="records:"+e+(t?":"+t.toString():"")){const s=this.ids(e,t,"ids:"+n);return Ie(n,()=>{const o=this.atoms.get();return[...s.get()].map(i=>{const a=o[i];if(!a)throw new Error("no atom found for record id: "+i);return a.get()})},{isEqual:AO})}ids(e,t=()=>({}),n="ids:"+e+(t?":"+t.toString():"")){const s=this.filterHistory(e),o=()=>{s.get();const l=t();return Object.keys(l).length===0?new Set(ir(this.atoms.get()).flatMap(c=>{const u=c.get();return u.typeName===e?u.id:[]})):Aj(this,e,l)},i=l=>{const c=o(),u=qW(l,c);return u?pf(c,u):l},a=Ie("ids_query:"+n,t,{isEqual:U3});return Ie("query:"+n,(l,c)=>{const u=a.get();if(tu(l))return o();if(c<a.lastChangedEpoch)return i(l);const p=s.getDiffSince(c);if(p===oi)return i(l);const f=new qy(l);for(const v of p){for(const b of ir(v.added))b.typeName===e&&Mj(u,b)&&f.add(b.id);for(const[b,S]of ir(v.updated))S.typeName===e&&(Mj(u,S)?f.add(S.id):f.remove(S.id));for(const b of ir(v.removed))b.typeName===e&&f.remove(b.id)}const m=f.get();return m?pf(m.value,m.diff):l},{historyLength:50})}exec(e,t){const n=Aj(this,e,t);if(n.size===0)return Gl;const s=this.atoms.get();return[...n].map(o=>s[o].get())}}class XW{constructor(e){k(this,"_beforeCreateHandlers",{});k(this,"_afterCreateHandlers",{});k(this,"_beforeChangeHandlers",{});k(this,"_afterChangeHandlers",{});k(this,"_beforeDeleteHandlers",{});k(this,"_afterDeleteHandlers",{});k(this,"_operationCompleteHandlers",[]);k(this,"_isEnabled",!0);this.store=e}isEnabled(){return this._isEnabled}setIsEnabled(e){this._isEnabled=e}handleBeforeCreate(e,t){if(!this._isEnabled)return e;const n=this._beforeCreateHandlers[e.typeName];if(n){let s=e;for(const o of n)s=o(s,t);return s}return e}handleAfterCreate(e,t){if(!this._isEnabled)return;const n=this._afterCreateHandlers[e.typeName];if(n)for(const s of n)s(e,t)}handleBeforeChange(e,t,n){if(!this._isEnabled)return t;const s=this._beforeChangeHandlers[t.typeName];if(s){let o=t;for(const i of s)o=i(e,o,n);return o}return t}handleAfterChange(e,t,n){if(!this._isEnabled)return;const s=this._afterChangeHandlers[t.typeName];if(s)for(const o of s)o(e,t,n)}handleBeforeDelete(e,t){if(!this._isEnabled)return!0;const n=this._beforeDeleteHandlers[e.typeName];if(n){for(const s of n)if(s(e,t)===!1)return!1}return!0}handleAfterDelete(e,t){if(!this._isEnabled)return;const n=this._afterDeleteHandlers[e.typeName];if(n)for(const s of n)s(e,t)}handleOperationComplete(e){if(this._isEnabled)for(const t of this._operationCompleteHandlers)t(e)}register(e){const t=[];for(const[n,s]of Object.entries(e))s!=null&&s.beforeCreate&&t.push(this.registerBeforeCreateHandler(n,s.beforeCreate)),s!=null&&s.afterCreate&&t.push(this.registerAfterCreateHandler(n,s.afterCreate)),s!=null&&s.beforeChange&&t.push(this.registerBeforeChangeHandler(n,s.beforeChange)),s!=null&&s.afterChange&&t.push(this.registerAfterChangeHandler(n,s.afterChange)),s!=null&&s.beforeDelete&&t.push(this.registerBeforeDeleteHandler(n,s.beforeDelete)),s!=null&&s.afterDelete&&t.push(this.registerAfterDeleteHandler(n,s.afterDelete));return()=>{for(const n of t)n()}}registerBeforeCreateHandler(e,t){return this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(t),()=>Fd(this._beforeCreateHandlers[e],t)}registerAfterCreateHandler(e,t){return this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(t),()=>Fd(this._afterCreateHandlers[e],t)}registerBeforeChangeHandler(e,t){return this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(t),()=>Fd(this._beforeChangeHandlers[e],t)}registerAfterChangeHandler(e,t){return this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(t),()=>Fd(this._afterChangeHandlers[e],t)}registerBeforeDeleteHandler(e,t){return this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(t),()=>Fd(this._beforeDeleteHandlers[e],t)}registerAfterDeleteHandler(e,t){return this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(t),()=>Fd(this._afterDeleteHandlers[e],t)}registerOperationCompleteHandler(e){return this._operationCompleteHandlers.push(e),()=>Fd(this._operationCompleteHandlers,e)}}function Fd(r,e){const t=r.indexOf(e);t>=0&&r.splice(t,1)}class i2{constructor(e){k(this,"id");k(this,"atoms",$r("store_atoms",{}));k(this,"history",$r("history",0,{historyLength:1e3}));k(this,"query",new YW(this.atoms,this.history));k(this,"listeners",new Set);k(this,"historyAccumulator",new JW);k(this,"historyReactor");k(this,"schema");k(this,"props");k(this,"scopedTypes");k(this,"sideEffects",new XW(this));k(this,"isMergingRemoteChanges",!1);k(this,"_integrityChecker");k(this,"_isPossiblyCorrupted",!1);k(this,"pendingAfterEvents",null);k(this,"_isInAtomicOp",!1);const{initialData:t,schema:n,id:s}=e;this.id=s??Cn(),this.schema=n,this.props=e.props,t&&this.atoms.set(Nk(Ho(t).map(([o,i])=>[o,$r("atom:"+o,this.schema.validateRecord(this,i,"initialize",null))]))),this.historyReactor=pW("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:o=>this.cancelHistoryReactor=ZO(o)}),this.scopedTypes={document:new Set(ir(this.schema.types).filter(o=>o.scope==="document").map(o=>o.typeName)),session:new Set(ir(this.schema.types).filter(o=>o.scope==="session").map(o=>o.typeName)),presence:new Set(ir(this.schema.types).filter(o=>o.scope==="presence").map(o=>o.typeName))}}cancelHistoryReactor(){}_flushHistory(){if(this.historyAccumulator.hasChanges()){const e=this.historyAccumulator.flush();for(const{changes:t,source:n}of e){let s=null,o=null,i=null;for(const{onHistory:a,filters:l}of this.listeners)if(!(l.source!=="all"&&l.source!==n))if(l.scope!=="all")if(l.scope==="document"){if(o??(o=this.filterChangesByScope(t,"document")),!o)continue;a({changes:o,source:n})}else if(l.scope==="session"){if(s??(s=this.filterChangesByScope(t,"session")),!s)continue;a({changes:s,source:n})}else{if(i??(i=this.filterChangesByScope(t,"presence")),!i)continue;a({changes:i,source:n})}else a({changes:t,source:n})}}}dispose(){this.cancelHistoryReactor()}filterChangesByScope(e,t){const n={added:Pf(e.added,(s,o)=>this.scopedTypes[t].has(o.typeName)),updated:Pf(e.updated,(s,o)=>this.scopedTypes[t].has(o[1].typeName)),removed:Pf(e.removed,(s,o)=>this.scopedTypes[t].has(o.typeName))};return Object.keys(n.added).length===0&&Object.keys(n.updated).length===0&&Object.keys(n.removed).length===0?null:n}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),this.listeners.size===0&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach(t=>this.schema.validateRecord(this,t,e,null))}put(e,t){this.atomic(()=>{const n={},s={},o=this.atoms.__unsafe__getWithoutCapture();let i=null,a,l=!1;const c=this.isMergingRemoteChanges?"remote":"user";for(let u=0,p=e.length;u<p;u++){a=e[u];const f=(i??o)[a.id];if(f){const m=f.__unsafe__getWithoutCapture();if(a=this.sideEffects.handleBeforeChange(m,a,c),this.schema.validateRecord(this,a,t??"updateRecord",m)===m)continue;f.set(a),l=!0;const b=f.__unsafe__getWithoutCapture();n[a.id]=[m,b],this.addDiffForAfterEvent(m,b)}else a=this.sideEffects.handleBeforeCreate(a,c),l=!0,a=this.schema.validateRecord(this,a,t??"createRecord",null),s[a.id]=a,this.addDiffForAfterEvent(null,a),i||(i={...o}),i[a.id]=$r("atom:"+a.id,a)}i&&this.atoms.set(i),l&&this.updateHistory({added:s,updated:n,removed:{}})})}remove(e){this.atomic(()=>{const t=new Set,n=this.isMergingRemoteChanges?"remote":"user";if(this.sideEffects.isEnabled())for(const o of e){const i=this.atoms.__unsafe__getWithoutCapture()[o];i&&this.sideEffects.handleBeforeDelete(i.get(),n)===!1&&t.add(o)}let s;this.atoms.update(o=>{let i;for(const a of e){if(t.has(a)||!(a in o))continue;i||(i={...o}),s||(s={}),delete i[a];const l=o[a].get();s[a]=l,this.addDiffForAfterEvent(l,null)}return i??o}),s&&this.updateHistory({added:{},updated:{},removed:s})})}get(e){var t;return(t=this.atoms.get()[e])==null?void 0:t.get()}unsafeGetWithoutCapture(e){var t;return(t=this.atoms.__unsafe__getWithoutCapture()[e])==null?void 0:t.__unsafe__getWithoutCapture()}serialize(e="document"){const t={};for(const[n,s]of Ho(this.atoms.get())){const o=s.get();(e==="all"||this.scopedTypes[e].has(o.typeName))&&(t[n]=o)}return t}getStoreSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}getSnapshot(e="document"){return console.warn("[tldraw] `Store.getSnapshot` is deprecated and will be removed in a future release. Use `getSnapshot` from the `tldraw` package instead."),this.getStoreSnapshot(e)}migrateSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if(t.type==="error")throw new Error(`Failed to migrate snapshot: ${t.reason}`);return{store:t.value,schema:this.schema.serialize()}}loadStoreSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if(t.type==="error")throw new Error(`Failed to migrate snapshot: ${t.reason}`);const n=this.sideEffects.isEnabled();try{this.sideEffects.setIsEnabled(!1),this.atomic(()=>{this.clear(),this.put(Object.values(t.value)),this.ensureStoreIsUsable()})}finally{this.sideEffects.setIsEnabled(n)}}loadSnapshot(e){console.warn("[tldraw] `Store.loadSnapshot` is deprecated and will be removed in a future release. Use `loadSnapshot` from the 'tldraw' package instead."),this.loadStoreSnapshot(e)}allRecords(){return ir(this.atoms.get()).map(e=>e.get())}clear(){this.remove(rM(this.atoms.get()))}update(e,t){const n=this.atoms.get()[e];if(!n){console.error(`Record ${e} not found. This is probably an error`);return}this.put([t(n.__unsafe__getWithoutCapture())])}has(e){return!!this.atoms.get()[e]}listen(e,t){this._flushHistory();const n={onHistory:e,filters:{source:(t==null?void 0:t.source)??"all",scope:(t==null?void 0:t.scope)??"all"}};return this.historyReactor.scheduler.isActivelyListening||(this.historyReactor.start(),this.historyReactor.scheduler.execute()),this.listeners.add(n),()=>{this.listeners.delete(n),this.listeners.size===0&&this.historyReactor.stop()}}mergeRemoteChanges(e){if(this.isMergingRemoteChanges)return e();if(this._isInAtomicOp)throw new Error("Cannot merge remote changes while in atomic operation");try{this.isMergingRemoteChanges=!0,rl(e)}finally{this.isMergingRemoteChanges=!1,this.ensureStoreIsUsable()}}extractingChanges(e){const t=[],n=this.historyAccumulator.addInterceptor(s=>t.push(s.changes));try{return rl(e),o2(t)}finally{n()}}applyDiff(e,{runCallbacks:t=!0,ignoreEphemeralKeys:n=!1}={}){this.atomic(()=>{const s=ir(e.added);for(const[i,a]of ir(e.updated)){const l=this.schema.getType(a.typeName);if(n&&l.ephemeralKeySet.size){const c=this.get(a.id);if(!c){s.push(a);continue}let u=null;for(const[p,f]of Object.entries(a))l.ephemeralKeySet.has(p)||Object.is(f,Ws(c,p))||(u||(u={...c}),u[p]=f);u&&s.push(u)}else s.push(a)}const o=rM(e.removed);s.length&&this.put(s),o.length&&this.remove(o)},t)}createComputedCache(e,t,n){const s=new il;return{get:o=>{const i=this.atoms.get()[o];if(i)return s.get(i,()=>{const a=n?Ie(i.name+":equals",()=>i.get(),{isEqual:n}):i;return Ie(e+":"+o,()=>t(a.get()))}).get()}}}createSelectedComputedCache(e,t,n){const s=new il;return{get:o=>{const i=this.atoms.get()[o];if(i)return s.get(i,()=>{const a=Ie(e+":"+o+":selector",()=>t(i.get()));return Ie(e+":"+o,()=>n(a.get()))}).get()}}}ensureStoreIsUsable(){this.atomic(()=>{var e;this._integrityChecker??(this._integrityChecker=this.schema.createIntegrityChecker(this)),(e=this._integrityChecker)==null||e.call(this)})}markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}addDiffForAfterEvent(e,t){if(fn(this.pendingAfterEvents,"must be in event operation"),e===t||(e&&t&&fn(e.id===t.id),!e&&!t))return;const n=(e||t).id,s=this.pendingAfterEvents.get(n);s?s.after=t:this.pendingAfterEvents.set(n,{before:e,after:t})}flushAtomicCallbacks(){let e=0;const t=this.isMergingRemoteChanges?"remote":"user";for(;this.pendingAfterEvents;){const n=this.pendingAfterEvents;if(this.pendingAfterEvents=null,!!this.sideEffects.isEnabled()){if(e++,e>100)throw new Error("Maximum store update depth exceeded, bailing out");for(const{before:s,after:o}of n.values())s&&o?this.sideEffects.handleAfterChange(s,o,t):s&&!o?this.sideEffects.handleAfterDelete(s,t):!s&&o&&this.sideEffects.handleAfterCreate(o,t);this.pendingAfterEvents||this.sideEffects.handleOperationComplete(t)}}}atomic(e,t=!0){return rl(()=>{if(this._isInAtomicOp)return this.pendingAfterEvents||(this.pendingAfterEvents=new Map),e();this.pendingAfterEvents=new Map;const n=this.sideEffects.isEnabled();this.sideEffects.setIsEnabled(t??n),this._isInAtomicOp=!0;try{const s=e();return this.flushAtomicCallbacks(),s}finally{this.pendingAfterEvents=null,this.sideEffects.setIsEnabled(n),this._isInAtomicOp=!1}})}addHistoryInterceptor(e){return this.historyAccumulator.addInterceptor(t=>e(t,this.isMergingRemoteChanges?"remote":"user"))}}function ZW(r){if(r.length===0)return[];const e=[];let t=[r[0]],n;for(let s=1,o=r.length;s<o;s++)n=r[s],t[0].source!==n.source&&(e.push(t),t=[]),t.push(n);return e.push(t),e.map(s=>({source:s[0].source,changes:o2(s.map(o=>o.changes))}))}class JW{constructor(){k(this,"_history",[]);k(this,"_interceptors",new Set)}addInterceptor(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){this._history.push(e);for(const t of this._interceptors)t(e)}flush(){const e=ZW(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function QW(r,e,t){const n=new il;return{get(s,o){return n.get(s,()=>(s instanceof i2?s:s.store).createComputedCache(r,l=>e(s,l),t)).get(o)}}}function eK(r){const e=[];for(let t=r.length-1;t>=0;t--){const n=r[t];if("id"in n)e.unshift(n);else{const s=n.dependsOn,o=e[0];o&&(e[0]={...o,dependsOn:s.concat(o.dependsOn??[])})}}return e}function Ch({sequence:r,sequenceId:e,retroactive:t=!0}){const n={sequenceId:e,retroactive:t,sequence:eK(r)};return H3(n),n}function Wo(r,e){return Object.fromEntries(Ho(e).map(([t,n])=>[t,`${r}/${n}`]))}function fi(r){const e=r.sequenceId;return Ch({sequenceId:e,retroactive:r.retroactive??!0,sequence:r.sequence.map(t=>"id"in t?{...t,scope:"record",filter:n=>{var s,o;return n.typeName===r.recordType&&(((s=t.filter)==null?void 0:s.call(t,n))??!0)&&(((o=r.filter)==null?void 0:o.call(r,n))??!0)}}:t)})}function tK(r){const e=new Map(r.map(o=>[o.id,o])),t=new Set,n=[];function s(o){fn(!t.has(o.id),`Circular dependency in migrations: ${o.id}`),t.add(o.id);const{version:i,sequenceId:a}=$v(o.id),l=e.get(`${a}/${i-1}`);if(l&&s(l),o.dependsOn)for(const c of o.dependsOn){const u=e.get(c);u&&s(u)}e.delete(o.id),n.push(o)}for(const o of e.values())s(o);return n}function $v(r){const[e,t]=r.split("/");return{sequenceId:e,version:parseInt(t)}}function jj(r,e){e&&fn(r.startsWith(e+"/"),`Every migration in sequence '${e}' must have an id starting with '${e}/'. Got invalid id: '${r}'`),fn(r.match(/^(.*?)\/(0|[1-9]\d*)$/),`Invalid migration id: '${r}'`)}function H3(r){if(fn(!r.sequenceId.includes("/"),`sequenceId cannot contain a '/', got ${r.sequenceId}`),fn(r.sequenceId.length,"sequenceId must be a non-empty string"),r.sequence.length===0)return;jj(r.sequence[0].id,r.sequenceId);let e=$v(r.sequence[0].id).version;fn(e===1,`Expected the first migrationId to be '${r.sequenceId}/1' but got '${r.sequence[0].id}'`);for(let t=1;t<r.sequence.length;t++){const n=r.sequence[t].id;jj(n,r.sequenceId);const s=$v(n).version;fn(s===e+1,`Migration id numbers must increase in increments of 1, expected ${r.sequenceId}/${e+1} but got '${r.sequence[t].id}'`),e=s}}var Oc=(r=>(r.IncompatibleSubtype="incompatible-subtype",r.UnknownType="unknown-type",r.TargetVersionTooNew="target-version-too-new",r.TargetVersionTooOld="target-version-too-old",r.MigrationError="migration-error",r.UnrecognizedSubtype="unrecognized-subtype",r))(Oc||{});function nK(r){if(r.schemaVersion>2||r.schemaVersion<1)return Xc.err("Bad schema version");if(r.schemaVersion===2)return Xc.ok(r);const e={schemaVersion:2,sequences:{"com.tldraw.store":r.storeVersion}};for(const[t,n]of Object.entries(r.recordVersions))if(e.sequences[`com.tldraw.${t}`]=n.version,"subTypeKey"in n)for(const[s,o]of Object.entries(n.subTypeVersions))e.sequences[`com.tldraw.${t}.${s}`]=o;return Xc.ok(e)}class a2{constructor(e,t){k(this,"migrations",{});k(this,"sortedMigrations");var s;this.types=e,this.options=t;for(const o of t.migrations??[])fn(!this.migrations[o.sequenceId],`Duplicate migration sequenceId ${o.sequenceId}`),H3(o),this.migrations[o.sequenceId]=o;const n=Object.values(this.migrations).flatMap(o=>o.sequence);this.sortedMigrations=tK(n);for(const o of this.sortedMigrations)if((s=o.dependsOn)!=null&&s.length)for(const i of o.dependsOn){const a=n.find(l=>l.id===i);fn(a,`Migration '${o.id}' depends on missing migration '${i}'`)}}static create(e,t){return new a2(e,t??{})}validateRecord(e,t,n,s){try{const o=Ws(this.types,t.typeName);if(!o)throw new Error(`Missing definition for record type ${t.typeName}`);return o.validate(t,s??void 0)}catch(o){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:t,phase:n,recordBefore:s,error:o});throw o}}getMigrationsSince(e){const t=nK(e);if(!t.ok)return t;const n=t.value,s=new Set(Object.keys(n.sequences).filter(i=>this.migrations[i]));for(const i in this.migrations)n.sequences[i]===void 0&&this.migrations[i].retroactive&&s.add(i);if(s.size===0)return Xc.ok([]);const o=new Set;for(const i of s){const a=n.sequences[i];if(typeof a!="number"&&this.migrations[i].retroactive||a===0){for(const u of this.migrations[i].sequence)o.add(u.id);continue}const l=`${i}/${a}`,c=this.migrations[i].sequence.findIndex(u=>u.id===l);if(c===-1)return Xc.err("Incompatible schema?");for(const u of this.migrations[i].sequence.slice(c+1))o.add(u.id)}return Xc.ok(this.sortedMigrations.filter(({id:i})=>o.has(i)))}migratePersistedRecord(e,t,n="up"){const s=this.getMigrationsSince(t);if(!s.ok)return console.error("Error migrating record",s.error),{type:"error",reason:Oc.MigrationError};let o=s.value;if(o.length===0)return{type:"success",value:e};if(o.some(i=>i.scope==="store"))return{type:"error",reason:n==="down"?Oc.TargetVersionTooOld:Oc.TargetVersionTooNew};if(n==="down"){if(!o.every(i=>i.down))return{type:"error",reason:Oc.TargetVersionTooOld};o=o.slice().reverse()}e=Kn(e);try{for(const i of o){if(i.scope==="store")throw new Error;if(!(i.filter?i.filter(e):!0))continue;const l=i[n](e);l&&(e=Kn(l))}}catch(i){return console.error("Error migrating record",i),{type:"error",reason:Oc.MigrationError}}return{type:"success",value:e}}migrateStoreSnapshot(e){let{store:t}=e;const n=this.getMigrationsSince(e.schema);if(!n.ok)return console.error("Error migrating store",n.error),{type:"error",reason:Oc.MigrationError};const s=n.value;if(s.length===0)return{type:"success",value:t};t=Kn(t);try{for(const o of s)if(o.scope==="record")for(const[i,a]of Object.entries(t)){if(!(o.filter?o.filter(a):!0))continue;const c=o.up(a);c&&(t[i]=Kn(c))}else if(o.scope==="store"){const i=o.up(t);i&&(t=Kn(i))}else rs(o)}catch(o){return console.error("Error migrating store",o),{type:"error",reason:Oc.MigrationError}}return{type:"success",value:t}}createIntegrityChecker(e){var t,n;return((n=(t=this.options).createIntegrityChecker)==null?void 0:n.call(t,e))??void 0}serialize(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e,sequence:t})=>[e,t.length?$v(t.at(-1).id).version:0]))}}serializeEarliestVersion(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e})=>[e,0]))}}getType(e){const t=Ws(this.types,e);return fn(t,"record type does not exists"),t}}dd("@tldraw/store","3.7.0","esm");function rK(r){if(!r.length)return null;let e="";for(const t of r)typeof t=="number"?e+=`.${t}`:t.startsWith("(")?e.endsWith(")")?e=`${e.slice(0,-1)}, ${t.slice(1)}`:e+=t:e+=`.${t}`;return e=e.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,""),e.startsWith(".")?e.slice(1):e}class en extends Error{constructor(t,n=[]){const s=rK(n),o=t.split(`
`).map((i,a)=>a===0?i:`  ${i}`).join(`
`);super(n?`At ${s}: ${o}`:o);k(this,"name","ValidationError");this.rawMessage=t,this.path=n}}function Go(r,e){try{return e()}catch(t){throw t instanceof en?new en(t.rawMessage,[r,...t.path]):new en(t.toString(),[r])}}function rd(r){if(r===null)return"null";if(Array.isArray(r))return"an array";const e=typeof r;switch(e){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${e}`;case"object":return`an ${e}`;case"undefined":return"undefined";default:rs(e)}}class uo{constructor(e,t){this.validationFn=e,this.validateUsingKnownGoodVersionFn=t}validate(e){return this.validationFn(e)}validateUsingKnownGoodVersion(e,t){return Object.is(e,t)?e:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(e,t):this.validate(t)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){return cK(this)}optional(){return W3(this)}refine(e){return new uo(t=>e(this.validate(t)),(t,n)=>{const s=this.validateUsingKnownGoodVersion(t,n);return Object.is(t,s)?t:e(s)})}check(e,t){return typeof e=="string"?this.refine(n=>(Go(`(check ${e})`,()=>t(n)),n)):this.refine(n=>(e(n),n))}}class sK extends uo{constructor(e){super(t=>{const n=Rj.validate(t);for(let s=0;s<n.length;s++)Go(s,()=>e.validate(n[s]));return n},(t,n)=>{if(!e.validateUsingKnownGoodVersion)return this.validate(n);const s=Rj.validate(n);let o=t.length!==s.length;for(let i=0;i<s.length;i++){const a=s[i];if(i>=t.length){o=!0,Go(i,()=>e.validate(a));continue}if(Object.is(t[i],a))continue;const l=Go(i,()=>e.validateUsingKnownGoodVersion(t[i],a));Object.is(l,t[i])||(o=!0)}return o?n:t}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(e.length===0)throw new en("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new en("Expected an array with length greater than 1")})}}class Bv extends uo{constructor(e,t=!1){super(n=>{if(typeof n!="object"||n===null)throw new en(`Expected object, got ${rd(n)}`);for(const[s,o]of Object.entries(e))Go(s,()=>{o.validate(Ws(n,s))});if(!t){for(const s of Object.keys(n))if(!ua(e,s))throw new en("Unexpected property",[s])}return n},(n,s)=>{if(typeof s!="object"||s===null)throw new en(`Expected object, got ${rd(s)}`);let o=!1;for(const[i,a]of Object.entries(e)){const l=Ws(n,i),c=Ws(s,i);if(Object.is(l,c))continue;const u=Go(i,()=>{const p=a;return p.validateUsingKnownGoodVersion?p.validateUsingKnownGoodVersion(l,c):p.validate(c)});Object.is(u,l)||(o=!0)}if(!t){for(const i of Object.keys(s))if(!ua(e,i))throw new en("Unexpected property",[i])}for(const i of Object.keys(n))if(!ua(s,i)){o=!0;break}return o?s:n}),this.config=e,this.shouldAllowUnknownProperties=t}allowUnknownProperties(){return new Bv(this.config,!0)}extend(e){return new Bv({...this.config,...e})}}class Y0 extends uo{constructor(e,t,n,s){super(o=>{this.expectObject(o);const{matchingSchema:i,variant:a}=this.getMatchingSchemaAndVariant(o);return i===void 0?this.unknownValueValidation(o,a):Go(`(${e} = ${a})`,()=>i.validate(o))},(o,i)=>{this.expectObject(i),this.expectObject(o);const{matchingSchema:a,variant:l}=this.getMatchingSchemaAndVariant(i);return a===void 0?this.unknownValueValidation(i,l):Ws(o,e)!==Ws(i,e)?Go(`(${e} = ${l})`,()=>a.validate(i)):Go(`(${e} = ${l})`,()=>a.validateUsingKnownGoodVersion?a.validateUsingKnownGoodVersion(o,i):a.validate(i))}),this.key=e,this.config=t,this.unknownValueValidation=n,this.useNumberKeys=s}expectObject(e){if(typeof e!="object"||e===null)throw new en(`Expected an object, got ${rd(e)}`,[])}getMatchingSchemaAndVariant(e){const t=Ws(e,this.key);if(!this.useNumberKeys&&typeof t!="string")throw new en(`Expected a string for key "${this.key}", got ${rd(t)}`);if(this.useNumberKeys&&!Number.isFinite(Number(t)))throw new en(`Expected a number for key "${this.key}", got "${t}"`);return{matchingSchema:ua(this.config,t)?this.config[t]:void 0,variant:t}}validateUnknownVariants(e){return new Y0(this.key,this.config,e,this.useNumberKeys)}}class oK extends uo{constructor(e,t){super(n=>{if(typeof n!="object"||n===null)throw new en(`Expected object, got ${rd(n)}`);for(const[s,o]of Object.entries(n))Go(s,()=>{e.validate(s),t.validate(o)});return n},(n,s)=>{if(typeof s!="object"||s===null)throw new en(`Expected object, got ${rd(s)}`);let o=!1;for(const[i,a]of Object.entries(s)){if(!ua(n,i)){o=!0,Go(i,()=>{e.validate(i),t.validate(a)});continue}const l=Ws(n,i),c=a;if(Object.is(l,c))continue;const u=Go(i,()=>t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(l,c):t.validate(c));Object.is(u,l)||(o=!0)}for(const i of Object.keys(n))if(!ua(s,i)){o=!0;break}return o?s:n}),this.keyValidator=e,this.valueValidator=t}}function l2(r){return new uo(e=>{if(typeof e!==r)throw new en(`Expected ${r}, got ${rd(e)}`);return e})}const iK=new uo(r=>r),Tt=l2("string"),yt=l2("number").check(r=>{if(Number.isNaN(r))throw new en("Expected a number, got NaN");if(!Number.isFinite(r))throw new en(`Expected a finite number, got ${r}`)}),Uv=yt.check(r=>{if(r<0)throw new en(`Expected a positive number, got ${r}`)}),Mr=yt.check(r=>{if(r<=0)throw new en(`Expected a non-zero positive number, got ${r}`)}),G3=yt.check(r=>{if(!Number.isInteger(r))throw new en(`Expected an integer, got ${r}`)}),Yy=G3.check(r=>{if(r<0)throw new en(`Expected a positive integer, got ${r}`)}),aK=G3.check(r=>{if(r<=0)throw new en(`Expected a non-zero positive integer, got ${r}`)}),zt=l2("boolean");function qs(r){return new uo(e=>{if(e!==r)throw new en(`Expected ${r}, got ${JSON.stringify(e)}`);return r})}const Rj=new uo(r=>{if(!Array.isArray(r))throw new en(`Expected an array, got ${rd(r)}`);return r});function ms(r){return new sK(r)}function Bt(r){return new Bv(r)}function fE(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null||Object.getPrototypeOf(r)===cG)}function gE(r){return r===null||typeof r=="number"||typeof r=="string"||typeof r=="boolean"?!0:Array.isArray(r)?r.every(gE):fE(r)?Object.values(r).every(gE):!1}const ys=new uo(r=>{if(gE(r))return r;throw new en(`Expected json serializable value, got ${typeof r}`)},(r,e)=>{if(Array.isArray(r)&&Array.isArray(e)){let t=r.length!==e.length;for(let n=0;n<e.length;n++){if(n>=r.length){t=!0,ys.validate(e[n]);continue}const s=r[n],o=e[n];if(Object.is(s,o))continue;const i=ys.validateUsingKnownGoodVersion(s,o);Object.is(i,s)||(t=!0)}return t?e:r}else if(fE(r)&&fE(e)){let t=!1;for(const n of Object.keys(e)){if(!ua(r,n)){t=!0,ys.validate(e[n]);continue}const s=r[n],o=e[n];if(Object.is(s,o))continue;const i=ys.validateUsingKnownGoodVersion(s,o);Object.is(i,s)||(t=!0)}for(const n of Object.keys(r))if(!ua(e,n)){t=!0;break}return t?e:r}else return ys.validate(e)});function Hv(r,e){return new oK(r,e)}function c2(r,e){return new Y0(r,e,(t,n)=>{throw new en(`Expected one of ${Object.keys(e).map(s=>JSON.stringify(s)).join(" or ")}, got ${JSON.stringify(n)}`,[r])},!1)}function lK(r,e){return new Y0(r,e,(t,n)=>{throw new en(`Expected one of ${Object.keys(e).map(s=>JSON.stringify(s)).join(" or ")}, got ${JSON.stringify(n)}`,[r])},!0)}function ml(r,e){return new uo(t=>Go(r,()=>e.validate(t)),(t,n)=>Go(r,()=>e.validateUsingKnownGoodVersion?e.validateUsingKnownGoodVersion(t,n):e.validate(n)))}function X0(r){return new uo(e=>{if(!r.has(e)){const t=Array.from(r,n=>JSON.stringify(n)).join(" or ");throw new en(`Expected ${t}, got ${e}`)}return e})}function W3(r){return new uo(e=>{if(e!==void 0)return r.validate(e)},(e,t)=>{if(!(e===void 0&&t===void 0)&&t!==void 0)return r.validateUsingKnownGoodVersion&&e!==void 0?r.validateUsingKnownGoodVersion(e,t):r.validate(t)})}function cK(r){return new uo(e=>e===null?null:r.validate(e),(e,t)=>t===null?null:r.validateUsingKnownGoodVersion&&e!==null?r.validateUsingKnownGoodVersion(e,t):r.validate(t))}function Z0(...r){return X0(new Set(r))}function d2(r){try{return new URL(r)}catch{if(r.startsWith("/")||r.startsWith("./"))try{return new URL(r,"http://example.com")}catch{throw new en(`Expected a valid url, got ${JSON.stringify(r)}`)}throw new en(`Expected a valid url, got ${JSON.stringify(r)}`)}}const dK=new Set(["http:","https:","mailto:"]),ci=Tt.check(r=>{if(r==="")return;const e=d2(r);if(!dK.has(e.protocol.toLowerCase()))throw new en(`Expected a valid url, got ${JSON.stringify(r)} (invalid protocol)`)}),uK=new Set(["http:","https:","data:","asset:"]),au=Tt.check(r=>{if(r==="")return;const e=d2(r);if(!uK.has(e.protocol.toLowerCase()))throw new en(`Expected a valid url, got ${JSON.stringify(r)} (invalid protocol)`)});Tt.check(r=>{if(r==="")return;if(!d2(r).protocol.toLowerCase().match(/^https?:$/))throw new en(`Expected a valid url, got ${JSON.stringify(r)} (invalid protocol)`)});const u2=Tt.refine(r=>{try{return JH(r),r}catch{throw new en(`Expected an index key, got ${JSON.stringify(r)}`)}});dd("@tldraw/validate","3.7.0","esm");function ii(r){return Tt.refine(e=>{if(!e.startsWith(`${r}:`))throw new Error(`${r} ID must start with "${r}:"`);return e})}const J0=ii("asset");function h2(r,e){return Bt({id:J0,typeName:qs("asset"),type:qs(r),props:e,meta:ys})}const lu=Bt({x:yt,y:yt,z:yt.optional()}),_f=Bt({x:yt,y:yt,w:yt,h:yt}),K3=yt.check(r=>{if(r<0||r>1)throw new en("Opacity must be between 0 and 1")}),hK=Tt.refine(r=>{if(!r.startsWith("page:")&&!r.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return r}),ji=ii("shape");function pK(r,e,t){return Bt({id:ji,typeName:qs("shape"),x:yt,y:yt,rotation:yt,index:u2,parentId:hK,type:qs(r),isLocked:zt,opacity:K3,props:e?Bt(e):ys,meta:t?Bt(t):ys})}const fK=ii("binding");function gK(r,e,t){return Bt({id:fK,typeName:qs("binding"),type:qs(r),fromId:ji,toId:ji,props:e?Bt(e):ys,meta:t?Bt(t):ys})}Wo("com.tldraw.binding",{});fi({sequenceId:"com.tldraw.binding",recordType:"binding",sequence:[]});function nu(r){return`binding:${Cn()}`}function mK(r){return gl("binding",{scope:"document",validator:ml("binding",c2("type",jg(r,(e,{props:t,meta:n})=>gK(e,t,n))))}).withDefaultProperties(()=>({meta:{}}))}class xs{constructor(e,t,n){this.id=e,this.defaultValue=t,this.type=n}static define(e,t){const{defaultValue:n,type:s=iK}=t;return new xs(e,n,s)}static defineEnum(e,t){const{defaultValue:n,values:s}=t;return new yK(e,n,s)}setDefaultValue(e){this.defaultValue=e}validate(e){return this.type.validate(e)}validateUsingKnownGoodVersion(e,t){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(e,t):this.validate(t)}}class yK extends xs{constructor(e,t,n){super(e,t,Z0(...n)),this.values=n}}const cy=Wo("com.tldraw.shape",{AddIsLocked:1,HoistOpacity:2,AddMeta:3,AddWhite:4}),vK=fi({sequenceId:"com.tldraw.shape",recordType:"shape",sequence:[{id:cy.AddIsLocked,up:r=>{r.isLocked=!1},down:r=>{delete r.isLocked}},{id:cy.HoistOpacity,up:r=>{r.opacity=Number(r.props.opacity??"1"),delete r.props.opacity},down:r=>{const e=r.opacity;delete r.opacity,r.props.opacity=e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}},{id:cy.AddMeta,up:r=>{r.meta={}}},{id:cy.AddWhite,up:r=>{},down:r=>{r.props.color==="white"&&(r.props.color="black")}}]});function yh(r){return r?r.typeName==="shape":!1}function Oo(r){return r?r.startsWith("shape:"):!1}function vn(r){return`shape:${r??Cn()}`}function V3(r){const e=new Map;for(const[t,n]of Object.entries(r))if(n instanceof xs){if(e.has(n))throw new Error(`Duplicate style prop ${n.id}. Each style prop can only be used once within a shape.`);e.set(n,t)}return e}function va(r,e){return jg(e,(t,n)=>`com.tldraw.shape.${r}/${n}`)}function bK(r){return gl("shape",{scope:"document",validator:ml("shape",c2("type",jg(r,(e,{props:t,meta:n})=>pK(e,t,n))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}function Dj(r,e){const t=[];for(const[n,{migrations:s}]of Object.entries(e)){const o=`com.tldraw.${r}.${n}`;s?"sequenceId"in s?(fn(o===s.sequenceId,`sequenceId mismatch for ${n} ${q0} migrations. Expected '${o}', got '${s.sequenceId}'`),t.push(s)):"sequence"in s?t.push(Ch({sequenceId:o,retroactive:!1,sequence:s.sequence.map(i=>"id"in i?q3(r,n,i):i)})):t.push(Ch({sequenceId:o,retroactive:!1,sequence:Object.keys(s.migrators).map(i=>Number(i)).sort((i,a)=>i-a).map(i=>({id:`${o}/${i}`,scope:"record",filter:a=>a.typeName===r&&a.type===n,up:a=>{const l=s.migrators[i].up(a);if(l)return l},down:a=>{const l=s.migrators[i].down(a);if(l)return l}}))})):t.push(Ch({sequenceId:o,retroactive:!1,sequence:[]}))}return t}function q3(r,e,t){return{id:t.id,dependsOn:t.dependsOn,scope:"record",filter:n=>n.typeName===r&&n.type===e,up:n=>{const s=t.up(n.props);s&&(n.props=s)},down:typeof t.down=="function"?n=>{const s=t.down(n.props);s&&(n.props=s)}:void 0}}const Y3=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red","white"],Gv={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",fill:"#1d1d1d",note:{fill:"#FCE19C",text:"#000000"},semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4465e9",fill:"#4465e9",note:{fill:"#8AA3FF",text:"#000000"},semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#6FC896",text:"#000000"},semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#9fa8b2",fill:"#9fa8b2",note:{fill:"#C0CAD3",text:"#000000"},semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4ba1f1",fill:"#4ba1f1",note:{fill:"#9BC4FD",text:"#000000"},semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#4cb05e",fill:"#4cb05e",note:{fill:"#98D08A",text:"#000000"},semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#f87777",fill:"#f87777",note:{fill:"#F7A5A1",text:"#000000"},semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e085f4",fill:"#e085f4",note:{fill:"#DFB0F9",text:"#000000"},semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#e16919",fill:"#e16919",note:{fill:"#FAA475",text:"#000000"},semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#FC8282",text:"#000000"},semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#DB91FD",text:"#000000"},semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#f1ac4b",fill:"#f1ac4b",note:{fill:"#FED49A",text:"#000000"},semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},white:{solid:"#FFFFFF",fill:"#FFFFFF",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#FFFFFF",text:"#000000"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 6.5%)",solid:"#010403",black:{solid:"#f2f2f2",fill:"#f2f2f2",note:{fill:"#2c2c2c",text:"#f2f2f2"},semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4f72fc",fill:"#4f72fc",note:{fill:"#2A3F98",text:"#f2f2f2"},semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#014429",text:"#f2f2f2"},semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#9398b0",fill:"#9398b0",note:{fill:"#56595F",text:"#f2f2f2"},semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#4dabf7",fill:"#4dabf7",note:{fill:"#1F5495",text:"#f2f2f2"},semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#40c057",fill:"#40c057",note:{fill:"#21581D",text:"#f2f2f2"},semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#ff8787",fill:"#ff8787",note:{fill:"#923632",text:"#f2f2f2"},semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#e599f7",fill:"#e599f7",note:{fill:"#762F8E",text:"#f2f2f2"},semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#f76707",fill:"#f76707",note:{fill:"#843906",text:"#f2f2f2"},semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#89231A",text:"#f2f2f2"},semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#681683",text:"#f2f2f2"},semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#ffc034",fill:"#ffc034",note:{fill:"#98571B",text:"#f2f2f2"},semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},white:{solid:"#f3f3f3",fill:"#f3f3f3",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#eaeaea",text:"#1d1d1d"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}}};function rc(r){return r.isDarkMode?Gv.darkMode:Gv.lightMode}const di=xs.defineEnum("tldraw:color",{defaultValue:"black",values:Y3}),p2=xs.defineEnum("tldraw:labelColor",{defaultValue:"black",values:Y3}),cu=xs.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),du=xs.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern","fill"]}),ll=xs.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),X3={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},cl=xs.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),Z3=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],Wv=xs.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:Z3}),Kv=xs.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:Z3}),J3={labelColor:p2,color:di,fill:du,dash:cu,size:cl,arrowheadStart:Wv,arrowheadEnd:Kv,font:ll,start:lu,end:lu,bend:yt,text:Tt,labelPosition:yt,scale:Mr},uh=va("arrow",{AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3,ExtractBindings:4,AddScale:5});function dy(r){return q3("shape","arrow",r)}const Q3=Ch({sequenceId:"com.tldraw.shape.arrow",retroactive:!1,sequence:[dy({id:uh.AddLabelColor,up:r=>{r.labelColor="black"},down:"retired"}),dy({id:uh.AddIsPrecise,up:({start:r,end:e})=>{r.type==="binding"&&(r.isPrecise=!(r.normalizedAnchor.x===.5&&r.normalizedAnchor.y===.5)),e.type==="binding"&&(e.isPrecise=!(e.normalizedAnchor.x===.5&&e.normalizedAnchor.y===.5))},down:({start:r,end:e})=>{r.type==="binding"&&(r.isPrecise||(r.normalizedAnchor={x:.5,y:.5}),delete r.isPrecise),e.type==="binding"&&(e.isPrecise||(e.normalizedAnchor={x:.5,y:.5}),delete e.isPrecise)}}),dy({id:uh.AddLabelPosition,up:r=>{r.labelPosition=.5},down:r=>{delete r.labelPosition}}),{id:uh.ExtractBindings,scope:"store",up:r=>{const e=Object.values(r).filter(t=>t.typeName==="shape"&&t.type==="arrow");for(const t of e){const{start:n,end:s}=t.props;if(n.type==="binding"){const o=nu(),i={typeName:"binding",id:o,type:"arrow",fromId:t.id,toId:n.boundShapeId,meta:{},props:{terminal:"start",normalizedAnchor:n.normalizedAnchor,isExact:n.isExact,isPrecise:n.isPrecise}};r[o]=i,t.props.start={x:0,y:0}}else delete t.props.start.type;if(s.type==="binding"){const o=nu(),i={typeName:"binding",id:o,type:"arrow",fromId:t.id,toId:s.boundShapeId,meta:{},props:{terminal:"end",normalizedAnchor:s.normalizedAnchor,isExact:s.isExact,isPrecise:s.isPrecise}};r[o]=i,t.props.end={x:0,y:0}}else delete t.props.end.type}}},dy({id:uh.AddScale,up:r=>{r.scale=1},down:r=>{delete r.scale}})]}),e5={terminal:Z0("start","end"),normalizedAnchor:lu,isExact:zt,isPrecise:zt},t5={sequence:[{dependsOn:[uh.ExtractBindings]}]},SK=ml("camera",Bt({typeName:qs("camera"),id:ii("camera"),x:yt,y:yt,z:yt,meta:ys})),xK=Wo("com.tldraw.camera",{AddMeta:1}),wK=fi({sequenceId:"com.tldraw.camera",recordType:"camera",sequence:[{id:xK.AddMeta,up:r=>{r.meta={}}}]}),Ja=gl("camera",{validator:SK,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),CK=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),n5=X0(CK),EK=Bt({type:n5,rotation:yt}),kK=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),PK=X0(kK),IK=new Set(["starting","paused","active","stopping"]),r5=Bt({id:Tt,points:ms(lu),size:Uv,color:PK,opacity:yt,state:X0(IK),delay:yt,shrink:yt,taper:zt}),Bf=ii("page"),_K=ml("page",Bt({typeName:qs("page"),id:Bf,name:Tt,index:u2,meta:ys})),TK=Wo("com.tldraw.page",{AddMeta:1}),MK=fi({sequenceId:"com.tldraw.page",recordType:"page",sequence:[{id:TK.AddMeta,up:r=>{r.meta={}}}]}),ui=gl("page",{validator:_K,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function Po(r){return ui.isId(r)}const AK={id:!1,typeName:!1,currentPageId:!1,opacityForNextShape:!1,stylesForNextShape:!1,followingUserId:!1,highlightedUserIds:!1,brush:!1,cursor:!1,scribbles:!1,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!1,chatMessage:!1,isChatting:!1,isPenMode:!1,isGridMode:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!1,openMenus:!1,isChangingStyle:!1,isReadonly:!0,meta:!1,duplicateProps:!1};function s5(r){return r?Pf(r,e=>AK[e]):null}ii("instance");function jK(r){const e={};for(const[n,s]of r)e[n]=W3(s);const t=ml("instance",Bt({typeName:qs("instance"),id:ii("instance"),currentPageId:Bf,followingUserId:Tt.nullable(),brush:_f.nullable(),opacityForNextShape:K3,stylesForNextShape:Bt(e),cursor:EK,scribbles:ms(r5),isFocusMode:zt,isDebugMode:zt,isToolLocked:zt,exportBackground:zt,screenBounds:_f,insets:ms(zt),zoomBrush:_f.nullable(),isPenMode:zt,isGridMode:zt,chatMessage:Tt,isChatting:zt,highlightedUserIds:ms(Tt),isFocused:zt,devicePixelRatio:yt,isCoarsePointer:zt,isHoveringCanvas:zt.nullable(),openMenus:ms(Tt),isChangingStyle:zt,isReadonly:zt,meta:ys,duplicateProps:Bt({shapeIds:ms(ii("shape")),offset:Bt({x:yt,y:yt})}).nullable()}));return gl("instance",{validator:t,scope:"session",ephemeralKeys:{currentPageId:!1,meta:!1,followingUserId:!0,opacityForNextShape:!0,stylesForNextShape:!0,brush:!0,cursor:!0,scribbles:!0,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!0,isPenMode:!0,isGridMode:!0,chatMessage:!0,isChatting:!0,highlightedUserIds:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!0,openMenus:!0,isChangingStyle:!0,isReadonly:!0,duplicateProps:!0}}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],isFocused:!1,devicePixelRatio:typeof window>"u"?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null}))}const Wn=Wo("com.tldraw.instance",{AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24,RemoveCanMoveCamera:25}),RK=fi({sequenceId:"com.tldraw.instance",recordType:"instance",sequence:[{id:Wn.AddTransparentExportBgs,up:r=>({...r,exportBackground:!0})},{id:Wn.RemoveDialog,up:({dialog:r,...e})=>e},{id:Wn.AddToolLockMode,up:r=>({...r,isToolLocked:!1})},{id:Wn.RemoveExtraPropsForNextShape,up:({propsForNextShape:r,...e})=>({...e,propsForNextShape:Object.fromEntries(Object.entries(r).filter(([t])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(t)))})},{id:Wn.AddLabelColor,up:({propsForNextShape:r,...e})=>({...e,propsForNextShape:{...r,labelColor:"black"}})},{id:Wn.AddFollowingUserId,up:r=>({...r,followingUserId:null})},{id:Wn.RemoveAlignJustify,up:r=>{let e=r.propsForNextShape.align;return e==="justify"&&(e="start"),{...r,propsForNextShape:{...r.propsForNextShape,align:e}}}},{id:Wn.AddZoom,up:r=>({...r,zoomBrush:null})},{id:Wn.AddVerticalAlign,up:r=>({...r,propsForNextShape:{...r.propsForNextShape,verticalAlign:"middle"}})},{id:Wn.AddScribbleDelay,up:r=>r.scribble!==null?{...r,scribble:{...r.scribble,delay:0}}:{...r}},{id:Wn.RemoveUserId,up:({userId:r,...e})=>e},{id:Wn.AddIsPenModeAndIsGridMode,up:r=>({...r,isPenMode:!1,isGridMode:!1})},{id:Wn.HoistOpacity,up:({propsForNextShape:{opacity:r,...e},...t})=>({...t,opacityForNextShape:Number(r??"1"),propsForNextShape:e})},{id:Wn.AddChat,up:r=>({...r,chatMessage:"",isChatting:!1})},{id:Wn.AddHighlightedUserIds,up:r=>({...r,highlightedUserIds:[]})},{id:Wn.ReplacePropsForNextShapeWithStylesForNextShape,up:({propsForNextShape:r,...e})=>({...e,stylesForNextShape:{}})},{id:Wn.AddMeta,up:r=>({...r,meta:{}})},{id:Wn.RemoveCursorColor,up:r=>{const{color:e,...t}=r.cursor;return{...r,cursor:t}}},{id:Wn.AddLonelyProperties,up:r=>({...r,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1})},{id:Wn.ReadOnlyReadonly,up:({isReadOnly:r,...e})=>({...e,isReadonly:r})},{id:Wn.AddHoveringCanvas,up:r=>({...r,isHoveringCanvas:null})},{id:Wn.AddScribbles,up:({scribble:r,...e})=>({...e,scribbles:[]})},{id:Wn.AddInset,up:r=>({...r,insets:[!1,!1,!1,!1]}),down:({insets:r,...e})=>({...e})},{id:Wn.AddDuplicateProps,up:r=>({...r,duplicateProps:null}),down:({duplicateProps:r,...e})=>({...e})},{id:Wn.RemoveCanMoveCamera,up:({canMoveCamera:r,...e})=>({...e}),down:r=>({...r,canMoveCamera:!0})}]}),oo="instance:instance",DK=ml("instance_page_state",Bt({typeName:qs("instance_page_state"),id:ii("instance_page_state"),pageId:Bf,selectedShapeIds:ms(ji),hintingShapeIds:ms(ji),erasingShapeIds:ms(ji),hoveredShapeId:ji.nullable(),editingShapeId:ji.nullable(),croppingShapeId:ji.nullable(),focusedGroupId:ji.nullable(),meta:ys})),Xp=Wo("com.tldraw.instance_page_state",{AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5}),OK=fi({sequenceId:"com.tldraw.instance_page_state",recordType:"instance_page_state",sequence:[{id:Xp.AddCroppingId,up(r){r.croppingShapeId=null}},{id:Xp.RemoveInstanceIdAndCameraId,up(r){delete r.instanceId,delete r.cameraId}},{id:Xp.AddMeta,up:r=>{r.meta={}}},{id:Xp.RenameProperties,up:r=>{},down:r=>{}},{id:Xp.RenamePropertiesAgain,up:r=>{r.selectedShapeIds=r.selectedIds,delete r.selectedIds,r.hintingShapeIds=r.hintingIds,delete r.hintingIds,r.erasingShapeIds=r.erasingIds,delete r.erasingIds,r.hoveredShapeId=r.hoveredId,delete r.hoveredId,r.editingShapeId=r.editingId,delete r.editingId,r.croppingShapeId=r.croppingShapeId??r.croppingId??null,delete r.croppingId,r.focusedGroupId=r.focusLayerId,delete r.focusLayerId},down:r=>{r.selectedIds=r.selectedShapeIds,delete r.selectedShapeIds,r.hintingIds=r.hintingShapeIds,delete r.hintingShapeIds,r.erasingIds=r.erasingShapeIds,delete r.erasingShapeIds,r.hoveredId=r.hoveredShapeId,delete r.hoveredShapeId,r.editingId=r.editingShapeId,delete r.editingShapeId,r.croppingId=r.croppingShapeId,delete r.croppingShapeId,r.focusLayerId=r.focusedGroupId,delete r.focusedGroupId}}]}),la=gl("instance_page_state",{validator:DK,scope:"session",ephemeralKeys:{pageId:!1,selectedShapeIds:!1,editingShapeId:!1,croppingShapeId:!1,meta:!1,hintingShapeIds:!0,erasingShapeIds:!0,hoveredShapeId:!0,focusedGroupId:!0}}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),LK=ml("pointer",Bt({typeName:qs("pointer"),id:ii("pointer"),x:yt,y:yt,lastActivityTimestamp:yt,meta:ys})),NK=Wo("com.tldraw.pointer",{AddMeta:1}),FK=fi({sequenceId:"com.tldraw.pointer",recordType:"pointer",sequence:[{id:NK.AddMeta,up:r=>{r.meta={}}}]}),f2=gl("pointer",{validator:LK,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),Vv=f2.createId("pointer"),zK=ml("instance_presence",Bt({typeName:qs("instance_presence"),id:ii("instance_presence"),userId:Tt,userName:Tt,lastActivityTimestamp:yt.nullable(),followingUserId:Tt.nullable(),cursor:Bt({x:yt,y:yt,type:n5,rotation:yt}).nullable(),color:Tt,camera:Bt({x:yt,y:yt,z:yt}).nullable(),screenBounds:_f.nullable(),selectedShapeIds:ms(ii("shape")),currentPageId:ii("page"),brush:_f.nullable(),scribbles:ms(r5),chatMessage:Tt,meta:ys})),eh=Wo("com.tldraw.instance_presence",{AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5,NullableCameraCursor:6}),$K=fi({sequenceId:"com.tldraw.instance_presence",recordType:"instance_presence",sequence:[{id:eh.AddScribbleDelay,up:r=>{r.scribble!==null&&(r.scribble.delay=0)}},{id:eh.RemoveInstanceId,up:r=>{delete r.instanceId}},{id:eh.AddChatMessage,up:r=>{r.chatMessage=""}},{id:eh.AddMeta,up:r=>{r.meta={}}},{id:eh.RenameSelectedShapeIds,up:r=>{}},{id:eh.NullableCameraCursor,up:r=>{},down:r=>{r.camera===null&&(r.camera={x:0,y:0,z:1}),r.lastActivityTimestamp===null&&(r.lastActivityTimestamp=0),r.cursor===null&&(r.cursor={type:"default",x:0,y:0,rotation:0}),r.screenBounds===null&&(r.screenBounds={x:0,y:0,w:1,h:1})}}]}),BK=gl("instance_presence",{validator:zK,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:null,followingUserId:null,color:"#FF0000",camera:null,cursor:null,screenBounds:null,selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})),UK=ml("document",Bt({typeName:qs("document"),id:qs("document:document"),gridSize:yt,name:Tt,meta:ys})),Oj=Wo("com.tldraw.document",{AddName:1,AddMeta:2}),HK=fi({sequenceId:"com.tldraw.document",recordType:"document",sequence:[{id:Oj.AddName,up:r=>{r.name=""},down:r=>{delete r.name}},{id:Oj.AddMeta,up:r=>{r.meta={}}}]}),g2=gl("document",{validator:UK,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),mE=g2.createId("document");function GK(r,e){return r.index<e.index?-1:r.index>e.index?1:0}function Lj(r){r.typeName==="asset"&&("src"in r&&(r.src="<redacted>"),"src"in r.props&&(r.props.src="<redacted>"))}function WK({error:r,phase:e,record:t,recordBefore:n}){throw Ok(r,{tags:{origin:"store.validateRecord",storePhase:e,isExistingValidationIssue:e==="initialize"},extras:{recordBefore:n?Lj(Kn(n)):void 0,recordAfter:Lj(Kn(t))}}),r}function KK(){return[ui.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]}function VK(r){const e=r.query.ids("page"),t=r.query.records("instance_page_state"),n=()=>{if(!r.has(mE))return r.put([g2.create({id:mE,name:r.props.defaultName})]),n();if(!r.has(Vv))return r.put([f2.create({id:Vv})]),n();const s=e.get();if(s.size===0)return r.put(KK()),n();const o=()=>[...s].map(u=>r.get(u)).sort(GK)[0].id,i=r.get(oo);if(i){if(!s.has(i.currentPageId))return r.put([{...i,currentPageId:o()}]),n()}else return r.put([r.schema.types.instance.create({id:oo,currentPageId:o(),exportBackground:!0})]),n();const a=new Set,l=new Set;for(const u of s){const p=la.createId(u);r.get(p)||a.add(p);const m=Ja.createId(u);r.has(m)||l.add(m)}a.size>0&&r.put([...a].map(u=>la.create({id:u,pageId:la.parseId(u)}))),l.size>0&&r.put([...l].map(u=>Ja.create({id:u})));const c=t.get();for(const u of c){if(!s.has(u.pageId)){r.remove([u.id]);continue}if(u.croppingShapeId&&!r.has(u.croppingShapeId))return r.put([{...u,croppingShapeId:null}]),n();if(u.focusedGroupId&&!r.has(u.focusedGroupId))return r.put([{...u,focusedGroupId:null}]),n();if(u.hoveredShapeId&&!r.has(u.hoveredShapeId))return r.put([{...u,hoveredShapeId:null}]),n();const p=u.selectedShapeIds.filter(v=>r.has(v));if(p.length!==u.selectedShapeIds.length)return r.put([{...u,selectedShapeIds:p}]),n();const f=u.hintingShapeIds.filter(v=>r.has(v));if(f.length!==u.hintingShapeIds.length)return r.put([{...u,hintingShapeIds:f}]),n();const m=u.erasingShapeIds.filter(v=>r.has(v));if(m.length!==u.erasingShapeIds.length)return r.put([{...u,erasingShapeIds:m}]),n()}};return n}const qK=h2("bookmark",Bt({title:Tt,description:Tt,image:Tt,favicon:Tt,src:au.nullable()})),Nj=Wo("com.tldraw.asset.bookmark",{MakeUrlsValid:1,AddFavicon:2}),YK=fi({sequenceId:"com.tldraw.asset.bookmark",recordType:"asset",filter:r=>r.type==="bookmark",sequence:[{id:Nj.MakeUrlsValid,up:r=>{au.isValid(r.props.src)||(r.props.src="")},down:r=>{}},{id:Nj.AddFavicon,up:r=>{au.isValid(r.props.favicon)||(r.props.favicon="")},down:r=>{delete r.props.favicon}}]}),XK=h2("image",Bt({w:yt,h:yt,name:Tt,isAnimated:zt,mimeType:Tt.nullable(),src:au.nullable(),fileSize:Mr.optional()})),Zp=Wo("com.tldraw.asset.image",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),ZK=fi({sequenceId:"com.tldraw.asset.image",recordType:"asset",filter:r=>r.type==="image",sequence:[{id:Zp.AddIsAnimated,up:r=>{r.props.isAnimated=!1},down:r=>{delete r.props.isAnimated}},{id:Zp.RenameWidthHeight,up:r=>{r.props.w=r.props.width,r.props.h=r.props.height,delete r.props.width,delete r.props.height},down:r=>{r.props.width=r.props.w,r.props.height=r.props.h,delete r.props.w,delete r.props.h}},{id:Zp.MakeUrlsValid,up:r=>{au.isValid(r.props.src)||(r.props.src="")},down:r=>{}},{id:Zp.AddFileSize,up:r=>{r.props.fileSize=-1},down:r=>{delete r.props.fileSize}},{id:Zp.MakeFileSizeOptional,up:r=>{r.props.fileSize===-1&&(r.props.fileSize=void 0)},down:r=>{r.props.fileSize===void 0&&(r.props.fileSize=-1)}}]}),JK=h2("video",Bt({w:yt,h:yt,name:Tt,isAnimated:zt,mimeType:Tt.nullable(),src:au.nullable(),fileSize:yt.optional()})),Jp=Wo("com.tldraw.asset.video",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),QK=fi({sequenceId:"com.tldraw.asset.video",recordType:"asset",filter:r=>r.type==="video",sequence:[{id:Jp.AddIsAnimated,up:r=>{r.props.isAnimated=!1},down:r=>{delete r.props.isAnimated}},{id:Jp.RenameWidthHeight,up:r=>{r.props.w=r.props.width,r.props.h=r.props.height,delete r.props.width,delete r.props.height},down:r=>{r.props.width=r.props.w,r.props.height=r.props.h,delete r.props.w,delete r.props.h}},{id:Jp.MakeUrlsValid,up:r=>{au.isValid(r.props.src)||(r.props.src="")},down:r=>{}},{id:Jp.AddFileSize,up:r=>{r.props.fileSize=-1},down:r=>{delete r.props.fileSize}},{id:Jp.MakeFileSizeOptional,up:r=>{r.props.fileSize===-1&&(r.props.fileSize=void 0)},down:r=>{r.props.fileSize===void 0&&(r.props.fileSize=-1)}}]}),eV=ml("asset",c2("type",{image:XK,video:JK,bookmark:qK})),tV=Wo("com.tldraw.asset",{AddMeta:1}),nV=fi({sequenceId:"com.tldraw.asset",recordType:"asset",sequence:[{id:tV.AddMeta,up:r=>{r.meta={}}}]}),zc=gl("asset",{validator:eV,scope:"document"}).withDefaultProperties(()=>({meta:{}})),o5={w:Mr,h:Mr,assetId:J0.nullable(),url:ci},Fj=va("bookmark",{NullAssetId:1,MakeUrlsValid:2}),i5={sequence:[{id:Fj.NullAssetId,up:r=>{r.assetId===void 0&&(r.assetId=null)},down:"retired"},{id:Fj.MakeUrlsValid,up:r=>{ci.isValid(r.url)||(r.url="")},down:r=>{}}]},a5=Bt({type:Z0("free","straight"),points:ms(lu)}),l5={color:di,fill:du,dash:cu,size:cl,segments:ms(a5),isComplete:zt,isClosed:zt,isPen:zt,scale:Mr},zj=va("draw",{AddInPen:1,AddScale:2}),c5={sequence:[{id:zj.AddInPen,up:r=>{const{points:e}=r.segments[0];if(e.length===0){r.isPen=!1;return}let t=!(e[0].z===0||e[0].z===.5);e[1]&&(t=t&&!(e[1].z===0||e[1].z===.5)),r.isPen=t},down:"retired"},{id:zj.AddScale,up:r=>{r.scale=1},down:r=>{delete r.scale}}]},rV=/(^\/r\/[^/]+\/?$)/,sV=[{hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],fromEmbedUrl:r=>{const e=vt(r);if(e&&e.pathname.match(rV))return r}},{hostnames:["figma.com"],fromEmbedUrl:r=>{const e=vt(r);if(e&&e.pathname.match(/^\/embed\/?$/)){const t=e.searchParams.get("url");if(t)return t}}},{hostnames:["google.*"],fromEmbedUrl:r=>{const e=vt(r);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const n=e.searchParams.get("zoom"),[s,o]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${s},${o},${n}z`}}},{hostnames:["val.town"],fromEmbedUrl:r=>{const e=vt(r),t=e&&e.pathname.match(/\/embed\/(.+)\/?/);if(t)return`https://www.val.town/v/${t[1]}`}},{hostnames:["codesandbox.io"],fromEmbedUrl:r=>{const e=vt(r),t=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(t)return`https://codesandbox.io/s/${t[1]}`}},{hostnames:["codepen.io"],fromEmbedUrl:r=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,t=r.match(e);if(t){const[n,s,o]=t;return`https://codepen.io/${s}/pen/${o}`}}},{hostnames:["scratch.mit.edu"],fromEmbedUrl:r=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,t=r.match(e);if(t){const[n,s]=t;return`https://scratch.mit.edu/projects/${s}`}}},{hostnames:["*.youtube.com","youtube.com","youtu.be"],fromEmbedUrl:r=>{const e=vt(r);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const n=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(n)return`https://www.youtube.com/watch?v=${n[1]}`}}},{hostnames:["calendar.google.*"],fromEmbedUrl:r=>{const e=vt(r),t=e==null?void 0:e.searchParams.get("src");if(e!=null&&e.pathname.match(/\/calendar\/embed/)&&t){e.pathname="/calendar/u/0";const n=Array.from(e.searchParams.keys());for(const s of n)e.searchParams.delete(s);return e.searchParams.set("cid",t),e.href}}},{hostnames:["docs.google.*"],fromEmbedUrl:r=>{const e=vt(r);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/embed\/?$/))){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const t=Array.from(e.searchParams.keys());for(const n of t)e.searchParams.delete(n);return e.href}}},{hostnames:["gist.github.com"],fromEmbedUrl:r=>{const e=vt(r);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return r.split("/").pop()?r:void 0}},{hostnames:["replit.com"],fromEmbedUrl:r=>{const e=vt(r);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{hostnames:["felt.com"],fromEmbedUrl:r=>{const e=vt(r);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{hostnames:["open.spotify.com"],fromEmbedUrl:r=>{const e=vt(r);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{hostnames:["vimeo.com","player.vimeo.com"],fromEmbedUrl:r=>{const e=vt(r);if(e&&e.hostname==="player.vimeo.com"){const t=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(t)return"https://vimeo.com/"+t[1]}}},{hostnames:["excalidraw.com"],fromEmbedUrl:r=>{const e=vt(r);if(e&&e.hash.match(/#room=/))return r}},{hostnames:["observablehq.com"],fromEmbedUrl:r=>{const e=vt(r);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}},{hostnames:["desmos.com"],fromEmbedUrl:r=>{const e=vt(r);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search==="?embed"&&e.hash==="")return r.replace("?embed","")}}],d5={w:Mr,h:Mr,url:Tt},uy=va("embed",{GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4}),u5={sequence:[{id:uy.GenOriginalUrlInEmbed,up:r=>{try{const e=r.url,t=new URL(e).host.replace("www.","");let n;for(const s of sV)if(s.hostnames.includes(t))try{n=s.fromEmbedUrl(e)}catch(o){console.warn(o)}r.tmpOldUrl=r.url,r.url=n??""}catch{r.url="",r.tmpOldUrl=r.url}},down:"retired"},{id:uy.RemoveDoesResize,up:r=>{delete r.doesResize},down:"retired"},{id:uy.RemoveTmpOldUrl,up:r=>{delete r.tmpOldUrl},down:"retired"},{id:uy.RemovePermissionOverrides,up:r=>{delete r.overridePermissions},down:"retired"}]},h5={w:Mr,h:Mr,name:Tt},p5={sequence:[]},qv=xs.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),Yv=xs.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),ca=xs.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box","heart"]}),f5={geo:ca,labelColor:p2,color:di,fill:du,dash:cu,size:cl,font:ll,align:qv,verticalAlign:Yv,url:ci,w:Mr,h:Mr,growY:Uv,text:Tt,scale:Mr},Al=va("geo",{AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8,AddScale:9}),g5={sequence:[{id:Al.AddUrlProp,up:r=>{r.url=""},down:"retired"},{id:Al.AddLabelColor,up:r=>{r.labelColor="black"},down:"retired"},{id:Al.RemoveJustify,up:r=>{r.align==="justify"&&(r.align="start")},down:"retired"},{id:Al.AddCheckBox,up:r=>{},down:"retired"},{id:Al.AddVerticalAlign,up:r=>{r.verticalAlign="middle"},down:"retired"},{id:Al.MigrateLegacyAlign,up:r=>{let e;switch(r.align){case"start":e="start-legacy";break;case"end":e="end-legacy";break;default:e="middle-legacy";break}r.align=e},down:"retired"},{id:Al.AddCloud,up:r=>{},down:"retired"},{id:Al.MakeUrlsValid,up:r=>{ci.isValid(r.url)||(r.url="")},down:r=>{}},{id:Al.AddScale,up:r=>{r.scale=1},down:r=>{delete r.scale}}]},m5={},y5={sequence:[]},v5={color:di,size:cl,segments:ms(a5),isComplete:zt,isPen:zt,scale:Mr},oV=va("highlight",{AddScale:1}),b5={sequence:[{id:oV.AddScale,up:r=>{r.scale=1},down:r=>{delete r.scale}}]},iV=Bt({topLeft:lu,bottomRight:lu}),S5={w:Mr,h:Mr,playing:zt,url:ci,assetId:J0.nullable(),crop:iV.nullable(),flipX:zt,flipY:zt},hy=va("image",{AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3,AddFlipProps:4}),x5={sequence:[{id:hy.AddUrlProp,up:r=>{r.url=""},down:"retired"},{id:hy.AddCropProp,up:r=>{r.crop=null},down:r=>{delete r.crop}},{id:hy.MakeUrlsValid,up:r=>{ci.isValid(r.url)||(r.url="")},down:r=>{}},{id:hy.AddFlipProps,up:r=>{r.flipX=!1,r.flipY=!1},down:r=>{delete r.flipX,delete r.flipY}}]},Xv=xs.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),aV=Bt({id:Tt,index:u2,x:yt,y:yt}),w5={color:di,dash:cu,size:cl,spline:Xv,points:Hv(Tt,aV),scale:Mr},Qp=va("line",{AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4,AddScale:5}),C5={sequence:[{id:Qp.AddSnapHandles,up:r=>{for(const e of Object.values(r.handles))e.canSnap=!0},down:"retired"},{id:Qp.RemoveExtraHandleProps,up:r=>{r.handles=Nk(Object.values(r.handles).map(e=>[e.index,{x:e.x,y:e.y}]))},down:r=>{const e=Object.entries(r.handles).map(([t,n])=>({index:t,...n})).sort(Hs);r.handles=Object.fromEntries(e.map((t,n)=>{const s=n===0?"start":n===e.length-1?"end":`handle:${t.index}`;return[s,{id:s,type:"vertex",canBind:!1,canSnap:!0,index:t.index,x:t.x,y:t.y}]}))}},{id:Qp.HandlesToPoints,up:r=>{const e=Object.entries(r.handles).map(([t,{x:n,y:s}])=>({x:n,y:s,index:t})).sort(Hs);r.points=e.map(({x:t,y:n})=>({x:t,y:n})),delete r.handles},down:r=>{const e=$f(r.points.length);r.handles=Object.fromEntries(r.points.map((t,n)=>[e[n],{x:t.x,y:t.y}])),delete r.points}},{id:Qp.PointIndexIds,up:r=>{const e=$f(r.points.length);r.points=Object.fromEntries(r.points.map((t,n)=>{const s=e[n];return[s,{id:s,index:s,x:t.x,y:t.y}]}))},down:r=>{const e=Object.values(r.points).sort(Hs);r.points=e.map(({x:t,y:n})=>({x:t,y:n}))}},{id:Qp.AddScale,up:r=>{r.scale=1},down:r=>{delete r.scale}}]},E5={color:di,labelColor:p2,size:cl,font:ll,fontSizeAdjustment:Uv,align:qv,verticalAlign:Yv,growY:Uv,url:ci,text:Tt,scale:Mr},Mc=va("note",{AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5,AddFontSizeAdjustment:6,AddScale:7,AddLabelColor:8}),k5={sequence:[{id:Mc.AddUrlProp,up:r=>{r.url=""},down:"retired"},{id:Mc.RemoveJustify,up:r=>{r.align==="justify"&&(r.align="start")},down:"retired"},{id:Mc.MigrateLegacyAlign,up:r=>{switch(r.align){case"start":r.align="start-legacy";return;case"end":r.align="end-legacy";return;default:r.align="middle-legacy";return}},down:"retired"},{id:Mc.AddVerticalAlign,up:r=>{r.verticalAlign="middle"},down:"retired"},{id:Mc.MakeUrlsValid,up:r=>{ci.isValid(r.url)||(r.url="")},down:r=>{}},{id:Mc.AddFontSizeAdjustment,up:r=>{r.fontSizeAdjustment=0},down:r=>{delete r.fontSizeAdjustment}},{id:Mc.AddScale,up:r=>{r.scale=1},down:r=>{delete r.scale}},{id:Mc.AddLabelColor,up:r=>{r.labelColor="black"},down:r=>{delete r.labelColor}}]},yE=xs.defineEnum("tldraw:textAlign",{defaultValue:"start",values:["start","middle","end"]}),P5={color:di,size:cl,font:ll,textAlign:yE,w:Mr,text:Tt,scale:Mr,autoSize:zt},$j=va("text",{RemoveJustify:1,AddTextAlign:2}),I5={sequence:[{id:$j.RemoveJustify,up:r=>{r.align==="justify"&&(r.align="start")},down:"retired"},{id:$j.AddTextAlign,up:r=>{r.textAlign=r.align,delete r.align},down:r=>{r.align=r.textAlign,delete r.textAlign}}]},_5={w:Mr,h:Mr,time:yt,playing:zt,url:ci,assetId:J0.nullable()},Bj=va("video",{AddUrlProp:1,MakeUrlsValid:2}),T5={sequence:[{id:Bj.AddUrlProp,up:r=>{r.url=""},down:"retired"},{id:Bj.MakeUrlsValid,up:r=>{ci.isValid(r.url)||(r.url="")},down:r=>{}}]},py=Wo("com.tldraw.store",{RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4}),lV=Ch({sequenceId:"com.tldraw.store",retroactive:!1,sequence:[{id:py.RemoveCodeAndIconShapeTypes,scope:"store",up:r=>{for(const[e,t]of Ho(r))t.typeName==="shape"&&(t.type==="icon"||t.type==="code")&&delete r[e]}},{id:py.AddInstancePresenceType,scope:"store",up(r){}},{id:py.RemoveTLUserAndPresenceAndAddPointer,scope:"store",up:r=>{for(const[e,t]of Ho(r))t.typeName.match(/^(user|user_presence)$/)&&delete r[e]}},{id:py.RemoveUserDocument,scope:"store",up:r=>{for(const[e,t]of Ho(r))t.typeName.match("user_document")&&delete r[e]}}]}),cV={arrow:{migrations:Q3,props:J3},bookmark:{migrations:i5,props:o5},draw:{migrations:c5,props:l5},embed:{migrations:u5,props:d5},frame:{migrations:p5,props:h5},geo:{migrations:g5,props:f5},group:{migrations:y5,props:m5},highlight:{migrations:b5,props:v5},image:{migrations:x5,props:S5},line:{migrations:C5,props:w5},note:{migrations:k5,props:E5},text:{migrations:I5,props:P5},video:{migrations:T5,props:_5}},dV={arrow:{migrations:t5,props:e5}};function uV({shapes:r=cV,bindings:e=dV,migrations:t}={}){const n=new Map;for(const a of ir(r))for(const l of V3(a.props??{}).keys()){if(n.has(l.id)&&n.get(l.id)!==l)throw new Error(`Multiple StyleProp instances with the same id: ${l.id}`);n.set(l.id,l)}const s=bK(r),o=mK(e),i=jK(n);return a2.create({asset:zc,binding:o,camera:Ja,document:g2,instance:i,instance_page_state:la,page:ui,instance_presence:BK,pointer:f2,shape:s},{migrations:[lV,nV,wK,HK,RK,OK,MK,$K,FK,vK,YK,ZK,QK,...Dj("shape",r),...Dj("binding",e),...t??[]],onValidationFailure:WK,createIntegrityChecker:VK})}const Uf=[{locale:"id",label:"Bahasa Indonesia"},{locale:"ca",label:"Català"},{locale:"cs",label:"Čeština"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Español"},{locale:"fr",label:"Français"},{locale:"gl",label:"Galego"},{locale:"hr",label:"Hrvatski"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Português - Brasil"},{locale:"pt-pt",label:"Português - Europeu"},{locale:"ro",label:"Română"},{locale:"ru",label:"Russian"},{locale:"sl",label:"Slovenščina"},{locale:"so",label:"Somali"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Tiếng Việt"},{locale:"tr",label:"Türkçe"},{locale:"uk",label:"Ukrainian"},{locale:"he",label:"עברית"},{locale:"ar",label:"عربي"},{locale:"fa",label:"فارسی"},{locale:"ku",label:"کوردی"},{locale:"ne",label:"नेपाली"},{locale:"hi-in",label:"हिन्दी"},{locale:"te",label:"తెలుగు"},{locale:"th",label:"ภาษาไทย"},{locale:"my",label:"မြန်မာစာ"},{locale:"ko-kr",label:"한국어"},{locale:"ja",label:"日本語"},{locale:"zh-cn",label:"简体中文"},{locale:"zh-tw",label:"繁體中文 (台灣)"}];function hV(){const r=typeof window<"u"?window.navigator.languages??["en"]:["en"];return pV(r)}function pV(r){for(const e of r){const t=fV(e);if(t)return t}return"en"}const Uj={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function fV(r){const e=Uf.find(s=>s.locale===r.toLowerCase());if(e)return e.locale;const[t,n]=r.split(/[-_]/).map(s=>s.toLowerCase());if(n){const s=Uf.find(o=>o.locale===t);if(s)return s.locale}return t in Uj?Uj[t]:null}dd("@tldraw/tlschema","3.7.0","esm");var H1={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var Hj;function gV(){return Hj||(Hj=1,function(r){(function(){var e={}.hasOwnProperty;function t(){for(var o="",i=0;i<arguments.length;i++){var a=arguments[i];a&&(o=s(o,n(a)))}return o}function n(o){if(typeof o=="string"||typeof o=="number")return o;if(typeof o!="object")return"";if(Array.isArray(o))return t.apply(null,o);if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]"))return o.toString();var i="";for(var a in o)e.call(o,a)&&o[a]&&(i=s(i,a));return i}function s(o,i){return i?o?o+" "+i:o+i:o}r.exports?(t.default=t,r.exports=t):window.classNames=t})()}(H1)),H1.exports}var mV=gV();const it=ec(mV),M5="3.7.0",Gj={major:"2024-09-13T14:36:29.063Z",minor:"2025-01-07T15:59:09.453Z",patch:"2025-01-07T15:59:09.453Z"},yV={error:null};class m2 extends I.Component{constructor(){super(...arguments);k(this,"state",yV)}static getDerivedStateFromError(t){return{error:t}}componentDidCatch(t){var n,s;(s=(n=this.props).onError)==null||s.call(n,t)}render(){const{error:t}=this.state;if(t!==null){const{fallback:n}=this.props;return g.jsx(n,{error:t})}return this.props.children}}function Hf({children:r,fallback:e,...t}){return e===null?r:g.jsx(m2,{fallback:e,...t,children:r})}function y2(r,e){return Q0(`${r}_${e}`)}function sp(r){return Q0(`${I.useId()}${r??""}`)}function ha(r){const e=Lo(I.useContext(A5));return Q0(`${e}_${r}`)}function Q0(r){return r.replace(/:/g,"_")}const A5=I.createContext(null);function vV({children:r}){const e=sp();return g.jsx(A5.Provider,{value:e,children:r})}const v2=I.createContext(null);function ue(){const r=Ht.useContext(v2);if(!r)throw new Error("useEditor must be used inside of the <Tldraw /> or <TldrawEditor /> components");return r}function fd(){return Ht.useContext(v2)}function b2({editor:r,children:e}){return g.jsx(v2.Provider,{value:r,children:g.jsx(vV,{children:e})})}function bV(){return g.jsx("div",{className:"tl-background"})}function op(r,e,t,n,s,o){I.useLayoutEffect(()=>{const i=r.current;if(!i||e===void 0)return;let a=`translate(${e}px, ${t}px)`;n!==void 0&&(a+=` scale(${n})`),s!==void 0&&(a+=` rotate(${s}rad)`),o&&(a+=` translate(${o.x}px, ${o.y}px)`),i.style.transform=a})}const ss={linear:r=>r,easeInQuad:r=>r*r,easeOutQuad:r=>r*(2-r),easeInOutQuad:r=>r<.5?2*r*r:-1+(4-2*r)*r,easeInCubic:r=>r*r*r,easeOutCubic:r=>--r*r*r+1,easeInOutCubic:r=>r<.5?4*r*r*r:(r-1)*(2*r-2)*(2*r-2)+1,easeInQuart:r=>r*r*r*r,easeOutQuart:r=>1- --r*r*r*r,easeInOutQuart:r=>r<.5?8*r*r*r*r:1-8*--r*r*r*r,easeInQuint:r=>r*r*r*r*r,easeOutQuint:r=>1+--r*r*r*r*r,easeInOutQuint:r=>r<.5?16*r*r*r*r*r:1+16*--r*r*r*r*r,easeInSine:r=>1-Math.cos(r*Math.PI/2),easeOutSine:r=>Math.sin(r*Math.PI/2),easeInOutSine:r=>-(Math.cos(Math.PI*r)-1)/2,easeInExpo:r=>r<=0?0:Math.pow(2,10*r-10),easeOutExpo:r=>r>=1?1:1-Math.pow(2,-10*r),easeInOutExpo:r=>r<=0?0:r>=1?1:r<.5?Math.pow(2,20*r-10)/2:(2-Math.pow(2,-20*r+10))/2};class P{constructor(e=0,t=0,n=1){this.x=e,this.y=t,this.z=n}get pressure(){return this.z}set(e=this.x,t=this.y,n=this.z){return this.x=e,this.y=t,this.z=n,this}setTo({x:e=0,y:t=0,z:n=1}){return this.x=e,this.y=t,this.z=n,this}rot(e){if(e===0)return this;const{x:t,y:n}=this,s=Math.sin(e),o=Math.cos(e);return this.x=t*o-n*s,this.y=t*s+n*o,this}rotWith(e,t){if(t===0)return this;const n=this.x-e.x,s=this.y-e.y,o=Math.sin(t),i=Math.cos(t);return this.x=e.x+(n*i-s*o),this.y=e.y+(n*o+s*i),this}clone(){const{x:e,y:t,z:n}=this;return new P(e,t,n)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,t){return this.x-=e,this.y-=t,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,t){return this.x+=e,this.y+=t,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,t){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),t!==void 0&&(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,t){const n=P.Tan(e,this);return this.add(n.mul(t))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return P.Dpr(this,e)}cpr(e){return P.Cpr(this,e)}len2(){return P.Len2(this)}len(){return P.Len(this)}pry(e){return P.Pry(this,e)}per(){const{x:e,y:t}=this;return this.x=t,this.y=-e,this}uni(){return P.Uni(this)}tan(e){return P.Tan(this,e)}dist(e){return P.Dist(this,e)}distanceToLineSegment(e,t){return P.DistanceToLineSegment(e,t,this)}slope(e){return P.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return P.Angle(this,e)}toAngle(){return P.ToAngle(this)}lrp(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this}equals(e){return P.Equals(this,e)}equalsXY(e,t){return P.EqualsXY(this,e,t)}norm(){const e=this.len();return this.x=e===0?0:this.x/e,this.y=e===0?0:this.y/e,this}toFixed(){return P.ToFixed(this)}toString(){return P.ToString(P.ToFixed(this))}toJson(){return P.ToJson(this)}toArray(){return P.ToArray(this)}static Add(e,t){return new P(e.x+t.x,e.y+t.y)}static AddXY(e,t,n){return new P(e.x+t,e.y+n)}static Sub(e,t){return new P(e.x-t.x,e.y-t.y)}static SubXY(e,t,n){return new P(e.x-t,e.y-n)}static AddScalar(e,t){return new P(e.x+t,e.y+t)}static SubScalar(e,t){return new P(e.x-t,e.y-t)}static Div(e,t){return new P(e.x/t,e.y/t)}static Mul(e,t){return new P(e.x*t,e.y*t)}static DivV(e,t){return new P(e.x/t.x,e.y/t.y)}static MulV(e,t){return new P(e.x*t.x,e.y*t.y)}static Neg(e){return new P(-e.x,-e.y)}static Per(e){return new P(e.y,-e.x)}static Abs(e){return new P(Math.abs(e.x),Math.abs(e.y))}static Dist(e,t){return((e.y-t.y)**2+(e.x-t.x)**2)**.5}static DistMin(e,t,n){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)<n**2}static Dist2(e,t){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)}static Dpr(e,t){return e.x*t.x+e.y*t.y}static Cross(e,t){return new P(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z)}static Cpr(e,t){return e.x*t.y-t.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return(e.x*e.x+e.y*e.y)**.5}static Pry(e,t){return P.Dpr(e,t)/P.Len(t)}static Uni(e){return P.Div(e,P.Len(e))}static Tan(e,t){return P.Uni(P.Sub(e,t))}static Min(e,t){return new P(Math.min(e.x,t.x),Math.min(e.y,t.y))}static Max(e,t){return new P(Math.max(e.x,t.x),Math.max(e.y,t.y))}static From({x:e,y:t,z:n=1}){return new P(e,t,n)}static FromArray(e){return new P(e[0],e[1])}static Rot(e,t=0){const n=Math.sin(t),s=Math.cos(t);return new P(e.x*s-e.y*n,e.x*n+e.y*s)}static RotWith(e,t,n){const s=e.x-t.x,o=e.y-t.y,i=Math.sin(n),a=Math.cos(n);return new P(t.x+(s*a-o*i),t.y+(s*i+o*a))}static NearestPointOnLineThroughPoint(e,t,n){return P.Mul(t,P.Sub(n,e).pry(t)).add(e)}static NearestPointOnLineSegment(e,t,n,s=!0){if(P.Equals(e,n)||P.Equals(t,n))return P.From(n);const o=P.Tan(t,e),i=P.Add(e,P.Mul(o,P.Sub(n,e).pry(o)));if(s){if(i.x<Math.min(e.x,t.x))return P.Cast(e.x<t.x?e:t);if(i.x>Math.max(e.x,t.x))return P.Cast(e.x>t.x?e:t);if(i.y<Math.min(e.y,t.y))return P.Cast(e.y<t.y?e:t);if(i.y>Math.max(e.y,t.y))return P.Cast(e.y>t.y?e:t)}return i}static DistanceToLineThroughPoint(e,t,n){return P.Dist(n,P.NearestPointOnLineThroughPoint(e,t,n))}static DistanceToLineSegment(e,t,n,s=!0){return P.Dist(n,P.NearestPointOnLineSegment(e,t,n,s))}static Snap(e,t=1){return new P(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}static Cast(e){return e instanceof P?e:P.From(e)}static Slope(e,t){return e.x===t.y?NaN:(e.y-t.y)/(e.x-t.x)}static IsNaN(e){return isNaN(e.x)||isNaN(e.y)}static Angle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}static Lrp(e,t,n){return P.Sub(t,e).mul(n).add(e)}static Med(e,t){return new P((e.x+t.x)/2,(e.y+t.y)/2)}static Equals(e,t){return Math.abs(e.x-t.x)<1e-4&&Math.abs(e.y-t.y)<1e-4}static EqualsXY(e,t,n){return e.x===t&&e.y===n}static Clockwise(e,t,n){return(n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y)<0}static Rescale(e,t){const n=P.Len(e);return new P(t*e.x/n,t*e.y/n)}static ScaleWithOrigin(e,t,n){return P.Sub(e,n).mul(t).add(n)}static ToFixed(e){return new P(zl(e.x),zl(e.y))}static ToInt(e){return new P(parseInt(e.x.toFixed(0)),parseInt(e.y.toFixed(0)),parseInt((e.z??0).toFixed(0)))}static ToCss(e){return`${e.x},${e.y}`}static Nudge(e,t,n){return P.Add(e,P.Tan(t,e).mul(n))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let t=Math.atan2(e.y,e.x);return t<0&&(t+=Math.PI*2),t}static FromAngle(e,t=1){return new P(Math.cos(e)*t,Math.sin(e)*t)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){const{x:t,y:n,z:s}=e;return{x:t,y:n,z:s}}static Average(e){const t=e.length,n=new P(0,0);if(t===0)return n;for(let s=0;s<t;s++)n.add(e[s]);return n.div(t)}static Clamp(e,t,n){return n===void 0?new P(Math.min(Math.max(e.x,t)),Math.min(Math.max(e.y,t))):new P(Math.min(Math.max(e.x,t),n),Math.min(Math.max(e.y,t),n))}static PointsBetween(e,t,n=6){const s=[];for(let o=0;o<n;o++){const i=ss.easeInQuad(o/(n-1)),a=P.Lrp(e,t,i);a.z=Math.min(1,.5+Math.abs(.5-SV(i))*.65),s.push(a)}return s}static SnapToGrid(e,t=8){return new P(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}}const SV=r=>r<.5?2*r*r:-1+(4-2*r)*r;function ln(r){return`${fe(r.x)},${fe(r.y)} `}function No(r,e){return`${fe((r.x+e.x)/2)},${fe((r.y+e.y)/2)} `}const cn=Math.PI,Bn=cn/2,xn=cn*2,xV=Math.sin;function ps(r,e,t){return Math.max(e,typeof t<"u"?Math.min(r,t):r)}function fy(r,e=1e10){return r?Math.round(r*e)/e:0}function Jc(r,e,t=1e-6){return Math.abs(r-e)<=t}function j5(r,e){const t=Math.pow(r-e,2)/Math.pow(r+e,2);return cn*(r+e)*(1+3*t/(10+Math.sqrt(4-3*t)))}function ru(r){return r=r%xn,r<0?r=r+xn:r===0&&(r=0),r}function Fg(r,e){return r=ru(r),e=ru(e),r>e&&(e+=xn),e-r}function R5(r,e){return xn-Fg(r,e)}function Xy(r,e){const t=(e-r)%xn;return 2*t%xn-t}function vE(r){return(xn+r)%xn}function Zv(r,e){const t=xn/e;let n=Math.floor((vE(r)+t/2)/t)*t%xn;return n<cn&&(n+=xn),n>cn&&(n-=xn),n}function D5(r,e){return r===e||Jc(r%(Math.PI/2)-e%(Math.PI/2),0)}function wV(r){return r*cn/180}function CV(r){return r*180/cn}function uu(r,e,t){return new P(r.x,r.y).add(P.FromAngle(t,e))}function G1(r,e,t){const n=r/2,s=e/2,o=[];let i=1/0,a=-1/0,l=1/0,c=-1/0;for(let v=0;v<t;v++){const b=xn/t,S=-Bn+v*b,C=n+n*Math.cos(S),E=s+s*Math.sin(S);C<i&&(i=C),E<l&&(l=E),C>a&&(a=C),E>c&&(c=E),o.push(new P(C,E))}const u=a-i,p=c-l,f=r-u,m=e-p;if(f!==0||m!==0)for(let v=0;v<o.length;v++){const b=o[v];b.x=(b.x-i)/u*r,b.y=(b.y-l)/p*e}return o}function ef(r,e,t,n){return r<n&&t<e}function na(r,e,t,n){const s=Math.max(r,t),o=Math.min(e,n);return s<=o?[s,o]:null}function Wj(r,e,t){return(e.x-r.x)*(t.y-r.y)-(t.x-r.x)*(e.y-r.y)}function ai(r,e){let t=0,n,s;for(let o=0;o<e.length;o++){if(n=e[o],n.x===r.x&&n.y===r.y||(s=e[(o+1)%e.length],P.Dist(r,n)+P.Dist(r,s)===P.Dist(n,s)))return!0;n.y<=r.y?s.y>r.y&&Wj(n,s,r)>0&&(t+=1):s.y<=r.y&&Wj(n,s,r)<0&&(t-=1)}return t!==0}function fe(r){return Math.round(r*1e4)/1e4}function zl(r){return Math.round(r*100)/100}const Kj=r=>Math.abs(r)<Number.MAX_SAFE_INTEGER;function $c(r,e,t){return t<0?Fg(r,e):R5(r,e)}function bE(r,e,t,n){let s;if(Math.abs(r)>cn){s=Xy(e,n);const o=Xy(n,t);return Math.abs(s)<Math.abs(o)?s/r:(r-o)/r}else{s=Xy(e,n);const o=s/r;return Math.sign(s)!==Math.sign(r)?Math.abs(o)>.5?1:0:o}}function EV(r,e,t,n){const s=2*((e-r)%xn)%xn-(e-r)%xn;return n?(xn-Math.abs(s))*(t?1:-1):s}function S2(r,e,t){const n=-2*(r.x*(e.y-t.y)-r.y*(e.x-t.x)+e.x*t.y-t.x*e.y),s=((r.x*r.x+r.y*r.y)*(t.y-e.y)+(e.x*e.x+e.y*e.y)*(r.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-r.y))/n,o=((r.x*r.x+r.y*r.y)*(e.x-t.x)+(e.x*e.x+e.y*e.y)*(t.x-r.x)+(t.x*t.x+t.y*t.y)*(r.x-e.x))/n;return!Number.isFinite(s)||!Number.isFinite(o)?null:new P(s,o)}function kV(r,e,t,n,s){if(t===null)return[P.From(r),P.From(e)];const o=[],i=P.Angle(t,r),a=P.Angle(t,e),l=Fg(i,a);for(let c=0;c<s;c++){const u=c/(s-1),p=i+l*u,f=uu(t,n,p);o.push(f)}return o}const W1=({brush:r,color:e,opacity:t,className:n})=>{const s=I.useRef(null);op(s,r.x,r.y);const o=fe(Math.max(1,r.w)),i=fe(Math.max(1,r.h));return g.jsx("svg",{className:"tl-overlays__item",ref:s,children:e?g.jsxs("g",{className:"tl-brush",opacity:t,children:[g.jsx("rect",{width:o,height:i,fill:e,opacity:.75}),g.jsx("rect",{width:o,height:i,fill:"none",stroke:e,opacity:.1})]}):g.jsx("rect",{className:`tl-brush tl-brush__default ${n}`,width:o,height:i})})},Rn={isSafari:!1,isIos:!1,isChromeForIos:!1,isFirefox:!1,isAndroid:!1,isWebview:!1,isDarwin:!1};typeof window<"u"&&"navigator"in window&&(Rn.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),Rn.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),Rn.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),Rn.isFirefox=/firefox/i.test(navigator.userAgent),Rn.isAndroid=/android/i.test(navigator.userAgent),Rn.isDarwin=window.navigator.userAgent.toLowerCase().indexOf("mac")>-1);const Vj={isLocked:!1,wheelBehavior:"pan",panSpeed:1,zoomSpeed:1,zoomSteps:[.1,.25,.5,1,2,4,8]},K1={duration:0,easing:ss.easeInOutCubic},qj={CAMERA_MOVE:-10},PV=["top","right","bottom","left"],Yj=0,x2=2,gy=1,Xj=5,IV=128;var V1={};const _V={},O5=ko("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),_r={logPreventDefaults:ko("logPreventDefaults",{defaults:{all:!1}}),logPointerCaptures:ko("logPointerCaptures",{defaults:{all:!1}}),logElementRemoves:ko("logElementRemoves",{defaults:{all:!1}}),debugSvg:ko("debugSvg",{defaults:{all:!1}}),showFps:ko("showFps",{defaults:{all:!1}}),measurePerformance:ko("measurePerformance",{defaults:{all:!1}}),throwToBlob:ko("throwToBlob",{defaults:{all:!1}}),reconnectOnPing:ko("reconnectOnPing",{defaults:{all:!1}}),debugCursors:ko("debugCursors",{defaults:{all:!1}}),forceSrgb:ko("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:ko("debugGeometry",{defaults:{all:!1}}),hideShapes:ko("hideShapes",{defaults:{all:!1}}),editOnType:ko("editOnType",{defaults:{all:!1}})};if(typeof Element<"u"){const r=Element.prototype.removeChild;nl("element removal logging",()=>{_r.logElementRemoves.get()?Element.prototype.removeChild=function(e){return console.warn("[tldraw] removing child:",e),r.call(this,e)}:Element.prototype.removeChild=r})}function ko(r,{defaults:e,shouldStoreForSession:t=!0}){return TV({name:r,defaults:e,shouldStoreForSession:t})}function TV(r){const e=AV(r),t=r.shouldStoreForSession?MV(r.name):null,n=$r(`debug:${r.name}`,t??e);return typeof window<"u"&&(r.shouldStoreForSession&&nl(`debug:${r.name}`,()=>{const s=n.get();s===e?YO(`tldraw_debug:${r.name}`):Hk(`tldraw_debug:${r.name}`,JSON.stringify(s))}),Object.defineProperty(window,`tldraw${r.name.replace(/^[a-z]/,s=>s.toUpperCase())}`,{get(){return n.get()},set(s){n.set(s)},configurable:!0})),Object.assign(n,r)}function MV(r){try{return JSON.parse(qO(`tldraw_debug:${r}`)??"null")}catch{return null}}function q1(r){try{return r()}catch{return null}}function AV(r){switch(q1(()=>V1.TLDRAW_ENV)??q1(()=>V1.VERCEL_PUBLIC_TLDRAW_ENV)??q1(()=>V1.NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return r.defaults.production??r.defaults.all;case"preview":case"staging":return r.defaults.staging??r.defaults.all;default:return r.defaults.development??r.defaults.all}}function Jv(r){if(r instanceof HTMLElement)return r;if(r.parentElement)return Jv(r.parentElement);throw Error("Could not find a parent element of an HTML type!")}function Ot(r){r.preventDefault(),_r.logPreventDefaults.get()&&console.warn("preventDefault called on event:",r)}function zg(r,e){if(r.setPointerCapture(e.pointerId),_r.logPointerCaptures.get()){const t=O5.get();t.set(r,(t.get(r)??0)+1),console.warn("setPointerCapture called on element:",r,e)}}function $g(r,e){if(r.hasPointerCapture(e.pointerId)&&(r.releasePointerCapture(e.pointerId),_r.logPointerCaptures.get())){const t=O5.get();t.get(r)===1?t.delete(r):t.has(r)?t.set(r,t.get(r)-1):console.warn("Release without capture"),console.warn("releasePointerCapture called on element:",r,e)}}const Ar=r=>r.stopPropagation(),js=(r,e,t)=>{r&&r.style.setProperty(e,t)},Gs=r=>Rn.isDarwin?r.metaKey:r.ctrlKey||r.metaKey;function si(r){return r.isKilled=!0,{point:{x:r.clientX,y:r.clientY,z:r.pressure},shiftKey:r.shiftKey,altKey:r.altKey,ctrlKey:r.metaKey||r.ctrlKey,metaKey:r.metaKey,accelKey:Gs(r),pointerId:r.pointerId,button:r.button,isPen:r.pointerType==="pen"}}function w2(){const r=ue();return I.useMemo(function(){let n,s;function o(b){if(!b.isKilled){if(b.button===x2){r.dispatch({type:"pointer",target:"canvas",name:"right_click",...si(b)});return}b.button!==0&&b.button!==1&&b.button!==5||(zg(b.currentTarget,b),r.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...si(b)}))}}function i(b){b.isKilled||b.clientX===n&&b.clientY===s||(n=b.clientX,s=b.clientY,r.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...si(b)}))}function a(b){b.isKilled||b.button!==0&&b.button!==1&&b.button!==2&&b.button!==5||(n=b.clientX,s=b.clientY,$g(b.currentTarget,b),r.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...si(b)}))}function l(b){if(b.isKilled||r.getInstanceState().isPenMode&&b.pointerType!=="pen")return;const S=b.pointerType==="mouse"||b.pointerType==="pen";r.updateInstanceState({isHoveringCanvas:S?!0:null})}function c(b){if(b.isKilled||r.getInstanceState().isPenMode&&b.pointerType!=="pen")return;const S=b.pointerType==="mouse"||b.pointerType==="pen";r.updateInstanceState({isHoveringCanvas:S?!1:null})}function u(b){b.isKilled=!0,Ot(b)}function p(b){b.isKilled=!0,b.target instanceof HTMLElement&&b.target.tagName!=="A"&&b.target.tagName!=="TEXTAREA"&&!(r.getEditingShape()&&b.target.className.includes("tl-text-content"))&&Ot(b)}function f(b){Ot(b)}async function m(b){var C,E;if(Ot(b),Ar(b),!((E=(C=b.dataTransfer)==null?void 0:C.files)!=null&&E.length))return;const S=Array.from(b.dataTransfer.files);await r.putExternalContent({type:"files",files:S,point:r.screenToPage({x:b.clientX,y:b.clientY}),ignoreParent:!1})}function v(b){Ar(b)}return{onPointerDown:o,onPointerMove:i,onPointerUp:a,onPointerEnter:l,onPointerLeave:c,onDragOver:f,onDrop:m,onTouchStart:u,onTouchEnd:p,onClick:v}},[r])}function jV(){const r=ue();I.useEffect(()=>{let e=r.getInstanceState().isCoarsePointer;const t=i=>{const a=i.pointerType!=="mouse";e!==a&&(e=a,r.updateInstanceState({isCoarsePointer:a}))};window.addEventListener("pointerdown",t,{capture:!0});const n=window.matchMedia&&window.matchMedia("(any-pointer: coarse)"),s=Rn.isFirefox&&!Rn.isAndroid&&!Rn.isIos,o=()=>{const i=s?!1:n.matches;e===i&&(e=i,r.updateInstanceState({isCoarsePointer:i}))};return n&&(n.addEventListener("change",o),o()),()=>{window.removeEventListener("pointerdown",t,{capture:!0}),n&&n.removeEventListener("change",o)}},[r])}const L5=I.createContext(null);function N5({container:r,children:e}){return g.jsx(L5.Provider,{value:r,children:e})}function Kr(){return Lo(I.useContext(L5),"useContainer used outside of <Tldraw />")}function RV(){const r=ue(),e=Kr(),t=ye("isFocused",()=>r.getIsFocused(),[r]);I.useEffect(()=>{if(!e)return;function n(s){if(s.isSpecialRedispatchedEvent)return;Ot(s),Ar(s);const o=e.querySelector(".tl-canvas");if(!o)return;const i=new DragEvent(s.type,s);i.isSpecialRedispatchedEvent=!0,o.dispatchEvent(i)}return e.addEventListener("dragover",n),e.addEventListener("drop",n),()=>{e.removeEventListener("dragover",n),e.removeEventListener("drop",n)}},[e]),I.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;let n=null;const s=()=>{n!=null&&n();const o=`(resolution: ${window.devicePixelRatio}dppx)`,i=matchMedia(o),a=l=>{l.type==="change"&&s()};i.addEventListener?i.addEventListener("change",s):i.addListener&&i.addListener(a),n=()=>{i.removeEventListener?i.removeEventListener("change",s):i.removeListener&&i.removeListener(a)},r.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return s(),()=>{n==null||n()}},[r]),I.useEffect(()=>{if(!t)return;const n=a=>{if(a.altKey&&(r.isIn("zoom")||!r.getPath().endsWith(".idle"))&&!my(r)&&Ot(a),a.isKilled)return;switch(a.isKilled=!0,a.key){case"=":case"-":case"0":{if(a.metaKey||a.ctrlKey){Ot(a);return}break}case"Tab":{if(my(r))return;break}case",":return;case"Escape":{if((r.getEditingShape()||r.getSelectedShapeIds().length>0)&&Ot(a),r.menus.getOpenMenus().length>0)return;r.inputs.keys.has("Escape")||(r.inputs.keys.add("Escape"),r.cancel(),e.focus());return}default:if(my(r))return}const l={type:"keyboard",name:a.repeat?"key_repeat":"key_down",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,metaKey:a.metaKey,accelKey:Gs(a)};r.dispatch(l)},s=a=>{if(a.isKilled||(a.isKilled=!0,my(r))||a.key===",")return;const l={type:"keyboard",name:"key_up",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,metaKey:a.metaKey,accelKey:Gs(a)};r.dispatch(l)};function o(a){var l,c;if(e.contains(a.target)){const u=a.touches[0].pageX,p=a.touches[0].radiusX||0;(u-p<10||u+p>r.getViewportScreenBounds().width-10)&&(((l=a.target)==null?void 0:l.tagName)==="BUTTON"&&((c=a.target)==null||c.click()),Ot(a))}}const i=a=>{e.contains(a.target)&&(a.ctrlKey||a.metaKey)&&Ot(a)};return e.addEventListener("touchstart",o,{passive:!1}),e.addEventListener("wheel",i,{passive:!1}),document.addEventListener("gesturestart",Ot),document.addEventListener("gesturechange",Ot),document.addEventListener("gestureend",Ot),e.addEventListener("keydown",n),e.addEventListener("keyup",s),()=>{e.removeEventListener("touchstart",o),e.removeEventListener("wheel",i),document.removeEventListener("gesturestart",Ot),document.removeEventListener("gesturechange",Ot),document.removeEventListener("gestureend",Ot),e.removeEventListener("keydown",n),e.removeEventListener("keyup",s)}},[r,e,t])}const DV=["input","select","button","textarea"];function my(r){const{activeElement:e}=document;return r.menus.hasOpenMenus()||e&&(e.getAttribute("contenteditable")||DV.indexOf(e.tagName.toLowerCase())>-1)}const OV=["textarea","input"];function LV(r){const e=ue();I.useEffect(()=>{const t=r.current;if(!t)return;const n=s=>{var o;if(s instanceof PointerEvent&&s.pointerType==="pen"){s.isKilled=!0;const{target:i}=s;if(OV.includes((o=i.tagName)==null?void 0:o.toLocaleLowerCase())||e.isIn("select.editing_shape"))return;Ot(s)}};return t.addEventListener("touchstart",n),t.addEventListener("touchend",n),()=>{t.removeEventListener("touchstart",n),t.removeEventListener("touchend",n)}},[e,r])}function NV(r,e,t){return Math.max(e,Math.min(r,t))}const vs={toVector(r,e){return r===void 0&&(r=e),Array.isArray(r)?r:[r,r]},add(r,e){return[r[0]+e[0],r[1]+e[1]]},sub(r,e){return[r[0]-e[0],r[1]-e[1]]},addTo(r,e){r[0]+=e[0],r[1]+=e[1]},subTo(r,e){r[0]-=e[0],r[1]-=e[1]}};function Zj(r,e,t){return e===0||Math.abs(e)===1/0?Math.pow(r,t*5):r*e*t/(e+t*r)}function Jj(r,e,t,n=.15){return n===0?NV(r,e,t):r<e?-Zj(e-r,t-e,n)+e:r>t?+Zj(r-t,t-e,n)+t:r}function FV(r,[e,t],[n,s]){const[[o,i],[a,l]]=r;return[Jj(e,o,i,n),Jj(t,a,l,s)]}function zV(r,e){if(typeof r!="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function $V(r){var e=zV(r,"string");return typeof e=="symbol"?e:String(e)}function Fs(r,e,t){return e=$V(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Qj(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,n)}return t}function lr(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Qj(Object(t),!0).forEach(function(n){Fs(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Qj(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}const F5={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function eR(r){return r?r[0].toUpperCase()+r.slice(1):""}const BV=["enter","leave"];function UV(r=!1,e){return r&&!BV.includes(e)}function HV(r,e="",t=!1){const n=F5[r],s=n&&n[e]||e;return"on"+eR(r)+eR(s)+(UV(t,s)?"Capture":"")}const GV=["gotpointercapture","lostpointercapture"];function WV(r){let e=r.substring(2).toLowerCase();const t=!!~e.indexOf("passive");t&&(e=e.replace("passive",""));const n=GV.includes(e)?"capturecapture":"capture",s=!!~e.indexOf(n);return s&&(e=e.replace("capture","")),{device:e,capture:s,passive:t}}function KV(r,e=""){const t=F5[r],n=t&&t[e]||e;return r+n}function z5(r){return"touches"in r}function VV(r){return z5(r)?"touch":"pointerType"in r?r.pointerType:"mouse"}function qV(r){return Array.from(r.touches).filter(e=>{var t,n;return e.target===r.currentTarget||((t=r.currentTarget)===null||t===void 0||(n=t.contains)===null||n===void 0?void 0:n.call(t,e.target))})}function SE(r,e){try{const t=e.clientX-r.clientX,n=e.clientY-r.clientY,s=(e.clientX+r.clientX)/2,o=(e.clientY+r.clientY)/2,i=Math.hypot(t,n);return{angle:-(Math.atan2(t,n)*180)/Math.PI,distance:i,origin:[s,o]}}catch{}return null}function YV(r){return qV(r).map(e=>e.identifier)}function tR(r,e){const[t,n]=Array.from(r.touches).filter(s=>e.includes(s.identifier));return SE(t,n)}const nR=40,rR=800;function $5(r){let{deltaX:e,deltaY:t,deltaMode:n}=r;return n===1?(e*=nR,t*=nR):n===2&&(e*=rR,t*=rR),[e,t]}function XV(r){const e={};if("buttons"in r&&(e.buttons=r.buttons),"shiftKey"in r){const{shiftKey:t,altKey:n,metaKey:s,ctrlKey:o}=r;Object.assign(e,{shiftKey:t,altKey:n,metaKey:s,ctrlKey:o})}return e}function Qv(r,...e){return typeof r=="function"?r(...e):r}function ZV(){}function JV(...r){return r.length===0?ZV:r.length===1?r[0]:function(){let e;for(const t of r)e=t.apply(this,arguments)||e;return e}}function sR(r,e){return Object.assign({},e,r||{})}const QV=32;class B5{constructor(e,t,n){this.ctrl=e,this.args=t,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:n,args:s}=this;t[n]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=s,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,n=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=n.from?Qv(n.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:n,shared:s}=this;t.args=this.args;let o=0;if(e&&(t.event=e,n.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,s.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,s.locked=!!document.pointerLockElement,Object.assign(s,XV(e)),s.down=s.pressed=s.buttons%2===1||s.touches>0,o=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const R=t._delta.map(Math.abs);vs.addTo(t._distance,R)}this.axisIntent&&this.axisIntent(e);const[i,a]=t._movement,[l,c]=n.threshold,{_step:u,values:p}=t;if(n.hasCustomTransform?(u[0]===!1&&(u[0]=Math.abs(i)>=l&&p[0]),u[1]===!1&&(u[1]=Math.abs(a)>=c&&p[1])):(u[0]===!1&&(u[0]=Math.abs(i)>=l&&Math.sign(i)*l),u[1]===!1&&(u[1]=Math.abs(a)>=c&&Math.sign(a)*c)),t.intentional=u[0]!==!1||u[1]!==!1,!t.intentional)return;const f=[0,0];if(n.hasCustomTransform){const[R,D]=p;f[0]=u[0]!==!1?R-u[0]:0,f[1]=u[1]!==!1?D-u[1]:0}else f[0]=u[0]!==!1?i-u[0]:0,f[1]=u[1]!==!1?a-u[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(f);const m=t.offset,v=t._active&&!t._blocked||t.active;v&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=s[this.ingKey]=t._active,e&&(t.first&&("bounds"in n&&(t._bounds=Qv(n.bounds,t)),this.setup&&this.setup()),t.movement=f,this.computeOffset()));const[b,S]=t.offset,[[C,E],[T,w]]=t._bounds;t.overflow=[b<C?-1:b>E?1:0,S<T?-1:S>w?1:0],t._movementBound[0]=t.overflow[0]?t._movementBound[0]===!1?t._movement[0]:t._movementBound[0]:!1,t._movementBound[1]=t.overflow[1]?t._movementBound[1]===!1?t._movement[1]:t._movementBound[1]:!1;const M=t._active?n.rubberband||[0,0]:[0,0];if(t.offset=FV(t._bounds,t.offset,M),t.delta=vs.sub(t.offset,m),this.computeMovement(),v&&(!t.last||o>QV)){t.delta=vs.sub(t.offset,m);const R=t.delta.map(Math.abs);vs.addTo(t.distance,R),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&o>0&&(t.velocity=[R[0]/o,R[1]/o],t.timeDelta=o)}}emit(){const e=this.state,t=this.shared,n=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!n.triggerAllEvents)return;const s=this.handler(lr(lr(lr({},t),e),{},{[this.aliasKey]:e.values}));s!==void 0&&(e.memo=s)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function eq([r,e],t){const n=Math.abs(r),s=Math.abs(e);if(n>s&&n>t)return"x";if(s>n&&s>t)return"y"}class tq extends B5{constructor(...e){super(...e),Fs(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=vs.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=vs.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,n=this.config;if(!t.axis&&e){const s=typeof n.axisThreshold=="object"?n.axisThreshold[VV(e)]:n.axisThreshold;t.axis=eq(t._movement,s)}t._blocked=(n.lockDirection||!!n.axis)&&!t.axis||!!n.axis&&n.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const nq=r=>r,oR=.15,U5={enabled(r=!0){return r},eventOptions(r,e,t){return lr(lr({},t.shared.eventOptions),r)},preventDefault(r=!1){return r},triggerAllEvents(r=!1){return r},rubberband(r=0){switch(r){case!0:return[oR,oR];case!1:return[0,0];default:return vs.toVector(r)}},from(r){if(typeof r=="function")return r;if(r!=null)return vs.toVector(r)},transform(r,e,t){const n=r||t.shared.transform;return this.hasCustomTransform=!!n,n||nq},threshold(r){return vs.toVector(r,0)}},rq=0,Bg=lr(lr({},U5),{},{axis(r,e,{axis:t}){if(this.lockDirection=t==="lock",!this.lockDirection)return t},axisThreshold(r=rq){return r},bounds(r={}){if(typeof r=="function")return o=>Bg.bounds(r(o));if("current"in r)return()=>r.current;if(typeof HTMLElement=="function"&&r instanceof HTMLElement)return r;const{left:e=-1/0,right:t=1/0,top:n=-1/0,bottom:s=1/0}=r;return[[e,t],[n,s]]}}),Ug=typeof window<"u"&&window.document&&window.document.createElement;function H5(){return Ug&&"ontouchstart"in window}function sq(){return H5()||Ug&&window.navigator.maxTouchPoints>1}function oq(){return Ug&&"onpointerdown"in window}function iq(){return Ug&&"exitPointerLock"in window.document}function aq(){try{return"constructor"in GestureEvent}catch{return!1}}const Di={isBrowser:Ug,gesture:aq(),touch:H5(),touchscreen:sq(),pointer:oq(),pointerLock:iq()},lq=250,cq=180,dq=.5,uq=50,hq=250,pq=10,iR={mouse:0,touch:0,pen:8};lr(lr({},Bg),{},{device(r,e,{pointer:{touch:t=!1,lock:n=!1,mouse:s=!1}={}}){return this.pointerLock=n&&Di.pointerLock,Di.touch&&t?"touch":this.pointerLock?"mouse":Di.pointer&&!s?"pointer":Di.touch?"touch":"mouse"},preventScrollAxis(r,e,{preventScroll:t}){if(this.preventScrollDelay=typeof t=="number"?t:t||t===void 0&&r?lq:void 0,!(!Di.touchscreen||t===!1))return r||(t!==void 0?"y":void 0)},pointerCapture(r,e,{pointer:{capture:t=!0,buttons:n=1,keys:s=!0}={}}){return this.pointerButtons=n,this.keys=s,!this.pointerLock&&this.device==="pointer"&&t},threshold(r,e,{filterTaps:t=!1,tapsThreshold:n=3,axis:s=void 0}){const o=vs.toVector(r,t?n:s?1:0);return this.filterTaps=t,this.tapsThreshold=n,o},swipe({velocity:r=dq,distance:e=uq,duration:t=hq}={}){return{velocity:this.transform(vs.toVector(r)),distance:this.transform(vs.toVector(e)),duration:t}},delay(r=0){switch(r){case!0:return cq;case!1:return 0;default:return r}},axisThreshold(r){return r?lr(lr({},iR),r):iR},keyboardDisplacement(r=pq){return r}});function G5(r){const[e,t]=r.overflow,[n,s]=r._delta,[o,i]=r._direction;(e<0&&n>0&&o<0||e>0&&n<0&&o>0)&&(r._movement[0]=r._movementBound[0]),(t<0&&s>0&&i<0||t>0&&s<0&&i>0)&&(r._movement[1]=r._movementBound[1])}const fq=30,gq=100;class mq extends B5{constructor(...e){super(...e),Fs(this,"ingKey","pinching"),Fs(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:t,lastOffset:n}=this.state;e==="wheel"?this.state.offset=vs.add(t,n):this.state.offset=[(1+t[0])*n[0],t[1]+n[1]]}computeMovement(){const{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){const e=this.state,[t,n]=e._movement;if(!e.axis){const s=Math.abs(t)*fq-Math.abs(n);s<0?e.axis="angle":s>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&(this.state.axis==="scale"?e[1]=0:this.state.axis==="angle"&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);const t=this.state,n=this.ctrl.touchIds;if(t._active&&t._touchIds.every(o=>n.has(o))||n.size<2)return;this.start(e),t._touchIds=Array.from(n).slice(0,2);const s=tR(e,t._touchIds);s&&this.pinchStart(e,s)}pointerStart(e){if(e.buttons!=null&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const t=this.state,n=t._pointerEvents,s=this.ctrl.pointerIds;if(t._active&&Array.from(n.keys()).every(i=>s.has(i))||(n.size<2&&n.set(e.pointerId,e),t._pointerEvents.size<2))return;this.start(e);const o=SE(...Array.from(n.values()));o&&this.pinchStart(e,o)}pinchStart(e,t){const n=this.state;n.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const t=tR(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){const t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;const n=SE(...Array.from(t.values()));n&&this.pinchMove(e,n)}pinchMove(e,t){const n=this.state,s=n._values[1],o=t.angle-s;let i=0;Math.abs(o)>270&&(i+=Math.sign(o)),this.computeValues([t.distance,t.angle-360*i]),n.origin=t.origin,n.turns=i,n._movement=[n._values[0]/n._initial[0]-1,n._values[1]-n._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(t=>!this.ctrl.touchIds.has(t))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch{}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];const n=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=vs.sub(t._movement,n),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const t=this.config.modifierKey;t&&(Array.isArray(t)?!t.find(n=>e[n]):!e[t])||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const n=this.state;n._delta=[-$5(e)[1]/gq*n.offset[0],0],vs.addTo(n._movement,n._delta),G5(n),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}const yq=lr(lr({},U5),{},{device(r,e,{shared:t,pointer:{touch:n=!1}={}}){if(t.target&&!Di.touch&&Di.gesture)return"gesture";if(Di.touch&&n)return"touch";if(Di.touchscreen){if(Di.pointer)return"pointer";if(Di.touch)return"touch"}},bounds(r,e,{scaleBounds:t={},angleBounds:n={}}){const s=i=>{const a=sR(Qv(t,i),{min:-1/0,max:1/0});return[a.min,a.max]},o=i=>{const a=sR(Qv(n,i),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof t!="function"&&typeof n!="function"?[s(),o()]:i=>[s(i),o(i)]},threshold(r,e,t){return this.lockDirection=t.axis==="lock",vs.toVector(r,this.lockDirection?[.1,3]:0)},modifierKey(r){return r===void 0?"ctrlKey":r},pinchOnWheel(r=!0){return r}});lr(lr({},Bg),{},{mouseOnly:(r=!0)=>r});class vq extends tq{constructor(...e){super(...e),Fs(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const t=this.state;t._delta=$5(e),vs.addTo(t._movement,t._delta),G5(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}const bq=Bg;lr(lr({},Bg),{},{mouseOnly:(r=!0)=>r});const C2=new Map,xE=new Map;function Sq(r){C2.set(r.key,r.engine),xE.set(r.key,r.resolver)}const xq={key:"pinch",engine:mq,resolver:yq},wq={key:"wheel",engine:vq,resolver:bq};function Cq(r,e){if(r==null)return{};var t={},n=Object.keys(r),s,o;for(o=0;o<n.length;o++)s=n[o],!(e.indexOf(s)>=0)&&(t[s]=r[s]);return t}function Eq(r,e){if(r==null)return{};var t=Cq(r,e),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(s=0;s<o.length;s++)n=o[s],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(t[n]=r[n])}return t}const kq={target(r){if(r)return()=>"current"in r?r.current:r},enabled(r=!0){return r},window(r=Di.isBrowser?window:void 0){return r},eventOptions({passive:r=!0,capture:e=!1}={}){return{passive:r,capture:e}},transform(r){return r}},Pq=["target","eventOptions","window","enabled","transform"];function Zy(r={},e){const t={};for(const[n,s]of Object.entries(e))switch(typeof s){case"function":t[n]=s.call(t,r[n],n,r);break;case"object":t[n]=Zy(r[n],s);break;case"boolean":s&&(t[n]=r[n]);break}return t}function Iq(r,e,t={}){const n=r,{target:s,eventOptions:o,window:i,enabled:a,transform:l}=n,c=Eq(n,Pq);if(t.shared=Zy({target:s,eventOptions:o,window:i,enabled:a,transform:l},kq),e){const u=xE.get(e);t[e]=Zy(lr({shared:t.shared},c),u)}else for(const u in c){const p=xE.get(u);p&&(t[u]=Zy(lr({shared:t.shared},c[u]),p))}return t}class W5{constructor(e,t){Fs(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,n,s,o){const i=this._listeners,a=KV(t,n),l=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},c=lr(lr({},l),o);e.addEventListener(a,s,c);const u=()=>{e.removeEventListener(a,s,c),i.delete(u)};return i.add(u),u}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class _q{constructor(){Fs(this,"_timeouts",new Map)}add(e,t,n=140,...s){this.remove(e),this._timeouts.set(e,window.setTimeout(t,n,...s))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class Tq{constructor(e){Fs(this,"gestures",new Set),Fs(this,"_targetEventStore",new W5(this)),Fs(this,"gestureEventStores",{}),Fs(this,"gestureTimeoutStores",{}),Fs(this,"handlers",{}),Fs(this,"config",{}),Fs(this,"pointerIds",new Set),Fs(this,"touchIds",new Set),Fs(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),Mq(this,e)}setEventIds(e){if(z5(e))return this.touchIds=new Set(YV(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=Iq(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,n={};let s;if(!(t.target&&(s=t.target(),!s))){if(t.enabled){for(const i of this.gestures){const a=this.config[i],l=aR(n,a.eventOptions,!!s);if(a.enabled){const c=C2.get(i);new c(this,e,i).bind(l)}}const o=aR(n,t.eventOptions,!!s);for(const i in this.nativeHandlers)o(i,"",a=>this.nativeHandlers[i](lr(lr({},this.state.shared),{},{event:a,args:e})),void 0,!0)}for(const o in n)n[o]=JV(...n[o]);if(!s)return n;for(const o in n){const{device:i,capture:a,passive:l}=WV(o);this._targetEventStore.add(s,i,"",n[o],{capture:a,passive:l})}}}}function th(r,e){r.gestures.add(e),r.gestureEventStores[e]=new W5(r,e),r.gestureTimeoutStores[e]=new _q}function Mq(r,e){e.drag&&th(r,"drag"),e.wheel&&th(r,"wheel"),e.scroll&&th(r,"scroll"),e.move&&th(r,"move"),e.pinch&&th(r,"pinch"),e.hover&&th(r,"hover")}const aR=(r,e,t)=>(n,s,o,i={},a=!1)=>{var l,c;const u=(l=i.capture)!==null&&l!==void 0?l:e.capture,p=(c=i.passive)!==null&&c!==void 0?c:e.passive;let f=a?n:HV(n,s,u);t&&p&&(f+="Passive"),r[f]=r[f]||[],r[f].push(o)},Aq=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function jq(r){const e={},t={},n=new Set;for(let s in r)Aq.test(s)?(n.add(RegExp.lastMatch),t[s]=r[s]):e[s]=r[s];return[t,e,n]}function nh(r,e,t,n,s,o){if(!r.has(t)||!C2.has(n))return;const i=t+"Start",a=t+"End",l=c=>{let u;return c.first&&i in e&&e[i](c),t in e&&(u=e[t](c)),c.last&&a in e&&e[a](c),u};s[n]=l,o[n]=o[n]||{}}function Rq(r,e){const[t,n,s]=jq(r),o={};return nh(s,t,"onDrag","drag",o,e),nh(s,t,"onWheel","wheel",o,e),nh(s,t,"onScroll","scroll",o,e),nh(s,t,"onPinch","pinch",o,e),nh(s,t,"onMove","move",o,e),nh(s,t,"onHover","hover",o,e),{handlers:o,config:e,nativeHandlers:n}}function Dq(r,e={},t,n){const s=Ht.useMemo(()=>new Tq(r),[]);if(s.applyHandlers(r,n),s.applyConfig(e,t),Ht.useEffect(s.effect.bind(s)),Ht.useEffect(()=>s.clean.bind(s),[]),e.target===void 0)return s.bind.bind(s)}function Oq(r){return r.forEach(Sq),function(t,n){const{handlers:s,nativeHandlers:o,config:i}=Rq(t,n||{});return Dq(s,i,void 0,o)}}const lR=10,Lq=/Mac|iPod|iPhone|iPad/.test(typeof window>"u"?"node":window.navigator.platform);function K5(r){let{deltaY:e,deltaX:t}=r,n=0;return r.ctrlKey||r.altKey||r.metaKey?n=(Math.abs(e)>lR?lR*Math.sign(e):e)/100:r.shiftKey&&!Lq&&(t=e,e=0),{x:-t,y:-e,z:-n}}const Nq=Oq([wq,xq]);let rh;const Fq=r=>rh===void 0?(rh=r,!1):r-rh>120&&r-rh<160?(rh=r,!0):(rh=r,!1);function zq(r){const e=ue(),t=I.useMemo(()=>{let n="not sure";const s=({event:b})=>{if(!e.getInstanceState().isFocused||(n="not sure",Fq(Date.now())))return;const S=e.getEditingShapeId();if(S){const T=e.getShape(S);if(T&&e.getShapeUtil(T).canScroll(T)){const M=e.getShapePageBounds(S);if(M!=null&&M.containsPoint(e.inputs.currentPagePoint))return}}Ot(b),Ar(b);const C=K5(b);if(C.x===0&&C.y===0)return;const E={type:"wheel",name:"wheel",delta:C,point:new P(b.clientX,b.clientY),shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey,metaKey:b.metaKey,accelKey:Gs(b)};e.dispatch(E)};let o=1,i=1,a=1,l=0;const c=new P,u=new P,p=b=>{const S=r.current;n="not sure";const{event:C,origin:E,da:T}=b;C instanceof WheelEvent||(C.target===S||S!=null&&S.contains(C.target))&&(u.x=E[0],u.y=E[1],c.x=E[0],c.y=E[1],o=T[0],i=e.getZoomLevel(),e.dispatch({type:"pinch",name:"pinch_start",point:{x:E[0],y:E[1],z:e.getZoomLevel()},delta:{x:0,y:0},shiftKey:C.shiftKey,altKey:C.altKey,ctrlKey:C.metaKey||C.ctrlKey,metaKey:C.metaKey,accelKey:Gs(C)}))},f=b=>{if(b&&(n="zooming"),n==="zooming")return;const S=Math.abs(l-o),C=P.Dist(c,u);switch(n){case"not sure":{S>24?n="zooming":C>16&&(n="panning");break}case"panning":{S>64&&(n="zooming");break}}};return{onWheel:s,onPinchStart:p,onPinchEnd:b=>{const S=r.current,{event:C,origin:E,offset:T}=b;if(C instanceof WheelEvent||!(C.target===S||S!=null&&S.contains(C.target)))return;const w=T[0];n="not sure",e.timers.requestAnimationFrame(()=>{e.dispatch({type:"pinch",name:"pinch_end",point:{x:E[0],y:E[1],z:w},delta:{x:E[0],y:E[1]},shiftKey:C.shiftKey,altKey:C.altKey,ctrlKey:C.metaKey||C.ctrlKey,metaKey:C.metaKey,accelKey:Gs(C)})})},onPinch:b=>{const S=r.current,{event:C,origin:E,offset:T,da:w}=b;if(C instanceof WheelEvent||!(C.target===S||S!=null&&S.contains(C.target)))return;const M=b.type==="gesturechange"||b.type==="gestureend";l=w[0];const R=E[0]-u.x,D=E[1]-u.y;switch(u.x=E[0],u.y=E[1],f(M),n){case"zooming":{a=T[0],e.dispatch({type:"pinch",name:"pinch",point:{x:E[0],y:E[1],z:a},delta:{x:R,y:D},shiftKey:C.shiftKey,altKey:C.altKey,ctrlKey:C.metaKey||C.ctrlKey,metaKey:C.metaKey,accelKey:Gs(C)});break}case"panning":{e.dispatch({type:"pinch",name:"pinch",point:{x:E[0],y:E[1],z:i},delta:{x:R,y:D},shiftKey:C.shiftKey,altKey:C.altKey,ctrlKey:C.metaKey||C.ctrlKey,metaKey:C.metaKey,accelKey:Gs(C)});break}}}}},[e,r]);Nq(t,{target:r,eventOptions:{passive:!1},pinch:{from:()=>[e.getZoomLevel(),0],scaleBounds:()=>{const n=e.getBaseZoom(),s=e.getCameraOptions().zoomSteps,o=s[0]*n,i=s[s.length-1]*n;return{from:e.getZoomLevel(),max:i,min:o}}}})}function Y1(r,e,t){const n=r.getShape(e),s=r.getShapeHandles(n);return{shape:n,handle:s.find(o=>o.id===t)}}function $q(r,e){const t=ue();return I.useMemo(()=>{const n=l=>{if(l.isKilled)return;const c=Jv(l.currentTarget);zg(c,l);const{shape:u,handle:p}=Y1(t,r,e);p&&t.dispatch({type:"pointer",target:"handle",handle:p,shape:u,name:"pointer_down",...si(l)})};let s,o;return{onPointerDown:n,onPointerMove:l=>{if(l.isKilled||l.clientX===s&&l.clientY===o)return;s=l.clientX,o=l.clientY;const{shape:c,handle:u}=Y1(t,r,e);u&&t.dispatch({type:"pointer",target:"handle",handle:u,shape:c,name:"pointer_move",...si(l)})},onPointerUp:l=>{if(l.isKilled)return;const c=Jv(l.currentTarget);$g(c,l);const{shape:u,handle:p}=Y1(t,r,e);p&&t.dispatch({type:"pointer",target:"handle",handle:p,shape:u,name:"pointer_up",...si(l)})}}},[t,r,e])}function Bq(r){const e=ue();I.useLayoutEffect(()=>{const t=_O(()=>{r.current&&e.updateViewportScreenBounds(r.current)},200,{trailing:!0}),n=e.timers.setInterval(t,1e3);window.addEventListener("resize",t);const s=new ResizeObserver(a=>{a[0].contentRect&&t()}),o=r.current;let i=null;return o&&(s.observe(o),i=Uq(o),i.addEventListener("scroll",t)),()=>{clearInterval(n),window.removeEventListener("resize",t),s.disconnect(),i==null||i.removeEventListener("scroll",t),t.cancel()}},[e,r])}/*!
 * Author: excalidraw
 * MIT License: https://github.com/excalidraw/excalidraw/blob/master/LICENSE
 * https://github.com/excalidraw/excalidraw/blob/48c3465b19f10ec755b3eb84e21a01a468e96e43/packages/excalidraw/utils.ts#L600
 */const Uq=r=>{let e=r.parentElement;for(;e;){if(e===document.body)return document;const{overflowY:t}=window.getComputedStyle(e);if(e.scrollHeight>e.clientHeight&&(t==="auto"||t==="scroll"||t==="overlay"))return e;e=e.parentElement}return document};let Ve=class Jr{constructor(e=0,t=0,n=0,s=0){k(this,"x",0);k(this,"y",0);k(this,"w",0);k(this,"h",0);this.x=e,this.y=t,this.w=n,this.h=s}get point(){return new P(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new P(this.midX,this.midY)}set center(e){this.minX=e.x-this.width/2,this.minY=e.y-this.height/2}get corners(){return[new P(this.minX,this.minY),new P(this.maxX,this.minY),new P(this.maxX,this.maxY),new P(this.minX,this.maxY)]}get cornersAndCenter(){return[new P(this.minX,this.minY),new P(this.maxX,this.minY),new P(this.maxX,this.maxY),new P(this.minX,this.maxY),this.center]}get sides(){const{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new P(this.w,this.h)}toFixed(){return this.x=fy(this.x),this.y=fy(this.y),this.w=fy(this.w),this.h=fy(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,t=0,n=0,s=0){return this.x=e,this.y=t,this.w=n,this.h=s,this}expand(e){const t=Math.min(this.minX,e.minX),n=Math.min(this.minY,e.minY),s=Math.max(this.maxX,e.maxX),o=Math.max(this.maxY,e.maxY);return this.x=t,this.y=n,this.w=s-t,this.h=o-n,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=e*2,this.h+=e*2,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){const{x:e,y:t,w:n,h:s}=this;return new Jr(e,t,n,s)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){const t=Math.round(this.minX/e)*e,n=Math.round(this.minY/e)*e,s=Math.round(this.maxX/e)*e,o=Math.round(this.maxY/e)*e;this.minX=t,this.minY=n,this.width=Math.max(1,s-t),this.height=Math.max(1,o-n)}collides(e){return Jr.Collides(this,e)}contains(e){return Jr.Contains(this,e)}includes(e){return Jr.Includes(this,e)}containsPoint(e,t=0){return Jr.ContainsPoint(this,e,t)}getHandlePoint(e){switch(e){case"top_left":return new P(this.minX,this.minY);case"top_right":return new P(this.maxX,this.minY);case"bottom_left":return new P(this.minX,this.maxY);case"bottom_right":return new P(this.maxX,this.maxY);case"top":return new P(this.midX,this.minY);case"right":return new P(this.maxX,this.midY);case"bottom":return new P(this.midX,this.maxY);case"left":return new P(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(e,t,n){const{minX:s,minY:o,maxX:i,maxY:a}=this;let{minX:l,minY:c,maxX:u,maxY:p}=this;switch(e){case"left":case"top_left":case"bottom_left":{l+=t;break}case"right":case"top_right":case"bottom_right":{u+=t;break}}switch(e){case"top":case"top_left":case"top_right":{c+=n;break}case"bottom":case"bottom_left":case"bottom_right":{p+=n;break}}const f=(u-l)/(i-s),m=(p-c)/(a-o),v=f<0,b=m<0;if(v){const S=u;u=l,l=S}if(b){const S=p;p=c,c=S}this.minX=l,this.minY=c,this.width=Math.abs(u-l),this.height=Math.abs(p-c)}union(e){const t=Math.min(this.minX,e.x),n=Math.min(this.minY,e.y),s=Math.max(this.maxX,e.w+e.x),o=Math.max(this.maxY,e.h+e.y);return this.x=t,this.y=n,this.width=s-t,this.height=o-n,this}static From(e){return new Jr(e.x,e.y,e.w,e.h)}static FromCenter(e,t){return new Jr(e.x-t.x/2,e.y-t.y/2,t.x,t.y)}static FromPoints(e){if(e.length===0)return new Jr;let t=1/0,n=1/0,s=-1/0,o=-1/0,i;for(let a=0,l=e.length;a<l;a++)i=e[a],t=Math.min(i.x,t),n=Math.min(i.y,n),s=Math.max(i.x,s),o=Math.max(i.y,o);return new Jr(t,n,s-t,o-n)}static Expand(e,t){const n=Math.min(t.minX,e.minX),s=Math.min(t.minY,e.minY),o=Math.max(t.maxX,e.maxX),i=Math.max(t.maxY,e.maxY);return new Jr(n,s,o-n,i-s)}static ExpandBy(e,t){return new Jr(e.minX-t,e.minY-t,e.width+t*2,e.height+t*2)}static Collides(e,t){return!(e.maxX<t.minX||e.minX>t.maxX||e.maxY<t.minY||e.minY>t.maxY)}static Contains(e,t){return e.minX<t.minX&&e.minY<t.minY&&e.maxY>t.maxY&&e.maxX>t.maxX}static Includes(e,t){return Jr.Collides(e,t)||Jr.Contains(e,t)}static ContainsPoint(e,t,n=0){return!(t.x<e.minX-n||t.y<e.minY-n||t.x>e.maxX+n||t.y>e.maxY+n)}static Common(e){let t=1/0,n=1/0,s=-1/0,o=-1/0;for(let i=0;i<e.length;i++){const a=e[i];t=Math.min(t,a.minX),n=Math.min(n,a.minY),s=Math.max(s,a.maxX),o=Math.max(o,a.maxY)}return new Jr(t,n,s-t,o-n)}static Sides(e,t=0){const{corners:n}=e;return[[n[0],n[1]],[n[1],n[2]],[n[2],n[3]],[n[3],n[0]]]}static Resize(e,t,n,s,o=!1){const{minX:i,minY:a,maxX:l,maxY:c}=e;let{minX:u,minY:p,maxX:f,maxY:m}=e;switch(t){case"left":case"top_left":case"bottom_left":{u+=n;break}case"right":case"top_right":case"bottom_right":{f+=n;break}}switch(t){case"top":case"top_left":case"top_right":{p+=s;break}case"bottom":case"bottom_left":case"bottom_right":{m+=s;break}}const v=(f-u)/(l-i),b=(m-p)/(c-a),S=v<0,C=b<0;if(o){const T=(l-i)/(c-a),w=Math.abs(f-u),M=Math.abs(m-p),R=w*(b<0?1:-1)*(1/T),D=M*(v<0?1:-1)*T,N=T<w/M;switch(t){case"top_left":{N?p=m+R:u=f+D;break}case"top_right":{N?p=m+R:f=u-D;break}case"bottom_right":{N?m=p-R:f=u-D;break}case"bottom_left":{N?m=p-R:u=f+D;break}case"bottom":case"top":{const z=(u+f)/2,L=M*T;u=z-L/2,f=z+L/2;break}case"left":case"right":{const z=(p+m)/2,L=w/T;p=z-L/2,m=z+L/2;break}}}if(S){const T=f;f=u,u=T}if(C){const T=m;m=p,p=T}const E=new Jr(u,p,Math.abs(f-u),Math.abs(m-p));return{box:E,scaleX:+(E.width/e.width*(v>0?1:-1)).toFixed(5),scaleY:+(E.height/e.height*(b>0?1:-1)).toFixed(5)}}equals(e){return Jr.Equals(this,e)}static Equals(e,t){return t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new Jr(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}};function Hq(r){switch(r){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return r}}function Gq(r){switch(r){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return r}}function Wq(r){return r==="top_left"||r==="top_right"||r==="bottom_right"||r==="bottom_left"}class Ne{constructor(e,t,n,s,o,i){k(this,"a",1);k(this,"b",0);k(this,"c",0);k(this,"d",1);k(this,"e",0);k(this,"f",0);this.a=e,this.b=t,this.c=n,this.d=s,this.e=o,this.f=i}equals(e){return this===e||this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){const t=e,{a:n,b:s,c:o,d:i,e:a,f:l}=this;return this.a=n*t.a+o*t.b,this.c=n*t.c+o*t.d,this.e=n*t.e+o*t.f+a,this.b=s*t.a+i*t.b,this.d=s*t.c+i*t.d,this.f=s*t.e+i*t.f+l,this}rotate(e,t,n){return e===0?this:t===void 0?this.multiply(Ne.Rotate(e)):this.translate(t,n).multiply(Ne.Rotate(e)).translate(-t,-n)}translate(e,t){return this.multiply(Ne.Translate(e,t))}scale(e,t){return this.multiply(Ne.Scale(e,t))}invert(){const{a:e,b:t,c:n,d:s,e:o,f:i}=this,a=e*s-t*n;return this.a=s/a,this.b=t/-a,this.c=n/-a,this.d=e/a,this.e=(s*o-n*i)/-a,this.f=(t*o-e*i)/a,this}applyToPoint(e){return Ne.applyToPoint(this,e)}applyToPoints(e){return Ne.applyToPoints(this,e)}rotation(){return Ne.Rotation(this)}point(){return Ne.Point(this)}decomposed(){return Ne.Decompose(this)}toCssString(){return Ne.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return Ne.Decompose(this)}clone(){return new Ne(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new Ne(1,0,0,1,0,0)}static Translate(e,t){return new Ne(1,0,0,1,e,t)}static Rotate(e,t,n){if(e===0)return Ne.Identity();const s=Math.cos(e),o=Math.sin(e),i=new Ne(s,o,-o,s,0,0);return t===void 0?i:Ne.Compose(Ne.Translate(t,n),i,Ne.Translate(-t,-n))}static Scale(e,t,n,s){const o=new Ne(e,0,0,t,0,0);return n===void 0?o:Ne.Compose(Ne.Translate(n,s),o,Ne.Translate(-n,-s))}static Multiply(e,t){return{a:e.a*t.a+e.c*t.b,c:e.a*t.c+e.c*t.d,e:e.a*t.e+e.c*t.f+e.e,b:e.b*t.a+e.d*t.b,d:e.b*t.c+e.d*t.d,f:e.b*t.e+e.d*t.f+e.f}}static Inverse(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/-t,f:(e.b*e.e-e.a*e.f)/t}}static Absolute(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/t,f:(e.b*e.e-e.a*e.f)/-t}}static Compose(...e){const t=Ne.Identity();for(let n=0,s=e.length;n<s;n++)t.multiply(e[n]);return t}static Point(e){return new P(e.e,e.f)}static Rotation(e){let t;if(e.a!==0||e.c!==0){const n=(e.a*e.a+e.c*e.c)**.5;t=Math.acos(e.a/n)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const n=(e.b*e.b+e.d*e.d)**.5;t=Bn+Math.acos(e.b/n)*(e.d>0?-1:1)}else t=0;return vE(t)}static Decompose(e){let t,n,s;if(e.a!==0||e.c!==0){const o=(e.a*e.a+e.c*e.c)**.5;t=o,n=(e.a*e.d-e.b*e.c)/o,s=Math.acos(e.a/o)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const o=(e.b*e.b+e.d*e.d)**.5;t=(e.a*e.d-e.b*e.c)/o,n=o,s=Bn+Math.acos(e.b/o)*(e.d>0?-1:1)}else t=0,n=0,s=0;return{x:e.e,y:e.f,scaleX:t,scaleY:n,rotation:vE(s)}}static Smooth(e,t=1e10){return e.a=Math.round(e.a*t)/t,e.b=Math.round(e.b*t)/t,e.c=Math.round(e.c*t)/t,e.d=Math.round(e.d*t)/t,e.e=Math.round(e.e*t)/t,e.f=Math.round(e.f*t)/t,e}static toCssString(e){return`matrix(${fe(e.a)}, ${fe(e.b)}, ${fe(e.c)}, ${fe(e.d)}, ${fe(e.e)}, ${fe(e.f)})`}static applyToPoint(e,t){return new P(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z)}static applyToXY(e,t,n){return[e.a*t+e.c*n+e.e,e.b*t+e.d*n+e.f]}static applyToPoints(e,t){return t.map(n=>new P(e.a*n.x+e.c*n.y+e.e,e.b*n.x+e.d*n.y+e.f,n.z))}static applyToBounds(e,t){return new Ve(e.e+t.minX,e.f+t.minY,t.width,t.height)}static From(e){return new Ne(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof Ne?e:Ne.From(e)}}class gd{constructor(e){k(this,"isFilled",!1);k(this,"isClosed",!0);k(this,"isLabel",!1);k(this,"debugColor");k(this,"ignore");k(this,"_vertices");k(this,"_bounds");k(this,"_area");k(this,"_length");this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.isLabel=e.isLabel??!1,this.debugColor=e.debugColor,this.ignore=e.ignore}hitTestPoint(e,t=0,n=!1){return this.isClosed&&(this.isFilled||n)&&ai(e,this.vertices)?!0:P.Dist2(e,this.nearestPoint(e))<=t*t}distanceToPoint(e,t=!1){return e.dist(this.nearestPoint(e))*(this.isClosed&&(this.isFilled||t)&&ai(e,this.vertices)?-1:1)}distanceToLineSegment(e,t){if(e.equals(t))return this.distanceToPoint(e);const{vertices:n}=this;let s,o=1/0,i,a,l;for(let c=0;c<n.length;c++)a=n[c],l=P.NearestPointOnLineSegment(e,t,a,!0),i=P.Dist2(a,l),i<o&&(o=i,s=l);if(!s)throw Error("nearest point not found");return this.isClosed&&this.isFilled&&ai(s,this.vertices)?-o:o}hitTestLineSegment(e,t,n=0){return this.distanceToLineSegment(e,t)<=n}nearestPointOnLineSegment(e,t){const{vertices:n}=this;let s,o=1/0,i,a,l;for(let c=0;c<n.length;c++)a=n[c],l=P.NearestPointOnLineSegment(e,t,a,!0),i=P.Dist2(a,l),i<o&&(o=i,s=l);if(!s)throw Error("nearest point not found");return s}isPointInBounds(e,t=0){const{bounds:n}=this;return!(e.x<n.minX-t||e.y<n.minY-t||e.x>n.maxX+t||e.y>n.maxY+t)}get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return Ve.FromPoints(this.vertices)}get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get center(){return this.bounds.center}get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:e}=this;let t=0;for(let n=0,s=e.length;n<s;n++){const o=e[n],i=e[(n+1)%s];t+=o.x*i.y-i.x*o.y}return t/2}toSimpleSvgPath(){let e="";const{vertices:t}=this,n=t.length;if(n===0)return e;e+=`M${t[0].x},${t[0].y}`;for(let s=1;s<n;s++)e+=`L${t[s].x},${t[s].y}`;return this.isClosed&&(e+="Z"),e}get length(){return this._length?this._length:(this._length=this.getLength(),this._length)}getLength(){const{vertices:e}=this;let t,n=e[0],s=0;for(let o=1;o<e.length;o++)t=e[o],s+=P.Dist2(n,t),n=t;return Math.sqrt(s)}}class Fi extends gd{constructor(t){super({...t,isClosed:!0,isFilled:!1});k(this,"children",[]);k(this,"ignoredChildren",[]);for(const n of t.children)n.ignore?this.ignoredChildren.push(n):this.children.push(n);if(this.children.length===0)throw Error("Group2d must have at least one child")}getVertices(){return this.children.filter(t=>!t.isLabel).flatMap(t=>t.vertices)}nearestPoint(t){let n=1/0,s;const{children:o}=this;if(o.length===0)throw Error("no children");let i,a;for(const l of o)i=l.nearestPoint(t),a=P.Dist2(i,t),a<n&&(n=a,s=i);if(!s)throw Error("nearest point not found");return s}distanceToPoint(t,n=!1){return Math.min(...this.children.map((s,o)=>s.distanceToPoint(t,n||o>0)))}hitTestPoint(t,n,s){return!!this.children.filter(o=>!o.isLabel).find(o=>o.hitTestPoint(t,n,s))}hitTestLineSegment(t,n,s){return!!this.children.filter(o=>!o.isLabel).find(o=>o.hitTestLineSegment(t,n,s))}getArea(){return this.children[0].area}toSimpleSvgPath(){let t="";for(const s of this.children)t+=s.toSimpleSvgPath();const n=Ve.FromPoints(this.vertices).corners;for(let s=0,o=n.length;s<o;s++){const i=n[s],a=n[(s-1+o)%o],l=i.dist(a),c=n[(s+1)%o],u=i.dist(c),p=i.clone().lrp(a,4/l),f=i,m=i.clone().lrp(c,4/u);t+=`M${p.x},${p.y} L${f.x},${f.y} L${m.x},${m.y} `}return t}getLength(){return this.children.reduce((t,n)=>n.isLabel?t:t+n.length,0)}getSvgPathData(){return this.children.map((t,n)=>t.isLabel?"":t.getSvgPathData(n===0)).join(" ")}}function Kq(r=!0){const[e,t]=I.useState(0),n=ue();I.useEffect(()=>{if(!r)return;const s=()=>t(o=>o+1);return n.on("tick",s),()=>{n.off("tick",s)}},[n,r])}const Vq=Ss(function({showStroke:e=!0,showVertices:t=!0,showClosestPointOnOutline:n=!0}){const s=ue();Kq(n);const o=s.getZoomLevel(),i=s.getRenderingShapes(),{inputs:{currentPagePoint:a}}=s;return g.jsx("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:i.map(l=>{const c=s.getShape(l.id);if(c.type==="group")return null;const u=s.getShapeGeometry(c),p=s.getShapePageTransform(c),f=s.getPointInShapeSpace(c,a),m=u.nearestPoint(f),v=u.distanceToPoint(f,!0),b=Math.abs(v)*o,S=v<0,{vertices:C}=u;return g.jsxs("g",{transform:p.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[e&&g.jsx("g",{stroke:u.debugColor??"red",opacity:"1",strokeWidth:2/o,fill:"none",children:g.jsx(V5,{geometry:u})}),t&&C.map((E,T)=>g.jsx("circle",{cx:E.x,cy:E.y,r:2/o,fill:`hsl(${Bh(T,[0,C.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:1/o},`v${T}`)),n&&b<150&&g.jsx("line",{x1:m.x,y1:m.y,x2:f.x,y2:f.y,opacity:1-b/150,stroke:S?"goldenrod":"dodgerblue",strokeWidth:2/o})]},l.id+"_outline")})})});function V5({geometry:r}){return r instanceof Fi?g.jsx(g.Fragment,{children:[...r.children,...r.ignoredChildren].map((e,t)=>g.jsx(V5,{geometry:e},t))}):g.jsx("path",{d:r.toSimpleSvgPath()})}function q5(r){return SH(r)}function Y5(){const r=ue(),e=MW("userIds",()=>q5(r.getCollaborators().map(t=>t.userId)).sort(),{isEqual:(t,n)=>{var s;return t.join(",")===((s=n.join)==null?void 0:s.call(n,","))}},[r]);return ye(e)}function eb(r){const e=ue();return ye(`latestPresence:${r}`,()=>e.getCollaborators().find(n=>n.userId===r),[e,r])??null}const qq=Ss(function(){return Y5().map(t=>g.jsx(Yq,{collaboratorId:t},t))}),Yq=Ss(function({collaboratorId:e}){const t=ue(),n=eb(e),s=Zq(t,n);if(!(n&&n.currentPageId===t.getCurrentPageId()))return null;switch(s){case"inactive":{const{followingUserId:o,highlightedUserIds:i}=t.getInstanceState();if(!(o===n.userId||i.includes(n.userId)))return null;break}case"idle":{const{highlightedUserIds:o}=t.getInstanceState();if(n.followingUserId===t.user.getId()&&!(n.chatMessage||o.includes(n.userId)))return null;break}}return g.jsx(Xq,{latestPresence:n})}),Xq=Ss(function({latestPresence:e}){const t=ue(),{CollaboratorBrush:n,CollaboratorScribble:s,CollaboratorCursor:o,CollaboratorHint:i,CollaboratorShapeIndicator:a}=Vn(),l=t.getZoomLevel(),c=t.getViewportPageBounds(),{userId:u,chatMessage:p,brush:f,scribbles:m,selectedShapeIds:v,userName:b,cursor:S,color:C}=e;if(!S)return null;const E=!(S.x<c.minX-12/l||S.y<c.minY-16/l||S.x>c.maxX-12/l||S.y>c.maxY-16/l);return g.jsxs(g.Fragment,{children:[f&&n?g.jsx(n,{className:"tl-collaborator__brush",brush:f,color:C,opacity:.1},u+"_brush"):null,E&&o?g.jsx(o,{className:"tl-collaborator__cursor",point:S,color:C,zoom:l,name:b!=="New User"?b:null,chatMessage:p??""},u+"_cursor"):i?g.jsx(i,{className:"tl-collaborator__cursor-hint",point:S,color:C,zoom:l,viewport:c},u+"_cursor_hint"):null,s&&m.length?g.jsx(g.Fragment,{children:m.map(T=>g.jsx(s,{className:"tl-collaborator__scribble",scribble:T,color:C,zoom:l,opacity:T.color==="laser"?.5:.1},u+"_scribble_"+T.id))}):null,a&&v.filter(T=>!t.isShapeHidden(T)).map(T=>g.jsx(a,{className:"tl-collaborator__shape-indicator",shapeId:T,color:C,opacity:.5},u+"_"+T))]})});function cR(r,e){return e>r.options.collaboratorInactiveTimeoutMs?"inactive":e>r.options.collaboratorIdleTimeoutMs?"idle":"active"}function Zq(r,e){const t=I.useRef((e==null?void 0:e.lastActivityTimestamp)??-1),[n,s]=I.useState(()=>cR(r,Date.now()-t.current));return I.useEffect(()=>{const o=r.timers.setInterval(()=>{s(cR(r,Date.now()-t.current))},r.options.collaboratorCheckIntervalMs);return()=>clearInterval(o)},[r]),e&&(t.current=e.lastActivityTimestamp??1/0),n}function Jq(){const r=ue(),e=ye("is menu open",()=>r.menus.hasAnyOpenMenus(),[r]),[t,n]=I.useState(!1),s=e||t,o=w2(),i=I.useRef({isDown:!1,isDragging:!1,start:new P}),a=I.useCallback(u=>{u.button===0&&(n(!0),i.current={isDown:!0,isDragging:!1,start:new P(u.clientX,u.clientY)}),r.menus.clearOpenMenus()},[r]),l=I.useCallback(u=>{var p,f,m;if(i.current.isDown){if(i.current.isDragging){(p=o.onPointerMove)==null||p.call(o,u);return}if(P.Dist2(i.current.start,new P(u.clientX,u.clientY))>r.options.dragDistanceSquared){i.current={...i.current,isDown:!0,isDragging:!0};const{x:v,y:b}=i.current.start;(f=o.onPointerDown)==null||f.call(o,{...u,clientX:v,clientY:b,button:0}),(m=o.onPointerMove)==null||m.call(o,u)}}},[o,r]),c=I.useCallback(u=>{var p;(p=o.onPointerUp)==null||p.call(o,u),n(!1),i.current={isDown:!1,isDragging:!1,start:new P(u.clientX,u.clientY)}},[o]);return s&&g.jsx("div",{className:"tlui-menu-click-capture","data-testid":"menu-click-capture.content",...o,onPointerDown:a,onPointerMove:l,onPointerUp:c})}const X5=I.memo(function({id:e,shape:t,util:n,index:s,backgroundIndex:o,opacity:i}){const a=ue(),{ShapeErrorFallback:l}=Vn(),c=I.useRef(null),u=I.useRef(null),p=I.useRef({transform:"",clipPath:"none",width:0,height:0,x:0,y:0,isCulled:!1});Zc("set shape stuff",()=>{const v=a.getShape(e);if(!v)return;const b=p.current,S=a.getShapeClipPath(e)??"none";S!==b.clipPath&&(js(c.current,"clip-path",S),js(u.current,"clip-path",S),b.clipPath=S);const C=a.getShapePageTransform(e),E=Ne.toCssString(C),T=a.getShapeGeometry(v).bounds;E!==b.transform&&(js(c.current,"transform",E),js(u.current,"transform",E),b.transform=E);const w=Math.max(T.width,1),M=Math.max(T.height,1);(w!==b.width||M!==b.height)&&(js(c.current,"width",w+"px"),js(c.current,"height",M+"px"),js(u.current,"width",w+"px"),js(u.current,"height",M+"px"),b.width=w,b.height=M)},[a]),Zc("set opacity and z-index",()=>{const v=c.current,b=u.current;js(v,"opacity",i),js(b,"opacity",i),js(v,"z-index",s),js(b,"z-index",o)},[i,s,o]),Zc("set display",()=>{if(!a.getShape(e))return;const S=a.getCulledShapes().has(e);S!==p.current.isCulled&&(js(c.current,"display",S?"none":"block"),js(u.current,"display",S?"none":"block"),p.current.isCulled=S)},[a]);const f=I.useCallback(v=>a.annotateError(v,{origin:"shape",willCrashApp:!1}),[a]);if(!t)return null;const m="fill"in t.props&&t.props.fill!=="none";return g.jsxs(g.Fragment,{children:[n.backgroundComponent&&g.jsx("div",{ref:u,className:"tl-shape tl-shape-background","data-shape-type":t.type,"data-shape-id":t.id,draggable:!1,children:g.jsx(Hf,{fallback:l,onError:f,children:g.jsx(J5,{shape:t,util:n})})}),g.jsx("div",{ref:c,className:"tl-shape","data-shape-type":t.type,"data-shape-is-filled":m,"data-shape-id":t.id,draggable:!1,children:g.jsx(Hf,{fallback:l,onError:f,children:g.jsx(Z5,{shape:t,util:n})})})]})}),Z5=I.memo(function({shape:e,util:t}){return V0("InnerShape:"+e.type,()=>t.component(t.editor.store.unsafeGetWithoutCapture(e.id)),[t,e.id])},(r,e)=>r.shape.props===e.shape.props&&r.shape.meta===e.shape.meta&&r.util===e.util),J5=I.memo(function({shape:e,util:t}){return V0("InnerShape:"+e.type,()=>{var n;return(n=t.backgroundComponent)==null?void 0:n.call(t,t.editor.store.unsafeGetWithoutCapture(e.id))},[t,e.id])},(r,e)=>r.shape.props===e.shape.props&&r.shape.meta===e.shape.meta&&r.util===e.util);function Qq({className:r}){const e=ue(),{Background:t,SvgDefs:n,ShapeIndicators:s}=Vn(),o=I.useRef(null),i=I.useRef(null),a=I.useRef(null),l=Kr();Bq(o),RV(),jV(),zq(o),LV(o);const c=I.useRef({lodDisableTextOutline:!1,allowTextOutline:!0});Zc("position layers",function(){const{x:E,y:T,z:w}=e.getCamera();if(c.current.allowTextOutline&&Rn.isSafari&&(l.style.setProperty("--tl-text-outline","none"),c.current.allowTextOutline=!1),c.current.allowTextOutline&&w<e.options.textShadowLod!==c.current.lodDisableTextOutline){const D=w<e.options.textShadowLod;l.style.setProperty("--tl-text-outline",D?"none":"var(--tl-text-outline-reference)"),c.current.lodDisableTextOutline=D}const M=w>=1?Bh(w,[1,8],[.125,.5],!0):Bh(w,[.1,1],[-2,.125],!0),R=`scale(${fe(w)}) translate(${fe(E+M)}px,${fe(T+M)}px)`;js(i.current,"transform",R),js(a.current,"transform",R)},[e,l]);const u=w2(),p=ye("shapeSvgDefs",()=>{const C=new Map;for(const E of ir(e.shapeUtils)){if(!E)return;const T=E.getCanvasSvgDefs();for(const{key:w,component:M}of T)C.has(w)||C.set(w,g.jsx(M,{},w))}return[...C.values()]},[e]),f=ye("debug_shapes",()=>_r.hideShapes.get(),[_r]),m=ye("debug_svg",()=>_r.debugSvg.get(),[_r]),v=ye("debug_geometry",()=>_r.debugGeometry.get(),[_r]),b=ye("isEditingAnything",()=>e.getEditingShapeId()!==null,[e]),S=ye("isSelectingAnything",()=>!!e.getSelectedShapeIds().length,[e]);return g.jsxs(g.Fragment,{children:[g.jsxs("div",{ref:o,draggable:!1,"data-iseditinganything":b,"data-isselectinganything":S,className:it("tl-canvas",r),"data-testid":"canvas",...u,children:[g.jsx("svg",{className:"tl-svg-context",children:g.jsxs("defs",{children:[p,g.jsx(pY,{}),g.jsx(fY,{}),n&&g.jsx(n,{})]})}),t&&g.jsx("div",{className:"tl-background__wrapper",children:g.jsx(t,{})}),g.jsx(tY,{}),g.jsxs("div",{ref:i,className:"tl-html-layer tl-shapes",draggable:!1,children:[g.jsx(vY,{}),g.jsx(yY,{}),f?null:m?g.jsx(cY,{}):g.jsx(uY,{})]}),g.jsx("div",{className:"tl-overlays",children:g.jsxs("div",{ref:a,className:"tl-html-layer",children:[v?g.jsx(Vq,{}):null,g.jsx(iY,{}),g.jsx(rY,{}),g.jsx(nY,{}),g.jsx(sY,{}),s&&g.jsx(s,{}),g.jsx(hY,{}),g.jsx(oY,{}),g.jsx(mY,{}),g.jsx(qq,{})]})}),g.jsx(bY,{})]}),g.jsx(Jq,{}),g.jsx(eY,{})]})}function eY(){const{InFrontOfTheCanvas:r}=Vn();return r?g.jsx(r,{}):null}function tY(){const r=ue(),e=ye("gridSize",()=>r.getDocumentSettings().gridSize,[r]),{x:t,y:n,z:s}=ye("camera",()=>r.getCamera(),[r]),o=ye("isGridMode",()=>r.getInstanceState().isGridMode,[r]),{Grid:i}=Vn();return i&&o?g.jsx(i,{x:t,y:n,z:s,size:e}):null}function nY(){const r=ue(),e=ye("scribbles",()=>r.getInstanceState().scribbles,[r]),t=ye("zoomLevel",()=>r.getZoomLevel(),[r]),{Scribble:n}=Vn();return n&&e.length?e.map(s=>g.jsx(n,{className:"tl-user-scribble",scribble:s,zoom:t},s.id)):null}function rY(){const r=ue(),e=ye("brush",()=>r.getInstanceState().brush,[r]),{Brush:t}=Vn();return t&&e?g.jsx(t,{className:"tl-user-brush",brush:e}):null}function sY(){const r=ue(),e=ye("zoomBrush",()=>r.getInstanceState().zoomBrush,[r]),{ZoomBrush:t}=Vn();return t&&e?g.jsx(t,{className:"tl-user-brush tl-zoom-brush",brush:e}):null}function oY(){const r=ue(),e=ye("snapLines",()=>r.snaps.getIndicators(),[r]),t=ye("zoomLevel",()=>r.getZoomLevel(),[r]),{SnapIndicator:n}=Vn();return n&&e.length>0?e.map(s=>g.jsx(n,{className:"tl-user-snapline",line:s,zoom:t},s.id)):null}function iY(){const r=ue(),e=ye("handles shapeIdWithHandles",()=>{const{isReadonly:t,isChangingStyle:n}=r.getInstanceState();if(t||n)return!1;const s=r.getOnlySelectedShape();return!s||!r.getShapeHandles(s)?!1:s.id},[r]);return e?g.jsx(aY,{shapeId:e}):null}function aY({shapeId:r}){const e=ue(),{Handles:t}=Vn(),n=ye("zoomLevel",()=>e.getZoomLevel(),[e]),s=ye("coarse pointer",()=>e.getInstanceState().isCoarsePointer,[e]),o=ye("handles transform",()=>e.getShapePageTransform(r),[e,r]),i=ye("handles",()=>{const l=e.getShapeHandles(r);if(!l)return null;const c=(s?e.options.coarseHandleRadius:e.options.handleRadius)/n*2;return l.filter(u=>u.type!=="virtual"||!l.some(p=>p!==u&&p.type==="vertex"&&P.Dist(u,p)<c)).sort(u=>u.type==="vertex"?1:-1)},[e,n,s,r]),a=ye("isHidden",()=>e.isShapeHidden(r),[e,r]);return!t||!i||!o||a?null:g.jsx(t,{children:g.jsx("g",{transform:Ne.toCssString(o),children:i.map(l=>g.jsx(lY,{shapeId:r,handle:l,zoom:n,isCoarse:s},l.id))})})}function lY({shapeId:r,handle:e,zoom:t,isCoarse:n}){const s=$q(r,e.id),{Handle:o}=Vn();return o?g.jsx("g",{"aria-label":"handle",transform:`translate(${e.x}, ${e.y})`,...s,children:g.jsx(o,{shapeId:r,handle:e,zoom:t,isCoarse:n})}):null}function cY(){const r=ue();return ye("rendering shapes",()=>r.getRenderingShapes(),[r]).map(t=>g.jsxs(I.Fragment,{children:[g.jsx(X5,{...t}),g.jsx(gY,{id:t.id,mode:"iframe"})]},t.id+"_fragment"))}function dY(){const r=ue(),e=I.useRef(new Set);return Zc("reflow for culled shapes",()=>{const t=r.getCulledShapes();if(e.current.size===t.size&&[...t].every(s=>e.current.has(s)))return;e.current=t;const n=document.getElementsByClassName("tl-canvas");n.length!==0&&n[0].offsetHeight},[r]),null}function uY(){const r=ue(),e=ye("rendering shapes",()=>r.getRenderingShapes(),[r]);return g.jsxs(g.Fragment,{children:[e.map(t=>g.jsx(X5,{...t},t.id+"_shape")),Rn.isSafari&&g.jsx(dY,{})]})}function hY(){const r=ue(),{ShapeIndicator:e}=Vn(),t=ye("hinting shape ids",()=>Dk(r.getHintingShapeIds()),[r]);return!t.length||!e?null:t.map(n=>g.jsx(e,{className:"tl-user-indicator__hint",shapeId:n},n+"_hinting"))}function pY(){return g.jsxs("g",{id:ha("cursor"),children:[g.jsxs("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[g.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),g.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),g.jsxs("g",{fill:"white",transform:"translate(-12,-12)",children:[g.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),g.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),g.jsxs("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[g.jsx("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),g.jsx("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function fY(){const r=ha("cursor_hint");return g.jsx("path",{id:r,fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function gY({id:r,mode:e}){const t=ue(),[n,s]=I.useState(null),o=ye("is in root",()=>{const i=t.getShape(r);return(i==null?void 0:i.parentId)===t.getCurrentPageId()},[t,r]);return I.useEffect(()=>{if(!o)return;let i=null;const a=nl("shape to svg",async()=>{const l=Math.random();i=l;const u=t.isShapeOfType(r,"frame")?0:10;let p=t.getShapePageBounds(r);if(!p)return;p=p.clone().expandBy(u);const f=await t.getSvgString([r],{padding:u,background:t.getInstanceState().exportBackground});if(i!==l||!f)return;const m=`data:image/svg+xml;utf8,${encodeURIComponent(f.svg)}`;s({src:m,bounds:p})});return()=>{i=null,a()}},[t,r,o]),!o||!n?null:e==="iframe"?g.jsx("iframe",{src:n.src,width:n.bounds.width,height:n.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,border:"none",transform:`translate(${n.bounds.x}px, ${n.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}}):g.jsx("img",{src:n.src,width:n.bounds.width,height:n.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,transform:`translate(${n.bounds.x}px, ${n.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}})}function mY(){const r=ue(),e=ye("selection rotation",()=>r.getSelectionRotation(),[r]),t=ye("selection bounds",()=>r.getSelectionRotatedPageBounds(),[r]),{SelectionForeground:n}=Vn();return!t||!n?null:g.jsx(n,{bounds:t,rotation:e})}function yY(){const r=ue(),e=ye("selection rotation",()=>r.getSelectionRotation(),[r]),t=ye("selection bounds",()=>r.getSelectionRotatedPageBounds(),[r]),{SelectionBackground:n}=Vn();return!t||!n?null:g.jsx(n,{bounds:t,rotation:e})}function vY(){const{OnTheCanvas:r}=Vn();return r?g.jsx(r,{}):null}function bY(){const r=ue(),e=ye("camera state",()=>r.getCameraState(),[r]);return g.jsx("div",{className:it("tl-hit-test-blocker",{"tl-hit-test-blocker__hidden":e==="idle"})})}function SY({className:r,zoom:e,point:t,color:n,viewport:s,opacity:o=1}){const i=I.useRef(null);op(i,ps(t.x,s.minX+5/e,s.maxX-5/e),ps(t.y,s.minY+5/e,s.maxY-5/e),1/e,P.Angle(s.center,t));const a=ha("cursor_hint");return g.jsxs("svg",{ref:i,className:it("tl-overlays__item",r),children:[g.jsx("use",{href:`#${a}`,color:n,strokeWidth:3,stroke:"var(--color-background)"}),g.jsx("use",{href:`#${a}`,color:n,opacity:o})]})}const dR=I.memo(function({className:e,zoom:t,point:n,color:s,name:o,chatMessage:i}){const a=I.useRef(null);op(a,n==null?void 0:n.x,n==null?void 0:n.y,1/t);const l=ha("cursor");return n?g.jsxs("div",{ref:a,className:it("tl-overlays__item",e),children:[g.jsx("svg",{className:"tl-cursor",children:g.jsx("use",{href:`#${l}`,color:s})}),i?g.jsxs(g.Fragment,{children:[o&&g.jsx("div",{className:"tl-nametag-title",style:{color:s},children:o}),g.jsx("div",{className:"tl-nametag-chat",style:{backgroundColor:s},children:i})]}):o&&g.jsx("div",{className:"tl-nametag",style:{backgroundColor:s},children:o})]}):null});function xY({x:r,y:e,z:t,size:n}){const s=sp("grid"),o=ue(),{gridSteps:i}=o.options;return g.jsxs("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[g.jsx("defs",{children:i.map(({min:a,mid:l,step:c},u)=>{const p=c*n*t,f=.5+r*t,m=.5+e*t,v=f>0?f%p:p+f%p,b=m>0?m%p:p+m%p,S=t<l?Bh(t,[a,l],[0,1]):1;return g.jsx("pattern",{id:y2(s,`${c}`),width:p,height:p,patternUnits:"userSpaceOnUse",children:g.jsx("circle",{className:"tl-grid-dot",cx:v,cy:b,r:1,opacity:S})},u)})}),i.map(({step:a},l)=>g.jsx("rect",{width:"100%",height:"100%",fill:`url(#${s}_${a})`},l))]})}function wY({handle:r,isCoarse:e,className:t,zoom:n}){const s=ue(),o=(e?s.options.coarseHandleRadius:s.options.handleRadius)/n;if(r.type==="clone"){const a=3/n,l=`M0,${-a} A${a},${a} 0 0,1 0,${a}`,c=PV.indexOf(r.id);return g.jsxs("g",{className:it(`tl-handle tl-handle__${r.type}`,t),children:[g.jsx("circle",{className:"tl-handle__bg",r:o}),g.jsx("path",{className:"tl-handle__fg",d:l,transform:`rotate(${-90+90*c})`})]})}const i=(r.type==="create"&&e?3:4)/Math.max(n,.25);return g.jsxs("g",{className:it(`tl-handle tl-handle__${r.type}`,t),children:[g.jsx("circle",{className:"tl-handle__bg",r:o}),g.jsx("circle",{className:"tl-handle__fg",r:i})]})}const CY=({children:r})=>g.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:r}),EY=()=>{const{Spinner:r}=Vn();return g.jsx($2,{children:r?g.jsx(r,{}):null})};function E2(r,e=!0){const t=r.length;if(t<2)return"";let n=r[0],s=r[1];if(t===2)return`M${ln(n)}L${ln(s)}`;let o="";for(let i=2,a=t-1;i<a;i++)n=r[i],s=r[i+1],o+=No(n,s);return e?`M${No(r[0],r[1])}Q${ln(r[1])}${No(r[1],r[2])}T${o}${No(r[t-1],r[0])}${No(r[0],r[1])}Z`:`M${ln(r[0])}Q${ln(r[1])}${No(r[1],r[2])}${r.length>3?"T":""}${o}L${ln(r[t-1])}`}function uR({scribble:r,zoom:e,color:t,opacity:n,className:s}){return r.points.length?g.jsx("svg",{className:s&&it("tl-overlays__item",s),children:g.jsx("path",{className:"tl-scribble",d:E2(r.points,!1),stroke:t??`var(--color-${r.color})`,fill:"none",strokeWidth:8/e,opacity:n??r.opacity})}):null}function Q5({bounds:r,rotation:e}){const t=I.useRef(null);return op(t,r.x,r.y,1,e),I.useLayoutEffect(()=>{const n=t.current;n&&(n.style.width=fe(Math.max(1,r.width))+"px",n.style.height=fe(Math.max(1,r.height))+"px")},[r.width,r.height]),g.jsx("div",{ref:t,className:"tl-selection__bg",draggable:!1})}function kY({bounds:r,rotation:e}){const t=ue(),n=I.useRef(null),s=ye("only selected shape",()=>t.getOnlySelectedShape(),[t]),o=s?t.getShapeUtil(s).expandSelectionOutlinePx(s):0;return op(n,r==null?void 0:r.x,r==null?void 0:r.y,1,e,{x:-o,y:-o}),r=o instanceof Ve?r.clone().expand(o).zeroFix():r.clone().expandBy(o).zeroFix(),g.jsx("svg",{ref:n,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:g.jsx("rect",{className:it("tl-selection__fg__outline"),width:fe(r.width),height:fe(r.height)})})}const PY=()=>g.jsx("div",{className:"tl-shape-error-boundary"}),IY=({shape:r,util:e})=>V0("Indicator: "+r.type,()=>e.indicator(e.editor.store.unsafeGetWithoutCapture(r.id))),_Y=({editor:r,id:e})=>{const t=ye("shape for indicator",()=>r.store.get(e),[r,e]),{ShapeIndicatorErrorFallback:n}=Vn();return!t||t.isLocked?null:g.jsx(Hf,{fallback:n,onError:s=>r.annotateError(s,{origin:"react.shapeIndicator",willCrashApp:!1}),children:g.jsx(IY,{shape:t,util:r.getShapeUtil(t)},t.id)})},hR=I.memo(function({shapeId:e,className:t,color:n,hidden:s,opacity:o}){const i=ue(),a=I.useRef(null);return Zc("indicator transform",()=>{const l=a.current;if(!l)return;const c=i.getShapePageTransform(e);c&&l.style.setProperty("transform",c.toCssString())},[i,e]),I.useLayoutEffect(()=>{const l=a.current;l&&l.style.setProperty("display",s?"none":"block")},[s]),g.jsx("svg",{ref:a,className:it("tl-overlays__item",t),children:g.jsx("g",{className:"tl-shape-indicator",stroke:n??"var(--color-selected)",opacity:o,children:g.jsx(_Y,{editor:i,id:e})})})}),TY=()=>g.jsx("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"}),eL=I.memo(function(){const e=ue(),t=I.useRef(new Set),n=ye("should display selected ids",()=>{const i=t.current,a=new Set;if(e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!e.getInstanceState().isChangingStyle){const l=e.getSelectedShapeIds();for(const c of l)a.add(c);if(e.isInAny("select.idle","select.editing_shape")){const c=e.getInstanceState();if(c.isHoveringCanvas&&!c.isCoarsePointer){const u=e.getHoveredShapeId();u&&a.add(u)}}}if(i.size!==a.size)return t.current=a,a;for(const l of a)if(!i.has(l))return t.current=a,a;return i},[e]),s=ye("rendering shapes",()=>e.getRenderingShapes(),[e]),{ShapeIndicator:o}=Vn();return o?s.map(({id:i})=>g.jsx(o,{shapeId:i,hidden:!n.has(i)},i+"_indicator")):null});function MY({points:r,zoom:e}){const t=2.5/e,n=r.reduce((f,m)=>Math.min(f,m.x),1/0),s=r.reduce((f,m)=>Math.max(f,m.x),-1/0),o=r.reduce((f,m)=>Math.min(f,m.y),1/0),i=r.reduce((f,m)=>Math.max(f,m.y),-1/0),a=r.some(f=>f.x===n&&f.y===o);let l,c,u,p;return a?(l=n,c=o,u=s,p=i):(l=n,c=i,u=s,p=o),g.jsxs("g",{className:"tl-snap-indicator",stroke:"lime",children:[g.jsx("line",{x1:l,y1:c,x2:u,y2:p}),r.map((f,m)=>g.jsx("g",{transform:`translate(${f.x},${f.y})`,children:g.jsx("path",{className:"tl-snap-point",d:`M ${-t},${-t} L ${t},${t} M ${-t},${t} L ${t},${-t}`})},m))]})}function AY({gaps:r,direction:e,zoom:t}){const n=3.5/t;let s=[-1/0,1/0],o=null;const i=e==="horizontal";for(const l of r){if(o=na(s[0],s[1],i?l.startEdge[0].y:l.startEdge[0].x,i?l.startEdge[1].y:l.startEdge[1].x),o)s=o;else continue;if(o=na(s[0],s[1],i?l.endEdge[0].y:l.endEdge[0].x,i?l.endEdge[1].y:l.endEdge[1].x),o)s=o;else continue}if(s===null)return null;const a=(s[0]+s[1])/2;return g.jsx("g",{className:"tl-snap-indicator",stroke:"cyan",children:r.map(({startEdge:l,endEdge:c},u)=>g.jsx(I.Fragment,{children:i?g.jsxs(g.Fragment,{children:[g.jsx("line",{x1:l[0].x,y1:a-2*n,x2:l[1].x,y2:a+2*n}),g.jsx("line",{x1:c[0].x,y1:a-2*n,x2:c[1].x,y2:a+2*n}),g.jsx("line",{x1:l[0].x,y1:a,x2:c[0].x,y2:a}),g.jsx("line",{x1:(l[0].x+c[0].x)/2,y1:a-n,x2:(l[0].x+c[0].x)/2,y2:a+n})]}):g.jsxs(g.Fragment,{children:[g.jsx("line",{x1:a-2*n,y1:l[0].y,x2:a+2*n,y2:l[1].y}),g.jsx("line",{x1:a-2*n,y1:c[0].y,x2:a+2*n,y2:c[1].y}),g.jsx("line",{x1:a,y1:l[0].y,x2:a,y2:c[0].y}),g.jsx("line",{x1:a-n,y1:(l[0].y+c[0].y)/2,x2:a+n,y2:(l[0].y+c[0].y)/2})]})},u))})}function jY({className:r,line:e,zoom:t}){return g.jsx("svg",{className:it("tl-overlays__item",r),children:e.type==="points"?g.jsx(MY,{...e,zoom:t}):e.type==="gaps"?g.jsx(AY,{...e,zoom:t}):null})}function k2(){return g.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",children:g.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[g.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),g.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:g.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}const RY=()=>null;function tL(r,e){const t=I.useRef(r);return e(r,t.current)?t.current:(t.current=r,r)}const DY=(r,e)=>(r??(r=null),e??(e=null),r===e?!0:!r||!e?!1:AO(r,e));function Bc(r){return tL(r,DY)}const OY=(r,e)=>(r??(r=null),e??(e=null),r===e?!0:!r||!e?!1:OO(r,e));function ip(r){return tL(r,OY)}const nL=I.createContext(null);function LY({overrides:r={},children:e}){const t=ip(r),n=I.useMemo(()=>({Background:bV,SvgDefs:RY,Brush:W1,ZoomBrush:W1,CollaboratorBrush:W1,Cursor:dR,CollaboratorCursor:dR,CollaboratorHint:SY,CollaboratorShapeIndicator:hR,Grid:xY,Scribble:uR,SnapIndicator:jY,Handles:CY,Handle:wY,CollaboratorScribble:uR,ErrorFallback:sL,ShapeErrorFallback:PY,ShapeIndicatorErrorFallback:TY,Spinner:k2,SelectionBackground:Q5,SelectionForeground:kY,ShapeIndicators:eL,ShapeIndicator:hR,OnTheCanvas:null,InFrontOfTheCanvas:null,Canvas:Qq,LoadingScreen:EY,...t}),[t]);return g.jsx(nL.Provider,{value:n,children:e})}function Vn(){const r=I.useContext(nL);if(!r)throw new Error("useEditorComponents must be used inside of <EditorComponentsProvider />");return r}const tb={openWindow(r,e){window.open(r,e,"noopener noreferrer")},refreshPage(){window.location.reload()},async hardReset(){var r;return await((r=window.__tldraw__hardReset)==null?void 0:r.call(window))}};function rL(){tb.hardReset()}function NY(){tb.refreshPage()}const FY="https://github.com/tldraw/tldraw/issues/new",sL=({error:r,editor:e})=>{const t=I.useRef(null),[n,s]=I.useState(!1),[o,i]=I.useState(!1),[a,l]=I.useState(!1);let c=null;try{c=Vn().Canvas??null}catch{}const u=r instanceof Error?r.message:String(r),p=r instanceof Error?r.stack:null,f=ye("isDarkMode",()=>{try{if(e)return e.user.getIsDarkMode()}catch{}return null},[e]),[m,v]=I.useState(null);I.useLayoutEffect(()=>{var M;f!==null&&v(f);let T=(M=t.current)==null?void 0:M.parentElement,w=!1;for(;T;){if(T.classList.contains("tl-theme__dark")||T.classList.contains("tl-theme__light")){w=!0;break}T=T.parentElement}if(w){v(null);return}typeof window<"u"&&"matchMedia"in window&&v(window.matchMedia("(prefers-color-scheme: dark)").matches)},[f]),I.useEffect(()=>{if(o){const T=e==null?void 0:e.timers.setTimeout(()=>{i(!1)},2e3);return()=>clearTimeout(T)}},[o,e]);const b=()=>{const T=document.createElement("textarea");T.value=p??u,document.body.appendChild(T),T.select(),document.execCommand("copy"),T.remove(),i(!0)},S=()=>{NY()},C=async()=>{rL()},E=new URL(FY);return E.searchParams.set("title",u),E.searchParams.set("labels","bug"),E.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${p??u}
\`\`\`

My browser: ${navigator.userAgent}`),g.jsxs("div",{ref:t,className:it("tl-container tl-error-boundary",m===null?"":m?"tl-theme__dark":"tl-theme__light"),children:[g.jsx("div",{className:"tl-error-boundary__overlay"}),e&&g.jsx(m2,{onError:Nf,fallback:()=>null,children:g.jsx(b2,{editor:e,children:g.jsx("div",{className:"tl-overlay tl-error-boundary__canvas",children:c?g.jsx(c,{}):null})})}),g.jsx("div",{className:it("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":n&&!a}),children:a?g.jsxs(g.Fragment,{children:[g.jsx("h2",{children:"Are you sure?"}),g.jsx("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),g.jsxs("div",{className:"tl-error-boundary__content__actions",children:[g.jsx("button",{onClick:()=>l(!1),children:"Cancel"}),g.jsx("button",{className:"tl-error-boundary__reset",onClick:C,children:"Reset data"})]})]}):g.jsxs(g.Fragment,{children:[g.jsx("h2",{children:"Something went wrong"}),g.jsx("p",{children:"Please refresh the page to continue."}),g.jsxs("p",{children:["If you keep seeing this screen, you can create a"," ",g.jsx("a",{href:E.toString(),children:"GitHub issue"})," or ask for help on"," ",g.jsx("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"Discord"}),". If you are still stuck, you can reset the tldraw data on your machine. This may erase the project you were working on, so try to get help first."]}),n&&g.jsxs(g.Fragment,{children:["Message:",g.jsx("h4",{children:g.jsx("code",{children:u})}),"Stack trace:",g.jsxs("div",{className:"tl-error-boundary__content__error",children:[g.jsx("pre",{children:g.jsx("code",{children:p??u})}),g.jsx("button",{onClick:b,children:o?"Copied!":"Copy"})]})]}),g.jsxs("div",{className:"tl-error-boundary__content__actions",children:[g.jsx("button",{onClick:()=>s(!n),children:n?"Hide details":"Show details"}),g.jsxs("div",{className:"tl-error-boundary__content__actions__group",children:[g.jsx("button",{className:"tl-error-boundary__reset",onClick:()=>l(!0),children:"Reset data"}),g.jsx("button",{className:"tl-error-boundary__refresh",onClick:S,children:"Refresh Page"})]})]})]})})]})},oL="TLDRAW_USER_DATA_v3",iL=Bt({id:Tt,name:Tt.nullable().optional(),color:Tt.nullable().optional(),locale:Tt.nullable().optional(),animationSpeed:yt.nullable().optional(),edgeScrollSpeed:yt.nullable().optional(),colorScheme:Z0("light","dark","system").optional(),isSnapMode:zt.nullable().optional(),isWrapMode:zt.nullable().optional(),isDynamicSizeMode:zt.nullable().optional(),isPasteAtCursorMode:zt.nullable().optional()}),Rl={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4,AddExcalidrawSelectMode:5,AddDynamicSizeMode:6,AllowSystemColorScheme:7,AddPasteAtCursor:8},P2=Math.max(...Object.values(Rl));function zY(r){r.version<Rl.AddAnimationSpeed&&(r.user.animationSpeed=1),r.version<Rl.AddIsSnapMode&&(r.user.isSnapMode=!1),r.version<Rl.MakeFieldsNullable,r.version<Rl.AddEdgeScrollSpeed&&(r.user.edgeScrollSpeed=1),r.version<Rl.AddExcalidrawSelectMode&&(r.user.isWrapMode=!1),r.version<Rl.AllowSystemColorScheme&&(r.user.isDarkMode===!0?r.user.colorScheme="dark":r.user.isDarkMode===!1&&(r.user.colorScheme="light"),delete r.user.isDarkMode),r.version<Rl.AddDynamicSizeMode&&(r.user.isDynamicSizeMode=!1),r.version<Rl.AddPasteAtCursor&&(r.user.isPasteAtCursorMode=!1),r.version=P2}const wE=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function aL(){return wE[Math.floor(Math.random()*wE.length)]}function $Y(){var r,e;return typeof window<"u"&&"matchMedia"in window?((e=(r=window.matchMedia)==null?void 0:r.call(window,"(prefers-reduced-motion: reduce)"))==null?void 0:e.matches)??!1:!1}const Na=Object.freeze({name:"New User",locale:hV(),color:aL(),edgeScrollSpeed:1,animationSpeed:$Y()?0:1,isSnapMode:!1,isWrapMode:!1,isDynamicSizeMode:!1,isPasteAtCursorMode:!1,colorScheme:"light"});function X1(){return{id:Cn(),color:aL()}}function lL(r){if(r===null||typeof r!="object"||!("version"in r)||!("user"in r)||typeof r.version!="number")return X1();const e=Kn(r);zY(e);try{return iL.validate(e.user)}catch{return X1()}}function BY(){const r=JSON.parse(Bk(oL)||"null")??null;return lL(r)}const nb=$r("globalUserData",null);function UY(){Uk(oL,JSON.stringify({version:P2,user:nb.get()}))}function cL(r){iL.validate(r),nb.set(r),UY(),GY()}const HY=typeof process<"u"&&!1,Eh=typeof BroadcastChannel<"u"&&!HY?new BroadcastChannel("tldraw-user-sync"):null;Eh==null||Eh.addEventListener("message",r=>{const e=r.data;(e==null?void 0:e.type)===uL&&(e==null?void 0:e.origin)!==dL()&&nb.set(lL(e.data))});let Z1=null;function dL(){return Z1===null&&(Z1=Cn()),Z1}const uL="tldraw-user-preferences-change";function GY(){Eh==null||Eh.postMessage({type:uL,origin:dL(),data:{user:hL(),version:P2}})}function hL(){let r=nb.get();return r||(r=BY(),cL(r)),r}const WY=Ie("defaultLocalStorageUserPrefs",()=>hL());function pL(r={}){return{userPreferences:r.userPreferences??WY,setUserPreferences:r.setUserPreferences??cL}}var J1={exports:{}},pR;function KY(){return pR||(pR=1,function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function s(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function o(l,c,u,p,f){if(typeof u!="function")throw new TypeError("The listener must be a function");var m=new s(u,p||l,f),v=t?t+c:c;return l._events[v]?l._events[v].fn?l._events[v]=[l._events[v],m]:l._events[v].push(m):(l._events[v]=m,l._eventsCount++),l}function i(l,c){--l._eventsCount===0?l._events=new n:delete l._events[c]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],u,p;if(this._eventsCount===0)return c;for(p in u=this._events)e.call(u,p)&&c.push(t?p.slice(1):p);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},a.prototype.listeners=function(c){var u=t?t+c:c,p=this._events[u];if(!p)return[];if(p.fn)return[p.fn];for(var f=0,m=p.length,v=new Array(m);f<m;f++)v[f]=p[f].fn;return v},a.prototype.listenerCount=function(c){var u=t?t+c:c,p=this._events[u];return p?p.fn?1:p.length:0},a.prototype.emit=function(c,u,p,f,m,v){var b=t?t+c:c;if(!this._events[b])return!1;var S=this._events[b],C=arguments.length,E,T;if(S.fn){switch(S.once&&this.removeListener(c,S.fn,void 0,!0),C){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,u),!0;case 3:return S.fn.call(S.context,u,p),!0;case 4:return S.fn.call(S.context,u,p,f),!0;case 5:return S.fn.call(S.context,u,p,f,m),!0;case 6:return S.fn.call(S.context,u,p,f,m,v),!0}for(T=1,E=new Array(C-1);T<C;T++)E[T-1]=arguments[T];S.fn.apply(S.context,E)}else{var w=S.length,M;for(T=0;T<w;T++)switch(S[T].once&&this.removeListener(c,S[T].fn,void 0,!0),C){case 1:S[T].fn.call(S[T].context);break;case 2:S[T].fn.call(S[T].context,u);break;case 3:S[T].fn.call(S[T].context,u,p);break;case 4:S[T].fn.call(S[T].context,u,p,f);break;default:if(!E)for(M=1,E=new Array(C-1);M<C;M++)E[M-1]=arguments[M];S[T].fn.apply(S[T].context,E)}}return!0},a.prototype.on=function(c,u,p){return o(this,c,u,p,!1)},a.prototype.once=function(c,u,p){return o(this,c,u,p,!0)},a.prototype.removeListener=function(c,u,p,f){var m=t?t+c:c;if(!this._events[m])return this;if(!u)return i(this,m),this;var v=this._events[m];if(v.fn)v.fn===u&&(!f||v.once)&&(!p||v.context===p)&&i(this,m);else{for(var b=0,S=[],C=v.length;b<C;b++)(v[b].fn!==u||f&&!v[b].once||p&&v[b].context!==p)&&S.push(v[b]);S.length?this._events[m]=S.length===1?S[0]:S:i(this,m)}return this},a.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&i(this,u)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,r.exports=a}(J1)),J1.exports}var VY=KY();const qY=ec(VY),kh="TLDRAW_TAB_ID_v2",Kl=globalThis.window;function YY(){return Kl?["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(Kl.navigator.platform)||Rn.isDarwin&&"ontouchend"in document:!1}const e0=Kl?Kl[kh]??qO(kh)??"TLDRAW_INSTANCE_STATE_V1_"+Cn():"<error>";Kl&&(Kl[kh]=e0,YY()?Hk(kh,e0):YO(kh));Kl==null||Kl.addEventListener("beforeunload",()=>{Hk(kh,e0)});const fL={Initial:0},rb=Math.max(...Object.values(fL));function XY(r){r.version<fL.Initial,r.version=rb}const gL=Bt({version:yt,currentPageId:Bf.optional(),isFocusMode:zt.optional(),exportBackground:zt.optional(),isDebugMode:zt.optional(),isToolLocked:zt.optional(),isGridMode:zt.optional(),pageStates:ms(Bt({pageId:Bf,camera:Bt({x:yt,y:yt,z:yt}).optional(),selectedShapeIds:ms(ji).optional(),focusedGroupId:ji.nullable().optional()})).optional()});function ZY(r){if(!r||typeof r!="object")return console.warn("Invalid instance state"),null;if(!("version"in r)||typeof r.version!="number")return console.warn("No version in instance state"),null;r.version!==rb&&(r=Kn(r),XY(r));try{return gL.validate(r)}catch(e){return console.warn(e),null}}function I2(r){const e=r.query.ids("page");return Ie("sessionStateSnapshot",()=>{const t=r.get(oo);if(!t)return null;const n=[...e.get()];return{version:rb,currentPageId:t.currentPageId,exportBackground:t.exportBackground,isFocusMode:t.isFocusMode,isDebugMode:t.isDebugMode,isToolLocked:t.isToolLocked,isGridMode:t.isGridMode,pageStates:n.map(s=>{const o=r.get(la.createId(s)),i=r.get(Ja.createId(s));return{pageId:s,camera:{x:(i==null?void 0:i.x)??0,y:(i==null?void 0:i.y)??0,z:(i==null?void 0:i.z)??1},selectedShapeIds:(o==null?void 0:o.selectedShapeIds)??[],focusedGroupId:(o==null?void 0:o.focusedGroupId)??null}})}},{isEqual:U3})}function CE(r,e,t){const n=ZY(e);if(!n)return;const s=s5(r.get(oo)),o=t!=null&&t.forceOverwrite?n:s,i=t!=null&&t.forceOverwrite?s:n,a=r.schema.types.instance.create({id:oo,...s,currentPageId:n.currentPageId,isDebugMode:(o==null?void 0:o.isDebugMode)??(i==null?void 0:i.isDebugMode),isFocusMode:(o==null?void 0:o.isFocusMode)??(i==null?void 0:i.isFocusMode),isToolLocked:(o==null?void 0:o.isToolLocked)??(i==null?void 0:i.isToolLocked),isGridMode:(o==null?void 0:o.isGridMode)??(i==null?void 0:i.isGridMode),exportBackground:(o==null?void 0:o.exportBackground)??(i==null?void 0:i.exportBackground)});r.atomic(()=>{var l,c,u;for(const p of n.pageStates??[]){if(!r.has(p.pageId))continue;const f=Ja.createId(p.pageId),m=la.createId(p.pageId),v=r.get(f),b=r.get(m);r.put([Ja.create({id:f,x:((l=p.camera)==null?void 0:l.x)??(v==null?void 0:v.x),y:((c=p.camera)==null?void 0:c.y)??(v==null?void 0:v.y),z:((u=p.camera)==null?void 0:u.z)??(v==null?void 0:v.z)}),la.create({id:m,pageId:p.pageId,selectedShapeIds:p.selectedShapeIds??(b==null?void 0:b.selectedShapeIds),focusedGroupId:p.focusedGroupId??(b==null?void 0:b.focusedGroupId)})])}r.put([a]),r.ensureStoreIsUsable()})}function JY(r){var s;const e=[];for(const o of Object.values(r))(s=o.typeName)!=null&&s.match(/^(instance.*|pointer|camera)$/)&&e.push(o);const t=e.filter(o=>o.typeName==="instance"&&o.id!==oo)[0];if(!t)return null;const n={version:rb,currentPageId:t.currentPageId,exportBackground:!!t.exportBackground,isFocusMode:!!t.isFocusMode,isDebugMode:!!t.isDebugMode,isToolLocked:!!t.isToolLocked,isGridMode:!1,pageStates:e.filter(o=>o.typeName==="instance_page_state"&&o.instanceId===t.id).map(o=>{const i=r[o.cameraId]??{x:0,y:0,z:1};return{pageId:o.pageId,camera:{x:i.x,y:i.y,z:i.z},selectedShapeIds:o.selectedShapeIds,focusedGroupId:o.focusedGroupId}})};try{return gL.validate(n),n}catch{return null}}function mL(r,e,t){let n={};if("store"in e){const i=r.schema.migrateStoreSnapshot(e);if(i.type!=="success")throw new Error("Failed to migrate store snapshot: "+i.reason);n.document={schema:r.schema.serialize(),store:Pf(i.value,(a,{typeName:l})=>r.scopedTypes.document.has(l))}}else n=e;const s=s5(r.get(oo)),o=yL.get(r,I2).get();r.atomic(()=>{n.document&&r.loadStoreSnapshot(n.document),s&&r.update(oo,i=>({...i,...s})),o&&CE(r,o),n.session&&CE(r,n.session,{forceOverwrite:t==null?void 0:t.forceOverwriteSessionState})})}const yL=new il;function QY(r){const t=yL.get(r,I2).get();if(!t)throw new Error("Session state is not ready yet");return{document:r.getStoreSnapshot(),session:t}}function vL(r){const e=[],t=new Set;for(const n of r){if(t.has(n.type))throw new Error(`Binding type "${n.type}" is defined more than once`);e.push(n),t.add(n.type)}return e}function sd({children:r,className:e="",...t}){return g.jsx("svg",{...t,className:it("tl-svg-container",e),children:r})}function _2(r,e,t,n){const s=r.x-t.x,o=r.y-t.y,i=n.x-t.x,a=n.y-t.y,l=e.x-r.x,c=e.y-r.y,u=i*o-a*s,p=l*o-c*s,f=a*l-i*c;if(u===0||p===0||f===0)return null;if(f!==0){const m=u/f,v=p/f;if(0<=m&&m<=1&&0<=v&&v<=1)return P.AddXY(r,m*l,m*c)}return null}function Hg(r,e,t,n){const s=(e.x-r.x)*(e.x-r.x)+(e.y-r.y)*(e.y-r.y),o=2*((e.x-r.x)*(r.x-t.x)+(e.y-r.y)*(r.y-t.y)),i=t.x*t.x+t.y*t.y+r.x*r.x+r.y*r.y-2*(t.x*r.x+t.y*r.y)-n*n,a=o*o-4*s*i;if(a<0||a===0)return null;const l=Math.sqrt(a),c=(-o+l)/(2*s),u=(-o-l)/(2*s);if((c<0||c>1)&&(u<0||u>1))return null;const p=[];return 0<=c&&c<=1&&p.push(P.Lrp(r,e,c)),0<=u&&u<=1&&p.push(P.Lrp(r,e,u)),p.length===0?null:p}function eX(r,e,t){const n=[];let s;for(let o=0,i=t.length-1;o<i;o++)s=_2(r,e,t[o],t[o+1]),s&&n.push(s);return n.length===0?null:n}function T2(r,e,t){const n=[];let s;for(let o=1,i=t.length;o<i+1;o++)s=_2(r,e,t[o-1],t[o%t.length]),s&&n.push(s);return n.length===0?null:n}function tX(r,e,t,n){let s=t.x-r.x,o=t.y-r.y;const i=Math.sqrt(s*s+o*o),a=(i*i-n*n+e*e)/(2*i),l=Math.sqrt(e*e-a*a);return s/=i,o/=i,[new P(r.x+s*a-o*l,r.y+o*a+s*l),new P(r.x+s*a+o*l,r.y+o*a-s*l)]}function EE(r,e,t){const n=[];let s,o,i;for(let a=0,l=t.length;a<l;a++)s=t[a],o=t[(a+1)%t.length],i=Hg(s,o,r,e),i&&n.push(...i);return n.length===0?null:n}function fR(r,e,t){const n=[];let s,o,i;for(let a=1,l=t.length;a<l;a++)s=t[a-1],o=t[a],i=Hg(s,o,r,e),i&&n.push(...i);return n.length===0?null:n}function yy(r,e,t){return(t.y-r.y)*(e.x-r.x)>(e.y-r.y)*(t.x-r.x)}function M2(r,e,t,n){return yy(r,t,n)!==yy(e,t,n)&&yy(r,e,t)!==yy(r,e,n)}function gR(r,e){const t=new Map;let n,s,o,i;for(let a=0,l=r.length;a<l;a++)if(n=r[a],ai(n,e)){const c=Q1(n);t.has(c)||t.set(c,n)}for(let a=0,l=e.length;a<l;a++)if(n=e[a],ai(n,r)){const c=Q1(n);t.has(c)||t.set(c,n)}for(let a=0,l=r.length;a<l;a++){n=r[a],s=r[(a+1)%r.length];for(let c=0,u=e.length;c<u;c++){o=e[c],i=e[(c+1)%e.length];const p=_2(n,s,o,i);if(p!==null){const f=Q1(p);t.has(f)||t.set(f,p)}}}return t.size===0?null:nX([...t.values()])}function Q1(r){return`${r.x},${r.y}`}function nX(r){const e=P.Average(r);return r.sort((t,n)=>P.Angle(e,t)-P.Angle(e,n))}function A2(r,e){let t,n,s,o;for(let i=0,a=r.length;i<a;i++){t=r[i],n=r[(i+1)%a];for(let l=0,c=e.length;l<c;l++)if(s=e[l],o=e[(l+1)%c],M2(t,n,s,o))return!0}return!1}function rX(r,e){let t,n,s,o;for(let i=0,a=r.length;i<a;i++){t=r[i],n=r[(i+1)%a];for(let l=1,c=e.length;l<c;l++)if(s=e[l-1],o=e[l],M2(t,n,s,o))return!0}return!1}class $l extends gd{constructor(t){super({...t,isClosed:!1,isFilled:!1});k(this,"start");k(this,"end");k(this,"d");k(this,"u");k(this,"ul");const{start:n,end:s}=t;this.start=n,this.end=s,this.d=n.clone().sub(s),this.u=this.d.clone().uni(),this.ul=this.u.len()}getLength(){return this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(t){const{start:n,end:s,d:o,u:i,ul:a}=this;if(o.len()===0||a===0)return n;const l=P.Sub(t,n).dpr(i)/a,c=n.x+i.x*l;if(c<Math.min(n.x,s.x))return n.x<s.x?n:s;if(c>Math.max(n.x,s.x))return n.x>s.x?n:s;const u=n.y+i.y*l;return u<Math.min(n.y,s.y)?n.y<s.y?n:s:u>Math.max(n.y,s.y)?n.y>s.y?n:s:new P(c,u)}hitTestLineSegment(t,n,s=0){return M2(t,n,this.start,this.end)||this.distanceToLineSegment(t,n)<=s}getSvgPathData(t=!0){const{start:n,end:s}=this;return`${t?`M${n.toFixed()}`:""} L${s.toFixed()}`}}class ap extends gd{constructor(t){super({isClosed:!1,isFilled:!1,...t});k(this,"points");k(this,"_segments");const{points:n}=t;this.points=n}get segments(){if(!this._segments){this._segments=[];const{vertices:t}=this;for(let n=0,s=t.length-1;n<s;n++){const o=t[n],i=t[n+1];this._segments.push(new $l({start:o,end:i}))}this.isClosed&&this._segments.push(new $l({start:t[t.length-1],end:t[0]}))}return this._segments}getLength(){return this.segments.reduce((t,n)=>t+n.length,0)}getVertices(){return this.points}nearestPoint(t){const{segments:n}=this;let s=this.points[0],o=1/0,i,a;for(let l=0;l<n.length;l++)i=n[l].nearestPoint(t),a=P.Dist2(i,t),a<o&&(s=i,o=a);if(!s)throw Error("nearest point not found");return s}hitTestLineSegment(t,n,s=0){const{segments:o}=this;for(let i=0,a=o.length;i<a;i++)if(o[i].hitTestLineSegment(t,n,s))return!0;return!1}getSvgPathData(){const{vertices:t}=this;return t.length<2?"":t.reduce((n,s,o)=>o===0?`M ${s.x} ${s.y}`:`${n} L ${s.x} ${s.y}`,"")}}class Er extends ap{constructor(e){super({...e}),this.isClosed=!0}}class dl extends Er{constructor(t){const{x:n=0,y:s=0,width:o,height:i}=t;super({...t,points:[new P(n,s),new P(n+o,s),new P(n+o,s+i),new P(n,s+i)]});k(this,"x");k(this,"y");k(this,"w");k(this,"h");this.x=n,this.y=s,this.w=o,this.h=i}getBounds(){return new Ve(this.x,this.y,this.w,this.h)}getSvgPathData(){const{x:t,y:n,w:s,h:o}=this;return`M${t},${n} h${s} v${o} h-${s}z`}}class pa{constructor(e){this.editor=e}canSnap(e){return!0}canScroll(e){return!1}canBind(e){return!0}canEdit(e){return!1}canResize(e){return!0}canEditInReadOnly(e){return!1}canCrop(e){return!1}canBeLaidOut(e){return!0}providesBackgroundForChildren(e){return!1}hideResizeHandles(e){return!1}hideRotateHandle(e){return!1}hideSelectionBoundsBg(e){return!1}hideSelectionBoundsFg(e){return!1}isAspectRatioLocked(e){return!1}canReceiveNewChildrenOfType(e,t){return!1}canDropShapes(e,t){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}getBoundsSnapGeometry(e){return{}}getHandleSnapGeometry(e){return{}}getText(e){}}k(pa,"props"),k(pa,"migrations"),k(pa,"type");function sa(r,e,t={}){const{closed:n=!1,snap:s=1,start:o="outset",end:i="outset",lengthRatio:a=2,style:l="dashed",forceSolid:c=!1}=t;let u=0,p=0,f=1,m=0,v=0;if(c)return{strokeDasharray:"none",strokeDashoffset:"none"};switch(l){case"dashed":{f=1,u=Math.min(e*a,r/4);break}case"dotted":{f=100,u=e/f;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return n||(o==="outset"?(r+=u/2,v+=u/2):o==="skip"&&(r-=u,v-=u),i==="outset"?r+=u/2:i==="skip"&&(r-=u)),p=Math.floor(r/u/(2*f)),p-=p%s,p<3&&l==="dashed"?r/e<4?(u=r,p=1,m=0):(u=r*(1/3),m=r*(1/3)):(u=r/p/(2*f),n?(v=u/2,m=(r-p*u)/p):m=(r-p*u)/Math.max(1,p-1)),{strokeDasharray:[u,m].join(" "),strokeDashoffset:v.toString()}}function mR({bounds:r,className:e}){const t=ue(),n=ye("zoom level",()=>t.getZoomLevel(),[t]);return g.jsx("g",{className:e,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:r.sides.map((s,o)=>{const{strokeDasharray:i,strokeDashoffset:a}=sa(s[0].dist(s[1]),1/n,{style:"dashed",lengthRatio:4});return g.jsx("line",{x1:s[0].x,y1:s[0].y,x2:s[1].x,y2:s[1].y,strokeDasharray:i,strokeDashoffset:a},o)})})}class Jy extends pa{hideSelectionBoundsFg(){return!0}canBind(){return!1}getDefaultProps(){return{}}getGeometry(e){const t=this.editor.getSortedChildIdsForParent(e.id);return t.length===0?new dl({width:1,height:1,isFilled:!1}):new Fi({children:t.map(n=>{const s=this.editor.getShape(n),o=this.editor.getShapeGeometry(n),i=this.editor.getShapeLocalTransform(s).applyToPoints(o.vertices);return o.isClosed?new Er({points:i,isFilled:!0}):new ap({points:i})})})}component(e){const t=this.editor.getErasingShapeIds().includes(e.id),{hintingShapeIds:n}=this.editor.getCurrentPageState(),s=n.length>0&&n.some(a=>a!==e.id&&this.editor.isShapeOfType(this.editor.getShape(a),"group")),o=this.editor.getCurrentPageState().focusedGroupId!==e.id;if(!t&&(o||s))return null;const i=this.editor.getShapeGeometry(e).bounds;return g.jsx(sd,{children:g.jsx(mR,{className:"tl-group",bounds:i})})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds;return g.jsx(mR,{className:"",bounds:t})}onChildrenChange(e){const t=this.editor.getSortedChildIdsForParent(e.id);if(t.length===0){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([e.id]);return}else if(t.length===1){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(t,e.parentId),this.editor.deleteShapes([e.id]);return}}}k(Jy,"type","group"),k(Jy,"props",m5),k(Jy,"migrations",y5);const bL=[Jy],sX=new Set(bL.map(r=>r.type));function SL(r){const e=[...bL],t=new Set;for(const n of r){if(sX.has(n.type))throw new Error(`Shape type "${n.type}" is a core shapes type and cannot be overridden`);if(t.has(n.type))throw new Error(`Shape type "${n.type}" is defined more than once`);e.push(n),t.add(n.type)}return e}var lp=CO();const oX=ec(lp);function xL(r,e){const t=new Map;return async function(s){const o=t.get(s);if(o)return o;const i=(async()=>{try{const a=await al(s,e);return fn(a.ok),await r(a)}catch(a){return console.error(a),null}})();return t.set(s,i),i}}const sb=xL(async r=>await aa.blobToDataUrl(await r.blob())),iX=/@import\s+(?:"([^"]+)"|'([^']+)'|url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\))([^;]+);/gi,aX=/@font-face\s*{([^}]+)}/gi,wL=/url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\)/gi,lX=/(?:^|;)\s*font-family\s*:\s*(?:([^'"][^;\n]+)|"([^"]+)"|'([^']+)')\s*(?:;|$)/gi;function cX(r){return Array.from(r.matchAll(iX),e=>({url:e[1]||e[2]||e[3]||e[4]||e[5],extras:e[6]}))}function CL(r,e){return Array.from(r.matchAll(aX),t=>{const n=t[1],s=Array.from(n.matchAll(wL),i=>{var l;const a=i[1]||i[2]||i[3];return{original:a,resolved:((l=vt(a,e))==null?void 0:l.href)??null}}),o=new Set(Array.from(n.matchAll(lX),i=>(i[1]||i[2]||i[3]).toLowerCase()));return{fontFace:n,urls:s,fontFamilies:o}})}function dX(r){const e=/\s*(?:([^'"][^;\n\s,]+)|"([^"]+)"|'([^']+)')\s*/gi,t=/\s*,\s*/gi,n=new Set;for(;;){const s=e.exec(r);if(!s)break;const o=s[1]||s[2]||s[3];if(n.add(o.toLowerCase()),t.lastIndex=e.lastIndex,!t.exec(r))break;e.lastIndex=t.lastIndex}return n}function EL(r){return!(r.startsWith("-")||r.startsWith("animation")||r.startsWith("transition")||r==="cursor"||r==="pointer-events"||r==="user-select"||r==="touch-action")}function uX(r,e){return{imports:cX(r),fontFaces:CL(r,e)}}function hX(r){return Array.from(r.matchAll(wL),e=>({original:e[0],url:e[1]||e[2]||e[3]}))}const pX=new Set(["border-collapse","border-spacing","caption-side","color","cursor","direction","empty-cells","font-family","font-size","font-style","font-variant","font-weight","font-size-adjust","font-stretch","font","letter-spacing","line-height","list-style-image","list-style-position","list-style-type","list-style","orphans","quotes","tab-size","text-align","text-align-last","text-decoration-color","text-indent","text-justify","text-shadow","text-transform","visibility","white-space","widows","word-break","word-spacing","word-wrap"]);function kL(r){return pX.has(r)}var fX=Object.create,PL=Object.defineProperty,gX=Object.getOwnPropertyDescriptor,mX=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),IL=r=>{throw TypeError(r)},_L=(r,e,t)=>e in r?PL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,yX=r=>[,,,fX(null)],TL=["class","method","getter","setter","accessor","field","value","get","set"],ML=r=>r!==void 0&&typeof r!="function"?IL("Function expected"):r,vX=(r,e,t,n,s)=>({kind:TL[r],name:e,metadata:n,addInitializer:o=>t._?IL("Already initialized"):s.push(ML(o||null))}),bX=(r,e)=>_L(e,mX("metadata"),r[3]),SX=(r,e,t,n)=>{for(var s=0,o=r[e>>1],i=o&&o.length;s<i;s++)o[s].call(t);return n},xX=(r,e,t,n,s,o)=>{for(var i,a,l,c,u=e&7,p=!!(e&8),f=!!(e&16),m=2,v=TL[u+5],b=r[m]||(r[m]=[]),S=(s=s.prototype,gX(s,t)),C=n.length-1;C>=0;C--)l=vX(u,t,a={},r[3],b),l.static=p,l.private=f,c=l.access={has:E=>t in E},c.get=E=>E[t],i=(0,n[C])(S[v],l),a._=1,ML(i)&&(S[v]=i);return S&&PL(s,t,S),s},vy=(r,e,t)=>_L(r,typeof e!="symbol"?e+"":e,t),AL,ob;AL=[Bo];class j2{constructor(){SX(ob,5,this),vy(this,"fontFacesPromise",null),vy(this,"foundFontNames",new Set),vy(this,"fontFacesToEmbed",new Set),vy(this,"pendingPromises",[])}startFindingCurrentDocumentFontFaces(){fn(!this.fontFacesPromise,"FontEmbedder already started"),this.fontFacesPromise=wX()}onFontFamilyValue(e){fn(this.fontFacesPromise,"FontEmbedder not started");const t=dX(e);for(const n of t){if(this.foundFontNames.has(n))return;this.foundFontNames.add(n),this.pendingPromises.push(this.fontFacesPromise.then(s=>{const o=s.filter(i=>i.fontFamilies.has(n));for(const i of o)if(!this.fontFacesToEmbed.has(i)){this.fontFacesToEmbed.add(i);for(const a of i.urls)!a.resolved||a.embedded||(a.embedded=sb(a.resolved))}}))}}async createCss(){await Promise.all(this.pendingPromises);let e="";for(const t of this.fontFacesToEmbed){let n=`@font-face {${t.fontFace}}`;for(const s of t.urls){if(!s.embedded)continue;const o=await s.embedded;o&&(n=n.replace(s.original,o))}e+=n}return e}}ob=yX();xX(ob,1,"onFontFamilyValue",AL,j2);bX(ob,j2);async function wX(){var e;const r=[];for(const t of document.styleSheets){let n;try{n=t.cssRules}catch{}if(n){for(const s of t.cssRules)if(s instanceof CSSFontFaceRule)r.push(CL(s.cssText,t.href??document.baseURI));else if(s instanceof CSSImportRule){const o=new URL(s.href,((e=s.parentStyleSheet)==null?void 0:e.href)??document.baseURI);r.push(kE(o.href))}}else t.href&&r.push(kE(t.href))}return kt(await Promise.all(r)).flat()}const kE=xL(async r=>{const e=uX(await r.text(),r.url),t=await Promise.all(e.imports.map(({url:n})=>kE(new URL(n,r.url).href)));return[...e.fontFaces,...kt(t).flat()]});function jL(r){if(r.shadowRoot)return r.shadowRoot.childNodes;if(PX(r)){const e=r.assignedNodes();if(e!=null&&e.length)return e}return r.childNodes}function*PE(r){for(const e of jL(r))CX(e)&&(yield e)}function ib(r){var e;return((e=r.ownerDocument)==null?void 0:e.defaultView)??globalThis}function CX(r){return r instanceof ib(r).Element}function EX(r){return r instanceof ib(r).ShadowRoot}function kX(r){return"getRootNode"in r&&EX(r.getRootNode())}function PX(r){return kX(r)&&r instanceof ib(r).HTMLSlotElement}function IX(r){return r.style}function R2(r,e){return ib(r).getComputedStyle(r,e)}const su={};class _X{constructor(e){k(this,"styles",new Map);k(this,"fonts",new j2);this.root=e}readRootElementStyles(e){this.readElementStyles(e,{shouldRespectDefaults:!1,shouldSkipInheritedParentStyles:!1});const t=Array.from(PE(e));for(;t.length;){const n=t.pop();t.push(...PE(n)),this.readElementStyles(n,{shouldRespectDefaults:!0,shouldSkipInheritedParentStyles:!0})}}readElementStyles(e,{shouldRespectDefaults:t=!0,shouldSkipInheritedParentStyles:n=!0}){var a;const s=t?jX(e.tagName.toLowerCase()):su,o=n?((a=this.styles.get(e.parentElement))==null?void 0:a.self)??su:su,i={self:TX(e,{defaultStyles:s,parentStyles:o}),before:yR(e,"::before"),after:yR(e,"::after")};this.styles.set(e,i)}fetchResources(){const e=[];for(const t of this.styles.values())for(const n of ir(t))if(n)for(const[s,o]of Object.entries(n)){if(!o)continue;s==="font-family"&&this.fonts.onFontFamilyValue(o);const i=hX(o);i.length!==0&&e.push(...i.map(async({url:a,original:l})=>{const c=await sb(a)??"data:";n[s]=o.replace(l,`url("${c}")`)}))}return Promise.all(e)}unwrapCustomElements(){const e=new Set,t=(n,s)=>{if(e.has(n))return;e.add(n);const o=n.shadowRoot;if(o){const i=document.createElement("div");this.styles.set(i,this.styles.get(n)),i.setAttribute("data-tl-custom-element",n.tagName),(s??n.parentElement).appendChild(i);for(const a of o.childNodes)a instanceof Element?t(a,i):i.appendChild(a.cloneNode(!0));n.remove()}else if(s){if(n.tagName.toLowerCase()==="style")return;const i=n.cloneNode(!1);this.styles.set(i,this.styles.get(n)),s.appendChild(i);for(const a of jL(n))a instanceof Element?t(a,i):i.appendChild(a.cloneNode(!0))}};for(const n of this.styles.keys())t(n,null)}embedStyles(){let e="";for(const[t,n]of this.styles){if(n.after||n.before){const o=`pseudo-${Cn()}`;t.classList.add(o),n.before&&(e+=`.${o}::before {${vR(n.before)}}
`),n.after&&(e+=`.${o}::after {${vR(n.after)}}
`)}const s=IX(t);for(const[o,i]of Object.entries(n.self))i&&s.setProperty(o,i);s.fontKerning==="auto"&&(s.fontKerning="normal")}return e}async getFontFaceCss(){return await this.fonts.createCss()}dispose(){AX()}}function TX(r,{defaultStyles:e,parentStyles:t}){return r.computedStyleMap?RL(r.computedStyleMap(),{defaultStyles:e,parentStyles:t}):D2(R2(r),{defaultStyles:e,parentStyles:t})}function yR(r,e){const t=R2(r,e),n=t.getPropertyValue("content");if(!(n===""||n==="none"))return D2(t,{defaultStyles:su,parentStyles:su})}function RL(r,{defaultStyles:e,parentStyles:t}){const n={};for(const s of r.keys()){if(!EL(s))continue;const o=r.get(s).toString();e[s]!==o&&(t[s]===o&&kL(s)||(n[s]=o))}return n}function D2(r,{defaultStyles:e,parentStyles:t}){const n={};for(const s of r){if(!EL(s))continue;const o=r.getPropertyValue(s);e[s]!==o&&(t[s]===o&&kL(s)||(n[s]=o))}return n}function vR(r){let e="";for(const[t,n]of Object.entries(r))e+=`${t}: ${n};`;return e}let Ph;const bR={};function MX(){if(!Ph){const r=document.createElement("iframe");r.style.display="none",document.body.appendChild(r);const e=Lo(r.contentDocument,"frame must have a document"),t=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");t.appendChild(n),e.body.appendChild(t),Ph={iframe:r,foreignObject:n,document:e}}return Ph}function AX(){Ph&&(document.body.removeChild(Ph.iframe),Ph=void 0)}const SR={defaultStyles:su,parentStyles:su};function jX(r){let e=bR[r];if(!e){const{foreignObject:t,document:n}=MX(),s=n.createElement(r);t.appendChild(s),e=s.computedStyleMap?RL(s.computedStyleMap(),SR):D2(R2(s),SR),t.removeChild(s),bR[r]=e}return e}function RX(r,e){Array.from(r.attributes).forEach(n=>{e.setAttribute(n.name,n.value)})}function xR(r,e){return r.replaceWith(e),e}async function Tf(r,e){const t=document.createElement("img");e&&RX(e,t),t.setAttribute("src",r??"data:"),t.setAttribute("decoding","sync"),t.setAttribute("loading","eager");try{await t.decode()}catch{}return t}async function DX(r){try{const e=r.toDataURL();return await Tf(e,r)}catch{return await Tf(null,r)}}async function OX(r){try{const e=await ri.getVideoFrameAsDataUrl(r);return Tf(e,r)}catch(e){console.error("Could not get video frame",e)}if(r.poster){const e=await sb(r.poster);return Tf(e,r)}return Tf(null,r)}async function DL(r){if(r instanceof HTMLCanvasElement)return xR(r,await DX(r));if(r instanceof HTMLVideoElement)return xR(r,await OX(r));if(r instanceof HTMLImageElement){const e=r.currentSrc||r.src,t=await sb(e);r.setAttribute("src",t??"data:"),r.setAttribute("decoding","sync"),r.setAttribute("loading","eager");try{await r.decode()}catch{}return r}else r instanceof HTMLInputElement?r.setAttribute("value",r.value):r instanceof HTMLTextAreaElement&&(r.textContent=r.value);await Promise.all(Array.from(PE(r),e=>DL(e)))}function ab(r){const e=I.useRef();return I.useLayoutEffect(()=>{e.current=r}),I.useDebugValue(r),I.useCallback((...t)=>{const n=e.current;return fn(n,"fn does not exist"),n(...t)},[])}const O2=I.createContext(null);function LX({context:r,editor:e,children:t}){const n=e.options.exportProvider;return g.jsx(b2,{editor:e,children:g.jsx(N5,{container:e.getContainer(),children:g.jsx(O2.Provider,{value:r,children:g.jsx(n,{children:t})})})})}function Gg(){return I.useContext(O2)}function NX(){const r=I.useContext(O2),[e]=I.useState(Rk);return I.useEffect(()=>(r==null||r.waitUntil(e),()=>{e.resolve()}),[e,r]),ab(()=>{e.resolve()})}var FX=Object.create,OL=Object.defineProperty,zX=Object.getOwnPropertyDescriptor,$X=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),LL=r=>{throw TypeError(r)},NL=(r,e,t)=>e in r?OL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,BX=r=>[,,,FX(null)],FL=["class","method","getter","setter","accessor","field","value","get","set"],zL=r=>r!==void 0&&typeof r!="function"?LL("Function expected"):r,UX=(r,e,t,n,s)=>({kind:FL[r],name:e,metadata:n,addInitializer:o=>t._?LL("Already initialized"):s.push(zL(o||null))}),HX=(r,e)=>NL(e,$X("metadata"),r[3]),GX=(r,e,t,n)=>{for(var s=0,o=r[e>>1],i=o&&o.length;s<i;s++)o[s].call(t);return n},WX=(r,e,t,n,s,o)=>{for(var i,a,l,c,u=e&7,p=!!(e&8),f=!!(e&16),m=2,v=FL[u+5],b=r[m]||(r[m]=[]),S=(s=s.prototype,zX(s,t)),C=n.length-1;C>=0;C--)l=UX(u,t,a={},r[3],b),l.static=p,l.private=f,c=l.access={has:E=>t in E},c.get=E=>E[t],i=(0,n[C])(S[v],l),a._=1,zL(i)&&(S[v]=i);return S&&OL(s,t,S),s},wR=(r,e,t)=>NL(r,typeof e!="symbol"?e+"":e,t),$L,lb;$L=[Bo];class L2{constructor(e){this.maxDelayTimeMs=e,GX(lb,5,this),wR(this,"isResolved",!1),wR(this,"promisesToWaitFor",[])}waitUntil(e){if(this.isResolved)throw new Error("Cannot `waitUntil` - the export has already been resolved. Make sure to call `waitUntil` as soon as possible during an export - ie within the first react effect after rendering.");this.promisesToWaitFor.push(e.catch(t=>console.error("Error whilst waiting for export:",t)))}async resolvePromises(){let e=null;for(;this.promisesToWaitFor.length!==e;)e=this.promisesToWaitFor.length,await Promise.allSettled(this.promisesToWaitFor),await sE(0)}async resolve(){const e=sE(this.maxDelayTimeMs).then(()=>"timeout"),t=this.resolvePromises().then(()=>"resolved");await Promise.race([e,t])==="timeout"&&console.warn("[tldraw] Export delay timed out after ${this.maxDelayTimeMs}ms"),this.isResolved=!0}}lb=BX();WX(lb,1,"waitUntil",$L,L2);HX(lb,L2);function KX(r,e,t={}){var C,E;if(!window.document)throw Error("No document");const{scale:n=1,background:s=!1,padding:o=r.options.defaultSvgPadding,preserveAspectRatio:i}=t,a=t.darkMode??r.user.getIsDarkMode(),l=r.getShapeAndDescendantIds(e),c=r.getUnorderedRenderingShapes(!1).filter(({id:T})=>l.has(T));let u=null;if(t.bounds)u=t.bounds;else for(const{id:T}of c){const w=r.getShapeMaskedPageBounds(T);w&&(u?u.union(w):u=w.clone())}if(!u)return;const p=e.length===1&&r.isShapeOfType(r.getShape(e[0]),"frame")?e[0]:null;p||u.expandBy(o);const f=u.width*n,m=u.height*n;try{(E=(C=document.body).focus)==null||E.call(C)}catch{}const v=new L2(r.options.maxExportDelayMs),b=Rk();return v.waitUntil(b),{jsx:g.jsx(VX,{editor:r,preserveAspectRatio:i,scale:n,bbox:u,background:s,singleFrameShapeId:p,isDarkMode:a,renderingShapes:c,onMount:b.resolve,waitUntil:v.waitUntil}),width:f,height:m,exportDelay:v}}function VX({editor:r,preserveAspectRatio:e,scale:t,bbox:n,background:s,singleFrameShapeId:o,isDarkMode:i,renderingShapes:a,onMount:l,waitUntil:c}){const u=sp(),p=rc({isDarkMode:i}),f=n2("export state",{defsById:{},shapeElements:null}),{defsById:m,shapeElements:v}=ye(f),b=ab(E=>{f.update(T=>{if(ua(T.defsById,E.key))return T;const w=Promise.resolve(E.getElement());return c(w.then(M=>{f.update(R=>({...R,defsById:{...R.defsById,[E.key]:{pending:!1,element:M}}}))})),{...T,defsById:{...T.defsById,[E.key]:{pending:!0,element:w}}}})}),S=I.useMemo(()=>({isDarkMode:i,waitUntil:c,addExportDef:b}),[i,c,b]),C=I.useRef(!1);return I.useLayoutEffect(()=>{if(C.current)throw new Error("SvgExport should only render once - do not use with react strict mode");C.current=!0,(async()=>{const E={},T=a.map(async({id:M,opacity:R,index:D,backgroundIndex:N})=>{var K,O;if(M===o)return[];const z=r.getShape(M);if(r.isShapeOfType(z,"group"))return[];const L=[],B=r.getShapeUtil(z);if(B.toSvg||B.toBackgroundSvg){const[U,X]=await Promise.all([(K=B.toSvg)==null?void 0:K.call(B,z,S),(O=B.toBackgroundSvg)==null?void 0:O.call(B,z,S)]),H=r.getShapePageTransform(z);let ee=H.toCssString(),J=1;"scale"in z.props&&z.props.scale!==1&&(J=z.props.scale,ee=`${ee} scale(${z.props.scale}, ${z.props.scale})`);const ne=r.getShapeMask(z.id),ae=ne?Ne.From(Ne.Inverse(H)).applyToPoints(ne):null,q=y2(u,z.id);ae&&(E[q]={pending:!1,element:g.jsx("clipPath",{id:q,children:g.jsx("path",{d:`M${ae.map(({x:se,y:xe})=>`${se/J},${xe/J}`).join("L")}Z`})})}),U&&L.push({zIndex:D,element:g.jsx("g",{transform:ee,opacity:R,clipPath:ne?`url(#${q})`:void 0,children:U},`fg_${z.id}`)}),X&&L.push({zIndex:N,element:g.jsx("g",{transform:ee,opacity:R,clipPath:ne?`url(#${q})`:void 0,children:X},`bg_${z.id}`)})}else L.push({zIndex:D,element:g.jsx(CR,{shape:z,util:B,component:Z5,className:"tl-shape",bbox:n,opacity:R},`fg_${z.id}`)}),B.backgroundComponent&&L.push({zIndex:N,element:g.jsx(CR,{shape:z,util:B,component:J5,className:"tl-shape tl-shape-background",bbox:n,opacity:R},`bg_${z.id}`)});return L}),w=(await Promise.all(T)).flat();lp.flushSync(()=>{f.update(M=>({...M,shapeElements:w.sort((R,D)=>R.zIndex-D.zIndex).map(({element:R})=>R),defsById:{...M.defsById,...E}}))})})()},[n,r,S,u,a,o,f]),I.useEffect(()=>{v!==null&&l()},[l,v]),g.jsx(LX,{editor:r,context:S,children:g.jsxs("svg",{preserveAspectRatio:e,direction:"ltr",width:n.width*t,height:n.height*t,viewBox:`${n.minX} ${n.minY} ${n.width} ${n.height}`,strokeLinecap:"round",strokeLinejoin:"round",style:{backgroundColor:s?o?p.solid:p.background:"transparent"},"data-color-mode":i?"dark":"light",className:`tl-container tl-theme__force-sRGB ${i?"tl-theme__dark":"tl-theme__light"}`,children:[g.jsx("defs",{children:Object.entries(m).map(([E,T])=>T.pending?null:g.jsx(I.Fragment,{children:T.element},E))}),v]})})}function CR({shape:r,util:e,className:t,component:n,bbox:s,opacity:o}){const i=ue(),a=Ne.Translate(-s.minX,-s.minY).multiply(i.getShapePageTransform(r.id)),l=i.getShapeGeometry(r.id).bounds,c=Math.max(l.width,1),u=Math.max(l.height,1);return g.jsx(m2,{fallback:()=>null,children:g.jsx("foreignObject",{x:s.minX,y:s.minY,width:s.w,height:s.h,className:"tl-shape-foreign-object",children:g.jsx("div",{className:t,"data-shape-type":r.type,style:{clipPath:i.getShapeClipPath(r.id),transform:a.toCssString(),width:c,height:u,opacity:o},children:g.jsx(n,{shape:r,util:e})})})})}let qX=1;async function YX(r,e,t={}){const n=KX(r,e,t);if(!n)return;const s=r.getContainer(),o=document.createElement("div");o.className="tldraw-svg-export",o.inert=!0,o.tabIndex=-1,Object.assign(o.style,{position:"absolute",top:"0px",left:"0px",width:n.width+"px",height:n.height+"px",pointerEvents:"none",opacity:0}),s.appendChild(o);const i=EO.createRoot(o,{identifierPrefix:`export_${qX++}_`});try{await Promise.resolve(),lp.flushSync(()=>{i.render(n.jsx)}),await n.exportDelay.resolve();const a=o.firstElementChild;return fn(a instanceof SVGSVGElement,"Expected an SVG element"),await XX(a),{svg:a,width:n.width,height:n.height}}finally{setTimeout(()=>{i.unmount(),s.removeChild(o)},0)}}async function XX(r){const e=[...r.querySelectorAll("foreignObject.tl-shape-foreign-object > *")];if(!e.length)return;const t=new _X(r);try{t.fonts.startFindingCurrentDocumentFontFaces(),await Promise.all(e.map(o=>DL(o)));for(const o of e)t.readRootElementStyles(o);await t.fetchResources();const n=await t.getFontFaceCss();t.unwrapCustomElements();const s=t.embedStyles();if(n||s){const o=document.createElementNS("http://www.w3.org/2000/svg","style");o.textContent=`${n}
${s}`,r.prepend(o)}}finally{t.dispose()}}const ra={menus:$r("open menus",[]),getOpenMenus(r){return r?this.menus.get().filter(e=>e.endsWith("-"+r)):this.menus.get()},addOpenMenu(r,e=""){const t=e?`${r}-${e}`:r,n=new Set(this.menus.get());n.has(t)||(n.add(t),this.menus.set([...n]))},deleteOpenMenu(r,e=""){const t=e?`${r}-${e}`:r,n=new Set(this.menus.get());n.has(t)&&(n.delete(t),this.menus.set([...n]))},clearOpenMenus(r){this.menus.set(r?this.menus.get().filter(e=>!e.endsWith("-"+r)):[])},_hiddenMenus:[],hideOpenMenus(r){if(this._hiddenMenus=[...this.getOpenMenus(r)],this._hiddenMenus.length!==0)for(const e of this._hiddenMenus)this.deleteOpenMenu(e,r)},showOpenMenus(r){if(this._hiddenMenus.length!==0){for(const e of this._hiddenMenus)this.addOpenMenu(e,r);this._hiddenMenus=[]}},isMenuOpen(r,e){return this.getOpenMenus(e).includes(r)},hasOpenMenus(r){return this.getOpenMenus(r).length>0},hasAnyOpenMenus(){return this.getOpenMenus().length>0},forContext(r){return{getOpenMenus:()=>this.getOpenMenus(r),addOpenMenu:e=>this.addOpenMenu(e,r),deleteOpenMenu:e=>this.deleteOpenMenu(e,r),clearOpenMenus:()=>this.clearOpenMenus(r),isMenuOpen:e=>this.isMenuOpen(e,r),hasOpenMenus:()=>this.hasOpenMenus(r),hasAnyOpenMenus:()=>this.hasAnyOpenMenus()}}},IE=new iG,ZX={maxShapesPerPage:4e3,maxFilesAtOnce:100,maxPages:40,animationMediumMs:320,followChaseViewportSnap:2,doubleClickDurationMs:450,multiClickDurationMs:200,coarseDragDistanceSquared:36,dragDistanceSquared:16,defaultSvgPadding:32,cameraSlideFriction:.09,maxPointsPerDrawShape:500,gridSteps:[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],collaboratorInactiveTimeoutMs:6e4,collaboratorIdleTimeoutMs:3e3,collaboratorCheckIntervalMs:1200,cameraMovingTimeoutMs:64,hitTestMargin:8,edgeScrollDelay:200,edgeScrollEaseDuration:200,edgeScrollSpeed:25,edgeScrollDistance:8,coarsePointerWidth:12,coarseHandleRadius:20,handleRadius:12,longPressDurationMs:500,textShadowLod:.35,adjacentShapeMargin:10,flattenImageBoundsExpand:64,flattenImageBoundsPadding:16,laserDelayMs:1200,maxExportDelayMs:5e3,temporaryAssetPreviewLifetimeMs:18e4,actionShortcutsLocation:"swap",createTextOnCanvasDoubleClick:!0,exportProvider:I.Fragment};function ER(r,e){if(!e)return!1;switch(r.type){case"mixed":return e.type==="mixed";case"shared":return e.type==="shared"&&r.value===e.value;default:throw rs(r)}}class JX{constructor(e){k(this,"map");this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){const t=this.get(e);if(t&&t.type!=="mixed")return t.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;const t=new Set;for(const[n,s]of this){if(!ER(s,e.get(n)))return!1;t.add(n)}for(const[n,s]of e)if(!t.has(n)&&!ER(s,this.get(n)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class _E extends JX{set(e,t){this.map.set(e,t)}applyValue(e,t){const n=this.get(e);if(!n){this.set(e,{type:"shared",value:t});return}switch(n.type){case"mixed":return;case"shared":n.value!==t&&this.set(e,{type:"mixed"});return;default:rs(n,"type")}}}function QX(r,e,t){return al(r).then(function(n){return n.arrayBuffer()}).then(function(n){return new File([n],e,{type:t})})}const eZ="https://cdn.tldraw.com";function Yc(){return`${eZ}/${M5}`}function tZ(r){switch(r.type){case"shapes":return`s${r.shapeIds.map(t=>eC(t.slice(6))).join(".")}`;case"page":return"p"+eC(ui.parseId(r.pageId));case"viewport":{const{bounds:e,pageId:t}=r;let n=`v${Math.round(e.x)}.${Math.round(e.y)}.${Math.round(e.w)}.${Math.round(e.h)}`;return t&&(n+="."+eC(ui.parseId(t))),n}default:rs(r)}}function nZ(r){switch(r[0]){case"s":return{type:"shapes",shapeIds:r.slice(1).split(".").filter(Boolean).map(n=>vn(decodeURIComponent(n)))};case"p":return{type:"page",pageId:ui.createId(decodeURIComponent(r.slice(1)))};case"v":{const[t,n,s,o,i]=r.slice(1).split(".");return{type:"viewport",bounds:new Ve(Number(t),Number(n),Number(s),Number(o)),pageId:i?ui.createId(decodeURIComponent(i)):void 0}}default:throw Error("Invalid deep link string")}}function eC(r){return encodeURIComponent(r).replace(/\./g,"%2E")}function rZ(r,e){var s;let t=r;const n=new Set(e);for(;n.has(t);)t=(s=/^.*(\d+)$/.exec(t))!=null&&s[1]?t.replace(/(\d+)(?=\D?)$/,o=>(+o+1).toString()):`${t} 1`;return t}function by(r,e,t,n){if(t.length===0)return[];const s=new Map;for(const i of kt(t.map(a=>r.getShape(a)))){const{parentId:a}=i;s.has(a)||s.set(a,{children:kt(r.getSortedChildIdsForParent(a).map(l=>r.getShape(l))),moving:new Set}),s.get(a).moving.add(i)}const o=[];switch(e){case"toBack":{s.forEach(({moving:i,children:a})=>sZ(i,a,o));break}case"toFront":{s.forEach(({moving:i,children:a})=>oZ(i,a,o));break}case"forward":{s.forEach(({moving:i,children:a})=>iZ(r,i,a,o,n));break}case"backward":{s.forEach(({moving:i,children:a})=>aZ(r,i,a,o,n));break}}return o}function sZ(r,e,t){const n=e.length;if(r.size===n)return;let s,o;for(let i=0;i<n;i++){const a=e[i];if(r.has(a))s=a.index,r.delete(a);else{o=a.index;break}}if(r.size!==0){const i=Uh(s,o,r.size);t.push(...Array.from(r.values()).sort(Hs).map((a,l)=>({...a,index:i[l]})))}}function oZ(r,e,t){const n=e.length;if(r.size===n)return;let s,o;for(let i=n-1;i>-1;i--){const a=e[i];if(r.has(a))o=a.index,r.delete(a);else{s=a.index;break}}if(r.size!==0){const i=Uh(s,o,r.size);t.push(...Array.from(r.values()).sort(Hs).map((a,l)=>({...a,index:i[l]})))}}function kR(r,e){const t=r.getShapeGeometry(e),n=r.getShapePageTransform(e);return!t||!n?null:n.applyToPoints(t.vertices)}function BL(r,e){const t=Array.from(e).map(s=>{const o=kR(r,s);return o?{shape:s,vertices:o}:null}).filter(Boolean);return s=>{const o=kR(r,s);return o?t.some(i=>A2(i.vertices,o)):!1}}function iZ(r,e,t,n,s){var l;const o=BL(r,e),i=t.length;if(e.size===i)return;let a={name:"skipping"};for(let c=0;c<i;c++){const u=e.has(t[c]);switch(a.name){case"skipping":{if(!u)continue;a={name:"selecting",selectIndex:c};break}case"selecting":{if(u||!(s!=null&&s.considerAllShapes)&&!o(t[c]))continue;const{selectIndex:p}=a;Uh(t[c].index,(l=t[c+1])==null?void 0:l.index,c-p).forEach((f,m)=>{const v=t[p+m];e.has(v)&&n.push({...v,index:f})}),a={name:"skipping"};break}}}}function aZ(r,e,t,n,s){var l;const o=BL(r,e),i=t.length;if(e.size===i)return;let a={name:"skipping"};for(let c=i-1;c>-1;c--){const u=e.has(t[c]);switch(a.name){case"skipping":{if(!u)continue;a={name:"selecting",selectIndex:c};break}case"selecting":{if(u||!(s!=null&&s.considerAllShapes)&&!o(t[c]))continue;Uh((l=t[c-1])==null?void 0:l.index,t[c].index,a.selectIndex-c).forEach((p,f)=>{const m=t[c+f+1];e.has(m)&&n.push({...m,index:p})}),a={name:"skipping"};break}}}}function UL({editor:r,ids:e}){const t=kt(e.map(i=>r.getShape(i))),n=r.getShapesSharedRotation(e),s=r.getShapesRotatedPageBounds(e);if(!s)return null;const o=s.center.clone().rotWith(s.point,n);return{pageCenter:o,initialCursorAngle:o.angle(r.inputs.originPagePoint),initialShapesRotation:n,shapeSnapshots:t.map(i=>({shape:i,initialPagePoint:r.getShapePageTransform(i.id).point()}))}}function Qy({delta:r,editor:e,snapshot:t,stage:n,centerOverride:s}){const{pageCenter:o,shapeSnapshots:i}=t;e.updateShapes(i.map(({shape:l,initialPagePoint:c})=>{const u=Oo(l.parentId)?e.getShapePageTransform(l.parentId):Ne.Identity(),p=P.RotWith(c,s??o,r),f=Ne.applyToPoint(Ne.Inverse(u),p),m=ru(l.rotation+r);return{id:l.id,type:l.type,x:f.x,y:f.y,rotation:m}}));const a=[];i.forEach(({shape:l})=>{var f,m,v;const c=e.getShape(l.id);if(!c)return;const u=e.getShapeUtil(l);if(n==="start"||n==="one-off"){const b=(f=u.onRotateStart)==null?void 0:f.call(u,l);b&&a.push(b)}const p=(m=u.onRotate)==null?void 0:m.call(u,l,c);if(p&&a.push(p),n==="end"||n==="one-off"){const b=(v=u.onRotateEnd)==null?void 0:v.call(u,l,c);b&&a.push(b)}}),a.length>0&&e.updateShapes(a)}const lZ=r=>{const{store:e}=r,t=e.query.filterHistory("binding"),n=e.query.records("binding");function s(){const o=n.get(),i=new Map;for(const a of o){const{fromId:l,toId:c}=a,u=i.get(l);u?u.push(a):i.set(l,[a]);const p=i.get(c);p?p.push(a):i.set(c,[a])}return i}return Ie("arrowBindingsIndex",(o,i)=>{if(tu(o))return s();const a=o,l=t.getDiffSince(i);if(l===oi)return s();let c;function u(m){c??(c=new Map(a));const v=c.get(m.fromId),b=v==null?void 0:v.filter(E=>E.id!==m.id);b!=null&&b.length?c.set(m.fromId,b):c.delete(m.fromId);const S=c.get(m.toId),C=S==null?void 0:S.filter(E=>E.id!==m.id);C!=null&&C.length?c.set(m.toId,C):c.delete(m.toId)}function p(m){c??(c=new Map(a));let v=c.get(m);return v?v===a.get(m)&&(v=v.slice(0),c.set(m,v)):(v=[],c.set(m,v)),v}function f(m){p(m.fromId).push(m),p(m.toId).push(m)}for(const m of l){for(const v of ir(m.added))f(v);for(const[v,b]of ir(m.updated))u(v),f(b);for(const v of ir(m.removed))u(v)}return c??a})};function cZ(r,e,t){const n=r.getShapeMaskedPageBounds(e);return n===void 0?!0:!t.includes(n)}const dZ=r=>{function e(t){const n=t.getCurrentPageShapeIds(),s=t.getViewportPageBounds(),o=new Set;return n.forEach(i=>{cZ(t,i,s)&&o.add(i)}),o}return Ie("getCulledShapes",t=>{if(tu(t))return e(r);const n=e(r);if(t.size!==n.size)return n;for(const s of t)if(!n.has(s))return n;return t})},uZ=r=>{const e=r.query.ids("shape"),t=r.query.filterHistory("shape");function n(){const s={},o=e.get(),i=Array(o.size);return o.forEach(a=>i.push(r.get(a))),i.sort(Hs),i.forEach(a=>{s[a.parentId]||(s[a.parentId]=[]),s[a.parentId].push(a.id)}),s}return Ie("parentsToChildrenWithIndexes",(s,o)=>{if(tu(s))return n();const i=t.getDiffSince(o);if(i===oi)return n();if(i.length===0)return s;let a=null;const l=p=>{a||(a={...s}),a[p]?a[p]===s[p]&&(a[p]=[...a[p]]):a[p]=[]},c=new Set;let u;for(let p=0,f=i.length;p<f;p++){u=i[p];for(const m of Object.values(u.added))yh(m)&&(l(m.parentId),a[m.parentId].push(m.id),c.add(a[m.parentId]));for(const[m,v]of Object.values(u.updated))if(yh(v)&&yh(m)){if(m.parentId!==v.parentId)l(m.parentId),l(v.parentId),a[m.parentId].splice(a[m.parentId].indexOf(v.id),1),a[v.parentId].push(v.id),c.add(a[v.parentId]);else if(m.index!==v.index){l(v.parentId);const b=a[v.parentId].indexOf(v.id);a[v.parentId][b]=v.id,c.add(a[v.parentId])}}for(const m of Object.values(u.removed))yh(m)&&(l(m.parentId),a[m.parentId].splice(a[m.parentId].indexOf(m.id),1))}for(const p of c){const f=kt(p.map(m=>r.get(m)));f.sort(Hs),p.splice(0,p.length,...f.map(m=>m.id))}return a??s})},tC=(r,e,t)=>{for(;!Po(t.parentId);){const n=r.get(t.parentId);if(!n)return!1;t=n}return t.parentId===e},hZ=(r,e)=>{const t=r.query.ids("shape");let n=null;function s(){const o=e();return n=o,new Set([...t.get()].filter(i=>tC(r,o,r.get(i))))}return Ie("_shapeIdsInCurrentPage",(o,i)=>{if(tu(o))return s();const a=e();if(a!==n)return s();const l=r.history.getDiffSince(i);if(l===oi)return s();const c=new qy(o);for(const p of l){for(const f of Object.values(p.added))yh(f)&&tC(r,a,f)&&c.add(f.id);for(const[f,m]of Object.values(p.updated))yh(m)&&(tC(r,a,m)?c.add(m.id):c.remove(m.id));for(const f of Object.keys(p.removed))Oo(f)&&c.remove(f)}const u=c.get();return u?pf(u.value,u.diff):o})};var pZ=Object.create,HL=Object.defineProperty,fZ=Object.getOwnPropertyDescriptor,gZ=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),GL=r=>{throw TypeError(r)},WL=(r,e,t)=>e in r?HL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,mZ=r=>[,,,pZ(null)],KL=["class","method","getter","setter","accessor","field","value","get","set"],VL=r=>r!==void 0&&typeof r!="function"?GL("Function expected"):r,yZ=(r,e,t,n,s)=>({kind:KL[r],name:e,metadata:n,addInitializer:o=>t._?GL("Already initialized"):s.push(VL(o||null))}),vZ=(r,e)=>WL(e,gZ("metadata"),r[3]),bZ=(r,e,t,n)=>{for(var s=0,o=r[e>>1],i=o&&o.length;s<i;s++)o[s].call(t);return n},qL=(r,e,t,n,s,o)=>{for(var i,a,l,c,u=e&7,p=!!(e&8),f=!!(e&16),m=2,v=KL[u+5],b=r[m]||(r[m]=[]),S=(s=s.prototype,fZ(s,t)),C=n.length-1;C>=0;C--)l=yZ(u,t,a={},r[3],b),l.static=p,l.private=f,c=l.access={has:E=>t in E},c.get=E=>E[t],i=(0,n[C])(S[v],l),a._=1,VL(i)&&(S[v]=i);return S&&HL(s,t,S),s},sh=(r,e,t)=>WL(r,typeof e!="symbol"?e+"":e,t),YL,XL,Wg;const SZ=40;XL=[Bo],YL=[Bo];class cb{constructor(e){this.editor=e,bZ(Wg,5,this),sh(this,"_clickId",""),sh(this,"_clickTimeout"),sh(this,"_clickScreenPoint"),sh(this,"_previousScreenPoint"),sh(this,"_clickState","idle"),sh(this,"lastPointerInfo",{})}_getClickTimeout(e,t=Cn()){this._clickId=t,clearTimeout(this._clickTimeout),this._clickTimeout=this.editor.timers.setTimeout(()=>{if(this._clickState===e&&this._clickId===t){switch(this._clickState){case"pendingTriple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break}case"pendingQuadruple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break}case"pendingOverflow":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"});break}}this._clickState="idle"}},e==="idle"||e==="pendingDouble"?this.editor.options.doubleClickDurationMs:this.editor.options.multiClickDurationMs)}get clickState(){return this._clickState}handlePointerEvent(e){switch(e.name){case"pointer_down":{if(!this._clickState)return e;switch(this._clickScreenPoint=P.From(e.point),this._previousScreenPoint&&P.Dist2(this._previousScreenPoint,this._clickScreenPoint)>SZ**2&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"idle":{this._clickState="pendingDouble";break}case"pendingOverflow":{this._clickState="overflow";break}}return this._clickTimeout=this._getClickTimeout(this._clickState),e}case"pointer_up":{if(!this._clickState)return e;switch(this._clickScreenPoint=P.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"}}return e}case"pointer_move":return this._clickState!=="idle"&&this._clickScreenPoint&&P.Dist2(this._clickScreenPoint,this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?this.editor.options.coarseDragDistanceSquared:this.editor.options.dragDistanceSquared)&&this.cancelDoubleClickTimeout(),e}return e}cancelDoubleClickTimeout(){this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"}}Wg=mZ();qL(Wg,1,"_getClickTimeout",XL,cb);qL(Wg,1,"cancelDoubleClickTimeout",YL,cb);vZ(Wg,cb);class xZ{constructor(e){k(this,"_isEdgeScrolling",!1);k(this,"_edgeScrollDuration",-1);this.editor=e}updateEdgeScrolling(e){const{editor:t}=this,n=this.getEdgeScroll();if(n.x===0&&n.y===0)this._isEdgeScrolling&&(this._isEdgeScrolling=!1,this._edgeScrollDuration=0);else if(this._isEdgeScrolling||(this._isEdgeScrolling=!0,this._edgeScrollDuration=0),this._edgeScrollDuration+=e,this._edgeScrollDuration>t.options.edgeScrollDelay){const s=t.options.edgeScrollEaseDuration>0?ss.easeInCubic(Math.min(1,this._edgeScrollDuration/(t.options.edgeScrollDelay+t.options.edgeScrollEaseDuration))):1;this.moveCameraWhenCloseToEdge({x:n.x*s,y:n.y*s})}}getEdgeProximityFactors(e,t,n,s,o){const{editor:i}=this,a=i.options.edgeScrollDistance,l=n?i.options.coarsePointerWidth:0,c=e-l,u=e+l,p=s?0:a,f=o?t:t-a;return c<p?Math.min(1,(p-c)/a):u>f?-Math.min(1,(u-f)/a):0}getEdgeScroll(){const{editor:e}=this,{inputs:{currentScreenPoint:{x:t,y:n}}}=e,s=e.getViewportScreenBounds(),{isCoarsePointer:o,insets:[i,a,l,c]}=e.getInstanceState(),u=this.getEdgeProximityFactors(t,s.w,o,c,a),p=this.getEdgeProximityFactors(n,s.h,o,i,l);return{x:u,y:p}}moveCameraWhenCloseToEdge(e){const{editor:t}=this;if(!t.inputs.isDragging||t.inputs.isPanning||t.getCameraOptions().isLocked||e.x===0&&e.y===0)return;const n=t.getViewportScreenBounds(),s=n.w<1e3?.612:1,o=n.h<1e3?.612:1,i=t.getZoomLevel(),a=t.user.getEdgeScrollSpeed()*t.options.edgeScrollSpeed,l=a*e.x*s/i,c=a*e.y*o/i,{x:u,y:p,z:f}=t.getCamera();t.setCamera(new P(u+l,p+c,f))}}class wZ{constructor(e,t){k(this,"disposeSideEffectListener");this.editor=e,this.disposeSideEffectListener=e.sideEffects.registerAfterChangeHandler("instance",(s,o)=>{s.isFocused!==o.isFocused&&this.updateContainerClass()});const n=e.getInstanceState().isFocused;t!==n&&e.updateInstanceState({isFocused:!!t}),this.updateContainerClass()}updateContainerClass(){const e=this.editor.getContainer();this.editor.getInstanceState().isFocused?e.classList.add("tl-container__focused"):e.classList.remove("tl-container__focused")}focus(){this.editor.getContainer().focus()}blur(){this.editor.complete(),this.editor.getContainer().blur()}dispose(){var e;(e=this.disposeSideEffectListener)==null||e.call(this)}}function tf(r){return EZ}class CZ{constructor(){k(this,"length",0);k(this,"head",null);k(this,"tail",this)}push(e){return new N2(e,this)}toArray(){return Gl}[Symbol.iterator](){return{next(){return{value:void 0,done:!0}}}}}const EZ=new CZ;class N2{constructor(e,t){k(this,"length");this.head=e,this.tail=t,this.length=t.length+1}push(e){return new N2(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(e.length){const t=e.head;return e=e.tail,{value:t,done:!1}}else return{value:void 0,done:!0}}}}}let kZ=class{constructor(e){k(this,"store");k(this,"dispose");k(this,"state","recording");k(this,"pendingDiff",new IZ);k(this,"stacks",$r("HistoryManager.stacks",{undos:tf(),redos:tf()},{isEqual:(e,t)=>e.undos===t.undos&&e.redos===t.redos}));k(this,"annotateError");k(this,"_isInBatch",!1);this.store=e.store,this.annotateError=e.annotateError??Nf,this.dispose=this.store.addHistoryInterceptor((t,n)=>{if(n==="user")switch(this.state){case"recording":this.pendingDiff.apply(t.changes),this.stacks.update(({undos:s})=>({undos:s,redos:tf()}));break;case"recordingPreserveRedoStack":this.pendingDiff.apply(t.changes);break;case"paused":break;default:rs(this.state)}})}flushPendingDiff(){if(this.pendingDiff.isEmpty())return;const e=this.pendingDiff.clear();this.stacks.update(({undos:t,redos:n})=>({undos:t.push({type:"diff",diff:e}),redos:n}))}getNumUndos(){return this.stacks.get().undos.length+(this.pendingDiff.isEmpty()?0:1)}getNumRedos(){return this.stacks.get().redos.length}batch(e,t){const n=this.state;n!=="paused"&&(t!=null&&t.history)&&(this.state=PZ[t.history]);try{if(this._isInBatch)return rl(e),this;this._isInBatch=!0;try{rl(e)}catch(s){throw this.annotateError(s),s}finally{this._isInBatch=!1}return this}finally{this.state=n}}_undo({pushToRedoStack:e,toMark:t=void 0}){var s;const n=this.state;this.state="paused";try{let{undos:o,redos:i}=this.stacks.get();const a=this.pendingDiff.clear(),l=B3(a),c=pE(a);e&&!l&&(i=i.push({type:"diff",diff:a}));let u=!1;if(l)for(;((s=o.head)==null?void 0:s.type)==="stop";){const p=o.head;if(o=o.tail,e&&(i=i.push(p)),p.id===t){u=!0;break}}if(!u)e:for(;o.head;){const p=o.head;switch(o=o.tail,e&&(i=i.push(p)),p.type){case"diff":If(c,[pE(p.diff)]);break;case"stop":if(!t)break e;if(p.id===t){u=!0;break e}break;default:rs(p)}}if(!u&&t)return this;this.store.applyDiff(c,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:o,redos:i})}finally{this.state=n}return this}undo(){return this._undo({pushToRedoStack:!0}),this}redo(){var t;const e=this.state;this.state="paused";try{this.flushPendingDiff();let{undos:n,redos:s}=this.stacks.get();if(s.length===0)return this;for(;((t=s.head)==null?void 0:t.type)==="stop";)n=n.push(s.head),s=s.tail;const o=zv();for(;s.head;){const i=s.head;if(n=n.push(i),s=s.tail,i.type==="diff")If(o,[i.diff]);else break}this.store.applyDiff(o,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:n,redos:s})}finally{this.state=e}return this}bail(){return this._undo({pushToRedoStack:!1}),this}bailToMark(e){return this._undo({pushToRedoStack:!1,toMark:e}),this}squashToMark(e){var o;let t=this.stacks.get().undos;const n=[];for(;t.head&&!(t.head.type==="stop"&&t.head.id===e);)t.head.type==="diff"&&n.push(t.head.diff),t=t.tail;if(!t.head||((o=t.head)==null?void 0:o.id)!==e)return console.error("Could not find mark to squash to: ",e),this;if(n.length===0)return this;const s=zv();return If(s,n.reverse()),this.stacks.update(({redos:i})=>({undos:t.push({type:"diff",diff:s}),redos:i})),this}_mark(e){rl(()=>{this.flushPendingDiff(),this.stacks.update(({undos:t,redos:n})=>({undos:t.push({type:"stop",id:e}),redos:n}))})}clear(){this.stacks.set({undos:tf(),redos:tf()}),this.pendingDiff.clear()}getMarkIdMatching(e){let t=this.stacks.get().undos;for(;t.head;){if(t.head.type==="stop"&&t.head.id.includes(e))return t.head.id;t=t.tail}return null}debug(){const{undos:e,redos:t}=this.stacks.get();return{undos:e.toArray(),redos:t.toArray(),pendingDiff:this.pendingDiff.debug(),state:this.state}}};const PZ={record:"recording","record-preserveRedoStack":"recordingPreserveRedoStack",ignore:"paused"};class IZ{constructor(){k(this,"diff",zv());k(this,"isEmptyAtom",$r("PendingDiff.isEmpty",!0))}clear(){const e=this.diff;return this.diff=zv(),this.isEmptyAtom.set(!0),e}isEmpty(){return this.isEmptyAtom.get()}apply(e){If(this.diff,[e]),this.isEmptyAtom.set(B3(this.diff))}debug(){return{diff:this.diff,isEmpty:this.isEmpty()}}}class _Z{constructor(e){k(this,"scribbleItems",new Map);k(this,"state","paused");this.editor=e}addScribble(e,t=Cn()){const n={id:t,scribble:{id:t,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:e.delay??0,prev:null,next:null};return this.scribbleItems.set(t,n),n}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear()}stop(e){const t=this.scribbleItems.get(e);if(!t)throw Error(`Scribble with id ${e} not found`);return t.delayRemaining=Math.min(t.delayRemaining,200),t.scribble.state="stopping",t}addPoint(e,t,n,s=.5){const o=this.scribbleItems.get(e);if(!o)throw Error(`Scribble with id ${e} not found`);const{prev:i}=o,a={x:t,y:n,z:s};return(!i||P.Dist(i,a)>=1)&&(o.next=a),o}tick(e){this.scribbleItems.size!==0&&this.editor.run(()=>{this.scribbleItems.forEach(t=>{if(t.scribble.state==="starting"){const{next:l,prev:c}=t;l&&l!==c&&(t.prev=l,t.scribble.points.push(l)),t.scribble.points.length>8&&(t.scribble.state="active");return}t.delayRemaining>0&&(t.delayRemaining=Math.max(0,t.delayRemaining-e)),t.timeoutMs+=e,t.timeoutMs>=16&&(t.timeoutMs=0);const{delayRemaining:n,timeoutMs:s,prev:o,next:i,scribble:a}=t;switch(a.state){case"active":{i&&i!==o?(t.prev=i,a.points.push(i),n===0&&a.points.length>8&&a.points.shift()):s===0&&(a.points.length>1?a.points.shift():t.delayRemaining=a.delay);break}case"stopping":{if(t.delayRemaining===0&&s===0){if(a.points.length===1){this.scribbleItems.delete(t.id);return}a.shrink&&(a.size=Math.max(1,a.size*(1-a.shrink))),a.points.shift()}break}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:t})=>({...t,points:[...t.points]})).slice(-5)})})}}var TZ=Object.create,ZL=Object.defineProperty,MZ=Object.getOwnPropertyDescriptor,AZ=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),JL=r=>{throw TypeError(r)},QL=(r,e,t)=>e in r?ZL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,jZ=r=>[,,,TZ(null)],e4=["class","method","getter","setter","accessor","field","value","get","set"],t4=r=>r!==void 0&&typeof r!="function"?JL("Function expected"):r,RZ=(r,e,t,n,s)=>({kind:e4[r],name:e,metadata:n,addInitializer:o=>t._?JL("Already initialized"):s.push(t4(o||null))}),DZ=(r,e)=>QL(e,AZ("metadata"),r[3]),OZ=(r,e,t,n)=>{for(var s=0,o=r[e>>1],i=o&&o.length;s<i;s++)o[s].call(t);return n},db=(r,e,t,n,s,o)=>{for(var i,a,l,c,u=e&7,p=!!(e&8),f=!!(e&16),m=2,v=e4[u+5],b=r[m]||(r[m]=[]),S=(s=s.prototype,MZ(s,t)),C=n.length-1;C>=0;C--)l=RZ(u,t,a={},r[3],b),l.static=p,l.private=f,c=l.access={has:E=>t in E},c.get=E=>E[t],i=(0,n[C])(S[v],l),a._=1,t4(i)&&(S[v]=i);return S&&ZL(s,t,S),s},LZ=(r,e,t)=>QL(r,e+"",t),n4,r4,s4,o4,Eu;const mt=r=>Math.round(r*10**8)/10**8;function Dl(r,e,t,n,s){const o=r.filter(a=>(n==="forward"?a.startNode.id===e:a.endNode.id===e)&&mt(a.length)===mt(t)&&na(a.breadthIntersection[0],a.breadthIntersection[1],s[0],s[1]));if(o.length===0)return[];const i=new Set;return o.forEach(a=>{const l=n==="forward"?a.endNode.id:a.startNode.id;if(!i.has(l)){i.add(l);const c=Dl(r,l,t,n,na(a.breadthIntersection[0],a.breadthIntersection[1],s[0],s[1]));o.push(...c)}}),o}function NZ(r){r.sort((e,t)=>t.gaps.length-e.gaps.length);for(let e=r.length-1;e>0;e--){const t=r[e];for(let n=e-1;n>=0;n--){const s=r[n];if(s.direction===t.direction&&t.gaps.every(o=>s.gaps.some(i=>mt(o.startEdge[0].x)===mt(i.startEdge[0].x)&&mt(o.startEdge[0].y)===mt(i.startEdge[0].y)&&mt(o.startEdge[1].x)===mt(i.startEdge[1].x)&&mt(o.startEdge[1].y)===mt(i.startEdge[1].y))&&s.gaps.some(i=>mt(o.endEdge[0].x)===mt(i.endEdge[0].x)&&mt(o.endEdge[0].y)===mt(i.endEdge[0].y)&&mt(o.endEdge[1].x)===mt(i.endEdge[1].x)&&mt(o.endEdge[1].y)===mt(i.endEdge[1].y)))){r.splice(e,1);break}}}}o4=[Ie],s4=[Ie],r4=[Ie],n4=[Ie];class cp{constructor(e){this.manager=e,OZ(Eu,5,this),LZ(this,"editor"),this.editor=e.editor}getSnapPointsCache(){const{editor:e}=this;return e.store.createComputedCache("snapPoints",t=>{const n=e.getShapePageTransform(t.id);if(!n)return;const o=e.getShapeUtil(t).getBoundsSnapGeometry(t).points??e.getShapeGeometry(t).bounds.cornersAndCenter;if(!(!n||!o))return o.map((i,a)=>{const{x:l,y:c}=Ne.applyToPoint(n,i);return{x:l,y:c,id:`${t.id}:${a}`}})})}getSnapPoints(e){return this.getSnapPointsCache().get(e)??[]}getSnappablePoints(){const e=this.getSnapPointsCache(),t=this.manager.getSnappableShapes(),n=[];for(const s of t){const o=e.get(s);o&&n.push(...o)}return n}getSnappableGapNodes(){return Array.from(this.manager.getSnappableShapes(),e=>({id:e,pageBounds:Lo(this.editor.getShapePageBounds(e))}))}getVisibleGaps(){const e=[],t=[];let n,s;const o=this.getSnappableGapNodes().sort((a,l)=>a.pageBounds.minX-l.pageBounds.minX);for(let a=0;a<o.length;a++){n=o[a];for(let l=a+1;l<o.length;l++)s=o[l],n.pageBounds.maxX<s.pageBounds.minX&&ef(n.pageBounds.minY,n.pageBounds.maxY,s.pageBounds.minY,s.pageBounds.maxY)&&e.push({startNode:n,endNode:s,startEdge:[new P(n.pageBounds.maxX,n.pageBounds.minY),new P(n.pageBounds.maxX,n.pageBounds.maxY)],endEdge:[new P(s.pageBounds.minX,s.pageBounds.minY),new P(s.pageBounds.minX,s.pageBounds.maxY)],length:s.pageBounds.minX-n.pageBounds.maxX,breadthIntersection:na(n.pageBounds.minY,n.pageBounds.maxY,s.pageBounds.minY,s.pageBounds.maxY)})}const i=o.sort((a,l)=>a.pageBounds.minY-l.pageBounds.minY);for(let a=0;a<i.length;a++){n=i[a];for(let l=a+1;l<i.length;l++)s=i[l],n.pageBounds.maxY<s.pageBounds.minY&&ef(n.pageBounds.minX,n.pageBounds.maxX,s.pageBounds.minX,s.pageBounds.maxX)&&t.push({startNode:n,endNode:s,startEdge:[new P(n.pageBounds.minX,n.pageBounds.maxY),new P(n.pageBounds.maxX,n.pageBounds.maxY)],endEdge:[new P(s.pageBounds.minX,s.pageBounds.minY),new P(s.pageBounds.maxX,s.pageBounds.minY)],length:s.pageBounds.minY-n.pageBounds.maxY,breadthIntersection:na(n.pageBounds.minX,n.pageBounds.maxX,s.pageBounds.minX,s.pageBounds.maxX)})}return{horizontal:e,vertical:t}}snapTranslateShapes({lockedAxis:e,initialSelectionPageBounds:t,initialSelectionSnapPoints:n,dragDelta:s}){var S,C;const o=this.manager.getSnapThreshold(),i=this.getSnappablePoints(),a=t.clone().translate(s),l=n.map(({x:E,y:T},w)=>({id:"selection:"+w,x:E+s.x,y:T+s.y})),c=i,u=[],p=[],f=new P(o,o);this.collectPointSnaps({minOffset:f,nearestSnapsX:u,nearestSnapsY:p,otherNodeSnapPoints:c,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:p,minOffset:f});const m=new P(e==="x"?0:((S=u[0])==null?void 0:S.nudge)??0,e==="y"?0:((C=p[0])==null?void 0:C.nudge)??0);f.x=0,f.y=0,u.length=0,p.length=0,l.forEach(E=>{E.x+=m.x,E.y+=m.y}),a.translate(m),this.collectPointSnaps({minOffset:f,nearestSnapsX:u,nearestSnapsY:p,otherNodeSnapPoints:c,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:p,minOffset:f});const v=this.getPointSnapLines({nearestSnapsX:u,nearestSnapsY:p}),b=this.getGapSnapLines({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:p});return this.manager.setIndicators([...b,...v]),{nudge:m}}snapResizeShapes({initialSelectionPageBounds:e,dragDelta:t,handle:n,isAspectRatioLocked:s,isResizingFromCenter:o}){var D,N;const i=this.manager.getSnapThreshold(),{box:a,scaleX:l,scaleY:c}=Ve.Resize(e,n,o?t.x*2:t.x,o?t.y*2:t.y,s);let u=n;l<0&&(u=Gq(u)),c<0&&(u=Hq(u)),o&&(a.center=e.center);const p=u==="top"||u==="bottom",f=u==="left"||u==="right",m=PR(u,a),v=this.getSnappablePoints(),b=[],S=[],C=new P(i,i);this.collectPointSnaps({minOffset:C,nearestSnapsX:b,nearestSnapsY:S,otherNodeSnapPoints:v,selectionSnapPoints:m});const E=new P(p?0:((D=b[0])==null?void 0:D.nudge)??0,f?0:((N=S[0])==null?void 0:N.nudge)??0);if(s&&Wq(u)&&E.len()!==0){const z=b.length&&S.length?Math.abs(E.x)<Math.abs(E.y)?"x":"y":b.length?"x":"y",L=e.aspectRatio;z==="x"?(S.length=0,E.y=E.x/L,(u==="bottom_left"||u==="top_right")&&(E.y=-E.y)):(b.length=0,E.x=E.y*L,(u==="bottom_left"||u==="top_right")&&(E.x=-E.x))}const T=P.Add(t,E),{box:w}=Ve.Resize(e,n,o?T.x*2:T.x,o?T.y*2:T.y,s);o&&(w.center=e.center);const M=PR("any",w);b.length=0,S.length=0,C.x=0,C.y=0,this.collectPointSnaps({minOffset:C,nearestSnapsX:b,nearestSnapsY:S,otherNodeSnapPoints:v,selectionSnapPoints:M});const R=this.getPointSnapLines({nearestSnapsX:b,nearestSnapsY:S});return this.manager.setIndicators([...R]),{nudge:E}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:t,minOffset:n,nearestSnapsX:s,nearestSnapsY:o}){for(const i of e)for(const a of t){const l=P.Sub(i,a),c=Math.abs(l.x),u=Math.abs(l.y);mt(c)<=mt(n.x)&&(mt(c)<mt(n.x)&&(s.length=0),s.push({type:"points",points:{thisPoint:i,otherPoint:a},nudge:a.x-i.x}),n.x=c),mt(u)<=mt(n.y)&&(mt(u)<mt(n.y)&&(o.length=0),o.push({type:"points",points:{thisPoint:i,otherPoint:a},nudge:a.y-i.y}),n.y=u)}}collectGapSnaps({selectionPageBounds:e,minOffset:t,nearestSnapsX:n,nearestSnapsY:s}){const{horizontal:o,vertical:i}=this.getVisibleGaps();for(const a of o){if(!ef(a.breadthIntersection[0],a.breadthIntersection[1],e.minY,e.maxY))continue;const c=a.startEdge[0].x+a.length/2-e.center.x;if(a.length>e.width&&mt(Math.abs(c))<=mt(t.x)){mt(Math.abs(c))<mt(t.x)&&(n.length=0),t.x=Math.abs(c);const C={type:"gap_center",gap:a,nudge:c},E=n.find(({type:w})=>w==="gap_center"),T=E&&na(a.breadthIntersection[0],a.breadthIntersection[1],E.gap.breadthIntersection[0],E.gap.breadthIntersection[1]);E&&E.gap.length>a.length&&T?n[n.indexOf(E)]=C:(!E||!T)&&n.push(C)}const p=a.startNode.pageBounds.minX-a.length,f=e.maxX,m=p-f;mt(Math.abs(m))<=mt(t.x)&&(mt(Math.abs(m))<mt(t.x)&&(n.length=0),t.x=Math.abs(m),n.push({type:"gap_duplicate",gap:a,protrusionDirection:"left",nudge:m}));const v=a.endNode.pageBounds.maxX+a.length,b=e.minX,S=v-b;mt(Math.abs(S))<=mt(t.x)&&(mt(Math.abs(S))<mt(t.x)&&(n.length=0),t.x=Math.abs(S),n.push({type:"gap_duplicate",gap:a,protrusionDirection:"right",nudge:S}))}for(const a of i){if(!ef(a.breadthIntersection[0],a.breadthIntersection[1],e.minX,e.maxX))continue;const c=a.startEdge[0].y+a.length/2-e.center.y;if(a.length>e.height&&mt(Math.abs(c))<=mt(t.y)){mt(Math.abs(c))<mt(t.y)&&(s.length=0),t.y=Math.abs(c);const C={type:"gap_center",gap:a,nudge:c},E=s.find(({type:w})=>w==="gap_center"),T=E&&ef(E.gap.breadthIntersection[0],E.gap.breadthIntersection[1],a.breadthIntersection[0],a.breadthIntersection[1]);E&&E.gap.length>a.length&&T?s[s.indexOf(E)]=C:(!E||!T)&&s.push(C);continue}const p=a.startNode.pageBounds.minY-a.length,f=e.maxY,m=p-f;mt(Math.abs(m))<=mt(t.y)&&(mt(Math.abs(m))<mt(t.y)&&(s.length=0),t.y=Math.abs(m),s.push({type:"gap_duplicate",gap:a,protrusionDirection:"top",nudge:m}));const v=a.endNode.pageBounds.maxY+a.length,b=e.minY,S=v-b;mt(Math.abs(S))<=mt(t.y)&&(mt(Math.abs(S))<mt(t.y)&&(s.length=0),t.y=Math.abs(S),s.push({type:"gap_duplicate",gap:a,protrusionDirection:"bottom",nudge:S}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:t}){const n={},s={};if(e.length>0){for(const o of e)if(o.type==="points"){const i=mt(o.points.otherPoint.x);n[i]||(n[i]=[]),n[i].push(o.points)}}if(t.length>0){for(const o of t)if(o.type==="points"){const i=mt(o.points.otherPoint.y);s[i]||(s[i]=[]),s[i].push(o.points)}}return Object.values(n).concat(Object.values(s)).map(o=>({id:Cn(),type:"points",points:Dk(o.map(i=>P.From(i.otherPoint)).concat(o.map(i=>P.From(i.thisPoint))),(i,a)=>i.equals(a))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:t,nearestSnapsY:n}){const{vertical:s,horizontal:o}=this.getVisibleGaps(),i={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},a=[];if(t.length>0)for(const l of t){if(l.type==="points")continue;const{gap:{breadthIntersection:c,startEdge:u,startNode:p,endNode:f,length:m,endEdge:v}}=l;switch(l.type){case"gap_center":{const b=(m-e.width)/2,S=na(c[0],c[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:Cn(),gaps:[...Dl(o,p.id,b,"backward",S),{startEdge:u,endEdge:i.left},{startEdge:i.right,endEdge:v},...Dl(o,f.id,b,"forward",S)]});break}case"gap_duplicate":{const b=na(c[0],c[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:Cn(),gaps:l.protrusionDirection==="left"?[{startEdge:i.right,endEdge:u.map(S=>S.clone().addXY(-p.pageBounds.width,0))},{startEdge:u,endEdge:v},...Dl(o,f.id,m,"forward",b)]:[...Dl(o,p.id,m,"backward",b),{startEdge:u,endEdge:v},{startEdge:v.map(S=>S.clone().addXY(l.gap.endNode.pageBounds.width,0)),endEdge:i.left}]});break}}}if(n.length>0)for(const l of n){if(l.type==="points")continue;const{gap:{breadthIntersection:c,startEdge:u,startNode:p,endNode:f,length:m,endEdge:v}}=l;switch(l.type){case"gap_center":{const b=(m-e.height)/2,S=na(c[0],c[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:Cn(),gaps:[...Dl(s,p.id,b,"backward",S),{startEdge:u,endEdge:i.top},{startEdge:i.bottom,endEdge:v},...Dl(s,l.gap.endNode.id,b,"forward",S)]});break}case"gap_duplicate":{const b=na(c[0],c[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:Cn(),gaps:l.protrusionDirection==="top"?[{startEdge:i.bottom,endEdge:u.map(S=>S.clone().addXY(0,-p.pageBounds.height))},{startEdge:u,endEdge:v},...Dl(s,f.id,m,"forward",b)]:[...Dl(s,p.id,m,"backward",b),{startEdge:u,endEdge:v},{startEdge:v.map(S=>S.clone().addXY(0,f.pageBounds.height)),endEdge:i.top}]})}break}}return NZ(a),a}}Eu=jZ();db(Eu,1,"getSnapPointsCache",o4,cp);db(Eu,1,"getSnappablePoints",s4,cp);db(Eu,1,"getSnappableGapNodes",r4,cp);db(Eu,1,"getVisibleGaps",n4,cp);DZ(Eu,cp);function PR(r,e){const{minX:t,maxX:n,minY:s,maxY:o}=e,i=[];switch(r){case"top":case"left":case"top_left":case"any":i.push({id:"top_left",handle:"top_left",x:t,y:s})}switch(r){case"top":case"right":case"top_right":case"any":i.push({id:"top_right",handle:"top_right",x:n,y:s})}switch(r){case"bottom":case"right":case"bottom_right":case"any":i.push({id:"bottom_right",handle:"bottom_right",x:n,y:o})}switch(r){case"bottom":case"left":case"bottom_left":case"any":i.push({id:"bottom_left",handle:"bottom_left",x:t,y:o})}return i}var FZ=Object.create,i4=Object.defineProperty,zZ=Object.getOwnPropertyDescriptor,$Z=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),a4=r=>{throw TypeError(r)},l4=(r,e,t)=>e in r?i4(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,BZ=r=>[,,,FZ(null)],c4=["class","method","getter","setter","accessor","field","value","get","set"],d4=r=>r!==void 0&&typeof r!="function"?a4("Function expected"):r,UZ=(r,e,t,n,s)=>({kind:c4[r],name:e,metadata:n,addInitializer:o=>t._?a4("Already initialized"):s.push(d4(o||null))}),HZ=(r,e)=>l4(e,$Z("metadata"),r[3]),GZ=(r,e,t,n)=>{for(var s=0,o=r[e>>1],i=o&&o.length;s<i;s++)o[s].call(t);return n},WZ=(r,e,t,n,s,o)=>{for(var i,a,l,c,u=e&7,p=!!(e&8),f=!!(e&16),m=2,v=c4[u+5],b=r[m]||(r[m]=[]),S=(s=s.prototype,zZ(s,t)),C=n.length-1;C>=0;C--)l=UZ(u,t,a={},r[3],b),l.static=p,l.private=f,c=l.access={has:E=>t in E},c.get=E=>E[t],i=(0,n[C])(S[v],l),a._=1,d4(i)&&(S[v]=i);return S&&i4(s,t,S),s},KZ=(r,e,t)=>l4(r,e+"",t),u4,ub;const VZ=()=>null,qZ=()=>[];u4=[Ie];class F2{constructor(e){this.manager=e,GZ(ub,5,this),KZ(this,"editor"),this.editor=e.editor}getSnapGeometryCache(){const{editor:e}=this;return e.store.createComputedCache("handle snap geometry",t=>{const n=e.getShapeUtil(t).getHandleSnapGeometry(t),s=n.getSelfSnapOutline?n.getSelfSnapOutline.bind(n):VZ,o=n.getSelfSnapPoints?n.getSelfSnapPoints.bind(n):qZ;return{outline:n.outline===void 0?e.getShapeGeometry(t):n.outline,points:n.points??[],getSelfSnapOutline:s,getSelfSnapPoints:o}})}*iterateSnapPointsInPageSpace(e,t){var s,o;const n=(s=this.getSnapGeometryCache().get(e))==null?void 0:s.getSelfSnapPoints(t);if(n&&n.length){const i=Lo(this.editor.getShapePageTransform(e));for(const a of n)yield i.applyToPoint(a)}for(const i of this.manager.getSnappableShapes()){if(i===e)continue;const a=(o=this.getSnapGeometryCache().get(i))==null?void 0:o.points;if(!a||!a.length)continue;const l=Lo(this.editor.getShapePageTransform(i));for(const c of a)yield l.applyToPoint(c)}}*iterateSnapOutlines(e,t){var s,o;const n=(s=this.getSnapGeometryCache().get(e))==null?void 0:s.getSelfSnapOutline(t);n&&(yield{shapeId:e,outline:n});for(const i of this.manager.getSnappableShapes()){if(i===e)continue;const a=(o=this.getSnapGeometryCache().get(i))==null?void 0:o.outline;a&&(yield{shapeId:i,outline:a})}}getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:n}){const s=this.manager.getSnapThreshold();let o=s,i=null;for(const c of this.iterateSnapPointsInPageSpace(e,t))P.DistMin(n,c,o)&&(o=P.Dist(n,c),i=c);if(i)return i;let a=s,l=null;for(const{shapeId:c,outline:u}of this.iterateSnapOutlines(e,t)){const p=Lo(this.editor.getShapePageTransform(c)),f=this.editor.getPointInShapeSpace(c,n),m=u.nearestPoint(f),v=p.applyToPoint(m);P.DistMin(n,v,a)&&(a=P.Dist(n,v),l=v)}return l||null}snapHandle({currentShapeId:e,handle:t}){const s=Lo(this.editor.getShapePageTransform(e)).applyToPoint(t),o=this.getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:s});return o?(this.manager.setIndicators([{id:Cn(),type:"points",points:[o]}]),{nudge:P.Sub(o,s)}):null}}ub=BZ();WZ(ub,1,"getSnapGeometryCache",u4,F2);HZ(ub,F2);var YZ=Object.create,h4=Object.defineProperty,XZ=Object.getOwnPropertyDescriptor,ZZ=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),p4=r=>{throw TypeError(r)},f4=(r,e,t)=>e in r?h4(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,JZ=r=>[,,,YZ(null)],g4=["class","method","getter","setter","accessor","field","value","get","set"],m4=r=>r!==void 0&&typeof r!="function"?p4("Function expected"):r,QZ=(r,e,t,n,s)=>({kind:g4[r],name:e,metadata:n,addInitializer:o=>t._?p4("Already initialized"):s.push(m4(o||null))}),eJ=(r,e)=>f4(e,ZZ("metadata"),r[3]),tJ=(r,e,t,n)=>{for(var s=0,o=r[e>>1],i=o&&o.length;s<i;s++)o[s].call(t);return n},z2=(r,e,t,n,s,o)=>{for(var i,a,l,c,u=e&7,p=!!(e&8),f=!!(e&16),m=2,v=g4[u+5],b=r[m]||(r[m]=[]),S=(s=s.prototype,XZ(s,t)),C=n.length-1;C>=0;C--)l=QZ(u,t,a={},r[3],b),l.static=p,l.private=f,c=l.access={has:E=>t in E},c.get=E=>E[t],i=(0,n[C])(S[v],l),a._=1,m4(i)&&(S[v]=i);return S&&h4(s,t,S),s},nC=(r,e,t)=>f4(r,typeof e!="symbol"?e+"":e,t),y4,v4,b4,dp;b4=[Ie],v4=[Ie],y4=[Ie];class Kg{constructor(e){this.editor=e,tJ(dp,5,this),nC(this,"shapeBounds"),nC(this,"handles"),nC(this,"_snapIndicators",$r("snapLines",void 0)),this.shapeBounds=new cp(this),this.handles=new F2(this)}getIndicators(){return this._snapIndicators.get()??Gl}clearIndicators(){this.getIndicators().length&&this._snapIndicators.set(void 0)}setIndicators(e){this._snapIndicators.set(e)}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){const{editor:e}=this,t=e.getViewportPageBounds(),n=e.getSelectedShapeIds(),s=new Set,o=i=>{if(Oo(i)){const l=e.getShape(i);l&&e.isShapeOfType(l,"frame")&&s.add(i)}const a=e.getSortedChildIdsForParent(i);for(const l of a){if(n.includes(l))continue;const c=e.getShape(l);if(!c||!e.getShapeUtil(c).canSnap(c))continue;const p=e.getShapePageBounds(l);if(p&&t.includes(p)){if(e.isShapeOfType(c,"group")){o(l);continue}s.add(l)}}};return o(this.getCurrentCommonAncestor()??e.getCurrentPageId()),s}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}}dp=JZ();z2(dp,1,"getSnapThreshold",b4,Kg);z2(dp,1,"getSnappableShapes",v4,Kg);z2(dp,1,"getCurrentCommonAncestor",y4,Kg);eJ(dp,Kg);const nJ=/\r?\n|\r/g;function IR(r){return r.replace(nJ,`
`).split(`
`).map(e=>e||" ").join(`
`)}const rJ={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},sJ=/\s/;class oJ{constructor(e){k(this,"baseElem");this.editor=e,this.baseElem=document.createElement("div"),this.baseElem.classList.add("tl-text"),this.baseElem.classList.add("tl-text-measure"),this.baseElem.tabIndex=-1}measureText(e,t){const n=this.baseElem.cloneNode();this.editor.getContainer().appendChild(n),n.setAttribute("dir","auto"),n.style.setProperty("unicode-bidi","plaintext"),n.style.setProperty("font-family",t.fontFamily),n.style.setProperty("font-style",t.fontStyle),n.style.setProperty("font-weight",t.fontWeight),n.style.setProperty("font-size",t.fontSize+"px"),n.style.setProperty("line-height",t.lineHeight*t.fontSize+"px"),n.style.setProperty("max-width",t.maxWidth===null?null:t.maxWidth+"px"),n.style.setProperty("min-width",t.minWidth===null?null:t.minWidth+"px"),n.style.setProperty("padding",t.padding),n.style.setProperty("overflow-wrap",t.disableOverflowWrapBreaking?"normal":"break-word"),n.textContent=IR(e);const s=n.scrollWidth,o=n.getBoundingClientRect();return n.remove(),{x:0,y:0,w:o.width,h:o.height,scrollWidth:s}}measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:t=!1}={}){const n=[],s=e.getBoundingClientRect(),o=-s.left,i=-s.top,a=new Range,l=e.childNodes[0];let c=0,u=null,p=null,f=0,m=0,v=!1;for(const b of e.childNodes)if(b.nodeType===Node.TEXT_NODE)for(const S of b.textContent??""){a.setStart(l,c),a.setEnd(l,c+S.length);const C=a.getClientRects(),E=C[C.length-1],T=E.top+i,w=E.left+o,M=E.right+o,R=w<m,D=sJ.test(S);if(D!==p||T!==f||!u){if(u){if(t&&T!==f){v=!0;break}n.push(u)}u={box:{x:w,y:T,w:E.width,h:E.height},text:S},m=w}else R&&(u.box.x=w),u.box.w=R?u.box.w+E.width:M-u.box.x,u.text+=S;S===`
`&&(m=0),p=D,f=T,c+=S.length}return u&&n.push(u),{spans:n,didTruncate:v}}measureTextSpans(e,t){if(e==="")return[];const n=this.baseElem.cloneNode();this.editor.getContainer().appendChild(n);const s=Math.ceil(t.width-t.padding*2);n.setAttribute("dir","auto"),n.style.setProperty("unicode-bidi","plaintext"),n.style.setProperty("width",`${s}px`),n.style.setProperty("height","min-content"),n.style.setProperty("font-size",`${t.fontSize}px`),n.style.setProperty("font-family",t.fontFamily),n.style.setProperty("font-weight",t.fontWeight),n.style.setProperty("line-height",`${t.lineHeight*t.fontSize}px`),n.style.setProperty("text-align",rJ[t.textAlign]);const o=t.overflow==="truncate-ellipsis"||t.overflow==="truncate-clip";o&&(n.style.setProperty("overflow-wrap","anywhere"),n.style.setProperty("word-break","break-all"));const i=IR(e);n.textContent=i;const{spans:a,didTruncate:l}=this.measureElementTextNodeSpans(n,{shouldTruncateToFirstLine:o});if(t.overflow==="truncate-ellipsis"&&l){n.textContent="…";const c=Math.ceil(this.measureElementTextNodeSpans(n).spans[0].box.w);n.style.setProperty("width",`${s-c}px`),n.textContent=i;const u=this.measureElementTextNodeSpans(n,{shouldTruncateToFirstLine:!0}).spans,p=u[u.length-1];return u.push({text:"…",box:{x:Math.min(p.box.x+p.box.w,t.width-t.padding-c),y:p.box.y,w:c,h:p.box.h}}),u}return n.remove(),a}}var iJ=Object.create,S4=Object.defineProperty,aJ=Object.getOwnPropertyDescriptor,lJ=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),x4=r=>{throw TypeError(r)},w4=(r,e,t)=>e in r?S4(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,cJ=r=>[,,,iJ(null)],C4=["class","method","getter","setter","accessor","field","value","get","set"],E4=r=>r!==void 0&&typeof r!="function"?x4("Function expected"):r,dJ=(r,e,t,n,s)=>({kind:C4[r],name:e,metadata:n,addInitializer:o=>t._?x4("Already initialized"):s.push(E4(o||null))}),uJ=(r,e)=>w4(e,lJ("metadata"),r[3]),hJ=(r,e,t,n)=>{for(var s=0,o=r[e>>1],i=o&&o.length;s<i;s++)o[s].call(t);return n},k4=(r,e,t,n,s,o)=>{for(var i,a,l,c,u=e&7,p=!!(e&8),f=!!(e&16),m=2,v=C4[u+5],b=r[m]||(r[m]=[]),S=(s=s.prototype,aJ(s,t)),C=n.length-1;C>=0;C--)l=dJ(u,t,a={},r[3],b),l.static=p,l.private=f,c=l.access={has:E=>t in E},c.get=E=>E[t],i=(0,n[C])(S[v],l),a._=1,E4(i)&&(S[v]=i);return S&&S4(s,t,S),s},Sy=(r,e,t)=>w4(r,typeof e!="symbol"?e+"":e,t),P4,I4,Vg;const _R=(typeof process<"u",ZO);I4=[Bo],P4=[Bo];class hb{constructor(e){this.editor=e,hJ(Vg,5,this),Sy(this,"cancelRaf"),Sy(this,"isPaused",!0),Sy(this,"now",0),Sy(this,"prevPoint",new P),this.editor.disposables.add(this.dispose),this.start()}start(){var e;this.isPaused=!1,(e=this.cancelRaf)==null||e.call(this),this.cancelRaf=_R(this.tick),this.now=Date.now()}tick(){if(this.isPaused)return;const e=Date.now(),t=e-this.now;this.now=e,this.updatePointerVelocity(t),this.editor.emit("frame",t),this.editor.emit("tick",t),this.cancelRaf=_R(this.tick)}dispose(){var e;this.isPaused=!0,(e=this.cancelRaf)==null||e.call(this)}updatePointerVelocity(e){const{prevPoint:t,editor:{inputs:{currentScreenPoint:n,pointerVelocity:s}}}=this;if(e===0)return;const o=P.Sub(n,t);this.prevPoint=n.clone();const i=o.len(),a=i?o.div(i):new P(0,0),l=s.clone().lrp(a.mul(i/e),.5);Math.abs(l.x)<.01&&(l.x=0),Math.abs(l.y)<.01&&(l.y=0),s.equals(l)||(this.editor.inputs.pointerVelocity=l)}}Vg=cJ();k4(Vg,1,"tick",I4,hb);k4(Vg,1,"dispose",P4,hb);uJ(Vg,hb);var pJ=Object.create,_4=Object.defineProperty,fJ=Object.getOwnPropertyDescriptor,gJ=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),T4=r=>{throw TypeError(r)},M4=(r,e,t)=>e in r?_4(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,mJ=r=>[,,,pJ(null)],A4=["class","method","getter","setter","accessor","field","value","get","set"],j4=r=>r!==void 0&&typeof r!="function"?T4("Function expected"):r,yJ=(r,e,t,n,s)=>({kind:A4[r],name:e,metadata:n,addInitializer:o=>t._?T4("Already initialized"):s.push(j4(o||null))}),vJ=(r,e)=>M4(e,gJ("metadata"),r[3]),bJ=(r,e,t,n)=>{for(var s=0,o=r[e>>1],i=o&&o.length;s<i;s++)o[s].call(t);return n},$i=(r,e,t,n,s,o)=>{for(var i,a,l,c,u=e&7,p=!!(e&8),f=!!(e&16),m=2,v=A4[u+5],b=r[m]||(r[m]=[]),S=(s=s.prototype,fJ(s,t)),C=n.length-1;C>=0;C--)l=yJ(u,t,a={},r[3],b),l.static=p,l.private=f,c=l.access={has:E=>t in E},c.get=E=>E[t],i=(0,n[C])(S[v],l),a._=1,j4(i)&&(S[v]=i);return S&&_4(s,t,S),s},TR=(r,e,t)=>M4(r,typeof e!="symbol"?e+"":e,t),R4,D4,O4,L4,N4,F4,z4,$4,B4,U4,H4,G4,ho;G4=[Ie],H4=[Ie],U4=[Ie],B4=[Ie],$4=[Ie],z4=[Ie],F4=[Ie],N4=[Ie],L4=[Ie],O4=[Ie],D4=[Ie],R4=[Ie];class Ko{constructor(e,t){if(this.user=e,this.inferDarkMode=t,bJ(ho,5,this),TR(this,"systemColorScheme",$r("systemColorScheme","light")),TR(this,"disposables",new Set),typeof window>"u"||!("matchMedia"in window))return;const n=window.matchMedia("(prefers-color-scheme: dark)");n!=null&&n.matches&&this.systemColorScheme.set("dark");const s=o=>{o.matches?this.systemColorScheme.set("dark"):this.systemColorScheme.set("light")};n==null||n.addEventListener("change",s),this.disposables.add(()=>n==null?void 0:n.removeEventListener("change",s))}dispose(){this.disposables.forEach(e=>e())}updateUserPreferences(e){this.user.setUserPreferences({...this.user.userPreferences.get(),...e})}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode(),colorScheme:this.user.userPreferences.get().colorScheme,isDarkMode:this.getIsDarkMode(),isWrapMode:this.getIsWrapMode(),isDynamicResizeMode:this.getIsDynamicResizeMode()}}getIsDarkMode(){switch(this.user.userPreferences.get().colorScheme){case"dark":return!0;case"light":return!1;case"system":return this.systemColorScheme.get()==="dark";default:return this.inferDarkMode?this.systemColorScheme.get()==="dark":!1}}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??Na.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??Na.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name??Na.name}getLocale(){return this.user.userPreferences.get().locale??Na.locale}getColor(){return this.user.userPreferences.get().color??Na.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??Na.isSnapMode}getIsWrapMode(){return this.user.userPreferences.get().isWrapMode??Na.isWrapMode}getIsDynamicResizeMode(){return this.user.userPreferences.get().isDynamicSizeMode??Na.isDynamicSizeMode}getIsPasteAtCursorMode(){return this.user.userPreferences.get().isPasteAtCursorMode??Na.isPasteAtCursorMode}}ho=mJ();$i(ho,1,"getUserPreferences",G4,Ko);$i(ho,1,"getIsDarkMode",H4,Ko);$i(ho,1,"getEdgeScrollSpeed",U4,Ko);$i(ho,1,"getAnimationSpeed",B4,Ko);$i(ho,1,"getId",$4,Ko);$i(ho,1,"getName",z4,Ko);$i(ho,1,"getLocale",F4,Ko);$i(ho,1,"getColor",N4,Ko);$i(ho,1,"getIsSnapMode",L4,Ko);$i(ho,1,"getIsWrapMode",O4,Ko);$i(ho,1,"getIsDynamicResizeMode",D4,Ko);$i(ho,1,"getIsPasteAtCursorMode",R4,Ko);vJ(ho,Ko);const SJ={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",long_press:"onLongPress",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick",tick:"onTick"},xJ=["brushing","cropping","dragging","dragging_handle","drawing","erasing","lasering","resizing","rotating","scribble_brushing","translating"];class nt{constructor(e,t){k(this,"performanceTracker");k(this,"id");k(this,"type");k(this,"shapeType");k(this,"initial");k(this,"children");k(this,"isLockable");k(this,"parent");k(this,"_path");k(this,"_current");k(this,"_isActive");k(this,"_currentToolIdMask",$r("curent tool id mask",void 0));this.editor=e;const{id:n,children:s,initial:o,isLockable:i}=this.constructor;this.id=n,this._isActive=$r("toolIsActive"+this.id,!1),this._current=$r("toolState"+this.id,void 0),this._path=Ie("toolPath"+this.id,()=>{const a=this.getCurrent();return this.id+(a?`.${a.getPath()}`:"")}),this.parent=t??{},this.parent?s&&o?(this.type="branch",this.initial=o,this.children=Object.fromEntries(s().map(a=>[a.id,new a(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",s&&o&&(this.initial=o,this.children=Object.fromEntries(s().map(a=>[a.id,new a(this.editor,this)])),this._current.set(this.children[this.initial]))),this.isLockable=i,this.performanceTracker=new MO}getPath(){return this._path.get()}getCurrent(){return this._current.get()}getIsActive(){return this._isActive.get()}transition(e,t={}){var o;const n=e.split(".");let s=this;for(let i=0;i<n.length;i++){const a=n[i],l=s.getCurrent(),c=(o=s.children)==null?void 0:o[a];if(!c)throw Error(`${s.id} - no child state exists with the id ${a}.`);if((l==null?void 0:l.id)!==c.id&&(l==null||l.exit(t,a),s._current.set(c),c.enter(t,(l==null?void 0:l.id)||"initial"),!c.getIsActive()))break;s=c}return this}handleEvent(e){var s;const t=SJ[e.name],n=this._current.__unsafe__getWithoutCapture();(s=this[t])==null||s.call(this,e),this._isActive.__unsafe__getWithoutCapture()&&n&&n===this._current.__unsafe__getWithoutCapture()&&n.handleEvent(e)}enter(e,t){var n;if(_r.measurePerformance.get()&&xJ.includes(this.id)&&this.performanceTracker.start(this.id),this._isActive.set(!0),(n=this.onEnter)==null||n.call(this,e,t),this.children&&this.initial&&this.getIsActive()){const s=this.children[this.initial];this._current.set(s),s.enter(e,t)}}exit(e,t){var n,s;_r.measurePerformance.get()&&this.performanceTracker.isStarted()&&this.performanceTracker.stop(),this._isActive.set(!1),(n=this.onExit)==null||n.call(this,e,t),this.getIsActive()||(s=this.getCurrent())==null||s.exit(e,t)}getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}}k(nt,"id"),k(nt,"initial"),k(nt,"children"),k(nt,"isLockable",!0);class TE extends nt{static children(){return[]}onKeyDown(e){var t;switch(e.code){case"KeyZ":{if(!(e.shiftKey||e.ctrlKey)){const n=this.getCurrent();n&&((t=n.getCurrent())==null?void 0:t.id)==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...e,onInteractionEnd:n.id})}break}}}}k(TE,"id","root"),k(TE,"initial","");var wJ=Object.create,W4=Object.defineProperty,CJ=Object.getOwnPropertyDescriptor,K4=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),V4=r=>{throw TypeError(r)},q4=(r,e,t)=>e in r?W4(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,EJ=r=>[,,,wJ((r==null?void 0:r[K4("metadata")])??null)],Y4=["class","method","getter","setter","accessor","field","value","get","set"],X4=r=>r!==void 0&&typeof r!="function"?V4("Function expected"):r,kJ=(r,e,t,n,s)=>({kind:Y4[r],name:e,metadata:n,addInitializer:o=>t._?V4("Already initialized"):s.push(X4(o||null))}),PJ=(r,e)=>q4(e,K4("metadata"),r[3]),IJ=(r,e,t,n)=>{for(var s=0,o=r[e>>1],i=o&&o.length;s<i;s++)o[s].call(t);return n},Ke=(r,e,t,n,s,o)=>{for(var i,a,l,c,u=e&7,p=!!(e&8),f=!!(e&16),m=2,v=Y4[u+5],b=r[m]||(r[m]=[]),S=(s=s.prototype,CJ(s,t)),C=n.length-1;C>=0;C--)l=kJ(u,t,a={},r[3],b),l.static=p,l.private=f,c=l.access={has:E=>t in E},c.get=E=>E[t],i=(0,n[C])(S[v],l),a._=1,X4(i)&&(S[v]=i);return S&&W4(s,t,S),s},ht=(r,e,t)=>q4(r,typeof e!="symbol"?e+"":e,t),Z4,J4,Q4,e6,t6,n6,r6,s6,o6,i6,a6,l6,c6,d6,u6,h6,p6,f6,g6,m6,y6,v6,b6,S6,x6,w6,C6,E6,k6,P6,I6,_6,T6,M6,A6,j6,R6,D6,O6,L6,N6,F6,z6,$6,B6,U6,H6,G6,W6,K6,V6,q6,Y6,X6,Z6,J6,Q6,e8,t8,n8,r8,s8,o8,i8,a8,l8,c8,d8,u8,h8,p8,f8,ME,We;let Ge=class extends(ME=qY,f8=[Ie],p8=[Ie],h8=[Ie],u8=[Ie],d8=[Ie],c8=[Ie],l8=[Ie],a8=[Ie],i8=[Ie],o8=[Ie],s8=[Ie],r8=[Ie],n8=[Ie],t8=[Ie],e8=[Ie],Q6=[Ie],J6=[Ie],Z6=[Ie],X6=[Ie],Y6=[Ie],q6=[Ie],V6=[Ie],K6=[Ie],W6=[Ie],G6=[Ie],H6=[Ie],U6=[Ie],B6=[Ie],$6=[Ie],z6=[Ie],F6=[Ie],N6=[Ie],L6=[Ie],O6=[Ie],D6=[Ie],R6=[Ie],j6=[Ie],A6=[Ie],M6=[Ie],T6=[Ie],_6=[Ie],I6=[Ie],P6=[Ie],k6=[Ie],E6=[Ie],C6=[Ie],w6=[Ie],x6=[Ie],S6=[Ie],b6=[Ie],v6=[Ie],y6=[Ie],m6=[Ie],g6=[Ie],f6=[Ie],p6=[Ie],h6=[Ie],u6=[Ie],d6=[Ie],c6=[Ie],l6=[Ie],a6=[Ie],i6=[Ie],o6=[Ie],s6=[Ie({isEqual:(e,t)=>e.equals(t)})],r6=[Ie],n6=[Ie],t6=[Ie],e6=[Bo],Q4=[Bo],J4=[Bo],Z4=[Bo],ME){constructor({store:e,user:t,shapeUtils:n,bindingUtils:s,tools:o,getContainer:i,cameraOptions:a,initialState:l,autoFocus:c,inferDarkMode:u,options:p,isShapeHidden:f}){var z;super(),IJ(We,5,this),ht(this,"_isShapeHiddenPredicate"),ht(this,"options"),ht(this,"contextId",Cn()),ht(this,"store"),ht(this,"root"),ht(this,"disposables",new Set),ht(this,"isDisposed",!1),ht(this,"_tickManager"),ht(this,"snaps"),ht(this,"timers",IE.forContext(this.contextId)),ht(this,"user"),ht(this,"textMeasure"),ht(this,"environment",Rn),ht(this,"scribbles"),ht(this,"sideEffects"),ht(this,"edgeScrollManager"),ht(this,"focusManager"),ht(this,"getContainer"),ht(this,"shapeUtils"),ht(this,"styleProps"),ht(this,"bindingUtils"),ht(this,"history"),ht(this,"_shouldIgnoreShapeLock",!1),ht(this,"_crashingError",null),ht(this,"_isChangingStyleTimeout",-1),ht(this,"menus",ra.forContext(this.contextId)),ht(this,"_cameraOptions",$r("camera options",Vj)),ht(this,"_viewportAnimation",null),ht(this,"_willSetInitialBounds",!0),ht(this,"_isLockedOnFollowingUser",$r("isLockedOnFollowingUser",!1)),ht(this,"_cameraState",$r("camera state","idle")),ht(this,"_cameraStateTimeoutRemaining",0),ht(this,"_currentPageShapeIds"),ht(this,"_parentIdsToChildIds"),ht(this,"animatingShapes",new Map),ht(this,"externalAssetContentHandlers",{file:null,url:null}),ht(this,"temporaryAssetPreview",new Map),ht(this,"externalContentHandlers",{text:null,files:null,embed:null,"svg-text":null,url:null}),ht(this,"inputs",{originPagePoint:new P,originScreenPoint:new P,previousPagePoint:new P,previousScreenPoint:new P,currentPagePoint:new P,currentScreenPoint:new P,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,isSpacebarPanning:!1,pointerVelocity:new P}),ht(this,"_clickManager",new cb(this)),ht(this,"_prevCursor","default"),ht(this,"_shiftKeyTimeout",-1),ht(this,"_altKeyTimeout",-1),ht(this,"_ctrlKeyTimeout",-1),ht(this,"_metaKeyTimeout",-1),ht(this,"_restoreToolId","select"),ht(this,"_pinchStart",1),ht(this,"_didPinch",!1),ht(this,"_selectedShapeIdsAtPointerDown",[]),ht(this,"_longPressTimeout",-1),ht(this,"capturedPointerId",null),ht(this,"performanceTracker"),ht(this,"performanceTrackerTimeout",-1),ht(this,"_pendingEventsForNextTick",[]),this._isShapeHiddenPredicate=f,this.options={...ZX,...p},this.store=e,this.disposables.add(this.store.dispose.bind(this.store)),this.history=new kZ({store:e,annotateError:L=>{this.annotateError(L,{origin:"history.batch",willCrashApp:!0}),this.crash(L)}}),this.snaps=new Kg(this),this.disposables.add(this.timers.dispose),this._cameraOptions.set({...Vj,...a}),this.user=new Ko(t??pL(),u??!1),this.disposables.add(()=>this.user.dispose()),this.getContainer=i,this.textMeasure=new oJ(this),this._tickManager=new hb(this);class m extends TE{}k(m,"initial",l??""),this.root=new m(this),this.root.children={};const v=SL(n),b={},S={},C=new Map;for(const L of v){const B=new L(this);b[L.type]=B;const K=V3(L.props??{});S[L.type]=K;for(const O of K.keys())if(!C.has(O.id))C.set(O.id,O);else if(C.get(O.id)!==O)throw Error(`Multiple style props with id "${O.id}" in use. Style prop IDs must be unique.`)}this.shapeUtils=b,this.styleProps=S;const E=vL(s),T={};for(const L of E){const B=new L(this);T[L.type]=B}this.bindingUtils=T;for(const L of[...o]){if(ua(this.root.children,L.id))throw Error(`Can't override tool with id "${L.id}"`);this.root.children[L.id]=new L(this,this.root)}this.scribbles=new _Z(this);const w=(L,B)=>{let K=null;const O=L.selectedShapeIds.filter(H=>!B.has(H));O.length!==L.selectedShapeIds.length&&(K||(K={...L}),K.selectedShapeIds=O);const U=L.erasingShapeIds.filter(H=>!B.has(H));U.length!==L.erasingShapeIds.length&&(K||(K={...L}),K.erasingShapeIds=U),L.hoveredShapeId&&B.has(L.hoveredShapeId)&&(K||(K={...L}),K.hoveredShapeId=null),L.editingShapeId&&B.has(L.editingShapeId)&&(K||(K={...L}),K.editingShapeId=null);const X=L.hintingShapeIds.filter(H=>!B.has(H));return X.length!==L.hintingShapeIds.length&&(K||(K={...L}),K.hintingShapeIds=X),L.focusedGroupId&&B.has(L.focusedGroupId)&&(K||(K={...L}),K.focusedGroupId=null),K};this.sideEffects=this.store.sideEffects;let M=new Map;const R=new Set,D=new Set;let N=new Set;if(this.disposables.add(this.sideEffects.registerOperationCompleteHandler(()=>{var L,B,K,O;R.clear();for(const U of D){D.delete(U);const X=this.getShape(U);if(!X)continue;const H=this.getShapeUtil(X),ee=(L=H.onChildrenChange)==null?void 0:L.call(H,X);ee!=null&&ee.length&&this.updateShapes(ee)}if(N.size){const U=N;N=new Set;for(const X of U){const H=this.getBindingUtil(X);(B=H.onOperationComplete)==null||B.call(H)}}if(M.size){const U=M;M=new Map;for(const X of U.values())(O=(K=this.getBindingUtil(X.binding)).onAfterDelete)==null||O.call(K,X)}this.emit("update")})),this.disposables.add(this.sideEffects.register({shape:{afterChange:(L,B)=>{var K,O,U,X;for(const H of this.getBindingsInvolvingShape(B))N.add(H.type),H.fromId===B.id&&((O=(K=this.getBindingUtil(H)).onAfterChangeFromShape)==null||O.call(K,{binding:H,shapeBefore:L,shapeAfter:B})),H.toId===B.id&&((X=(U=this.getBindingUtil(H)).onAfterChangeToShape)==null||X.call(U,{binding:H,shapeBefore:L,shapeAfter:B}));if(L.parentId!==B.parentId){const H=ee=>{var ne,ae,q,se;const J=this.getShape(ee);if(J)for(const xe of this.getBindingsInvolvingShape(J))N.add(xe.type),xe.fromId===J.id&&((ae=(ne=this.getBindingUtil(xe)).onAfterChangeFromShape)==null||ae.call(ne,{binding:xe,shapeBefore:J,shapeAfter:J})),xe.toId===J.id&&((se=(q=this.getBindingUtil(xe)).onAfterChangeToShape)==null||se.call(q,{binding:xe,shapeBefore:J,shapeAfter:J}))};H(B.id),this.visitDescendants(B.id,H)}if(L.parentId!==B.parentId&&Po(B.parentId)){const H=new Set([L.id]);this.visitDescendants(L.id,ee=>{H.add(ee)});for(const ee of this.getPageStates()){if(ee.pageId===B.parentId)continue;const J=w(ee,H);J&&this.store.put([J])}}L.parentId&&Oo(L.parentId)&&D.add(L.parentId),B.parentId!==L.parentId&&Oo(B.parentId)&&D.add(B.parentId)},beforeDelete:L=>{var U,X,H,ee;if(R.has(L.id))return;L.parentId&&Oo(L.parentId)&&D.add(L.parentId),R.add(L.id);const B=[];for(const J of this.getBindingsInvolvingShape(L)){N.add(J.type),B.push(J.id);const ne=this.getBindingUtil(J);J.fromId===L.id?((U=ne.onBeforeIsolateToShape)==null||U.call(ne,{binding:J,removedShape:L}),(X=ne.onBeforeDeleteFromShape)==null||X.call(ne,{binding:J,shape:L})):((H=ne.onBeforeIsolateFromShape)==null||H.call(ne,{binding:J,removedShape:L}),(ee=ne.onBeforeDeleteToShape)==null||ee.call(ne,{binding:J,shape:L}))}B.length&&this.deleteBindings(B);const K=new Set([L.id]),O=kt(this.getPageStates().map(J=>w(J,K)));O.length&&this.store.put(O)}},binding:{beforeCreate:L=>{var K,O;const B=(O=(K=this.getBindingUtil(L)).onBeforeCreate)==null?void 0:O.call(K,{binding:L});return B||L},afterCreate:L=>{var B,K;N.add(L.type),(K=(B=this.getBindingUtil(L)).onAfterCreate)==null||K.call(B,{binding:L})},beforeChange:(L,B)=>{var O,U;const K=(U=(O=this.getBindingUtil(B)).onBeforeChange)==null?void 0:U.call(O,{bindingBefore:L,bindingAfter:B});return K||B},afterChange:(L,B)=>{var K,O;N.add(B.type),(O=(K=this.getBindingUtil(B)).onAfterChange)==null||O.call(K,{bindingBefore:L,bindingAfter:B})},beforeDelete:L=>{var B,K;(K=(B=this.getBindingUtil(L)).onBeforeDelete)==null||K.call(B,{binding:L})},afterDelete:L=>{var B,K;(K=(B=this.getBindingUtil(L)).onAfterDelete)==null||K.call(B,{binding:L}),N.add(L.type)}},page:{afterCreate:L=>{const B=Ja.createId(L.id),K=la.createId(L.id);this.store.has(B)||this.store.put([Ja.create({id:B})]),this.store.has(K)||this.store.put([la.create({id:K,pageId:L.id})])},afterDelete:(L,B)=>{var U,X;if(((U=this.getInstanceState())==null?void 0:U.currentPageId)===L.id){const H=(X=this.getPages().find(ee=>ee.id!==L.id))==null?void 0:X.id;H?this.store.put([{...this.getInstanceState(),currentPageId:H}]):B==="user"&&this.store.ensureStoreIsUsable()}const K=Ja.createId(L.id),O=la.createId(L.id);this.store.remove([K,O])}},instance:{afterChange:(L,B,K)=>{var O;if(!this.store.has(B.currentPageId)){const U=this.store.has(L.currentPageId)?L.currentPageId:(O=this.getPages()[0])==null?void 0:O.id;U?this.store.update(B.id,X=>({...X,currentPageId:U})):K==="user"&&this.store.ensureStoreIsUsable()}}},instance_page_state:{afterChange:(L,B)=>{if((L==null?void 0:L.selectedShapeIds)!==(B==null?void 0:B.selectedShapeIds)){const K=B.selectedShapeIds.filter(U=>{var H,ee;let X=(H=this.getShape(U))==null?void 0:H.parentId;for(;Oo(X);){if(B.selectedShapeIds.includes(X))return!1;X=(ee=this.getShape(X))==null?void 0:ee.parentId}return!0});let O=null;if(K.length>0){const U=this.findCommonAncestor(kt(K.map(X=>this.getShape(X))),X=>this.isShapeOfType(X,"group"));U&&(O=U)}else B!=null&&B.focusedGroupId&&(O=B.focusedGroupId);(K.length!==B.selectedShapeIds.length||O!==B.focusedGroupId)&&this.store.put([{...B,selectedShapeIds:K,focusedGroupId:O??null}])}}}})),this._currentPageShapeIds=hZ(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=uZ(this.store),this.disposables.add(this.store.listen(L=>{this.emit("change",L)})),this.disposables.add(this.history.dispose),this.run(()=>{this.store.ensureStoreIsUsable(),this._updateCurrentPageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]})},{history:"ignore"}),l&&this.root.children[l]===void 0)throw Error(`No state found for initialState "${l}".`);if(this.root.enter(void 0,"initial"),this.edgeScrollManager=new xZ(this),this.focusManager=new wZ(this,c),this.disposables.add(this.focusManager.dispose.bind(this.focusManager)),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.on("tick",this._flushEventsForTick),this.timers.requestAnimationFrame(()=>{this._tickManager.start()}),this.performanceTracker=new MO,(z=this.store.props.collaboration)!=null&&z.mode){const L=this.store.props.collaboration.mode;this.disposables.add(nl("update collaboration mode",()=>{this.store.put([{...this.getInstanceState(),isReadonly:L.get()==="readonly"}])}))}}getIsShapeHiddenCache(){return this._isShapeHiddenPredicate?this.store.createComputedCache("isShapeHidden",e=>this.findShapeAncestor(e,n=>this.isShapeHidden(n))?!0:this._isShapeHiddenPredicate(e,this)??!1):null}isShapeHidden(e){return this._isShapeHiddenPredicate?!!this.getIsShapeHiddenCache().get(typeof e=="string"?e:e.id):!1}dispose(){this.disposables.forEach(e=>e()),this.disposables.clear(),this.isDisposed=!0}getShapeUtil(e){const t=typeof e=="string"?e:e.type,n=Ws(this.shapeUtils,t);return fn(n,`No shape util found for type "${t}"`),n}getBindingUtil(e){const t=typeof e=="string"?e:e.type,n=Ws(this.bindingUtils,t);return fn(n,`No binding util found for type "${t}"`),n}undo(){return this._flushEventsForTick(0),this.complete(),this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this._flushEventsForTick(0),this.complete(),this.history.redo(),this}clearHistory(){return this.history.clear(),this}getCanRedo(){return this.history.getNumRedos()>0}mark(e){return console.warn(typeof e=="string"?`[tldraw] \`editor.history.mark("${e}")\` is deprecated. Please use \`const myMarkId = editor.markHistoryStoppingPoint()\` instead.`:"[tldraw] `editor.mark()` is deprecated. Use `editor.markHistoryStoppingPoint()` instead."),this.history._mark(e??Cn()),this}markHistoryStoppingPoint(e){const t=`[${e??"stop"}]_${Cn()}`;return this.history._mark(t),t}getMarkIdMatching(e){return this.history.getMarkIdMatching(e)}squashToMark(e){return this.history.squashToMark(e),this}bail(){return this.history.bail(),this}bailToMark(e){return this.history.bailToMark(e),this}run(e,t){const n=this._shouldIgnoreShapeLock;this._shouldIgnoreShapeLock=(t==null?void 0:t.ignoreShapeLock)??n;try{this.history.batch(e,t)}finally{this._shouldIgnoreShapeLock=n}return this}batch(e,t){return this.run(e,t)}annotateError(e,{origin:t,willCrashApp:n,tags:s,extras:o}){const i=this.createErrorAnnotations(t,n);return Ok(e,{tags:{...i.tags,...s},extras:{...i.extras,...o}}),n&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(e,t){try{const n=this.getEditingShapeId();return{tags:{origin:e,willCrashApp:t},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes(),editingShape:n?this.getShape(n):void 0,inputs:this.inputs}}}catch{return{tags:{origin:e,willCrashApp:t},extras:{}}}}getCrashingError(){return this._crashingError}crash(e){return this._crashingError=e,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:e}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(e){const t=e.split(".").reverse();let n=this.root;for(;t.length>0;){const s=t.pop();if(!s)return!0;const o=n.getCurrent();if((o==null?void 0:o.id)===s){if(t.length===0)return!0;n=o;continue}else return!1}return!1}isInAny(...e){return e.some(t=>this.isIn(t))}setCurrentTool(e,t={}){return this.root.transition(e,t),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){const e=this.getCurrentTool();return e?e.getCurrentToolIdMask()??e.id:""}getStateDescendant(e){var s;const t=e.split(".").reverse();let n=this.root;for(;t.length>0;){const o=t.pop();if(!o)return n;const i=(s=n.children)==null?void 0:s[o];if(!i)return;n=i}return n}getDocumentSettings(){return this.store.get(mE)}updateDocumentSettings(e){return this.run(()=>{this.store.put([{...this.getDocumentSettings(),...e}])},{history:"ignore"}),this}getInstanceState(){return this.store.get(oo)}updateInstanceState(e,t){return this._updateInstanceState(e,{history:"ignore",...t}),e.isChangingStyle!==void 0&&(clearTimeout(this._isChangingStyleTimeout),e.isChangingStyle===!0&&(this._isChangingStyleTimeout=this.timers.setTimeout(()=>{this._updateInstanceState({isChangingStyle:!1},{history:"ignore"})},2e3))),this}_updateInstanceState(e,t){this.run(()=>{this.store.put([{...this.getInstanceState(),...e}])},t)}getOpenMenus(){return this.menus.getOpenMenus()}addOpenMenu(e){return this.menus.addOpenMenu(e),this}deleteOpenMenu(e){return this.menus.deleteOpenMenu(e),this}clearOpenMenus(){return this.menus.clearOpenMenus(),this}getIsMenuOpen(){return this.menus.hasAnyOpenMenus()}setCursor(e){return this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...e}}),this}getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return la.createId(this.getCurrentPageId())}updateCurrentPageState(e){return this._updateCurrentPageState(e),this}_updateCurrentPageState(e){this.store.update(e.id??this.getCurrentPageState().id,t=>({...t,...e}))}getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){const{selectedShapeIds:e}=this.getCurrentPageState();return kt(e.map(t=>this.store.get(t)))}setSelectedShapes(e){return this.run(()=>{const t=e.map(o=>typeof o=="string"?o:o.id),{selectedShapeIds:n}=this.getCurrentPageState(),s=new Set(n);if(t.length===s.size&&t.every(o=>s.has(o)))return null;this.store.put([{...this.getCurrentPageState(),selectedShapeIds:t}])},{history:"record-preserveRedoStack"})}isAncestorSelected(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null,n=this.getShape(t);if(!n)return!1;const s=this.getSelectedShapeIds();return!!this.findShapeAncestor(n,o=>s.includes(o.id))}select(...e){const t=typeof e[0]=="string"?e:e.map(n=>n.id);return this.setSelectedShapes(t),this}deselect(...e){const t=typeof e[0]=="string"?e:e.map(s=>s.id),n=this.getSelectedShapeIds();return n.length>0&&t.length>0&&this.setSelectedShapes(n.filter(s=>!t.includes(s))),this}selectAll(){const e=this.getSortedChildIdsForParent(this.getCurrentPageId());return e.length<=0?this:(this.setSelectedShapes(this._getUnlockedShapeIds(e)),this)}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShapeId(){var e;return((e=this.getOnlySelectedShape())==null?void 0:e.id)??null}getOnlySelectedShape(){const e=this.getSelectedShapes();return e.length===1?e[0]:null}getShapesPageBounds(e){const t=kt(e.map(n=>this.getShapePageBounds(n)));return t.length===0?null:Ve.Common(t)}getSelectionPageBounds(){return this.getShapesPageBounds(this.getSelectedShapeIds())}getShapesSharedRotation(e){let t=!1,n=0;for(let s=0,o=e.length;s<o;s++){const i=this.getShapePageTransform(e[s]);if(i)if(t){if(i.rotation()!==n)return 0}else t=!0,n=i.rotation()}return n}getSelectionRotation(){return this.getShapesSharedRotation(this.getSelectedShapeIds())}getShapesRotatedPageBounds(e){if(e.length===0)return;const t=this.getShapesSharedRotation(e);if(t===0)return this.getShapesPageBounds(e)??void 0;if(e.length===1){const s=this.getShapeGeometry(e[0]).bounds.clone(),o=this.getShapePageTransform(e[0]);return s.point=o.applyToPoint(s.point),s}const n=Ve.FromPoints(e.flatMap(s=>{const o=this.getShapePageTransform(s);return o?o.applyToPoints(this.getShapeGeometry(s).bounds.corners):[]}).map(s=>s.rot(-t)));return n.point=n.point.rot(t),n}getSelectionRotatedPageBounds(){return this.getShapesRotatedPageBounds(this.getSelectedShapeIds())}getSelectionRotatedScreenBounds(){const e=this.getSelectionRotatedPageBounds();if(!e)return;const{x:t,y:n}=this.pageToScreen(e.point),s=this.getZoomLevel();return new Ve(t,n,e.width*s,e.height*s)}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){const e=this.getFocusedGroupId();return e?this.getShape(e):void 0}setFocusedGroup(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null;if(t!==null){const n=this.getShape(t);if(!n)throw Error(`Editor.setFocusedGroup: Shape with id ${t} does not exist`);if(!this.isShapeOfType(n,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${n.type}`)}return t===this.getFocusedGroupId()?this:this.run(()=>{this.store.update(this.getCurrentPageState().id,n=>({...n,focusedGroupId:t}))},{history:"record-preserveRedoStack"})}popFocusedGroupId(){const e=this.getFocusedGroup();if(e){const t=this.findShapeAncestor(e,n=>this.isShapeOfType(n,"group"));this.setFocusedGroup((t==null?void 0:t.id)??null),this.select(e.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){const e=this.getEditingShapeId();return e?this.getShape(e):void 0}setEditingShape(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null;if(t!==this.getEditingShapeId()){if(t){const n=this.getShape(t);if(n&&this.getShapeUtil(n).canEdit(n))return this.run(()=>{this._updateCurrentPageState({editingShapeId:t})},{history:"ignore"}),this}this.run(()=>{this._updateCurrentPageState({editingShapeId:null})},{history:"ignore"})}return this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){const e=this.getHoveredShapeId();return e?this.getShape(e):void 0}setHoveredShape(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null;return t===this.getHoveredShapeId()?this:(this.run(()=>{this.updateCurrentPageState({hoveredShapeId:t})},{history:"ignore"}),this)}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){const e=this.getHintingShapeIds();return kt(e.map(t=>this.getShape(t)))}setHintingShapes(e){const t=typeof e[0]=="string"?e:e.map(n=>n.id);return this.run(()=>{this._updateCurrentPageState({hintingShapeIds:Dk(t)})},{history:"ignore"}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){const e=this.getErasingShapeIds();return kt(e.map(t=>this.getShape(t)))}setErasingShapes(e){const t=typeof e[0]=="string"?e:e.map(s=>s.id);t.sort();const n=this.getErasingShapeIds();return this.run(()=>{if(t.length===n.length){for(let s=0;s<t.length;s++)if(t[s]!==n[s]){this._updateCurrentPageState({erasingShapeIds:t});break}}else this._updateCurrentPageState({erasingShapeIds:t})},{history:"ignore"}),this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null;return t!==this.getCroppingShapeId()&&this.run(()=>{if(!t)this.updateCurrentPageState({croppingShapeId:null});else{const n=this.getShape(t),s=this.getShapeUtil(n);n&&s.canCrop(n)&&this.updateCurrentPageState({croppingShapeId:t})}},{history:"ignore"}),this}_unsafe_getCameraId(){return Ja.createId(this.getCurrentPageId())}getCamera(){const e=this.store.get(this._unsafe_getCameraId());if(this._isLockedOnFollowingUser.get()){const t=this.getCameraForFollowing();if(t)return{...e,...t}}return e}getViewportPageBoundsForFollowing(){const e=this.getInstanceState().followingUserId;if(!e)return null;const t=this.getCollaborators().find(p=>p.userId===e);if(!t||!t.camera||!t.screenBounds)return null;const{w:n,h:s}=t.screenBounds,{x:o,y:i,z:a}=t.camera,l=new Ve(-o,-i,n/a,s/a),c=this.getViewportScreenBounds().clone(),u=c.width/c.height;return c.width=l.width,c.height=c.width/u,c.height<l.height&&(c.height=l.height,c.width=c.height*u),c.center=l.center,c}getCameraForFollowing(){const e=this.getViewportPageBoundsForFollowing();return e?{x:-e.x,y:-e.y,z:this.getViewportScreenBounds().w/e.width}:null}getZoomLevel(){return this.getCamera().z}getInitialZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.initialZoom==="default")return 1;const{zx:t,zy:n}=AR(this,e);switch(e.constraints.initialZoom){case"fit-min":return Math.max(t,n);case"fit-max":return Math.min(t,n);case"fit-x":return t;case"fit-y":return n;case"fit-min-100":return Math.min(1,Math.max(t,n));case"fit-max-100":return Math.min(1,Math.min(t,n));case"fit-x-100":return Math.min(1,t);case"fit-y-100":return Math.min(1,n);default:throw rs(e.constraints.initialZoom)}}getBaseZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.baseZoom==="default")return 1;const{zx:t,zy:n}=AR(this,e);switch(e.constraints.baseZoom){case"fit-min":return Math.max(t,n);case"fit-max":return Math.min(t,n);case"fit-x":return t;case"fit-y":return n;case"fit-min-100":return Math.min(1,Math.max(t,n));case"fit-max-100":return Math.min(1,Math.min(t,n));case"fit-x-100":return Math.min(1,t);case"fit-y-100":return Math.min(1,n);default:throw rs(e.constraints.baseZoom)}}getCameraOptions(){return this._cameraOptions.get()}setCameraOptions(e){var n;const t=Kn({...this._cameraOptions.__unsafe__getWithoutCapture(),...e});return((n=t.zoomSteps)==null?void 0:n.length)<1&&(t.zoomSteps=[1]),this._cameraOptions.set(t),this.setCamera(this.getCamera()),this}getConstrainedCamera(e,t){const n=this.getCamera();let{x:s,y:o,z:i=n.z}=e;if(!(t!=null&&t.force)){const a=this.getCameraOptions(),l=a.zoomSteps[0],c=gs(a.zoomSteps),u=this.getViewportScreenBounds();if(a.constraints){const{constraints:p}=a,f=Math.min(p.padding.y,u.w/2),m=Math.min(p.padding.x,u.h/2),v=Ve.From(a.constraints.bounds),b=(u.w-m*2)/v.w,S=(u.h-f*2)/v.h,C=this.getBaseZoom(),E=c*C,T=l*C;if(t!=null&&t.reset&&(i=this.getInitialZoom()),i<T||i>E){const{x:K,y:O,z:U}=n,X=-K+u.w/U/2,H=-O+u.h/U/2;i=ps(i,T,E);const ee=-K+u.w/i/2,J=-O+u.h/i/2;s=K+ee-X,o=O+J-H}const w=m/i-v.x,M=f/i-v.y,R=(u.w-m*2)/i-v.w,D=(u.h-f*2)/i-v.h,N=w+R*p.origin.x,z=M+D*p.origin.y,L=typeof p.behavior=="string"?p.behavior:p.behavior.x,B=typeof p.behavior=="string"?p.behavior:p.behavior.y;if(t!=null&&t.reset)s=N,o=z;else{switch(L){case"fixed":{s=N;break}case"contain":{i<b?s=N:s=ps(s,w+R,w);break}case"inside":{i<b?s=ps(s,w,(u.w-m)/i-v.w):s=ps(s,w+R,w);break}case"outside":{s=ps(s,m/i-v.w,(u.w-m)/i);break}case"free":break;default:throw rs(L)}switch(B){case"fixed":{o=z;break}case"contain":{i<S?o=z:o=ps(o,M+D,M);break}case"inside":{i<S?o=ps(o,M,(u.h-f)/i-v.h):o=ps(o,M+D,M);break}case"outside":{o=ps(o,f/i-v.h,(u.h-f)/i);break}case"free":break;default:throw rs(B)}}}else if(i>c||i<l){const{x:p,y:f,z:m}=n;i=ps(i,l,c),s=p+(-p+u.w/i/2)-(-p+u.w/m/2),o=f+(-f+u.h/i/2)-(-f+u.h/m/2)}}return{x:s,y:o,z:i}}_setCamera(e,t){const n=this.getCamera(),{x:s,y:o,z:i}=this.getConstrainedCamera(e,t);return n.x===s&&n.y===o&&n.z===i?this:(rl(()=>{const a={...n,x:s,y:o,z:i};this.run(()=>{this.store.put([a])},{history:"ignore"});const{currentScreenPoint:l,currentPagePoint:c}=this.inputs,{screenBounds:u}=this.store.unsafeGetWithoutCapture(oo);if(l.x/i-s!==c.x||l.y/i-o!==c.y){const p={type:"pointer",target:"canvas",name:"pointer_move",point:P.AddXY(l,u.x,u.y),pointerId:qj.CAMERA_MOVE,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,metaKey:this.inputs.metaKey,accelKey:Gs(this.inputs),button:0,isPen:this.getInstanceState().isPenMode??!1};t!=null&&t.immediate?this._flushEventForTick(p):this.dispatch(p)}this._tickCameraState()}),this)}setCamera(e,t){const{isLocked:n}=this._cameraOptions.__unsafe__getWithoutCapture();if(n&&!(t!=null&&t.force))return this;this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser();const s=P.Cast(e);Number.isFinite(s.x)||(s.x=0),Number.isFinite(s.y)||(s.y=0),(s.z===void 0||!Number.isFinite(s.z))&&(e.z=this.getZoomLevel());const o=this.getConstrainedCamera(s,t);if(t!=null&&t.animation){const{width:i,height:a}=this.getViewportScreenBounds();this._animateToViewport(new Ve(-o.x,-o.y,i/o.z,a/o.z),t)}else this._setCamera(o,{...t,force:!0});return this}centerOnPoint(e,t){const{isLocked:n}=this.getCameraOptions();if(n&&!(t!=null&&t.force))return this;const{width:s,height:o}=this.getViewportPageBounds();return this.setCamera(new P(-(e.x-s/2),-(e.y-o/2),this.getCamera().z),t),this}zoomToFit(e){const t=[...this.getCurrentPageShapeIds()];if(t.length<=0)return this;const n=Ve.Common(kt(t.map(s=>this.getShapePageBounds(s))));return this.zoomToBounds(n,e),this}resetZoom(e=this.getViewportScreenCenter(),t){const{isLocked:n,constraints:s}=this.getCameraOptions();if(n&&!(t!=null&&t.force))return this;const o=this.getCamera(),{x:i,y:a,z:l}=o,{x:c,y:u}=e;let p=1;if(s){const f=this.getInitialZoom();l!==f&&(p=f)}return this.setCamera(new P(i+(c/p-c)-(c/l-c),a+(u/p-u)-(u/l-u),p),t),this}zoomIn(e=this.getViewportScreenCenter(),t){const{isLocked:n}=this.getCameraOptions();if(n&&!(t!=null&&t.force))return this;const{x:s,y:o,z:i}=this.getCamera(),{zoomSteps:a}=this.getCameraOptions();if(a!==null&&a.length>1){const l=this.getBaseZoom();let c=gs(a)*l;for(let u=1;u<a.length;u++){const p=a[u-1]*l,f=a[u]*l;if(!(f-i<=(f-p)/2)){c=f;break}}this.setCamera(new P(s+(e.x/c-e.x)-(e.x/i-e.x),o+(e.y/c-e.y)-(e.y/i-e.y),c),t)}return this}zoomOut(e=this.getViewportScreenCenter(),t){const{isLocked:n}=this.getCameraOptions();if(n&&!(t!=null&&t.force))return this;const{zoomSteps:s}=this.getCameraOptions();if(s!==null&&s.length>1){const o=this.getBaseZoom(),{x:i,y:a,z:l}=this.getCamera();let c=s[0]*o;for(let u=s.length-1;u>0;u--){const p=s[u-1]*o,f=s[u]*o;if(!(f-l>=(f-p)/2)){c=p;break}}this.setCamera(new P(i+(e.x/c-e.x)-(e.x/l-e.x),a+(e.y/c-e.y)-(e.y/l-e.y),c),t)}return this}zoomToSelection(e){const{isLocked:t}=this.getCameraOptions();if(t&&!(e!=null&&e.force))return this;const n=this.getSelectionPageBounds();return n&&this.zoomToBounds(n,{targetZoom:Math.max(1,this.getZoomLevel()),...e}),this}zoomToBounds(e,t){const n=this._cameraOptions.__unsafe__getWithoutCapture();if(n.isLocked&&!(t!=null&&t.force))return this;const s=this.getViewportScreenBounds(),o=(t==null?void 0:t.inset)??Math.min(IV,s.width*.28),i=this.getBaseZoom(),a=n.zoomSteps[0],l=gs(n.zoomSteps);let c=ps(Math.min((s.width-o)/e.w,(s.height-o)/e.h),a*i,l*i);return(t==null?void 0:t.targetZoom)!==void 0&&(c=Math.min(t.targetZoom,c)),this.setCamera(new P(-e.x+(s.width-e.w*c)/2/c,-e.y+(s.height-e.h*c)/2/c,c),t),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(e){if(!this._viewportAnimation)return;this._viewportAnimation.elapsed+=e;const{elapsed:t,easing:n,duration:s,start:o,end:i}=this._viewportAnimation;if(t>s){this.off("tick",this._animateViewport),this._viewportAnimation=null,this._setCamera(new P(-i.x,-i.y,this.getViewportScreenBounds().width/i.width));return}const a=s-t,l=n(1-a/s),c=o.minX+(i.minX-o.minX)*l,u=o.minY+(i.minY-o.minY)*l,p=o.maxX+(i.maxX-o.maxX)*l;this._setCamera(new P(-c,-u,this.getViewportScreenBounds().width/(p-c)),{force:!0})}_animateToViewport(e,t={animation:K1}){const{animation:n,...s}=t;if(!n)return;const{duration:o=0,easing:i=ss.easeInOutCubic}=n,a=this.user.getAnimationSpeed(),l=this.getViewportPageBounds();return this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),o===0||a===0?this._setCamera(new P(-e.x,-e.y,this.getViewportScreenBounds().width/e.width),{...s}):(this._viewportAnimation={elapsed:0,duration:o/a,easing:i,start:l.clone(),end:e.clone()},this.once("stop-camera-animation",()=>{this.off("tick",this._animateViewport),this._viewportAnimation=null}),this.on("tick",this._animateViewport),this)}slideCamera(e={}){const{isLocked:t}=this.getCameraOptions();if(t&&!(e!=null&&e.force))return this;if(this.user.getAnimationSpeed()===0)return this;this.stopCameraAnimation();const{speed:s,friction:o=this.options.cameraSlideFriction,direction:i,speedThreshold:a=.01}=e;let l=Math.min(s,1);const c=()=>{this.off("tick",u),this.off("stop-camera-animation",c)};this.once("stop-camera-animation",c);const u=p=>{const{x:f,y:m,z:v}=this.getCamera(),b=P.Mul(i,l*p/v);l*=1-o,l<a?c():this._setCamera(new P(f+b.x,m+b.y,v))};return this.on("tick",u),this}zoomToUser(e,t={animation:{duration:500}}){const n=this.getCollaborators().find(o=>o.userId===e);if(!n)return this;const s=n.cursor;return s?(this.run(()=>{this.getInstanceState().followingUserId!==null&&this.stopFollowingUser();const o=n.currentPageId===this.getCurrentPageId();o||this.setCurrentPage(n.currentPageId),t&&t.animation&&!o&&(t.animation=void 0),this.centerOnPoint(s,t);const{highlightedUserIds:i}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...i,e]}),this.timers.setTimeout(()=>{const a=[...this.getInstanceState().highlightedUserIds],l=a.indexOf(e);l<0||(a.splice(l,1),this.updateInstanceState({highlightedUserIds:a}))},this.options.collaboratorIdleTimeoutMs)}),this):this}updateViewportScreenBounds(e,t=!1){if(e instanceof HTMLElement){const a=e.getBoundingClientRect();e=new Ve(a.left||a.x,a.top||a.y,Math.max(a.width,1),Math.max(a.height,1))}else e.width=Math.max(e.width,1),e.height=Math.max(e.height,1);const n=[e.minY!==0,!Jc(document.body.scrollWidth,e.maxX,1),!Jc(document.body.scrollHeight,e.maxY,1),e.minX!==0],{_willSetInitialBounds:s}=this;this._willSetInitialBounds=!1;const{screenBounds:o,insets:i}=this.getInstanceState();if(e.equals(o)&&n.every((a,l)=>a===i[l]))return this;if(s)this.updateInstanceState({screenBounds:e.toJson(),insets:n}),this.setCamera(this.getCamera());else if(t&&!this.getInstanceState().followingUserId){const a=this.getViewportPageBounds().center;this.updateInstanceState({screenBounds:e.toJson(),insets:n}),this.centerOnPoint(a)}else this.updateInstanceState({screenBounds:e.toJson(),insets:n}),this._setCamera(P.From({...this.getCamera()}));return this._tickCameraState(),this}getViewportScreenBounds(){const{x:e,y:t,w:n,h:s}=this.getInstanceState().screenBounds;return new Ve(e,t,n,s)}getViewportScreenCenter(){const e=this.getViewportScreenBounds();return new P(e.midX-e.minX,e.midY-e.minY)}getViewportPageBounds(){const{w:e,h:t}=this.getViewportScreenBounds(),{x:n,y:s,z:o}=this.getCamera();return new Ve(-n,-s,e/o,t/o)}screenToPage(e){const{screenBounds:t}=this.store.unsafeGetWithoutCapture(oo),{x:n,y:s,z:o=1}=this.getCamera();return new P((e.x-t.x)/o-n,(e.y-t.y)/o-s,e.z??.5)}pageToScreen(e){const{screenBounds:t}=this.store.unsafeGetWithoutCapture(oo),{x:n,y:s,z:o=1}=this.getCamera();return new P((e.x+n)*o+t.x,(e.y+s)*o+t.y,e.z??.5)}pageToViewport(e){const{x:t,y:n,z:s=1}=this.getCamera();return new P((e.x+t)*s,(e.y+n)*s,e.z??.5)}_getCollaboratorsQuery(){return this.store.query.records("instance_presence",()=>({userId:{neq:this.user.getId()}}))}getCollaborators(){const e=this._getCollaboratorsQuery().get();return e.length?[...new Set(e.map(n=>n.userId))].sort().map(n=>CH(e.filter(o=>o.userId===n),o=>o.lastActivityTimestamp??0)):Gl}getCollaboratorsOnCurrentPage(){const e=this.getCurrentPageId();return this.getCollaborators().filter(t=>t.currentPageId===e)}startFollowingUser(e){this.stopFollowingUser();const t=this._getCollaboratorsQuery().get().filter(o=>o.userId===e);if(!t.length)return console.warn("User not found"),this;const n=this.user.getId();if(n||console.warn("You should set the userId for the current instance before following a user"),t.some(o=>o.followingUserId===n))return this;const s=Ie("latestLeaderPresence",()=>this.getCollaborators().find(o=>o.userId===e));return rl(()=>{this.updateInstanceState({followingUserId:e},{history:"ignore"});const o=nl("update current page",()=>{const l=s.get();if(!l){this.stopFollowingUser();return}l.currentPageId!==this.getCurrentPageId()&&this.getPage(l.currentPageId)&&this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:l.currentPageId}]),this._isLockedOnFollowingUser.set(!0)},{history:"ignore"})}),i=()=>{o(),this._isLockedOnFollowingUser.set(!1),this.off("frame",a),this.off("stop-following",i)},a=()=>{if(!s.get()){this.stopFollowingUser();return}if(this._isLockedOnFollowingUser.get())return;const c=this.user.getAnimationSpeed();if(c===0){this._isLockedOnFollowingUser.set(!0);return}const u=this.getViewportPageBoundsForFollowing();if(!u){this.stopFollowingUser();return}const p=this.getViewportPageBounds(),f=Math.abs(u.minX-p.minX)+Math.abs(u.maxX-p.maxX),m=Math.abs(u.minY-p.minY)+Math.abs(u.maxY-p.maxY);if(f<this.options.followChaseViewportSnap&&m<this.options.followChaseViewportSnap){this._isLockedOnFollowingUser.set(!0);return}const v=ps(c*.5,.1,.8),b=new Ve(Gt(p.minX,u.minX,v),Gt(p.minY,u.minY,v),Gt(p.width,u.width,v),Gt(p.height,u.height,v)),S=new P(-b.x,-b.y,this.getViewportScreenBounds().width/b.width);this.stopCameraAnimation(),this._setCamera(S)};this.once("stop-following",i),this.addListener("frame",a),a()}),this}stopFollowingUser(){return this.run(()=>{this.store.put([this.getCamera()]),this._isLockedOnFollowingUser.set(!1),this.updateInstanceState({followingUserId:null}),this.emit("stop-following")},{history:"ignore"}),this}getUnorderedRenderingShapes(e){const t=[];let n=this.options.maxShapesPerPage*2,s=this.options.maxShapesPerPage;const o=this.getErasingShapeIds(),i=(l,c,u)=>{const p=this.getShape(l);if(!p||this.isShapeHidden(p))return;c*=p.opacity;let f=!1;const m=this.getShapeUtil(p);e&&(f=!u&&o.includes(l),f&&(c*=.32)),t.push({id:l,shape:p,util:m,index:n,backgroundIndex:s,opacity:c}),n+=1,s+=1;const v=this.getSortedChildIdsForParent(l);if(!v.length)return;let b=null;m.providesBackgroundForChildren(p)&&(b=s,s=n,n+=this.options.maxShapesPerPage);for(const S of v)i(S,c,u||f);b!==null&&(s=b)},a=e?[this.getCurrentPage()]:this.getPages();for(const l of a)for(const c of this.getSortedChildIdsForParent(l.id))i(c,1,!1);return t}_decayCameraStateTimeout(e){this._cameraStateTimeoutRemaining-=e,!(this._cameraStateTimeoutRemaining>0)&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"))}_tickCameraState(){this._cameraStateTimeoutRemaining=this.options.cameraMovingTimeoutMs,this._cameraState.__unsafe__getWithoutCapture()==="idle"&&(this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout))}getCameraState(){return this._cameraState.get()}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(eG)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return Array.from(this._getAllPagesQuery().get()).sort(Hs)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(e){return this.store.get(typeof e=="string"?e:e.id)}getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getCurrentPageShapeIdsSorted(){return Array.from(this.getCurrentPageShapeIds()).sort()}getPageShapeIds(e){const t=typeof e=="string"?e:e.id,n=this.store.query.exec("shape",{parentId:{eq:t}});return this.getShapeAndDescendantIds(n.map(s=>s.id))}setCurrentPage(e){const t=typeof e=="string"?e:e.id;return this.store.has(t)?(this.stopFollowingUser(),this.complete(),this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:t}]),this.setCamera(this.getCamera())},{history:"record-preserveRedoStack"})):(console.error("Tried to set the current page id to a page that doesn't exist."),this)}updatePage(e){return this.getIsReadonly()?this:this.getPage(e.id)?this.run(()=>this.store.update(e.id,n=>({...n,...e}))):this}createPage(e){return this.run(()=>{if(this.getIsReadonly()||this.getPages().length>=this.options.maxPages)return;const t=this.getPages(),n=rZ(e.name??"Page 1",t.map(i=>i.name));let s=e.index;(!s||t.some(i=>i.index===s))&&(s=Za(t[t.length-1].index));const o=ui.create({meta:{},...e,name:n,index:s});this.store.put([o])}),this}deletePage(e){const t=typeof e=="string"?e:e.id;return this.run(()=>{if(this.getIsReadonly())return;const n=this.getPages();if(n.length===1)return;const s=this.getPage(t);if(s){if(t===this.getCurrentPageId()){const o=n.findIndex(a=>a.id===t),i=n[o-1]??n[o+1];this.setCurrentPage(i.id)}this.store.remove([s.id])}}),this}duplicatePage(e,t=ui.createId()){if(this.getPages().length>=this.options.maxPages)return this;const n=typeof e=="string"?e:e.id,s=this.getPage(n);if(!s)return this;const o={...this.getCamera()},i=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(s.id));return this.run(()=>{var c;const a=this.getPages(),l=zf(s.index,(c=a[a.indexOf(s)+1])==null?void 0:c.index);if(this.createPage({name:s.name+" Copy",id:t,index:l}),this.setCurrentPage(t),this.setCamera(o),i)return this.putContentOntoCurrentPage(i)}),this}renamePage(e,t){const n=typeof e=="string"?e:e.id;return this.getIsReadonly()?this:(this.updatePage({id:n,name:t}),this)}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(e){return this.getIsReadonly()?this:e.length<=0?this:(this.run(()=>this.store.put(e),{history:"ignore"}),this)}updateAssets(e){return this.getIsReadonly()?this:e.length<=0?this:(this.run(()=>{this.store.put(e.map(t=>({...this.store.get(t.id),...t})))},{history:"ignore"}),this)}deleteAssets(e){if(this.getIsReadonly())return this;const t=typeof e[0]=="string"?e:e.map(n=>n.id);return t.length<=0?this:(this.run(()=>this.store.remove(t),{history:"ignore"}),this)}getAsset(e){return this.store.get(typeof e=="string"?e:e.id)}async resolveAssetUrl(e,t){if(!e)return null;const n=this.getAsset(e);if(!n)return null;const{screenScale:s=1,shouldResolveToOriginal:o=!1}=t,a=Math.max(.125,(u=>Math.pow(2,Math.ceil(Math.log2(u))))(s)),l="connection"in navigator?navigator.connection.effectiveType:null,c=this.getInstanceState().devicePixelRatio;return await this.store.props.assets.resolve(n,{screenScale:s||1,steppedScreenScale:a,dpr:c,networkEffectiveType:l,shouldResolveToOriginal:o})}async uploadAsset(e,t,n){return await this.store.props.assets.upload(e,t,n)}_getShapeGeometryCache(){return this.store.createComputedCache("bounds",e=>this.getShapeUtil(e).getGeometry(e),(e,t)=>e.props===t.props)}getShapeGeometry(e){return this._getShapeGeometryCache().get(typeof e=="string"?e:e.id)}_getShapeHandlesCache(){return this.store.createComputedCache("handles",e=>{var t,n;return(n=(t=this.getShapeUtil(e)).getHandles)==null?void 0:n.call(t,e)})}getShapeHandles(e){return this._getShapeHandlesCache().get(typeof e=="string"?e:e.id)}getShapeLocalTransform(e){const t=typeof e=="string"?e:e.id,n=this.getShape(t);if(!n)throw Error("Editor.getTransform: shape not found");return Ne.Identity().translate(n.x,n.y).rotate(n.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",e=>{if(Po(e.parentId))return this.getShapeLocalTransform(e);const t=this._getShapePageTransformCache().get(e.parentId)??Ne.Identity();return Ne.Compose(t,this.getShapeLocalTransform(e))})}getShapeParentTransform(e){const t=typeof e=="string"?e:e.id,n=this.getShape(t);return!n||Po(n.parentId)?Ne.Identity():this._getShapePageTransformCache().get(n.parentId)??Ne.Identity()}getShapePageTransform(e){const t=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(t)??Ne.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",e=>{const t=this._getShapePageTransformCache().get(e.id);return t?Ve.FromPoints(Ne.applyToPoints(t,this.getShapeGeometry(e).vertices)):new Ve})}getShapePageBounds(e){return this._getShapePageBoundsCache().get(typeof e=="string"?e:e.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",e=>{const t=this._getShapeMaskCache().get(e.id);if(!t)return;if(t.length===0)return"polygon(0px 0px, 0px 0px, 0px 0px)";const n=this._getShapePageTransformCache().get(e.id);return n?`polygon(${Ne.applyToPoints(Ne.Inverse(n),t).map(o=>`${o.x}px ${o.y}px`).join(",")})`:void 0})}getShapeClipPath(e){return this._getShapeClipPathCache().get(typeof e=="string"?e:e.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",e=>{if(Po(e.parentId))return;const t=this.getShapeAncestors(e.id).filter(s=>this.isShapeOfType(s,"frame"));return t.length===0?void 0:t.map(s=>this._getShapePageTransformCache().get(s.id).applyToPoints(this.getShapeGeometry(s).vertices)).reduce((s,o)=>{if(!(o&&s))return;const i=gR(s,o);return i?i.map(P.Cast):[]})})}getShapeMask(e){return this._getShapeMaskCache().get(typeof e=="string"?e:e.id)}getShapeMaskedPageBounds(e){return typeof e!="string"&&(e=e.id),this._getShapeMaskedPageBoundsCache().get(e)}_getShapeMaskedPageBoundsCache(){return this.store.createComputedCache("shapeMaskedPageBoundsCache",e=>{const t=this._getShapePageBoundsCache().get(e.id);if(!t)return;const n=this._getShapeMaskCache().get(e.id);if(n){if(n.length===0)return;const{corners:s}=t;if(s.every((i,a)=>i&&P.Equals(i,n[a])))return t.clone();const o=gR(n,s);return o?Ve.FromPoints(o):void 0}return t})}getShapeAncestors(e,t=[]){const n=typeof e=="string"?e:e.id,s=this.getShape(n);if(!s)return t;const o=s.parentId;if(Po(o))return t.reverse(),t;const i=this.store.get(o);return i?(t.push(i),this.getShapeAncestors(i,t)):t}findShapeAncestor(e,t){const n=typeof e=="string"?e:e.id,s=this.getShape(n);if(!s)return;const o=s.parentId;if(Po(o))return;const i=this.getShape(o);if(i)return t(i)?i:this.findShapeAncestor(i,t)}hasAncestor(e,t){const n=typeof e=="string"?e:e==null?void 0:e.id,s=n&&this.getShape(n);return s?s.parentId===t?!0:this.hasAncestor(this.getShapeParent(s),t):!1}findCommonAncestor(e,t){var l;if(e.length===0)return;const n=typeof e[0]=="string"?e:e.map(c=>c.id),s=kt(n.map(c=>this.getShape(c)));if(s.length===1){const c=s[0].parentId;return Po(c)?void 0:t?(l=this.findShapeAncestor(s[0],t))==null?void 0:l.id:c}const[o,...i]=s;let a=this.getShapeParent(o);for(;a;){if(t&&!t(a)){a=this.getShapeParent(a);continue}if(i.every(c=>this.hasAncestor(c,a.id)))return a.id;a=this.getShapeParent(a)}}isShapeOrAncestorLocked(e){const t=typeof e=="string"?this.getShape(e):e;return t===void 0?!1:t.isLocked?!0:this.isShapeOrAncestorLocked(this.getShapeParent(t))}_notVisibleShapes(){return dZ(this)}getCulledShapes(){const e=this._notVisibleShapes().get(),t=this.getSelectedShapeIds(),n=this.getEditingShapeId(),s=new Set(e);return n&&s.delete(n),t.forEach(o=>{s.delete(o)}),s}getCurrentPageBounds(){let e;return this.getCurrentPageShapeIdsSorted().forEach(t=>{const n=this.getShapeMaskedPageBounds(t);n&&(e?e=e.expand(n):e=n.clone())}),e}getSelectedShapeAtPoint(e){const t=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(n=>n.type!=="group"&&t.includes(n.id)).reverse().find(n=>this.isPointInShape(n,e,{hitInside:!0,margin:0}))}getShapeAtPoint(e,t={}){const n=this.getZoomLevel(),s=this.getViewportPageBounds(),{filter:o,margin:i=0,hitLocked:a=!1,hitLabels:l=!1,hitInside:c=!1,hitFrameInside:u=!1}=t;let p=1/0,f=null,m=1/0,v=null;const b=(t.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(S=>{if(S.isLocked&&!a||this.isShapeHidden(S)||this.isShapeOfType(S,"group"))return!1;const C=this.getShapeMask(S);return C&&!ai(e,C)?!1:o?o(S):!0});for(let S=b.length-1;S>=0;S--){const C=b[S],E=this.getShapeGeometry(C),T=E instanceof Fi,w=this.getPointInShapeSpace(C,e);if(this.isShapeOfType(C,"frame")||(this.isShapeOfType(C,"arrow")||this.isShapeOfType(C,"geo")&&C.props.fill==="none")&&C.props.text.trim()){for(const R of E.children)if(R.isLabel&&R.isPointInBounds(w))return C}if(this.isShapeOfType(C,"frame")){const R=E.distanceToPoint(w,c);if(Math.abs(R)<=i)return v||C;if(E.hitTestPoint(w,0,!0))return v||f||(u?C:void 0);continue}let M;if(T){let R=1/0;for(const D of E.children){if(D.isLabel&&!l)continue;const N=D.distanceToPoint(w,c);N<R&&(R=N)}M=R}else i===0&&(E.bounds.w<1||E.bounds.h<1)||E.bounds.containsPoint(w,i)?M=E.distanceToPoint(w,c):M=1/0;if(E.isClosed){if(M<=i){if(E.isFilled||T&&E.children[0].isFilled)return v||C;if(this.getShapePageBounds(C).contains(s))continue;if(Math.abs(M)<i)Math.abs(M)<m&&(m=Math.abs(M),v=C);else if(!v){const{area:R}=E;R<p&&(p=R,f=C)}}}else if(M<this.options.hitTestMargin/n)return C}return v||f||void 0}getShapesAtPoint(e,t={}){return this.getCurrentPageShapes().filter(n=>!this.isShapeHidden(n)&&this.isPointInShape(n,e,t))}isPointInShape(e,t,n={}){const{hitInside:s=!1,margin:o=0}=n,i=typeof e=="string"?e:e.id,a=this.getShapeMask(i);return a&&!ai(t,a)?!1:this.getShapeGeometry(i).hitTestPoint(this.getPointInShapeSpace(e,t),o,s)}getPointInShapeSpace(e,t){const n=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(n).clone().invert().applyToPoint(t)}getPointInParentSpace(e,t){const n=typeof e=="string"?e:e.id,s=this.getShape(n);if(!s)return new P(0,0);if(Po(s.parentId))return P.From(t);const o=this.getShapePageTransform(s.parentId);return o?o.clone().invert().applyToPoint(t):P.From(t)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),e=>this.store.get(e))}getCurrentPageShapesSorted(){const e=[],t=this.getSortedChildIdsForParent(this.getCurrentPageId());for(let n=0,s=t.length;n<s;n++)g8(this,t[n],e);return e}getCurrentPageRenderingShapesSorted(){const e=this.getCulledShapes();return this.getCurrentPageShapesSorted().filter(({id:t})=>!e.has(t)&&!this.isShapeHidden(t))}isShapeOfType(e,t){const n=typeof e=="string"?this.getShape(e):e;return n?n.type===t:!1}getShape(e){const t=typeof e=="string"?e:e.id;if(Oo(t))return this.store.get(t)}getShapeParent(e){const t=typeof e=="string"?e:e==null?void 0:e.id;if(!t)return;const n=this.getShape(t);if(!(n===void 0||!Oo(n.parentId)))return this.store.get(n.parentId)}getShapeNearestSibling(e,t){return t?t.parentId===e.parentId?t:this.findShapeAncestor(t,s=>s.parentId===e.parentId):void 0}isShapeInPage(e,t=this.getCurrentPageId()){const n=typeof e=="string"?e:e.id,s=this.getShape(n);if(!s)return!1;let o=!1;if(s.parentId===t)o=!0;else{let i=this.getShape(s.parentId);e:for(;i;){if(i.parentId===t){o=!0;break e}i=this.getShape(i.parentId)}}return o}getAncestorPageId(e){const t=typeof e=="string"?e:e==null?void 0:e.id,n=t&&this.getShape(t);if(n)return Po(n.parentId)?n.parentId:this.getAncestorPageId(this.getShape(n.parentId))}reparentShapes(e,t,n){const s=typeof e[0]=="string"?e:e.map(f=>f.id);if(s.length===0)return this;const o=[],i=Po(t)?Ne.Identity():this.getShapePageTransform(t),a=i.rotation();let l=[];const c=kt(this.getSortedChildIdsForParent(t).map(f=>this.getShape(f)));if(n){const f=c.find(m=>m.index===n);if(f){const m=c[c.indexOf(f)+1];m?l=Uh(n,m.index,s.length):l=Ux(n,s.length)}else{const m=c.sort(Hs).find(v=>v.index>n);m?l=Uh(n,m.index,s.length):l=Ux(n,s.length)}}else{const f=c.length&&c[c.length-1];l=f?Ux(f.index,s.length):$f(s.length)}const u=i.clone().invert(),p=kt(s.map(f=>this.getShape(f)));return this.run(()=>{for(let f=0;f<p.length;f++){const m=p[f],v=this.getShapePageTransform(m);if(!v)continue;const b=v.point();if(!b)continue;const S=u.applyToPoint(b),C=v.rotation()-a;o.push({id:m.id,type:m.type,parentId:t,x:S.x,y:S.y,rotation:C,index:l[f]})}this.updateShapes(o)},{ignoreShapeLock:!0}),this}getHighestIndexForParent(e){const t=typeof e=="string"?e:e.id,n=this._parentIdsToChildIds.get()[t];if(!n||n.length===0)return"a1";const s=this.getShape(n[n.length-1]);return Za(s.index)}getSortedChildIdsForParent(e){const t=typeof e=="string"?e:e.id,n=this._parentIdsToChildIds.get()[t];return n||Gl}visitDescendants(e,t){const n=typeof e=="string"?e:e.id,s=this.getSortedChildIdsForParent(n);for(const o of s)t(o)!==!1&&this.visitDescendants(o,t);return this}getShapeAndDescendantIds(e){const t=new Set;for(const n of e.map(s=>this.getShape(s)).sort(Hs))t.add(n.id),this.visitDescendants(n,s=>{t.add(s)});return t}getDroppingOverShape(e,t=[]){const n=this.getCurrentPageShapesSorted();for(let s=n.length-1;s>=0;s--){const o=n[s];if(this.isShapeHidden(o)||this.getSelectedShapeIds().includes(o.id)||!this.getShapeUtil(o).canDropShapes(o,t)||t.find(a=>a.id===o.id||this.hasAncestor(o,a.id)))continue;const i=this.getShapeMaskedPageBounds(o.id);if(i&&i.containsPoint(e)&&this.getShapeGeometry(o).hitTestPoint(this.getPointInShapeSpace(o,e),0,!0))return o}}getOutermostSelectableShape(e,t){const n=typeof e=="string"?e:e.id,s=this.getShape(n);let o=s,i=s;const a=this.getFocusedGroup();for(;i;){if(this.isShapeOfType(i,"group")&&(a==null?void 0:a.id)!==i.id&&!this.hasAncestor(a,i.id)&&((t==null?void 0:t(i))??!0))o=i;else if((a==null?void 0:a.id)===i.id)break;i=this.getShapeParent(i)}return o}_getBindingsIndexCache(){const e=lZ(this);return this.store.createComputedCache("bindingsIndex",t=>e.get().get(t.id))}getBinding(e){return this.store.get(e)}getBindingsFromShape(e,t){const n=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(n).filter(s=>s.fromId===n&&s.type===t)}getBindingsToShape(e,t){const n=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(n).filter(s=>s.toId===n&&s.type===t)}getBindingsInvolvingShape(e,t){const n=typeof e=="string"?e:e.id,s=this._getBindingsIndexCache().get(n)??Gl;return t?s.filter(o=>o.type===t):s}createBindings(e){const t=[];for(const n of e){const s=this.getShape(n.fromId),o=this.getShape(n.toId);if(!s||!o||!this.canBindShapes({fromShape:s,toShape:o,binding:n}))continue;const a=this.getBindingUtil(n.type).getDefaultProps(),l=this.store.schema.types.binding.create({...n,id:n.id??nu(),props:{...a,...n.props}});t.push(l)}return this.store.put(t),this}createBinding(e){return this.createBindings([e])}updateBindings(e){const t=[];for(const n of e){if(!n)continue;const s=this.getBinding(n.id);if(!s)continue;const o=Oa(s,n);if(o===s)continue;const i=this.getShape(o.fromId),a=this.getShape(o.toId);!i||!a||this.canBindShapes({fromShape:i,toShape:a,binding:o})&&t.push(o)}return this.store.put(t),this}updateBinding(e){return this.updateBindings([e])}deleteBindings(e,{isolateShapes:t=!1}={}){const n=e.map(s=>typeof s=="string"?s:s.id);return t?this.store.atomic(()=>{var s,o;for(const i of n){const a=this.getBinding(i);if(!a)continue;const l=this.getBindingUtil(a);(s=l.onBeforeIsolateFromShape)==null||s.call(l,{binding:a,removedShape:this.getShape(a.toId)}),(o=l.onBeforeIsolateToShape)==null||o.call(l,{binding:a,removedShape:this.getShape(a.fromId)}),this.store.remove([i])}}):this.store.remove(n),this}deleteBinding(e,t){return this.deleteBindings([e],t)}canBindShapes({fromShape:e,toShape:t,binding:n}){const s=typeof e=="string"?e:e.type,o=typeof t=="string"?t:t.type,i=typeof n=="string"?n:n.type,a={fromShapeType:s,toShapeType:o,bindingType:i};return s===o?this.getShapeUtil(s).canBind(a):this.getShapeUtil(s).canBind(a)&&this.getShapeUtil(o).canBind(a)}rotateShapesBy(e,t,n){const s=typeof e[0]=="string"?e:e.map(i=>i.id);if(s.length<=0)return this;const o=UL({editor:this,ids:s});return o?(Qy({delta:t,snapshot:o,editor:this,stage:"one-off",centerOverride:n==null?void 0:n.center}),this):this}getChangesToTranslateShape(e,t){var o,i,a;let n=e;const s=this.getShapeUtil(e);return n=Oa(n,((o=s.onTranslateStart)==null?void 0:o.call(s,n))??void 0),n=Oa(n,{id:e.id,type:e.type,x:t.x,y:t.y}),n=Oa(n,((i=s.onTranslate)==null?void 0:i.call(s,e,n))??void 0),n=Oa(n,((a=s.onTranslateEnd)==null?void 0:a.call(s,e,n))??void 0),n}nudgeShapes(e,t){const n=typeof e[0]=="string"?e:e.map(o=>o.id);if(n.length<=0)return this;const s=[];for(const o of n){const i=this.getShape(o),a=P.From(t),l=this.getShapeParentTransform(i);l&&a.rot(-l.rotation()),s.push(this.getChangesToTranslateShape(i,a.add(i)))}return this.updateShapes(s),this}duplicateShapes(e,t){return this.run(()=>{const n=typeof e[0]=="string"?e:e.map(f=>f.id);if(n.length<=0)return this;const s=new Set(n),o=this.getShapeAndDescendantIds(n),i=[...o].reverse(),a=new Map;for(const f of o)a.set(f,vn());const{shapesToCreateWithOriginals:l,bindingsToCreate:c}=MR(this,o,f=>{const m=[];for(const b of f){const S=this.getBinding(b);if(!S)continue;const C=nu();m.push({...S,id:C,fromId:Lo(a.get(S.fromId)),toId:Lo(a.get(S.toId))})}const v=[];for(const b of i){const S=Lo(a.get(b)),C=this.getShape(b);if(!C)continue;let E=0,T=0;if(t&&s.has(b)){const w=this.getShapeParentTransform(C),M=new P(t.x,t.y).rot(-w.rotation());E=M.x,T=M.y}v.push({shape:{...C,id:S,x:C.x+E,y:C.y+T,index:"a1",parentId:a.get(C.parentId)??C.parentId},originalShape:C})}return{shapesToCreateWithOriginals:v,bindingsToCreate:m}});l.forEach(({shape:f,originalShape:m})=>{const v=m.parentId,b=this.getSortedChildIdsForParent(v),S=b.indexOf(m.id),C=b[S+1],E=C?this.getShape(C):void 0,T=zf(m.index,E==null?void 0:E.index);f.index=T});const u=l.map(({shape:f})=>f);if(u.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage){xy(this);return}if(this.createShapes(u),this.createBindings(c),this.setSelectedShapes(kt(n.map(f=>a.get(f)))),t!==void 0){const f=this.getSelectionPageBounds(),m=this.getViewportPageBounds();f&&!m.contains(f)&&this.centerOnPoint(f.center,{animation:{duration:this.options.animationMediumMs}})}}),this}moveShapesToPage(e,t){const n=typeof e[0]=="string"?e:e.map(a=>a.id);if(n.length===0)return this;if(this.getIsReadonly())return this;const s=this.getCurrentPageId();if(t===s)return this;if(!this.store.has(t))return this;const o=this.getContentFromCurrentPage(n);if(!o)return this;if(this.getPageShapeIds(t).size+o.shapes.length>this.options.maxShapesPerPage)return xy(this,t),this;const i=this.getCamera().z;return this.run(()=>{this.deleteShapes(n),this.setCurrentPage(t),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(o,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:i}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(e){const t=typeof e[0]=="string"?e:e.map(i=>i.id);if(this.getIsReadonly()||t.length===0)return this;let n=!0,s=!0;const o=[];for(const i of t){const a=this.getShape(i);a&&(o.push(a),a.isLocked?s=!1:n=!1)}return this.run(()=>{s?(this.updateShapes(o.map(i=>({id:i.id,type:i.type,isLocked:!0}))),this.setSelectedShapes([])):n?this.updateShapes(o.map(i=>({id:i.id,type:i.type,isLocked:!1}))):this.updateShapes(o.map(i=>({id:i.id,type:i.type,isLocked:!0})))}),this}sendToBack(e){const t=typeof e[0]=="string"?e:e.map(s=>s.id),n=by(this,"toBack",t,{considerAllShapes:!0});return n&&this.updateShapes(n),this}sendBackward(e,t={}){const n=typeof e[0]=="string"?e:e.map(o=>o.id),s=by(this,"backward",n,t);return s&&this.updateShapes(s),this}bringForward(e,t={}){const n=typeof e[0]=="string"?e:e.map(o=>o.id),s=by(this,"forward",n,t);return s&&this.updateShapes(s),this}bringToFront(e){const t=typeof e[0]=="string"?e:e.map(s=>s.id),n=by(this,"toFront",t);return n&&this.updateShapes(n),this}flipShapes(e,t){const n=typeof e[0]=="string"?e:e.map(i=>i.id);if(this.getIsReadonly())return this;let s=kt(n.map(i=>this.getShape(i)));if(!s.length)return this;s=kt(s.map(i=>this.isShapeOfType(i,"group")?this.getSortedChildIdsForParent(i.id).map(a=>this.getShape(a)):i).flat());const o=Ve.Common(kt(s.map(i=>this.getShapePageBounds(i)))).center;return this.run(()=>{for(const i of s){const a=this.getShapeGeometry(i).bounds,l=this.getShapePageTransform(i.id);l&&this.resizeShape(i.id,{x:t==="horizontal"?-1:1,y:t==="vertical"?-1:1},{initialBounds:a,initialPageTransform:l,initialShape:i,mode:"scale_shape",isAspectRatioLocked:this.getShapeUtil(i).isAspectRatioLocked(i),scaleOrigin:o,scaleAxisRotation:0})}}),this}stackShapes(e,t,n){const s=typeof e[0]=="string"?e:e.map(b=>b.id);if(this.getIsReadonly())return this;const o=s.map(b=>this.getShape(b)).filter(b=>b?this.getShapeUtil(b).canBeLaidOut(b):!1),i=o.length;if(n===0&&i<3||i<2)return this;const a=Object.fromEntries(o.map(b=>[b.id,this.getShapePageBounds(b)]));let l,c,u,p;t==="horizontal"?(l="x",c="minX",u="maxX",p="width"):(l="y",c="minY",u="maxY",p="height");let f;if(n===0){const b=[];o.sort((C,E)=>a[C.id][c]-a[E.id][c]);for(let C=0;C<i-1;C++){const E=o[C],T=o[C+1],w=a[E.id],R=a[T.id][c]-w[u],D=b.find(N=>N.gap===R);D?D.count++:b.push({gap:R,count:1})}let S=0;b.forEach(C=>{C.count>S&&(S=C.count,f=C.gap)}),S===1&&(f=Math.max(0,b.reduce((C,E)=>C+E.gap*E.count,0)/(i-1)))}else f=n;const m=[];let v=a[o[0].id][u];return o.forEach((b,S)=>{var M,R;if(S===0)return;const C={x:0,y:0};C[l]=v+f-a[b.id][l];const E=this.getShapeParent(b),T=E?P.Rot(C,-this.getShapePageTransform(E).decompose().rotation):C,w=(R=(M=this.getShapeUtil(b)).onTranslateStart)==null?void 0:R.call(M,b);m.push(w?{...w,[l]:b[l]+T[l]}:{id:b.id,type:b.type,[l]:b[l]+T[l]}),v+=a[b.id][p]+f}),this.updateShapes(m),this}packShapes(e,t){var R,D;const n=typeof e[0]=="string"?e:e.map(N=>N.id);if(this.getIsReadonly())return this;if(n.length<2)return this;const s=n.map(N=>this.getShape(N)).filter(N=>N?this.getShapeUtil(N).canBeLaidOut(N):!1),o={},i={};let a,l,c=0;for(let N=0;N<s.length;N++)a=s[N],l=this.getShapePageBounds(a),o[a.id]=l,i[a.id]=l.clone(),c+=l.width*l.height;const u=Ve.Common(kt(Object.values(o))),p=u.width;s.sort((N,z)=>o[z.id].height-o[N.id].height);const f=Math.max(Math.ceil(Math.sqrt(c/.95)),p),m=[new Ve(u.x,u.y,f,1/0)];let v=0,b=0,S,C;for(let N=0;N<s.length;N++){a=s[N],l=i[a.id];for(let z=m.length-1;z>=0;z--)if(S=m[z],!(l.width>S.width||l.height>S.height)){l.x=S.x,l.y=S.y,b=Math.max(b,l.maxY),v=Math.max(v,l.maxX),l.width===S.width&&l.height===S.height?(C=m.pop(),z<m.length&&(m[z]=C)):l.height===S.height?(S.x+=l.width+t,S.width-=l.width+t):l.width===S.width?(S.y+=l.height+t,S.height-=l.height+t):(m.push(new Ve(S.x+(l.width+t),S.y,S.width-(l.width+t),l.height)),S.y+=l.height+t,S.height-=l.height+t);break}}const E=Ve.Common(Object.values(i)),T=P.Sub(u.center,E.center);let w;const M=[];for(let N=0;N<s.length;N++){a=s[N],l=o[a.id],w=i[a.id];const z=P.Sub(w.point,l.point).add(T),L=this.getShapeParentTransform(a);L&&z.rot(-L.rotation());const B={id:a.id,type:a.type,x:a.x+z.x,y:a.y+z.y},K=(D=(R=this.getShapeUtil(a)).onTranslateStart)==null?void 0:D.call(R,{...a,...B});K?M.push({...B,...K}):M.push(B)}return M.length&&this.updateShapes(M),this}alignShapes(e,t){const n=typeof e[0]=="string"?e:e.map(l=>l.id);if(this.getIsReadonly())return this;if(n.length<2)return this;const s=kt(n.map(l=>this.getShape(l))),o=Object.fromEntries(s.map(l=>[l.id,this.getShapePageBounds(l)])),i=Ve.Common(kt(Object.values(o))),a=[];return s.forEach(l=>{const c=o[l.id];if(!c)return;const u={x:0,y:0};switch(t){case"top":{u.y=i.minY-c.minY;break}case"center-vertical":{u.y=i.midY-c.minY-c.height/2;break}case"bottom":{u.y=i.maxY-c.minY-c.height;break}case"left":{u.x=i.minX-c.minX;break}case"center-horizontal":{u.x=i.midX-c.minX-c.width/2;break}case"right":{u.x=i.maxX-c.minX-c.width;break}}const p=this.getShapeParent(l),f=p?P.Rot(u,-this.getShapePageTransform(p).decompose().rotation):u;a.push(this.getChangesToTranslateShape(l,P.Add(l,f)))}),this.updateShapes(a),this}distributeShapes(e,t){const n=typeof e[0]=="string"?e:e.map(E=>E.id);if(this.getIsReadonly())return this;if(n.length<3)return this;const s=n.length,o=kt(n.map(E=>this.getShape(E))),i=Object.fromEntries(o.map(E=>[E.id,this.getShapePageBounds(E)]));let a,l,c,u,p;t==="horizontal"?(a="x",l="minX",c="maxX",u="midX",p="width"):(a="y",l="minY",c="maxY",u="midY",p="height");const f=[],m=o.sort((E,T)=>i[E.id][l]-i[T.id][l])[0],v=o.sort((E,T)=>i[T.id][c]-i[E.id][c])[0],b=i[m.id][u],S=(i[v.id][u]-b)/(s-1),C=b+S;return o.filter(E=>E!==m&&E!==v).sort((E,T)=>i[E.id][u]-i[T.id][u]).forEach((E,T)=>{const w={x:0,y:0};w[a]=C+S*T-i[E.id][p]/2-i[E.id][a];const M=this.getShapeParent(E),R=M?P.Rot(w,-this.getShapePageTransform(M).rotation()):w;f.push(this.getChangesToTranslateShape(E,P.Add(E,R)))}),this.updateShapes(f),this}stretchShapes(e,t){const n=typeof e[0]=="string"?e:e.map(l=>l.id);if(this.getIsReadonly())return this;if(n.length<2)return this;const s=kt(n.map(l=>this.getShape(l))),o=Object.fromEntries(n.map(l=>[l,this.getShapeGeometry(l).bounds])),i=Object.fromEntries(n.map(l=>[l,this.getShapePageBounds(l)])),a=Ve.Common(kt(Object.values(i)));switch(t){case"vertical":{this.run(()=>{for(const l of s){if(this.getShapePageTransform(l).rotation()%xn)continue;const u=o[l.id],p=i[l.id],f=new P(0,a.minY-p.minY),m=this.getShapeParentTransform(l);m&&f.rot(-m.rotation());const{x:v,y:b}=P.Add(f,l);this.updateShapes([{id:l.id,type:l.type,x:v,y:b}]);const S=new P(1,a.height/p.height);this.resizeShape(l.id,S,{initialBounds:u,scaleOrigin:new P(p.center.x,a.minY),isAspectRatioLocked:this.getShapeUtil(l).isAspectRatioLocked(l),scaleAxisRotation:0})}});break}case"horizontal":{this.run(()=>{for(const l of s){const c=o[l.id],u=i[l.id];if(this.getShapePageTransform(l).rotation()%xn)continue;const f=new P(a.minX-u.minX,0),m=this.getShapeParentTransform(l);m&&f.rot(-m.rotation());const{x:v,y:b}=P.Add(f,l);this.updateShapes([{id:l.id,type:l.type,x:v,y:b}]);const S=new P(a.width/u.width,1);this.resizeShape(l.id,S,{initialBounds:c,scaleOrigin:new P(a.minX,u.center.y),isAspectRatioLocked:this.getShapeUtil(l).isAspectRatioLocked(l),scaleAxisRotation:0})}});break}}return this}resizeShape(e,t,n={}){var m,v,b;const s=typeof e=="string"?e:e.id;if(this.getIsReadonly())return this;Number.isFinite(t.x)||(t=new P(1,t.y)),Number.isFinite(t.y)||(t=new P(t.x,1));const o=n.initialShape??this.getShape(s);if(!o)return this;const i=n.scaleOrigin??((m=this.getShapePageBounds(s))==null?void 0:m.center);if(!i)return this;const a=n.initialPageTransform?Ne.Cast(n.initialPageTransform):this.getShapePageTransform(s);if(!a)return this;const l=a.rotation();if(l==null)return this;const c=n.scaleAxisRotation??l,u=n.initialBounds??this.getShapeGeometry(s).bounds;if(!u)return this;const p=n.isAspectRatioLocked??this.getShapeUtil(o).isAspectRatioLocked(o);if(!D5(l,c))return this._resizeUnalignedShape(s,t,{...n,initialBounds:u,scaleOrigin:i,scaleAxisRotation:c,initialPageTransform:a,isAspectRatioLocked:p,initialShape:o});const f=this.getShapeUtil(o);if(p&&(Math.abs(t.x)>Math.abs(t.y)?t=new P(t.x,Math.sign(t.y)*Math.abs(t.x)):t=new P(Math.sign(t.x)*Math.abs(t.y),t.y)),f.onResize&&f.canResize(o)){const S=this._scalePagePoint(Ne.applyToPoint(a,new P(0,0)),i,t,c),C=this.getPointInParentSpace(o.id,S),E=new P(t.x,t.y),T=Jc((l-c)%Math.PI,0);E.x=T?t.x:t.y,E.y=T?t.y:t.x;const w=Ne.applyToPoint(a,new P),{x:M,y:R}=this.getPointInParentSpace(o.id,w);let D=o;n.skipStartAndEndCallbacks||(D=Oa(o,((v=f.onResizeStart)==null?void 0:v.call(f,o))??void 0)),D=Oa(D,{id:s,type:o.type,x:C.x,y:C.y,...f.onResize({...o,x:M,y:R},{newPoint:C,handle:n.dragHandle??"bottom_right",mode:n.mode??"scale_shape",scaleX:E.x,scaleY:E.y,initialBounds:u,initialShape:o})}),n.skipStartAndEndCallbacks||(D=Oa(D,((b=f.onResizeEnd)==null?void 0:b.call(f,o,D))??void 0)),this.updateShapes([D])}else{const S=Ne.applyToPoint(a,u.center),C=this._scalePagePoint(S,i,t,c),E=this.getPointInParentSpace(o.id,S),T=this.getPointInParentSpace(o.id,C),w=P.Sub(T,E);this.updateShapes([{id:s,type:o.type,x:o.x+w.x,y:o.y+w.y}])}return this}_scalePagePoint(e,t,n,s){const o=P.RotWith(e,t,-s).sub(t),i=P.MulV(o,n);return P.Add(i,t).rotWith(t,s)}_resizeUnalignedShape(e,t,n){const{type:s}=n.initialShape,o=new P(t.x,t.y);if(Math.abs(t.x)>Math.abs(t.y)?o.x=Math.sign(t.x)*Math.abs(t.y):o.y=Math.sign(t.y)*Math.abs(t.x),this.resizeShape(e,o,{initialShape:n.initialShape,initialBounds:n.initialBounds,isAspectRatioLocked:n.isAspectRatioLocked}),Math.sign(t.x)*Math.sign(t.y)<0){let{rotation:S}=Ne.Decompose(n.initialPageTransform);S-=2*S,this.updateShapes([{id:e,type:s,rotation:S}])}const i=Ne.applyToPoint(n.initialPageTransform,n.initialBounds.center),a=this._scalePagePoint(i,n.scaleOrigin,t,n.scaleAxisRotation),l=this.getShapePageBounds(e),c=this.getShapePageTransform(e),u=l.center,p=c.point();if(!u||!p)return this;const f=P.Sub(a,u),m=P.Add(p,f),{x:v,y:b}=this.getPointInParentSpace(e,m);return this.updateShapes([{id:e,type:s,x:v,y:b}]),this}getInitialMetaForShape(e){return{}}createShape(e){return this.createShapes([e]),this}createShapes(e){if(!Array.isArray(e))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");if(this.getIsReadonly())return this;if(e.length<=0)return this;const t=this.getCurrentPageShapeIds();if(e.length+t.size>this.options.maxShapesPerPage)return xy(this),this;const s=this.getFocusedGroupId();return this.run(()=>{var u,p;const o=this.getCurrentPageShapesSorted(),i=e.map(f=>{if(f.id||(f={id:vn(),...f}),!f.parentId||!(this.store.has(f.parentId)||e.some(m=>m.id===f.parentId))){let m=this.getFocusedGroupId();for(let b=o.length-1;b>=0;b--){const S=o[b];if(!this.isShapeHidden(S)&&this.getShapeUtil(S).canReceiveNewChildrenOfType(S,f.type)&&this.isPointInShape(S,{x:f.x??0,y:f.y??0},{margin:0,hitInside:!0})){m=S.id;break}}const v=f.parentId;if(m===f.id&&(m=s),m!==v&&(f={...f},f.parentId=m,Oo(m))){const b=this.getPointInShapeSpace(this.getShape(m),{x:f.x??0,y:f.y??0});f.x=b.x,f.y=b.y,f.rotation=-this.getShapePageTransform(m).rotation()+(f.rotation??0)}}return f}),a=new Map,l=[],{opacityForNextShape:c}=this.getInstanceState();for(const f of i){const m=this.getShapeUtil(f);let v=f.index;if(!v){const E=f.parentId??s;a.has(E)||a.set(E,this.getHighestIndexForParent(E)),v=a.get(E),a.set(E,Za(v))}const b=m.getDefaultProps();for(const[E,T]of this.styleProps[f.type])b[T]=this.getStyleForNextShape(E);let S=this.store.schema.types.shape.create({...f,index:v,opacity:f.opacity??c,parentId:f.parentId??s,props:"props"in f?{...b,...f.props}:b});if(S.index===void 0)throw Error("no index!");const C=(p=(u=this.getShapeUtil(S)).onBeforeCreate)==null?void 0:p.call(u,S);C&&(S=C),l.push(S)}l.forEach(f=>{f.meta={...this.getInitialMetaForShape(f),...f.meta}}),this.store.put(l)}),this}animateShape(e,t={animation:K1}){return this.animateShapes([e],t)}animateShapes(e,t={animation:K1}){if(!t.animation)return this;const{duration:n=500,easing:s=ss.linear}=t.animation,o=Cn();let i=n,a;const l=[];let c,u;for(let f=0,m=e.length;f<m;f++){if(c=e[f],!c)continue;const v=this.getShape(c.id);v&&(u={start:Kn(v),end:Oa(Kn(v),c)},l.push(u),this.animatingShapes.set(v.id,o))}const p=f=>{var S,C;if(i-=f,i<0){const{animatingShapes:E}=this,T=e.filter(w=>w&&E.get(w.id)===o);T.length&&this.updateShapes(T),this.off("tick",p);return}a=s(1-i/n);const{animatingShapes:m}=this,v=[];let b;for(let E=0,T=l.length;E<T;E++){const{start:w,end:M}=l[E];b=m.get(w.id),b===o&&v.push({...M,x:w.x+(M.x-w.x)*a,y:w.y+(M.y-w.y)*a,opacity:w.opacity+(M.opacity-w.opacity)*a,rotation:w.rotation+(M.rotation-w.rotation)*a,props:((C=(S=this.getShapeUtil(M)).getInterpolatedProps)==null?void 0:C.call(S,w,M,a))??M.props})}this._updateShapes(v)};return this.on("tick",p),this}groupShapes(e,t={}){var v;const{groupId:n=vn(),select:s=!0}=t;if(!Array.isArray(e))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getIsReadonly())return this;const o=typeof e[0]=="string"?e:e.map(b=>b.id);if(o.length<=1)return this;const i=kt((this._shouldIgnoreShapeLock?o:this._getUnlockedShapeIds(o)).map(b=>this.getShape(b))),a=i.sort(Hs).map(b=>b.id),l=Ve.Common(kt(i.map(b=>this.getShapePageBounds(b)))),{x:c,y:u}=l.point,p=this.findCommonAncestor(i)??this.getCurrentPageId();if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const f=i.filter(b=>b.parentId===p).sort(Hs),m=(v=f[f.length-1])==null?void 0:v.index;return this.run(()=>{this.createShapes([{id:n,type:"group",parentId:p,index:m,x:c,y:u,opacity:1,props:{}}]),this.reparentShapes(a,n),s&&this.select(n)}),this}ungroupShapes(e,t={}){if(this.getIsReadonly())return this;const{select:n=!0}=t,s=typeof e[0]=="string"?e:e.map(l=>l.id),o=kt((this._shouldIgnoreShapeLock?s:this._getUnlockedShapeIds(s)).map(l=>this.getShape(l)));if(o.length===0)return this;if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const i=new Set,a=[];return o.forEach(l=>{this.isShapeOfType(l,"group")?a.push(l):i.add(l.id)}),a.length===0?this:(this.run(()=>{let l;for(let c=0,u=a.length;c<u;c++){l=a[c];const p=this.getSortedChildIdsForParent(l.id);for(let f=0,m=p.length;f<m;f++)i.add(p[f]);this.reparentShapes(p,l.parentId,l.index)}this.deleteShapes(a.map(c=>c.id)),n&&this.select(...i)}),this)}updateShape(e){return this.updateShapes([e]),this}updateShapes(e){const t=Array(e.length);for(let n=0,s=e.length;n<s;n++){const o=e[n];if(!o)continue;const i=this.getShape(o.id);if(i){if(!this._shouldIgnoreShapeLock){if(i.isLocked){if(!(Object.hasOwn(o,"isLocked")&&!o.isLocked))continue}else if(this.isShapeOrAncestorLocked(i))continue}this.animatingShapes.delete(o.id),t.push(o)}}return this._updateShapes(t),this}_updateShapes(e){this.getIsReadonly()||this.run(()=>{var o,i;const t=[];let n,s;for(let a=0,l=e.length;a<l;a++){const c=e[a];c&&(n=this.getShape(c.id),n&&(s=Oa(n,c),s!==n&&(s=((i=(o=this.getShapeUtil(n)).onBeforeUpdate)==null?void 0:i.call(o,n,s))??s,t.push(s))))}this.store.put(t)})}_getUnlockedShapeIds(e){return e.filter(t=>{var n;return!((n=this.getShape(t))!=null&&n.isLocked)})}deleteShapes(e){if(this.getIsReadonly())return this;if(!Array.isArray(e))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");const t=typeof e[0]=="string"?e:e.map(o=>o.id),n=this._shouldIgnoreShapeLock?t:this._getUnlockedShapeIds(t);if(n.length===0)return this;const s=new Set(n);for(const o of n)this.visitDescendants(o,i=>{s.add(i)});return this.run(()=>this.store.remove([...s]))}deleteShape(e){return this.deleteShapes([typeof e=="string"?e:e.id]),this}_extractSharedStyles(e,t){if(this.isShapeOfType(e,"group")){const n=this._parentIdsToChildIds.get()[e.id];if(!n)return;for(let s=0,o=n.length;s<o;s++)this._extractSharedStyles(this.getShape(n[s]),t)}else for(const[n,s]of this.styleProps[e.type])t.applyValue(n,Ws(e.props,s))}_getSelectionSharedStyles(){const e=this.getSelectedShapes(),t=new _E;for(const n of e)this._extractSharedStyles(n,t);return t}getStyleForNextShape(e){const t=this.getInstanceState().stylesForNextShape[e.id];return t===void 0?e.defaultValue:t}getShapeStyleIfExists(e,t){const n=this.styleProps[e.type].get(t);if(n!==void 0)return Ws(e.props,n)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._getSelectionSharedStyles();const e=this.root.getCurrent(),t=new _E;if(!e)return t;if(e.shapeType)for(const n of this.styleProps[e.shapeType].keys())t.applyValue(n,this.getStyleForNextShape(n));return t}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){const e=[],t=s=>{const o=this.getShape(s);if(o)if(this.isShapeOfType(o,"group"))for(const i of this.getSortedChildIdsForParent(o.id))t(i);else e.push(o)};for(const s of this.getSelectedShapeIds())t(s);let n=null;for(const s of e)if(n===null)n=s.opacity;else if(n!==s.opacity)return{type:"mixed"};if(n!==null)return{type:"shared",value:n}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(e,t){return this.updateInstanceState({opacityForNextShape:e},t),this}setOpacityForSelectedShapes(e){const t=this.getSelectedShapes();if(t.length>0){const n=[],s=o=>{if(this.isShapeOfType(o,"group")){const i=this.getSortedChildIdsForParent(o);for(const a of i)s(this.getShape(a))}else n.push(o)};for(const o of t)s(o);this.updateShapes(n.map(o=>({id:o.id,type:o.type,opacity:e})))}return this}setStyleForNextShapes(e,t,n){const s=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...s,[e.id]:t}},n),this}setStyleForSelectedShapes(e,t){const n=this.getSelectedShapes();if(n.length>0){const s=[],o=i=>{if(this.isShapeOfType(i,"group")){const a=this.getSortedChildIdsForParent(i.id);for(const l of a)o(this.getShape(l))}else{const a=this.getShapeUtil(i),l=this.styleProps[i.type].get(e);if(l){const c={id:i.id,type:i.type,props:{[l]:t}};s.push({util:a,originalShape:i,updatePartial:c})}}};for(const i of n)o(i);this.updateShapes(s.map(({updatePartial:i})=>i))}return this}registerExternalAssetHandler(e,t){return this.externalAssetContentHandlers[e]=t,this}createTemporaryAssetPreview(e,t){if(this.temporaryAssetPreview.has(e))return this.temporaryAssetPreview.get(e);const n=URL.createObjectURL(t);return this.temporaryAssetPreview.set(e,n),setTimeout(()=>{this.temporaryAssetPreview.delete(e),URL.revokeObjectURL(n)},this.options.temporaryAssetPreviewLifetimeMs),n}getTemporaryAssetPreview(e){return this.temporaryAssetPreview.get(e)}async getAssetForExternalContent(e){var t,n;return await((n=(t=this.externalAssetContentHandlers)[e.type])==null?void 0:n.call(t,e))}hasExternalAssetHandler(e){return!!this.externalAssetContentHandlers[e]}registerExternalContentHandler(e,t){return this.externalContentHandlers[e]=t,this}async putExternalContent(e){var t,n;return(n=(t=this.externalContentHandlers)[e.type])==null?void 0:n.call(t,e)}getContentFromCurrentPage(e){const t=typeof e[0]=="string"?e:e.map(s=>s.id);if(!t||t.length===0)return;const n=this.getShapeAndDescendantIds(t);return MR(this,n,s=>{const o=[];for(const u of s){const p=this.getBinding(u);p&&o.push(p)}const i=[],a=[];for(const u of n){const p=this.getShape(u);if(!p)continue;if(!n.has(p.parentId)){const m=this.getShapePageTransform(p.id),v=m.point();a.push({...p,x:v.x,y:v.y,rotation:m.rotation(),parentId:this.getCurrentPageId()}),i.push(p.id)}else a.push(p)}const l=[],c=new Set;for(const u of a){if(!("assetId"in u.props))continue;const p=u.props.assetId;if(!p||c.has(p))continue;c.add(p);const f=this.getAsset(p);f&&l.push(f)}return{schema:this.store.schema.serialize(),shapes:a,rootShapeIds:i,bindings:o,assets:l}})}async resolveAssetsInContent(e){if(!e)return;const t=[];return await Promise.allSettled(e.assets.map(async n=>{var s,o,i;if((n.type==="image"||n.type==="video")&&!((s=n.props.src)!=null&&s.startsWith("data:image"))&&!((o=n.props.src)!=null&&o.startsWith("data:video"))&&!((i=n.props.src)!=null&&i.startsWith("http"))){const a=Kn(n),l=await this.store.props.assets.resolve(n,{screenScale:1,steppedScreenScale:1,dpr:1,networkEffectiveType:null,shouldResolveToOriginal:!0});a.props.src=await aa.blobToDataUrl(await al(l).then(c=>c.blob())),t.push(a)}else t.push(n)})),e.assets=t,e}putContentOntoCurrentPage(e,t={}){var L,B,K;if(this.getIsReadonly())return this;if(!e.schema)throw Error(`Could not put content:
content is missing a schema.`);const{select:n=!1,preserveIds:s=!1,preservePosition:o=!1}=t;let{point:i=void 0}=t;const a=this.getCurrentPageId(),{rootShapeIds:l}=e,c=[],u=[],p=[],f={store:{...Object.fromEntries(e.assets.map(O=>[O.id,O])),...Object.fromEntries(e.shapes.map(O=>[O.id,O])),...Object.fromEntries(((L=e.bindings)==null?void 0:L.map(O=>[O.id,O]))??[])},schema:e.schema},m=this.store.schema.migrateStoreSnapshot(f);if(m.type==="error")throw Error("Could not put content: could not migrate content");for(const O of Object.values(m.value))switch(O.typeName){case"asset":{c.push(O);break}case"shape":{u.push(O);break}case"binding":{p.push(O);break}}const v=new Map(s?u.map(O=>[O.id,O.id]):u.map(O=>[O.id,vn()])),b=new Map(s?p.map(O=>[O.id,O.id]):p.map(O=>[O.id,nu()]));let S=this.getCurrentPageId(),C=1/0,E=[];for(const O of this.getSelectedShapes()){if(C===0)break;const U=this.isShapeOfType(O,"frame"),X=this.getShapeAncestors(O);U&&X.push(O);const H=U?X.length+1:X.length;if(H<C)C=H,E=X,S=U?O.id:O.parentId;else if(H===C){if(E.length!==X.length)throw Error(`Ancestors: ${E.length} !== ${X.length}`);if(E.length===0){S=a;break}else{S=a;for(let ee=0;ee<E.length&&X[ee]===E[ee];ee++)S=X[ee].id}}}let T=!1;if(!Po(S)){const O=this.getShape(S);if(O){if(!this.getViewportPageBounds().includes(this.getShapePageBounds(O)))S=a;else if(l.length===1){const U=u.find(X=>X.id===l[0]);this.isShapeOfType(O,"frame")&&this.isShapeOfType(U,"frame")&&U.props.w===(O==null?void 0:O.props.w)&&U.props.h===(O==null?void 0:O.props.h)&&(T=!0)}}else S=a}T||(T=v.has(S)),T&&(S=this.getShape(S).parentId);let w=this.getHighestIndexForParent(S);const M=[],R=u.map(O=>{const U=v.get(O.id),X={...O,id:U};return l.includes(O.id)&&(X.parentId=a,M.push(X)),v.has(X.parentId)?X.parentId=v.get(O.parentId):(l.push(X.id),X.index=w,w=Za(w)),X});if(R.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)return xy(this),this;const D=p.map(O=>({...O,id:Lo(b.get(O.id)),fromId:Lo(v.get(O.fromId)),toId:Lo(v.get(O.toId))})),N=[],z=[];for(const O of c)this.store.has(O.id)||((O.type==="image"&&((B=O.props.src)!=null&&B.startsWith("data:image"))||O.type==="video"&&((K=O.props.src)!=null&&K.startsWith("data:video")))&&(z.push(Kn(O)),O.props.src=null),N.push(O));return Promise.allSettled(z.map(async O=>{const U=await QX(O.props.src,O.props.name,O.props.mimeType??"image/png"),X=await this.getAssetForExternalContent({type:"file",file:U,assetId:O.id});if(!X){this.deleteAssets([O.id]);return}this.updateAssets([{...X,id:O.id}])})),this.run(()=>{N.length>0&&this.createAssets(N),this.createShapes(R),this.createBindings(D),n&&this.select(...M.map(ee=>ee.id)),S!==a&&this.reparentShapes(M.map(ee=>ee.id),S);const O=R.map(ee=>this.getShape(ee.id)),U=Ve.Common(O.map(ee=>this.getShapePageBounds(ee)));if(i===void 0)if(Po(S)){const ee=this.getViewportPageBounds();o||ee.includes(Ve.From(U))?i=U.center:i=ee.center}else{const ee=this.getShape(S);i=Ne.applyToPoint(this.getShapePageTransform(ee),this.getShapeGeometry(ee).bounds.center)}if(M.length===1){const ee=M[0];if(this.isShapeOfType(ee,"frame"))for(;this.getShapesAtPoint(i).some(J=>this.isShapeOfType(J,"frame")&&J.props.w===ee.props.w&&J.props.h===ee.props.h);)i.x+=U.w+16}const X=Ve.Common(kt(M.map(({id:ee})=>this.getShapePageBounds(ee)))).center,H=P.Sub(i,X);this.updateShapes(M.map(({id:ee})=>{const J=this.getShape(ee),ne=this.getShapeParentTransform(ee).decompose().rotation,ae=P.Rot(H,-ne);return{id:J.id,type:J.type,x:J.x+ae.x,y:J.y+ae.y}}))}),this}async getSvgElement(e,t={}){const n=typeof e[0]=="string"?e:e.map(s=>s.id);if(n.length!==0)return YX(this,n,t)}async getSvgString(e,t={}){const n=await this.getSvgElement(e,t);return n?{svg:new XMLSerializer().serializeToString(n.svg),width:n.width,height:n.height}:void 0}async getSvg(e,t={}){const n=await this.getSvgElement(e,t);if(n)return n.svg}_updateInputsFromEvent(e){const{pointerVelocity:t,previousScreenPoint:n,previousPagePoint:s,currentScreenPoint:o,currentPagePoint:i}=this.inputs,{screenBounds:a}=this.store.unsafeGetWithoutCapture(oo),{x:l,y:c,z:u}=ly(()=>this.getCamera()),p=e.point.x-a.x,f=e.point.y-a.y,m=e.point.z??.5;n.setTo(o),s.setTo(i),o.set(p,f);const v=p/u-l,b=f/u-c;isFinite(v)&&isFinite(b)&&i.set(v,b,m),this.inputs.isPen=e.type==="pointer"&&e.isPen,(e.name==="pointer_down"||this.inputs.isPinching)&&(t.set(0,0),this.inputs.originScreenPoint.setTo(o),this.inputs.originPagePoint.setTo(i)),this.run(()=>{var S;this.store.put([{id:Vv,typeName:"pointer",x:i.x,y:i.y,lastActivityTimestamp:e.type==="pointer"&&e.pointerId===qj.CAMERA_MOVE?((S=this.store.unsafeGetWithoutCapture(Vv))==null?void 0:S.lastActivityTimestamp)??this._tickManager.now:this._tickManager.now,meta:{}}])},{history:"ignore"})}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}focus({focusContainer:e=!0}={}){return this.getIsFocused()?this:(e&&this.focusManager.focus(),this.updateInstanceState({isFocused:!0}),this)}blur({blurContainer:e=!0}={}){return this.getIsFocused()?(e?this.focusManager.blur():this.complete(),this.updateInstanceState({isFocused:!1}),this):this}getIsFocused(){return this.getInstanceState().isFocused}getIsReadonly(){return this.getInstanceState().isReadonly}getSnapshot(){return QY(this.store)}loadSnapshot(e,t){return mL(this.store,e,t),this}_zoomToFitPageContentAt100Percent(){const e=this.getCurrentPageBounds();e&&this.zoomToBounds(e,{immediate:!0,targetZoom:this.getBaseZoom()})}_navigateToDeepLink(e){this.run(()=>{switch(e.type){case"page":{const t=this.getPage(e.pageId);t&&this.setCurrentPage(t),this._zoomToFitPageContentAt100Percent();return}case"shapes":{const t=kt(e.shapeIds.map(i=>this.getShape(i))),n={};for(const i of t){const a=this.getAncestorPageId(i);a&&(n[a]??(n[a]=[]),n[a].push(i))}const[s,o]=Object.entries(n).sort(([i,a],[l,c])=>c.length-a.length)[0]??["",[]];if(!s||!o.length)this._zoomToFitPageContentAt100Percent();else{this.setCurrentPage(s);const i=Ve.Common(o.map(a=>this.getShapePageBounds(a)));this.zoomToBounds(i,{immediate:!0,targetZoom:this.getBaseZoom()})}return}case"viewport":{if(e.pageId){if(!this.getPage(e.pageId)){this._zoomToFitPageContentAt100Percent();return}this.setCurrentPage(e.pageId)}this.zoomToBounds(e.bounds,{immediate:!0,inset:0});return}default:rs(e)}})}navigateToDeepLink(e){if(e&&"type"in e)return this._navigateToDeepLink(e),this;const n=new URL((e==null?void 0:e.url)??window.location.href).searchParams.get((e==null?void 0:e.param)??"d");if(!n)return this._zoomToFitPageContentAt100Percent(),this;try{this._navigateToDeepLink(nZ(n))}catch(s){console.warn(s),this._zoomToFitPageContentAt100Percent()}return this}createDeepLink(e){const t=new URL((e==null?void 0:e.url)??window.location.href);return t.searchParams.set((e==null?void 0:e.param)??"d",tZ((e==null?void 0:e.to)??{type:"viewport",pageId:this.options.maxPages===1?void 0:this.getCurrentPageId(),bounds:this.getViewportPageBounds()})),t}registerDeepLinkListener(e){if(e!=null&&e.getUrl&&!(e!=null&&e.onChange))throw Error("[tldraw:urlStateSync] If you specify getUrl, you must also specify the onChange callback.");const t=Ie("url with state",()=>{var l,c;const i=((l=e==null?void 0:e.getUrl)==null?void 0:l.call(e,this))??window.location.href;return this.createDeepLink({param:e==null?void 0:e.param,url:i,to:(c=e==null?void 0:e.getTarget)==null?void 0:c.call(e,this)}).toString()}),n=(e==null?void 0:e.onChange)??(()=>{var a;const i=this.createDeepLink({param:e==null?void 0:e.param,to:(a=e==null?void 0:e.getTarget)==null?void 0:a.call(e,this)});window.history.replaceState({},document.title,i.toString())}),s=z0(i=>i(),(e==null?void 0:e.debounceMs)??500),o=nl("update url on state change",()=>n(new URL(t.get()),this),{scheduleEffect:s});return()=>{o(),s.cancel()}}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}_setShiftKeyTimeout(){this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:Gs(this.inputs),code:"ShiftLeft"})}_setAltKeyTimeout(){this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:Gs(this.inputs),code:"AltLeft"})}_setCtrlKeyTimeout(){this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:Gs(this.inputs),code:"ControlLeft"})}_setMetaKeyTimeout(){this.inputs.metaKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Meta",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:Gs(this.inputs),code:"MetaLeft"})}dispatch(e){return this._pendingEventsForNextTick.push(e),e.type==="pointer"&&e.name==="pointer_move"||e.type==="wheel"||e.type==="pinch"||this._flushEventsForTick(0),this}_flushEventsForTick(e){this.run(()=>{if(this._pendingEventsForNextTick.length>0){const t=[...this._pendingEventsForNextTick];this._pendingEventsForNextTick.length=0;for(const n of t)this._flushEventForTick(n)}e>0&&this.root.handleEvent({type:"misc",name:"tick",elapsed:e}),this.scribbles.tick(e)})}_flushEventForTick(e){if(this.getCrashingError())return this;const{inputs:t}=this,{type:n}=e;if(e.type==="misc"){(e.name==="cancel"||e.name==="complete")&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0}))),this.root.handleEvent(e);return}e.shiftKey?(clearTimeout(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,t.shiftKey=!0):!e.shiftKey&&t.shiftKey&&this._shiftKeyTimeout===-1&&(this._shiftKeyTimeout=this.timers.setTimeout(this._setShiftKeyTimeout,150)),e.altKey?(clearTimeout(this._altKeyTimeout),this._altKeyTimeout=-1,t.altKey=!0):!e.altKey&&t.altKey&&this._altKeyTimeout===-1&&(this._altKeyTimeout=this.timers.setTimeout(this._setAltKeyTimeout,150)),e.ctrlKey?(clearTimeout(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,t.ctrlKey=!0):!e.ctrlKey&&t.ctrlKey&&this._ctrlKeyTimeout===-1&&(this._ctrlKeyTimeout=this.timers.setTimeout(this._setCtrlKeyTimeout,150)),e.metaKey?(clearTimeout(this._metaKeyTimeout),this._metaKeyTimeout=-1,t.metaKey=!0):!e.metaKey&&t.metaKey&&this._metaKeyTimeout===-1&&(this._metaKeyTimeout=this.timers.setTimeout(this._setMetaKeyTimeout,150));const{originPagePoint:s,currentPagePoint:o}=t;t.isPointing||(t.isDragging=!1);const i=this.store.unsafeGetWithoutCapture(oo),a=this.store.get(this._getCurrentPageStateId()),l=this._cameraOptions.__unsafe__getWithoutCapture();switch(n){case"pinch":{if(l.isLocked)return;switch(clearTimeout(this._longPressTimeout),this._updateInputsFromEvent(e),e.name){case"pinch_start":{if(t.isPinching)return;t.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=[...a.selectedShapeIds]),this._didPinch=!0,t.isPinching=!0,this.interrupt());return}case"pinch":{if(!t.isPinching)return;const{point:{z:c=1},delta:{x:u,y:p}}=e,{x:f,y:m}=P.SubXY(e.point,i.screenBounds.x,i.screenBounds.y);this.stopCameraAnimation(),i.followingUserId&&this.stopFollowingUser();const{x:v,y:b,z:S}=ly(()=>this.getCamera()),{panSpeed:C,zoomSpeed:E}=l;this._setCamera(new P(v+u*C/S-f/S+f/(c*E),b+p*C/S-m/S+m/(c*E),c*E),{immediate:!0});return}case"pinch_end":{if(!t.isPinching)return this;t.isPinching=!1;const{_selectedShapeIdsAtPointerDown:c}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,c.length>0&&this.once("tick",()=>{this._didPinch||this.setSelectedShapes(c)}));return}}}case"wheel":{if(l.isLocked)return;this._updateInputsFromEvent(e);const{panSpeed:c,zoomSpeed:u,wheelBehavior:p}=l;if(p!=="none"){this.stopCameraAnimation(),i.followingUserId&&this.stopFollowingUser();const{x:f,y:m,z:v}=ly(()=>this.getCamera()),{x:b,y:S,z:C=0}=e.delta;let E=p;switch(t.ctrlKey&&(E=p==="pan"?"zoom":"pan"),E){case"zoom":{const{x:T,y:w}=this.inputs.currentScreenPoint;let M=C;p==="zoom"&&(Math.abs(S)>10?M=10*Math.sign(S)/100:M=S/100);const R=v+(M??0)*u*v;this._setCamera(new P(f+(T/R-T)-(T/v-T),m+(w/R-w)-(w/v-w),R),{immediate:!0}),this.maybeTrackPerformance("Zooming");return}case"pan":{this._setCamera(new P(f+b*c/v,m+S*c/v,v),{immediate:!0}),this.maybeTrackPerformance("Panning");return}}}break}case"pointer":{if(t.isPinching)return;this._updateInputsFromEvent(e);const{isPen:c}=e,{isPenMode:u}=i;switch(e.name){case"pointer_down":{if(u&&!c)return;if(this.inputs.isPanning||(this._longPressTimeout=this.timers.setTimeout(()=>{const p=this.getViewportScreenBounds();this.dispatch({...e,point:this.inputs.originScreenPoint.clone().addXY(p.x,p.y),name:"long_press"})},this.options.longPressDurationMs)),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),e.button===Yj&&(this.capturedPointerId=e.pointerId),t.buttons.add(e.button),t.isPointing=!0,t.isDragging=!1,!u&&c&&this.updateInstanceState({isPenMode:!0}),e.button===Xj?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):e.button===gy&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout)),this.inputs.isPanning)return this.stopCameraAnimation(),this.setCursor({type:"grabbing",rotation:0}),this;break}case"pointer_move":{if(!c&&u)return;const{x:p,y:f,z:m}=ly(()=>this.getCamera());if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:v,previousScreenPoint:b}=this.inputs,{panSpeed:S}=l,C=P.Sub(v,b);this.setCamera(new P(p+C.x*S/m,f+C.y*S/m,m),{immediate:!0}),this.maybeTrackPerformance("Panning");return}t.isPointing&&!t.isDragging&&P.Dist2(s,o)*this.getZoomLevel()>(i.isCoarsePointer?this.options.coarseDragDistanceSquared:this.options.dragDistanceSquared)/m&&(t.isDragging=!0,clearTimeout(this._longPressTimeout));break}case"pointer_up":{if(t.isDragging=!1,t.isPointing=!1,clearTimeout(this._longPressTimeout),t.buttons.delete(e.button),i.isPenMode&&!c)return;if(this.capturedPointerId===e.pointerId&&(this.capturedPointerId=null,e.button=0),t.isPanning){t.keys.has("Space")||(t.isPanning=!1,t.isSpacebarPanning=!1);const p=this.inputs.pointerVelocity,f=Math.min(2,p.len());switch(e.button){case Yj:{this.setCursor({type:"grab",rotation:0});break}case gy:this.inputs.keys.has(" ")?this.setCursor({type:"grab",rotation:0}):this.setCursor({type:this._prevCursor,rotation:0})}f>0&&this.slideCamera({speed:f,direction:p})}else e.button===Xj&&(this.complete(),this.setCurrentTool(this._restoreToolId));break}}break}case"keyboard":{switch(e.key==="ShiftRight"&&(e.key="ShiftLeft"),e.key==="AltRight"&&(e.key="AltLeft"),e.code==="ControlRight"&&(e.code="ControlLeft"),e.code==="MetaRight"&&(e.code="MetaLeft"),e.name){case"key_down":{if(t.keys.add(e.code),e.code==="Space"&&!e.ctrlKey&&(this.inputs.isPanning||(this._prevCursor=i.cursor.type),this.inputs.isPanning=!0,this.inputs.isSpacebarPanning=!0,clearTimeout(this._longPressTimeout),this.setCursor({type:this.inputs.isPointing?"grabbing":"grab",rotation:0})),this.inputs.isSpacebarPanning){let c;switch(e.code){case"ArrowUp":{c=new P(0,-1);break}case"ArrowRight":{c=new P(1,0);break}case"ArrowDown":{c=new P(0,1);break}case"ArrowLeft":{c=new P(-1,0);break}}if(c){const u=this.getViewportPageBounds(),p=u.clone().translate(c.mulV({x:u.w,y:u.h}));this._animateToViewport(p,{animation:{duration:320}})}}break}case"key_up":{t.keys.delete(e.code),e.code==="Space"&&(this.inputs.buttons.has(gy)||(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0})));break}}break}}if(e.type==="pointer"){e.button===gy?e.name="middle_click":e.button===x2&&(e.name="right_click");const{isPenMode:c}=this.store.unsafeGetWithoutCapture(oo);if(e.isPen===c){const u=this._clickManager.handlePointerEvent(e);if(e.name!==u.name){this.root.handleEvent(e),this.emit("event",e),this.root.handleEvent(u),this.emit("event",u);return}}}return this.root.handleEvent(e),this.emit("event",e),e.type==="pointer"&&e.name==="pointer_down"&&this.menus.clearOpenMenus(),this}maybeTrackPerformance(e){_r.measurePerformance.get()&&(this.performanceTracker.isStarted()?clearTimeout(this.performanceTrackerTimeout):this.performanceTracker.start(e),this.performanceTrackerTimeout=this.timers.setTimeout(()=>{this.performanceTracker.stop()},50))}};We=EJ(ME);Ke(We,1,"getIsShapeHiddenCache",f8,Ge);Ke(We,1,"getCanUndo",p8,Ge);Ke(We,1,"getCanRedo",h8,Ge);Ke(We,1,"getPath",u8,Ge);Ke(We,1,"getCurrentTool",d8,Ge);Ke(We,1,"getCurrentToolId",c8,Ge);Ke(We,1,"getDocumentSettings",l8,Ge);Ke(We,1,"getInstanceState",a8,Ge);Ke(We,1,"getOpenMenus",i8,Ge);Ke(We,1,"getIsMenuOpen",o8,Ge);Ke(We,1,"getPageStates",s8,Ge);Ke(We,1,"_getPageStatesQuery",r8,Ge);Ke(We,1,"getCurrentPageState",n8,Ge);Ke(We,1,"_getCurrentPageStateId",t8,Ge);Ke(We,1,"getSelectedShapeIds",e8,Ge);Ke(We,1,"getSelectedShapes",Q6,Ge);Ke(We,1,"getOnlySelectedShapeId",J6,Ge);Ke(We,1,"getOnlySelectedShape",Z6,Ge);Ke(We,1,"getSelectionPageBounds",X6,Ge);Ke(We,1,"getSelectionRotation",Y6,Ge);Ke(We,1,"getSelectionRotatedPageBounds",q6,Ge);Ke(We,1,"getSelectionRotatedScreenBounds",V6,Ge);Ke(We,1,"getFocusedGroupId",K6,Ge);Ke(We,1,"getFocusedGroup",W6,Ge);Ke(We,1,"getEditingShapeId",G6,Ge);Ke(We,1,"getEditingShape",H6,Ge);Ke(We,1,"getHoveredShapeId",U6,Ge);Ke(We,1,"getHoveredShape",B6,Ge);Ke(We,1,"getHintingShapeIds",$6,Ge);Ke(We,1,"getHintingShape",z6,Ge);Ke(We,1,"getErasingShapeIds",F6,Ge);Ke(We,1,"getErasingShapes",N6,Ge);Ke(We,1,"_unsafe_getCameraId",L6,Ge);Ke(We,1,"getCamera",O6,Ge);Ke(We,1,"getViewportPageBoundsForFollowing",D6,Ge);Ke(We,1,"getCameraForFollowing",R6,Ge);Ke(We,1,"getZoomLevel",j6,Ge);Ke(We,1,"getViewportScreenBounds",A6,Ge);Ke(We,1,"getViewportScreenCenter",M6,Ge);Ke(We,1,"getViewportPageBounds",T6,Ge);Ke(We,1,"_getCollaboratorsQuery",_6,Ge);Ke(We,1,"getCollaborators",I6,Ge);Ke(We,1,"getCollaboratorsOnCurrentPage",P6,Ge);Ke(We,1,"getRenderingShapes",k6,Ge);Ke(We,1,"_getAllPagesQuery",E6,Ge);Ke(We,1,"getPages",C6,Ge);Ke(We,1,"getCurrentPageId",w6,Ge);Ke(We,1,"getCurrentPageShapeIdsSorted",x6,Ge);Ke(We,1,"_getAllAssetsQuery",S6,Ge);Ke(We,1,"_getShapeGeometryCache",b6,Ge);Ke(We,1,"_getShapeHandlesCache",v6,Ge);Ke(We,1,"_getShapePageTransformCache",y6,Ge);Ke(We,1,"_getShapePageBoundsCache",m6,Ge);Ke(We,1,"_getShapeClipPathCache",g6,Ge);Ke(We,1,"_getShapeMaskCache",f6,Ge);Ke(We,1,"_getShapeMaskedPageBoundsCache",p6,Ge);Ke(We,1,"_notVisibleShapes",h6,Ge);Ke(We,1,"getCulledShapes",u6,Ge);Ke(We,1,"getCurrentPageBounds",d6,Ge);Ke(We,1,"getCurrentPageShapes",c6,Ge);Ke(We,1,"getCurrentPageShapesSorted",l6,Ge);Ke(We,1,"getCurrentPageRenderingShapesSorted",a6,Ge);Ke(We,1,"_getBindingsIndexCache",i6,Ge);Ke(We,1,"_getSelectionSharedStyles",o6,Ge);Ke(We,1,"getSharedStyles",s6,Ge);Ke(We,1,"getSharedOpacity",r6,Ge);Ke(We,1,"getIsFocused",n6,Ge);Ke(We,1,"getIsReadonly",t6,Ge);Ke(We,1,"_setShiftKeyTimeout",e6,Ge);Ke(We,1,"_setAltKeyTimeout",Q4,Ge);Ke(We,1,"_setCtrlKeyTimeout",J4,Ge);Ke(We,1,"_setMetaKeyTimeout",Z4,Ge);PJ(We,Ge);function xy(r,e=r.getCurrentPageId()){const t=r.getPage(e).name;r.emit("max-shapes",{name:t,pageId:e,count:r.options.maxShapesPerPage})}function Oa(r,e){if(!e)return r;let t=null;const n=Object.entries(e);for(let s=0,o=n.length;s<o;s++){const[i,a]=n[s];if(a!==void 0&&!(i==="id"||i==="type"||i==="typeName")&&a!==r[i]){if(t||(t={...r}),i==="props"||i==="meta"){t[i]={...r[i]};for(const[l,c]of Object.entries(a))t[i][l]=c;continue}t[i]=a}}return t||r}function g8(r,e,t){const n=r.getShape(e);if(!n)return;t.push(n);const s=r.getSortedChildIdsForParent(e);for(let o=0,i=s.length;o<i;o++)g8(r,s[o],t)}function MR(r,e,t){let n;if(r.run(()=>{const s=r.store.extractingChanges(()=>{const o=new Set,i=new Set;for(const a of e)if(r.getShape(a))for(const c of r.getBindingsInvolvingShape(a)){const u=e.has(c.fromId),p=e.has(c.toId);if(u&&p){o.add(c.id);continue}(!u||!p)&&i.add(c.id)}r.deleteBindings([...i],{isolateShapes:!0});try{n=Xc.ok(t(o))}catch(a){n=Xc.err(a)}});r.store.applyDiff(pE(s))},{history:"ignore"}),n.ok)return n.value;throw n.error}function AR(r,e){if(!e.constraints)throw Error("Should have constraints here");const{padding:{x:t,y:n}}=e.constraints,s=r.getViewportScreenBounds(),o=Ve.From(e.constraints.bounds),i=(s.w-t*2)/o.w,a=(s.h-n*2)/o.h;return{zx:i,zy:a}}function qg(){const r=ue(),e=Gg();return ye("isDarkMode",()=>(e==null?void 0:e.isDarkMode)??r.user.getIsDarkMode(),[e,r])}const jR="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",RR="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",wy='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function Ac(r,e,t,n,s,o=16,i=16){const a=(-t-e)*(cn/180),l=Math.sin(a),c=Math.cos(a),u=1*c-1*l,p=1*l+1*c;return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${s};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${u}' dy='${p}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${e+t} 16 16)${n?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+r.replaceAll('"',"'")+`</g></svg>") ${o} ${i}, pointer`}const _J=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],TJ={none:()=>"none","ew-resize":(r,e,t)=>Ac(RR,r,0,e,t),"ns-resize":(r,e,t)=>Ac(RR,r,90,e,t),"nesw-resize":(r,e,t)=>Ac(jR,r,0,e,t),"nwse-resize":(r,e,t)=>Ac(jR,r,90,e,t),"nwse-rotate":(r,e,t)=>Ac(wy,r,0,e,t),"nesw-rotate":(r,e,t)=>Ac(wy,r,90,e,t),"senw-rotate":(r,e,t)=>Ac(wy,r,180,e,t),"swne-rotate":(r,e,t)=>Ac(wy,r,270,e,t)};function Jo(r,e=0,t="black"){return TJ[r](CV(e),!1,t)}function MJ(){const r=ue(),e=Kr(),t=qg();Zc("useCursor",()=>{const{type:n,rotation:s}=r.getInstanceState().cursor;if(_J.includes(n)){e.style.setProperty("--tl-cursor",`var(--tl-cursor-${n})`);return}e.style.setProperty("--tl-cursor",Jo(n,s,t?"white":"black"))},[r,e,t])}function AJ(){const r=ue(),e=Kr(),t=qg(),n=ye(_r.forceSrgb);Ht.useEffect(()=>{t?(e.setAttribute("data-color-mode","dark"),e.classList.remove("tl-theme__light"),e.classList.add("tl-theme__dark")):(e.setAttribute("data-color-mode","light"),e.classList.remove("tl-theme__dark"),e.classList.add("tl-theme__light")),n?e.classList.add("tl-theme__force-sRGB"):e.classList.remove("tl-theme__force-sRGB")},[r,e,n,t])}function jJ(){const[r,e]=I.useState(0);I.useEffect(()=>e(t=>t+1),[])}const RJ=r=>r.props.src,DJ={upload:(r,e)=>aa.blobToDataUrl(e)};function OJ(r){return"schema"in r&&r.schema?r.schema:uV({shapes:"shapeUtils"in r&&r.shapeUtils?DR(SL(r.shapeUtils)):void 0,bindings:"bindingUtils"in r&&r.bindingUtils?DR(vL(r.bindingUtils)):void 0,migrations:"migrations"in r?r.migrations:void 0})}function t0({initialData:r,defaultName:e="",id:t,assets:n=DJ,onMount:s,collaboration:o,...i}={}){const a=OJ(i),l=new i2({id:t,schema:a,initialData:r,props:{defaultName:e,assets:{upload:n.upload,resolve:n.resolve??RJ},onMount:c=>{fn(c instanceof Ge),s==null||s(c)},collaboration:o}});if(i.snapshot){if(r)throw new Error("Cannot provide both initialData and snapshot");mL(l,i.snapshot)}return l}function DR(r){return Object.fromEntries(r.map(e=>[e.type,{props:e.props,migrations:e.migrations}]))}function LJ(){window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
• If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
• If your hard disk is full, try clearing up some space and then reload the page.`)}function NJ(){window.alert(`Oops! We could not access your browser's storage—and the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
• If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`)}const FJ=350,zJ=1e4,OR=Symbol("UPDATE_INSTANCE_STATE"),$J=r=>r;class BJ{constructor(e){k(this,"onmessage")}postMessage(e){}close(){}}const UJ=typeof BroadcastChannel>"u"?BJ:BroadcastChannel;class HJ{constructor(e,{persistenceKey:t,sessionId:n=e0,onLoad:s,onLoadError:o},i=new UJ(`tldraw-tab-sync-${t}`)){k(this,"disposables",new Set);k(this,"diffQueue",[]);k(this,"didDispose",!1);k(this,"shouldDoFullDBWrite",!0);k(this,"isReloading",!1);k(this,"persistenceKey");k(this,"sessionId");k(this,"serializedSchema");k(this,"isDebugging",!1);k(this,"documentTypes");k(this,"$sessionStateSnapshot");k(this,"db");k(this,"initTime",Date.now());k(this,"isPersisting",!1);k(this,"didLastWriteError",!1);k(this,"scheduledPersistTimeout",null);this.store=e,this.channel=i,typeof window<"u"&&(window.tlsync=this),this.persistenceKey=t,this.sessionId=n,this.db=new Fv(t),this.disposables.add(()=>this.db.close()),this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=I2(this.store),this.disposables.add(e.listen(({changes:a})=>{this.diffQueue.push(a),this.channel.postMessage($J({type:"diff",storeId:this.store.id,changes:a,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(OR),this.schedulePersist()},{scope:"session"})),this.connect(s,o),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(a=>a.scope==="document").map(a=>a.typeName))}debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,t){this.debug("connecting");let n;try{n=await this.db.load({sessionId:this.sessionId})}catch(s){t(s),NJ();return}if(this.debug("loaded data from store",n,"didDispose",this.didDispose),!this.didDispose)try{if(n){const s=Object.fromEntries(n.records.map(l=>[l.id,l])),o=n.sessionStateSnapshot??JY(s),i=this.store.schema.migrateStoreSnapshot({store:s,schema:n.schema??this.store.schema.serializeEarliestVersion()});if(i.type==="error"){console.error("failed to migrate store",i),t(new Error(`Failed to migrate store: ${i.reason}`));return}const a=Object.values(i.value).filter(l=>this.documentTypes.has(l.typeName));a.length>0&&this.store.mergeRemoteChanges(()=>{this.store.put(a,"initialize")}),o&&CE(this.store,o)}this.channel.onmessage=({data:s})=>{var a,l;this.debug("got message",s);const o=s,i=this.store.schema.getMigrationsSince(o.schema);if(i.ok){if(i.value.length>0){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}}else{if(Date.now()-this.initTime<5e3){t(new Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,(l=(a=window==null?void 0:window.location)==null?void 0:a.reload)==null||l.call(a);return}o.type==="diff"&&(this.debug("applying diff"),rl(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(o.changes)})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(s){if(this.debug("error loading data from store",s),this.didDispose)return;t(s);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),!this.scheduledPersistTimeout&&(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?zJ:FJ))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),!this.isPersisting&&(this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist())}async doPersist(){if(fn(!this.isPersisting,"persist already in progress"),this.didDispose)return;this.isPersisting=!0,this.debug("doPersist start");const e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await this.db.storeSnapshot({schema:this.store.schema,snapshot:this.store.serialize(),sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{const t=o2(e.filter(n=>n!==OR));await this.db.storeChanges({changes:t,schema:this.store.schema,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(t){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",t),LJ(),typeof window<"u"&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function m8(r){const e=I.useRef(r),[t,n]=I.useState(r);t!==e.current&&n(e.current);const s=I.useCallback(o=>{typeof o=="function"?e.current=o(e.current):e.current=o,n(e.current)},[]);return[t,s]}function GJ(r){const[e,t]=m8({status:"loading"});return r=ip(r),I.useEffect(()=>{const{persistenceKey:n,sessionId:s,...o}=r;if(!n){t({status:"not-synced",store:t0(o)});return}t({status:"loading"});const i=new il,a={upload:async(p,f)=>(await u.db.storeAsset(p.id,f),p.id),resolve:async p=>p.props.src?p.props.src.startsWith("asset:")?await i.get(p,async()=>{const f=await u.db.getAsset(p.id);return f?URL.createObjectURL(f):null}):p.props.src:null,...o.assets},l=t0({...o,assets:a});let c=!1;const u=new HJ(l,{sessionId:s,persistenceKey:n,onLoad(){c||t({store:l,status:"synced-local"})},onLoadError(p){c||t({status:"error",error:p})}});return()=>{c=!0,u.close()}},[r,t]),e}function WJ(){const r=ue(),e=Kr();I.useEffect(()=>{const t=o=>e.style.setProperty("--tl-zoom",o.toString()),n=z0(t,100),s=new rp("useZoomCss",()=>{r.getCurrentPageShapeIds().size<300?t(r.getZoomLevel()):n(r.getZoomLevel())});return s.attach(),s.execute(),()=>{s.detach(),n.cancel()}},[r,e])}function AE(r){const e=new ArrayBuffer(r.length),t=new Uint8Array(e);for(let n=0,s=r.length;n<s;n++)t[n]=r.charCodeAt(n);return e}function KJ(r){const e=atob(r),t=AE(e);return crypto.subtle.importKey("spki",new Uint8Array(t),{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}const VJ=5,gf={ANNUAL_LICENSE:1,PERPETUAL_LICENSE:2,INTERNAL_LICENSE:4,WITH_WATERMARK:8},qJ=Math.max(...Object.values(gf)),mf={ID:0,HOSTS:1,FLAGS:2,EXPIRY_DATE:3},YJ=Object.keys(mf).length,rC="sales@tldraw.com",XJ=`${Yc()}/watermarks/watermark-track.svg`;class pb{constructor(e,t,n){k(this,"publicKey","MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEHJh0uUfxHtCGyerXmmatE368Hd9rI6LH9oPDQihnaCryRFWEVeOvf9U/SPbyxX74LFyJs5tYeAHq5Nc0Ax25LQ");k(this,"isDevelopment");k(this,"isTest");k(this,"isCryptoAvailable");k(this,"state",$r("license state","pending"));k(this,"verbose",!0);this.isTest=!1,this.isDevelopment=this.getIsDevelopment(n),this.publicKey=t||this.publicKey,this.isCryptoAvailable=!!crypto.subtle,this.getLicenseFromKey(e).then(s=>{const o=ZJ(s);!this.isDevelopment&&o&&al(XJ),o?this.state.set("unlicensed"):s.isLicensedWithWatermark?this.state.set("licensed-with-watermark"):this.state.set("licensed")})}getIsDevelopment(e){return e==="development"?!0:e==="production"?!1:window.location.protocol!=="https:"}async extractLicenseKey(e){const[t,n]=e.split("."),[s,o]=t.split("/");if(!s.startsWith("tldraw-"))throw new Error(`Unsupported prefix '${s}'`);const i=await KJ(this.publicKey);let a;try{a=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},i,new Uint8Array(AE(atob(n))),new Uint8Array(AE(atob(o))))}catch(c){throw console.error(c),new Error("Could not perform signature validation")}if(!a)throw new Error("Invalid signature");let l;try{l=JSON.parse(atob(o))}catch{throw new Error("Could not parse object")}return l.length>YJ&&this.outputMessages(["License key contains some unknown properties.","You may want to update tldraw packages to a newer version to get access to new functionality."]),{id:l[mf.ID],hosts:l[mf.HOSTS],flags:l[mf.FLAGS],expiryDate:l[mf.EXPIRY_DATE]}}async getLicenseFromKey(e){if(!e)return this.isDevelopment||this.outputNoLicenseKeyProvided(),{isLicenseParseable:!1,reason:"no-key-provided"};if(this.isDevelopment&&!this.isCryptoAvailable)return this.verbose&&(console.log("tldraw: you seem to be in a development environment that does not support crypto. License not verified."),console.log("You should check that this works in production separately.")),{isLicenseParseable:!1,reason:"has-key-development-mode"};let t=e.replace(/[\u200B-\u200D\uFEFF]/g,"");t=t.replace(/\r?\n|\r/g,"");try{const n=await this.extractLicenseKey(t),s=new Date(n.expiryDate),o=this.isFlagEnabled(n.flags,gf.ANNUAL_LICENSE),i=this.isFlagEnabled(n.flags,gf.PERPETUAL_LICENSE),a={license:n,isLicenseParseable:!0,isDevelopment:this.isDevelopment,isDomainValid:this.isDomainValid(n),expiryDate:s,isAnnualLicense:o,isAnnualLicenseExpired:o&&this.isAnnualLicenseExpired(s),isPerpetualLicense:i,isPerpetualLicenseExpired:i&&this.isPerpetualLicenseExpired(s),isInternalLicense:this.isFlagEnabled(n.flags,gf.INTERNAL_LICENSE),isLicensedWithWatermark:this.isFlagEnabled(n.flags,gf.WITH_WATERMARK)};return this.outputLicenseInfoIfNeeded(a),a}catch(n){return this.outputInvalidLicenseKey(n.message),{isLicenseParseable:!1,reason:"invalid-license-key"}}}isDomainValid(e){const t=window.location.hostname.toLowerCase();return e.hosts.some(n=>{const s=n.toLowerCase().trim();if(s===t||`www.${s}`===t||s===`www.${t}`||n==="*")return!0;if(n.includes("*")){const o=new RegExp(n.replace(/\*/g,".*?"));return o.test(t)||o.test(`www.${t}`)}return!1})}getExpirationDateWithoutGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}getExpirationDateWithGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+VJ+1)}isAnnualLicenseExpired(e){const t=this.getExpirationDateWithGracePeriod(e),n=new Date>=t;return!n&&new Date>=this.getExpirationDateWithoutGracePeriod(e)&&this.outputMessages(["tldraw license is about to expire, you are in a grace period.",`Please reach out to ${rC} if you would like to renew your license.`]),n}isPerpetualLicenseExpired(e){const t=this.getExpirationDateWithGracePeriod(e),n={major:new Date(Gj.major),minor:new Date(Gj.minor)};return n.major>=t||n.minor>=t}isFlagEnabled(e,t){return(e&t)===t}outputNoLicenseKeyProvided(){}outputInvalidLicenseKey(e){this.outputMessages(["Invalid tldraw license key",`Reason: ${e}`])}outputLicenseInfoIfNeeded(e){e.isAnnualLicenseExpired&&this.outputMessages(["Your tldraw license has expired!",`Please reach out to ${rC} to renew.`]),!e.isDomainValid&&!e.isDevelopment&&this.outputMessages(["This tldraw license key is not valid for this domain!",`Please reach out to ${rC} if you would like to use tldraw on other domains.`]),e.license.flags>=qJ*2&&this.outputMessages(["This tldraw license contains some unknown flags.","You may want to update tldraw packages to a newer version to get access to new functionality."])}outputMessages(e){if(!this.isTest&&this.verbose){this.outputDelimiter();for(const t of e)console.log(`%c${t}`,"color: white; background: crimson; padding: 2px; border-radius: 3px;");this.outputDelimiter()}}outputDelimiter(){console.log("%c-------------------------------------------------------------------","color: white; background: crimson; padding: 2px; border-radius: 3px;")}}k(pb,"className","tl-watermark_SEE-LICENSE");function ZJ(r){if(!r.isLicenseParseable||!r.isDomainValid&&!r.isDevelopment)return!0;if(r.isPerpetualLicenseExpired||r.isAnnualLicenseExpired){if(r.isInternalLicense)throw new Error("License: Internal license expired.");return!0}return!1}const y8=I.createContext({}),JJ=()=>I.useContext(y8);function QJ({licenseKey:r,children:e}){const[t]=I.useState(()=>new pb(r));return g.jsx(y8.Provider,{value:t,children:e})}function md(r){if(!r)throw Error("usePassThroughWheelEvents must be passed a ref");const e=Kr();I.useEffect(()=>{function t(s){if(s.isSpecialRedispatchedEvent)return;Ot(s);const o=e.querySelector(".tl-canvas");if(!o)return;const i=new WheelEvent("wheel",s);i.isSpecialRedispatchedEvent=!0,o.dispatchEvent(i)}const n=r.current;if(n)return n.addEventListener("wheel",t,{passive:!1}),()=>{n.removeEventListener("wheel",t)}},[e,r])}const eQ='<svg xmlns="http://www.w3.org/2000/svg" width="3001" height="1000" fill="none"><path fill="#000" d="M590.656 300.449c0 49.706-40.294 90-90 90-49.705 0-90-40.294-90-90 0-49.705 40.295-90 90-90 49.706 0 90 40.295 90 90M569.431 719.011c-15.247 32.821-56.006 91.589-98.338 91.438-32.004-.115-38.642-30.904-17.414-50.856 17.381-16.337 28.246-48.075 31.995-72.719.415-2.728-1.556-5.197-4.272-5.679-39.666-7.04-70.746-40.877-70.746-83.417 0-48.23 38.983-87.329 87.07-87.329 39.936 0 70.172 22.237 83.369 52.397 18.839 43.055 7.117 115.733-11.664 156.165M2613.29 385.681V239.319c0-11.363 9.22-20.569 20.59-20.569h8.26c11.37 0 20.59 9.206 20.59 20.569v36.911c0 8.629 7 15.625 15.63 15.625h35.25c8.63 0 15.63-6.996 15.63-15.625v-36.911c0-11.363 9.22-20.569 20.59-20.569h8.17c11.37 0 20.59 9.206 20.59 20.569v146.362c0 11.363-9.22 20.569-20.59 20.569h-8.17c-11.37 0-20.59-9.206-20.59-20.569v-36.999c0-8.63-7-15.625-15.63-15.625h-35.25c-8.63 0-15.63 6.995-15.63 15.625v36.999c0 11.363-9.22 20.569-20.59 20.569h-8.26c-11.37 0-20.59-9.206-20.59-20.569M2391.97 239.319v146.362c0 11.348-9.16 20.569-20.49 20.569h-8.2c-11.33 0-20.49-9.221-20.49-20.569V239.319c0-11.348 9.16-20.569 20.49-20.569h8.2c11.33 0 20.49 9.221 20.49 20.569M2098.23 391.43l-42.69-146.361c-3.85-13.171 6.06-26.319 19.79-26.319h10.6c9.59 0 17.93 6.611 20.08 15.952l17.01 73.045c1.48 6.348 10.47 6.478 12.14.176l19.47-73.838c2.38-9.04 10.57-15.335 19.93-15.335h12.1c9.37 0 17.56 6.3 19.94 15.346l19.49 74.067c1.66 6.305 10.65 6.178 12.13-.171l17.09-73.294c2.15-9.339 10.49-15.948 20.08-15.948h10.53c13.72 0 23.63 13.141 19.79 26.31l-42.63 146.361c-2.56 8.789-10.63 14.829-19.79 14.829h-15.68c-9.12 0-17.16-5.98-19.76-14.709l-21.17-71.059c-1.77-5.948-10.19-5.957-11.97-.012l-21.33 71.071c-2.6 8.729-10.64 14.709-19.76 14.709h-15.59c-9.17 0-17.23-6.035-19.8-14.82M2443.23 218.75h118.59c11.38 0 20.62 9.195 20.62 20.557s-9.24 20.556-20.62 20.556h-24.79c-5.53 0-10 4.477-10 10v115.818c0 11.368-9.25 20.569-20.63 20.569h-7.65c-11.39 0-20.63-9.201-20.63-20.569V269.863c0-5.523-4.48-10-10-10h-24.89c-11.37 0-20.61-9.195-20.61-20.556s9.24-20.557 20.61-20.557M1174.15 218.75h24.64c8.35 0 15.88 5.042 19.04 12.764l34.61 83.942c2.13 5.161 9.44 5.155 11.56-.01l34.43-83.932a20.58 20.58 0 0 1 19.04-12.764h24.64c11.37 0 20.58 9.208 20.58 20.569v146.362c0 11.361-9.21 20.569-20.58 20.569h-7.09c-11.36 0-20.58-9.208-20.58-20.569l-.12-50.645c-.01-6.888-9.53-8.688-12.06-2.283l-23.46 59.332a20.57 20.57 0 0 1-19.14 13.009h-3.03a20.57 20.57 0 0 1-19.15-13.046l-23.47-59.68c-2.52-6.416-12.05-4.623-12.06 2.271l-.13 51.042c0 11.361-9.21 20.569-20.57 20.569h-7.1c-11.36 0-20.57-9.208-20.57-20.569V239.319c0-11.361 9.21-20.569 20.57-20.569"/><path fill="#000" fill-rule="evenodd" d="m1449.94 391.836 6.12-19.392a6.255 6.255 0 0 1 5.96-4.369l50.22-.061a6.24 6.24 0 0 1 5.96 4.348l6.23 19.486c2.71 8.581 10.71 14.402 19.74 14.402h9.34c14.13 0 24.15-13.791 19.61-27.151l-49.74-146.361c-2.85-8.37-10.74-13.988-19.61-13.988h-33.16c-8.87 0-16.77 5.618-19.61 13.988l-49.74 146.361c-4.54 13.36 5.48 27.151 19.61 27.151h9.32c9.04 0 17.04-5.827 19.75-14.414m31.1-98.858c1.85-5.807 10.08-5.796 11.91.016l8.83 27.916c1.28 4.028-1.73 8.134-5.96 8.134h-17.74c-4.23 0-7.24-4.119-5.95-8.151zM1681.81 406.25c18.91 0 35.39-3.686 49.36-11.168 13.97-7.544 24.73-18.394 32.24-32.489 7.56-14.105 11.29-30.866 11.29-50.182 0-19.256-3.73-35.957-11.29-50.004-7.57-14.094-18.35-24.912-32.32-32.397-13.91-7.545-30.4-11.26-49.37-11.26h-49.5c-11.38 0-20.63 9.201-20.63 20.569v146.362c0 11.368 9.25 20.569 20.63 20.569zm23.13-47.701c-6.62 3.215-14.85 4.886-24.79 4.886-10.49 0-19-8.507-19-19v-64.34c0-10.149 8.23-18.376 18.38-18.376 10.18 0 18.56 1.703 25.23 4.974 6.59 3.149 11.63 8.315 15.08 15.633 3.45 7.269 5.28 17.268 5.28 30.162 0 12.891-1.82 22.951-5.28 30.347-3.39 7.319-8.36 12.509-14.9 15.714" clip-rule="evenodd"/><path fill="#000" d="M1804.21 385.681V239.319c0-11.361 9.21-20.569 20.58-20.569h91.28c11.36 0 20.57 9.202 20.57 20.557s-9.21 20.556-20.57 20.556h-54.64a7.807 7.807 0 0 0-7.81 7.813v16.366a7.806 7.806 0 0 0 7.81 7.812h48.13c11.37 0 20.58 9.246 20.58 20.602s-9.21 20.601-20.58 20.601h-48.13a7.806 7.806 0 0 0-7.81 7.812v16.455a7.807 7.807 0 0 0 7.81 7.813h54.64c11.36 0 20.57 9.202 20.57 20.556s-9.21 20.557-20.57 20.557h-91.28c-11.37 0-20.58-9.208-20.58-20.569"/><path fill="#000" fill-rule="evenodd" d="M2875.5 68.75h-2750c-31.066 0-56.25 25.184-56.25 56.25v750c0 31.066 25.184 56.25 56.25 56.25h2750c31.07 0 56.25-25.184 56.25-56.25V125c0-31.066-25.18-56.25-56.25-56.25M125.5 0C56.464 0 .5 55.964.5 125v750c0 69.036 55.965 125 125 125h2750c69.04 0 125-55.964 125-125V125c0-69.036-55.96-125-125-125z" clip-rule="evenodd"/><path fill="#000" d="M2476.06 804.813c-10.54 0-19.82-6.947-22.81-17.068L2390.79 575.7c-4.49-15.248 6.92-30.534 22.8-30.534h27.75c11.1 0 20.72 7.686 23.18 18.52L2489 671.402c2.07 9.093 14.93 9.321 17.32.308l28.83-108.844c2.76-10.435 12.19-17.7 22.98-17.7h25.17c10.8 0 20.25 7.293 22.99 17.755l28.27 107.739c2.36 9.001 15.18 8.829 17.3-.232l25.01-106.888c2.51-10.763 12.1-18.374 23.14-18.374h27.87c15.88 0 27.29 15.286 22.8 30.534l-62.46 212.045a23.78 23.78 0 0 1-22.81 17.068h-32.12c-10.39 0-19.58-6.763-22.69-16.696l-32.08-102.694c-2.62-8.397-14.51-8.331-17.04.095l-30.74 102.346c-3.02 10.061-12.27 16.949-22.76 16.949zM1742.44 804.813h-75.81c-13.09 0-23.71-10.656-23.71-23.801V568.967c0-13.145 10.62-23.801 23.71-23.801h74.8c26.6 0 49.59 5.198 68.95 15.594 19.45 10.312 34.44 25.187 44.96 44.627 10.61 19.355 15.91 42.556 15.91 69.602q0 40.57-15.78 69.73c-10.53 19.355-25.43 34.231-44.71 44.627-19.28 10.311-42.05 15.467-68.32 15.467m-29.3-83.642c0 13.145 10.61 23.801 23.71 23.801h3.06c12.8 0 23.7-2.07 32.71-6.212 9.09-4.141 16-11.283 20.71-21.426q7.2-15.213 7.2-42.345 0-27.13-7.32-42.344c-4.8-10.143-11.87-17.285-21.22-21.426-9.26-4.142-20.63-6.212-34.1-6.212h-1.04c-13.1 0-23.71 10.656-23.71 23.801zM1460.86 804.813c-13.12 0-23.76-10.656-23.76-23.801V568.967c0-13.145 10.64-23.801 23.76-23.801h22.84c13.13 0 23.76 10.656 23.76 23.801v155.247c0 13.145 10.64 23.801 23.76 23.801h57.27c13.12 0 23.76 10.656 23.76 23.801v9.196c0 13.145-10.64 23.801-23.76 23.801zM1204.45 601.964c-13.13 0-23.77-10.656-23.77-23.801v-9.196c0-13.145 10.64-23.801 23.77-23.801h177.89c13.13 0 23.78 10.656 23.78 23.801v9.196c0 13.145-10.65 23.801-23.78 23.801h-39.38c-8.21 0-14.86 6.66-14.86 14.875v164.173c0 13.145-10.64 23.801-23.78 23.801h-21.85c-13.13 0-23.78-10.656-23.78-23.801V616.839c0-8.215-6.65-14.875-14.86-14.875z"/><path fill="#000" fill-rule="evenodd" d="M2223.05 787.891c-3.02 10.047-12.27 16.922-22.74 16.922h-25.43c-16.19 0-27.64-15.862-22.57-31.261l69.88-212.045c3.21-9.753 12.31-16.341 22.56-16.341h61.84c10.25 0 19.35 6.588 22.56 16.341l69.87 212.045c5.08 15.399-6.37 31.261-22.56 31.261h-25.43c-10.48 0-19.72-6.875-22.74-16.922l-6.7-22.2a14.84 14.84 0 0 0-14.21-10.576h-63.42c-6.55 0-12.32 4.296-14.22 10.576zm76.13-96.945-14.13-48.436c-2.46-8.451-14.36-8.602-17.04-.217l-15.46 48.436c-1.84 5.759 2.45 11.645 8.48 11.645h29.6c5.94 0 10.22-5.715 8.55-11.428" clip-rule="evenodd"/><path fill="#000" d="M1939.6 804.813c-13.13 0-23.77-10.656-23.77-23.801V568.967c0-13.145 10.64-23.801 23.77-23.801h88.13c19.24 0 36.08 3.508 50.51 10.523s25.65 17.115 33.67 30.3q12.03 19.779 12.03 47.416c0 18.595-4.14 34.273-12.41 47.036-7.64 11.913-18.18 21.101-31.63 27.564-16.98 8.159-36 11.104-54.7 11.104h-43.07c-76.56 0 4.08-135.84 4.08-84.706v7.996c0 12.117 9.81 21.941 21.91 21.941 8.12 0 16.3-.345 24.04-3.043 5.91-2.113 10.43-5.451 13.55-10.015 3.2-4.565 4.81-10.523 4.81-17.877 0-7.437-1.61-13.481-4.81-18.129-3.12-4.733-7.64-8.199-13.55-10.396-7.05-2.766-14.67-3.423-22.18-3.423-13.13 0-23.77 10.656-23.77 23.801v47.71c0 11.825 11.14 16.003 19.91 20.752 12.31 6.671 7.58 25.389-6.42 25.389-7.45 0-13.49 6.048-13.49 13.508v48.395c0 13.145-10.63 23.801-23.76 23.801zm134.89-106.758 5.41 9.95 33.51 61.622c8.62 15.86-2.84 35.186-20.87 35.186h-22.27c-8.74 0-16.77-4.798-20.92-12.496l-35.05-65.04a15.52 15.52 0 0 0-13.66-8.168c-42.24 0 40.62-82.154 73.85-21.054M931.652 0h68.748v1000h-68.748z"/></svg>',tQ='<svg xmlns="http://www.w3.org/2000/svg" width="400" height="1601" fill="none"><path fill="#000" d="M72 1319.8c0-10.73 7.071-20.18 17.372-23.22l215.823-63.62c15.519-4.57 31.078 7.05 31.078 23.22v28.26c0 11.31-7.824 21.1-18.85 23.61l-109.636 24.94c-9.254 2.1-9.487 15.2-.313 17.63l110.784 29.37a24.21 24.21 0 0 1 18.015 23.4v25.64c0 11-7.423 20.62-18.071 23.41l-109.659 28.79c-9.162 2.41-8.986 15.47.236 17.63l108.792 25.46c10.955 2.56 18.702 12.33 18.702 23.57v28.39c0 16.17-15.559 27.79-31.078 23.22l-215.823-63.62c-10.3-3.04-17.372-12.49-17.372-23.22v-32.72c0-10.59 6.883-19.95 16.994-23.11l104.523-32.67c8.547-2.67 8.479-14.79-.096-17.36l-104.17-31.3C79.01 1372.42 72 1363 72 1352.31zM72 572.638V495.43c0-13.336 10.846-24.147 24.225-24.147h215.823c13.379 0 24.225 10.811 24.225 24.147v76.179q0 40.645-15.872 70.228-15.743 29.712-45.422 45.79-29.55 16.206-70.843 16.206-41.292 0-70.971-16.078-29.55-16.077-45.422-45.532Q72 612.767 72 572.638m85.132-29.84c-13.379 0-24.225 10.81-24.225 24.146v3.122q0 19.55 6.323 33.313 6.323 13.89 21.807 21.094 15.485 7.332 43.099 7.331t43.1-7.46q15.484-7.33 21.807-21.608 6.323-14.15 6.323-34.728v-1.064c0-13.336-10.846-24.146-24.225-24.146zM72 285.858c0-13.363 10.846-24.197 24.225-24.197h215.823c13.379 0 24.225 10.834 24.225 24.197v23.27c0 13.364-10.846 24.197-24.225 24.197H154.035c-13.379 0-24.225 10.834-24.225 24.197v58.328c0 13.364-10.846 24.197-24.225 24.197h-9.36C82.845 440.047 72 429.214 72 415.85zM278.463 24.72c0-13.374 10.846-24.216 24.225-24.216h9.36c13.379 0 24.225 10.842 24.225 24.216v181.174c0 13.374-10.846 24.216-24.225 24.216h-9.36c-13.379 0-24.225-10.842-24.225-24.216v-40.108c0-8.359-6.779-15.135-15.141-15.135H96.225c-13.38 0-24.225-10.842-24.225-24.216v-22.256c0-13.374 10.846-24.216 24.225-24.216h167.097c8.362 0 15.141-6.776 15.141-15.135z"/><path fill="#000" fill-rule="evenodd" d="M89.224 1062.13C78.997 1059.04 72 1049.63 72 1038.96v-25.9c0-16.486 16.145-28.147 31.818-22.979l215.823 71.169a24.19 24.19 0 0 1 16.632 22.98v62.97c0 10.45-6.706 19.71-16.632 22.98l-215.823 71.17C88.145 1246.51 72 1234.86 72 1218.37v-25.9c0-10.67 6.997-20.08 17.224-23.17l22.595-6.81a15.13 15.13 0 0 0 10.765-14.48v-64.59a15.13 15.13 0 0 0-10.765-14.48zm98.672 77.53 49.299-14.39c8.601-2.51 8.755-14.62.22-17.35l-49.299-15.75c-5.861-1.88-11.852 2.49-11.852 8.64v30.14c0 6.05 5.817 10.41 11.632 8.71" clip-rule="evenodd"/><path fill="#000" d="M72 773.439c0-13.367 10.846-24.203 24.225-24.203h215.823c13.379 0 24.225 10.836 24.225 24.203v89.762q0 29.395-10.711 51.439-10.71 22.046-30.84 34.293t-48.261 12.248q-28.388 0-47.873-12.635-18.187-11.672-28.056-32.218c-8.303-17.289-11.301-36.661-11.301-55.705v-43.867c0-77.976 138.26 4.16 86.215 4.16h-8.138c-12.334 0-22.332 9.989-22.332 22.311 0 8.269.351 16.6 3.097 24.487q3.225 9.024 10.194 13.794 6.968 4.899 18.194 4.899 11.356 0 18.453-4.899 7.226-4.77 10.581-13.794c2.815-7.188 3.484-14.944 3.484-22.596 0-13.366-10.846-24.202-24.225-24.202h-48.56c-12.036 0-16.288 11.345-21.122 20.272-6.79 12.539-25.841 7.72-25.841-6.536 0-7.586-6.156-13.736-13.749-13.736H96.225C82.845 820.916 72 810.08 72 796.714zm108.66 137.378-10.128 5.511-62.72 34.131C91.67 959.243 72 947.569 72 929.205V906.52a24.2 24.2 0 0 1 12.719-21.299l66.199-35.696a15.82 15.82 0 0 0 8.313-13.921c0-43.012 83.618 41.371 21.429 75.213"/></svg>';function nQ(r){return ye("watermarkState",()=>r.state.get(),[r])}const rQ=`data:image/svg+xml;utf8,${encodeURIComponent(eQ)}`,sQ=`data:image/svg+xml;utf8,${encodeURIComponent(tQ)}`,oQ=I.memo(function(){const e=JJ(),t=ue(),n=ye("is mobile",()=>t.getViewportScreenBounds().width<700,[t]),s=nQ(e);return["licensed-with-watermark","unlicensed"].includes(s)?g.jsxs(g.Fragment,{children:[g.jsx(aQ,{}),g.jsx(iQ,{src:n?sQ:rQ})]}):null}),iQ=I.memo(function({src:e}){const t=ue(),n=ye("debug mode",()=>t.getInstanceState().isDebugMode,[t]),s=ye("is mobile",()=>t.getViewportScreenBounds().width<700,[t]),o=w2(),i=I.useRef(null);md(i);const a=`url('${e}') center 100% / 100% no-repeat`,l="https://tldraw.dev";return g.jsx("div",{ref:i,className:pb.className,"data-debug":n,"data-mobile":s,draggable:!1,...o,children:Rn.isWebview?g.jsx("a",{draggable:!1,role:"button",onPointerDown:c=>{Ar(c),Ot(c)},onClick:()=>tb.openWindow(l,"_blank"),style:{mask:a,WebkitMask:a}}):g.jsx("a",{href:l,target:"_blank",rel:"noreferrer",draggable:!1,onPointerDown:c=>{Ar(c)},style:{mask:a,WebkitMask:a}})})}),aQ=I.memo(function(){const e=pb.className,t=`/* ------------------- SEE LICENSE -------------------
The tldraw watermark is part of tldraw's license. It is shown for unlicensed
or "licensed-with-watermark" users. By using this library, you agree to
preserve the watermark's behavior, keeping it visible, unobscured, and
available to user-interaction.

To remove the watermark, please purchase a license at tldraw.dev.
*/

	.${e} {
		position: absolute;
		bottom: var(--space-2);
		right: var(--space-2);
		width: 96px;
		height: 32px;
		display: flex;
		align-items: center;
		justify-content: center;
		z-index: var(--layer-watermark) !important;
		background-color: color-mix(in srgb, var(--color-background) 62%, transparent);
		opacity: 1;
		border-radius: 5px;
		pointer-events: all;
		padding: 2px;
		box-sizing: content-box;
	}

	.${e} > a {
		position: absolute;
		width: 96px;
		height: 32px;
		pointer-events: all;
		cursor: inherit;
		color: var(--color-text);
		opacity: .38;
		background-color: currentColor;
	}

	.${e}[data-debug='true'] {
		bottom: 46px;
	}

	.${e}[data-mobile='true'] {
		border-radius: 4px 0px 0px 4px;
		right: -2px;
		width: 8px;
		height: 48px;
	}

	.${e}[data-mobile='true'] > a {
		width: 8px;
		height: 32px;
	}

	@media (hover: hover) {
		.${e} > a {
			pointer-events: none;
		}

		.${e}:hover {
			background-color: var(--color-background);
			transition: background-color 0.2s ease-in-out;
			transition-delay: 0.32s;
		}

		.${e}:hover > a {
			animation: delayed_link 0.2s forwards ease-in-out;
			animation-delay: 0.32s;
		}
	}

	@keyframes delayed_link {
		0% {
			cursor: inherit;
			opacity: .38;
			pointer-events: none;
		}
		100% {
			cursor: pointer;
			opacity: 1;
			pointer-events: all;
		}
	}`;return g.jsx("style",{children:t})}),lQ=[],cQ=[],dQ=[],uQ="tl-container",hQ=I.memo(function({store:e,components:t,className:n,user:s,options:o,...i}){const[a,l]=I.useState(null),c=I.useMemo(()=>s??pL(),[s]),u=(t==null?void 0:t.ErrorFallback)===void 0?sL:t==null?void 0:t.ErrorFallback,p={...i,shapeUtils:i.shapeUtils??lQ,bindingUtils:i.bindingUtils??cQ,tools:i.tools??dQ,components:t,options:ip(o)};return g.jsx("div",{ref:l,"data-tldraw":M5,draggable:!1,className:it(`${uQ} tl-theme__light`,n),onPointerDown:Ar,tabIndex:-1,children:g.jsx(Hf,{fallback:u,onError:f=>Ok(f,{tags:{origin:"react.tldraw-before-app"}}),children:a&&g.jsx(QJ,{licenseKey:i.licenseKey,children:g.jsx(N5,{container:a,children:g.jsx(LY,{overrides:t,children:e?e instanceof i2?g.jsx(b8,{...p,store:e,user:c}):g.jsx(v8,{...p,store:e,user:c}):g.jsx(pQ,{...p,store:e,user:c})})})})})})});function pQ(r){const{defaultName:e,snapshot:t,initialData:n,shapeUtils:s,bindingUtils:o,persistenceKey:i,sessionId:a,user:l,assets:c}=r,u=GJ({shapeUtils:s,bindingUtils:o,initialData:n,persistenceKey:i,sessionId:a,defaultName:e,snapshot:t,assets:c});return g.jsx(v8,{...r,store:u,user:l})}const v8=I.memo(function({store:e,user:t,...n}){const s=Kr();I.useLayoutEffect(()=>{t.userPreferences.get().colorScheme==="dark"&&(s.classList.remove("tl-theme__light"),s.classList.add("tl-theme__dark"))},[s,t]);const{LoadingScreen:o}=Vn();switch(e.status){case"error":throw e.error;case"loading":return o?g.jsx(o,{}):null}return g.jsx(b8,{...n,store:e.store,user:t})}),sC=()=>document.location.search.includes("tldraw_preserve_focus");function b8({onMount:r,children:e,store:t,tools:n,shapeUtils:s,bindingUtils:o,user:i,initialState:a,autoFocus:l=!0,inferDarkMode:c,cameraOptions:u,options:p,licenseKey:f,deepLinks:m,isShapeHidden:v}){const{ErrorFallback:b}=Vn(),S=Kr(),[C,E]=m8(null),T=I.useRef(null),w=ip(m===!0?{}:m),M=I.useRef({autoFocus:l&&!sC(),inferDarkMode:c,initialState:a,cameraOptions:u,deepLinks:w});I.useLayoutEffect(()=>{M.current={autoFocus:l&&!sC(),inferDarkMode:c,initialState:a,cameraOptions:u,deepLinks:w}},[l,c,a,u,w]),I.useLayoutEffect(()=>{const{autoFocus:N,inferDarkMode:z,initialState:L,cameraOptions:B,deepLinks:K}=M.current,O=new Ge({store:t,shapeUtils:s,bindingUtils:o,tools:n,getContainer:()=>S,user:i,initialState:L,autoFocus:N,inferDarkMode:z,cameraOptions:B,options:p,licenseKey:f,isShapeHidden:v});return O.updateViewportScreenBounds(T.current??S),K&&(K!=null&&K.getUrl?O.navigateToDeepLink({...K,url:K.getUrl(O)}):O.navigateToDeepLink(K)),E(O),()=>{O.dispose()}},[o,S,p,s,t,n,i,E,f,v]),I.useLayoutEffect(()=>{if(C&&w)return C.registerDeepLinkListener(w)},[C,w]),I.useLayoutEffect(()=>{C&&u&&C.setCameraOptions(u)},[C,u]);const R=I.useSyncExternalStore(I.useCallback(N=>C?(C.on("crash",N),()=>C.off("crash",N)):()=>{},[C]),()=>(C==null?void 0:C.getCrashingError())??null);I.useEffect(function(){if(!C)return;function z(){C&&C.focus()}function L(){C&&C.blur()}if(l&&sC())return C.getContainer().addEventListener("pointerdown",z),document.body.addEventListener("pointerdown",L),()=>{var B;(B=C.getContainer())==null||B.removeEventListener("pointerdown",z),document.body.removeEventListener("pointerdown",L)}},[C,l]);const{Canvas:D}=Vn();return C?g.jsx(Hf,{fallback:b,onError:N=>C.annotateError(N,{origin:"react.tldraw",willCrashApp:!0}),children:R?g.jsx(gQ,{crashingError:R}):g.jsx(b2,{editor:C,children:g.jsxs(fQ,{onMount:r,children:[e??(D?g.jsx(D,{},C.contextId):null),g.jsx(oQ,{})]})})}):g.jsx("div",{className:"tl-canvas",ref:T})}function fQ({children:r,onMount:e}){return WJ(),MJ(),AJ(),jJ(),x8(t=>{const n=t.store.props.onMount(t),s=e==null?void 0:e(t);return()=>{n==null||n(),s==null||s()}}),r}function gQ({crashingError:r}){throw r}function $2({children:r}){return g.jsx("div",{className:"tl-loading",children:r})}function S8({children:r}){return g.jsx("div",{className:"tl-loading",children:r})}function x8(r){const e=ue(),t=ab(n=>{let s;return n.run(()=>{s=r==null?void 0:r(n),n.emit("mount")},{history:"ignore"}),window.tldrawReady=!0,s});Ht.useLayoutEffect(()=>{if(e)return t==null?void 0:t(e)},[e,t])}function Qc({children:r,className:e="",...t}){return g.jsx("div",{...t,className:it("tl-html-container",e),children:r})}class ev{constructor(e){this.editor=e}}k(ev,"props"),k(ev,"migrations"),k(ev,"type");function fb(r,e,t={}){const{newPoint:n,handle:s,scaleX:o,scaleY:i}=e,{minWidth:a=1,maxWidth:l=1/0,minHeight:c=1,maxHeight:u=1/0}=t;let p=r.props.w*o,f=r.props.h*i;const m=new P(0,0);if(p>0){if(p<a){switch(s){case"top_left":case"left":case"bottom_left":{m.x=p-a;break}case"top":case"bottom":{m.x=(p-a)/2;break}default:m.x=0}p=a}}else if(m.x=p,p=-p,p<a){switch(s){case"top_left":case"left":case"bottom_left":{m.x=-p;break}default:m.x=-a}p=a}if(f>0){if(f<c){switch(s){case"top_left":case"top":case"top_right":{m.y=f-c;break}case"right":case"left":{m.y=(f-c)/2;break}default:m.y=0}f=c}}else if(m.y=f,f=-f,f<c){switch(s){case"top_left":case"top":case"top_right":{m.y=-f;break}default:m.y=-c}f=c}const{x:v,y:b}=m.rot(r.rotation).add(n);return{...r,x:v,y:b,props:{w:Math.min(l,p),h:Math.min(u,f)}}}class up extends pa{getGeometry(e){return new dl({width:e.props.w,height:e.props.h,isFilled:!0})}onResize(e,t){return fb(e,t)}getHandleSnapGeometry(e){return{points:this.getGeometry(e).bounds.cornersAndCenter}}getInterpolatedProps(e,t,n){return{...t.props,w:Gt(e.props.w,t.props.w,n),h:Gt(e.props.h,t.props.h,n)}}}var NC;let mQ=(NC=class extends nt{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}},k(NC,"id","idle"),NC);var FC;let yQ=(FC=class extends nt{onPointerMove(e){if(this.editor.inputs.isDragging){const{originPagePoint:t}=this.editor.inputs,n=this.parent.shapeType,s=vn(),o=this.editor.markHistoryStoppingPoint(`creating_box:${s}`),i=fa(t,this.editor);this.editor.createShapes([{id:s,type:n,x:i.x,y:i.y,props:{w:1,h:1}}]).select(s);const a=this.parent;this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:o,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:a.onCreate?l=>{var c;return(c=a.onCreate)==null?void 0:c.call(a,l)}:void 0})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){const{originPagePoint:e}=this.editor.inputs,t=this.parent.shapeType,n=vn();this.editor.markHistoryStoppingPoint(`creating_box:${n}`),this.editor.createShapes([{id:n,type:t,x:e.x,y:e.y}]);const s=this.editor.getShape(n);if(!s){this.cancel();return}let{w:o,h:i}=s.props;const a=new P(o/2,i/2),l=this.editor.getShapeParentTransform(s);l&&a.rot(-l.rotation());let c=1;this.editor.user.getIsDynamicResizeMode()&&(c=1/this.editor.getZoomLevel(),o*=c,i*=c,a.mul(c));const u=Kn(s),p=fa(new P(s.x-a.x,s.y-a.y),this.editor);u.x=p.x,u.y=p.y,u.props.w=o,u.props.h=i,"scale"in s.props&&(u.props.scale=c),this.editor.updateShape(u),this.editor.setSelectedShapes([n]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}},k(FC,"id","pointing"),FC);function fa(r,e){const t=e.getInstanceState().isGridMode,n=e.getDocumentSettings().gridSize;return t?r.clone().snapToGrid(n):r.clone()}class jE extends nt{static children(){return[mQ,yQ]}}k(jE,"id","box"),k(jE,"initial","idle");function vQ(r,e,t){const n=I.useRef(!1),s=I.useCallback(i=>{n.current=i,i?ra.addOpenMenu(r):ra.deleteOpenMenu(r),e==null||e(i)},[r,e]),o=ye("is menu open",()=>ra.getOpenMenus().includes(r),[r]);return I.useEffect(()=>(n.current&&(t==null||t("open-menu"),ra.addOpenMenu(r)),()=>{n.current&&(ra.deleteOpenMenu(r),ra.getOpenMenus().forEach(i=>{i.startsWith(r)&&(t==null||t("close-menu"),ra.deleteOpenMenu(i))}),n.current=!1)}),[r,t]),[o,s]}function gb(r){const e=ue();return ye("isEditing",()=>e.getEditingShapeId()===r,[e,r])}function Fa(r){const e=ue();return I.useMemo(function(){const s=c=>{if(c.isKilled)return;if(c.button===x2){e.dispatch({type:"pointer",target:"selection",handle:r,name:"right_click",...si(c)});return}if(c.button!==0)return;const u=Jv(c.currentTarget);function p(){u.removeEventListener("pointerup",p),$g(u,c)}zg(u,c),u.addEventListener("pointerup",p),e.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:r,...si(c)}),Ar(c)};let o,i;function a(c){c.isKilled||c.button===0&&(c.clientX===o&&c.clientY===i||(o=c.clientX,i=c.clientY,e.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:r,...si(c)})))}return{onPointerDown:s,onPointerMove:a,onPointerUp:c=>{c.isKilled||c.button===0&&e.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:r,...si(c)})}}},[e,r])}function bQ(r){const[e,t]=I.useState(()=>({store:t0(r),opts:r}));if(!OO(e.opts,r)){const n={store:t0(r),opts:r};return t(n),n.store}return e.store}const SQ=20,xQ=8;function B2(r,e=SQ){return Math.max(xQ,Math.ceil(r/e))}class vh extends gd{constructor(t){super({...t,isFilled:!1,isClosed:!1});k(this,"_center");k(this,"radius");k(this,"start");k(this,"end");k(this,"largeArcFlag");k(this,"sweepFlag");k(this,"measure");k(this,"angleStart");k(this,"angleEnd");const{center:n,sweepFlag:s,largeArcFlag:o,start:i,end:a}=t;if(i.equals(a))throw Error("Arc must have different start and end points.");this.angleStart=P.Angle(n,i),this.angleEnd=P.Angle(n,a),this.radius=P.Dist(n,i),this.measure=EV(this.angleStart,this.angleEnd,s,o),this.start=i,this.end=a,this.sweepFlag=s,this.largeArcFlag=o,this._center=n}nearestPoint(t){const{_center:n,measure:s,radius:o,angleEnd:i,angleStart:a,start:l,end:c}=this,u=bE(s,a,i,n.angle(t));if(u<=0)return l;if(u>=1)return c;const p=n.clone().add(t.clone().sub(n).uni().mul(o));let f,m=1/0,v;for(const b of[l,c,p])v=P.Dist2(t,b),v<m&&(f=b,m=v);if(!f)throw Error("nearest point not found");return f}hitTestLineSegment(t,n){const{_center:s,radius:o,measure:i,angleStart:a,angleEnd:l}=this,c=Hg(t,n,s,o);return c===null?!1:c.some(u=>{const p=bE(i,a,l,s.angle(u));return p>=0&&p<=1})}getVertices(){const{_center:t,measure:n,length:s,radius:o,angleStart:i}=this,a=[];for(let l=0,c=B2(Math.abs(s));l<c+1;l++){const u=l/c*n,p=i+u;a.push(uu(t,o,p))}return a}getSvgPathData(t=!0){const{start:n,end:s,radius:o,largeArcFlag:i,sweepFlag:a}=this;return`${t?`M${n.toFixed()}`:""} A${o} ${o} 0 ${i} ${a} ${s.toFixed()}`}getLength(){return this.measure*this.radius}}class U2 extends gd{constructor(t){super({isClosed:!0,...t});k(this,"_center");k(this,"radius");k(this,"x");k(this,"y");this.config=t;const{x:n=0,y:s=0,radius:o}=t;this.x=n,this.y=s,this._center=new P(o+n,o+s),this.radius=o}getBounds(){return new Ve(this.x,this.y,this.radius*2,this.radius*2)}getVertices(){const{_center:t,radius:n}=this,s=xn*n,o=[];for(let i=0,a=B2(s);i<a;i++){const l=i/a*xn;o.push(uu(t,n,l))}return o}nearestPoint(t){const{_center:n,radius:s}=this;return n.equals(t)?P.AddXY(n,s,0):n.clone().add(t.clone().sub(n).uni().mul(s))}hitTestLineSegment(t,n,s=0){const{_center:o,radius:i}=this;return Hg(t,n,o,i+s)!==null}getSvgPathData(){const{_center:t,radius:n}=this;return`M${t.x+n},${t.y} a${n},${n} 0 1,0 ${n*2},0a${n},${n} 0 1,0 -${n*2},0`}}class $s extends ap{constructor(t){const{start:n,cp1:s,cp2:o,end:i}=t;super({...t,points:[n,i]});k(this,"a");k(this,"b");k(this,"c");k(this,"d");this.a=n,this.b=s,this.c=o,this.d=i}getVertices(){const t=[],{a:n,b:s,c:o,d:i}=this;for(let a=0,l=10;a<=l;a++){const c=a/l;t.push(new P((1-c)*(1-c)*(1-c)*n.x+3*((1-c)*(1-c))*c*s.x+3*(1-c)*(c*c)*o.x+c*c*c*i.x,(1-c)*(1-c)*(1-c)*n.y+3*((1-c)*(1-c))*c*s.y+3*(1-c)*(c*c)*o.y+c*c*c*i.y))}return t}midPoint(){return $s.GetAtT(this,.5)}nearestPoint(t){let n,s=1/0,o,i;for(const a of this.segments)i=a.nearestPoint(t),o=P.Dist2(i,t),o<s&&(n=i,s=o);if(!n)throw Error("nearest point not found");return n}getSvgPathData(t=!0){const{a:n,b:s,c:o,d:i}=this;return`${t?`M ${n.toFixed()} `:""} C${s.toFixed()} ${o.toFixed()} ${i.toFixed()}`}static GetAtT(t,n){const{a:s,b:o,c:i,d:a}=t;return new P((1-n)*(1-n)*(1-n)*s.x+3*((1-n)*(1-n))*n*o.x+3*(1-n)*(n*n)*i.x+n*n*n*a.x,(1-n)*(1-n)*(1-n)*s.y+3*((1-n)*(1-n))*n*o.y+3*(1-n)*(n*n)*i.y+n*n*n*a.y)}getLength(t=32){let n,s=this.a,o=0;for(let i=1;i<=t;i++)n=$s.GetAtT(this,i/t),o+=P.Dist(s,n),s=n;return o}}class wQ extends gd{constructor(t){super({...t,isClosed:!1,isFilled:!1});k(this,"points");k(this,"_segments");const{points:n}=t;this.points=n}get segments(){if(!this._segments){this._segments=[];const{points:t}=this,n=t.length,s=n-2,o=1.25;for(let i=0;i<n-1;i++){const a=i===0?t[0]:t[i-1],l=t[i],c=t[i+1],u=i===s?c:t[i+2],p=l,f=i===0?a:new P(l.x+(c.x-a.x)/6*o,l.y+(c.y-a.y)/6*o),m=i===s?c:new P(c.x-(u.x-l.x)/6*o,c.y-(u.y-l.y)/6*o),v=c;this._segments.push(new $s({start:p,cp1:f,cp2:m,end:v}))}}return this._segments}getLength(){return this.segments.reduce((t,n)=>t+n.length,0)}getVertices(){const t=this.segments.reduce((n,s)=>n.concat(s.vertices),[]);return t.push(this.points[this.points.length-1]),t}nearestPoint(t){let n,s=1/0,o,i;for(const a of this.segments)i=a.nearestPoint(t),o=P.Dist2(i,t),o<s&&(n=i,s=o);if(!n)throw Error("nearest point not found");return n}hitTestLineSegment(t,n){return this.segments.some(s=>s.hitTestLineSegment(t,n))}getSvgPathData(){let t=this.segments.reduce((n,s,o)=>n+s.getSvgPathData(o===0),"");return this.isClosed&&(t+="Z"),t}}class CQ extends gd{constructor(t){super({...t,isClosed:!0});k(this,"w");k(this,"h");k(this,"_edges");this.config=t;const{width:n,height:s}=t;this.w=n,this.h=s}get edges(){if(!this._edges){const{vertices:t}=this;this._edges=[];for(let n=0,s=t.length;n<s;n++){const o=t[n],i=t[(n+1)%s];this._edges.push(new $l({start:o,end:i}))}}return this._edges}getVertices(){const t=Math.max(1,this.w),n=Math.max(1,this.h),s=t/2,o=n/2,i=Math.pow(s-o,2)/Math.pow(s+o,2),a=cn*(s+o)*(1+3*i/(10+Math.sqrt(4-3*i))),l=B2(a),c=xn/l,u=Math.cos(c),p=Math.sin(c);let f=0,m=1,v=0,b=1;const S=Array(l);for(let C=0;C<l;C++)S[C]=new P(s+s*m,o+o*f),v=p*m+u*f,b=u*m-p*f,f=v,m=b;return S}nearestPoint(t){let n,s=1/0,o,i;for(const a of this.edges)i=a.nearestPoint(t),o=P.Dist2(i,t),o<s&&(n=i,s=o);if(!n)throw Error("nearest point not found");return n}hitTestLineSegment(t,n){return this.edges.some(s=>s.hitTestLineSegment(t,n))}getBounds(){return new Ve(0,0,this.w,this.h)}getLength(){const{w:t,h:n}=this,s=t/2,o=n/2,i=Math.max(0,s),a=Math.max(0,o);return j5(i,a)}getSvgPathData(t=!1){const{w:n,h:s}=this,o=n/2,i=s/2,a=Math.max(0,o),l=Math.max(0,i);return`${t?`M${o-a},${i}`:""} a${a},${l},0,1,1,${a*2},0a${a},${l},0,1,1,-${a*2},0`}}class EQ extends gd{constructor(t){super({...t,isClosed:!0});k(this,"w");k(this,"h");k(this,"a");k(this,"b");k(this,"c");k(this,"d");this.config=t;const{width:n,height:s}=t;if(this.w=n,this.h=s,s>n){const o=n/2;this.a=new vh({start:new P(0,o),end:new P(n,o),center:new P(n/2,o),sweepFlag:1,largeArcFlag:1}),this.b=new $l({start:new P(n,o),end:new P(n,s-o)}),this.c=new vh({start:new P(n,s-o),end:new P(0,s-o),center:new P(n/2,s-o),sweepFlag:1,largeArcFlag:1}),this.d=new $l({start:new P(0,s-o),end:new P(0,o)})}else{const o=s/2;this.a=new vh({start:new P(o,s),end:new P(o,0),center:new P(o,o),sweepFlag:1,largeArcFlag:1}),this.b=new $l({start:new P(o,0),end:new P(n-o,0)}),this.c=new vh({start:new P(n-o,0),end:new P(n-o,s),center:new P(n-o,o),sweepFlag:1,largeArcFlag:1}),this.d=new $l({start:new P(n-o,s),end:new P(o,s)})}}nearestPoint(t){let n,s=1/0,o,i;const{a,b:l,c,d:u}=this;for(const p of[a,l,c,u])i=p.nearestPoint(t),o=P.Dist2(i,t),o<s&&(n=i,s=o);if(!n)throw Error("nearest point not found");return n}hitTestLineSegment(t,n){const{a:s,b:o,c:i,d:a}=this;return[s,o,i,a].some(l=>l.hitTestLineSegment(t,n))}getVertices(){const{a:t,b:n,c:s,d:o}=this;return[t,n,s,o].reduce((i,a)=>(i.push(...a.vertices),i),[])}getBounds(){return new Ve(0,0,this.w,this.h)}getLength(){const{h:t,w:n}=this;return t>n?(cn*(n/2)+(t-n))*2:(cn*(t/2)+(n-t))*2}getSvgPathData(){const{a:t,b:n,c:s,d:o}=this;return[t,n,s,o].map((i,a)=>i.getSvgPathData(a===0)).join(" ")+" Z"}}async function kQ({shouldReload:r=!0}={}){nG();for(const e of Fv.connectedInstances)await e.close();await Promise.all(s2().map(e=>F3(e))),tG(),r&&window.location.reload()}typeof window<"u"&&(window.__tldraw__hardReset=kQ);function PQ(r,e="_blank"){tb.openWindow(r,e)}dd("@tldraw/editor","3.7.0","esm");function w8(){const[r,e]=I.useState(!1);return I.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;const t=window.matchMedia("(prefers-reduced-motion: reduce)"),n=()=>{e(t.matches)};return n(),t.addEventListener("change",n),()=>t.removeEventListener("change",n)},[]),r}const C8=()=>{},E8=I.createContext(null);function IQ({onEvent:r,children:e}){return g.jsx(E8.Provider,{value:r??C8,children:e})}function ws(){return I.useContext(E8)??C8}function Qe(r,e,{checkForDefaultPrevented:t=!0}={}){return function(s){if(r==null||r(s),t===!1||!s.defaultPrevented)return e==null?void 0:e(s)}}function _Q(r,e){const t=I.createContext(e),n=o=>{const{children:i,...a}=o,l=I.useMemo(()=>a,Object.values(a));return g.jsx(t.Provider,{value:l,children:i})};n.displayName=r+"Provider";function s(o){const i=I.useContext(t);if(i)return i;if(e!==void 0)return e;throw new Error(`\`${o}\` must be used within \`${r}\``)}return[n,s]}function ku(r,e=[]){let t=[];function n(o,i){const a=I.createContext(i),l=t.length;t=[...t,i];const c=p=>{var C;const{scope:f,children:m,...v}=p,b=((C=f==null?void 0:f[r])==null?void 0:C[l])||a,S=I.useMemo(()=>v,Object.values(v));return g.jsx(b.Provider,{value:S,children:m})};c.displayName=o+"Provider";function u(p,f){var b;const m=((b=f==null?void 0:f[r])==null?void 0:b[l])||a,v=I.useContext(m);if(v)return v;if(i!==void 0)return i;throw new Error(`\`${p}\` must be used within \`${o}\``)}return[c,u]}const s=()=>{const o=t.map(i=>I.createContext(i));return function(a){const l=(a==null?void 0:a[r])||o;return I.useMemo(()=>({[`__scope${r}`]:{...a,[r]:l}}),[a,l])}};return s.scopeName=r,[n,TQ(s,...e)]}function TQ(...r){const e=r[0];if(r.length===1)return e;const t=()=>{const n=r.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(o){const i=n.reduce((a,{useScope:l,scopeName:c})=>{const p=l(o)[`__scope${c}`];return{...a,...p}},{});return I.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return t.scopeName=e.scopeName,t}function MQ(r,e){typeof r=="function"?r(e):r!=null&&(r.current=e)}function mb(...r){return e=>r.forEach(t=>MQ(t,e))}function Un(...r){return I.useCallback(mb(...r),r)}var hu=I.forwardRef((r,e)=>{const{children:t,...n}=r,s=I.Children.toArray(t),o=s.find(jQ);if(o){const i=o.props.children,a=s.map(l=>l===o?I.Children.count(i)>1?I.Children.only(null):I.isValidElement(i)?i.props.children:null:l);return g.jsx(RE,{...n,ref:e,children:I.isValidElement(i)?I.cloneElement(i,void 0,a):null})}return g.jsx(RE,{...n,ref:e,children:t})});hu.displayName="Slot";var RE=I.forwardRef((r,e)=>{const{children:t,...n}=r;if(I.isValidElement(t)){const s=DQ(t);return I.cloneElement(t,{...RQ(n,t.props),ref:e?mb(e,s):s})}return I.Children.count(t)>1?I.Children.only(null):null});RE.displayName="SlotClone";var AQ=({children:r})=>g.jsx(g.Fragment,{children:r});function jQ(r){return I.isValidElement(r)&&r.type===AQ}function RQ(r,e){const t={...e};for(const n in e){const s=r[n],o=e[n];/^on[A-Z]/.test(n)?s&&o?t[n]=(...a)=>{o(...a),s(...a)}:s&&(t[n]=s):n==="style"?t[n]={...s,...o}:n==="className"&&(t[n]=[s,o].filter(Boolean).join(" "))}return{...r,...t}}function DQ(r){var n,s;let e=(n=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:n.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?r.ref:(e=(s=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?r.props.ref:r.props.ref||r.ref)}var OQ=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],rn=OQ.reduce((r,e)=>{const t=I.forwardRef((n,s)=>{const{asChild:o,...i}=n,a=o?hu:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),g.jsx(a,{...i,ref:s})});return t.displayName=`Primitive.${e}`,{...r,[e]:t}},{});function H2(r,e){r&&lp.flushSync(()=>r.dispatchEvent(e))}function LQ(r,e=[]){let t=[];function n(o,i){const a=I.createContext(i),l=t.length;t=[...t,i];function c(p){const{scope:f,children:m,...v}=p,b=(f==null?void 0:f[r][l])||a,S=I.useMemo(()=>v,Object.values(v));return g.jsx(b.Provider,{value:S,children:m})}function u(p,f){const m=(f==null?void 0:f[r][l])||a,v=I.useContext(m);if(v)return v;if(i!==void 0)return i;throw new Error(`\`${p}\` must be used within \`${o}\``)}return c.displayName=o+"Provider",[c,u]}const s=()=>{const o=t.map(i=>I.createContext(i));return function(a){const l=(a==null?void 0:a[r])||o;return I.useMemo(()=>({[`__scope${r}`]:{...a,[r]:l}}),[a,l])}};return s.scopeName=r,[n,NQ(s,...e)]}function NQ(...r){const e=r[0];if(r.length===1)return e;const t=()=>{const n=r.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(o){const i=n.reduce((a,{useScope:l,scopeName:c})=>{const p=l(o)[`__scope${c}`];return{...a,...p}},{});return I.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return t.scopeName=e.scopeName,t}function yb(r){const e=r+"CollectionProvider",[t,n]=LQ(e),[s,o]=t(e,{collectionRef:{current:null},itemMap:new Map}),i=m=>{const{scope:v,children:b}=m,S=Ht.useRef(null),C=Ht.useRef(new Map).current;return g.jsx(s,{scope:v,itemMap:C,collectionRef:S,children:b})};i.displayName=e;const a=r+"CollectionSlot",l=Ht.forwardRef((m,v)=>{const{scope:b,children:S}=m,C=o(a,b),E=Un(v,C.collectionRef);return g.jsx(hu,{ref:E,children:S})});l.displayName=a;const c=r+"CollectionItemSlot",u="data-radix-collection-item",p=Ht.forwardRef((m,v)=>{const{scope:b,children:S,...C}=m,E=Ht.useRef(null),T=Un(v,E),w=o(c,b);return Ht.useEffect(()=>(w.itemMap.set(E,{ref:E,...C}),()=>void w.itemMap.delete(E))),g.jsx(hu,{[u]:"",ref:T,children:S})});p.displayName=c;function f(m){const v=o(r+"CollectionConsumer",m);return Ht.useCallback(()=>{const S=v.collectionRef.current;if(!S)return[];const C=Array.from(S.querySelectorAll(`[${u}]`));return Array.from(v.itemMap.values()).sort((w,M)=>C.indexOf(w.ref.current)-C.indexOf(M.ref.current))},[v.collectionRef,v.itemMap])}return[{Provider:i,Slot:l,ItemSlot:p},f,n]}var FQ=I.createContext(void 0);function G2(r){const e=I.useContext(FQ);return r||e||"ltr"}function bs(r){const e=I.useRef(r);return I.useEffect(()=>{e.current=r}),I.useMemo(()=>(...t)=>{var n;return(n=e.current)==null?void 0:n.call(e,...t)},[])}function zQ(r,e=globalThis==null?void 0:globalThis.document){const t=bs(r);I.useEffect(()=>{const n=s=>{s.key==="Escape"&&t(s)};return e.addEventListener("keydown",n,{capture:!0}),()=>e.removeEventListener("keydown",n,{capture:!0})},[t,e])}var $Q="DismissableLayer",DE="dismissableLayer.update",BQ="dismissableLayer.pointerDownOutside",UQ="dismissableLayer.focusOutside",LR,k8=I.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Yg=I.forwardRef((r,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:n,onPointerDownOutside:s,onFocusOutside:o,onInteractOutside:i,onDismiss:a,...l}=r,c=I.useContext(k8),[u,p]=I.useState(null),f=(u==null?void 0:u.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,m]=I.useState({}),v=Un(e,D=>p(D)),b=Array.from(c.layers),[S]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),C=b.indexOf(S),E=u?b.indexOf(u):-1,T=c.layersWithOutsidePointerEventsDisabled.size>0,w=E>=C,M=GQ(D=>{const N=D.target,z=[...c.branches].some(L=>L.contains(N));!w||z||(s==null||s(D),i==null||i(D),D.defaultPrevented||a==null||a())},f),R=WQ(D=>{const N=D.target;[...c.branches].some(L=>L.contains(N))||(o==null||o(D),i==null||i(D),D.defaultPrevented||a==null||a())},f);return zQ(D=>{E===c.layers.size-1&&(n==null||n(D),!D.defaultPrevented&&a&&(D.preventDefault(),a()))},f),I.useEffect(()=>{if(u)return t&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(LR=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),NR(),()=>{t&&c.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=LR)}},[u,f,t,c]),I.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),NR())},[u,c]),I.useEffect(()=>{const D=()=>m({});return document.addEventListener(DE,D),()=>document.removeEventListener(DE,D)},[]),g.jsx(rn.div,{...l,ref:v,style:{pointerEvents:T?w?"auto":"none":void 0,...r.style},onFocusCapture:Qe(r.onFocusCapture,R.onFocusCapture),onBlurCapture:Qe(r.onBlurCapture,R.onBlurCapture),onPointerDownCapture:Qe(r.onPointerDownCapture,M.onPointerDownCapture)})});Yg.displayName=$Q;var HQ="DismissableLayerBranch",P8=I.forwardRef((r,e)=>{const t=I.useContext(k8),n=I.useRef(null),s=Un(e,n);return I.useEffect(()=>{const o=n.current;if(o)return t.branches.add(o),()=>{t.branches.delete(o)}},[t.branches]),g.jsx(rn.div,{...r,ref:s})});P8.displayName=HQ;function GQ(r,e=globalThis==null?void 0:globalThis.document){const t=bs(r),n=I.useRef(!1),s=I.useRef(()=>{});return I.useEffect(()=>{const o=a=>{if(a.target&&!n.current){let l=function(){I8(BQ,t,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",s.current),s.current=l,e.addEventListener("click",s.current,{once:!0})):l()}else e.removeEventListener("click",s.current);n.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",o),e.removeEventListener("click",s.current)}},[e,t]),{onPointerDownCapture:()=>n.current=!0}}function WQ(r,e=globalThis==null?void 0:globalThis.document){const t=bs(r),n=I.useRef(!1);return I.useEffect(()=>{const s=o=>{o.target&&!n.current&&I8(UQ,t,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",s),()=>e.removeEventListener("focusin",s)},[e,t]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function NR(){const r=new CustomEvent(DE);document.dispatchEvent(r)}function I8(r,e,t,{discrete:n}){const s=t.originalEvent.target,o=new CustomEvent(r,{bubbles:!1,cancelable:!0,detail:t});e&&s.addEventListener(r,e,{once:!0}),n?H2(s,o):s.dispatchEvent(o)}var KQ=Yg,VQ=P8,oC=0;function W2(){I.useEffect(()=>{const r=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",r[0]??FR()),document.body.insertAdjacentElement("beforeend",r[1]??FR()),oC++,()=>{oC===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),oC--}},[])}function FR(){const r=document.createElement("span");return r.setAttribute("data-radix-focus-guard",""),r.tabIndex=0,r.style.outline="none",r.style.opacity="0",r.style.position="fixed",r.style.pointerEvents="none",r}var iC="focusScope.autoFocusOnMount",aC="focusScope.autoFocusOnUnmount",zR={bubbles:!1,cancelable:!0},qQ="FocusScope",vb=I.forwardRef((r,e)=>{const{loop:t=!1,trapped:n=!1,onMountAutoFocus:s,onUnmountAutoFocus:o,...i}=r,[a,l]=I.useState(null),c=bs(s),u=bs(o),p=I.useRef(null),f=Un(e,b=>l(b)),m=I.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;I.useEffect(()=>{if(n){let b=function(T){if(m.paused||!a)return;const w=T.target;a.contains(w)?p.current=w:Lc(p.current,{select:!0})},S=function(T){if(m.paused||!a)return;const w=T.relatedTarget;w!==null&&(a.contains(w)||Lc(p.current,{select:!0}))},C=function(T){if(document.activeElement===document.body)for(const M of T)M.removedNodes.length>0&&Lc(a)};document.addEventListener("focusin",b),document.addEventListener("focusout",S);const E=new MutationObserver(C);return a&&E.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",b),document.removeEventListener("focusout",S),E.disconnect()}}},[n,a,m.paused]),I.useEffect(()=>{if(a){BR.add(m);const b=document.activeElement;if(!a.contains(b)){const C=new CustomEvent(iC,zR);a.addEventListener(iC,c),a.dispatchEvent(C),C.defaultPrevented||(YQ(eee(_8(a)),{select:!0}),document.activeElement===b&&Lc(a))}return()=>{a.removeEventListener(iC,c),setTimeout(()=>{const C=new CustomEvent(aC,zR);a.addEventListener(aC,u),a.dispatchEvent(C),C.defaultPrevented||Lc(b??document.body,{select:!0}),a.removeEventListener(aC,u),BR.remove(m)},0)}}},[a,c,u,m]);const v=I.useCallback(b=>{if(!t&&!n||m.paused)return;const S=b.key==="Tab"&&!b.altKey&&!b.ctrlKey&&!b.metaKey,C=document.activeElement;if(S&&C){const E=b.currentTarget,[T,w]=XQ(E);T&&w?!b.shiftKey&&C===w?(b.preventDefault(),t&&Lc(T,{select:!0})):b.shiftKey&&C===T&&(b.preventDefault(),t&&Lc(w,{select:!0})):C===E&&b.preventDefault()}},[t,n,m.paused]);return g.jsx(rn.div,{tabIndex:-1,...i,ref:f,onKeyDown:v})});vb.displayName=qQ;function YQ(r,{select:e=!1}={}){const t=document.activeElement;for(const n of r)if(Lc(n,{select:e}),document.activeElement!==t)return}function XQ(r){const e=_8(r),t=$R(e,r),n=$R(e.reverse(),r);return[t,n]}function _8(r){const e=[],t=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function $R(r,e){for(const t of r)if(!ZQ(t,{upTo:e}))return t}function ZQ(r,{upTo:e}){if(getComputedStyle(r).visibility==="hidden")return!0;for(;r;){if(e!==void 0&&r===e)return!1;if(getComputedStyle(r).display==="none")return!0;r=r.parentElement}return!1}function JQ(r){return r instanceof HTMLInputElement&&"select"in r}function Lc(r,{select:e=!1}={}){if(r&&r.focus){const t=document.activeElement;r.focus({preventScroll:!0}),r!==t&&JQ(r)&&e&&r.select()}}var BR=QQ();function QQ(){let r=[];return{add(e){const t=r[0];e!==t&&(t==null||t.pause()),r=UR(r,e),r.unshift(e)},remove(e){var t;r=UR(r,e),(t=r[0])==null||t.resume()}}}function UR(r,e){const t=[...r],n=t.indexOf(e);return n!==-1&&t.splice(n,1),t}function eee(r){return r.filter(e=>e.tagName!=="A")}var od=globalThis!=null&&globalThis.document?I.useLayoutEffect:()=>{},tee=rE.useId||(()=>{}),nee=0;function Vl(r){const[e,t]=I.useState(tee());return od(()=>{r||t(n=>n??String(nee++))},[r]),r||(e?`radix-${e}`:"")}const ree=["top","right","bottom","left"],id=Math.min,ti=Math.max,n0=Math.round,Cy=Math.floor,sl=r=>({x:r,y:r}),see={left:"right",right:"left",bottom:"top",top:"bottom"},oee={start:"end",end:"start"};function OE(r,e,t){return ti(r,id(e,t))}function Xl(r,e){return typeof r=="function"?r(e):r}function Zl(r){return r.split("-")[0]}function hp(r){return r.split("-")[1]}function K2(r){return r==="x"?"y":"x"}function V2(r){return r==="y"?"height":"width"}function ad(r){return["top","bottom"].includes(Zl(r))?"y":"x"}function q2(r){return K2(ad(r))}function iee(r,e,t){t===void 0&&(t=!1);const n=hp(r),s=q2(r),o=V2(s);let i=s==="x"?n===(t?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[o]>e.floating[o]&&(i=r0(i)),[i,r0(i)]}function aee(r){const e=r0(r);return[LE(r),e,LE(e)]}function LE(r){return r.replace(/start|end/g,e=>oee[e])}function lee(r,e,t){const n=["left","right"],s=["right","left"],o=["top","bottom"],i=["bottom","top"];switch(r){case"top":case"bottom":return t?e?s:n:e?n:s;case"left":case"right":return e?o:i;default:return[]}}function cee(r,e,t,n){const s=hp(r);let o=lee(Zl(r),t==="start",n);return s&&(o=o.map(i=>i+"-"+s),e&&(o=o.concat(o.map(LE)))),o}function r0(r){return r.replace(/left|right|bottom|top/g,e=>see[e])}function dee(r){return{top:0,right:0,bottom:0,left:0,...r}}function T8(r){return typeof r!="number"?dee(r):{top:r,right:r,bottom:r,left:r}}function s0(r){const{x:e,y:t,width:n,height:s}=r;return{width:n,height:s,top:t,left:e,right:e+n,bottom:t+s,x:e,y:t}}function HR(r,e,t){let{reference:n,floating:s}=r;const o=ad(e),i=q2(e),a=V2(i),l=Zl(e),c=o==="y",u=n.x+n.width/2-s.width/2,p=n.y+n.height/2-s.height/2,f=n[a]/2-s[a]/2;let m;switch(l){case"top":m={x:u,y:n.y-s.height};break;case"bottom":m={x:u,y:n.y+n.height};break;case"right":m={x:n.x+n.width,y:p};break;case"left":m={x:n.x-s.width,y:p};break;default:m={x:n.x,y:n.y}}switch(hp(e)){case"start":m[i]-=f*(t&&c?-1:1);break;case"end":m[i]+=f*(t&&c?-1:1);break}return m}const uee=async(r,e,t)=>{const{placement:n="bottom",strategy:s="absolute",middleware:o=[],platform:i}=t,a=o.filter(Boolean),l=await(i.isRTL==null?void 0:i.isRTL(e));let c=await i.getElementRects({reference:r,floating:e,strategy:s}),{x:u,y:p}=HR(c,n,l),f=n,m={},v=0;for(let b=0;b<a.length;b++){const{name:S,fn:C}=a[b],{x:E,y:T,data:w,reset:M}=await C({x:u,y:p,initialPlacement:n,placement:f,strategy:s,middlewareData:m,rects:c,platform:i,elements:{reference:r,floating:e}});u=E??u,p=T??p,m={...m,[S]:{...m[S],...w}},M&&v<=50&&(v++,typeof M=="object"&&(M.placement&&(f=M.placement),M.rects&&(c=M.rects===!0?await i.getElementRects({reference:r,floating:e,strategy:s}):M.rects),{x:u,y:p}=HR(c,f,l)),b=-1)}return{x:u,y:p,placement:f,strategy:s,middlewareData:m}};async function Gf(r,e){var t;e===void 0&&(e={});const{x:n,y:s,platform:o,rects:i,elements:a,strategy:l}=r,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:p="floating",altBoundary:f=!1,padding:m=0}=Xl(e,r),v=T8(m),S=a[f?p==="floating"?"reference":"floating":p],C=s0(await o.getClippingRect({element:(t=await(o.isElement==null?void 0:o.isElement(S)))==null||t?S:S.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),E=p==="floating"?{x:n,y:s,width:i.floating.width,height:i.floating.height}:i.reference,T=await(o.getOffsetParent==null?void 0:o.getOffsetParent(a.floating)),w=await(o.isElement==null?void 0:o.isElement(T))?await(o.getScale==null?void 0:o.getScale(T))||{x:1,y:1}:{x:1,y:1},M=s0(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:E,offsetParent:T,strategy:l}):E);return{top:(C.top-M.top+v.top)/w.y,bottom:(M.bottom-C.bottom+v.bottom)/w.y,left:(C.left-M.left+v.left)/w.x,right:(M.right-C.right+v.right)/w.x}}const hee=r=>({name:"arrow",options:r,async fn(e){const{x:t,y:n,placement:s,rects:o,platform:i,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=Xl(r,e)||{};if(c==null)return{};const p=T8(u),f={x:t,y:n},m=q2(s),v=V2(m),b=await i.getDimensions(c),S=m==="y",C=S?"top":"left",E=S?"bottom":"right",T=S?"clientHeight":"clientWidth",w=o.reference[v]+o.reference[m]-f[m]-o.floating[v],M=f[m]-o.reference[m],R=await(i.getOffsetParent==null?void 0:i.getOffsetParent(c));let D=R?R[T]:0;(!D||!await(i.isElement==null?void 0:i.isElement(R)))&&(D=a.floating[T]||o.floating[v]);const N=w/2-M/2,z=D/2-b[v]/2-1,L=id(p[C],z),B=id(p[E],z),K=L,O=D-b[v]-B,U=D/2-b[v]/2+N,X=OE(K,U,O),H=!l.arrow&&hp(s)!=null&&U!==X&&o.reference[v]/2-(U<K?L:B)-b[v]/2<0,ee=H?U<K?U-K:U-O:0;return{[m]:f[m]+ee,data:{[m]:X,centerOffset:U-X-ee,...H&&{alignmentOffset:ee}},reset:H}}}),pee=function(r){return r===void 0&&(r={}),{name:"flip",options:r,async fn(e){var t,n;const{placement:s,middlewareData:o,rects:i,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:p=!0,fallbackPlacements:f,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:v="none",flipAlignment:b=!0,...S}=Xl(r,e);if((t=o.arrow)!=null&&t.alignmentOffset)return{};const C=Zl(s),E=ad(a),T=Zl(a)===a,w=await(l.isRTL==null?void 0:l.isRTL(c.floating)),M=f||(T||!b?[r0(a)]:aee(a)),R=v!=="none";!f&&R&&M.push(...cee(a,b,v,w));const D=[a,...M],N=await Gf(e,S),z=[];let L=((n=o.flip)==null?void 0:n.overflows)||[];if(u&&z.push(N[C]),p){const U=iee(s,i,w);z.push(N[U[0]],N[U[1]])}if(L=[...L,{placement:s,overflows:z}],!z.every(U=>U<=0)){var B,K;const U=(((B=o.flip)==null?void 0:B.index)||0)+1,X=D[U];if(X)return{data:{index:U,overflows:L},reset:{placement:X}};let H=(K=L.filter(ee=>ee.overflows[0]<=0).sort((ee,J)=>ee.overflows[1]-J.overflows[1])[0])==null?void 0:K.placement;if(!H)switch(m){case"bestFit":{var O;const ee=(O=L.filter(J=>{if(R){const ne=ad(J.placement);return ne===E||ne==="y"}return!0}).map(J=>[J.placement,J.overflows.filter(ne=>ne>0).reduce((ne,ae)=>ne+ae,0)]).sort((J,ne)=>J[1]-ne[1])[0])==null?void 0:O[0];ee&&(H=ee);break}case"initialPlacement":H=a;break}if(s!==H)return{reset:{placement:H}}}return{}}}};function GR(r,e){return{top:r.top-e.height,right:r.right-e.width,bottom:r.bottom-e.height,left:r.left-e.width}}function WR(r){return ree.some(e=>r[e]>=0)}const fee=function(r){return r===void 0&&(r={}),{name:"hide",options:r,async fn(e){const{rects:t}=e,{strategy:n="referenceHidden",...s}=Xl(r,e);switch(n){case"referenceHidden":{const o=await Gf(e,{...s,elementContext:"reference"}),i=GR(o,t.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:WR(i)}}}case"escaped":{const o=await Gf(e,{...s,altBoundary:!0}),i=GR(o,t.floating);return{data:{escapedOffsets:i,escaped:WR(i)}}}default:return{}}}}};async function gee(r,e){const{placement:t,platform:n,elements:s}=r,o=await(n.isRTL==null?void 0:n.isRTL(s.floating)),i=Zl(t),a=hp(t),l=ad(t)==="y",c=["left","top"].includes(i)?-1:1,u=o&&l?-1:1,p=Xl(e,r);let{mainAxis:f,crossAxis:m,alignmentAxis:v}=typeof p=="number"?{mainAxis:p,crossAxis:0,alignmentAxis:null}:{mainAxis:p.mainAxis||0,crossAxis:p.crossAxis||0,alignmentAxis:p.alignmentAxis};return a&&typeof v=="number"&&(m=a==="end"?v*-1:v),l?{x:m*u,y:f*c}:{x:f*c,y:m*u}}const mee=function(r){return r===void 0&&(r=0),{name:"offset",options:r,async fn(e){var t,n;const{x:s,y:o,placement:i,middlewareData:a}=e,l=await gee(e,r);return i===((t=a.offset)==null?void 0:t.placement)&&(n=a.arrow)!=null&&n.alignmentOffset?{}:{x:s+l.x,y:o+l.y,data:{...l,placement:i}}}}},yee=function(r){return r===void 0&&(r={}),{name:"shift",options:r,async fn(e){const{x:t,y:n,placement:s}=e,{mainAxis:o=!0,crossAxis:i=!1,limiter:a={fn:S=>{let{x:C,y:E}=S;return{x:C,y:E}}},...l}=Xl(r,e),c={x:t,y:n},u=await Gf(e,l),p=ad(Zl(s)),f=K2(p);let m=c[f],v=c[p];if(o){const S=f==="y"?"top":"left",C=f==="y"?"bottom":"right",E=m+u[S],T=m-u[C];m=OE(E,m,T)}if(i){const S=p==="y"?"top":"left",C=p==="y"?"bottom":"right",E=v+u[S],T=v-u[C];v=OE(E,v,T)}const b=a.fn({...e,[f]:m,[p]:v});return{...b,data:{x:b.x-t,y:b.y-n,enabled:{[f]:o,[p]:i}}}}}},vee=function(r){return r===void 0&&(r={}),{options:r,fn(e){const{x:t,y:n,placement:s,rects:o,middlewareData:i}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=Xl(r,e),u={x:t,y:n},p=ad(s),f=K2(p);let m=u[f],v=u[p];const b=Xl(a,e),S=typeof b=="number"?{mainAxis:b,crossAxis:0}:{mainAxis:0,crossAxis:0,...b};if(l){const T=f==="y"?"height":"width",w=o.reference[f]-o.floating[T]+S.mainAxis,M=o.reference[f]+o.reference[T]-S.mainAxis;m<w?m=w:m>M&&(m=M)}if(c){var C,E;const T=f==="y"?"width":"height",w=["top","left"].includes(Zl(s)),M=o.reference[p]-o.floating[T]+(w&&((C=i.offset)==null?void 0:C[p])||0)+(w?0:S.crossAxis),R=o.reference[p]+o.reference[T]+(w?0:((E=i.offset)==null?void 0:E[p])||0)-(w?S.crossAxis:0);v<M?v=M:v>R&&(v=R)}return{[f]:m,[p]:v}}}},bee=function(r){return r===void 0&&(r={}),{name:"size",options:r,async fn(e){var t,n;const{placement:s,rects:o,platform:i,elements:a}=e,{apply:l=()=>{},...c}=Xl(r,e),u=await Gf(e,c),p=Zl(s),f=hp(s),m=ad(s)==="y",{width:v,height:b}=o.floating;let S,C;p==="top"||p==="bottom"?(S=p,C=f===(await(i.isRTL==null?void 0:i.isRTL(a.floating))?"start":"end")?"left":"right"):(C=p,S=f==="end"?"top":"bottom");const E=b-u.top-u.bottom,T=v-u.left-u.right,w=id(b-u[S],E),M=id(v-u[C],T),R=!e.middlewareData.shift;let D=w,N=M;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(N=T),(n=e.middlewareData.shift)!=null&&n.enabled.y&&(D=E),R&&!f){const L=ti(u.left,0),B=ti(u.right,0),K=ti(u.top,0),O=ti(u.bottom,0);m?N=v-2*(L!==0||B!==0?L+B:ti(u.left,u.right)):D=b-2*(K!==0||O!==0?K+O:ti(u.top,u.bottom))}await l({...e,availableWidth:N,availableHeight:D});const z=await i.getDimensions(a.floating);return v!==z.width||b!==z.height?{reset:{rects:!0}}:{}}}};function bb(){return typeof window<"u"}function pp(r){return M8(r)?(r.nodeName||"").toLowerCase():"#document"}function li(r){var e;return(r==null||(e=r.ownerDocument)==null?void 0:e.defaultView)||window}function yl(r){var e;return(e=(M8(r)?r.ownerDocument:r.document)||window.document)==null?void 0:e.documentElement}function M8(r){return bb()?r instanceof Node||r instanceof li(r).Node:!1}function ga(r){return bb()?r instanceof Element||r instanceof li(r).Element:!1}function ul(r){return bb()?r instanceof HTMLElement||r instanceof li(r).HTMLElement:!1}function KR(r){return!bb()||typeof ShadowRoot>"u"?!1:r instanceof ShadowRoot||r instanceof li(r).ShadowRoot}function Xg(r){const{overflow:e,overflowX:t,overflowY:n,display:s}=ma(r);return/auto|scroll|overlay|hidden|clip/.test(e+n+t)&&!["inline","contents"].includes(s)}function See(r){return["table","td","th"].includes(pp(r))}function Sb(r){return[":popover-open",":modal"].some(e=>{try{return r.matches(e)}catch{return!1}})}function Y2(r){const e=X2(),t=ga(r)?ma(r):r;return t.transform!=="none"||t.perspective!=="none"||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","perspective","filter"].some(n=>(t.willChange||"").includes(n))||["paint","layout","strict","content"].some(n=>(t.contain||"").includes(n))}function xee(r){let e=ld(r);for(;ul(e)&&!Hh(e);){if(Y2(e))return e;if(Sb(e))return null;e=ld(e)}return null}function X2(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Hh(r){return["html","body","#document"].includes(pp(r))}function ma(r){return li(r).getComputedStyle(r)}function xb(r){return ga(r)?{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}:{scrollLeft:r.scrollX,scrollTop:r.scrollY}}function ld(r){if(pp(r)==="html")return r;const e=r.assignedSlot||r.parentNode||KR(r)&&r.host||yl(r);return KR(e)?e.host:e}function A8(r){const e=ld(r);return Hh(e)?r.ownerDocument?r.ownerDocument.body:r.body:ul(e)&&Xg(e)?e:A8(e)}function Wf(r,e,t){var n;e===void 0&&(e=[]),t===void 0&&(t=!0);const s=A8(r),o=s===((n=r.ownerDocument)==null?void 0:n.body),i=li(s);if(o){const a=NE(i);return e.concat(i,i.visualViewport||[],Xg(s)?s:[],a&&t?Wf(a):[])}return e.concat(s,Wf(s,[],t))}function NE(r){return r.parent&&Object.getPrototypeOf(r.parent)?r.frameElement:null}function j8(r){const e=ma(r);let t=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const s=ul(r),o=s?r.offsetWidth:t,i=s?r.offsetHeight:n,a=n0(t)!==o||n0(n)!==i;return a&&(t=o,n=i),{width:t,height:n,$:a}}function Z2(r){return ga(r)?r:r.contextElement}function Ih(r){const e=Z2(r);if(!ul(e))return sl(1);const t=e.getBoundingClientRect(),{width:n,height:s,$:o}=j8(e);let i=(o?n0(t.width):t.width)/n,a=(o?n0(t.height):t.height)/s;return(!i||!Number.isFinite(i))&&(i=1),(!a||!Number.isFinite(a))&&(a=1),{x:i,y:a}}const wee=sl(0);function R8(r){const e=li(r);return!X2()||!e.visualViewport?wee:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Cee(r,e,t){return e===void 0&&(e=!1),!t||e&&t!==li(r)?!1:e}function pu(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=!1);const s=r.getBoundingClientRect(),o=Z2(r);let i=sl(1);e&&(n?ga(n)&&(i=Ih(n)):i=Ih(r));const a=Cee(o,t,n)?R8(o):sl(0);let l=(s.left+a.x)/i.x,c=(s.top+a.y)/i.y,u=s.width/i.x,p=s.height/i.y;if(o){const f=li(o),m=n&&ga(n)?li(n):n;let v=f,b=NE(v);for(;b&&n&&m!==v;){const S=Ih(b),C=b.getBoundingClientRect(),E=ma(b),T=C.left+(b.clientLeft+parseFloat(E.paddingLeft))*S.x,w=C.top+(b.clientTop+parseFloat(E.paddingTop))*S.y;l*=S.x,c*=S.y,u*=S.x,p*=S.y,l+=T,c+=w,v=li(b),b=NE(v)}}return s0({width:u,height:p,x:l,y:c})}function J2(r,e){const t=xb(r).scrollLeft;return e?e.left+t:pu(yl(r)).left+t}function D8(r,e,t){t===void 0&&(t=!1);const n=r.getBoundingClientRect(),s=n.left+e.scrollLeft-(t?0:J2(r,n)),o=n.top+e.scrollTop;return{x:s,y:o}}function Eee(r){let{elements:e,rect:t,offsetParent:n,strategy:s}=r;const o=s==="fixed",i=yl(n),a=e?Sb(e.floating):!1;if(n===i||a&&o)return t;let l={scrollLeft:0,scrollTop:0},c=sl(1);const u=sl(0),p=ul(n);if((p||!p&&!o)&&((pp(n)!=="body"||Xg(i))&&(l=xb(n)),ul(n))){const m=pu(n);c=Ih(n),u.x=m.x+n.clientLeft,u.y=m.y+n.clientTop}const f=i&&!p&&!o?D8(i,l,!0):sl(0);return{width:t.width*c.x,height:t.height*c.y,x:t.x*c.x-l.scrollLeft*c.x+u.x+f.x,y:t.y*c.y-l.scrollTop*c.y+u.y+f.y}}function kee(r){return Array.from(r.getClientRects())}function Pee(r){const e=yl(r),t=xb(r),n=r.ownerDocument.body,s=ti(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),o=ti(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let i=-t.scrollLeft+J2(r);const a=-t.scrollTop;return ma(n).direction==="rtl"&&(i+=ti(e.clientWidth,n.clientWidth)-s),{width:s,height:o,x:i,y:a}}function Iee(r,e){const t=li(r),n=yl(r),s=t.visualViewport;let o=n.clientWidth,i=n.clientHeight,a=0,l=0;if(s){o=s.width,i=s.height;const c=X2();(!c||c&&e==="fixed")&&(a=s.offsetLeft,l=s.offsetTop)}return{width:o,height:i,x:a,y:l}}function _ee(r,e){const t=pu(r,!0,e==="fixed"),n=t.top+r.clientTop,s=t.left+r.clientLeft,o=ul(r)?Ih(r):sl(1),i=r.clientWidth*o.x,a=r.clientHeight*o.y,l=s*o.x,c=n*o.y;return{width:i,height:a,x:l,y:c}}function VR(r,e,t){let n;if(e==="viewport")n=Iee(r,t);else if(e==="document")n=Pee(yl(r));else if(ga(e))n=_ee(e,t);else{const s=R8(r);n={x:e.x-s.x,y:e.y-s.y,width:e.width,height:e.height}}return s0(n)}function O8(r,e){const t=ld(r);return t===e||!ga(t)||Hh(t)?!1:ma(t).position==="fixed"||O8(t,e)}function Tee(r,e){const t=e.get(r);if(t)return t;let n=Wf(r,[],!1).filter(a=>ga(a)&&pp(a)!=="body"),s=null;const o=ma(r).position==="fixed";let i=o?ld(r):r;for(;ga(i)&&!Hh(i);){const a=ma(i),l=Y2(i);!l&&a.position==="fixed"&&(s=null),(o?!l&&!s:!l&&a.position==="static"&&!!s&&["absolute","fixed"].includes(s.position)||Xg(i)&&!l&&O8(r,i))?n=n.filter(u=>u!==i):s=a,i=ld(i)}return e.set(r,n),n}function Mee(r){let{element:e,boundary:t,rootBoundary:n,strategy:s}=r;const i=[...t==="clippingAncestors"?Sb(e)?[]:Tee(e,this._c):[].concat(t),n],a=i[0],l=i.reduce((c,u)=>{const p=VR(e,u,s);return c.top=ti(p.top,c.top),c.right=id(p.right,c.right),c.bottom=id(p.bottom,c.bottom),c.left=ti(p.left,c.left),c},VR(e,a,s));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function Aee(r){const{width:e,height:t}=j8(r);return{width:e,height:t}}function jee(r,e,t){const n=ul(e),s=yl(e),o=t==="fixed",i=pu(r,!0,o,e);let a={scrollLeft:0,scrollTop:0};const l=sl(0);if(n||!n&&!o)if((pp(e)!=="body"||Xg(s))&&(a=xb(e)),n){const f=pu(e,!0,o,e);l.x=f.x+e.clientLeft,l.y=f.y+e.clientTop}else s&&(l.x=J2(s));const c=s&&!n&&!o?D8(s,a):sl(0),u=i.left+a.scrollLeft-l.x-c.x,p=i.top+a.scrollTop-l.y-c.y;return{x:u,y:p,width:i.width,height:i.height}}function lC(r){return ma(r).position==="static"}function qR(r,e){if(!ul(r)||ma(r).position==="fixed")return null;if(e)return e(r);let t=r.offsetParent;return yl(r)===t&&(t=t.ownerDocument.body),t}function L8(r,e){const t=li(r);if(Sb(r))return t;if(!ul(r)){let s=ld(r);for(;s&&!Hh(s);){if(ga(s)&&!lC(s))return s;s=ld(s)}return t}let n=qR(r,e);for(;n&&See(n)&&lC(n);)n=qR(n,e);return n&&Hh(n)&&lC(n)&&!Y2(n)?t:n||xee(r)||t}const Ree=async function(r){const e=this.getOffsetParent||L8,t=this.getDimensions,n=await t(r.floating);return{reference:jee(r.reference,await e(r.floating),r.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function Dee(r){return ma(r).direction==="rtl"}const Oee={convertOffsetParentRelativeRectToViewportRelativeRect:Eee,getDocumentElement:yl,getClippingRect:Mee,getOffsetParent:L8,getElementRects:Ree,getClientRects:kee,getDimensions:Aee,getScale:Ih,isElement:ga,isRTL:Dee};function Lee(r,e){let t=null,n;const s=yl(r);function o(){var a;clearTimeout(n),(a=t)==null||a.disconnect(),t=null}function i(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),o();const{left:c,top:u,width:p,height:f}=r.getBoundingClientRect();if(a||e(),!p||!f)return;const m=Cy(u),v=Cy(s.clientWidth-(c+p)),b=Cy(s.clientHeight-(u+f)),S=Cy(c),E={rootMargin:-m+"px "+-v+"px "+-b+"px "+-S+"px",threshold:ti(0,id(1,l))||1};let T=!0;function w(M){const R=M[0].intersectionRatio;if(R!==l){if(!T)return i();R?i(!1,R):n=setTimeout(()=>{i(!1,1e-7)},1e3)}T=!1}try{t=new IntersectionObserver(w,{...E,root:s.ownerDocument})}catch{t=new IntersectionObserver(w,E)}t.observe(r)}return i(!0),o}function Nee(r,e,t,n){n===void 0&&(n={});const{ancestorScroll:s=!0,ancestorResize:o=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,c=Z2(r),u=s||o?[...c?Wf(c):[],...Wf(e)]:[];u.forEach(C=>{s&&C.addEventListener("scroll",t,{passive:!0}),o&&C.addEventListener("resize",t)});const p=c&&a?Lee(c,t):null;let f=-1,m=null;i&&(m=new ResizeObserver(C=>{let[E]=C;E&&E.target===c&&m&&(m.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var T;(T=m)==null||T.observe(e)})),t()}),c&&!l&&m.observe(c),m.observe(e));let v,b=l?pu(r):null;l&&S();function S(){const C=pu(r);b&&(C.x!==b.x||C.y!==b.y||C.width!==b.width||C.height!==b.height)&&t(),b=C,v=requestAnimationFrame(S)}return t(),()=>{var C;u.forEach(E=>{s&&E.removeEventListener("scroll",t),o&&E.removeEventListener("resize",t)}),p==null||p(),(C=m)==null||C.disconnect(),m=null,l&&cancelAnimationFrame(v)}}const Fee=mee,zee=yee,$ee=pee,Bee=bee,Uee=fee,YR=hee,Hee=vee,Gee=(r,e,t)=>{const n=new Map,s={platform:Oee,...t},o={...s.platform,_c:n};return uee(r,e,{...s,platform:o})};var tv=typeof document<"u"?I.useLayoutEffect:I.useEffect;function o0(r,e){if(r===e)return!0;if(typeof r!=typeof e)return!1;if(typeof r=="function"&&r.toString()===e.toString())return!0;let t,n,s;if(r&&e&&typeof r=="object"){if(Array.isArray(r)){if(t=r.length,t!==e.length)return!1;for(n=t;n--!==0;)if(!o0(r[n],e[n]))return!1;return!0}if(s=Object.keys(r),t=s.length,t!==Object.keys(e).length)return!1;for(n=t;n--!==0;)if(!{}.hasOwnProperty.call(e,s[n]))return!1;for(n=t;n--!==0;){const o=s[n];if(!(o==="_owner"&&r.$$typeof)&&!o0(r[o],e[o]))return!1}return!0}return r!==r&&e!==e}function N8(r){return typeof window>"u"?1:(r.ownerDocument.defaultView||window).devicePixelRatio||1}function XR(r,e){const t=N8(r);return Math.round(e*t)/t}function cC(r){const e=I.useRef(r);return tv(()=>{e.current=r}),e}function Wee(r){r===void 0&&(r={});const{placement:e="bottom",strategy:t="absolute",middleware:n=[],platform:s,elements:{reference:o,floating:i}={},transform:a=!0,whileElementsMounted:l,open:c}=r,[u,p]=I.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[f,m]=I.useState(n);o0(f,n)||m(n);const[v,b]=I.useState(null),[S,C]=I.useState(null),E=I.useCallback(J=>{J!==R.current&&(R.current=J,b(J))},[]),T=I.useCallback(J=>{J!==D.current&&(D.current=J,C(J))},[]),w=o||v,M=i||S,R=I.useRef(null),D=I.useRef(null),N=I.useRef(u),z=l!=null,L=cC(l),B=cC(s),K=cC(c),O=I.useCallback(()=>{if(!R.current||!D.current)return;const J={placement:e,strategy:t,middleware:f};B.current&&(J.platform=B.current),Gee(R.current,D.current,J).then(ne=>{const ae={...ne,isPositioned:K.current!==!1};U.current&&!o0(N.current,ae)&&(N.current=ae,lp.flushSync(()=>{p(ae)}))})},[f,e,t,B,K]);tv(()=>{c===!1&&N.current.isPositioned&&(N.current.isPositioned=!1,p(J=>({...J,isPositioned:!1})))},[c]);const U=I.useRef(!1);tv(()=>(U.current=!0,()=>{U.current=!1}),[]),tv(()=>{if(w&&(R.current=w),M&&(D.current=M),w&&M){if(L.current)return L.current(w,M,O);O()}},[w,M,O,L,z]);const X=I.useMemo(()=>({reference:R,floating:D,setReference:E,setFloating:T}),[E,T]),H=I.useMemo(()=>({reference:w,floating:M}),[w,M]),ee=I.useMemo(()=>{const J={position:t,left:0,top:0};if(!H.floating)return J;const ne=XR(H.floating,u.x),ae=XR(H.floating,u.y);return a?{...J,transform:"translate("+ne+"px, "+ae+"px)",...N8(H.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:ne,top:ae}},[t,a,H.floating,u.x,u.y]);return I.useMemo(()=>({...u,update:O,refs:X,elements:H,floatingStyles:ee}),[u,O,X,H,ee])}const Kee=r=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:r,fn(t){const{element:n,padding:s}=typeof r=="function"?r(t):r;return n&&e(n)?n.current!=null?YR({element:n.current,padding:s}).fn(t):{}:n?YR({element:n,padding:s}).fn(t):{}}}},Vee=(r,e)=>({...Fee(r),options:[r,e]}),qee=(r,e)=>({...zee(r),options:[r,e]}),Yee=(r,e)=>({...Hee(r),options:[r,e]}),Xee=(r,e)=>({...$ee(r),options:[r,e]}),Zee=(r,e)=>({...Bee(r),options:[r,e]}),Jee=(r,e)=>({...Uee(r),options:[r,e]}),Qee=(r,e)=>({...Kee(r),options:[r,e]});var ete="Arrow",F8=I.forwardRef((r,e)=>{const{children:t,width:n=10,height:s=5,...o}=r;return g.jsx(rn.svg,{...o,ref:e,width:n,height:s,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:r.asChild?t:g.jsx("polygon",{points:"0,0 30,0 15,10"})})});F8.displayName=ete;var tte=F8;function nte(r,e=[]){let t=[];function n(o,i){const a=I.createContext(i),l=t.length;t=[...t,i];function c(p){const{scope:f,children:m,...v}=p,b=(f==null?void 0:f[r][l])||a,S=I.useMemo(()=>v,Object.values(v));return g.jsx(b.Provider,{value:S,children:m})}function u(p,f){const m=(f==null?void 0:f[r][l])||a,v=I.useContext(m);if(v)return v;if(i!==void 0)return i;throw new Error(`\`${p}\` must be used within \`${o}\``)}return c.displayName=o+"Provider",[c,u]}const s=()=>{const o=t.map(i=>I.createContext(i));return function(a){const l=(a==null?void 0:a[r])||o;return I.useMemo(()=>({[`__scope${r}`]:{...a,[r]:l}}),[a,l])}};return s.scopeName=r,[n,rte(s,...e)]}function rte(...r){const e=r[0];if(r.length===1)return e;const t=()=>{const n=r.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(o){const i=n.reduce((a,{useScope:l,scopeName:c})=>{const p=l(o)[`__scope${c}`];return{...a,...p}},{});return I.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return t.scopeName=e.scopeName,t}function z8(r){const[e,t]=I.useState(void 0);return od(()=>{if(r){t({width:r.offsetWidth,height:r.offsetHeight});const n=new ResizeObserver(s=>{if(!Array.isArray(s)||!s.length)return;const o=s[0];let i,a;if("borderBoxSize"in o){const l=o.borderBoxSize,c=Array.isArray(l)?l[0]:l;i=c.inlineSize,a=c.blockSize}else i=r.offsetWidth,a=r.offsetHeight;t({width:i,height:a})});return n.observe(r,{box:"border-box"}),()=>n.unobserve(r)}else t(void 0)},[r]),e}var Q2="Popper",[$8,wb]=nte(Q2),[ste,B8]=$8(Q2),U8=r=>{const{__scopePopper:e,children:t}=r,[n,s]=I.useState(null);return g.jsx(ste,{scope:e,anchor:n,onAnchorChange:s,children:t})};U8.displayName=Q2;var H8="PopperAnchor",G8=I.forwardRef((r,e)=>{const{__scopePopper:t,virtualRef:n,...s}=r,o=B8(H8,t),i=I.useRef(null),a=Un(e,i);return I.useEffect(()=>{o.onAnchorChange((n==null?void 0:n.current)||i.current)}),n?null:g.jsx(rn.div,{...s,ref:a})});G8.displayName=H8;var eP="PopperContent",[ote,ite]=$8(eP),W8=I.forwardRef((r,e)=>{var Be,Te,Le,Xe,pt,gn;const{__scopePopper:t,side:n="bottom",sideOffset:s=0,align:o="center",alignOffset:i=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:p="partial",hideWhenDetached:f=!1,updatePositionStrategy:m="optimized",onPlaced:v,...b}=r,S=B8(eP,t),[C,E]=I.useState(null),T=Un(e,Dt=>E(Dt)),[w,M]=I.useState(null),R=z8(w),D=(R==null?void 0:R.width)??0,N=(R==null?void 0:R.height)??0,z=n+(o!=="center"?"-"+o:""),L=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},B=Array.isArray(c)?c:[c],K=B.length>0,O={padding:L,boundary:B.filter(lte),altBoundary:K},{refs:U,floatingStyles:X,placement:H,isPositioned:ee,middlewareData:J}=Wee({strategy:"fixed",placement:z,whileElementsMounted:(...Dt)=>Nee(...Dt,{animationFrame:m==="always"}),elements:{reference:S.anchor},middleware:[Vee({mainAxis:s+N,alignmentAxis:i}),l&&qee({mainAxis:!0,crossAxis:!1,limiter:p==="partial"?Yee():void 0,...O}),l&&Xee({...O}),Zee({...O,apply:({elements:Dt,rects:sn,availableWidth:Kt,availableHeight:Nt})=>{const{width:vr,height:br}=sn.reference,Qn=Dt.floating.style;Qn.setProperty("--radix-popper-available-width",`${Kt}px`),Qn.setProperty("--radix-popper-available-height",`${Nt}px`),Qn.setProperty("--radix-popper-anchor-width",`${vr}px`),Qn.setProperty("--radix-popper-anchor-height",`${br}px`)}}),w&&Qee({element:w,padding:a}),cte({arrowWidth:D,arrowHeight:N}),f&&Jee({strategy:"referenceHidden",...O})]}),[ne,ae]=q8(H),q=bs(v);od(()=>{ee&&(q==null||q())},[ee,q]);const se=(Be=J.arrow)==null?void 0:Be.x,xe=(Te=J.arrow)==null?void 0:Te.y,Oe=((Le=J.arrow)==null?void 0:Le.centerOffset)!==0,[Ee,Ue]=I.useState();return od(()=>{C&&Ue(window.getComputedStyle(C).zIndex)},[C]),g.jsx("div",{ref:U.setFloating,"data-radix-popper-content-wrapper":"",style:{...X,transform:ee?X.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Ee,"--radix-popper-transform-origin":[(Xe=J.transformOrigin)==null?void 0:Xe.x,(pt=J.transformOrigin)==null?void 0:pt.y].join(" "),...((gn=J.hide)==null?void 0:gn.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:r.dir,children:g.jsx(ote,{scope:t,placedSide:ne,onArrowChange:M,arrowX:se,arrowY:xe,shouldHideArrow:Oe,children:g.jsx(rn.div,{"data-side":ne,"data-align":ae,...b,ref:T,style:{...b.style,animation:ee?void 0:"none"}})})})});W8.displayName=eP;var K8="PopperArrow",ate={top:"bottom",right:"left",bottom:"top",left:"right"},V8=I.forwardRef(function(e,t){const{__scopePopper:n,...s}=e,o=ite(K8,n),i=ate[o.placedSide];return g.jsx("span",{ref:o.onArrowChange,style:{position:"absolute",left:o.arrowX,top:o.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[o.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[o.placedSide],visibility:o.shouldHideArrow?"hidden":void 0},children:g.jsx(tte,{...s,ref:t,style:{...s.style,display:"block"}})})});V8.displayName=K8;function lte(r){return r!==null}var cte=r=>({name:"transformOrigin",options:r,fn(e){var S,C,E;const{placement:t,rects:n,middlewareData:s}=e,i=((S=s.arrow)==null?void 0:S.centerOffset)!==0,a=i?0:r.arrowWidth,l=i?0:r.arrowHeight,[c,u]=q8(t),p={start:"0%",center:"50%",end:"100%"}[u],f=(((C=s.arrow)==null?void 0:C.x)??0)+a/2,m=(((E=s.arrow)==null?void 0:E.y)??0)+l/2;let v="",b="";return c==="bottom"?(v=i?p:`${f}px`,b=`${-l}px`):c==="top"?(v=i?p:`${f}px`,b=`${n.floating.height+l}px`):c==="right"?(v=`${-l}px`,b=i?p:`${m}px`):c==="left"&&(v=`${n.floating.width+l}px`,b=i?p:`${m}px`),{data:{x:v,y:b}}}});function q8(r){const[e,t="center"]=r.split("-");return[e,t]}var tP=U8,nP=G8,Y8=W8,X8=V8,dte="Portal",Zg=I.forwardRef((r,e)=>{var a;const{container:t,...n}=r,[s,o]=I.useState(!1);od(()=>o(!0),[]);const i=t||s&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return i?oX.createPortal(g.jsx(rn.div,{...n,ref:e}),i):null});Zg.displayName=dte;function ute(r,e){return I.useReducer((t,n)=>e[t][n]??t,r)}var ba=r=>{const{present:e,children:t}=r,n=hte(e),s=typeof t=="function"?t({present:n.isPresent}):I.Children.only(t),o=Un(n.ref,pte(s));return typeof t=="function"||n.isPresent?I.cloneElement(s,{ref:o}):null};ba.displayName="Presence";function hte(r){const[e,t]=I.useState(),n=I.useRef({}),s=I.useRef(r),o=I.useRef("none"),i=r?"mounted":"unmounted",[a,l]=ute(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return I.useEffect(()=>{const c=Ey(n.current);o.current=a==="mounted"?c:"none"},[a]),od(()=>{const c=n.current,u=s.current;if(u!==r){const f=o.current,m=Ey(c);r?l("MOUNT"):m==="none"||(c==null?void 0:c.display)==="none"?l("UNMOUNT"):l(u&&f!==m?"ANIMATION_OUT":"UNMOUNT"),s.current=r}},[r,l]),od(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,p=m=>{const b=Ey(n.current).includes(m.animationName);if(m.target===e&&b&&(l("ANIMATION_END"),!s.current)){const S=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=S)})}},f=m=>{m.target===e&&(o.current=Ey(n.current))};return e.addEventListener("animationstart",f),e.addEventListener("animationcancel",p),e.addEventListener("animationend",p),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",f),e.removeEventListener("animationcancel",p),e.removeEventListener("animationend",p)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:I.useCallback(c=>{c&&(n.current=getComputedStyle(c)),t(c)},[])}}function Ey(r){return(r==null?void 0:r.animationName)||"none"}function pte(r){var n,s;let e=(n=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:n.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?r.ref:(e=(s=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?r.props.ref:r.props.ref||r.ref)}function fte(r,e=[]){let t=[];function n(o,i){const a=I.createContext(i),l=t.length;t=[...t,i];function c(p){const{scope:f,children:m,...v}=p,b=(f==null?void 0:f[r][l])||a,S=I.useMemo(()=>v,Object.values(v));return g.jsx(b.Provider,{value:S,children:m})}function u(p,f){const m=(f==null?void 0:f[r][l])||a,v=I.useContext(m);if(v)return v;if(i!==void 0)return i;throw new Error(`\`${p}\` must be used within \`${o}\``)}return c.displayName=o+"Provider",[c,u]}const s=()=>{const o=t.map(i=>I.createContext(i));return function(a){const l=(a==null?void 0:a[r])||o;return I.useMemo(()=>({[`__scope${r}`]:{...a,[r]:l}}),[a,l])}};return s.scopeName=r,[n,gte(s,...e)]}function gte(...r){const e=r[0];if(r.length===1)return e;const t=()=>{const n=r.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(o){const i=n.reduce((a,{useScope:l,scopeName:c})=>{const p=l(o)[`__scope${c}`];return{...a,...p}},{});return I.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return t.scopeName=e.scopeName,t}function yd({prop:r,defaultProp:e,onChange:t=()=>{}}){const[n,s]=mte({defaultProp:e,onChange:t}),o=r!==void 0,i=o?r:n,a=bs(t),l=I.useCallback(c=>{if(o){const p=typeof c=="function"?c(r):c;p!==r&&a(p)}else s(c)},[o,r,s,a]);return[i,l]}function mte({defaultProp:r,onChange:e}){const t=I.useState(r),[n]=t,s=I.useRef(n),o=bs(e);return I.useEffect(()=>{s.current!==n&&(o(n),s.current=n)},[n,s,o]),t}var dC="rovingFocusGroup.onEntryFocus",yte={bubbles:!1,cancelable:!0},Cb="RovingFocusGroup",[FE,Z8,vte]=yb(Cb),[bte,J8]=fte(Cb,[vte]),[Ste,xte]=bte(Cb),Q8=I.forwardRef((r,e)=>g.jsx(FE.Provider,{scope:r.__scopeRovingFocusGroup,children:g.jsx(FE.Slot,{scope:r.__scopeRovingFocusGroup,children:g.jsx(wte,{...r,ref:e})})}));Q8.displayName=Cb;var wte=I.forwardRef((r,e)=>{const{__scopeRovingFocusGroup:t,orientation:n,loop:s=!1,dir:o,currentTabStopId:i,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:c,preventScrollOnEntryFocus:u=!1,...p}=r,f=I.useRef(null),m=Un(e,f),v=G2(o),[b=null,S]=yd({prop:i,defaultProp:a,onChange:l}),[C,E]=I.useState(!1),T=bs(c),w=Z8(t),M=I.useRef(!1),[R,D]=I.useState(0);return I.useEffect(()=>{const N=f.current;if(N)return N.addEventListener(dC,T),()=>N.removeEventListener(dC,T)},[T]),g.jsx(Ste,{scope:t,orientation:n,dir:v,loop:s,currentTabStopId:b,onItemFocus:I.useCallback(N=>S(N),[S]),onItemShiftTab:I.useCallback(()=>E(!0),[]),onFocusableItemAdd:I.useCallback(()=>D(N=>N+1),[]),onFocusableItemRemove:I.useCallback(()=>D(N=>N-1),[]),children:g.jsx(rn.div,{tabIndex:C||R===0?-1:0,"data-orientation":n,...p,ref:m,style:{outline:"none",...r.style},onMouseDown:Qe(r.onMouseDown,()=>{M.current=!0}),onFocus:Qe(r.onFocus,N=>{const z=!M.current;if(N.target===N.currentTarget&&z&&!C){const L=new CustomEvent(dC,yte);if(N.currentTarget.dispatchEvent(L),!L.defaultPrevented){const B=w().filter(H=>H.focusable),K=B.find(H=>H.active),O=B.find(H=>H.id===b),X=[K,O,...B].filter(Boolean).map(H=>H.ref.current);nN(X,u)}}M.current=!1}),onBlur:Qe(r.onBlur,()=>E(!1))})})}),eN="RovingFocusGroupItem",tN=I.forwardRef((r,e)=>{const{__scopeRovingFocusGroup:t,focusable:n=!0,active:s=!1,tabStopId:o,...i}=r,a=Vl(),l=o||a,c=xte(eN,t),u=c.currentTabStopId===l,p=Z8(t),{onFocusableItemAdd:f,onFocusableItemRemove:m}=c;return I.useEffect(()=>{if(n)return f(),()=>m()},[n,f,m]),g.jsx(FE.ItemSlot,{scope:t,id:l,focusable:n,active:s,children:g.jsx(rn.span,{tabIndex:u?0:-1,"data-orientation":c.orientation,...i,ref:e,onMouseDown:Qe(r.onMouseDown,v=>{n?c.onItemFocus(l):v.preventDefault()}),onFocus:Qe(r.onFocus,()=>c.onItemFocus(l)),onKeyDown:Qe(r.onKeyDown,v=>{if(v.key==="Tab"&&v.shiftKey){c.onItemShiftTab();return}if(v.target!==v.currentTarget)return;const b=kte(v,c.orientation,c.dir);if(b!==void 0){if(v.metaKey||v.ctrlKey||v.altKey||v.shiftKey)return;v.preventDefault();let C=p().filter(E=>E.focusable).map(E=>E.ref.current);if(b==="last")C.reverse();else if(b==="prev"||b==="next"){b==="prev"&&C.reverse();const E=C.indexOf(v.currentTarget);C=c.loop?Pte(C,E+1):C.slice(E+1)}setTimeout(()=>nN(C))}})})})});tN.displayName=eN;var Cte={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Ete(r,e){return e!=="rtl"?r:r==="ArrowLeft"?"ArrowRight":r==="ArrowRight"?"ArrowLeft":r}function kte(r,e,t){const n=Ete(r.key,t);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return Cte[n]}function nN(r,e=!1){const t=document.activeElement;for(const n of r)if(n===t||(n.focus({preventScroll:e}),document.activeElement!==t))return}function Pte(r,e){return r.map((t,n)=>r[(e+n)%r.length])}var Ite=Q8,_te=tN,Tte=function(r){if(typeof document>"u")return null;var e=Array.isArray(r)?r[0]:r;return e.ownerDocument.body},oh=new WeakMap,ky=new WeakMap,Py={},uC=0,rN=function(r){return r&&(r.host||rN(r.parentNode))},Mte=function(r,e){return e.map(function(t){if(r.contains(t))return t;var n=rN(t);return n&&r.contains(n)?n:(console.error("aria-hidden",t,"in not contained inside",r,". Doing nothing"),null)}).filter(function(t){return!!t})},Ate=function(r,e,t,n){var s=Mte(e,Array.isArray(r)?r:[r]);Py[t]||(Py[t]=new WeakMap);var o=Py[t],i=[],a=new Set,l=new Set(s),c=function(p){!p||a.has(p)||(a.add(p),c(p.parentNode))};s.forEach(c);var u=function(p){!p||l.has(p)||Array.prototype.forEach.call(p.children,function(f){if(a.has(f))u(f);else try{var m=f.getAttribute(n),v=m!==null&&m!=="false",b=(oh.get(f)||0)+1,S=(o.get(f)||0)+1;oh.set(f,b),o.set(f,S),i.push(f),b===1&&v&&ky.set(f,!0),S===1&&f.setAttribute(t,"true"),v||f.setAttribute(n,"true")}catch(C){console.error("aria-hidden: cannot operate on ",f,C)}})};return u(e),a.clear(),uC++,function(){i.forEach(function(p){var f=oh.get(p)-1,m=o.get(p)-1;oh.set(p,f),o.set(p,m),f||(ky.has(p)||p.removeAttribute(n),ky.delete(p)),m||p.removeAttribute(t)}),uC--,uC||(oh=new WeakMap,oh=new WeakMap,ky=new WeakMap,Py={})}},rP=function(r,e,t){t===void 0&&(t="data-aria-hidden");var n=Array.from(Array.isArray(r)?r:[r]),s=Tte(r);return s?(n.push.apply(n,Array.from(s.querySelectorAll("[aria-live]"))),Ate(n,s,t,"aria-hidden")):function(){return null}},Ya=function(){return Ya=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},Ya.apply(this,arguments)};function sN(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(t[n[s]]=r[n[s]]);return t}function jte(r,e,t){if(t||arguments.length===2)for(var n=0,s=e.length,o;n<s;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))}var nv="right-scroll-bar-position",rv="width-before-scroll-bar",Rte="with-scroll-bars-hidden",Dte="--removed-body-scroll-bar-size";function hC(r,e){return typeof r=="function"?r(e):r&&(r.current=e),r}function Ote(r,e){var t=I.useState(function(){return{value:r,callback:e,facade:{get current(){return t.value},set current(n){var s=t.value;s!==n&&(t.value=n,t.callback(n,s))}}}})[0];return t.callback=e,t.facade}var Lte=typeof window<"u"?I.useLayoutEffect:I.useEffect,ZR=new WeakMap;function Nte(r,e){var t=Ote(null,function(n){return r.forEach(function(s){return hC(s,n)})});return Lte(function(){var n=ZR.get(t);if(n){var s=new Set(n),o=new Set(r),i=t.current;s.forEach(function(a){o.has(a)||hC(a,null)}),o.forEach(function(a){s.has(a)||hC(a,i)})}ZR.set(t,r)},[r]),t}function Fte(r){return r}function zte(r,e){e===void 0&&(e=Fte);var t=[],n=!1,s={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:r},useMedium:function(o){var i=e(o,n);return t.push(i),function(){t=t.filter(function(a){return a!==i})}},assignSyncMedium:function(o){for(n=!0;t.length;){var i=t;t=[],i.forEach(o)}t={push:function(a){return o(a)},filter:function(){return t}}},assignMedium:function(o){n=!0;var i=[];if(t.length){var a=t;t=[],a.forEach(o),i=t}var l=function(){var u=i;i=[],u.forEach(o)},c=function(){return Promise.resolve().then(l)};c(),t={push:function(u){i.push(u),c()},filter:function(u){return i=i.filter(u),t}}}};return s}function $te(r){r===void 0&&(r={});var e=zte(null);return e.options=Ya({async:!0,ssr:!1},r),e}var oN=function(r){var e=r.sideCar,t=sN(r,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=e.read();if(!n)throw new Error("Sidecar medium not found");return I.createElement(n,Ya({},t))};oN.isSideCarExport=!0;function Bte(r,e){return r.useMedium(e),oN}var iN=$te(),pC=function(){},Eb=I.forwardRef(function(r,e){var t=I.useRef(null),n=I.useState({onScrollCapture:pC,onWheelCapture:pC,onTouchMoveCapture:pC}),s=n[0],o=n[1],i=r.forwardProps,a=r.children,l=r.className,c=r.removeScrollBar,u=r.enabled,p=r.shards,f=r.sideCar,m=r.noIsolation,v=r.inert,b=r.allowPinchZoom,S=r.as,C=S===void 0?"div":S,E=r.gapMode,T=sN(r,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),w=f,M=Nte([t,e]),R=Ya(Ya({},T),s);return I.createElement(I.Fragment,null,u&&I.createElement(w,{sideCar:iN,removeScrollBar:c,shards:p,noIsolation:m,inert:v,setCallbacks:o,allowPinchZoom:!!b,lockRef:t,gapMode:E}),i?I.cloneElement(I.Children.only(a),Ya(Ya({},R),{ref:M})):I.createElement(C,Ya({},R,{className:l,ref:M}),a))});Eb.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Eb.classNames={fullWidth:rv,zeroRight:nv};var Ute=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Hte(){if(!document)return null;var r=document.createElement("style");r.type="text/css";var e=Ute();return e&&r.setAttribute("nonce",e),r}function Gte(r,e){r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}function Wte(r){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(r)}var Kte=function(){var r=0,e=null;return{add:function(t){r==0&&(e=Hte())&&(Gte(e,t),Wte(e)),r++},remove:function(){r--,!r&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},Vte=function(){var r=Kte();return function(e,t){I.useEffect(function(){return r.add(e),function(){r.remove()}},[e&&t])}},aN=function(){var r=Vte(),e=function(t){var n=t.styles,s=t.dynamic;return r(n,s),null};return e},qte={left:0,top:0,right:0,gap:0},fC=function(r){return parseInt(r||"",10)||0},Yte=function(r){var e=window.getComputedStyle(document.body),t=e[r==="padding"?"paddingLeft":"marginLeft"],n=e[r==="padding"?"paddingTop":"marginTop"],s=e[r==="padding"?"paddingRight":"marginRight"];return[fC(t),fC(n),fC(s)]},Xte=function(r){if(r===void 0&&(r="margin"),typeof window>"u")return qte;var e=Yte(r),t=document.documentElement.clientWidth,n=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,n-t+e[2]-e[0])}},Zte=aN(),_h="data-scroll-locked",Jte=function(r,e,t,n){var s=r.left,o=r.top,i=r.right,a=r.gap;return t===void 0&&(t="margin"),`
  .`.concat(Rte,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(a,"px ").concat(n,`;
  }
  body[`).concat(_h,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(n,";"),t==="margin"&&`
    padding-left: `.concat(s,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(n,`;
    `),t==="padding"&&"padding-right: ".concat(a,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(nv,` {
    right: `).concat(a,"px ").concat(n,`;
  }
  
  .`).concat(rv,` {
    margin-right: `).concat(a,"px ").concat(n,`;
  }
  
  .`).concat(nv," .").concat(nv,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(rv," .").concat(rv,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(_h,`] {
    `).concat(Dte,": ").concat(a,`px;
  }
`)},JR=function(){var r=parseInt(document.body.getAttribute(_h)||"0",10);return isFinite(r)?r:0},Qte=function(){I.useEffect(function(){return document.body.setAttribute(_h,(JR()+1).toString()),function(){var r=JR()-1;r<=0?document.body.removeAttribute(_h):document.body.setAttribute(_h,r.toString())}},[])},ene=function(r){var e=r.noRelative,t=r.noImportant,n=r.gapMode,s=n===void 0?"margin":n;Qte();var o=I.useMemo(function(){return Xte(s)},[s]);return I.createElement(Zte,{styles:Jte(o,!e,s,t?"":"!important")})},zE=!1;if(typeof window<"u")try{var Iy=Object.defineProperty({},"passive",{get:function(){return zE=!0,!0}});window.addEventListener("test",Iy,Iy),window.removeEventListener("test",Iy,Iy)}catch{zE=!1}var ih=zE?{passive:!1}:!1,tne=function(r){return r.tagName==="TEXTAREA"},lN=function(r,e){if(!(r instanceof Element))return!1;var t=window.getComputedStyle(r);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!tne(r)&&t[e]==="visible")},nne=function(r){return lN(r,"overflowY")},rne=function(r){return lN(r,"overflowX")},QR=function(r,e){var t=e.ownerDocument,n=e;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var s=cN(r,n);if(s){var o=dN(r,n),i=o[1],a=o[2];if(i>a)return!0}n=n.parentNode}while(n&&n!==t.body);return!1},sne=function(r){var e=r.scrollTop,t=r.scrollHeight,n=r.clientHeight;return[e,t,n]},one=function(r){var e=r.scrollLeft,t=r.scrollWidth,n=r.clientWidth;return[e,t,n]},cN=function(r,e){return r==="v"?nne(e):rne(e)},dN=function(r,e){return r==="v"?sne(e):one(e)},ine=function(r,e){return r==="h"&&e==="rtl"?-1:1},ane=function(r,e,t,n,s){var o=ine(r,window.getComputedStyle(e).direction),i=o*n,a=t.target,l=e.contains(a),c=!1,u=i>0,p=0,f=0;do{var m=dN(r,a),v=m[0],b=m[1],S=m[2],C=b-S-o*v;(v||C)&&cN(r,a)&&(p+=C,f+=v),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(u&&(Math.abs(p)<1||!s)||!u&&(Math.abs(f)<1||!s))&&(c=!0),c},_y=function(r){return"changedTouches"in r?[r.changedTouches[0].clientX,r.changedTouches[0].clientY]:[0,0]},eD=function(r){return[r.deltaX,r.deltaY]},tD=function(r){return r&&"current"in r?r.current:r},lne=function(r,e){return r[0]===e[0]&&r[1]===e[1]},cne=function(r){return`
  .block-interactivity-`.concat(r,` {pointer-events: none;}
  .allow-interactivity-`).concat(r,` {pointer-events: all;}
`)},dne=0,ah=[];function une(r){var e=I.useRef([]),t=I.useRef([0,0]),n=I.useRef(),s=I.useState(dne++)[0],o=I.useState(aN)[0],i=I.useRef(r);I.useEffect(function(){i.current=r},[r]),I.useEffect(function(){if(r.inert){document.body.classList.add("block-interactivity-".concat(s));var b=jte([r.lockRef.current],(r.shards||[]).map(tD),!0).filter(Boolean);return b.forEach(function(S){return S.classList.add("allow-interactivity-".concat(s))}),function(){document.body.classList.remove("block-interactivity-".concat(s)),b.forEach(function(S){return S.classList.remove("allow-interactivity-".concat(s))})}}},[r.inert,r.lockRef.current,r.shards]);var a=I.useCallback(function(b,S){if("touches"in b&&b.touches.length===2||b.type==="wheel"&&b.ctrlKey)return!i.current.allowPinchZoom;var C=_y(b),E=t.current,T="deltaX"in b?b.deltaX:E[0]-C[0],w="deltaY"in b?b.deltaY:E[1]-C[1],M,R=b.target,D=Math.abs(T)>Math.abs(w)?"h":"v";if("touches"in b&&D==="h"&&R.type==="range")return!1;var N=QR(D,R);if(!N)return!0;if(N?M=D:(M=D==="v"?"h":"v",N=QR(D,R)),!N)return!1;if(!n.current&&"changedTouches"in b&&(T||w)&&(n.current=M),!M)return!0;var z=n.current||M;return ane(z,S,b,z==="h"?T:w,!0)},[]),l=I.useCallback(function(b){var S=b;if(!(!ah.length||ah[ah.length-1]!==o)){var C="deltaY"in S?eD(S):_y(S),E=e.current.filter(function(M){return M.name===S.type&&(M.target===S.target||S.target===M.shadowParent)&&lne(M.delta,C)})[0];if(E&&E.should){S.cancelable&&S.preventDefault();return}if(!E){var T=(i.current.shards||[]).map(tD).filter(Boolean).filter(function(M){return M.contains(S.target)}),w=T.length>0?a(S,T[0]):!i.current.noIsolation;w&&S.cancelable&&S.preventDefault()}}},[]),c=I.useCallback(function(b,S,C,E){var T={name:b,delta:S,target:C,should:E,shadowParent:hne(C)};e.current.push(T),setTimeout(function(){e.current=e.current.filter(function(w){return w!==T})},1)},[]),u=I.useCallback(function(b){t.current=_y(b),n.current=void 0},[]),p=I.useCallback(function(b){c(b.type,eD(b),b.target,a(b,r.lockRef.current))},[]),f=I.useCallback(function(b){c(b.type,_y(b),b.target,a(b,r.lockRef.current))},[]);I.useEffect(function(){return ah.push(o),r.setCallbacks({onScrollCapture:p,onWheelCapture:p,onTouchMoveCapture:f}),document.addEventListener("wheel",l,ih),document.addEventListener("touchmove",l,ih),document.addEventListener("touchstart",u,ih),function(){ah=ah.filter(function(b){return b!==o}),document.removeEventListener("wheel",l,ih),document.removeEventListener("touchmove",l,ih),document.removeEventListener("touchstart",u,ih)}},[]);var m=r.removeScrollBar,v=r.inert;return I.createElement(I.Fragment,null,v?I.createElement(o,{styles:cne(s)}):null,m?I.createElement(ene,{gapMode:r.gapMode}):null)}function hne(r){for(var e=null;r!==null;)r instanceof ShadowRoot&&(e=r.host,r=r.host),r=r.parentNode;return e}const pne=Bte(iN,une);var kb=I.forwardRef(function(r,e){return I.createElement(Eb,Ya({},r,{ref:e,sideCar:pne}))});kb.classNames=Eb.classNames;var $E=["Enter"," "],fne=["ArrowDown","PageUp","Home"],uN=["ArrowUp","PageDown","End"],gne=[...fne,...uN],mne={ltr:[...$E,"ArrowRight"],rtl:[...$E,"ArrowLeft"]},yne={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Jg="Menu",[Kf,vne,bne]=yb(Jg),[Pu,Pb]=ku(Jg,[bne,wb,J8]),Qg=wb(),hN=J8(),[pN,vd]=Pu(Jg),[Sne,em]=Pu(Jg),fN=r=>{const{__scopeMenu:e,open:t=!1,children:n,dir:s,onOpenChange:o,modal:i=!0}=r,a=Qg(e),[l,c]=I.useState(null),u=I.useRef(!1),p=bs(o),f=G2(s);return I.useEffect(()=>{const m=()=>{u.current=!0,document.addEventListener("pointerdown",v,{capture:!0,once:!0}),document.addEventListener("pointermove",v,{capture:!0,once:!0})},v=()=>u.current=!1;return document.addEventListener("keydown",m,{capture:!0}),()=>{document.removeEventListener("keydown",m,{capture:!0}),document.removeEventListener("pointerdown",v,{capture:!0}),document.removeEventListener("pointermove",v,{capture:!0})}},[]),g.jsx(tP,{...a,children:g.jsx(pN,{scope:e,open:t,onOpenChange:p,content:l,onContentChange:c,children:g.jsx(Sne,{scope:e,onClose:I.useCallback(()=>p(!1),[p]),isUsingKeyboardRef:u,dir:f,modal:i,children:n})})})};fN.displayName=Jg;var xne="MenuAnchor",sP=I.forwardRef((r,e)=>{const{__scopeMenu:t,...n}=r,s=Qg(t);return g.jsx(nP,{...s,...n,ref:e})});sP.displayName=xne;var oP="MenuPortal",[wne,gN]=Pu(oP,{forceMount:void 0}),mN=r=>{const{__scopeMenu:e,forceMount:t,children:n,container:s}=r,o=vd(oP,e);return g.jsx(wne,{scope:e,forceMount:t,children:g.jsx(ba,{present:t||o.open,children:g.jsx(Zg,{asChild:!0,container:s,children:n})})})};mN.displayName=oP;var Ni="MenuContent",[Cne,iP]=Pu(Ni),yN=I.forwardRef((r,e)=>{const t=gN(Ni,r.__scopeMenu),{forceMount:n=t.forceMount,...s}=r,o=vd(Ni,r.__scopeMenu),i=em(Ni,r.__scopeMenu);return g.jsx(Kf.Provider,{scope:r.__scopeMenu,children:g.jsx(ba,{present:n||o.open,children:g.jsx(Kf.Slot,{scope:r.__scopeMenu,children:i.modal?g.jsx(Ene,{...s,ref:e}):g.jsx(kne,{...s,ref:e})})})})}),Ene=I.forwardRef((r,e)=>{const t=vd(Ni,r.__scopeMenu),n=I.useRef(null),s=Un(e,n);return I.useEffect(()=>{const o=n.current;if(o)return rP(o)},[]),g.jsx(aP,{...r,ref:s,trapFocus:t.open,disableOutsidePointerEvents:t.open,disableOutsideScroll:!0,onFocusOutside:Qe(r.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>t.onOpenChange(!1)})}),kne=I.forwardRef((r,e)=>{const t=vd(Ni,r.__scopeMenu);return g.jsx(aP,{...r,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>t.onOpenChange(!1)})}),aP=I.forwardRef((r,e)=>{const{__scopeMenu:t,loop:n=!1,trapFocus:s,onOpenAutoFocus:o,onCloseAutoFocus:i,disableOutsidePointerEvents:a,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:p,onInteractOutside:f,onDismiss:m,disableOutsideScroll:v,...b}=r,S=vd(Ni,t),C=em(Ni,t),E=Qg(t),T=hN(t),w=vne(t),[M,R]=I.useState(null),D=I.useRef(null),N=Un(e,D,S.onContentChange),z=I.useRef(0),L=I.useRef(""),B=I.useRef(0),K=I.useRef(null),O=I.useRef("right"),U=I.useRef(0),X=v?kb:I.Fragment,H=v?{as:hu,allowPinchZoom:!0}:void 0,ee=ne=>{var Be,Te;const ae=L.current+ne,q=w().filter(Le=>!Le.disabled),se=document.activeElement,xe=(Be=q.find(Le=>Le.ref.current===se))==null?void 0:Be.textValue,Oe=q.map(Le=>Le.textValue),Ee=Nne(Oe,ae,xe),Ue=(Te=q.find(Le=>Le.textValue===Ee))==null?void 0:Te.ref.current;(function Le(Xe){L.current=Xe,window.clearTimeout(z.current),Xe!==""&&(z.current=window.setTimeout(()=>Le(""),1e3))})(ae),Ue&&setTimeout(()=>Ue.focus())};I.useEffect(()=>()=>window.clearTimeout(z.current),[]),W2();const J=I.useCallback(ne=>{var q,se;return O.current===((q=K.current)==null?void 0:q.side)&&zne(ne,(se=K.current)==null?void 0:se.area)},[]);return g.jsx(Cne,{scope:t,searchRef:L,onItemEnter:I.useCallback(ne=>{J(ne)&&ne.preventDefault()},[J]),onItemLeave:I.useCallback(ne=>{var ae;J(ne)||((ae=D.current)==null||ae.focus(),R(null))},[J]),onTriggerLeave:I.useCallback(ne=>{J(ne)&&ne.preventDefault()},[J]),pointerGraceTimerRef:B,onPointerGraceIntentChange:I.useCallback(ne=>{K.current=ne},[]),children:g.jsx(X,{...H,children:g.jsx(vb,{asChild:!0,trapped:s,onMountAutoFocus:Qe(o,ne=>{var ae;ne.preventDefault(),(ae=D.current)==null||ae.focus({preventScroll:!0})}),onUnmountAutoFocus:i,children:g.jsx(Yg,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:p,onInteractOutside:f,onDismiss:m,children:g.jsx(Ite,{asChild:!0,...T,dir:C.dir,orientation:"vertical",loop:n,currentTabStopId:M,onCurrentTabStopIdChange:R,onEntryFocus:Qe(l,ne=>{C.isUsingKeyboardRef.current||ne.preventDefault()}),preventScrollOnEntryFocus:!0,children:g.jsx(Y8,{role:"menu","aria-orientation":"vertical","data-state":DN(S.open),"data-radix-menu-content":"",dir:C.dir,...E,...b,ref:N,style:{outline:"none",...b.style},onKeyDown:Qe(b.onKeyDown,ne=>{const q=ne.target.closest("[data-radix-menu-content]")===ne.currentTarget,se=ne.ctrlKey||ne.altKey||ne.metaKey,xe=ne.key.length===1;q&&(ne.key==="Tab"&&ne.preventDefault(),!se&&xe&&ee(ne.key));const Oe=D.current;if(ne.target!==Oe||!gne.includes(ne.key))return;ne.preventDefault();const Ue=w().filter(Be=>!Be.disabled).map(Be=>Be.ref.current);uN.includes(ne.key)&&Ue.reverse(),One(Ue)}),onBlur:Qe(r.onBlur,ne=>{ne.currentTarget.contains(ne.target)||(window.clearTimeout(z.current),L.current="")}),onPointerMove:Qe(r.onPointerMove,Vf(ne=>{const ae=ne.target,q=U.current!==ne.clientX;if(ne.currentTarget.contains(ae)&&q){const se=ne.clientX>U.current?"right":"left";O.current=se,U.current=ne.clientX}}))})})})})})})});yN.displayName=Ni;var Pne="MenuGroup",lP=I.forwardRef((r,e)=>{const{__scopeMenu:t,...n}=r;return g.jsx(rn.div,{role:"group",...n,ref:e})});lP.displayName=Pne;var Ine="MenuLabel",vN=I.forwardRef((r,e)=>{const{__scopeMenu:t,...n}=r;return g.jsx(rn.div,{...n,ref:e})});vN.displayName=Ine;var i0="MenuItem",nD="menu.itemSelect",Ib=I.forwardRef((r,e)=>{const{disabled:t=!1,onSelect:n,...s}=r,o=I.useRef(null),i=em(i0,r.__scopeMenu),a=iP(i0,r.__scopeMenu),l=Un(e,o),c=I.useRef(!1),u=()=>{const p=o.current;if(!t&&p){const f=new CustomEvent(nD,{bubbles:!0,cancelable:!0});p.addEventListener(nD,m=>n==null?void 0:n(m),{once:!0}),H2(p,f),f.defaultPrevented?c.current=!1:i.onClose()}};return g.jsx(bN,{...s,ref:l,disabled:t,onClick:Qe(r.onClick,u),onPointerDown:p=>{var f;(f=r.onPointerDown)==null||f.call(r,p),c.current=!0},onPointerUp:Qe(r.onPointerUp,p=>{var f;c.current||(f=p.currentTarget)==null||f.click()}),onKeyDown:Qe(r.onKeyDown,p=>{const f=a.searchRef.current!=="";t||f&&p.key===" "||$E.includes(p.key)&&(p.currentTarget.click(),p.preventDefault())})})});Ib.displayName=i0;var bN=I.forwardRef((r,e)=>{const{__scopeMenu:t,disabled:n=!1,textValue:s,...o}=r,i=iP(i0,t),a=hN(t),l=I.useRef(null),c=Un(e,l),[u,p]=I.useState(!1),[f,m]=I.useState("");return I.useEffect(()=>{const v=l.current;v&&m((v.textContent??"").trim())},[o.children]),g.jsx(Kf.ItemSlot,{scope:t,disabled:n,textValue:s??f,children:g.jsx(_te,{asChild:!0,...a,focusable:!n,children:g.jsx(rn.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...o,ref:c,onPointerMove:Qe(r.onPointerMove,Vf(v=>{n?i.onItemLeave(v):(i.onItemEnter(v),v.defaultPrevented||v.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Qe(r.onPointerLeave,Vf(v=>i.onItemLeave(v))),onFocus:Qe(r.onFocus,()=>p(!0)),onBlur:Qe(r.onBlur,()=>p(!1))})})})}),_ne="MenuCheckboxItem",SN=I.forwardRef((r,e)=>{const{checked:t=!1,onCheckedChange:n,...s}=r;return g.jsx(kN,{scope:r.__scopeMenu,checked:t,children:g.jsx(Ib,{role:"menuitemcheckbox","aria-checked":a0(t)?"mixed":t,...s,ref:e,"data-state":uP(t),onSelect:Qe(s.onSelect,()=>n==null?void 0:n(a0(t)?!0:!t),{checkForDefaultPrevented:!1})})})});SN.displayName=_ne;var xN="MenuRadioGroup",[Tne,Mne]=Pu(xN,{value:void 0,onValueChange:()=>{}}),wN=I.forwardRef((r,e)=>{const{value:t,onValueChange:n,...s}=r,o=bs(n);return g.jsx(Tne,{scope:r.__scopeMenu,value:t,onValueChange:o,children:g.jsx(lP,{...s,ref:e})})});wN.displayName=xN;var CN="MenuRadioItem",EN=I.forwardRef((r,e)=>{const{value:t,...n}=r,s=Mne(CN,r.__scopeMenu),o=t===s.value;return g.jsx(kN,{scope:r.__scopeMenu,checked:o,children:g.jsx(Ib,{role:"menuitemradio","aria-checked":o,...n,ref:e,"data-state":uP(o),onSelect:Qe(n.onSelect,()=>{var i;return(i=s.onValueChange)==null?void 0:i.call(s,t)},{checkForDefaultPrevented:!1})})})});EN.displayName=CN;var cP="MenuItemIndicator",[kN,Ane]=Pu(cP,{checked:!1}),PN=I.forwardRef((r,e)=>{const{__scopeMenu:t,forceMount:n,...s}=r,o=Ane(cP,t);return g.jsx(ba,{present:n||a0(o.checked)||o.checked===!0,children:g.jsx(rn.span,{...s,ref:e,"data-state":uP(o.checked)})})});PN.displayName=cP;var jne="MenuSeparator",IN=I.forwardRef((r,e)=>{const{__scopeMenu:t,...n}=r;return g.jsx(rn.div,{role:"separator","aria-orientation":"horizontal",...n,ref:e})});IN.displayName=jne;var Rne="MenuArrow",_N=I.forwardRef((r,e)=>{const{__scopeMenu:t,...n}=r,s=Qg(t);return g.jsx(X8,{...s,...n,ref:e})});_N.displayName=Rne;var dP="MenuSub",[Dne,TN]=Pu(dP),MN=r=>{const{__scopeMenu:e,children:t,open:n=!1,onOpenChange:s}=r,o=vd(dP,e),i=Qg(e),[a,l]=I.useState(null),[c,u]=I.useState(null),p=bs(s);return I.useEffect(()=>(o.open===!1&&p(!1),()=>p(!1)),[o.open,p]),g.jsx(tP,{...i,children:g.jsx(pN,{scope:e,open:n,onOpenChange:p,content:c,onContentChange:u,children:g.jsx(Dne,{scope:e,contentId:Vl(),triggerId:Vl(),trigger:a,onTriggerChange:l,children:t})})})};MN.displayName=dP;var yf="MenuSubTrigger",AN=I.forwardRef((r,e)=>{const t=vd(yf,r.__scopeMenu),n=em(yf,r.__scopeMenu),s=TN(yf,r.__scopeMenu),o=iP(yf,r.__scopeMenu),i=I.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:l}=o,c={__scopeMenu:r.__scopeMenu},u=I.useCallback(()=>{i.current&&window.clearTimeout(i.current),i.current=null},[]);return I.useEffect(()=>u,[u]),I.useEffect(()=>{const p=a.current;return()=>{window.clearTimeout(p),l(null)}},[a,l]),g.jsx(sP,{asChild:!0,...c,children:g.jsx(bN,{id:s.triggerId,"aria-haspopup":"menu","aria-expanded":t.open,"aria-controls":s.contentId,"data-state":DN(t.open),...r,ref:mb(e,s.onTriggerChange),onClick:p=>{var f;(f=r.onClick)==null||f.call(r,p),!(r.disabled||p.defaultPrevented)&&(p.currentTarget.focus(),t.open||t.onOpenChange(!0))},onPointerMove:Qe(r.onPointerMove,Vf(p=>{o.onItemEnter(p),!p.defaultPrevented&&!r.disabled&&!t.open&&!i.current&&(o.onPointerGraceIntentChange(null),i.current=window.setTimeout(()=>{t.onOpenChange(!0),u()},100))})),onPointerLeave:Qe(r.onPointerLeave,Vf(p=>{var m,v;u();const f=(m=t.content)==null?void 0:m.getBoundingClientRect();if(f){const b=(v=t.content)==null?void 0:v.dataset.side,S=b==="right",C=S?-5:5,E=f[S?"left":"right"],T=f[S?"right":"left"];o.onPointerGraceIntentChange({area:[{x:p.clientX+C,y:p.clientY},{x:E,y:f.top},{x:T,y:f.top},{x:T,y:f.bottom},{x:E,y:f.bottom}],side:b}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(p),p.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:Qe(r.onKeyDown,p=>{var m;const f=o.searchRef.current!=="";r.disabled||f&&p.key===" "||mne[n.dir].includes(p.key)&&(t.onOpenChange(!0),(m=t.content)==null||m.focus(),p.preventDefault())})})})});AN.displayName=yf;var jN="MenuSubContent",RN=I.forwardRef((r,e)=>{const t=gN(Ni,r.__scopeMenu),{forceMount:n=t.forceMount,...s}=r,o=vd(Ni,r.__scopeMenu),i=em(Ni,r.__scopeMenu),a=TN(jN,r.__scopeMenu),l=I.useRef(null),c=Un(e,l);return g.jsx(Kf.Provider,{scope:r.__scopeMenu,children:g.jsx(ba,{present:n||o.open,children:g.jsx(Kf.Slot,{scope:r.__scopeMenu,children:g.jsx(aP,{id:a.contentId,"aria-labelledby":a.triggerId,...s,ref:c,align:"start",side:i.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{var p;i.isUsingKeyboardRef.current&&((p=l.current)==null||p.focus()),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:Qe(r.onFocusOutside,u=>{u.target!==a.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:Qe(r.onEscapeKeyDown,u=>{i.onClose(),u.preventDefault()}),onKeyDown:Qe(r.onKeyDown,u=>{var m;const p=u.currentTarget.contains(u.target),f=yne[i.dir].includes(u.key);p&&f&&(o.onOpenChange(!1),(m=a.trigger)==null||m.focus(),u.preventDefault())})})})})})});RN.displayName=jN;function DN(r){return r?"open":"closed"}function a0(r){return r==="indeterminate"}function uP(r){return a0(r)?"indeterminate":r?"checked":"unchecked"}function One(r){const e=document.activeElement;for(const t of r)if(t===e||(t.focus(),document.activeElement!==e))return}function Lne(r,e){return r.map((t,n)=>r[(e+n)%r.length])}function Nne(r,e,t){const s=e.length>1&&Array.from(e).every(c=>c===e[0])?e[0]:e,o=t?r.indexOf(t):-1;let i=Lne(r,Math.max(o,0));s.length===1&&(i=i.filter(c=>c!==t));const l=i.find(c=>c.toLowerCase().startsWith(s.toLowerCase()));return l!==t?l:void 0}function Fne(r,e){const{x:t,y:n}=r;let s=!1;for(let o=0,i=e.length-1;o<e.length;i=o++){const a=e[o].x,l=e[o].y,c=e[i].x,u=e[i].y;l>n!=u>n&&t<(c-a)*(n-l)/(u-l)+a&&(s=!s)}return s}function zne(r,e){if(!e)return!1;const t={x:r.clientX,y:r.clientY};return Fne(t,e)}function Vf(r){return e=>e.pointerType==="mouse"?r(e):void 0}var ON=fN,LN=sP,NN=mN,FN=yN,zN=lP,$N=vN,BN=Ib,UN=SN,HN=wN,GN=EN,WN=PN,KN=IN,VN=_N,qN=MN,YN=AN,XN=RN,hP="ContextMenu",[$ne,Dge]=ku(hP,[Pb]),Ys=Pb(),[Bne,ZN]=$ne(hP),JN=r=>{const{__scopeContextMenu:e,children:t,onOpenChange:n,dir:s,modal:o=!0}=r,[i,a]=I.useState(!1),l=Ys(e),c=bs(n),u=I.useCallback(p=>{a(p),c(p)},[c]);return g.jsx(Bne,{scope:e,open:i,onOpenChange:u,modal:o,children:g.jsx(ON,{...l,dir:s,open:i,onOpenChange:u,modal:o,children:t})})};JN.displayName=hP;var QN="ContextMenuTrigger",eF=I.forwardRef((r,e)=>{const{__scopeContextMenu:t,disabled:n=!1,...s}=r,o=ZN(QN,t),i=Ys(t),a=I.useRef({x:0,y:0}),l=I.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),c=I.useRef(0),u=I.useCallback(()=>window.clearTimeout(c.current),[]),p=f=>{a.current={x:f.clientX,y:f.clientY},o.onOpenChange(!0)};return I.useEffect(()=>u,[u]),I.useEffect(()=>void(n&&u()),[n,u]),g.jsxs(g.Fragment,{children:[g.jsx(LN,{...i,virtualRef:l}),g.jsx(rn.span,{"data-state":o.open?"open":"closed","data-disabled":n?"":void 0,...s,ref:e,style:{WebkitTouchCallout:"none",...r.style},onContextMenu:n?r.onContextMenu:Qe(r.onContextMenu,f=>{u(),p(f),f.preventDefault()}),onPointerDown:n?r.onPointerDown:Qe(r.onPointerDown,Ty(f=>{u(),c.current=window.setTimeout(()=>p(f),700)})),onPointerMove:n?r.onPointerMove:Qe(r.onPointerMove,Ty(u)),onPointerCancel:n?r.onPointerCancel:Qe(r.onPointerCancel,Ty(u)),onPointerUp:n?r.onPointerUp:Qe(r.onPointerUp,Ty(u))})]})});eF.displayName=QN;var Une="ContextMenuPortal",pP=r=>{const{__scopeContextMenu:e,...t}=r,n=Ys(e);return g.jsx(NN,{...n,...t})};pP.displayName=Une;var tF="ContextMenuContent",nF=I.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,s=ZN(tF,t),o=Ys(t),i=I.useRef(!1);return g.jsx(FN,{...o,...n,ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:a=>{var l;(l=r.onCloseAutoFocus)==null||l.call(r,a),!a.defaultPrevented&&i.current&&a.preventDefault(),i.current=!1},onInteractOutside:a=>{var l;(l=r.onInteractOutside)==null||l.call(r,a),!a.defaultPrevented&&!s.modal&&(i.current=!0)},style:{...r.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});nF.displayName=tF;var Hne="ContextMenuGroup",rF=I.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,s=Ys(t);return g.jsx(zN,{...s,...n,ref:e})});rF.displayName=Hne;var Gne="ContextMenuLabel",Wne=I.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,s=Ys(t);return g.jsx($N,{...s,...n,ref:e})});Wne.displayName=Gne;var Kne="ContextMenuItem",sF=I.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,s=Ys(t);return g.jsx(BN,{...s,...n,ref:e})});sF.displayName=Kne;var Vne="ContextMenuCheckboxItem",oF=I.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,s=Ys(t);return g.jsx(UN,{...s,...n,ref:e})});oF.displayName=Vne;var qne="ContextMenuRadioGroup",Yne=I.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,s=Ys(t);return g.jsx(HN,{...s,...n,ref:e})});Yne.displayName=qne;var Xne="ContextMenuRadioItem",Zne=I.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,s=Ys(t);return g.jsx(GN,{...s,...n,ref:e})});Zne.displayName=Xne;var Jne="ContextMenuItemIndicator",Qne=I.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,s=Ys(t);return g.jsx(WN,{...s,...n,ref:e})});Qne.displayName=Jne;var ere="ContextMenuSeparator",tre=I.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,s=Ys(t);return g.jsx(KN,{...s,...n,ref:e})});tre.displayName=ere;var nre="ContextMenuArrow",rre=I.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,s=Ys(t);return g.jsx(VN,{...s,...n,ref:e})});rre.displayName=nre;var sre="ContextMenuSub",iF=r=>{const{__scopeContextMenu:e,children:t,onOpenChange:n,open:s,defaultOpen:o}=r,i=Ys(e),[a,l]=yd({prop:s,defaultProp:o,onChange:n});return g.jsx(qN,{...i,open:a,onOpenChange:l,children:t})};iF.displayName=sre;var ore="ContextMenuSubTrigger",aF=I.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,s=Ys(t);return g.jsx(YN,{...s,...n,ref:e})});aF.displayName=ore;var ire="ContextMenuSubContent",lF=I.forwardRef((r,e)=>{const{__scopeContextMenu:t,...n}=r,s=Ys(t);return g.jsx(XN,{...s,...n,ref:e,style:{...r.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});lF.displayName=ire;function Ty(r){return e=>e.pointerType!=="mouse"?r(e):void 0}var are=JN,lre=eF,cre=pP,dre=nF,ure=oF,fP="DropdownMenu",[hre,Oge]=ku(fP,[Pb]),Xs=Pb(),[pre,cF]=hre(fP),dF=r=>{const{__scopeDropdownMenu:e,children:t,dir:n,open:s,defaultOpen:o,onOpenChange:i,modal:a=!0}=r,l=Xs(e),c=I.useRef(null),[u=!1,p]=yd({prop:s,defaultProp:o,onChange:i});return g.jsx(pre,{scope:e,triggerId:Vl(),triggerRef:c,contentId:Vl(),open:u,onOpenChange:p,onOpenToggle:I.useCallback(()=>p(f=>!f),[p]),modal:a,children:g.jsx(ON,{...l,open:u,onOpenChange:p,dir:n,modal:a,children:t})})};dF.displayName=fP;var uF="DropdownMenuTrigger",hF=I.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,disabled:n=!1,...s}=r,o=cF(uF,t),i=Xs(t);return g.jsx(LN,{asChild:!0,...i,children:g.jsx(rn.button,{type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...s,ref:mb(e,o.triggerRef),onPointerDown:Qe(r.onPointerDown,a=>{!n&&a.button===0&&a.ctrlKey===!1&&(o.onOpenToggle(),o.open||a.preventDefault())}),onKeyDown:Qe(r.onKeyDown,a=>{n||(["Enter"," "].includes(a.key)&&o.onOpenToggle(),a.key==="ArrowDown"&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});hF.displayName=uF;var fre="DropdownMenuPortal",pF=r=>{const{__scopeDropdownMenu:e,...t}=r,n=Xs(e);return g.jsx(NN,{...n,...t})};pF.displayName=fre;var fF="DropdownMenuContent",gF=I.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=cF(fF,t),o=Xs(t),i=I.useRef(!1);return g.jsx(FN,{id:s.contentId,"aria-labelledby":s.triggerId,...o,...n,ref:e,onCloseAutoFocus:Qe(r.onCloseAutoFocus,a=>{var l;i.current||(l=s.triggerRef.current)==null||l.focus(),i.current=!1,a.preventDefault()}),onInteractOutside:Qe(r.onInteractOutside,a=>{const l=a.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,u=l.button===2||c;(!s.modal||u)&&(i.current=!0)}),style:{...r.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});gF.displayName=fF;var gre="DropdownMenuGroup",mF=I.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=Xs(t);return g.jsx(zN,{...s,...n,ref:e})});mF.displayName=gre;var mre="DropdownMenuLabel",yre=I.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=Xs(t);return g.jsx($N,{...s,...n,ref:e})});yre.displayName=mre;var vre="DropdownMenuItem",yF=I.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=Xs(t);return g.jsx(BN,{...s,...n,ref:e})});yF.displayName=vre;var bre="DropdownMenuCheckboxItem",vF=I.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=Xs(t);return g.jsx(UN,{...s,...n,ref:e})});vF.displayName=bre;var Sre="DropdownMenuRadioGroup",xre=I.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=Xs(t);return g.jsx(HN,{...s,...n,ref:e})});xre.displayName=Sre;var wre="DropdownMenuRadioItem",Cre=I.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=Xs(t);return g.jsx(GN,{...s,...n,ref:e})});Cre.displayName=wre;var Ere="DropdownMenuItemIndicator",kre=I.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=Xs(t);return g.jsx(WN,{...s,...n,ref:e})});kre.displayName=Ere;var Pre="DropdownMenuSeparator",Ire=I.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=Xs(t);return g.jsx(KN,{...s,...n,ref:e})});Ire.displayName=Pre;var _re="DropdownMenuArrow",Tre=I.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=Xs(t);return g.jsx(VN,{...s,...n,ref:e})});Tre.displayName=_re;var Mre=r=>{const{__scopeDropdownMenu:e,children:t,open:n,onOpenChange:s,defaultOpen:o}=r,i=Xs(e),[a=!1,l]=yd({prop:n,defaultProp:o,onChange:s});return g.jsx(qN,{...i,open:a,onOpenChange:l,children:t})},Are="DropdownMenuSubTrigger",bF=I.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=Xs(t);return g.jsx(YN,{...s,...n,ref:e})});bF.displayName=Are;var jre="DropdownMenuSubContent",SF=I.forwardRef((r,e)=>{const{__scopeDropdownMenu:t,...n}=r,s=Xs(t);return g.jsx(XN,{...s,...n,ref:e,style:{...r.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});SF.displayName=jre;var gP=dF,mP=hF,_b=pF,yP=gF,Rre=mF,Dre=yF,Ore=vF,Lre=Mre,Nre=bF,Fre=SF;function zn(r,e){var s;const t=new Set;for(const o of e){const i=r.getShape(o);if(!i)continue;r.getShapeUtil(i).onDragShapesOut&&t.add(i);const a=r.getShape(i.parentId);a&&r.getShapeUtil(a).onDragShapesOut&&t.add(a)}const n=new Map;for(const o of t){const i=xF(r,o);i.length&&n.set(o,i)}for(const[o,i]of n){const a=r.getShapeUtil(o),l=kt(i.map(c=>r.getShape(c)));(s=a.onDragShapesOut)==null||s.call(a,o,l)}}function xF(r,e){const t=r.getSortedChildIdsForParent(e.id);if(t.length===0)return[];const n=r.getShapePageBounds(e);if(!n)return[];let s,o,i;const a=[];for(const l of t){const c=r.getShapePageBounds(l);if(!c)continue;if(!n.includes(c)){a.push(l);continue}s??(s=r.getShapeGeometry(e)),o??(o=r.getShapePageTransform(e)),i??(i=o.applyToPoints(s.vertices));const u=r.getShapePageTransform(l).clone().invert().applyToPoints(i),{vertices:p,isClosed:f}=r.getShapeGeometry(l);if(!p.some(m=>ai(m,u))){if(f){if(A2(u,p))continue}else if(rX(u,p))continue;a.push(l)}}return a}function l0(r,e,t=!1){r.select(e),r.setEditingShape(e),r.setCurrentTool("select.editing_shape",{target:"shape",shape:e}),t&&r.emit("select-all-text",{shapeId:e.id})}function zre(r,e){const t=kt(e.map(s=>r.getShape(s)).filter(s=>s&&r.isShapeOfType(s,"frame")));if(!t.length)return;const n=[];r.run(()=>{t.map(s=>{const o=r.getSortedChildIdsForParent(s.id);o.length&&(r.reparentShapes(o,s.parentId,s.index),n.push(...o))}),r.setSelectedShapes(n),r.deleteShapes(e)})}const $re=50;function Bre(r,e,t={}){const n=r.getShape(e);if(!n)return;const s=r.getSortedChildIdsForParent(n.id),o=kt(s.map(m=>r.getShape(m)));if(!o.length)return;const i=Ve.FromPoints(o.flatMap(m=>{const v=r.getShapeGeometry(m.id);return r.getShapeLocalTransform(m).applyToPoints(v.vertices)})),{padding:a=$re}=t,l=i.w+2*a,c=i.h+2*a,u=a-i.minX,p=a-i.minY;if(u===0&&p===0&&n.props.w===l&&n.props.h===c)return;const f=new P(u,p).rot(n.rotation);r.run(()=>{const m=s.map(v=>{const b=r.getShape(v);return{id:b.id,type:b.type,x:b.x+u,y:b.y+p}});m.push({id:n.id,type:n.type,x:n.x-f.x,y:n.y-f.y,props:{w:l,h:c}}),r.updateShapes(m)})}const wF=I.createContext(null);function Ure({assetUrls:r,children:e}){return I.useEffect(()=>{for(const t of Object.values(r.icons)){const n=Ff();n.src=t,n.decode()}for(const t of Object.values(r.embedIcons)){const n=Ff();n.src=t,n.decode()}},[r]),g.jsx(wF.Provider,{value:r,children:e})}function vP(){const r=I.useContext(wF);if(!r)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return r}const BE={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-json.short":"JSON","action.export-all-as-json":"Export as JSON","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.fork-project-on-tldraw":"Fork project on tldraw","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.paste-error-title":"Pasting failed","action.paste-error-description":"Could not paste due to missing clipboard permissions. Please enable the permissions and try again.","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-paste-at-cursor.menu":"Paste at cursor","action.toggle-paste-at-cursor":"Toggle paste at cursor","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle Select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-dynamic-size-mode.menu":"Dynamic size","action.toggle-dynamic-size-mode":"Toggle dynamic size","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.flatten-to-image":"Flatten","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","assets.files.size-too-big":"File size is too big","assets.files.type-not-allowed":"File type is not allowed","assets.files.upload-failed":"Upload failed","assets.url.failed":"Couldn't load URL preview","theme.dark":"Dark","theme.light":"Light","theme.system":"System","color-style.white":"White","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","fill-style.fill":"Fill","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","tool.pointer-down":"Pointer down","menu.title":"Menu","menu.theme":"Theme","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.help":"Help","menu.view":"View","context-menu.edit":"Edit","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy editor link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy viewer link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to access this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","share-menu.creating-project":"Creating the new project…","share-menu.copied":"Copied link","document-name-menu.copy-link":"Copy link","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.import-tldr-file":"Import file...","help-menu.title":"Help and resources","help-menu.about":"About tldraw","help-menu.docs":"Documentation & API","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","help-menu.terms":"Terms of service","help-menu.privacy":"Privacy policy","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.label-align":"Label align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},Hre=new Set(["ar","fa","he","ur","ku"]),lh={locale:"en",label:"English",messages:BE,dir:"ltr"};async function Gre(r,e){if(!(await al(e.translations.en)).ok)return console.warn("No main translations found."),lh;if(r==="en")return lh;const n=Uf.find(a=>a.locale===r);if(!n)return console.warn(`No translation found for locale ${r}`),lh;const o=await(await al(e.translations[n.locale])).json();if(!o)return console.warn(`No messages found for locale ${r}`),lh;const i=[];for(const a in lh.messages)o[a]||i.push(a);return i.length>0,{locale:r,label:n.label,dir:Hre.has(n.locale)?"rtl":"ltr",messages:{...lh.messages,...o}}}const CF=I.createContext(null);function EF(){const r=I.useContext(CF);if(!r)throw new Error("useCurrentTranslation must be used inside of <TldrawUiContextProvider />");return r}function Wre({overrides:r,locale:e,children:t}){const n=vP(),[s,o]=I.useState(()=>r&&r.en?{locale:"en",label:"English",dir:"ltr",messages:{...BE,...r.en}}:{locale:"en",label:"English",dir:"ltr",messages:BE});return I.useEffect(()=>{let i=!1;async function a(){const l=await Gre(e,n);l&&!i&&(r&&r[e]?o({...l,messages:{...l.messages,...r[e]}}):o(l))}return a(),()=>{i=!0}},[n,e,r]),g.jsx(CF.Provider,{value:s,children:t})}function Wt(){const r=EF();return I.useCallback(function(t){return r.messages[t]??t},[r])}const ut=I.forwardRef(function({children:e,type:t,...n},s){return g.jsx("button",{ref:s,type:"button",draggable:!1,...n,className:it("tlui-button",`tlui-button__${t}`,n.className),children:e})});function Tr({children:r}){return g.jsx("span",{className:"tlui-button__label",children:r})}var bP="Dialog",[kF,Lge]=ku(bP),[Kre,Sa]=kF(bP),PF=r=>{const{__scopeDialog:e,children:t,open:n,defaultOpen:s,onOpenChange:o,modal:i=!0}=r,a=I.useRef(null),l=I.useRef(null),[c=!1,u]=yd({prop:n,defaultProp:s,onChange:o});return g.jsx(Kre,{scope:e,triggerRef:a,contentRef:l,contentId:Vl(),titleId:Vl(),descriptionId:Vl(),open:c,onOpenChange:u,onOpenToggle:I.useCallback(()=>u(p=>!p),[u]),modal:i,children:t})};PF.displayName=bP;var IF="DialogTrigger",Vre=I.forwardRef((r,e)=>{const{__scopeDialog:t,...n}=r,s=Sa(IF,t),o=Un(e,s.triggerRef);return g.jsx(rn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":wP(s.open),...n,ref:o,onClick:Qe(r.onClick,s.onOpenToggle)})});Vre.displayName=IF;var SP="DialogPortal",[qre,_F]=kF(SP,{forceMount:void 0}),TF=r=>{const{__scopeDialog:e,forceMount:t,children:n,container:s}=r,o=Sa(SP,e);return g.jsx(qre,{scope:e,forceMount:t,children:I.Children.map(n,i=>g.jsx(ba,{present:t||o.open,children:g.jsx(Zg,{asChild:!0,container:s,children:i})}))})};TF.displayName=SP;var c0="DialogOverlay",MF=I.forwardRef((r,e)=>{const t=_F(c0,r.__scopeDialog),{forceMount:n=t.forceMount,...s}=r,o=Sa(c0,r.__scopeDialog);return o.modal?g.jsx(ba,{present:n||o.open,children:g.jsx(Yre,{...s,ref:e})}):null});MF.displayName=c0;var Yre=I.forwardRef((r,e)=>{const{__scopeDialog:t,...n}=r,s=Sa(c0,t);return g.jsx(kb,{as:hu,allowPinchZoom:!0,shards:[s.contentRef],children:g.jsx(rn.div,{"data-state":wP(s.open),...n,ref:e,style:{pointerEvents:"auto",...n.style}})})}),fu="DialogContent",AF=I.forwardRef((r,e)=>{const t=_F(fu,r.__scopeDialog),{forceMount:n=t.forceMount,...s}=r,o=Sa(fu,r.__scopeDialog);return g.jsx(ba,{present:n||o.open,children:o.modal?g.jsx(Xre,{...s,ref:e}):g.jsx(Zre,{...s,ref:e})})});AF.displayName=fu;var Xre=I.forwardRef((r,e)=>{const t=Sa(fu,r.__scopeDialog),n=I.useRef(null),s=Un(e,t.contentRef,n);return I.useEffect(()=>{const o=n.current;if(o)return rP(o)},[]),g.jsx(jF,{...r,ref:s,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Qe(r.onCloseAutoFocus,o=>{var i;o.preventDefault(),(i=t.triggerRef.current)==null||i.focus()}),onPointerDownOutside:Qe(r.onPointerDownOutside,o=>{const i=o.detail.originalEvent,a=i.button===0&&i.ctrlKey===!0;(i.button===2||a)&&o.preventDefault()}),onFocusOutside:Qe(r.onFocusOutside,o=>o.preventDefault())})}),Zre=I.forwardRef((r,e)=>{const t=Sa(fu,r.__scopeDialog),n=I.useRef(!1),s=I.useRef(!1);return g.jsx(jF,{...r,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var i,a;(i=r.onCloseAutoFocus)==null||i.call(r,o),o.defaultPrevented||(n.current||(a=t.triggerRef.current)==null||a.focus(),o.preventDefault()),n.current=!1,s.current=!1},onInteractOutside:o=>{var l,c;(l=r.onInteractOutside)==null||l.call(r,o),o.defaultPrevented||(n.current=!0,o.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const i=o.target;((c=t.triggerRef.current)==null?void 0:c.contains(i))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&s.current&&o.preventDefault()}})}),jF=I.forwardRef((r,e)=>{const{__scopeDialog:t,trapFocus:n,onOpenAutoFocus:s,onCloseAutoFocus:o,...i}=r,a=Sa(fu,t),l=I.useRef(null),c=Un(e,l);return W2(),g.jsxs(g.Fragment,{children:[g.jsx(vb,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:s,onUnmountAutoFocus:o,children:g.jsx(Yg,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":wP(a.open),...i,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),g.jsxs(g.Fragment,{children:[g.jsx(Qre,{titleId:a.titleId}),g.jsx(tse,{contentRef:l,descriptionId:a.descriptionId})]})]})}),xP="DialogTitle",RF=I.forwardRef((r,e)=>{const{__scopeDialog:t,...n}=r,s=Sa(xP,t);return g.jsx(rn.h2,{id:s.titleId,...n,ref:e})});RF.displayName=xP;var DF="DialogDescription",Jre=I.forwardRef((r,e)=>{const{__scopeDialog:t,...n}=r,s=Sa(DF,t);return g.jsx(rn.p,{id:s.descriptionId,...n,ref:e})});Jre.displayName=DF;var OF="DialogClose",LF=I.forwardRef((r,e)=>{const{__scopeDialog:t,...n}=r,s=Sa(OF,t);return g.jsx(rn.button,{type:"button",...n,ref:e,onClick:Qe(r.onClick,()=>s.onOpenChange(!1))})});LF.displayName=OF;function wP(r){return r?"open":"closed"}var NF="DialogTitleWarning",[Nge,FF]=_Q(NF,{contentName:fu,titleName:xP,docsSlug:"dialog"}),Qre=({titleId:r})=>{const e=FF(NF),t=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return I.useEffect(()=>{r&&(document.getElementById(r)||console.error(t))},[t,r]),null},ese="DialogDescriptionWarning",tse=({contentRef:r,descriptionId:e})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${FF(ese).contentName}}.`;return I.useEffect(()=>{var o;const s=(o=r.current)==null?void 0:o.getAttribute("aria-describedby");e&&s&&(document.getElementById(e)||console.warn(n))},[n,r,e]),null},nse=PF,rse=TF,sse=MF,ose=AF;const hl=I.memo(function({small:e,invertIcon:t,icon:n,color:s,className:o,...i}){const a=vP(),l=a.icons[n]??a.icons["question-mark-circle"],c=I.useRef(null);return I.useLayoutEffect(()=>{l||console.error(`Icon not found: ${n}. Add it to the assetUrls.icons object.`),c!=null&&c.current&&(c.current.style.webkitMask=`url(${l}) center 100% / 100% no-repeat`)},[c,l,n]),n==="none"?g.jsx("div",{className:it("tlui-icon tlui-icon__placeholder",{"tlui-icon__small":e},o)}):g.jsx("div",{...i,ref:c,className:it("tlui-icon",{"tlui-icon__small":e},o),style:{color:s,mask:`url(${l}) center 100% / 100% no-repeat`,transform:t?"scale(-1, 1)":void 0}})});function $t({icon:r,small:e,invertIcon:t}){return g.jsx(hl,{className:"tlui-button__icon",icon:r,small:e,invertIcon:t})}function Tb({className:r,children:e}){return g.jsx("div",{className:it("tlui-dialog__header",r),children:e})}function Mb({className:r,children:e}){return g.jsx(RF,{dir:"ltr",className:it("tlui-dialog__header__title",r),children:e})}function Ab(){return g.jsx("div",{className:"tlui-dialog__header__close",children:g.jsx(LF,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:g.jsx(ut,{type:"icon","aria-label":"Close",onTouchEnd:r=>r.target.click(),children:g.jsx($t,{small:!0,icon:"cross-2"})})})})}function qf({className:r,children:e,style:t}){return g.jsx("div",{className:it("tlui-dialog__body",r),style:t,children:e})}function CP({className:r,children:e}){return g.jsx("div",{className:it("tlui-dialog__footer",r),children:e})}const jb=I.forwardRef(function({className:e,label:t,icon:n,iconLeft:s,autoSelect:o=!1,autoFocus:i=!1,defaultValue:a,placeholder:l,onComplete:c,onValueChange:u,onCancel:p,onFocus:f,onBlur:m,shouldManuallyMaintainScrollPositionWhenFocused:v=!1,children:b,value:S},C){const E=fd(),T=I.useRef(null);I.useImperativeHandle(C,()=>T.current);const w=Wt(),M=I.useRef(a??""),R=I.useRef(a??""),[D,N]=I.useState(!1),z=I.useCallback(O=>{N(!0);const U=O.currentTarget;R.current=U.value,E?E.timers.requestAnimationFrame(()=>{o&&U.select()}):IE.requestAnimationFrame("anon",()=>{o&&U.select()}),f==null||f()},[o,E,f]),L=I.useCallback(O=>{const U=O.currentTarget.value;R.current=U,u==null||u(U)},[u]),B=I.useCallback(O=>{switch(O.key){case"Enter":{O.currentTarget.blur(),Ar(O),c==null||c(O.currentTarget.value);break}case"Escape":{O.currentTarget.value=M.current,p==null||p(O.currentTarget.value),O.currentTarget.blur(),Ar(O);break}}},[c,p]),K=I.useCallback(O=>{N(!1);const U=O.currentTarget.value;m==null||m(U)},[m]);return I.useEffect(()=>{if(!Rn.isIos)return;const O=window.visualViewport;if(D&&v&&O){const U=()=>{var X;(X=T.current)==null||X.scrollIntoView({block:"center"})};return O.addEventListener("resize",U),O.addEventListener("scroll",U),E?E.timers.requestAnimationFrame(()=>{var X;(X=T.current)==null||X.scrollIntoView({block:"center"})}):IE.requestAnimationFrame("anon",()=>{var X;(X=T.current)==null||X.scrollIntoView({block:"center"})}),()=>{O.removeEventListener("resize",U),O.removeEventListener("scroll",U)}}},[D,E,v]),g.jsxs("div",{draggable:!1,className:"tlui-input__wrapper",children:[b,t&&g.jsx("label",{children:w(t)}),s&&g.jsx(hl,{icon:s,className:"tlui-icon-left",small:!0}),g.jsx("input",{ref:T,className:it("tlui-input",e),type:"text",defaultValue:a,onKeyDownCapture:B,onChange:L,onFocus:z,onBlur:K,autoFocus:i,placeholder:l,value:S}),n&&g.jsx(hl,{icon:n,small:!!t})]})});function rD(r){return ci.isValid(r)?{isValid:!0,hasProtocol:!0}:ci.isValid("https://"+r)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const ise=Ss(function({onClose:e}){const n=ue().getOnlySelectedShape();return n&&"url"in n.props&&typeof n.props.url=="string"?g.jsx(ase,{onClose:e,selectedShape:n}):null}),ase=Ss(function({onClose:e,selectedShape:t}){const n=ue(),s=Wt(),o=I.useRef(null);I.useEffect(()=>{n.timers.requestAnimationFrame(()=>{var v;return(v=o.current)==null?void 0:v.focus()})},[n]);const i=I.useRef(t.props.url),[a,l]=I.useState(()=>{const v=rD(t.props.url),b=v.isValid===!0?v.hasProtocol?t.props.url:"https://"+t.props.url:"https://";return{actual:b,safe:b,valid:!0}}),c=I.useCallback(v=>{const b=v.replace(/https?:\/\/(https?:\/\/)/,(E,T)=>T),S=rD(b),C=S.isValid===!0?S.hasProtocol?b:"https://"+b:"https://";l({actual:b,safe:C,valid:S.isValid})},[]),u=I.useCallback(()=>{const v=n.getOnlySelectedShape();v&&(n.updateShapes([{id:v.id,type:v.type,props:{url:""}}]),e())},[n,e]),p=I.useCallback(()=>{const v=n.getOnlySelectedShape();v&&(v&&"url"in v.props&&v.props.url!==a.safe&&n.updateShapes([{id:v.id,type:v.type,props:{url:a.safe}}]),e())},[n,e,a]),f=I.useCallback(()=>{e()},[e]);if(!t)return e(),null;const m=i.current&&!a.valid;return g.jsxs(g.Fragment,{children:[g.jsxs(Tb,{children:[g.jsx(Mb,{children:s("edit-link-dialog.title")}),g.jsx(Ab,{})]}),g.jsx(qf,{children:g.jsxs("div",{className:"tlui-edit-link-dialog",children:[g.jsx(jb,{ref:o,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autoFocus:!0,value:a.actual,onValueChange:c,onComplete:p,onCancel:f}),g.jsx("div",{children:a.valid?s("edit-link-dialog.detail"):s("edit-link-dialog.invalid-url")})]})}),g.jsxs(CP,{className:"tlui-dialog__footer__actions",children:[g.jsx(ut,{type:"normal",onClick:f,onTouchEnd:f,children:g.jsx(Tr,{children:s("edit-link-dialog.cancel")})}),m?g.jsx(ut,{type:"danger",onTouchEnd:u,onClick:u,children:g.jsx(Tr,{children:s("edit-link-dialog.clear")})}):g.jsx(ut,{type:"primary",disabled:!a.valid,onTouchEnd:p,onClick:p,children:g.jsx(Tr,{children:s("edit-link-dialog.save")})})]})]})});var lse={};const sD=/(^\/r\/[^/]+\/?$)/,EP=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,overridePermissions:{"allow-top-navigation":!0},toEmbedUrl:r=>{const e=vt(r);if(e&&e.pathname.match(sD))return r},fromEmbedUrl:r=>{const e=vt(r);if(e&&e.pathname.match(sD))return r}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,toEmbedUrl:r=>{if(r.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!r.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${r}`},fromEmbedUrl:r=>{const e=vt(r);if(e&&e.pathname.match(/^\/embed\/?$/)){const t=e.searchParams.get("url");if(t)return t}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,overridePermissions:{"allow-presentation":!0},toEmbedUrl:r=>{if(r.includes("/maps/embed?"))return r;if(r.includes("/maps/")){const e=r.match(/@(.*?),(.*?),(.*?)z/);let t;if(e){const[,n,s,o]=e;t=`https://${new URL(r).host.replace("www.","")}/maps/embed/v1/view?key=${lse.NEXT_PUBLIC_GC_API_KEY}&center=${n},${s}&zoom=${o}`}else t="";return t}},fromEmbedUrl:r=>{const e=vt(r);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const n=e.searchParams.get("zoom"),[s,o]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${s},${o},${n}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,toEmbedUrl:r=>{const e=vt(r),t=e&&e.pathname.match(/\/v\/(.+)\/?/);if(t)return`https://www.val.town/embed/${t[1]}`},fromEmbedUrl:r=>{const e=vt(r),t=e&&e.pathname.match(/\/embed\/(.+)\/?/);if(t)return`https://www.val.town/v/${t[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,toEmbedUrl:r=>{const e=vt(r),t=e&&e.pathname.match(/\/s\/([^/]+)\/?/);if(t)return`https://codesandbox.io/embed/${t[1]}`},fromEmbedUrl:r=>{const e=vt(r),t=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(t)return`https://codesandbox.io/s/${t[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,toEmbedUrl:r=>{const e=/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/,t=r.match(e);if(t){const[n,s,o]=t;return`https://codepen.io/${s}/embed/${o}`}},fromEmbedUrl:r=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,t=r.match(e);if(t){const[n,s,o]=t;return`https://codepen.io/${s}/pen/${o}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,toEmbedUrl:r=>{const e=/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/,t=r.match(e);if(t){const[n,s]=t;return`https://scratch.mit.edu/projects/embed/${s}`}},fromEmbedUrl:r=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,t=r.match(e);if(t){const[n,s]=t;return`https://scratch.mit.edu/projects/${s}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,overridePermissions:{"allow-presentation":!0,"allow-popups-to-escape-sandbox":!0},isAspectRatioLocked:!0,toEmbedUrl:r=>{const e=vt(r);if(!e)return;const t=e.hostname.replace(/^www./,"");if(t==="youtu.be")return`https://www.youtube.com/embed/${e.pathname.split("/").filter(Boolean)[0]}`;if((t==="youtube.com"||t==="m.youtube.com")&&e.pathname.match(/^\/watch/))return`https://www.youtube.com/embed/${e.searchParams.get("v")}`},fromEmbedUrl:r=>{const e=vt(r);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const n=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(n)return`https://www.youtube.com/watch?v=${n[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:r=>{const e=vt(r),t=e==null?void 0:e.searchParams.get("cid");if(e!=null&&e.pathname.match(/\/calendar\/u\/0/)&&t){e.pathname="/calendar/embed";const n=Array.from(e.searchParams.keys());for(const s of n)e.searchParams.delete(s);return e.searchParams.set("src",t),e.href}},fromEmbedUrl:r=>{const e=vt(r),t=e==null?void 0:e.searchParams.get("src");if(e!=null&&e.pathname.match(/\/calendar\/embed/)&&t){e.pathname="/calendar/u/0";const n=Array.from(e.searchParams.keys());for(const s of n)e.searchParams.delete(s);return e.searchParams.set("cid",t),e.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:r=>{const e=vt(r);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/pub\/?$/))){e.pathname=e.pathname.replace(/\/pub$/,"/embed");const t=Array.from(e.searchParams.keys());for(const n of t)e.searchParams.delete(n);return e.href}},fromEmbedUrl:r=>{const e=vt(r);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/embed\/?$/))){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const t=Array.from(e.searchParams.keys());for(const n of t)e.searchParams.delete(n);return e.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,toEmbedUrl:r=>{const e=vt(r);if(e&&e.pathname.match(/\/([^/]+)\/([0-9a-f]+)$/))return r.split("/").pop()?r:void 0},fromEmbedUrl:r=>{const e=vt(r);if(e&&e.pathname.match(/\/([^/]+)\/([0-9a-f]+)$/))return r.split("/").pop()?r:void 0}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,toEmbedUrl:r=>{const e=vt(r);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${r}?embed=true`},fromEmbedUrl:r=>{const e=vt(r);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,toEmbedUrl:r=>{const e=vt(r);if(e&&e.pathname.match(/^\/map\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:r=>{const e=vt(r);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,toEmbedUrl:r=>{const e=vt(r);if(e&&e.pathname.match(/^\/(artist|album)\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:r=>{const e=vt(r);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:r=>{const e=vt(r);if(e&&e.hostname==="vimeo.com"&&e.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+e.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:r=>{const e=vt(r);if(e&&e.hostname==="player.vimeo.com"){const t=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(t)return"https://vimeo.com/"+t[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:r=>{const e=vt(r);if(e&&e.hash.match(/#room=/))return r},fromEmbedUrl:r=>{const e=vt(r);if(e&&e.hash.match(/#room=/))return r}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:r=>{const e=vt(r);if(e&&e.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}/embed${e.pathname}?cell=*`;if(e&&e.pathname.match(/^\/d\/([^/]+)\/?$/)){const t=e.pathname.replace(/^\/d/,"");return`${e.origin}/embed${t}?cell=*`}},fromEmbedUrl:r=>{const e=vt(r);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}},{type:"desmos",title:"Desmos",hostnames:["desmos.com"],width:700,height:450,doesResize:!0,toEmbedUrl:r=>{const e=vt(r);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search===""&&e.hash==="")return`${r}?embed`},fromEmbedUrl:r=>{const e=vt(r);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search==="?embed"&&e.hash==="")return r.replace("?embed","")}}],cse={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},dse=EP.map(r=>r.type);function use(r){return dse.includes(r)}function hse(r){return"icon"in r}function zF(){return ue().getShapeUtil("embed")}function kP(){const r=zF();return e=>r?r.getEmbedDefinition(e):void 0}function pse(){const r=zF();return r?r.getEmbedDefinitions():[]}const $F=Ss(function({onClose:e}){const t=ue(),n=Wt(),s=vP(),[o,i]=I.useState(null),[a,l]=I.useState(""),[c,u]=I.useState(null),[p,f]=I.useState(!1),m=I.useRef(-1),v=pse(),b=kP();return g.jsxs(g.Fragment,{children:[g.jsxs(Tb,{children:[g.jsx(Mb,{children:o?`${n("embed-dialog.title")} — ${o.title}`:n("embed-dialog.title")}),g.jsx(Ab,{})]}),o?g.jsxs(g.Fragment,{children:[g.jsxs(qf,{className:"tlui-embed-dialog__enter",children:[g.jsx(jb,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"https://example.com",autoFocus:!0,onValueChange:S=>{l(S);const C=b(S);u(C&&C.definition.type===o.type?C:null),f(!1),clearTimeout(m.current),m.current=t.timers.setTimeout(()=>f(!C),320)}}),a===""?g.jsxs("div",{className:"tlui-embed-dialog__instruction",children:[g.jsx("span",{children:n("embed-dialog.instruction")})," ",o.instructionLink&&g.jsxs("a",{target:"_blank",rel:"noopener noreferrer",href:o.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",g.jsx(hl,{icon:"external-link",small:!0})]})]}):g.jsx("div",{className:"tlui-embed-dialog__warning",children:p?n("embed-dialog.invalid-url"):" "})]}),g.jsxs(CP,{className:"tlui-dialog__footer__actions",children:[g.jsx(ut,{type:"normal",onClick:()=>{i(null),u(null),l("")},children:g.jsx(Tr,{children:n("embed-dialog.back")})}),g.jsx("div",{className:"tlui-embed__spacer"}),g.jsx(ut,{type:"normal",onClick:e,children:g.jsx(Tr,{children:n("embed-dialog.cancel")})}),g.jsx(ut,{type:"primary",disabled:!c,onClick:()=>{c&&(t.putExternalContent({type:"embed",url:a,point:t.getViewportPageBounds().center,embed:c.definition}),e())},children:g.jsx(Tr,{children:n("embed-dialog.create")})})]})]}):g.jsx(g.Fragment,{children:g.jsx(qf,{className:"tlui-embed-dialog__list",children:v.map(S=>{const C=use(S.type)?s.embedIcons[S.type]:hse(S)?S.icon:void 0;return g.jsxs(ut,{type:"menu",onClick:()=>i(S),children:[g.jsx(Tr,{children:S.title}),C&&g.jsx("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${C})`}})]},S.type)})})})]})});async function fse(r,e,t){const n=kt(e.map(a=>{const l=r.getShape(a);if(!(!l||r.getShapeUtil(l.type).toSvg===void 0))return l}));if(n.length===0)return;if(n.length===1){const a=n[0];if(!a||r.isShapeOfType(a,"image"))return}const s=[];if(t!==void 0){const a=n.map(l=>({shape:l,bounds:r.getShapeMaskedPageBounds(l).clone().expandBy(t)}));for(let l=0;l<a.length;l++){const c=a[l];if(l===0){s[0]={shapes:[c.shape],bounds:c.bounds};continue}let u=!1;for(const p of s)if(p.bounds.includes(c.bounds)){p.shapes.push(c.shape),p.bounds.expand(c.bounds),u=!0;break}u||s.push({shapes:[c.shape],bounds:c.bounds})}}else{const a=Ve.Common(n.map(l=>r.getShapeMaskedPageBounds(l)));s.push({shapes:n,bounds:a})}const o=r.options.flattenImageBoundsPadding;for(const a of s){t!==void 0&&a.bounds.expandBy(-t);const l=await r.getSvgString(a.shapes,{padding:o});if(!(l!=null&&l.svg))continue;const c=new Blob([l.svg],{type:"image/svg+xml"}),u=await r.getAssetForExternalContent({type:"file",file:new File([c],"asset.svg",{type:"image/svg+xml"})});u&&(a.asset=u)}const i=[];return rl(()=>{for(const a of s){const{asset:l,bounds:c,shapes:u}=a;if(!l)continue;const p=r.findCommonAncestor(u)??r.getCurrentPageId();if(!p)continue;let f="a1";for(const C of u)if(C.parentId===p){C.index>f&&(f=C.index);break}let m,v,b;if(Oo(p)){const C=r.getShape(p);if(!C)continue;const E=r.getPointInShapeSpace(C,{x:c.x,y:c.y});b=r.getShapePageTransform(p).rotation(),E.sub(new P(o,o).rot(-b)),m=E.x,v=E.y}else m=c.x-o,v=c.y-o,b=0;r.deleteShapes(u),r.createAssets([{...l,id:l.id}]);const S=vn();r.createShape({id:S,type:"image",index:f,parentId:p,x:m,y:v,rotation:-b,props:{assetId:l.id,w:c.w+o*2,h:c.h+o*2}}),i.push(S)}}),i}function Rb(){const r=fd();return(r==null?void 0:r.store.props.collaboration)!==void 0}function gse(){const r=fd();return ye("sync status",()=>{var e;return(e=r==null?void 0:r.store.props.collaboration)!=null&&e.status?r.store.props.collaboration.status.get():null},[r])}const gC=[0,389,436,476,580,640,840,1023];var yr=(r=>(r[r.ZERO=0]="ZERO",r[r.MOBILE_XXS=1]="MOBILE_XXS",r[r.MOBILE_XS=2]="MOBILE_XS",r[r.MOBILE_SM=3]="MOBILE_SM",r[r.MOBILE=4]="MOBILE",r[r.TABLET_SM=5]="TABLET_SM",r[r.TABLET=6]="TABLET",r[r.DESKTOP=7]="DESKTOP",r))(yr||{});const BF=Ht.createContext(null);function mse({forceMobile:r=!1,children:e}){const t=fd(),n=ye("breakpoint",()=>{const{width:s}=(t==null?void 0:t.getViewportScreenBounds())??{width:window.innerWidth},o=r?yr.MOBILE_SM:gC.length-1;for(let i=0;i<o;i++)if(s>gC[i]&&s<=gC[i+1])return i;return o},[t]);return g.jsx(BF.Provider,{value:n,children:e})}function po(){const r=I.useContext(BF);if(r===null)throw new Error("useBreakpoint must be used inside of the <BreakpointProvider /> component");return r}const UF=I.createContext(null);function yse({context:r,children:e}){const t=ws(),n=n2("dialogs",[]),s=I.useMemo(()=>({dialogs:n,addDialog(o){const i=o.id??Cn();return n.update(a=>[...a.filter(l=>l.id!==o.id),{...o,id:i}]),t("open-menu",{source:"dialog",id:i}),ra.addOpenMenu(i,r),i},removeDialog(o){var a;const i=n.get().find(l=>l.id===o);return i&&((a=i.onClose)==null||a.call(i),t("close-menu",{source:"dialog",id:o}),ra.deleteOpenMenu(o,r),n.update(l=>l.filter(c=>c!==i))),o},clearDialogs(){const o=n.get();o.length!==0&&(o.forEach(i=>{var a;(a=i.onClose)==null||a.call(i),t("close-menu",{source:"dialog",id:i.id}),ra.deleteOpenMenu(i.id,r)}),n.set([]))}}),[t,n,r]);return g.jsx(UF.Provider,{value:s,children:e})}function tm(){const r=I.useContext(UF);if(!r)throw new Error("useDialogs must be used within a DialogsProvider");return r}var vse="VisuallyHidden",PP=I.forwardRef((r,e)=>g.jsx(rn.span,{...r,ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...r.style}}));PP.displayName=vse;var IP="ToastProvider",[_P,bse,Sse]=yb("Toast"),[HF,Fge]=ku("Toast",[Sse]),[xse,Db]=HF(IP),GF=r=>{const{__scopeToast:e,label:t="Notification",duration:n=5e3,swipeDirection:s="right",swipeThreshold:o=50,children:i}=r,[a,l]=I.useState(null),[c,u]=I.useState(0),p=I.useRef(!1),f=I.useRef(!1);return t.trim()||console.error(`Invalid prop \`label\` supplied to \`${IP}\`. Expected non-empty \`string\`.`),g.jsx(_P.Provider,{scope:e,children:g.jsx(xse,{scope:e,label:t,duration:n,swipeDirection:s,swipeThreshold:o,toastCount:c,viewport:a,onViewportChange:l,onToastAdd:I.useCallback(()=>u(m=>m+1),[]),onToastRemove:I.useCallback(()=>u(m=>m-1),[]),isFocusedToastEscapeKeyDownRef:p,isClosePausedRef:f,children:i})})};GF.displayName=IP;var WF="ToastViewport",wse=["F8"],UE="toast.viewportPause",HE="toast.viewportResume",KF=I.forwardRef((r,e)=>{const{__scopeToast:t,hotkey:n=wse,label:s="Notifications ({hotkey})",...o}=r,i=Db(WF,t),a=bse(t),l=I.useRef(null),c=I.useRef(null),u=I.useRef(null),p=I.useRef(null),f=Un(e,p,i.onViewportChange),m=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),v=i.toastCount>0;I.useEffect(()=>{const S=C=>{var T;n.length!==0&&n.every(w=>C[w]||C.code===w)&&((T=p.current)==null||T.focus())};return document.addEventListener("keydown",S),()=>document.removeEventListener("keydown",S)},[n]),I.useEffect(()=>{const S=l.current,C=p.current;if(v&&S&&C){const E=()=>{if(!i.isClosePausedRef.current){const R=new CustomEvent(UE);C.dispatchEvent(R),i.isClosePausedRef.current=!0}},T=()=>{if(i.isClosePausedRef.current){const R=new CustomEvent(HE);C.dispatchEvent(R),i.isClosePausedRef.current=!1}},w=R=>{!S.contains(R.relatedTarget)&&T()},M=()=>{S.contains(document.activeElement)||T()};return S.addEventListener("focusin",E),S.addEventListener("focusout",w),S.addEventListener("pointermove",E),S.addEventListener("pointerleave",M),window.addEventListener("blur",E),window.addEventListener("focus",T),()=>{S.removeEventListener("focusin",E),S.removeEventListener("focusout",w),S.removeEventListener("pointermove",E),S.removeEventListener("pointerleave",M),window.removeEventListener("blur",E),window.removeEventListener("focus",T)}}},[v,i.isClosePausedRef]);const b=I.useCallback(({tabbingDirection:S})=>{const E=a().map(T=>{const w=T.ref.current,M=[w,...Ose(w)];return S==="forwards"?M:M.reverse()});return(S==="forwards"?E.reverse():E).flat()},[a]);return I.useEffect(()=>{const S=p.current;if(S){const C=E=>{var M,R,D;const T=E.altKey||E.ctrlKey||E.metaKey;if(E.key==="Tab"&&!T){const N=document.activeElement,z=E.shiftKey;if(E.target===S&&z){(M=c.current)==null||M.focus();return}const K=b({tabbingDirection:z?"backwards":"forwards"}),O=K.findIndex(U=>U===N);mC(K.slice(O+1))?E.preventDefault():z?(R=c.current)==null||R.focus():(D=u.current)==null||D.focus()}};return S.addEventListener("keydown",C),()=>S.removeEventListener("keydown",C)}},[a,b]),g.jsxs(VQ,{ref:l,role:"region","aria-label":s.replace("{hotkey}",m),tabIndex:-1,style:{pointerEvents:v?void 0:"none"},children:[v&&g.jsx(GE,{ref:c,onFocusFromOutsideViewport:()=>{const S=b({tabbingDirection:"forwards"});mC(S)}}),g.jsx(_P.Slot,{scope:t,children:g.jsx(rn.ol,{tabIndex:-1,...o,ref:f})}),v&&g.jsx(GE,{ref:u,onFocusFromOutsideViewport:()=>{const S=b({tabbingDirection:"backwards"});mC(S)}})]})});KF.displayName=WF;var VF="ToastFocusProxy",GE=I.forwardRef((r,e)=>{const{__scopeToast:t,onFocusFromOutsideViewport:n,...s}=r,o=Db(VF,t);return g.jsx(PP,{"aria-hidden":!0,tabIndex:0,...s,ref:e,style:{position:"fixed"},onFocus:i=>{var c;const a=i.relatedTarget;!((c=o.viewport)!=null&&c.contains(a))&&n()}})});GE.displayName=VF;var Ob="Toast",Cse="toast.swipeStart",Ese="toast.swipeMove",kse="toast.swipeCancel",Pse="toast.swipeEnd",qF=I.forwardRef((r,e)=>{const{forceMount:t,open:n,defaultOpen:s,onOpenChange:o,...i}=r,[a=!0,l]=yd({prop:n,defaultProp:s,onChange:o});return g.jsx(ba,{present:t||a,children:g.jsx(Tse,{open:a,...i,ref:e,onClose:()=>l(!1),onPause:bs(r.onPause),onResume:bs(r.onResume),onSwipeStart:Qe(r.onSwipeStart,c=>{c.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Qe(r.onSwipeMove,c=>{const{x:u,y:p}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","move"),c.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${p}px`)}),onSwipeCancel:Qe(r.onSwipeCancel,c=>{c.currentTarget.setAttribute("data-swipe","cancel"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Qe(r.onSwipeEnd,c=>{const{x:u,y:p}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","end"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${p}px`),l(!1)})})})});qF.displayName=Ob;var[Ise,_se]=HF(Ob,{onClose(){}}),Tse=I.forwardRef((r,e)=>{const{__scopeToast:t,type:n="foreground",duration:s,open:o,onClose:i,onEscapeKeyDown:a,onPause:l,onResume:c,onSwipeStart:u,onSwipeMove:p,onSwipeCancel:f,onSwipeEnd:m,...v}=r,b=Db(Ob,t),[S,C]=I.useState(null),E=Un(e,U=>C(U)),T=I.useRef(null),w=I.useRef(null),M=s||b.duration,R=I.useRef(0),D=I.useRef(M),N=I.useRef(0),{onToastAdd:z,onToastRemove:L}=b,B=bs(()=>{var X;(S==null?void 0:S.contains(document.activeElement))&&((X=b.viewport)==null||X.focus()),i()}),K=I.useCallback(U=>{!U||U===1/0||(window.clearTimeout(N.current),R.current=new Date().getTime(),N.current=window.setTimeout(B,U))},[B]);I.useEffect(()=>{const U=b.viewport;if(U){const X=()=>{K(D.current),c==null||c()},H=()=>{const ee=new Date().getTime()-R.current;D.current=D.current-ee,window.clearTimeout(N.current),l==null||l()};return U.addEventListener(UE,H),U.addEventListener(HE,X),()=>{U.removeEventListener(UE,H),U.removeEventListener(HE,X)}}},[b.viewport,M,l,c,K]),I.useEffect(()=>{o&&!b.isClosePausedRef.current&&K(M)},[o,M,b.isClosePausedRef,K]),I.useEffect(()=>(z(),()=>L()),[z,L]);const O=I.useMemo(()=>S?t9(S):null,[S]);return b.viewport?g.jsxs(g.Fragment,{children:[O&&g.jsx(Mse,{__scopeToast:t,role:"status","aria-live":n==="foreground"?"assertive":"polite","aria-atomic":!0,children:O}),g.jsx(Ise,{scope:t,onClose:B,children:lp.createPortal(g.jsx(_P.ItemSlot,{scope:t,children:g.jsx(KQ,{asChild:!0,onEscapeKeyDown:Qe(a,()=>{b.isFocusedToastEscapeKeyDownRef.current||B(),b.isFocusedToastEscapeKeyDownRef.current=!1}),children:g.jsx(rn.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":o?"open":"closed","data-swipe-direction":b.swipeDirection,...v,ref:E,style:{userSelect:"none",touchAction:"none",...r.style},onKeyDown:Qe(r.onKeyDown,U=>{U.key==="Escape"&&(a==null||a(U.nativeEvent),U.nativeEvent.defaultPrevented||(b.isFocusedToastEscapeKeyDownRef.current=!0,B()))}),onPointerDown:Qe(r.onPointerDown,U=>{U.button===0&&(T.current={x:U.clientX,y:U.clientY})}),onPointerMove:Qe(r.onPointerMove,U=>{if(!T.current)return;const X=U.clientX-T.current.x,H=U.clientY-T.current.y,ee=!!w.current,J=["left","right"].includes(b.swipeDirection),ne=["left","up"].includes(b.swipeDirection)?Math.min:Math.max,ae=J?ne(0,X):0,q=J?0:ne(0,H),se=U.pointerType==="touch"?10:2,xe={x:ae,y:q},Oe={originalEvent:U,delta:xe};ee?(w.current=xe,My(Ese,p,Oe,{discrete:!1})):oD(xe,b.swipeDirection,se)?(w.current=xe,My(Cse,u,Oe,{discrete:!1}),U.target.setPointerCapture(U.pointerId)):(Math.abs(X)>se||Math.abs(H)>se)&&(T.current=null)}),onPointerUp:Qe(r.onPointerUp,U=>{const X=w.current,H=U.target;if(H.hasPointerCapture(U.pointerId)&&H.releasePointerCapture(U.pointerId),w.current=null,T.current=null,X){const ee=U.currentTarget,J={originalEvent:U,delta:X};oD(X,b.swipeDirection,b.swipeThreshold)?My(Pse,m,J,{discrete:!0}):My(kse,f,J,{discrete:!0}),ee.addEventListener("click",ne=>ne.preventDefault(),{once:!0})}})})})}),b.viewport)})]}):null}),Mse=r=>{const{__scopeToast:e,children:t,...n}=r,s=Db(Ob,e),[o,i]=I.useState(!1),[a,l]=I.useState(!1);return Rse(()=>i(!0)),I.useEffect(()=>{const c=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(c)},[]),a?null:g.jsx(Zg,{asChild:!0,children:g.jsx(PP,{...n,children:o&&g.jsxs(g.Fragment,{children:[s.label," ",t]})})})},Ase="ToastTitle",YF=I.forwardRef((r,e)=>{const{__scopeToast:t,...n}=r;return g.jsx(rn.div,{...n,ref:e})});YF.displayName=Ase;var jse="ToastDescription",XF=I.forwardRef((r,e)=>{const{__scopeToast:t,...n}=r;return g.jsx(rn.div,{...n,ref:e})});XF.displayName=jse;var ZF="ToastAction",JF=I.forwardRef((r,e)=>{const{altText:t,...n}=r;return t.trim()?g.jsx(e9,{altText:t,asChild:!0,children:g.jsx(TP,{...n,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${ZF}\`. Expected non-empty \`string\`.`),null)});JF.displayName=ZF;var QF="ToastClose",TP=I.forwardRef((r,e)=>{const{__scopeToast:t,...n}=r,s=_se(QF,t);return g.jsx(e9,{asChild:!0,children:g.jsx(rn.button,{type:"button",...n,ref:e,onClick:Qe(r.onClick,s.onClose)})})});TP.displayName=QF;var e9=I.forwardRef((r,e)=>{const{__scopeToast:t,altText:n,...s}=r;return g.jsx(rn.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":n||void 0,...s,ref:e})});function t9(r){const e=[];return Array.from(r.childNodes).forEach(n=>{if(n.nodeType===n.TEXT_NODE&&n.textContent&&e.push(n.textContent),Dse(n)){const s=n.ariaHidden||n.hidden||n.style.display==="none",o=n.dataset.radixToastAnnounceExclude==="";if(!s)if(o){const i=n.dataset.radixToastAnnounceAlt;i&&e.push(i)}else e.push(...t9(n))}}),e}function My(r,e,t,{discrete:n}){const s=t.originalEvent.currentTarget,o=new CustomEvent(r,{bubbles:!0,cancelable:!0,detail:t});e&&s.addEventListener(r,e,{once:!0}),n?H2(s,o):s.dispatchEvent(o)}var oD=(r,e,t=0)=>{const n=Math.abs(r.x),s=Math.abs(r.y),o=n>s;return e==="left"||e==="right"?o&&n>t:!o&&s>t};function Rse(r=()=>{}){const e=bs(r);od(()=>{let t=0,n=0;return t=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(t),window.cancelAnimationFrame(n)}},[e])}function Dse(r){return r.nodeType===r.ELEMENT_NODE}function Ose(r){const e=[],t=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const s=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||s?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function mC(r){const e=document.activeElement;return r.some(t=>t===e?!0:(t.focus(),document.activeElement!==e))}var Lse=qF,Nse=YF,Fse=XF,zse=JF,iD=TP;const n9=I.createContext(null);function $se({children:r}){const e=n2("toasts",[]),t=I.useMemo(()=>({toasts:e,addToast(n){const s=n.id??Cn();return e.update(o=>[...o.filter(i=>i.id!==n.id),{...n,id:s}]),s},removeToast(n){return e.update(s=>s.filter(o=>o.id!==n)),n},clearToasts(){e.set([])}}),[e]);return g.jsx(GF,{children:g.jsx(n9.Provider,{value:t,children:r})})}function sc(){const r=I.useContext(n9);if(!r)throw new Error("useToasts must be used within a ToastsProvider");return r}var sv={exports:{}};sv.exports;var aD;function Bse(){return aD||(aD=1,function(r){var e=function(){var t=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",o={};function i(l,c){if(!o[l]){o[l]={};for(var u=0;u<l.length;u++)o[l][l.charAt(u)]=u}return o[l][c]}var a={compressToBase64:function(l){if(l==null)return"";var c=a._compress(l,6,function(u){return n.charAt(u)});switch(c.length%4){default:case 0:return c;case 1:return c+"===";case 2:return c+"==";case 3:return c+"="}},decompressFromBase64:function(l){return l==null?"":l==""?null:a._decompress(l.length,32,function(c){return i(n,l.charAt(c))})},compressToUTF16:function(l){return l==null?"":a._compress(l,15,function(c){return t(c+32)})+" "},decompressFromUTF16:function(l){return l==null?"":l==""?null:a._decompress(l.length,16384,function(c){return l.charCodeAt(c)-32})},compressToUint8Array:function(l){for(var c=a.compress(l),u=new Uint8Array(c.length*2),p=0,f=c.length;p<f;p++){var m=c.charCodeAt(p);u[p*2]=m>>>8,u[p*2+1]=m%256}return u},decompressFromUint8Array:function(l){if(l==null)return a.decompress(l);for(var c=new Array(l.length/2),u=0,p=c.length;u<p;u++)c[u]=l[u*2]*256+l[u*2+1];var f=[];return c.forEach(function(m){f.push(t(m))}),a.decompress(f.join(""))},compressToEncodedURIComponent:function(l){return l==null?"":a._compress(l,6,function(c){return s.charAt(c)})},decompressFromEncodedURIComponent:function(l){return l==null?"":l==""?null:(l=l.replace(/ /g,"+"),a._decompress(l.length,32,function(c){return i(s,l.charAt(c))}))},compress:function(l){return a._compress(l,16,function(c){return t(c)})},_compress:function(l,c,u){if(l==null)return"";var p,f,m={},v={},b="",S="",C="",E=2,T=3,w=2,M=[],R=0,D=0,N;for(N=0;N<l.length;N+=1)if(b=l.charAt(N),Object.prototype.hasOwnProperty.call(m,b)||(m[b]=T++,v[b]=!0),S=C+b,Object.prototype.hasOwnProperty.call(m,S))C=S;else{if(Object.prototype.hasOwnProperty.call(v,C)){if(C.charCodeAt(0)<256){for(p=0;p<w;p++)R=R<<1,D==c-1?(D=0,M.push(u(R)),R=0):D++;for(f=C.charCodeAt(0),p=0;p<8;p++)R=R<<1|f&1,D==c-1?(D=0,M.push(u(R)),R=0):D++,f=f>>1}else{for(f=1,p=0;p<w;p++)R=R<<1|f,D==c-1?(D=0,M.push(u(R)),R=0):D++,f=0;for(f=C.charCodeAt(0),p=0;p<16;p++)R=R<<1|f&1,D==c-1?(D=0,M.push(u(R)),R=0):D++,f=f>>1}E--,E==0&&(E=Math.pow(2,w),w++),delete v[C]}else for(f=m[C],p=0;p<w;p++)R=R<<1|f&1,D==c-1?(D=0,M.push(u(R)),R=0):D++,f=f>>1;E--,E==0&&(E=Math.pow(2,w),w++),m[S]=T++,C=String(b)}if(C!==""){if(Object.prototype.hasOwnProperty.call(v,C)){if(C.charCodeAt(0)<256){for(p=0;p<w;p++)R=R<<1,D==c-1?(D=0,M.push(u(R)),R=0):D++;for(f=C.charCodeAt(0),p=0;p<8;p++)R=R<<1|f&1,D==c-1?(D=0,M.push(u(R)),R=0):D++,f=f>>1}else{for(f=1,p=0;p<w;p++)R=R<<1|f,D==c-1?(D=0,M.push(u(R)),R=0):D++,f=0;for(f=C.charCodeAt(0),p=0;p<16;p++)R=R<<1|f&1,D==c-1?(D=0,M.push(u(R)),R=0):D++,f=f>>1}E--,E==0&&(E=Math.pow(2,w),w++),delete v[C]}else for(f=m[C],p=0;p<w;p++)R=R<<1|f&1,D==c-1?(D=0,M.push(u(R)),R=0):D++,f=f>>1;E--,E==0&&(E=Math.pow(2,w),w++)}for(f=2,p=0;p<w;p++)R=R<<1|f&1,D==c-1?(D=0,M.push(u(R)),R=0):D++,f=f>>1;for(;;)if(R=R<<1,D==c-1){M.push(u(R));break}else D++;return M.join("")},decompress:function(l){return l==null?"":l==""?null:a._decompress(l.length,32768,function(c){return l.charCodeAt(c)})},_decompress:function(l,c,u){var p=[],f=4,m=4,v=3,b="",S=[],C,E,T,w,M,R,D,N={val:u(0),position:c,index:1};for(C=0;C<3;C+=1)p[C]=C;for(T=0,M=Math.pow(2,2),R=1;R!=M;)w=N.val&N.position,N.position>>=1,N.position==0&&(N.position=c,N.val=u(N.index++)),T|=(w>0?1:0)*R,R<<=1;switch(T){case 0:for(T=0,M=Math.pow(2,8),R=1;R!=M;)w=N.val&N.position,N.position>>=1,N.position==0&&(N.position=c,N.val=u(N.index++)),T|=(w>0?1:0)*R,R<<=1;D=t(T);break;case 1:for(T=0,M=Math.pow(2,16),R=1;R!=M;)w=N.val&N.position,N.position>>=1,N.position==0&&(N.position=c,N.val=u(N.index++)),T|=(w>0?1:0)*R,R<<=1;D=t(T);break;case 2:return""}for(p[3]=D,E=D,S.push(D);;){if(N.index>l)return"";for(T=0,M=Math.pow(2,v),R=1;R!=M;)w=N.val&N.position,N.position>>=1,N.position==0&&(N.position=c,N.val=u(N.index++)),T|=(w>0?1:0)*R,R<<=1;switch(D=T){case 0:for(T=0,M=Math.pow(2,8),R=1;R!=M;)w=N.val&N.position,N.position>>=1,N.position==0&&(N.position=c,N.val=u(N.index++)),T|=(w>0?1:0)*R,R<<=1;p[m++]=t(T),D=m-1,f--;break;case 1:for(T=0,M=Math.pow(2,16),R=1;R!=M;)w=N.val&N.position,N.position>>=1,N.position==0&&(N.position=c,N.val=u(N.index++)),T|=(w>0?1:0)*R,R<<=1;p[m++]=t(T),D=m-1,f--;break;case 2:return S.join("")}if(f==0&&(f=Math.pow(2,v),v++),p[D])b=p[D];else if(D===m)b=E+E.charAt(0);else return null;S.push(b),p[m++]=E+b.charAt(0),f--,E=b,f==0&&(f=Math.pow(2,v),v++)}}};return a}();r!=null?r.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})}(sv)),sv.exports}var Use=Bse();const r9=ec(Use),MP="web image/vnd.tldraw+png",Hse={"image/png":MP},Gse={[MP]:"image/png"};function Wse(r){return Ws(Hse,r)??null}function Kse(r){return Ws(Gse,r)??r}function Vse(r){return typeof ClipboardItem<"u"&&"supports"in ClipboardItem&&ClipboardItem.supports(r)}function qse(r){const e=Object.entries(r);for(const[t,n]of e)n.catch(s=>console.error(s));return navigator.clipboard.write([new ClipboardItem(r)]).catch(t=>(console.error(t),Promise.all(e.map(async([n,s])=>[n,await s])).then(n=>{const s=Nk(n);return navigator.clipboard.write([new ClipboardItem(s)])})))}async function Yse(r,e,t){var C,E,T;const{elements:n,files:s}=e,o={shapes:[],bindings:[],rootShapeIds:[],assets:[],schema:r.store.schema.serialize()},i=new Map,a=new Map,l=r.getCurrentPageId(),c=new Map,u=[],p=new Set;n.forEach(w=>{if(c.set(w.id,vn()),w.boundElements!==null)for(const M of w.boundElements)M.type==="text"&&p.add(M.id)});let f=VO;for(const w of n){if(p.has(w.id))continue;const M=c.get(w.id),R={id:M,typeName:"shape",parentId:l,index:f,x:w.x,y:w.y,rotation:0,isLocked:w.locked,opacity:Xse(w.opacity),meta:{}};switch(w.angle!==0&&a.set(M,w.angle),w.groupIds&&w.groupIds.length>0?i.has(w.groupIds[0])?(C=i.get(w.groupIds[0]))==null||C.push(M):i.set(w.groupIds[0],[M]):u.push(M),w.type){case"rectangle":case"ellipse":case"diamond":{let D="",N="middle";if(w.boundElements!==null){for(const L of w.boundElements)if(L.type==="text"){const B=n.find(K=>K.id===L.id);B&&(D=B.text,N=roe[B.textAlign])}}const z=w.backgroundColor==="transparent"?w.strokeColor:w.backgroundColor;o.shapes.push({...R,type:"geo",props:{geo:w.type,url:w.link??"",w:w.width,h:w.height,size:Ay[w.strokeWidth]??"draw",color:nf[z]??"black",text:D,align:N,dash:jy(w),fill:ioe(w)}});break}case"freedraw":{o.shapes.push({...R,type:"draw",props:{dash:jy(w),size:Ay[w.strokeWidth],color:nf[w.strokeColor]??"black",segments:[{type:"free",points:w.points.map(([D,N,z=.5])=>({x:D,y:N,z}))}]}});break}case"line":{if(w.points.slice().length<2)break;const N=$f(w.points.length);o.shapes.push({...R,type:"line",props:{dash:jy(w),size:Ay[w.strokeWidth],color:nf[w.strokeColor]??"black",spline:w.roundness?"cubic":"line",points:{...Object.fromEntries(w.points.map(([z,L],B)=>{const K=N[B];return[K,{id:K,index:K,x:z,y:L}]}))}}});break}case"arrow":{let D="";if(w.boundElements!==null){for(const K of w.boundElements)if(K.type==="text"){const O=n.find(U=>U.id===K.id);O&&(D=O.text)}}const N=w.points[0],z=w.points[w.points.length-1],L=c.get((E=w.startBinding)==null?void 0:E.elementId),B=c.get((T=w.endBinding)==null?void 0:T.elementId);o.shapes.push({...R,type:"arrow",props:{text:D,bend:ooe(w,N,z),dash:jy(w),size:Ay[w.strokeWidth]??"m",color:nf[w.strokeColor]??"black",start:{x:N[0],y:N[1]},end:{x:z[0],y:z[1]},arrowheadEnd:lD[w.endArrowhead]??"none",arrowheadStart:lD[w.startArrowhead]??"none"}}),L&&o.bindings.push({id:nu(),typeName:"binding",type:"arrow",fromId:M,toId:L,props:{terminal:"start",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}}),B&&o.bindings.push({id:nu(),typeName:"binding",type:"arrow",fromId:M,toId:B,props:{terminal:"end",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}});break}case"text":{const{size:D,scale:N}=Jse(w.fontSize);o.shapes.push({...R,type:"text",props:{size:D,scale:N,font:Qse[w.fontFamily]??"draw",color:nf[w.strokeColor]??"black",text:w.text,textAlign:soe[w.textAlign]}});break}case"image":{const D=s[w.fileId];if(!D)break;const N=zc.createId();o.assets.push({id:N,typeName:"asset",type:"image",props:{w:w.width,h:w.height,fileSize:D.size,name:w.id??"Untitled",isAnimated:!1,mimeType:D.mimeType,src:D.dataURL},meta:{}}),o.shapes.push({...R,type:"image",props:{w:w.width,h:w.height,assetId:N}})}}f=Za(f)}const m=t??(r.inputs.shiftKey?r.inputs.currentPagePoint:void 0);r.markHistoryStoppingPoint("paste"),r.putContentOntoCurrentPage(o,{point:m,select:!1,preserveIds:!0});for(const w of i.values())if(w.length>1){r.groupShapes(w);const M=r.getShape(w[0]);M!=null&&M.parentId&&Oo(M.parentId)&&u.push(M.parentId)}for(const[w,M]of a)r.select(w),r.rotateShapesBy([w],M);const v=kt(u.map(w=>r.getShape(w))),b=Ve.Common(v.map(w=>r.getShapePageBounds(w))),S=r.getViewportPageBounds().center;r.updateShapes(v.map(w=>{const M={x:(w.x??0)-(b.x+b.w/2),y:(w.y??0)-(b.y+b.h/2)};return{id:w.id,type:w.type,x:S.x+M.x,y:S.y+M.y}})),r.setSelectedShapes(u)}const Xse=r=>{const e=r/100;return e<.2?.1:e<.4?.25:e<.6?.5:e<.8?.75:1},Ay={1:"s",2:"m",3:"l",4:"xl"},Zse={16:"s",20:"m",28:"l",36:"xl"};function Jse(r){const e=Zse[r];return e?{size:e,scale:1}:r<16?{size:"s",scale:r/16}:r>36?{size:"xl",scale:r/36}:{size:"m",scale:1}}const Qse={1:"draw",2:"sans",3:"mono"},eoe={gray:["#f8f9fa","#e9ecef","#ced4da","#868e96","#343a40"],red:["#fff5f5","#ffc9c9","#ff8787","#fa5252","#e03131"],pink:["#fff0f6","#fcc2d7","#f783ac","#e64980","#c2255c"],grape:["#f8f0fc","#eebefa","#da77f2","#be4bdb","#9c36b5"],violet:["#f3f0ff","#d0bfff","#9775fa","#7950f2","#6741d9"],indigo:["#edf2ff","#bac8ff","#748ffc","#4c6ef5","#3b5bdb"],blue:["#e7f5ff","#a5d8ff","#4dabf7","#228be6","#1971c2"],cyan:["#e3fafc","#99e9f2","#3bc9db","#15aabf","#0c8599"],teal:["#e6fcf5","#96f2d7","#38d9a9","#12b886","#099268"],green:["#ebfbee","#b2f2bb","#69db7c","#40c057","#2f9e44"],lime:["#f4fce3","#d8f5a2","#a9e34b","#82c91e","#66a80f"],yellow:["#fff9db","#ffec99","#ffd43b","#fab005","#f08c00"],orange:["#fff4e6","#ffd8a8","#ffa94d","#fd7e14","#e8590c"]};function La(r,e,t){const n=[0,1,2,3,4].map(s=>eoe[r][s]);return Object.fromEntries(n.map((s,o)=>[s,o<3?e:t]))}const nf={...La("gray","grey","black"),...La("red","light-red","red"),...La("pink","light-red","red"),...La("grape","light-violet","violet"),...La("blue","light-blue","blue"),...La("cyan","light-blue","blue"),...La("teal","light-green","green"),...La("green","light-green","green"),...La("yellow","yellow","orange"),...La("orange","yellow","orange"),"#ffffff":"white","#000000":"black"},toe={solid:"draw",dashed:"dashed",dotted:"dotted"},noe={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},roe={left:"start",center:"middle",right:"end"},soe={left:"start",center:"middle",right:"end"},lD={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function ooe(r,e,t){let n=0;if(r.points.length>2){const s=new P(e[0],e[1]),o=new P(t[0],t[1]),i=new P(r.points[1][0],r.points[1][1]),a=P.Sub(o,s),l=P.Per(a),c=P.Med(o,s),u=P.Sub(c,l),p=P.Add(c,l),f=P.NearestPointOnLineSegment(u,p,i,!1);n=P.Dist(f,c),P.Clockwise(f,o,c)&&(n*=-1)}return n}const jy=r=>{let e=toe[r.strokeStyle]??"draw";return e==="draw"&&r.roughness===0&&(e="solid"),e},ioe=r=>r.backgroundColor==="transparent"?"none":noe[r.fillStyle]??"solid";async function aoe(r,e,t,n){const s=e.map(o=>o instanceof File?o:new File([o],"tldrawFile",{type:o.type}));r.markHistoryStoppingPoint("paste"),await r.putExternalContent({type:"files",files:s,point:t,ignoreParent:!1,sources:n})}function loe(r,e,t){const n=r.getSelectionPageBounds();r.markHistoryStoppingPoint("paste"),r.putContentOntoCurrentPage(e,{point:t,select:!0});const s=r.getSelectionPageBounds();n&&s&&(n!=null&&n.collides(s))&&(r.updateInstanceState({isChangingStyle:!0}),r.timers.setTimeout(()=>{r.updateInstanceState({isChangingStyle:!1})},150))}async function WE(r,e,t,n){return r.markHistoryStoppingPoint("paste"),await r.putExternalContent({type:"url",point:t,url:e,sources:n})}const coe=[MP,"image/png","image/jpeg","image/webp","image/svg+xml"];function doe(r){const e=document.implementation.createHTMLDocument("");return e.documentElement.innerHTML=r.trim(),e.body.textContent||e.body.innerText||""}const uoe=r=>{try{const e=new URL(r);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}},hoe=r=>{const e=r.split(/[\n\s]/);for(const t of e)try{const n=new URL(t);if(!(n.protocol==="http:"||n.protocol==="https:"))return}catch{return}return q5(e)},poe=r=>/^<svg/.test(r),foe=["input","select","textarea"];function yC(r){const{activeElement:e}=document;return r.menus.hasAnyOpenMenus()||e&&(e.getAttribute("contenteditable")||foe.indexOf(e.tagName.toLowerCase())>-1)}const Ry=(r,e,t,n)=>{const s=hoe(e);if(s)for(const o of s)WE(r,o,t);else uoe(e)?WE(r,e,t):poe(e)?(r.markHistoryStoppingPoint("paste"),r.putExternalContent({type:"svg-text",text:e,point:t,sources:n})):(r.markHistoryStoppingPoint("paste"),r.putExternalContent({type:"text",text:e,point:t,sources:n}))},goe=async(r,e,t)=>{if(r.getEditingShapeId()!==null)return;if(!e)throw Error("No clipboard data");const n=[];for(const s of Object.values(e.items))switch(s.kind){case"file":{n.push({type:"file",source:new Promise(o=>o(s.getAsFile()))});break}case"string":{s.type==="text/html"?n.push({type:"html",source:new Promise(o=>s.getAsString(o))}):s.type==="text/plain"?n.push({type:"text",source:new Promise(o=>s.getAsString(o))}):n.push({type:s.type,source:new Promise(o=>s.getAsString(o))});break}}o9(r,n,t)},s9=async(r,e,t)=>{const n=[];for(const s of e){for(const o of coe)if(s.types.includes(o)){const i=s.getType(o).then(a=>aa.rewriteMimeType(a,Kse(o)));n.push({type:"blob",source:i});break}s.types.includes("text/html")&&n.push({type:"html",source:(async()=>{const o=await s.getType("text/html");return await aa.blobToText(o)})()}),s.types.includes("text/uri-list")&&n.push({type:"url",source:(async()=>{const o=await s.getType("text/uri-list");return await aa.blobToText(o)})()}),s.types.includes("text/plain")&&n.push({type:"text",source:(async()=>{const o=await s.getType("text/plain");return await aa.blobToText(o)})()})}return await o9(r,n,t)};async function o9(r,e,t){const n=e.filter(o=>(o.type==="file"||o.type==="blob")&&o.source!==null);if(n.length){if(n.length>r.options.maxFilesAtOnce)throw Error("Too many files");const o=kt(await Promise.all(n.map(i=>i.source)));return await aoe(r,o,t)}const s=await Promise.all(e.filter(o=>o.type!=="file").map(o=>new Promise(i=>{const a=o;if(a.type==="file"){i({type:"error",data:null,reason:"unexpected file"});return}a.source.then(l=>{var u;const c=(u=l.match(/<div data-tldraw[^>]*>(.*)<\/div>/))==null?void 0:u[1];if(c)try{const p=r9.decompressFromBase64(c);if(p===null){i({type:"error",data:p,reason:"found tldraw data comment but could not parse base64"});return}else{const f=JSON.parse(p);if(f.type!=="application/tldraw"&&i({type:"error",data:f,reason:`found tldraw data comment but JSON was of a different type: ${f.type}`}),typeof f.data=="string"){i({type:"error",data:f,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}i({type:"tldraw",data:f.data});return}}catch{i({type:"error",data:c,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if(a.type==="html"){i({type:"text",data:l,subtype:"html"});return}if(a.type==="url"){i({type:"text",data:l,subtype:"url"});return}try{const p=JSON.parse(l);if(p.type==="excalidraw/clipboard"){i({type:"excalidraw",data:p});return}else{i({type:"text",data:l,subtype:"json"});return}}catch{i({type:"text",data:l,subtype:"text"});return}}i({type:"error",data:l,reason:"unhandled case"})})})));for(const o of s)if(o.type==="tldraw"){loe(r,o.data,t);return}for(const o of s)if(o.type==="excalidraw"){Yse(r,o.data,t);return}for(const o of s){if(o.type==="text"&&o.subtype==="html"){const a=new DOMParser().parseFromString(o.data,"text/html").querySelector("body");if(a&&Array.from(a.children).filter(c=>c.nodeType===1).length===1&&a.firstElementChild&&a.firstElementChild.tagName==="A"&&a.firstElementChild.hasAttribute("href")&&a.firstElementChild.getAttribute("href")!==""){const c=a.firstElementChild.getAttribute("href");Ry(r,c,t,s);return}if(!s.some(c=>c.type==="text"&&c.subtype!=="html")&&o.data.trim()){Ry(r,doe(o.data),t,s);return}}if(o.type==="text"&&o.subtype==="text"&&o.data.startsWith("<iframe ")){const a=new DOMParser().parseFromString(o.data,"text/html").querySelector("body");if(a&&Array.from(a.children).filter(c=>c.nodeType===1).length===1&&a.firstElementChild&&a.firstElementChild.tagName==="IFRAME"&&a.firstElementChild.hasAttribute("src")&&a.firstElementChild.getAttribute("src")!==""){const c=a.firstElementChild.getAttribute("src");Ry(r,c,t,s);return}}}for(const o of s)if(o.type==="text"&&o.subtype==="url"){WE(r,o.data,t,s);return}for(const o of s)if(o.type==="text"&&o.subtype==="text"&&o.data.trim()){Ry(r,o.data,t,s);return}}const d0=async r=>{var n;const e=await r.resolveAssetsInContent(r.getContentFromCurrentPage(r.getSelectedShapeIds()));if(!e){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}const t=r9.compressToBase64(JSON.stringify({type:"application/tldraw",kind:"content",data:e}));if(!(typeof navigator>"u")){const s=e.shapes.map(o=>r.getShapeUtil(o).getText(o)).filter(aG);if((n=navigator.clipboard)!=null&&n.write){const o=new Blob([`<div data-tldraw>${t}</div>`],{type:"text/html"});let i=s.join(" ");i===""&&(i=" "),navigator.clipboard.write([new ClipboardItem({"text/html":o,"text/plain":new Blob([i],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<div data-tldraw>${t}</div>`)}};function moe(){const r=ue(),e=ws(),t=I.useCallback(async function(i){r.getSelectedShapeIds().length!==0&&(await d0(r),e("copy",{source:i}))},[r,e]),n=I.useCallback(async function(i){r.getSelectedShapeIds().length!==0&&(await d0(r),r.deleteShapes(r.getSelectedShapeIds()),e("cut",{source:i}))},[r,e]),s=I.useCallback(async function(i,a,l){r.getEditingShapeId()===null&&(Array.isArray(i)&&i[0]instanceof ClipboardItem?(s9(r,i,l),e("paste",{source:"menu"})):navigator.clipboard.read().then(c=>{s(c,a,l)}))},[r,e]);return{copy:t,cut:n,paste:s}}function yoe(){const r=ue(),e=ws(),t=ye("editor.isFocused",()=>r.getInstanceState().isFocused,[r]);I.useEffect(()=>{if(!t)return;const n=async l=>{r.getSelectedShapeIds().length===0||r.getEditingShapeId()!==null||yC(r)||(Ot(l),await d0(r),e("copy",{source:"kbd"}))};async function s(l){r.getSelectedShapeIds().length===0||r.getEditingShapeId()!==null||yC(r)||(Ot(l),await d0(r),r.deleteShapes(r.getSelectedShapeIds()),e("cut",{source:"kbd"}))}let o=!1;const i=l=>{l.button===1&&(o=!0,r.timers.requestAnimationFrame(()=>{o=!1}))},a=l=>{var f;if(o){Ar(l);return}if(r.getEditingShapeId()!==null||yC(r))return;let c,u=!1;r.inputs.shiftKey&&(u=!0),r.user.getIsPasteAtCursorMode()&&(u=!u),u&&(c=r.inputs.currentPagePoint);const p=()=>{l.clipboardData&&goe(r,l.clipboardData,c)};(f=navigator.clipboard)!=null&&f.read?navigator.clipboard.read().then(m=>{Array.isArray(m)&&m[0]instanceof ClipboardItem&&s9(r,m,c)},()=>{p()}):p(),Ot(l),e("paste",{source:"kbd"})};return document.addEventListener("copy",n),document.addEventListener("cut",s),document.addEventListener("paste",a),document.addEventListener("pointerup",i),()=>{document.removeEventListener("copy",n),document.removeEventListener("cut",s),document.removeEventListener("paste",a),document.removeEventListener("pointerup",i)}},[r,e,t])}/*!
 * canvas-size
 * v1.2.6
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function voe(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var n,s,o,i,a=[],l=!0,c=!1;try{if(o=(t=t.call(r)).next,e===0){if(Object(t)!==t)return;l=!1}else for(;!(l=(n=o.call(t)).done)&&(a.push(n.value),a.length!==e);l=!0);}catch(u){c=!0,s=u}finally{try{if(!l&&t.return!=null&&(i=t.return(),Object(i)!==i))return}finally{if(c)throw s}}return a}}function cD(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,n)}return t}function Qo(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?cD(Object(t),!0).forEach(function(n){boe(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):cD(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function boe(r,e,t){return e=_oe(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Soe(r,e){if(r==null)return{};var t={},n=Object.keys(r),s,o;for(o=0;o<n.length;o++)s=n[o],!(e.indexOf(s)>=0)&&(t[s]=r[s]);return t}function xoe(r,e){if(r==null)return{};var t=Soe(r,e),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(s=0;s<o.length;s++)n=o[s],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(t[n]=r[n])}return t}function dD(r,e){return Coe(r)||voe(r,e)||i9(r,e)||Poe()}function Dy(r){return woe(r)||Eoe(r)||i9(r)||koe()}function woe(r){if(Array.isArray(r))return KE(r)}function Coe(r){if(Array.isArray(r))return r}function Eoe(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function i9(r,e){if(r){if(typeof r=="string")return KE(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return KE(r,e)}}function KE(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function koe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Poe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ioe(r,e){if(typeof r!="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function _oe(r){var e=Ioe(r,"string");return typeof e=="symbol"?e:String(e)}function Mf(r){var e=r.sizes.shift(),t=Math.max(Math.ceil(e[0]),1),n=Math.max(Math.ceil(e[1]),1),s=[t-1,n-1,1,1],o=Date.now(),i=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,a,l;i?(a=new OffscreenCanvas(1,1),l=new OffscreenCanvas(t,n)):(a=document.createElement("canvas"),a.width=1,a.height=1,l=document.createElement("canvas"),l.width=t,l.height=n);var c=a.getContext("2d"),u=l.getContext("2d");u&&(u.fillRect.apply(u,s),c.drawImage(l,t-1,n-1,1,1,0,0,1,1));var p=c&&c.getImageData(0,0,1,1).data[3]!==0,f=Date.now()-o;return[a,l].forEach(function(m){m.height=0,m.width=0}),i?(postMessage({width:t,height:n,benchmark:f,isTestPass:p}),!p&&r.sizes.length&&Mf(r)):p?r.onSuccess(t,n,f):(r.onError(t,n,f),r.sizes.length&&Mf(r)),p}var vC={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},Toe=["onError","onSuccess"],bh={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},rf={};function bC(r){var e=r.width===r.height,t=r.height===1,n=r.width===1,s=[];if(!r.width||!r.height)r.sizes.forEach(function(u){var p=e||t?u:1,f=e||n?u:1;s.push([p,f])});else for(var o=r.min||bh.min,i=r.step||bh.step,a=Math.max(r.width,r.height);a>=o;){var l=e||t?a:1,c=e||n?a:1;s.push([l,c]),a-=i}return s}function Oy(r){var e=window&&"HTMLCanvasElement"in window,t=window&&"OffscreenCanvas"in window,n=Date.now(),s=r.onError,o=r.onSuccess,i=xoe(r,Toe),a=null;if(!e)return!1;if(r.useWorker&&t){var l=`
            var canvasTest = `.concat(Mf.toString(),`;
            onmessage = function(e) {
                canvasTest(e.data);
            };
        `),c=new Blob([l],{type:"application/javascript"}),u=URL.createObjectURL(c);a=new Worker(u),URL.revokeObjectURL(u),a.onmessage=function(p){var f=p.data,m=f.width,v=f.height,b=f.benchmark,S=f.isTestPass;S?(rf[n].onSuccess(m,v,b),delete rf[n]):rf[n].onError(m,v,b)}}if(r.usePromise)return new Promise(function(p,f){var m=Qo(Qo({},r),{},{onError:function(C,E,T){var w;if(r.sizes.length===0)w=!0;else{var M=r.sizes.slice(-1),R=dD(M,1),D=dD(R[0],2),N=D[0],z=D[1];w=C===N&&E===z}s(C,E,T),w&&f({width:C,height:E,benchmark:T})},onSuccess:function(C,E,T){o(C,E,T),p({width:C,height:E,benchmark:T})}});if(a){var v=m.onError,b=m.onSuccess;rf[n]={onError:v,onSuccess:b},a.postMessage(i)}else Mf(m)});if(a)rf[n]={onError:s,onSuccess:o},a.postMessage(i);else return Mf(r)}var SC={maxArea:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=bC({width:e.max,height:e.max,min:e.min,step:e.step,sizes:Dy(vC.area)}),n=Qo(Qo(Qo({},bh),e),{},{sizes:t});return Oy(n)},maxHeight:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=bC({width:1,height:e.max,min:e.min,step:e.step,sizes:Dy(vC.height)}),n=Qo(Qo(Qo({},bh),e),{},{sizes:t});return Oy(n)},maxWidth:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=bC({width:e.max,height:1,min:e.min,step:e.step,sizes:Dy(vC.width)}),n=Qo(Qo(Qo({},bh),e),{},{sizes:t});return Oy(n)},test:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Qo(Qo({},bh),e);return t.sizes=Dy(t.sizes),t.width&&t.height&&(t.sizes=[[t.width,t.height]]),Oy(t)}};let xC=null;function Moe(){return xC||(xC=Aoe()),xC}async function Aoe(){const r=await SC.maxWidth({usePromise:!0}),e=await SC.maxHeight({usePromise:!0}),t=await SC.maxArea({usePromise:!0});return{maxWidth:r.width,maxHeight:e.height,maxArea:t.width*t.height}}const uD=8192,joe=4096*4096;async function Roe(r,e){if(r<=uD&&e<=uD&&r*e<=joe)return[r,e];const{maxWidth:t,maxHeight:n,maxArea:s}=await Moe(),o=r/e;if(r>t&&(r=t,e=r/o),e>n&&(e=n,r=e*o),r*e>s){const i=Math.sqrt(s/(r*e));r*=i,e*=i}return[r,e]}async function a9(r,e,t){const{type:n,width:s,height:o,quality:i=1,pixelRatio:a=2}=t;let[l,c]=await Roe(s*a,o*a);l=Math.floor(l),c=Math.floor(c);const u=l/s,p=await aa.blobToDataUrl(new Blob([e],{type:"image/svg+xml"})),f=await new Promise(v=>{const b=Ff();b.crossOrigin="anonymous",b.onload=async()=>{Rn.isSafari&&await sE(250);const S=document.createElement("canvas"),C=S.getContext("2d");S.width=l,S.height=c,C.imageSmoothingEnabled=!0,C.imageSmoothingQuality="high",C.drawImage(b,0,0,l,c),URL.revokeObjectURL(p),v(S)},b.onerror=()=>{v(null)},b.src=p});if(!f)return null;const m=await new Promise(v=>f.toBlob(b=>{(!b||_r.throwToBlob.get())&&v(null),v(b)},"image/"+n,i));if(!m)return null;if(n==="png"){const v=new DataView(await m.arrayBuffer());return qa.setPhysChunk(v,u,{type:"image/"+n})}else return m}async function l9(r,e,t){const n=await r.getSvgString(e!=null&&e.length?e:[...r.getCurrentPageShapeIds()],{scale:t.scale??1,background:r.getInstanceState().exportBackground,...t});if(!n)throw new Error("Could not construct SVG.");return n}async function VE(r,e,t,n={}){var s;switch(t){case"svg":return(s=await l9(r,e,n))==null?void 0:s.svg;case"json":{const o=await r.resolveAssetsInContent(r.getContentFromCurrentPage(e));return JSON.stringify(o)}default:rs(t)}}async function c9({editor:r,ids:e,format:t,opts:n={}}){switch(t){case"svg":return new Blob([await VE(r,e,"svg",n)],{type:"text/plain"});case"json":return new Blob([await VE(r,e,"json",n)],{type:"text/plain"});case"jpeg":case"png":case"webp":{const s=await l9(r,e,n);if(!s)throw new Error("Could not construct image.");const o=await a9(r,s.svg,{type:t,quality:n.quality,pixelRatio:n.pixelRatio,width:s.width,height:s.height});if(!o)throw new Error("Could not construct image.");return o}default:rs(t)}}const Doe={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",json:"text/plain",svg:"text/plain"};function Ooe(r,e,t,n={}){return{blobPromise:c9({editor:r,ids:e,format:t,opts:n}),mimeType:Doe[t]}}function Loe(r,e,t="svg",n={}){if(!navigator.clipboard)return Promise.reject(new Error("Copy not supported"));if(navigator.clipboard.write){const{blobPromise:s,mimeType:o}=Ooe(r,e,t,n),i={[o]:s},a=Wse(o);return a&&Vse(a)&&(i[a]=s.then(l=>aa.rewriteMimeType(l,a))),qse(i)}switch(t){case"json":case"svg":return Noe(async()=>VE(r,e,t,n));case"jpeg":case"png":throw new Error("Copy not supported");default:rs(t)}}async function Noe(r){var e,t;await((t=(e=navigator.clipboard)==null?void 0:e.writeText)==null?void 0:t.call(e,await r()))}function Foe(){const r=ue(),{addToast:e}=sc(),t=Wt();return I.useCallback((n,s="svg")=>{Loe(r,n,s).catch(()=>{e({id:"copy-fail",severity:"warning",title:t("toast.error.copy-fail.title"),description:t("toast.error.copy-fail.desc")})})},[r,e,t])}async function zoe(r,e,t="png",n,s={}){if(!n&&(n=`shapes at ${hD()}`,e.length===1)){const a=r.getShape(e[0]);r.isShapeOfType(a,"frame")?n=a.props.name||"frame":n=`${Q0(a.id)} at ${hD()}`}n+=`.${t}`;const o=await c9({editor:r,ids:e,format:t,opts:s}),i=new File([o],n,{type:o.type});$oe(i)}function hD(){const r=new Date,e=String(r.getFullYear()).slice(2),t=String(r.getMonth()+1).padStart(2,"0"),n=String(r.getDate()).padStart(2,"0"),s=String(r.getHours()).padStart(2,"0"),o=String(r.getMinutes()).padStart(2,"0"),i=String(r.getSeconds()).padStart(2,"0");return`${e}-${t}-${n} ${s}.${o}.${i}`}function $oe(r){const e=document.createElement("a"),t=URL.createObjectURL(r);e.href=t,e.download=r.name,e.click(),URL.revokeObjectURL(t)}function Boe(){const r=ue(),{addToast:e}=sc(),t=Wt();return I.useCallback((n,s="png",o)=>{zoe(r,n,s,o,{scale:1,background:r.getInstanceState().exportBackground}).catch(i=>{console.error(i.message),e({id:"export-fail",title:t("toast.error.export-fail.title"),description:t("toast.error.export-fail.desc"),severity:"error"})})},[r,e,t])}const d9=Ht.createContext([]);function Uoe(){const r=ue(),e=I.useRef(),t=Bc(Ht.useContext(d9));return I.useEffect(()=>{const n=window.document.createElement("input");n.type="file",n.accept=(t==null?void 0:t.join(","))??LH,n.multiple=!0,e.current=n;async function s(o){const i=o.target.files;!i||i.length===0||(r.markHistoryStoppingPoint("insert media"),await r.putExternalContent({type:"files",files:Array.from(i),point:r.getViewportPageBounds().center,ignoreParent:!1}),n.value="")}return n.addEventListener("change",s),()=>{e.current=void 0,n.removeEventListener("change",s)}},[r,t]),I.useCallback(()=>{var n;(n=e.current)==null||n.click()},[e])}function Hoe(){const r=ue(),e=I.useRef(null),t=I.useRef(null);return I.useCallback(async function(){const s=document.createElement("div"),o=document.createElement("style"),i=(C,E)=>{C&&(C.innerHTML=""),E&&document.head.contains(E)&&document.head.removeChild(E),C&&document.body.contains(C)&&document.body.removeChild(C)};i(e.current,t.current),e.current=s,t.current=o;const a=`tl-print-surface-${Cn()}`;s.className=a,o.innerHTML=`
			.${a} {
				display: none;
			}

			.${a} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${a} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${a}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${a}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${a}__item__header {
					display: none;
				}

				.${a}__item__footer {
					display: none;
					text-align: right;
				}

				.${a}__item__footer__hide {
					display: none;
				}

				
			}

		`;const l=()=>{document.head.appendChild(o),document.body.appendChild(s)},c=()=>{r.once("tick",()=>{i(s,o)})};window.addEventListener("beforeprint",l),window.addEventListener("afterprint",c);function u(C,E,T){try{s.innerHTML+=`<div class="${a}__item">
        <div class="${a}__item__header">
          ${C.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${a}__item__main">
          ${T}
        </div>
        <div class="${a}__item__footer ${a}__item__footer__${E?"":"hide"}">
          ${E??""}
        </div>
      </div>`}catch(w){console.error(w)}}function p(){Rn.isChromeForIos?(l(),window.print()):Rn.isSafari?(l(),document.execCommand("print",!1)):window.print()}const f=r.getSelectedShapeIds(),m=r.getCurrentPageId(),v=r.getPages(),S={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(r.getSelectedShapeIds().length>0){const C=await r.getSvgString(f,S);if(C){const E=v.find(T=>T.id===m);u(`tldraw — ${E==null?void 0:E.name}`,null,C.svg),p()}}else{const C=r.getCurrentPage(),E=await r.getSvgString(r.getSortedChildIdsForParent(C.id),S);E&&(u(`tldraw — ${C.name}`,null,E.svg),p())}window.removeEventListener("beforeprint",l),window.removeEventListener("afterprint",c)},[r])}function AP(){const{addToast:r,removeToast:e,clearToasts:t}=sc(),{addDialog:n,clearDialogs:s,removeDialog:o}=tm(),i=Wt(),a=Uoe(),l=Hoe(),{cut:c,copy:u,paste:p}=moe(),f=Foe(),m=Boe(),v=kP(),S=po()<yr.TABLET_SM;return I.useMemo(()=>({addToast:r,removeToast:e,clearToasts:t,addDialog:n,removeDialog:o,clearDialogs:s,msg:i,isMobile:S,insertMedia:a,printSelectionOrPages:l,cut:c,copy:u,paste:p,copyAs:f,exportAs:m,getEmbedDefinition:v}),[r,e,t,n,o,s,i,S,a,l,c,u,p,f,m,v])}function Goe(r,e){const t={};for(const n of r)if(n.translations)for(const[s,o]of Ho(n.translations)){let i=t[s];i||(i=t[s]={}),Object.assign(i,o)}return{actions:(n,s,o)=>{for(const i of r)i.actions&&(s=i.actions(n,s,o));return s},tools:(n,s,o)=>{for(const i of r)i.tools&&(s=i.tools(n,s,{...e,...o}));return s},translations:t}}function u9(r){return I.useMemo(()=>r,r)}function Woe(r){const e=u9(r==null?[]:Array.isArray(r)?r:[r]);return I.useMemo(()=>{const t={};for(const n of e)if(n.translations)for(const[s,o]of Ho(n.translations)){let i=t[s];i||(i=t[s]={}),Object.assign(i,o)}return t},[e])}function Koe(r){const e=AP(),t=u9(r==null?[]:Array.isArray(r)?r:[r]);return I.useMemo(()=>Goe(t,e),[t,e])}const h9=I.createContext(null);function Voe(r){return Object.fromEntries(r.map(e=>[e.id,e]))}function ch(r,e){if(r.getSelectedShapes().length===0)return r.getDocumentSettings().name||e}function qoe({overrides:r,children:e}){const t=ue(),n=Rb(),s=AP(),o=ws(),i=s.msg("document.default-name"),a=I.useMemo(()=>{function l(){return t.isIn("select")||(t.complete(),t.setCurrentTool("select")),!1}function c(){return t.isIn("select")&&t.getSelectedShapeIds().length>0}const u=[{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(f){c()&&(l()||(o("edit-link",{source:f}),t.markHistoryStoppingPoint("edit-link"),s.addDialog({component:ise})))}},{id:"insert-embed",label:"action.insert-embed",kbd:"$i",onSelect(f){o("insert-embed",{source:f}),s.addDialog({component:$F})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",onSelect(f){o("insert-media",{source:f}),s.insertMedia()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",onSelect(f){o("undo",{source:f}),t.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",onSelect(f){o("redo",{source:f}),t.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(f){let m=t.getSelectedShapeIds();m.length===0&&(m=Array.from(t.getCurrentPageShapeIds().values())),m.length!==0&&(o("export-as",{format:"svg",source:f}),s.exportAs(m,"svg",ch(t,i)))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(f){let m=t.getSelectedShapeIds();m.length===0&&(m=Array.from(t.getCurrentPageShapeIds().values())),m.length!==0&&(o("export-as",{format:"png",source:f}),s.exportAs(m,"png",ch(t,i)))}},{id:"export-as-json",label:{default:"action.export-as-json",menu:"action.export-as-json.short","context-menu":"action.export-as-json.short"},readonlyOk:!0,onSelect(f){let m=t.getSelectedShapeIds();m.length===0&&(m=Array.from(t.getCurrentPageShapeIds().values())),m.length!==0&&(o("export-as",{format:"json",source:f}),s.exportAs(m,"json",ch(t,i)))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(f){let m=t.getSelectedShapeIds();m.length===0&&(m=Array.from(t.getCurrentPageShapeIds().values())),m.length!==0&&(o("export-all-as",{format:"svg",source:f}),s.exportAs(Array.from(t.getCurrentPageShapeIds()),"svg",ch(t,i)))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(f){const m=Array.from(t.getCurrentPageShapeIds().values());m.length!==0&&(o("export-all-as",{format:"png",source:f}),s.exportAs(m,"png",ch(t,i)))}},{id:"export-all-as-json",label:{default:"action.export-all-as-json",menu:"action.export-all-as-json.short","context-menu":"action.export-all-as-json.short"},readonlyOk:!0,onSelect(f){const m=Array.from(t.getCurrentPageShapeIds().values());m.length!==0&&(o("export-all-as",{format:"json",source:f}),s.exportAs(m,"json",ch(t,i)))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"$!c",readonlyOk:!0,onSelect(f){let m=t.getSelectedShapeIds();m.length===0&&(m=Array.from(t.getCurrentPageShapeIds().values())),m.length!==0&&(o("copy-as",{format:"svg",source:f}),s.copyAs(m,"svg"))}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(f){let m=t.getSelectedShapeIds();m.length===0&&(m=Array.from(t.getCurrentPageShapeIds().values())),m.length!==0&&(o("copy-as",{format:"png",source:f}),s.copyAs(m,"png"))}},{id:"copy-as-json",label:{default:"action.copy-as-json",menu:"action.copy-as-json.short","context-menu":"action.copy-as-json.short"},readonlyOk:!0,onSelect(f){let m=t.getSelectedShapeIds();m.length===0&&(m=Array.from(t.getCurrentPageShapeIds().values())),m.length!==0&&(o("copy-as",{format:"json",source:f}),s.copyAs(m,"json"))}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(f){if(!c()||l())return;o("toggle-auto-size",{source:f}),t.markHistoryStoppingPoint("toggling auto size");const m=t.getSelectedShapes().filter(v=>t.isShapeOfType(v,"text")&&v.props.autoSize===!1);t.updateShapes(m.map(v=>({id:v.id,type:v.type,props:{...v.props,w:8,autoSize:!0}}))),zn(t,m.map(v=>v.id))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(f){o("open-embed-link",{source:f});const m=t.getSelectedShapeIds(),v="No embed shapes selected";if(m.length!==1){console.error(v);return}const b=t.getShape(m[0]);if(!b||!t.isShapeOfType(b,"embed")){console.error(v);return}PQ(b.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(f){var m,v;if(((m=t.root.getCurrent())==null?void 0:m.id)!=="zoom"&&(o("zoom-tool",{source:f}),!(t.inputs.shiftKey||t.inputs.ctrlKey))){const b=t.root.getCurrent();b&&((v=b.getCurrent())==null?void 0:v.id)==="idle"&&t.setCurrentTool("zoom",{onInteractionEnd:b.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",onSelect(f){c()&&(l()||t.run(()=>{o("convert-to-bookmark",{source:f});const m=t.getSelectedShapes(),v=[],b=[];for(const S of m){if(!S||!t.isShapeOfType(S,"embed")||!S.props.url)continue;const C=new P(S.x,S.y);C.rot(-S.rotation),C.add(new P(S.props.w/2-300/2,S.props.h/2-320/2)),C.rot(S.rotation);const E={id:vn(),type:"bookmark",rotation:S.rotation,x:C.x,y:C.y,opacity:1,props:{url:S.props.url}};v.push(E),b.push(S.id)}t.markHistoryStoppingPoint("convert shapes to bookmark"),t.deleteShapes(b),t.createShapes(v)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(f){c()&&(l()||(o("convert-to-embed",{source:f}),t.run(()=>{const m=t.getSelectedShapeIds(),v=kt(m.map(C=>t.getShape(C))),b=[],S=[];for(const C of v){if(!t.isShapeOfType(C,"bookmark"))continue;const{url:E}=C.props,T=s.getEmbedDefinition(E);if(!T||!T.definition)continue;const{width:w,height:M}=T.definition,R=new P(C.x,C.y);R.rot(-C.rotation),R.add(new P(C.props.w/2-w/2,C.props.h/2-M/2)),R.rot(C.rotation);const D={id:vn(),type:"embed",x:R.x,y:R.y,rotation:C.rotation,props:{url:E,w,h:M}};b.push(D),S.push(C.id)}t.markHistoryStoppingPoint("convert shapes to embed"),t.deleteShapes(S),t.createShapes(b)})))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",onSelect(f){if(!c()||l())return;o("duplicate-shapes",{source:f});const m=t.getInstanceState();let v,b;if(m.duplicateProps)v=m.duplicateProps.shapeIds,b=m.duplicateProps.offset;else{v=t.getSelectedShapeIds();const S=Ve.Common(kt(v.map(C=>t.getShapePageBounds(C))));b=t.getCameraOptions().isLocked?{x:t.options.adjacentShapeMargin,y:t.options.adjacentShapeMargin}:{x:S.width+t.options.adjacentShapeMargin,y:0}}t.markHistoryStoppingPoint("duplicate shapes"),t.duplicateShapes(v,b),m.duplicateProps&&t.updateInstanceState({duplicateProps:{...m.duplicateProps,shapeIds:t.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",onSelect(f){c()&&(l()||(o("ungroup-shapes",{source:f}),t.markHistoryStoppingPoint("ungroup"),t.ungroupShapes(t.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",onSelect(f){if(!c()||l())return;o("group-shapes",{source:f});const m=t.getOnlySelectedShape();m&&t.isShapeOfType(m,"group")?(t.markHistoryStoppingPoint("ungroup"),t.ungroupShapes(t.getSelectedShapeIds())):(t.markHistoryStoppingPoint("group"),t.groupShapes(t.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",onSelect(f){if(!c())return;o("remove-frame",{source:f});const m=t.getSelectedShapes();m.length>0&&m.every(v=>t.isShapeOfType(v,"frame"))&&(t.markHistoryStoppingPoint("remove-frame"),zre(t,m.map(v=>v.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(f){if(!c())return;o("fit-frame-to-content",{source:f});const m=t.getOnlySelectedShape();m&&t.isShapeOfType(m,"frame")&&(t.markHistoryStoppingPoint("fit-frame-to-content"),Bre(t,m.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",onSelect(f){if(!c()||l())return;o("align-shapes",{operation:"left",source:f}),t.markHistoryStoppingPoint("align left");const m=t.getSelectedShapeIds();t.alignShapes(m,"left"),zn(t,m)}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"?H",icon:"align-center-horizontal",onSelect(f){if(!c()||l())return;o("align-shapes",{operation:"center-horizontal",source:f}),t.markHistoryStoppingPoint("align center horizontal");const m=t.getSelectedShapeIds();t.alignShapes(m,"center-horizontal"),zn(t,m)}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",onSelect(f){if(!c()||l())return;o("align-shapes",{operation:"right",source:f}),t.markHistoryStoppingPoint("align right");const m=t.getSelectedShapeIds();t.alignShapes(m,"right"),zn(t,m)}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"?V",icon:"align-center-vertical",onSelect(f){if(!c()||l())return;o("align-shapes",{operation:"center-vertical",source:f}),t.markHistoryStoppingPoint("align center vertical");const m=t.getSelectedShapeIds();t.alignShapes(m,"center-vertical"),zn(t,m)}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",onSelect(f){if(!c()||l())return;o("align-shapes",{operation:"top",source:f}),t.markHistoryStoppingPoint("align top");const m=t.getSelectedShapeIds();t.alignShapes(m,"top"),zn(t,m)}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",onSelect(f){if(!c()||l())return;o("align-shapes",{operation:"bottom",source:f}),t.markHistoryStoppingPoint("align bottom");const m=t.getSelectedShapeIds();t.alignShapes(m,"bottom"),zn(t,m)}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"?!h",onSelect(f){if(!c()||l())return;o("distribute-shapes",{operation:"horizontal",source:f}),t.markHistoryStoppingPoint("distribute horizontal");const m=t.getSelectedShapeIds();t.distributeShapes(m,"horizontal"),zn(t,m)}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"?!V",onSelect(f){if(!c()||l())return;o("distribute-shapes",{operation:"vertical",source:f}),t.markHistoryStoppingPoint("distribute vertical");const m=t.getSelectedShapeIds();t.distributeShapes(m,"vertical"),zn(t,m)}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(f){if(!c()||l())return;o("stretch-shapes",{operation:"horizontal",source:f}),t.markHistoryStoppingPoint("stretch horizontal");const m=t.getSelectedShapeIds();t.stretchShapes(m,"horizontal"),zn(t,m)}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(f){if(!c()||l())return;o("stretch-shapes",{operation:"vertical",source:f}),t.markHistoryStoppingPoint("stretch vertical");const m=t.getSelectedShapeIds();t.stretchShapes(m,"vertical"),zn(t,m)}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"!h",onSelect(f){if(!c()||l())return;o("flip-shapes",{operation:"horizontal",source:f}),t.markHistoryStoppingPoint("flip horizontal");const m=t.getSelectedShapeIds();t.flipShapes(m,"horizontal"),zn(t,m)}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"!v",onSelect(f){if(!c()||l())return;o("flip-shapes",{operation:"vertical",source:f}),t.markHistoryStoppingPoint("flip vertical");const m=t.getSelectedShapeIds();t.flipShapes(m,"vertical"),zn(t,m)}},{id:"pack",label:"action.pack",icon:"pack",onSelect(f){if(!c()||l())return;o("pack-shapes",{source:f}),t.markHistoryStoppingPoint("pack");const m=t.getSelectedShapeIds();t.packShapes(m,t.options.adjacentShapeMargin),zn(t,m)}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(f){if(!c()||l())return;o("stack-shapes",{operation:"vertical",source:f}),t.markHistoryStoppingPoint("stack-vertical");const m=t.getSelectedShapeIds();t.stackShapes(m,"vertical",16),zn(t,m)}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(f){if(!c()||l())return;o("stack-shapes",{operation:"horizontal",source:f}),t.markHistoryStoppingPoint("stack-horizontal");const m=t.getSelectedShapeIds();t.stackShapes(m,"horizontal",16),zn(t,m)}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(f){c()&&(l()||(o("reorder-shapes",{operation:"toFront",source:f}),t.markHistoryStoppingPoint("bring to front"),t.bringToFront(t.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",onSelect(f){c()&&(l()||(o("reorder-shapes",{operation:"forward",source:f}),t.markHistoryStoppingPoint("bring forward"),t.bringForward(t.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",onSelect(f){c()&&(l()||(o("reorder-shapes",{operation:"backward",source:f}),t.markHistoryStoppingPoint("send backward"),t.sendBackward(t.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(f){c()&&(l()||(o("reorder-shapes",{operation:"toBack",source:f}),t.markHistoryStoppingPoint("send to back"),t.sendToBack(t.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",onSelect(f){c()&&(l()||(t.markHistoryStoppingPoint("cut"),s.cut(f)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(f){c()&&(l()||s.copy(f))}},{id:"paste",label:"action.paste",kbd:"$v",onSelect(f){var m;(m=navigator.clipboard)==null||m.read().then(v=>{s.paste(v,f,f==="context-menu"?t.inputs.currentPagePoint:void 0)}).catch(()=>{s.addToast({title:s.msg("action.paste-error-title"),description:s.msg("action.paste-error-description"),severity:"error"})})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(f){t.run(()=>{l()||(o("select-all-shapes",{source:f}),t.markHistoryStoppingPoint("select all kbd"),t.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(f){c()&&(l()||(o("select-none-shapes",{source:f}),t.markHistoryStoppingPoint("select none"),t.selectNone()))}},{id:"delete",label:"action.delete",kbd:"⌫,del,backspace",icon:"trash",onSelect(f){c()&&(l()||(o("delete-shapes",{source:f}),t.markHistoryStoppingPoint("delete"),t.deleteShapes(t.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",onSelect(f){if(!c()||l())return;o("rotate-cw",{source:f}),t.markHistoryStoppingPoint("rotate-cw");const m=t.getSelectionRotation()%(Bn/2),v=Jc(m,0)||Jc(m,Bn/2),b=t.getSelectedShapeIds();t.rotateShapesBy(b,Bn/2-(v?0:m)),zn(t,b)}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",onSelect(f){if(!c()||l())return;o("rotate-ccw",{source:f}),t.markHistoryStoppingPoint("rotate-ccw");const m=t.getSelectionRotation()%(Bn/2),v=Jc(m,0),b=t.getSelectedShapeIds();t.rotateShapesBy(b,v?-(Bn/2):-m),zn(t,b)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(f){o("zoom-in",{source:f}),t.zoomIn(void 0,{animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(f){o("zoom-out",{source:f}),t.zoomOut(void 0,{animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(f){o("reset-zoom",{source:f}),t.resetZoom(void 0,{animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(f){o("zoom-to-fit",{source:f}),t.zoomToFit({animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(f){c()&&(l()||(o("zoom-to-selection",{source:f}),t.zoomToSelection({animation:{duration:t.options.animationMediumMs}})))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(f){o("toggle-snap-mode",{source:f}),t.user.updateUserPreferences({isSnapMode:!t.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"$/",readonlyOk:!0,onSelect(f){const m=t.user.getIsDarkMode()?"light":"dark";o("color-scheme",{source:f,value:m}),t.user.updateUserPreferences({colorScheme:m})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(f){o("toggle-wrap-mode",{source:f}),t.user.updateUserPreferences({isWrapMode:!t.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-dynamic-size-mode",label:{default:"action.toggle-dynamic-size-mode",menu:"action.toggle-dynamic-size-mode.menu"},readonlyOk:!1,onSelect(f){o("toggle-dynamic-size-mode",{source:f}),t.user.updateUserPreferences({isDynamicSizeMode:!t.user.getIsDynamicResizeMode()})},checkbox:!0},{id:"toggle-paste-at-cursor",label:{default:"action.toggle-paste-at-cursor",menu:"action.toggle-paste-at-cursor.menu"},readonlyOk:!1,onSelect(f){o("toggle-paste-at-cursor",{source:f}),t.user.updateUserPreferences({isPasteAtCursorMode:!t.user.getIsPasteAtCursorMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(f){o("toggle-reduce-motion",{source:f}),t.user.updateUserPreferences({animationSpeed:t.user.getAnimationSpeed()===0?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(f){o("toggle-edge-scrolling",{source:f}),t.user.updateUserPreferences({edgeScrollSpeed:t.user.getEdgeScrollSpeed()===0?1:0})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(f){o("toggle-transparent",{source:f}),t.updateInstanceState({exportBackground:!t.getInstanceState().exportBackground})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(f){o("toggle-tool-lock",{source:f}),t.updateInstanceState({isToolLocked:!t.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(f){o("unlock-all",{source:f});const m=[];for(const v of t.getCurrentPageShapes())v.isLocked&&m.push({id:v.id,type:v.type,isLocked:!1});m.length>0&&t.updateShapes(m)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(f){t.timers.requestAnimationFrame(()=>{t.run(()=>{o("toggle-focus-mode",{source:f}),s.clearDialogs(),s.clearToasts(),t.updateInstanceState({isFocusMode:!t.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"$'",onSelect(f){o("toggle-grid-mode",{source:f}),t.updateInstanceState({isGridMode:!t.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(f){o("toggle-debug-mode",{source:f}),t.updateInstanceState({isDebugMode:!t.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(f){o("print",{source:f}),s.printSelectionOrPages()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(f){o("exit-pen-mode",{source:f}),t.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(f){o("stop-following",{source:f}),t.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(f){o("zoom-to-content",{source:f});const m=t.getSelectionPageBounds()??t.getCurrentPageBounds();m&&t.zoomToBounds(m,{targetZoom:Math.min(1,t.getZoomLevel()),animation:{duration:220}})}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"!l",onSelect(f){t.markHistoryStoppingPoint("locking"),o("toggle-lock",{source:f}),t.toggleLock(t.getSelectedShapeIds())}},{id:"move-to-new-page",label:"context.pages.new-page",onSelect(f){const m=ui.createId(),v=t.getSelectedShapeIds();t.run(()=>{t.markHistoryStoppingPoint("move_shapes_to_page"),t.createPage({name:s.msg("page-menu.new-page-initial-name"),id:m}),t.moveShapesToPage(v,m)}),o("move-to-new-page",{source:f})}},{id:"select-white-color",label:"color-style.white",kbd:"?t",onSelect(f){const m=di;t.run(()=>{t.markHistoryStoppingPoint("change-color"),t.isIn("select")&&t.setStyleForSelectedShapes(m,"white"),t.setStyleForNextShapes(m,"white")}),o("set-style",{source:f,id:m.id,value:"white"})}},{id:"select-fill-fill",label:"fill-style.fill",kbd:"?f",onSelect(f){const m=du;t.run(()=>{t.markHistoryStoppingPoint("change-fill"),t.isIn("select")&&t.setStyleForSelectedShapes(m,"fill"),t.setStyleForNextShapes(m,"fill")}),o("set-style",{source:f,id:m.id,value:"fill"})}},{id:"flatten-to-image",label:"action.flatten-to-image",kbd:"!f",onSelect:async f=>{const m=t.getSelectedShapeIds();if(m.length===0)return;t.markHistoryStoppingPoint("flattening to image"),o("flatten-to-image",{source:f});const v=await fse(t,m,t.options.flattenImageBoundsExpand);v!=null&&v.length&&t.setSelectedShapes(v)}}];n&&u.push({id:"open-cursor-chat",label:"action.open-cursor-chat",readonlyOk:!0,kbd:"/",onSelect(f){o("open-cursor-chat",{source:f}),!t.getInstanceState().isCoarsePointer&&t.timers.requestAnimationFrame(()=>{t.updateInstanceState({isChatting:!0})})}});const p=Voe(u);return r?r(t,p,s):p},[s,t,o,r,i,n]);return g.jsx(h9.Provider,{value:a,children:e})}function Iu(){const r=I.useContext(h9);if(!r)throw new Error("useTools must be used within a ToolProvider");return r}function Yf(r,e){return r?typeof r=="string"?r:e?r[e]??r.default:void 0:void 0}function gi(){const r=fd();return ye("isReadonlyMode",()=>!!(r!=null&&r.getIsReadonly()),[r])}const Yoe=Rn.isDarwin?"⌘":"Ctrl",Xoe=Rn.isDarwin?"⌥":"Alt";function p9(r){return r===","?[","]:r.split(",")[0].split("").map(e=>{const t=e.replace(/\$/g,Yoe).replace(/\?/g,Xoe).replace(/!/g,"⇧");return t[0].toUpperCase()+t.slice(1)})}function qE(r){return"— "+p9(r).join(" ")}function Af({children:r,visibleOnMobileLayout:e=!1}){const t=po();return!e&&t<yr.MOBILE?null:g.jsx("kbd",{className:"tlui-kbd",children:p9(r).map((n,s)=>g.jsx("span",{children:n},s))})}const f9=I.createContext(null);function Lb(){const r=I.useContext(f9);if(!r)throw new Error("useTldrawUiMenuContext must be used within a TldrawUiMenuContextProvider");return r}function zi({type:r,sourceId:e,children:t}){return g.jsx(f9.Provider,{value:{type:r,sourceId:e},children:t})}function ou({id:r,kbd:e,label:t,readonlyOk:n,onSelect:s,toggle:o=!1,disabled:i=!1,checked:a=!1}){const{type:l,sourceId:c}=Lb(),u=gi(),p=Wt();if(u&&!n)return null;const f=Yf(t,l),m=f?p(f):void 0;switch(l){case"menu":return g.jsxs(Ore,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",title:m,onSelect:v=>{s==null||s(c),Ot(v)},disabled:i,checked:a,children:[g.jsx(hl,{small:!0,icon:o?a?"toggle-on":"toggle-off":a?"check":"none"}),m&&g.jsx("span",{className:"tlui-button__label",draggable:!1,children:m}),e&&g.jsx(Af,{children:e})]});case"context-menu":return g.jsxs(ure,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",title:m,onSelect:v=>{s(c),Ot(v)},disabled:i,checked:a,children:[g.jsx(hl,{small:!0,icon:o?a?"toggle-on":"toggle-off":a?"check":"none"}),m&&g.jsx("span",{className:"tlui-button__label",draggable:!1,children:m}),e&&g.jsx(Af,{children:e})]},r);default:return null}}function oc(r,e){const t=fd(),n=I.useCallback(i=>{i&&(t==null||t.complete()),e==null||e(i)},[t,e]),s=ws(),o=I.useCallback(i=>{s(i,{source:"unknown",id:r})},[r,s]);return vQ(t?`${r}-${t.contextId}`:r,n,o)}function gu({id:r,children:e,modal:t=!1,debugOpen:n=!1}){const[s,o]=oc(r);return g.jsx(gP,{open:n||s,dir:"ltr",modal:t,onOpenChange:o,children:e})}function mu({children:r,...e}){return g.jsx(mP,{dir:"ltr",asChild:!0,onTouchEnd:t=>Ot(t),...e,children:r})}function yu({className:r,side:e="bottom",align:t="start",sideOffset:n=8,alignOffset:s=8,children:o}){const i=Kr();return g.jsx(_b,{container:i,children:g.jsx(yP,{className:it("tlui-menu",r),side:e,sideOffset:n,align:t,alignOffset:s,collisionPadding:4,children:o})})}function Zoe({id:r,children:e}){const[t,n]=oc(r);return g.jsx(Lre,{open:t,onOpenChange:n,children:e})}function Joe({id:r,label:e,title:t,disabled:n}){return g.jsx(Nre,{dir:"ltr",asChild:!0,disabled:n,children:g.jsxs(ut,{"data-testid":r,type:"menu",className:"tlui-menu__submenu__trigger",disabled:n,title:t,children:[g.jsx(Tr,{children:e}),g.jsx($t,{icon:"chevron-right",small:!0})]})})}function Qoe({id:r,alignOffset:e=-1,sideOffset:t=-6,size:n="small",children:s}){const o=Kr();return g.jsx(_b,{container:o,children:g.jsx(Fre,{"data-testid":r,className:"tlui-menu tlui-menu__submenu__content",alignOffset:e,sideOffset:t,collisionPadding:4,"data-size":n,children:s})})}function eie({children:r}){return g.jsx(Rre,{dir:"ltr",className:"tlui-menu__group",children:r})}function Xf({noClose:r,children:e}){return g.jsx(Dre,{dir:"ltr",asChild:!0,onClick:r?Ot:void 0,children:e})}function _t({id:r,label:e,children:t}){const{type:n,sourceId:s}=Lb(),o=Wt(),i=Yf(e,n),a=i?o(i):void 0;switch(n){case"panel":return g.jsx("div",{className:"tlui-menu__group","data-testid":`${s}-group.${r}`,children:t});case"menu":return g.jsx(eie,{"data-testid":`${s}-group.${r}`,children:t});case"context-menu":return g.jsx(rF,{dir:"ltr",className:"tlui-menu__group","data-testid":`${s}-group.${r}`,children:t});case"keyboard-shortcuts":return g.jsxs("div",{className:"tlui-shortcuts-dialog__group","data-testid":`${s}-group.${r}`,children:[g.jsx("h2",{className:"tlui-shortcuts-dialog__group__title",children:a}),g.jsx("div",{className:"tlui-shortcuts-dialog__group__content",children:t})]});default:return t}}function Vo({id:r,disabled:e=!1,label:t,size:n="small",children:s}){const{type:o,sourceId:i}=Lb(),a=Kr(),l=Wt(),c=t?typeof t=="string"?t:t[o]??t.default:void 0,u=c?l(c):void 0;switch(o){case"menu":return g.jsxs(Zoe,{id:`${i}-sub.${r}`,children:[g.jsx(Joe,{id:`${i}-sub.${r}-button`,disabled:e,label:u,title:u}),g.jsx(Qoe,{id:`${i}-sub.${r}-content`,size:n,children:s})]});case"context-menu":return e?null:g.jsxs(tie,{id:`${i}-sub.${r}`,children:[g.jsx(aF,{dir:"ltr",disabled:e,asChild:!0,children:g.jsxs(ut,{"data-testid":`${i}-sub.${r}-button`,type:"menu",className:"tlui-menu__submenu__trigger",children:[g.jsx(Tr,{children:u}),g.jsx($t,{icon:"chevron-right",small:!0})]})}),g.jsx(pP,{container:a,children:g.jsx(lF,{"data-testid":`${i}-sub.${r}-content`,className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":n,children:s})})]});default:return s}}function tie({id:r,children:e}){const[t,n]=oc(r);return g.jsx(iF,{open:t,onOpenChange:n,children:e})}const nie=[{colorScheme:"light",label:"theme.light"},{colorScheme:"dark",label:"theme.dark"},{colorScheme:"system",label:"theme.system"}];function rie(){const r=ue(),e=ws(),t=ye("colorScheme",()=>r.user.getUserPreferences().colorScheme??(r.user.getIsDarkMode()?"dark":"light"),[r]);return g.jsx(Vo,{id:"help menu color-scheme",label:"menu.theme",children:g.jsx(_t,{id:"theme",children:nie.map(({colorScheme:n,label:s})=>g.jsx(ou,{id:`color-scheme-${n}`,label:s,checked:n===t,readonlyOk:!0,onSelect:()=>{r.user.updateUserPreferences({colorScheme:n}),e("color-scheme",{source:"menu",value:n})}},n))})})}const sie=({id:r,component:e,onClose:t})=>{const{removeDialog:n}=tm(),s=Kr(),o=I.useCallback(i=>{if(!i){if(t)try{t()}catch(a){console.warn(a)}n(r)}},[r,t,n]);return g.jsx(nse,{onOpenChange:o,defaultOpen:!0,children:g.jsx(rse,{container:s,children:g.jsx(sse,{dir:"ltr",className:"tlui-dialog__overlay",onClick:i=>{i.target===i.currentTarget&&o(!1)},children:g.jsx(ose,{dir:"ltr",className:"tlui-dialog__content","aria-describedby":void 0,children:g.jsx(e,{onClose:()=>o(!1)})})})})})},oie=I.memo(function(){const{dialogs:e}=tm();return ye("dialogs",()=>e.get(),[e]).map(n=>g.jsx(sie,{...n},n.id))}),iie=4e3,aie={success:"check-circle",warning:"warning-triangle",error:"cross-circle",info:"info-circle"};function lie({toast:r}){const{removeToast:e}=sc(),t=Wt(),n=i=>{i||e(r.id)},s=r.actions&&r.actions.length>0,o=r.icon||r.severity&&aie[r.severity];return g.jsxs(Lse,{onOpenChange:n,className:"tlui-toast__container",duration:r.keepOpen?1/0:iie,"data-severity":r.severity,children:[o&&g.jsx("div",{className:"tlui-toast__icon",children:g.jsx(hl,{icon:o})}),g.jsxs("div",{className:"tlui-toast__main","data-title":!!r.title,"data-description":!!r.description,"data-actions":!!r.actions,children:[g.jsxs("div",{className:"tlui-toast__content",children:[r.title&&g.jsx(Nse,{className:"tlui-toast__title",children:r.title}),r.description&&g.jsx(Fse,{className:"tlui-toast__description",children:r.description})]}),r.actions&&g.jsxs("div",{className:"tlui-toast__actions",children:[r.actions.map((i,a)=>g.jsx(zse,{altText:i.label,asChild:!0,onClick:i.onClick,children:g.jsx(ut,{type:i.type,children:g.jsx(Tr,{children:i.label})})},a)),g.jsx(iD,{asChild:!0,children:g.jsx(ut,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:g.jsx(Tr,{children:r.closeLabel??t("toast.close")})})})]})]}),!s&&g.jsx(iD,{asChild:!0,children:g.jsx(ut,{type:"normal",className:"tlui-toast__close",children:g.jsx(Tr,{children:r.closeLabel??t("toast.close")})})})]})}const cie=I.memo(function(){const{toasts:e}=sc(),t=ye("toasts",()=>e.get(),[]);return g.jsxs(g.Fragment,{children:[t.map(n=>g.jsx(lie,{toast:n},n.id)),g.jsx(KF,{className:"tlui-toast__viewport"})]})});function xa({actionId:r="",...e}){const n=Iu()[r];return n?g.jsx(ou,{...n,...e}):null}function pD(r){return g.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",...r,children:g.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[g.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),g.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:g.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}function Wr({disabled:r=!1,spinner:e=!1,readonlyOk:t=!1,id:n,kbd:s,label:o,icon:i,onSelect:a,noClose:l,isSelected:c}){const{type:u,sourceId:p}=Lb(),f=Wt(),[m,v]=I.useState(!1);if(gi()&&!t)return null;const S=Yf(o,u),C=s?qE(s):void 0,E=S?f(S):void 0,T=E&&C?`${E} ${C}`:E;switch(u){case"menu":return g.jsx(Xf,{children:g.jsxs(ut,{type:"menu","data-testid":`${p}.${n}`,disabled:r,title:T,onClick:w=>{l&&Ot(w),m?v(!1):a(p)},children:[g.jsx(Tr,{children:E}),s&&g.jsx(Af,{children:s})]})});case"context-menu":return r?null:g.jsxs(sF,{dir:"ltr",title:T,draggable:!1,className:"tlui-button tlui-button__menu","data-testid":`${p}.${n}`,onSelect:w=>{l&&Ot(w),m?v(!1):a(p)},children:[g.jsx("span",{className:"tlui-button__label",draggable:!1,children:E}),s&&g.jsx(Af,{children:s}),e&&g.jsx(pD,{})]});case"panel":return g.jsxs(ut,{"data-testid":`${p}.${n}`,type:"menu",title:T,disabled:r,onClick:()=>a(p),children:[g.jsx(Tr,{children:E}),e?g.jsx(pD,{}):i&&g.jsx($t,{icon:i})]});case"small-icons":case"icons":return g.jsx(ut,{"data-testid":`${p}.${n}`,type:"icon",title:T,disabled:r,onClick:()=>a(p),children:g.jsx($t,{icon:i,small:u==="small-icons"})});case"keyboard-shortcuts":return s?g.jsxs("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":`${p}.${n}`,children:[g.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:E}),g.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:g.jsx(Af,{visibleOnMobileLayout:!0,children:s})})]}):(console.warn(`Menu item '${o}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`),null);case"helper-buttons":return g.jsxs(ut,{type:"low",onClick:()=>a(p),children:[g.jsx($t,{icon:i}),g.jsx(Tr,{children:E})]});case"toolbar":return g.jsx(ut,{type:"tool","data-testid":`tools.${n}`,"aria-label":S,"data-value":n,onClick:()=>a("toolbar"),title:T,disabled:r,onTouchStart:w=>{Ot(w),a("toolbar")},role:"radio","aria-checked":c?"true":"false",children:g.jsx($t,{icon:i})});case"toolbar-overflow":return g.jsx(Xf,{"aria-label":o,children:g.jsx(ut,{type:"icon",className:"tlui-button-grid__button",onClick:()=>{a("toolbar")},"data-testid":`tools.more.${n}`,title:T,disabled:r,role:"radio","aria-checked":c?"true":"false","data-value":n,children:g.jsx($t,{icon:i})})});default:throw rs(u)}}function Pe({actionId:r="",...e}){const n=Iu()[r];return n?g.jsx(Wr,{...n,...e}):null}const g9=I.createContext(null);function die({overrides:r,children:e}){const t=ue(),n=ws(),s=AP(),o=I.useMemo(()=>{const i=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(l){if(t.isIn("select")){const c=t.root.getCurrent();c.exit({},c.id),c.enter({},c.id)}t.setCurrentTool("select"),n("select-tool",{source:l,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(l){t.setCurrentTool("hand"),n("select-tool",{source:l,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(l){t.setCurrentTool("eraser"),n("select-tool",{source:l,id:"eraser"})}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(l){t.setCurrentTool("draw"),n("select-tool",{source:l,id:"draw"})}},...[...ca.values].map(l=>({id:l,label:`tool.${l}`,meta:{geo:l},kbd:l==="rectangle"?"r":l==="ellipse"?"o":void 0,icon:"geo-"+l,onSelect(c){t.run(()=>{t.setStyleForNextShapes(ca,l),t.setCurrentTool("geo"),n("select-tool",{source:c,id:`geo-${l}`})})}})),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(l){t.setCurrentTool("arrow"),n("select-tool",{source:l,id:"arrow"})}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(l){t.setCurrentTool("line"),n("select-tool",{source:l,id:"line"})}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(l){t.setCurrentTool("frame"),n("select-tool",{source:l,id:"frame"})}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(l){t.setCurrentTool("text"),n("select-tool",{source:l,id:"text"})}},{id:"asset",label:"tool.asset",icon:"tool-media",kbd:"$u",onSelect(l){s.insertMedia(),n("select-tool",{source:l,id:"media"})}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(l){t.setCurrentTool("note"),n("select-tool",{source:l,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(l){t.setCurrentTool("laser"),n("select-tool",{source:l,id:"laser"})}},{id:"embed",label:"tool.embed",icon:"dot",onSelect(l){s.addDialog({component:$F}),n("select-tool",{source:l,id:"embed"})}},{id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"!d",onSelect(l){t.setCurrentTool("highlight"),n("select-tool",{source:l,id:"highlight"})}}];i.push();const a=Object.fromEntries(i.map(l=>[l.id,l]));return r?r(t,a,s):a},[r,t,n,s]);return g.jsx(g9.Provider,{value:o,children:e})}function jP(){const r=I.useContext(g9);if(!r)throw new Error("useTools must be used within a ToolProvider");return r}function Io({toolId:r="",...e}){const n=jP()[r];return n?g.jsx(Wr,{...n,...e}):null}function uie({children:r}){const e=ue();return ye("shouldDisplayHandles",()=>{if(e.isInAny("select.idle","select.pointing_handle","select.pointing_shape"))return!0;if(e.isInAny("select.editing_shape")){const n=e.getOnlySelectedShape();return n&&e.isShapeOfType(n,"note")}return!1},[e])?g.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:r}):null}const{PI:hie}=Math,Th=hie+1e-4;function m9(r,e={}){const{size:t=16,smoothing:n=.5}=e;if(r.length===0||t<=0)return{left:[],right:[]};const s=r[0],o=r[r.length-1],i=o.runningLength,a=Math.pow(t*n,2),l=[],c=[];let u=r[0].vector,p=r[0].point,f=p,m=p,v=f,b=!1,S;for(let C=0;C<r.length;C++){S=r[C];const{point:E,vector:T}=r[C],w=S.vector.dpr(u),M=(C<r.length-1?r[C+1]:r[C]).vector,R=C<r.length-1?M.dpr(S.vector):1,D=w<0&&!b,N=R!==null&&R<.2;if(D||N){if(R>-.62&&i-S.runningLength>S.radius){const L=u.clone().mul(S.radius);u.clone().cpr(M)<0?(m=P.Add(E,L),v=P.Sub(E,L)):(m=P.Sub(E,L),v=P.Add(E,L)),l.push(m),c.push(v)}else{const L=u.clone().mul(S.radius).per(),B=P.Sub(S.input,L);for(let K=1/13,O=0;O<1;O+=K)m=P.RotWith(B,S.input,Th*O),l.push(m),v=P.RotWith(B,S.input,Th+Th*-O),c.push(v)}p=m,f=v,N&&(b=!0);continue}if(b=!1,S===s||S===o){const L=P.Per(T).mul(S.radius);l.push(P.Sub(E,L)),c.push(P.Add(E,L));continue}const z=P.Lrp(M,T,R).per().mul(S.radius);m=P.Sub(E,z),(C<=1||P.Dist2(p,m)>a)&&(l.push(m),p=m),v=P.Add(E,z),(C<=1||P.Dist2(f,v)>a)&&(c.push(v),f=v),u=T}return{left:l,right:c}}function RP(r,e={}){const{size:t=16,start:n={},end:s={},last:o=!1}=e,{cap:i=!0}=n,{cap:a=!0}=s;if(r.length===0||t<=0)return[];const l=r[0],c=r[r.length-1],u=c.runningLength,p=n.taper===!1?0:n.taper===!0?Math.max(t,u):n.taper,f=s.taper===!1?0:s.taper===!0?Math.max(t,u):s.taper,{left:m,right:v}=m9(r,e),b=l.point,S=r.length>1?r[r.length-1].point:P.AddXY(l.point,1,1);if(r.length===1&&(!(p||f)||o)){const w=P.Add(b,P.Sub(b,S).uni().per().mul(-l.radius)),M=[];for(let R=1/13,D=R;D<=1;D+=R)M.push(P.RotWith(w,b,Th*2*D));return M}const C=[];if(!(p||f&&r.length===1))if(i)for(let w=1/8,M=w;M<=1;M+=w){const R=P.RotWith(v[0],b,Th*M);C.push(R)}else{const w=P.Sub(m[0],v[0]),M=P.Mul(w,.5),R=P.Mul(w,.51);C.push(P.Sub(b,M),P.Sub(b,R),P.Add(b,R),P.Add(b,M))}const E=[],T=c.vector.clone().per().neg();if(f||p&&r.length===1)E.push(S);else if(a){const w=P.Add(S,P.Mul(T,c.radius));for(let M=1/29,R=M;R<1;R+=M)E.push(P.RotWith(w,S,Th*3*R))}else E.push(P.Add(S,P.Mul(T,c.radius)),P.Add(S,P.Mul(T,c.radius*.99)),P.Sub(S,P.Mul(T,c.radius*.99)),P.Sub(S,P.Mul(T,c.radius)));return m.concat(E,v.reverse(),C)}const pie=.025,fie=.01;function pl(r,e={}){var S;const{streamline:t=.5,size:n=16,simulatePressure:s=!1}=e;if(r.length===0)return[];const o=.15+(1-t)*.85;let i=r.map(P.From),a=0;if(!s){let C=i[0];for(;C&&!(C.z>=pie);)i.shift(),C=i[0]}if(!s){let C=i[i.length-1];for(;C&&!(C.z>=fie);)i.pop(),C=i[i.length-1]}if(i.length===0)return[{point:P.From(r[0]),input:P.From(r[0]),pressure:s?.5:.15,vector:new P(1,1),distance:0,runningLength:0,radius:1}];let l=i[1];for(;l&&!(P.Dist2(l,i[0])>(n/3)**2);)i[0].z=Math.max(i[0].z,l.z),i.splice(1,1),l=i[1];const c=i.pop();for(l=i[i.length-1];l&&!(P.Dist2(l,c)>(n/3)**2);)i.pop(),l=i[i.length-1],a++;i.push(c);const u=e.last||!e.simulatePressure||i.length>1&&P.Dist2(i[i.length-1],i[i.length-2])<n**2||a>0;if(i.length===2&&e.simulatePressure){const C=i[1];i=i.slice(0,-1);for(let E=1;E<5;E++){const T=P.Lrp(i[0],C,E/4);T.z=(i[0].z+(C.z-i[0].z))*E/4,i.push(T)}}const p=[{point:i[0],input:i[0],pressure:s?.5:i[0].z,vector:new P(1,1),distance:0,runningLength:0,radius:1}];let f=0,m=p[0],v,b;u&&t>0&&i.push(i[i.length-1].clone());for(let C=1,E=i.length;C<E;C++)v=!o||e.last&&C===E-1?i[C].clone():i[C].clone().lrp(m.point,1-o),!m.point.equals(v)&&(b=P.Dist(v,m.point),f+=b,!(C<4&&f<n)&&(m={input:i[C],point:v,pressure:s?.5:i[C].z,vector:P.Sub(m.point,v).uni(),distance:b,runningLength:f,radius:1},p.push(m)));if((S=p[1])!=null&&S.vector&&(p[0].vector=p[1].vector.clone()),f<1){const C=Math.max(.5,...p.map(E=>E.pressure));p.forEach(E=>E.pressure=C)}return p}const{min:jc}=Math,wC=.275;function Nb(r,e){const{size:t=16,thinning:n=.5,simulatePressure:s=!0,easing:o=S=>S,start:i={},end:a={}}=e,{easing:l=ss.easeOutQuad}=i,{easing:c=ss.easeOutCubic}=a,u=r[r.length-1].runningLength;let p,f=r[0].pressure,m;if(!s&&u<t){const S=r.reduce((C,E)=>Math.max(C,E.pressure),.5);return r.forEach(C=>{C.pressure=S,C.radius=t*o(.5-n*(.5-C.pressure))}),r}else{let S;for(let C=0,E=r.length;C<E&&(m=r[C],!(m.runningLength>t*5));C++){const T=jc(1,m.distance/t);if(s){const w=jc(1,1-T);S=jc(1,f+(w-f)*(T*wC))}else S=jc(1,f+(m.pressure-f)*.5);f=f+(S-f)*.5}for(let C=0;C<r.length;C++){if(m=r[C],n){let{pressure:E}=m;const T=jc(1,m.distance/t);if(s){const w=jc(1,1-T);E=jc(1,f+(w-f)*(T*wC))}else E=jc(1,f+(E-f)*(T*wC));m.radius=t*o(.5-n*(.5-E)),f=E}else m.radius=t/2;p===void 0&&(p=m.radius)}}const v=i.taper===!1?0:i.taper===!0?Math.max(t,u):i.taper,b=a.taper===!1?0:a.taper===!0?Math.max(t,u):a.taper;if(v||b)for(let S=0;S<r.length;S++){m=r[S];const{runningLength:C}=m,E=C<v?l(C/v):1,T=u-C<b?c((u-C)/b):1;m.radius=Math.max(.01,m.radius*Math.min(E,T))}return r}function gie(r,e={}){return RP(Nb(pl(r,e),e),e)}function fD({scribble:r,zoom:e,color:t,opacity:n,className:s}){if(!r.points.length)return null;const o=gie(r.points,{size:r.size/e,start:{taper:r.taper,easing:ss.linear},last:r.state==="stopping",simulatePressure:!1,streamline:.32});let i;if(o.length<4){const a=r.size/e/2,{x:l,y:c}=r.points[r.points.length-1];i=`M ${l-a},${c} a ${a},${a} 0 1,0 ${a*2},0 a ${a},${a} 0 1,0 ${-a*2},0`}else i=E2(o);return g.jsx("svg",{className:s&&it("tl-overlays__item",s),children:g.jsx("path",{className:"tl-scribble",d:i,fill:t??`var(--color-${r.color})`,opacity:n??r.opacity})})}const mie=({bounds:r,rotation:e})=>{const t=ue();return ye("should display",()=>t.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing"),[t])?g.jsx(Q5,{bounds:r,rotation:e}):null};function yie({size:r,width:e,height:t,hideAlternateHandles:n}){const s=fe(r/3),o=s/2;return g.jsxs("svg",{className:"tl-overlays__item",children:[g.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${fe(0-o)},${fe(r)} 
						${fe(0-o)},${fe(0-o)} 
						${fe(r)},${fe(0-o)}`,strokeWidth:s,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),g.jsx("line",{className:it("tl-corner-crop-edge-handle",{"tl-hidden":n}),x1:fe(e/2-r),y1:fe(0-o),x2:fe(e/2+r),y2:fe(0-o),strokeWidth:s,"data-testid":"selection.crop.top","aria-label":"top handle"}),g.jsx("polyline",{className:it("tl-corner-crop-handle",{"tl-hidden":n}),points:`
						${fe(e-r)},${fe(0-o)} 
						${fe(e+o)},${fe(0-o)} 
						${fe(e+o)},${fe(r)}`,strokeWidth:s,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),g.jsx("line",{className:it("tl-corner-crop-edge-handle",{"tl-hidden":n}),x1:fe(e+o),y1:fe(t/2-r),x2:fe(e+o),y2:fe(t/2+r),strokeWidth:s,"data-testid":"selection.crop.right","aria-label":"right handle"}),g.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${fe(e+o)},${fe(t-r)} 
						${fe(e+o)},${fe(t+o)}
						${fe(e-r)},${fe(t+o)}`,strokeWidth:s,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),g.jsx("line",{className:it("tl-corner-crop-edge-handle",{"tl-hidden":n}),x1:fe(e/2-r),y1:fe(t+o),x2:fe(e/2+r),y2:fe(t+o),strokeWidth:s,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),g.jsx("polyline",{className:it("tl-corner-crop-handle",{"tl-hidden":n}),points:`
						${fe(0+r)},${fe(t+o)} 
						${fe(0-o)},${fe(t+o)}
						${fe(0-o)},${fe(t-r)}`,strokeWidth:s,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),g.jsx("line",{className:it("tl-corner-crop-edge-handle",{"tl-hidden":n}),x1:fe(0-o),y1:fe(t/2-r),x2:fe(0-o),y2:fe(t/2+r),strokeWidth:s,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}const vie=Ss(function({bounds:e,rotation:t}){const n=ue(),s=I.useRef(null),o=gi(),i=Fa("top"),a=Fa("right"),l=Fa("bottom"),c=Fa("left"),u=Fa("top_left"),p=Fa("top_right"),f=Fa("bottom_right"),m=Fa("bottom_left"),v=n.getInstanceState().cursor.type==="default",b=n.getInstanceState().isCoarsePointer,S=n.getOnlySelectedShape(),C=S&&n.isShapeOrAncestorLocked(S),E=S?n.getShapeUtil(S).expandSelectionOutlinePx(S):0,T=E instanceof Ve?e.clone().expand(E).zeroFix():e.clone().expandBy(E).zeroFix();if(op(s,e==null?void 0:e.x,e==null?void 0:e.y,1,n.getSelectionRotation(),{x:T.x-e.x,y:T.y-e.y}),S&&n.isShapeHidden(S))return null;const w=n.getZoomLevel(),M=n.getInstanceState().isChangingStyle,R=T.width,D=T.height,N=8/w,z=R<N*2,L=D<N*2,B=R<N*4,K=D<N*4,O=R<N*5,U=D<N*5,X=b?1.75:1,H=6/w*X,ee=(B?H/2:H)*(X*.75),J=(K?H/2:H)*(X*.75),ne=(S?!n.getShapeUtil(S).hideSelectionBoundsFg(S):!0)&&!M;let ae=ne&&n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle","select.pointing_resize_handle")||ne&&n.isIn("select.resizing")&&S&&n.isShapeOfType(S,"text");S&&ae&&Rn.isFirefox&&n.isShapeOfType(S,"embed")&&(ae=!1);const q=n.isInAny("select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle")&&!M&&!o,se=n.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!M&&!o,xe=!b&&!(z||L)&&(se||q)&&(S?!n.getShapeUtil(S).hideRotateHandle(S):!0)&&!C,Oe=b&&(!B||!K)&&(se||q)&&(S?!n.getShapeUtil(S).hideRotateHandle(S):!0)&&!C,Ee=se&&(S?n.getShapeUtil(S).canResize(S)&&!n.getShapeUtil(S).hideResizeHandles(S):!0)&&!q&&!C,Ue=z||L,Be=z&&L,Te=O||U,Le=Ee||q,Xe=!xe,pt=!se||!Oe,gn=!se||!Le,Dt=!se||!Le||Ue,sn=!se||!Le||Ue,Kt=!se||!Le||Be&&!q;let Nt=!0,vr=!0;if(q)Nt=Te,vr=Te;else if(Ee){Nt=Ue||Be||b;const Sr=b&&S&&S.type==="text";vr=Nt&&!Sr}const br=Math.min(24/w,D-J*3),Qn=se&&b&&S&&n.isShapeOfType(S,"text")&&br*w>=4;return g.jsx("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:g.jsxs("g",{ref:s,children:[ae&&g.jsx("rect",{className:"tl-selection__fg__outline",width:fe(R),height:fe(D)}),g.jsx(Ly,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:H,corner:"top_left_rotate",cursor:v?Jo("nwse-rotate",t):void 0,isHidden:Xe}),g.jsx(Ly,{"data-testid":"selection.rotate.top-right",cx:R+H*3,cy:0,targetSize:H,corner:"top_right_rotate",cursor:v?Jo("nesw-rotate",t):void 0,isHidden:Xe}),g.jsx(Ly,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:D+H*3,targetSize:H,corner:"bottom_left_rotate",cursor:v?Jo("swne-rotate",t):void 0,isHidden:Xe}),g.jsx(Ly,{"data-testid":"selection.rotate.bottom-right",cx:R+H*3,cy:D+H*3,targetSize:H,corner:"bottom_right_rotate",cursor:v?Jo("senw-rotate",t):void 0,isHidden:Xe}),g.jsx(Sie,{"data-testid":"selection.rotate.mobile",cx:B?-H*1.5:R/2,cy:B?D/2:-H*1.5,size:N,isHidden:pt}),g.jsx("rect",{className:it("tl-transparent",{"tl-hidden":Nt}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:fe(0-(K?J*2:J)),width:fe(R),height:fe(Math.max(1,J*2)),style:v?{cursor:Jo("ns-resize",t)}:void 0,...i}),g.jsx("rect",{className:it("tl-transparent",{"tl-hidden":vr}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:fe(R-(B?0:ee)),y:0,height:fe(D),width:fe(Math.max(1,ee*2)),style:v?{cursor:Jo("ew-resize",t)}:void 0,...a}),g.jsx("rect",{className:it("tl-transparent",{"tl-hidden":Nt}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:fe(D-(K?0:J)),width:fe(R),height:fe(Math.max(1,J*2)),style:v?{cursor:Jo("ns-resize",t)}:void 0,...l}),g.jsx("rect",{className:it("tl-transparent",{"tl-hidden":vr}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:fe(0-(B?ee*2:ee)),y:0,height:fe(D),width:fe(Math.max(1,ee*2)),style:v?{cursor:Jo("ew-resize",t)}:void 0,...c}),g.jsx("rect",{className:it("tl-transparent",{"tl-hidden":gn}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:fe(0-(B?ee*2:ee*1.5)),y:fe(0-(K?J*2:J*1.5)),width:fe(ee*3),height:fe(J*3),style:v?{cursor:Jo("nwse-resize",t)}:void 0,...u}),g.jsx("rect",{className:it("tl-transparent",{"tl-hidden":Dt}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:fe(R-(B?0:ee*1.5)),y:fe(0-(K?J*2:J*1.5)),width:fe(ee*3),height:fe(J*3),style:v?{cursor:Jo("nesw-resize",t)}:void 0,...p}),g.jsx("rect",{className:it("tl-transparent",{"tl-hidden":Kt}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:fe(R-(B?ee:ee*1.5)),y:fe(D-(K?J:J*1.5)),width:fe(ee*3),height:fe(J*3),style:v?{cursor:Jo("nwse-resize",t)}:void 0,...f}),g.jsx("rect",{className:it("tl-transparent",{"tl-hidden":sn}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:fe(0-(B?ee*3:ee*1.5)),y:fe(D-(K?0:J*1.5)),width:fe(ee*3),height:fe(J*3),style:v?{cursor:Jo("nesw-resize",t)}:void 0,...m}),Ee&&g.jsxs(g.Fragment,{children:[g.jsx("rect",{"data-testid":"selection.resize.top-left",className:it("tl-corner-handle",{"tl-hidden":gn}),"aria-label":"top_left handle",x:fe(0-N/2),y:fe(0-N/2),width:fe(N),height:fe(N)}),g.jsx("rect",{"data-testid":"selection.resize.top-right",className:it("tl-corner-handle",{"tl-hidden":Dt}),"aria-label":"top_right handle",x:fe(R-N/2),y:fe(0-N/2),width:fe(N),height:fe(N)}),g.jsx("rect",{"data-testid":"selection.resize.bottom-right",className:it("tl-corner-handle",{"tl-hidden":Kt}),"aria-label":"bottom_right handle",x:fe(R-N/2),y:fe(D-N/2),width:fe(N),height:fe(N)}),g.jsx("rect",{"data-testid":"selection.resize.bottom-left",className:it("tl-corner-handle",{"tl-hidden":sn}),"aria-label":"bottom_left handle",x:fe(0-N/2),y:fe(D-N/2),width:fe(N),height:fe(N)})]}),Qn&&g.jsxs(g.Fragment,{children:[g.jsx("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:fe(0-N/4),y:fe(D/2-br/2),rx:N/4,width:fe(N/2),height:fe(br)}),g.jsx("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:N/4,x:fe(R-N/4),y:fe(D/2-br/2),width:fe(N/2),height:fe(br)})]}),q&&g.jsx(yie,{size:N,width:R,height:D,hideAlternateHandles:Te})]})})}),Ly=function({cx:e,cy:t,targetSize:n,corner:s,cursor:o,isHidden:i,"data-testid":a}){const l=Fa(s);return g.jsx("rect",{className:it("tl-transparent","tl-rotate-corner",{"tl-hidden":i}),"data-testid":a,"aria-label":`${s} target`,pointerEvents:"all",x:fe(e-n*3),y:fe(t-n*3),width:fe(Math.max(1,n*3)),height:fe(Math.max(1,n*3)),cursor:o,...l})},bie=Math.sqrt(Math.PI),Sie=function({cx:e,cy:t,size:n,isHidden:s,"data-testid":o}){const i=Fa("mobile_rotate"),a=ue(),l=ye("zoom level",()=>a.getZoomLevel(),[a]),c=Math.max(14*(1/l),20/Math.max(1,l));return g.jsxs("g",{children:[g.jsx("circle",{"data-testid":o,pointerEvents:"all",className:it("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":s}),cx:e,cy:t,r:c,...i}),g.jsx("circle",{className:it("tl-mobile-rotate__fg",{"tl-hidden":s}),cx:e,cy:t,r:n/bie})]})};function xie(){const r=ue();return ye("is in a valid select state",()=>r.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle"),[r])?g.jsx(eL,{}):null}function YE(r,e,t){const{arrowheadStart:n,arrowheadEnd:s}=e.props,o=Sh(r,e,t),i=o.start.clone(),a=o.end.clone(),l=P.Med(i,a);if(P.Equals(i,a))return{bindings:t,isStraight:!0,start:{handle:i,point:i,arrowhead:e.props.arrowheadStart},end:{handle:a,point:a,arrowhead:e.props.arrowheadEnd},middle:l,isValid:!1,length:0};const c=P.Sub(a,i).uni(),u=u0(r,e,"start"),p=u0(r,e,"end"),f=r.getShapePageTransform(e);gD(a,o.start,f,p),gD(i,o.end,f,u);let m=0,v=0,b=0,S=0,C=xh*e.props.scale;const E=u&&p&&u.shape===p.shape,T=u&&p?DP(r,u.shape.id,p.shape.id):"safe";T==="safe"&&u&&p&&!E&&!u.isExact&&!p.isExact&&(p.didIntersect&&!u.didIntersect?u.isClosed&&i.setTo(a.clone().add(c.clone().mul(xh*e.props.scale))):p.didIntersect||p.isClosed&&a.setTo(i.clone().sub(c.clone().mul(xh*e.props.scale))));const w=P.Sub(a,i),M=P.Len(w)?w.uni():P.From(w),R=!P.Equals(M,c);E||(T!=="start-contains-end"&&u&&n!=="none"&&!u.isExact&&(b=el[e.props.size]/2+("size"in u.shape.props?el[u.shape.props.size]/2:0),m=(h0+b)*e.props.scale,C+=b*e.props.scale),T!=="end-contains-start"&&p&&s!=="none"&&!p.isExact&&(S=el[e.props.size]/2+("size"in p.shape.props?el[p.shape.props.size]/2:0),v=(h0+S)*e.props.scale,C+=S*e.props.scale));const D=i.clone().add(M.clone().mul(m*(R?-1:1))),N=a.clone().sub(M.clone().mul(v*(R?-1:1)));P.DistMin(D,N,C)&&(m!==0&&v!==0?(m*=-1.5,v*=-1.5):m!==0?m*=-1:v!==0&&(v*=-1)),i.add(M.clone().mul(m*(R?-1:1))),a.sub(M.clone().mul(v*(R?-1:1))),R?(u&&p&&a.setTo(P.Add(i,M.clone().mul(-xh*e.props.scale))),l.setTo(P.Med(o.start,o.end))):l.setTo(P.Med(i,a));const z=P.Dist(i,a);return{bindings:t,isStraight:!0,start:{handle:o.start,point:i,arrowhead:e.props.arrowheadStart},end:{handle:o.end,point:a,arrowhead:e.props.arrowheadEnd},middle:l,isValid:z>0,length:z}}function gD(r,e,t,n){if(n===void 0||n.isExact)return;const s=Ne.applyToPoint(t,e),o=Ne.applyToPoint(t,r),i=Ne.applyToPoint(Ne.Inverse(n.transform),s),a=Ne.applyToPoint(Ne.Inverse(n.transform),o),l=n.isClosed,u=(l?T2:eX)(i,a,n.outline);let p;if(u!==null&&(p=u.sort((v,b)=>P.Dist2(v,i)-P.Dist2(b,i))[0]??(l?void 0:a)),p===void 0)return;const f=Ne.applyToPoint(n.transform,p),m=Ne.applyToPoint(Ne.Inverse(t),f);r.setTo(m),n.didIntersect=!0}function wie(r,e,t){const{arrowheadEnd:n,arrowheadStart:s}=e.props,o=e.props.bend;if(Math.abs(o)>Math.abs(e.props.bend*(Iie*e.props.scale)))return YE(r,e,t);const i=Sh(r,e,t),a=P.Med(i.start,i.end),l=P.Sub(i.end,i.start),c=P.Len(l)?l.uni():P.From(l),u=P.Add(a,c.per().mul(-o)),p=u0(r,e,"start"),f=u0(r,e,"end"),m=i.start.clone(),v=i.end.clone(),b=u.clone();if(P.Equals(m,v))return{bindings:t,isStraight:!0,start:{handle:m,point:m,arrowhead:e.props.arrowheadStart},end:{handle:v,point:v,arrowhead:e.props.arrowheadEnd},middle:b,isValid:!1,length:0};const S=e.props.bend<0,C=S?Fg:R5,E=mD(m,v,b),T=P.Angle(E.center,m),w=P.Angle(E.center,v),M=C(T,w);if(E.length===0||E.size===0||!Kj(E.length)||!Kj(E.size))return YE(r,e,t);const R=m.clone(),D=v.clone(),N=b.clone(),z=r.getShapePageTransform(e);let L=0,B=0,K=xh*e.props.scale;if(p&&!p.isExact){const ae=Ne.applyToPoint(z,R),q=Ne.applyToPoint(z,E.center),se=Ne.applyToPoint(z,D),xe=Ne.Inverse(p.transform),Oe=Ne.applyToPoint(xe,ae),Ee=Ne.applyToPoint(xe,q),Ue=Ne.applyToPoint(xe,se),{isClosed:Be}=p,Te=Be?EE:fR;let Le,Xe=Te(Ee,E.radius,p.outline);if(Xe){const pt=Ee.angle(Oe),gn=Ee.angle(Ue),Dt=C(pt,gn);Xe=Xe.filter(Kt=>C(pt,Ee.angle(Kt))<=Dt);const sn=Dt*.25;Xe.sort(Be?(Kt,Nt)=>Math.abs(C(pt,Ee.angle(Kt))-sn)<Math.abs(C(pt,Ee.angle(Nt))-sn)?-1:1:(Kt,Nt)=>C(pt,Ee.angle(Kt))<C(pt,Ee.angle(Nt))?-1:1),Le=Xe[0]??(Be?void 0:Oe)}else Le=Be?void 0:Oe;if(Le&&(R.setTo(r.getPointInShapeSpace(e,Ne.applyToPoint(p.transform,Le))),p.didIntersect=!0,s!=="none")){const pt=el[e.props.size]/2+("size"in p.shape.props?el[p.shape.props.size]/2:0);L=(h0+pt)*e.props.scale,K+=pt*e.props.scale}}if(f&&!f.isExact){const ae=Ne.applyToPoint(z,R),q=Ne.applyToPoint(z,D),se=Ne.applyToPoint(z,E.center),xe=Ne.Inverse(f.transform),Oe=Ne.applyToPoint(xe,ae),Ee=Ne.applyToPoint(xe,se),Ue=Ne.applyToPoint(xe,q),Be=f.isClosed,Te=Be?EE:fR;let Le,Xe=Te(Ee,E.radius,f.outline);if(Xe){const pt=Ee.angle(Oe),gn=Ee.angle(Ue),Dt=C(pt,gn),sn=Dt*.75;Xe=Xe.filter(Kt=>C(pt,Ee.angle(Kt))<=Dt),Xe.sort(Be?(Kt,Nt)=>Math.abs(C(pt,Ee.angle(Kt))-sn)<Math.abs(C(pt,Ee.angle(Nt))-sn)?-1:1:(Kt,Nt)=>C(pt,Ee.angle(Kt))<C(pt,Ee.angle(Nt))?-1:1),Xe[0]?Le=Xe[0]:Le=Be?void 0:Ue}else Le=Be?void 0:Ue;if(Le&&(D.setTo(r.getPointInShapeSpace(e,Ne.applyToPoint(f.transform,Le))),f.didIntersect=!0,n!=="none")){const pt=el[e.props.size]/2+("size"in f.shape.props?el[f.shape.props.size]/2:0);B=(h0+pt)*e.props.scale,K+=pt*e.props.scale}}let O=P.Angle(E.center,R),U=P.Angle(E.center,D),X=C(O,U),H=X*E.radius;const ee=R.clone(),J=D.clone();if(L!==0&&ee.setTo(E.center).add(P.FromAngle(O+X*(L/H*(S?1:-1))).mul(E.radius)),B!==0&&J.setTo(E.center).add(P.FromAngle(U+X*(B/H*(S?-1:1))).mul(E.radius)),P.DistMin(ee,J,K)&&(L!==0&&B!==0?(L*=-1.5,B*=-1.5):L!==0?L*=-2:B!==0&&(B*=-2)),L!==0&&R.setTo(E.center).add(P.FromAngle(O+X*(L/H*(S?1:-1))).mul(E.radius)),B!==0&&D.setTo(E.center).add(P.FromAngle(U+X*(B/H*(S?-1:1))).mul(E.radius)),p&&f&&!p.isExact&&!f.isExact){O=P.Angle(E.center,R),U=P.Angle(E.center,D),X=C(O,U),H=X*E.radius;const ae=DP(r,p.shape.id,f.shape.id);ae==="double-bound"&&H<30?(R.setTo(m),D.setTo(v),N.setTo(b)):ae==="safe"&&(p&&!p.didIntersect&&R.setTo(m),(f&&!f.didIntersect||C(T,O)>C(T,U))&&D.setTo(E.center).add(P.FromAngle(O+X*(Math.min(.9,xh*e.props.scale/H)*(S?1:-1))).mul(E.radius)))}Cie(E.center,E.radius,R,D,N,M,S),R.equals(D)&&(R.setTo(N.clone().addXY(1,1)),D.setTo(N.clone().subXY(1,1))),m.setTo(R),v.setTo(D),b.setTo(N);const ne=mD(m,v,b);return{bindings:t,isStraight:!1,start:{point:m,handle:i.start,arrowhead:e.props.arrowheadStart},end:{point:v,handle:i.end,arrowhead:e.props.arrowheadEnd},middle:b,handleArc:E,bodyArc:ne,isValid:ne.length!==0&&isFinite(ne.center.x)&&isFinite(ne.center.y)}}function mD(r,e,t){const n=S2(r,e,t)??P.Med(r,e),s=P.Dist(n,r),o=+P.Clockwise(r,t,e),i=((r.y-e.y)**2+(r.x-e.x)**2)**.5,a=((e.y-t.y)**2+(e.x-t.x)**2)**.5,l=((t.y-r.y)**2+(t.x-r.x)**2)**.5,c=Math.acos((a*a+l*l-i*i)/(2*a*l))*2,u=+(cn>c),p=(xn-c)*(o?1:-1),f=p*s;return{center:n,radius:s,size:p,length:f,largeArcFlag:u,sweepFlag:o}}function Cie(r,e,t,n,s,o,i){const a=P.Angle(r,t),l=P.Angle(r,n);let c=Fg(a,l);if(i||(c=xn-c),s.setTo(r).add(P.FromAngle(a+c*(.5*(i?1:-1))).mul(e)),c>o){s.rotWith(r,cn);const u=n.clone();n.setTo(t),t.setTo(u)}}const Eie=8;function kie(r){return Math.abs(r.props.bend)<Eie*r.props.scale}function u0(r,e,t){const n=r.getBindingsFromShape(e,"arrow").find(l=>l.props.terminal===t);if(!n)return;const s=r.getShape(n.toId);if(!s)return;const o=r.getShapePageTransform(s),i=r.getShapeGeometry(s),a=i instanceof Fi?i.children[0].vertices:i.vertices;return{shape:s,transform:o,isClosed:i.isClosed,isExact:n.props.isExact,didIntersect:!1,outline:a}}function yD(r,e,t,n){const s=r.getShape(t.toId);if(s){const{point:o,size:i}=r.getShapeGeometry(s).bounds,a=P.Add(o,P.MulV(t.props.isPrecise||n?t.props.normalizedAnchor:{x:.5,y:.5},i)),l=Ne.applyToPoint(r.getShapePageTransform(s),a);return Ne.applyToPoint(Ne.Inverse(e),l)}else return new P(0,0)}function Fo(r,e){const t=r.getBindingsFromShape(e,"arrow");return{start:t.find(n=>n.props.terminal==="start"),end:t.find(n=>n.props.terminal==="end")}}const Pie=QW("arrow info",(r,e)=>{const t=Fo(r,e);return kie(e)?YE(r,e,t):wie(r,e,t)});function Qa(r,e){const t=typeof e=="string"?e:e.id;return Pie.get(r,t)}function Sh(r,e,t){var a,l;const n=r.getShapePageTransform(e),s=DP(r,(a=t.start)==null?void 0:a.toId,(l=t.end)==null?void 0:l.toId),o=t.start?yD(r,n,t.start,s==="double-bound"||s==="start-contains-end"):P.From(e.props.start),i=t.end?yD(r,n,t.end,s==="double-bound"||s==="end-contains-start"):P.From(e.props.end);return{start:o,end:i}}function sf(r,e,t,n){const s=typeof e=="string"?e:e.id,o=typeof t=="string"?t:t.id,i=r.getBindingsFromShape(s,"arrow").filter(l=>l.props.terminal===n.terminal);i.length>1&&r.deleteBindings(i.slice(1));const a=i[0];a?r.updateBinding({...a,toId:o,props:n}):r.createBinding({type:"arrow",fromId:s,toId:o,props:n})}function ov(r,e,t){const n=r.getBindingsFromShape(e,"arrow").filter(s=>s.props.terminal===t);r.deleteBindings(n)}const xh=10,h0=10,Iie=10,el={s:2,m:3.5,l:5,xl:10};function DP(r,e,t){if(!e||!t)return"safe";if(e===t)return"double-bound";const n=r.getShapePageBounds(e),s=r.getShapePageBounds(t);if(n&&s){if(n.contains(s))return"start-contains-end";if(s.contains(n))return"end-contains-start"}return"safe"}class iv extends ev{getDefaultProps(){return{isPrecise:!1,isExact:!1,normalizedAnchor:{x:.5,y:.5}}}onAfterCreate({binding:e}){const t=this.editor.getShape(e.fromId);t&&CC(this.editor,t)}onAfterChange({bindingAfter:e}){const t=this.editor.getShape(e.fromId);t&&CC(this.editor,t)}onAfterChangeFromShape({shapeAfter:e}){CC(this.editor,e)}onAfterChangeToShape({binding:e}){y9(this.editor,e.fromId)}onBeforeIsolateFromShape({binding:e}){const t=this.editor.getShape(e.fromId);t&&p0({editor:this.editor,arrow:t,terminal:e.props.terminal})}}k(iv,"type","arrow"),k(iv,"props",e5),k(iv,"migrations",t5);function y9(r,e){var S;const t=r.getShape(e);if(!t)return;const n=Fo(r,t),{start:s,end:o}=n,i=s?r.getShape(s.toId):void 0,a=o?r.getShape(o.toId):void 0,l=r.getAncestorPageId(t);if(!l)return;let c;if(i&&a)c=r.findCommonAncestor([i,a])??l;else if(i||a){const C=(S=i||a)==null?void 0:S.parentId;C&&C===t.parentId?c=t.parentId:c=l}else return;c&&c!==t.parentId&&r.reparentShapes([e],c);const u=r.getShape(e);if(!u)throw Error("no reparented arrow");const p=r.getShapeNearestSibling(u,i),f=r.getShapeNearestSibling(u,a);let m;if(p&&f)m=p.index>f.index?p:f;else if(p&&!f)m=p;else if(f&&!p)m=f;else return;let v;const b=r.getSortedChildIdsForParent(m.parentId).map(C=>r.getShape(C)).filter(C=>C.index>m.index);if(b.length){const C=b.find(E=>E.type!=="arrow");if(u.index>m.index&&(!C||u.index<C.index))return;v=zf(m.index,b[0].index)}else v=Za(m.index);v!==u.index&&r.updateShapes([{id:e,type:"arrow",index:v}])}function CC(r,e){const t=Fo(r,e);for(const n of["start","end"]){const s=t[n];if(!s)continue;const o=r.getShape(s.toId),i=r.getAncestorPageId(e)===r.getAncestorPageId(o);(!o||!i)&&p0({editor:r,arrow:e,terminal:n,unbind:!0})}y9(r,e.id)}function p0({editor:r,arrow:e,terminal:t,unbind:n=!1,useHandle:s=!1}){const o=Qa(r,e);if(!o)throw new Error("expected arrow info");const i=s?o.start.handle:o.start.point,a=s?o.end.handle:o.end.point,l=t==="start"?i:a,c={id:e.id,type:"arrow",props:{[t]:{x:l.x,y:l.y},bend:e.props.bend}};if(!o.isStraight){const u=t==="start"?i:o.start.handle,p=t==="end"?a:o.end.handle,f=P.Med(u,p),m=P.Sub(u,p).per().uni().mul(o.handleArc.radius*2*Math.sign(e.props.bend)),v=Hg(o.handleArc.center,P.Add(f,m),o.handleArc.center,o.handleArc.radius);fn((v==null?void 0:v.length)===1);const b=P.Dist(f,v[0])*Math.sign(e.props.bend);Jc(b,c.props.bend)||(c.props.bend=b)}r.updateShape(c),n&&ov(r,e,t)}const v9=[iv],Vs={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},Ks={s:2,m:3.5,l:5,xl:10},Gh={s:18,m:24,l:36,xl:44},ql={s:18,m:22,l:26,xl:32},_ie={s:18,m:20,l:24,xl:28},Jl={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"},Tie=20,f0=4.25,Ri=16;function Mie(r,e){const t=r.w/e.w,n=r.h/e.h;return t<=1&&n<=1?r:t>n?{w:r.w/t,h:r.h/t}:{w:r.w/n,h:r.h/n}}/*!
 * MIT License
 * Adapted (mostly copied) the work of https://github.com/fregante/text-field-edit
 * Copyright (c) Federico Brigante <opensource@bfred.it> (bfred.it)
 */const wh="  ",no=class no{static insertTextFirefox(e,t){e.setRangeText(t,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:t,inputType:"insertText",isComposing:!1}))}static insert(e,t){const n=e.ownerDocument,s=n.activeElement;s!==e&&e.focus(),n.execCommand("insertText",!1,t)||no.insertTextFirefox(e,t),s===n.body?e.blur():s instanceof HTMLElement&&s!==e&&s.focus()}static set(e,t){e.select(),no.insert(e,t)}static getSelection(e){const{selectionStart:t,selectionEnd:n}=e;return e.value.slice(t||void 0,n||void 0)}static wrapSelection(e,t,n){const{selectionStart:s,selectionEnd:o}=e,i=no.getSelection(e);no.insert(e,t+i+(n??t)),e.selectionStart=(s||0)+t.length,e.selectionEnd=(o||0)+t.length}static replace(e,t,n){let s=0;e.value.replace(t,(...o)=>{const i=s+o[o.length-2],a=o[0].length;e.selectionStart=i,e.selectionEnd=i+a;const l=typeof n=="string"?n:n(...o);return no.insert(e,l),e.selectionStart=i,s+=l.length-a,l})}static findLineEnd(e,t){const n=e.lastIndexOf(`
`,t-1)+1;return e.charAt(n)!=="	"?t:n+1}static indent(e){var a;const{selectionStart:t,selectionEnd:n,value:s}=e,o=s.slice(t,n),i=(a=/\n/g.exec(o))==null?void 0:a.length;if(i&&i>0){const l=s.lastIndexOf(`
`,t-1)+1,c=e.value.slice(l,n-1),u=c.replace(/^|\n/g,`$&${wh}`),p=u.length-c.length;e.setSelectionRange(l,n-1),no.insert(e,u),e.setSelectionRange(t+1,n+p)}else no.insert(e,wh)}static unindent(e){const{selectionStart:t,selectionEnd:n,value:s}=e,o=s.lastIndexOf(`
`,t-1)+1,i=no.findLineEnd(s,n),a=e.value.slice(o,i),l=a.replace(/(^|\n)(\t| {1,2})/g,"$1"),c=a.length-l.length;e.setSelectionRange(o,i),no.insert(e,l);const u=/\t| {1,2}/.exec(s.slice(o,t)),p=u?u[0].length:0,f=t-p;e.setSelectionRange(t-p,Math.max(f,n-c))}static indentCE(e){var l;const t=window.getSelection(),n=e.innerText,s=Ny(e)??0,o=Ny(e)??0,i=n.slice(s,o),a=(l=/\n/g.exec(i))==null?void 0:l.length;if(a&&a>0){const c=n.lastIndexOf(`
`,s-1)+1,u=n.slice(c,o-1),f=u.replace(/^|\n/g,`$&${wh}`).length-u.length;t&&t.setBaseAndExtent(e,s+1,e,o+f)}else{const c=window.getSelection();e.innerText=n.slice(0,s)+wh+n.slice(s),c==null||c.setBaseAndExtent(e,s+1,e,s+2)}}static unindentCE(e){const t=window.getSelection(),n=e.innerText,s=Ny(e)??0,o=Ny(e)??0,i=n.lastIndexOf(`
`,s-1)+1,a=no.findLineEnd(n,o),l=n.slice(i,a),c=l.replace(/(^|\n)(\t| {1,2})/g,"$1"),u=l.length-c.length;if(t){t.setBaseAndExtent(e,i,e,a);const p=/\t| {1,2}/.exec(n.slice(i,s)),f=p?p[0].length:0,m=s-f;t.setBaseAndExtent(e,s-f,e,Math.max(m,o-u))}}static normalizeText(e){return e.replace(no.fixNewLines,`
`)}static normalizeTextForDom(e){return e.replace(no.fixNewLines,`
`).split(`
`).map(t=>t||" ").join(`
`)}};k(no,"fixNewLines",/\r?\n|\r/g);let Wh=no;function Ny(r){if(typeof window.getSelection>"u")return;const e=window.getSelection();if(!e)return;let t=0;if(e.rangeCount!==0){const n=e.getRangeAt(0),s=n.cloneRange();s.selectNodeContents(r),s.setEnd(n.endContainer,n.endOffset),t=s.toString().length}return t}const Aie=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function b9(r){return Aie.test(r)}function jie(r){return r.replace(/\t/g,wh)}function Rie(r){const e=r.split(`
`);for(;e[0]&&e[0].trim().length===0;)e.shift();let t=1/0;for(const n of e)if(n.trim().length>0){const s=n.length-n.trimStart().length;t=Math.min(t,s)}return e.map(n=>n.slice(t)).join(`
`)}const S9={"&amp;":"&","&quot;":'"',"&apos;":"'","&#34;":'"',"&#38;":"&","&#39;":"'","&#8211;":"–","&#8212;":"—","&#8216;":"‘","&#8217;":"’","&#8220;":"“","&#8221;":"”","&#8230;":"…"},Die=new RegExp(Object.keys(S9).join("|"),"g");function Oie(r){return r.replace(Die,e=>S9[e])}function Lie(r){return r.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function Nie(r){return Lie(Rie(jie(r)))}function Fie(r,{maxImageDimension:e,maxAssetSize:t,acceptedImageMimeTypes:n,acceptedVideoMimeTypes:s},{toasts:o,msg:i}){r.registerExternalAssetHandler("file",async({file:a,assetId:l})=>{const c=n.includes(a.type),u=s.includes(a.type);!c&&!u&&o.addToast({title:i("assets.files.type-not-allowed"),severity:"error"}),fn(c||u,`File type not allowed: ${a.type}`),a.size>t&&o.addToast({title:i("assets.files.size-too-big"),severity:"error"}),fn(a.size<=t,`File size too big: ${(a.size/1024).toFixed()}kb > ${(t/1024).toFixed()}kb`);const p=JT(await a.arrayBuffer());l=l??zc.createId(p);const f=await vD(a,l,c,u);if(isFinite(e)){const m={w:f.props.w,h:f.props.h},v=Mie(m,{w:e,h:e});m!==v&&ri.isStaticImageType(a.type)&&(f.props.w=v.w,f.props.h=v.h)}return f.props.src=await r.uploadAsset(f,a),zc.create(f)}),r.registerExternalAssetHandler("url",async({url:a})=>{var c,u,p,f,m;let l;try{const b=await(await al(a,{method:"GET",mode:"no-cors"})).text(),S=new DOMParser().parseFromString(b,"text/html");l={image:((c=S.head.querySelector('meta[property="og:image"]'))==null?void 0:c.getAttribute("content"))??"",favicon:((u=S.head.querySelector('link[rel="apple-touch-icon"]'))==null?void 0:u.getAttribute("href"))??((p=S.head.querySelector('link[rel="icon"]'))==null?void 0:p.getAttribute("href"))??"",title:((f=S.head.querySelector('meta[property="og:title"]'))==null?void 0:f.getAttribute("content"))??a,description:((m=S.head.querySelector('meta[property="og:description"]'))==null?void 0:m.getAttribute("content"))??""},l.image.startsWith("http")||(l.image=new URL(l.image,a).href),l.favicon.startsWith("http")||(l.favicon=new URL(l.favicon,a).href)}catch(v){console.error(v),o.addToast({title:i("assets.url.failed"),severity:"error"}),l={image:"",favicon:"",title:"",description:""}}return{id:zc.createId(oE(a)),typeName:"asset",type:"bookmark",props:{src:a,description:l.description,image:l.image,favicon:l.favicon,title:l.title},meta:{}}}),r.registerExternalContentHandler("svg-text",async({point:a,text:l})=>{const c=a??(r.inputs.shiftKey?r.inputs.currentPagePoint:r.getViewportPageBounds().center),u=new DOMParser().parseFromString(l,"image/svg+xml").querySelector("svg");if(!u)throw new Error("No <svg/> element present");let p=parseFloat(u.getAttribute("width")||"0"),f=parseFloat(u.getAttribute("height")||"0");if(!(p&&f)){document.body.appendChild(u);const v=u.getBoundingClientRect();document.body.removeChild(u),p=v.width,f=v.height}const m=await r.getAssetForExternalContent({type:"file",file:new File([l],"asset.svg",{type:"image/svg+xml"})});if(!m)throw Error("Could not create an asset");bD(r,[m],c)}),r.registerExternalContentHandler("embed",({point:a,url:l,embed:c})=>{const u=a??(r.inputs.shiftKey?r.inputs.currentPagePoint:r.getViewportPageBounds().center),{width:p,height:f}=c,m=vn(),v={id:m,type:"embed",x:u.x-(p||450)/2,y:u.y-(f||450)/2,props:{w:p,h:f,url:l}};r.createShapes([v]).select(m)}),r.registerExternalContentHandler("files",async({point:a,files:l})=>{if(l.length>r.options.maxFilesAtOnce)throw Error("Too many files");const c=a??(r.inputs.shiftKey?r.inputs.currentPagePoint:r.getViewportPageBounds().center),u=new P(c.x,c.y),p=[];for(const m of l){if(m.size>t){o.addToast({title:i("assets.files.size-too-big"),severity:"error"}),console.warn(`File size too big: ${(m.size/1024).toFixed()}kb > ${(t/1024).toFixed()}kb`);continue}if(!m.type){o.addToast({title:i("assets.files.upload-failed"),severity:"error"}),console.error("No mime type");continue}if(!n.concat(s).includes(m.type)){o.addToast({title:i("assets.files.type-not-allowed"),severity:"error"}),console.warn(`${m.name} not loaded - Mime type not allowed ${m.type}.`);continue}const v=n.includes(m.type),b=s.includes(m.type),S=JT(await m.arrayBuffer()),C=zc.createId(S),E=await vD(m,C,v,b);let T;v&&(T=r.createTemporaryAssetPreview(C,m)),p.push({asset:E,file:m,temporaryAssetPreview:T})}const f=[];await Promise.allSettled(p.map(async m=>{try{const v=await r.getAssetForExternalContent({type:"file",file:m.file});if(!v)throw Error("Could not create an asset");const b={...v,id:m.asset.id};f.push(b),r.updateAssets([b])}catch(v){o.addToast({title:i("assets.files.upload-failed"),severity:"error"}),console.error(v);return}})),bD(r,f,u)}),r.registerExternalContentHandler("text",async({point:a,text:l})=>{const c=a??(r.inputs.shiftKey?r.inputs.currentPagePoint:r.getViewportPageBounds().center),u=r.getShapeUtil("text").getDefaultProps(),p=Nie(l),f=r.getOnlySelectedShape();if(f&&"text"in f.props){r.updateShapes([{id:f.id,type:f.type,props:{text:p}}]);return}let m,v,b,S="middle";const C=p.split(`
`).length>1,E=b9(p);C&&(S=C?E?"end":"start":"middle");const T=r.textMeasure.measureText(p,{...Vs,fontFamily:Jl[u.font],fontSize:Gh[u.size],maxWidth:null}),w=Math.min(C?r.getViewportPageBounds().width*.9:920,Math.max(200,r.getViewportPageBounds().width*.9));if(T.w>w){const M=r.textMeasure.measureText(p,{...Vs,fontFamily:Jl[u.font],fontSize:Gh[u.size],maxWidth:w});m=M.w,v=M.h,b=!1,S=E?"end":"start"}else m=T.w,v=T.h,b=!0;c.y-v/2<r.getViewportPageBounds().minY+40&&(c.y=r.getViewportPageBounds().minY+40+v/2),r.createShapes([{id:vn(),type:"text",x:c.x-m/2,y:c.y-v/2,props:{text:p,textAlign:S,autoSize:b,w:m}}])}),r.registerExternalContentHandler("url",async({point:a,url:l})=>{const c=r.getShapeUtil("embed"),u=c==null?void 0:c.getEmbedDefinition(l);if(u)return r.putExternalContent({type:"embed",url:u.url,point:a,embed:u.definition});const p=a??(r.inputs.shiftKey?r.inputs.currentPagePoint:r.getViewportPageBounds().center),f=zc.createId(oE(l)),m=zie(r,l,p);let v=r.getAsset(f),b=!1;if(!v){b=!0;try{const S=await r.getAssetForExternalContent({type:"url",url:l});if(!S)throw Error("Could not create an asset");v=S}catch{o.addToast({title:i("assets.url.failed"),severity:"error"});return}}r.run(()=>{b&&r.createAssets([v]),r.updateShapes([{id:m.id,type:m.type,props:{assetId:v.id}}])})})}async function vD(r,e,t,n){let s=r.type;r.type==="video/quicktime"&&(s="video/mp4");const o=t?await ri.getImageSize(r):await ri.getVideoSize(r),i=await ri.isAnimated(r)||n;return{id:e,type:t?"image":"video",typeName:"asset",props:{name:r.name,src:"",w:o.w,h:o.h,fileSize:r.size,mimeType:s,isAnimated:i},meta:{}}}async function bD(r,e,t){if(!e.length)return[];const n=P.From(t),s=[];for(let o=0;o<e.length;o++){const i=e[o];switch(i.type){case"image":{s.push({id:vn(),type:"image",x:n.x,y:n.y,opacity:1,props:{assetId:i.id,w:i.props.w,h:i.props.h}}),n.x+=i.props.w;break}case"video":s.push({id:vn(),type:"video",x:n.x,y:n.y,opacity:1,props:{assetId:i.id,w:i.props.w,h:i.props.h}}),n.x+=i.props.w}}return r.run(()=>{const o=e.filter(i=>!r.getAsset(i.id));o.length&&r.createAssets(o),r.createShapes(s).select(...s.map(i=>i.id)),x9(r,t)}),s.map(o=>o.id)}function x9(r,e){const t=r.getViewportPageBounds();let n=r.getSelectionPageBounds();if(n){const s=n.center.sub(e);r.updateShapes(r.getSelectedShapes().map(o=>{const i=r.getShapeParentTransform(o).decompose().rotation,a=P.Rot(s,-i);return{id:o.id,type:o.type,x:o.x-a.x,y:o.y-a.y}}))}if(n=r.getSelectionPageBounds(),n&&r.getInstanceState().isGridMode){const s=r.getDocumentSettings().gridSize,o=new P(n.minX,n.minY),i=o.clone().snapToGrid(s),a=P.Sub(o,i);r.updateShapes(r.getSelectedShapes().map(l=>{const c={x:l.x-a.x,y:l.y-a.y};return{id:l.id,type:l.type,x:c.x,y:c.y}}))}n=r.getSelectionPageBounds(),n&&!t.contains(n)&&r.zoomToSelection({animation:{duration:r.options.animationMediumMs}})}function zie(r,e,t){const n={id:vn(),type:"bookmark",x:t.x-150,y:t.y-160,opacity:1,props:{assetId:null,url:e}};return r.run(()=>{r.createShapes([n]).select(n.id),x9(r,t)}),r.getShape(n.id)}var zC;let $ie=(zC=class extends nt{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}onKeyUp(e){var t;if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const n=this.editor.getOnlySelectedShape();n&&this.editor.getShapeUtil(n).canEdit(n)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(n.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:n}))}}},k(zC,"id","idle"),zC);var $C;let Bie=($C=class extends nt{constructor(){super(...arguments);k(this,"shape");k(this,"markId","");k(this,"preciseTimeout",-1);k(this,"didTimeout",!1)}onEnter(){this.markId="",this.didTimeout=!1;const t=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:n=>!n.isLocked&&this.editor.canBindShapes({fromShape:"arrow",toShape:n,binding:"arrow"}),margin:0,hitInside:!0,renderingOnly:!0});t?this.editor.setHintingShapes([t.id]):this.createArrowShape(),this.startPreciseTimeout()}onExit(){this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()}onPointerMove(){if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:{id:"end",type:"vertex",index:"a3",x:0,y:0},isCreating:!0,creatingMarkId:this.markId||void 0,onInteractionEnd:"arrow"})}}onPointerUp(){this.cancel()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle")}createArrowShape(){var p;const{originPagePoint:t}=this.editor.inputs,n=vn();this.markId=this.editor.markHistoryStoppingPoint(`creating_arrow:${n}`);const s=fa(t,this.editor);this.editor.createShape({id:n,type:"arrow",x:s.x,y:s.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const o=this.editor.getShape(n);if(!o)throw Error("expected shape");const i=this.editor.getShapeHandles(o);if(!i)throw Error("expected handles for arrow");const a=this.editor.getShapeUtil("arrow"),l=this.shape,c=i.find(f=>f.id==="start"),u=(p=a.onHandleDrag)==null?void 0:p.call(a,o,{handle:{...c,x:0,y:0},isPrecise:!0,initial:l});u&&this.editor.updateShapes([u]),this.shape=this.editor.getShape(n),this.editor.select(n)}updateArrowShapeEndHandle(){var s,o;const t=this.shape;if(!t)throw Error("expected shape");const n=this.editor.getShapeHandles(t);if(!n)throw Error("expected handles for arrow");{const i=this.editor.getShapeUtil("arrow"),a=this.shape,l=n.find(u=>u.id==="start"),c=(s=i.onHandleDrag)==null?void 0:s.call(i,t,{handle:{...l,x:0,y:0},isPrecise:this.didTimeout,initial:a});c&&this.editor.updateShapes([c])}{const i=this.editor.getShapeUtil("arrow"),a=this.shape,l=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint),c=n.find(p=>p.id==="end"),u=(o=i.onHandleDrag)==null?void 0:o.call(i,this.editor.getShape(t),{handle:{...c,x:l.x,y:l.y},isPrecise:!1,initial:a});u&&this.editor.updateShapes([u])}this.shape=this.editor.getShape(t.id)}startPreciseTimeout(){this.preciseTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&(this.didTimeout=!0)},320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}},k($C,"id","pointing"),$C);class XE extends nt{constructor(){super(...arguments);k(this,"shapeType","arrow")}static children(){return[$ie,Bie]}}k(XE,"id","arrow"),k(XE,"initial","idle");class OP extends nt{constructor(){super(...arguments);k(this,"info",{});k(this,"initialShape");k(this,"shapeType",this.parent.id==="highlight"?"highlight":"draw");k(this,"util",this.editor.getShapeUtil(this.shapeType));k(this,"isPen",!1);k(this,"isPenOrStylus",!1);k(this,"segmentMode","free");k(this,"didJustShiftClickToExtendPreviousShapeLine",!1);k(this,"pagePointWhereCurrentSegmentChanged",{});k(this,"pagePointWhereNextSegmentChanged",null);k(this,"lastRecordedPoint",{});k(this,"mergeNextPoint",!1);k(this,"currentLineLength",0);k(this,"markId",null)}onEnter(t){this.markId=null,this.info=t,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.startShape()}onPointerMove(){const{inputs:t}=this.editor;if(this.isPen&&!t.isPen&&this.markId){this.editor.bailToMark(this.markId),this.startShape();return}this.isPenOrStylus?P.Dist(t.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=t.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateDrawingShape()}onKeyDown(t){if(t.key==="Shift")switch(this.segmentMode){case"free":{this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_free":this.segmentMode="starting_straight"}this.updateDrawingShape()}onKeyUp(t){if(t.key==="Shift")switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":{this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_straight":{this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";break}}this.updateDrawingShape()}onExit(){this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()}canClose(){return this.shapeType!=="highlight"}getIsClosed(t,n,s){if(!this.canClose())return!1;const o=Ks[n],i=t[0].points[0],a=t[t.length-1],l=a.points[a.points.length-1];return i!==l&&this.currentLineLength>o*4*s&&P.DistMin(i,l,o*2*s)}startShape(){const{inputs:{originPagePoint:t,isPen:n}}=this.editor;this.markId=this.editor.markHistoryStoppingPoint("draw start");const{z:s=.5}=this.info.point;this.isPen=n,this.isPenOrStylus=n||s>0&&s<.5||s>.5&&s<1;const o=this.isPenOrStylus?s*1.25:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=t.clone(),this.initialShape){const a=this.editor.getShape(this.initialShape.id);if(a&&this.segmentMode==="straight"){this.didJustShiftClickToExtendPreviousShapeLine=!0;const l=gs(a.props.segments);if(!l)throw Error("Expected a previous segment!");const c=gs(l.points);if(!c)throw Error("Expected a previous point!");const{x:u,y:p}=this.editor.getPointInShapeSpace(a,t).toFixed(),f={type:this.segmentMode,points:[{x:c.x,y:c.y,z:+o.toFixed(2)},{x:u,y:p,z:+o.toFixed(2)}]},m=Ne.applyToPoint(this.editor.getShapePageTransform(a.id),c);this.pagePointWhereCurrentSegmentChanged=m,this.pagePointWhereNextSegmentChanged=null;const v=[...a.props.segments,f];this.currentLineLength<Ks[a.props.size]*4&&(this.currentLineLength=this.getLineLength(v));const b={id:a.id,type:this.shapeType,props:{segments:v}};this.canClose()&&(b.props.isClosed=this.getIsClosed(v,a.props.size,a.props.scale)),this.editor.updateShapes([b]);return}}this.pagePointWhereCurrentSegmentChanged=t.clone();const i=vn();this.editor.createShapes([{id:i,type:this.shapeType,x:t.x,y:t.y,props:{isPen:this.isPenOrStylus,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+o.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(i)}updateDrawingShape(){const{initialShape:t}=this,{inputs:n}=this.editor;if(!t)return;const{id:s,props:{size:o,scale:i}}=t,a=this.editor.getShape(s);if(!a)return;const{segments:l}=a.props,{x:c,y:u,z:p}=this.editor.getPointInShapeSpace(a,n.currentPagePoint).toFixed(),f=this.isPenOrStylus?+(n.currentPagePoint.z*1.25).toFixed(2):.5,m={x:c,y:u,z:f};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:v}=this;if(v===null)throw Error("We should have a point where the segment changed");if(P.Dist2(v,n.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const S=gs(l);if(!S)throw Error("Expected a previous segment!");const C=gs(S.points);if(!C)throw Error("Expected a previous last point!");let E;const T=this.editor.getPointInShapeSpace(a,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if(S.type==="straight"){this.currentLineLength+=P.Dist(C,T),E={type:"straight",points:[{...C},T]};const M=this.editor.getShapePageTransform(a);this.pagePointWhereCurrentSegmentChanged=Ne.applyToPoint(M,C)}else E={type:"straight",points:[T,m]};const w={id:s,type:this.shapeType,props:{segments:[...l,E]}};this.canClose()&&(w.props.isClosed=this.getIsClosed(l,o,i)),this.editor.updateShapes([w])}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:v}=this;if(v===null)throw Error("We should have a point where the segment changed");if(P.Dist2(v,n.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const S=l.slice(),C=S[S.length-1],E=gs(C.points);if(!E)throw Error("No previous point!");const T={type:"free",points:[...P.PointsBetween(E,m,6).map(R=>({x:zl(R.x),y:zl(R.y),z:zl(R.z)}))]},w=[...S,T];this.currentLineLength<Ks[a.props.size]*4&&(this.currentLineLength=this.getLineLength(w));const M={id:s,type:this.shapeType,props:{segments:w}};this.canClose()&&(M.props.isClosed=this.getIsClosed(w,o,i)),this.editor.updateShapes([M])}break}case"straight":{const v=l.slice(),b=v[v.length-1],{pagePointWhereCurrentSegmentChanged:S}=this,{ctrlKey:C,currentPagePoint:E}=this.editor.inputs;if(!S)throw Error("We should have a point where the segment changed");let T,w=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(w=!C,this.didJustShiftClickToExtendPreviousShapeLine=!1):w=!C;let M=this.editor.getPointInShapeSpace(a,E).toFixed().toJson(),R=!1,D;if((this.editor.user.getIsSnapMode()?!C:C)&&v.length>2){let L,B=8/this.editor.getZoomLevel();for(let K=0,O=l.length-2;K<O;K++){const U=l[K];if(!U)break;if(U.type==="free")continue;const X=U.points[0],H=gs(U.points);if(!(X&&H))continue;const ee=P.NearestPointOnLineSegment(X,H,M);if(P.DistMin(ee,M,B)){L=ee.toFixed().toJson(),B=P.Dist(ee,M),D=U;break}}L&&(R=!0,M=L)}if(R&&D){const L=this.editor.getShapePageTransform(a),B=D.points[0],K=gs(D.points);if(!K)throw Error("Expected a last point!");const O=Ne.applyToPoint(L,B),U=Ne.applyToPoint(L,K),X=Ne.applyToPoint(L,M);this.editor.snaps.setIndicators([{id:Cn(),type:"points",points:[O,X,U]}])}else{if(this.editor.snaps.clearIndicators(),w){const L=P.Angle(S,E),K=Zv(L,24)-L;T=P.RotWith(E,S,K)}else T=E;M=this.editor.getPointInShapeSpace(a,T).toFixed().toJson()}this.currentLineLength+=P.Dist(b.points[0],M),v[v.length-1]={...b,type:"straight",points:[b.points[0],M]};const z={id:s,type:this.shapeType,props:{segments:v}};this.canClose()&&(z.props.isClosed=this.getIsClosed(l,o,i)),this.editor.updateShapes([z]);break}case"free":{const v=l.slice(),b=v[v.length-1],S=[...b.points];if(S.length&&this.mergeNextPoint){const{z:E}=S[S.length-1];S[S.length-1]={x:m.x,y:m.y,z:E?Math.max(E,m.z):m.z}}else this.currentLineLength+=P.Dist(S[S.length-1],m),S.push(m);v[v.length-1]={...b,points:S},this.currentLineLength<Ks[a.props.size]*4&&(this.currentLineLength=this.getLineLength(v));const C={id:s,type:this.shapeType,props:{segments:v}};if(this.canClose()&&(C.props.isClosed=this.getIsClosed(v,o,i)),this.editor.updateShapes([C]),S.length>this.editor.options.maxPointsPerDrawShape){this.editor.updateShapes([{id:s,type:this.shapeType,props:{isComplete:!0}}]);const E=vn(),T=this.editor.getShape(s).props;this.editor.createShapes([{id:E,type:this.shapeType,x:zl(n.currentPagePoint.x),y:zl(n.currentPagePoint.y),props:{isPen:this.isPenOrStylus,scale:T.scale,segments:[{type:"free",points:[{x:0,y:0,z:this.isPenOrStylus?+(p*1.25).toFixed():.5}]}]}}]),this.initialShape=Kn(this.editor.getShape(E)),this.mergeNextPoint=!1,this.lastRecordedPoint=n.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(t){let n=0;for(const s of t)for(let o=0;o<s.points.length-1;o++){const i=s.points[o],a=s.points[o+1];n+=P.Dist2(a,i)}return Math.sqrt(n)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())}complete(){const{initialShape:t}=this;t&&(this.editor.updateShapes([{id:t.id,type:t.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}k(OP,"id","drawing");var BC;let w9=(BC=class extends nt{onPointerDown(e){this.parent.transition("drawing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}},k(BC,"id","idle"),BC);class av extends nt{constructor(){super(...arguments);k(this,"shapeType","draw")}static children(){return[w9,OP]}onExit(){const t=this.children.drawing;t.initialShape=void 0}}k(av,"id","draw"),k(av,"initial","idle"),k(av,"isLockable",!1);class ZE extends jE{constructor(){super(...arguments);k(this,"shapeType","frame")}onCreate(t){if(!t)return;const n=this.editor.getShapePageBounds(t),s=[],o=this.editor.getShapeAncestors(t).map(i=>i.id);this.editor.getSortedChildIdsForParent(t.parentId).map(i=>{const a=this.editor.getShape(i);if(!a||a.id===t.id||a.isLocked)return;const l=this.editor.getShapePageBounds(a);l&&n.contains(l)&&Uie(a,o,t)&&s.push(a.id)}),this.editor.reparentShapes(s,t.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")}}k(ZE,"id","frame"),k(ZE,"initial","idle");function Uie(r,e,t){return e.includes(r.id)?!1:r.parentId===t.parentId}var UC;let Hie=(UC=class extends nt{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onKeyUp(e){var t;if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const n=this.editor.getOnlySelectedShape();n&&this.editor.getShapeUtil(n).canEdit(n)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(n.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:n}))}}onCancel(){this.editor.setCurrentTool("select")}},k(UC,"id","idle"),UC);var HC;let Gie=(HC=class extends nt{onPointerUp(){this.complete()}onPointerMove(e){if(this.editor.inputs.isDragging){const{originPagePoint:t}=this.editor.inputs,n=vn(),s=this.editor.markHistoryStoppingPoint(`creating_geo:${n}`),o=fa(t,this.editor);this.editor.createShapes([{id:n,type:"geo",x:o.x,y:o.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(ca),scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]).select(n).setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:s,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){const{originPagePoint:e}=this.editor.inputs,t=vn();this.editor.markHistoryStoppingPoint(`creating_geo:${t}`);const n=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,s=this.editor.getStyleForNextShape(ca),o=s==="star"?{w:200,h:190}:s==="cloud"?{w:300,h:180}:{w:200,h:200};this.editor.createShapes([{id:t,type:"geo",x:e.x,y:e.y,props:{geo:this.editor.getStyleForNextShape(ca),scale:n,...o}}]);const i=this.editor.getShape(t);if(!i)return;const{w:a,h:l}=i.props,c=new P(a/2,l/2).mul(n),u=this.editor.getShapeParentTransform(i);u&&c.rot(-u.rotation());const p=fa(new P(i.x-c.x,i.y-c.y),this.editor);this.editor.select(t),this.editor.updateShape({id:i.id,type:"geo",x:p.x,y:p.y,props:{geo:this.editor.getStyleForNextShape(ca),w:a*n,h:l*n}}),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}},k(HC,"id","pointing"),HC);class JE extends nt{constructor(){super(...arguments);k(this,"shapeType","geo")}static children(){return[Hie,Gie]}}k(JE,"id","geo"),k(JE,"initial","idle");class lv extends nt{constructor(){super(...arguments);k(this,"shapeType","highlight")}static children(){return[w9,OP]}onExit(){const t=this.children.drawing;t.initialShape=void 0}}k(lv,"id","highlight"),k(lv,"initial","idle"),k(lv,"isLockable",!1);var GC;let Wie=(GC=class extends nt{constructor(){super(...arguments);k(this,"shapeId","")}onEnter(t){this.shapeId=t.shapeId,this.editor.setCursor({type:"cross",rotation:0})}onPointerDown(){this.parent.transition("pointing",{shapeId:this.shapeId})}onCancel(){this.editor.setCurrentTool("select")}},k(GC,"id","idle"),GC);const SD=2;var WC;let Kie=(WC=class extends nt{constructor(){super(...arguments);k(this,"shape",{});k(this,"markId")}onEnter(t){const{inputs:n}=this.editor,{currentPagePoint:s}=n;this.markId=void 0;const o=t.shapeId&&this.editor.getShape(t.shapeId);if(o&&n.shiftKey){this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${o.id}`),this.shape=o;const i=this.editor.getShapeHandles(this.shape);if(!i)return;const a=i.filter(v=>v.type==="vertex").sort(Hs),l=a[a.length-1],c=a[a.length-2],u=Ne.applyToPoint(this.editor.getShapeParentTransform(this.shape),new P(this.shape.x,this.shape.y)),p=P.Sub(s,u).addXY(.1,.1),f=fa(p,this.editor),m=Kn(this.shape.props.points);if(P.DistMin(l,c,SD)||P.DistMin(f,l,SD))m[l.id]={id:l.id,index:l.index,x:f.x,y:f.y};else{const v=Za(l.index);m[v]={id:v,index:v,x:f.x,y:f.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points:m}}])}else{const i=vn();this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${i}`);const a=fa(s,this.editor);this.editor.createShapes([{id:i,type:"line",x:a.x,y:a.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]),this.editor.select(i),this.shape=this.editor.getShape(i)}}onPointerMove(){if(this.shape&&this.editor.inputs.isDragging){const t=this.editor.getShapeHandles(this.shape);if(!t)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const n=gs(t);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,creatingMarkId:this.markId,handle:{...n,x:n.x-.1,y:n.y-.1},onInteractionEnd:"line"})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}},k(WC,"id","pointing"),WC);class QE extends nt{constructor(){super(...arguments);k(this,"shapeType","line")}static children(){return[Wie,Kie]}}k(QE,"id","line"),k(QE,"initial","idle");var KC;let Vie=(KC=class extends nt{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}},k(KC,"id","idle"),KC);const qie=0,_n=200,Fb=new P(_n/2,_n/2),C9=10,Yie=r=>[[["a1"],new P(_n*.5,_n*-.5-r.options.adjacentShapeMargin)],[["a2"],new P(_n*1.5+r.options.adjacentShapeMargin,_n*.5)],[["a3"],new P(_n*.5,_n*1.5+r.options.adjacentShapeMargin)],[["a4"],new P(_n*-.5-r.options.adjacentShapeMargin,_n*.5)]];function Xie(r,e){if(e===1)return Yie(r);const t=_n*e,n=r.options.adjacentShapeMargin*e;return[[["a1"],new P(t*.5,t*-.5-n)],[["a2"],new P(t*1.5+n,t*.5)],[["a3"],new P(t*.5,t*1.5+n)],[["a4"],new P(t*-.5-n,t*.5)]]}function E9(r,e,t,n,s,o){return Object.fromEntries(Xie(r,o).map(([i,a],l)=>{const c=a.clone();return l===0&&s?c.y-=s:l===2&&n&&(c.y+=n),[i,c.rot(t).add(e)]}))}function k9(r,e,t,n){const s=new Set(r.getSelectedShapeIds()),o=(_n+r.options.adjacentShapeMargin+n)**2,i=new Map,a=[];for(const u of r.getCurrentPageShapes()){if(!r.isShapeOfType(u,"note")||t!==u.props.scale||s.has(u.id))continue;const p=r.getShapePageTransform(u.id);e===p.rotation()&&(i.set(u,r.getShapePageBounds(u).center),a.push(...Object.values(E9(r,p.point(),e,u.props.growY,n,t))))}const l=a.length;let c;for(const[u,p]of i)for(let f=0;f<l;f++)c=a[f],c&&(P.Dist2(p,c)>o||r.isPointInShape(u,c)&&(a[f]=void 0));return kt(a)}function P9(r,e,t,n,s=!1){let o;const i=r.getCurrentPageShapesSorted(),a=(_n+r.options.adjacentShapeMargin**2)**e.props.scale;for(let l=i.length-1;l>=0;l--){const c=i[l];if(c.type==="note"&&c.id!==e.id){const u=r.getShapePageBounds(c);if(u&&P.Dist2(u.center,t)<a&&r.isPointInShape(c,t)){o=c;break}}}if(r.complete(),!o||s){r.markHistoryStoppingPoint("creating note shape");const l=vn();r.createShape({id:l,type:"note",x:t.x,y:t.y,rotation:n,opacity:e.opacity,props:{...e.props,text:"",growY:0,fontSizeAdjustment:0,url:""}});const c=r.getShape(l);if(!c)return;const u=r.getPointInParentSpace(c,P.Sub(t,P.Rot(Fb.clone().mul(c.props.scale),n)));r.updateShape({id:l,type:"note",x:u.x,y:u.y}),o=r.getShape(l)}return Jie(r),o}const Zie=16;function Jie(r){const e=r.getSelectionPageBounds(),t=r.getViewportPageBounds();if(e&&!t.contains(e)){const n=e.clone().expandBy(Zie/r.getZoomLevel()).expand(t),s=t.clone().translate({x:(n.center.x-t.center.x)*2,y:(n.center.y-t.center.y)*2});r.zoomToBounds(s,{animation:{duration:r.options.animationMediumMs},inset:0})}}var VC;let Qie=(VC=class extends nt{constructor(){super(...arguments);k(this,"dragged",!1);k(this,"info",{});k(this,"markId","");k(this,"shape",{})}onEnter(){const{editor:t}=this,n=vn();this.markId=t.markHistoryStoppingPoint(`creating_note:${n}`);const s=this.editor.inputs.originPagePoint.clone(),o=eae(this.editor,s,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);o&&s.sub(o),this.shape=tae(this.editor,n,s)}onPointerMove(t){this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.translating",{...t,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,creatingMarkId:this.markId,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}})}onPointerUp(){this.complete()}onInterrupt(){this.cancel()}onComplete(){this.complete()}onCancel(){this.cancel()}complete(){this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape}))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}},k(VC,"id","pointing"),VC);function eae(r,e,t){let n=C9/r.getZoomLevel(),s;for(const o of k9(r,0,t,0)){const i=P.Sub(e,o),a=i.len();a<n&&(n=a,s=i)}return s}function tae(r,e,t){r.createShape({id:e,type:"note",x:t.x,y:t.y,props:{scale:r.user.getIsDynamicResizeMode()?1/r.getZoomLevel():1}}).select(e);const n=r.getShape(e),s=r.getShapeGeometry(n).bounds,o=fa(new P(n.x-s.width/2,n.y-s.height/2),r);return r.updateShapes([{id:e,type:"note",x:o.x,y:o.y}]),r.getShape(e)}class ek extends nt{constructor(){super(...arguments);k(this,"shapeType","note")}static children(){return[Vie,Qie]}}k(ek,"id","note"),k(ek,"initial","idle");function nae(r){const e=r.getShapeAtPoint(r.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:r.options.hitTestMargin/r.getZoomLevel(),renderingOnly:!0});if(!e)return r.setHoveredShape(null);let t;const n=r.getOutermostSelectableShape(e);return n===e||n.id===r.getFocusedGroupId()||r.getSelectedShapeIds().includes(n.id)?t=e:t=n,r.setHoveredShape(t.id)}const Bl=_O(nae,32);var qC;let rae=(qC=class extends nt{onPointerMove(e){switch(e.target){case"shape":case"canvas":Bl(this.editor)}}onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onExit(){Bl.cancel()}onKeyDown(e){var t;if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const n=this.editor.getOnlySelectedShape();n&&this.editor.getShapeUtil(n).canEdit(n)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(n.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:n}))}}onCancel(){this.editor.setCurrentTool("select")}},k(qC,"id","idle"),qC);var YC;let sae=(YC=class extends nt{constructor(){super(...arguments);k(this,"shape");k(this,"markId","");k(this,"enterTime",0)}onEnter(){this.enterTime=Date.now()}onExit(){this.editor.setHintingShapes([])}onPointerMove(t){if(Date.now()-this.enterTime<150)return;const{editor:n}=this,{isPointing:s}=n.inputs;if(!s)return;const{originPagePoint:o,currentPagePoint:i}=n.inputs,a=Math.abs(o.x-i.x),c=Math.sqrt(n.getInstanceState().isCoarsePointer?n.options.coarseDragDistanceSquared:n.options.dragDistanceSquared)*6/n.getZoomLevel();if(a>c){const u=vn();this.markId=n.markHistoryStoppingPoint(`creating_text:${u}`);const p=this.createTextShape(u,o,!1,a);if(!p){this.cancel();return}this.shape=n.getShape(p),n.select(u),n.setCurrentTool("select.resizing",{...t,target:"selection",handle:"right",isCreating:!0,creatingMarkId:this.markId,creationCursorOffset:{x:a,y:1},onInteractionEnd:"text",onCreate:()=>{n.setEditingShape(p.id)}})}}onPointerUp(){this.complete()}onComplete(){this.cancel()}onCancel(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.editor.markHistoryStoppingPoint("creating text shape");const t=vn(),{originPagePoint:n}=this.editor.inputs;this.createTextShape(t,n,!0,20)&&(this.editor.select(t),this.editor.setEditingShape(t))}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}createTextShape(t,n,s,o){this.editor.createShape({id:t,type:"text",x:n.x,y:n.y,props:{text:"",autoSize:s,w:o,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const i=this.editor.getShape(t);if(!i){this.cancel();return}const a=this.editor.getShapePageBounds(i),l=new P;if(s)switch(i.props.textAlign){case"start":{l.x=0;break}case"middle":{l.x=-a.width/2;break}case"end":{l.x=-a.width;break}}else l.x=0;if(l.y=-a.height/2,Oo(i.parentId)){const p=this.editor.getShapeParentTransform(i);l.rot(-p.rotation())}const c=i.x+l.x,u=i.y+l.y;if(this.editor.getInstanceState().isGridMode){const p=new P(c,u),f=fa(p,this.editor),m=P.Sub(p,f);this.editor.updateShape({...i,x:c-m.x,y:u-m.y})}else this.editor.updateShape({...i,x:c,y:u});return i}},k(YC,"id","pointing"),YC);class tk extends nt{constructor(){super(...arguments);k(this,"shapeType","text")}static children(){return[rae,sae]}}k(tk,"id","text"),k(tk,"initial","idle");const oae=[tk,av,JE,ek,QE,ZE,XE,lv];function Bi(){return rc({isDarkMode:qg()})}function zb(r){return{key:`${ll.id}:${r}`,async getElement(){const e=iae(r);if(!e)return null;const{url:t,fontFaceRule:n}=e,s=await(await al(t)).blob(),o=await aa.blobToDataUrl(s),i=n.replace(t,o);return g.jsx("style",{children:i})}}}function iae(r){const e=X3[r];for(const t of document.fonts)if(e.includes(t.family)&&"$$_url"in t&&typeof t.$$_url=="string"&&"$$_fontface"in t&&typeof t.$$_fontface=="string")return{url:t.$$_url,fontFaceRule:t.$$_fontface};return null}function LP(r){return{key:`${ll.id}:${r}`,async getElement(){return r!=="pattern"?null:g.jsx(aae,{})}}}function aae(){const r=FP(),e=sp(),t=Bi(),n=8/12;return g.jsxs(g.Fragment,{children:[g.jsxs("mask",{id:e,children:[g.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:"white"}),g.jsxs("g",{strokeLinecap:"round",stroke:"black",children:[g.jsx("line",{x1:n*1,y1:n*3,x2:n*3,y2:n*1}),g.jsx("line",{x1:n*5,y1:n*7,x2:n*7,y2:n*5}),g.jsx("line",{x1:n*9,y1:n*11,x2:n*11,y2:n*9})]})]}),g.jsx("pattern",{id:r(1,t.id),width:"8",height:"8",patternUnits:"userSpaceOnUse",children:g.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:t.solid,mask:`url(#${e})`})})]})}function NP(){return{key:`${ll.id}:pattern`,component:uae}}const vf=8,xD=(r,e,t)=>new Promise((n,s)=>{const o=vf*e*r,i=document.createElement("canvas");i.width=o,i.height=o;const a=i.getContext("2d");if(!a)return;a.fillStyle=t?Gv.darkMode.solid:Gv.lightMode.solid,a.fillRect(0,0,o,o),a.globalCompositeOperation="destination-out",a.lineCap="round",a.lineWidth=1.25*e*r;const l=8/12,c=u=>u*e*r;a.beginPath(),a.moveTo(c(l*1),c(l*3)),a.lineTo(c(l*3),c(l*1)),a.moveTo(c(l*5),c(l*7)),a.lineTo(c(l*7),c(l*5)),a.moveTo(c(l*9),c(l*11)),a.lineTo(c(l*11),c(l*9)),a.stroke(),i.toBlob(u=>{!u||_r.throwToBlob.get()?s():n(u)})}),wD=(r,e)=>{const t=document.createElement("canvas");t.width=r[0],t.height=r[1];const n=t.getContext("2d");return n?(e(n),t.toDataURL()):""};let EC=null;function lae(){return EC||(EC={white:wD([1,1],r=>{r.fillStyle="#f8f9fa",r.fillRect(0,0,1,1)}),black:wD([1,1],r=>{r.fillStyle="#212529",r.fillRect(0,0,1,1)})}),EC}function I9(r){return Math.ceil(Math.log2(Math.max(1,r)))}function FP(){const r=ha("hash_pattern");return I.useCallback((e,t)=>{const n=I9(e);return y2(r,`${t}_${n}`)},[r])}function _9(r){const e=[],n=I9(r);for(let s=0;s<=n;s++)e.push(Math.pow(2,s));return e}function cae(r){const e=lae();return _9(r).flatMap(t=>[{zoom:t,url:e.white,theme:"light"},{zoom:t,url:e.black,theme:"dark"}])}function dae(){const r=ue(),e=ye("devicePixelRatio",()=>r.getInstanceState().devicePixelRatio,[r]),t=ye("maxZoom",()=>Math.ceil(gs(r.getCameraOptions().zoomSteps)),[r]),[n,s]=I.useState(!1),[o,i]=I.useState(()=>cae(t)),a=FP();return I.useEffect(()=>{const c=Promise.all(_9(t).flatMap(p=>[xD(e,p,!1).then(f=>({zoom:p,theme:"light",url:URL.createObjectURL(f)})),xD(e,p,!0).then(f=>({zoom:p,theme:"dark",url:URL.createObjectURL(f)}))]));let u=!1;return c.then(p=>{u||(i(p),s(!0))}),()=>{u=!0,s(!1),c.then(p=>{for(const{url:f}of p)URL.revokeObjectURL(f)})}},[e,t]),{defs:g.jsx(g.Fragment,{children:o.map(c=>{const u=a(c.zoom,c.theme);return g.jsx("pattern",{id:u,width:vf,height:vf,patternUnits:"userSpaceOnUse",children:g.jsx("image",{href:c.url,width:vf,height:vf})},u)})}),isReady:n}}function uae(){const r=ue(),e=I.useRef(null),{defs:t,isReady:n}=dae();return I.useEffect(()=>{if(n&&Rn.isSafari){const s=T9(e.current);s&&r.timers.requestAnimationFrame(()=>{s.style.display="none",r.timers.requestAnimationFrame(()=>{s.style.display=""})})}},[r,n]),g.jsx("g",{ref:e,"data-testid":n?"ready-pattern-fill-defs":void 0,children:t})}function T9(r){return r.classList.contains("tl-html-layer")?r:r.parentElement?T9(r.parentElement):null}const Ns=Ht.memo(function({theme:e,d:t,color:n,fill:s,scale:o}){switch(s){case"none":return null;case"solid":return g.jsx("path",{fill:e[n].semi,d:t});case"semi":return g.jsx("path",{fill:e.solid,d:t});case"fill":return g.jsx("path",{fill:e[n].fill,d:t});case"pattern":return g.jsx(hae,{theme:e,color:n,fill:s,d:t,scale:o})}});function hae({d:r,color:e,theme:t}){const n=ue(),s=Gg(),o=ye("zoomLevel",()=>n.getZoomLevel(),[n]),i=FP(),a=n.getZoomLevel()<=.18;return g.jsxs(g.Fragment,{children:[g.jsx("path",{fill:t[e].pattern,d:r}),g.jsx("path",{fill:s?`url(#${i(1,t.id)})`:a?t[e].semi:`url(#${i(o,t.id)})`,d:r})]})}function pae(r){return r.replace(/\s/g," ")}function nk(r,e,t){const{padding:n=0}=t;if(e.length===0)return null;const s=Ve.From(e[0].box);for(const{box:c}of e)s.union(c);const o=n+(t.offsetX??0),i=(t.offsetY??0)+t.fontSize/2+(t.verticalTextAlign==="start"?n:t.verticalTextAlign==="end"?t.height-n-s.height:(Math.ceil(t.height)-s.height)/2);let a=null;const l=[];for(const{text:c,box:u}of e)a!==null&&u.y>a&&l.push(g.jsx("tspan",{alignmentBaseline:"mathematical",x:o,y:u.y+i,children:`
`},l.length)),l.push(g.jsx("tspan",{alignmentBaseline:"mathematical",x:u.x+o,y:u.y+i,unicodeBidi:"plaintext",children:pae(c)},l.length)),a=u.y;return g.jsx("text",{fontSize:t.fontSize,fontFamily:t.fontFamily,fontStyle:t.fontStyle,fontWeight:t.fontWeight,dominantBaseline:"mathematical",alignmentBaseline:"mathematical",stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill,children:l})}function fae(r,e,t,n){if((r==="start-legacy"||r==="end-legacy")&&t.length!==0){const s=Ve.From(t[0].box);for(const{box:o}of t)s.union(o);if(r==="start-legacy")return(n-2*e-s.width)/2;if(r==="end-legacy")return-(n-2*e-s.width)/2}}function gae(r){return r==="start-legacy"||r==="middle-legacy"||r==="end-legacy"}function $b({fontSize:r,font:e,align:t,verticalAlign:n,text:s,labelColor:o,bounds:i,padding:a=16,stroke:l=!0}){const c=ue(),u=Bi(),p={fontSize:r,fontFamily:X3[e],textAlign:t,verticalTextAlign:n,width:Math.ceil(i.width),height:Math.ceil(i.height),padding:a,lineHeight:Vs.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0,offsetY:0,fill:o,stroke:void 0,strokeWidth:void 0},f=c.textMeasure.measureTextSpans(s,p),m=fae(t,a,f,i.width);m&&(p.offsetX=m),p.offsetX+=i.x,p.offsetY+=i.y;const v=nk(c,f,p);let b=null;return l&&(p.fill=u.background,p.stroke=u.background,p.strokeWidth=2,b=nk(c,f,p)),g.jsxs(g.Fragment,{children:[b,v]})}const mae=I.forwardRef(function({isEditing:e,text:t,handleFocus:n,handleChange:s,handleKeyDown:o,handleBlur:i,handleInputPointerDown:a,handleDoubleClick:l},c){return g.jsx("textarea",{ref:c,className:"tl-text tl-text-input",name:"text",tabIndex:-1,readOnly:!e,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",autoSave:"off",placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",defaultValue:t,onFocus:n,onChange:s,onKeyDown:o,onBlur:i,onTouchEnd:Ar,onContextMenu:e?Ar:void 0,onPointerDown:a,onDoubleClick:l,onDragStart:Ot})});function yae(r,e,t){const n=ue(),s=I.useRef(null),o=ye("isEditing",()=>n.getEditingShapeId()===r,[n]),i=ye("isEditingAnything",()=>!!n.getEditingShapeId(),[n]);I.useEffect(()=>{function u(p){var f;p.shapeId===r&&((f=s.current)==null||f.select())}return n.on("select-all-text",u),()=>{n.off("select-all-text",u)}},[n,r,o]),I.useEffect(()=>{var u,p,f,m;o&&(document.activeElement!==s.current&&((u=s.current)==null||u.focus()),n.getInstanceState().isCoarsePointer&&((p=s.current)==null||p.select()),Rn.isSafari&&((f=s.current)==null||f.blur(),(m=s.current)==null||m.focus()))},[n,o]);const a=I.useCallback(u=>{if(n.getEditingShapeId()===r)switch(u.key){case"Enter":{(u.ctrlKey||u.metaKey)&&n.complete();break}}},[n,r]),l=I.useCallback(u=>{if(n.getEditingShapeId()!==r)return;let p=Wh.normalizeText(u.currentTarget.value);const f=p.replace(/\t/g,wh);if(f!==p){const m=u.currentTarget.selectionStart;u.currentTarget.value=f,u.currentTarget.selectionStart=m+(f.length-p.length),u.currentTarget.selectionEnd=m+(f.length-p.length),p=f}n.updateShape({id:r,type:e,props:{text:p}})},[n,r,e]),c=I.useCallback(u=>{n.dispatch({...si(u),type:"pointer",name:"pointer_down",target:"shape",shape:n.getShape(r)}),Ar(u)},[n,r]);return{rInput:s,handleFocus:Nf,handleBlur:Nf,handleKeyDown:a,handleChange:l,handleInputPointerDown:c,handleDoubleClick:Ar,isEmpty:t.trim().length===0,isEditing:o,isEditingAnything:i}}const Bb=Ht.memo(function({shapeId:e,type:t,text:n,labelColor:s,font:o,fontSize:i,lineHeight:a,align:l,verticalAlign:c,wrap:u,isSelected:p,padding:f=0,onKeyDown:m,classNamePrefix:v,style:b,textWidth:S,textHeight:C}){const{rInput:E,isEmpty:T,isEditing:w,isEditingAnything:M,...R}=yae(e,t,n),[D,N]=I.useState(n);I.useEffect(()=>{w||N(n)},[w,n]);const z=Wh.normalizeTextForDom(n),L=z.length>0,B=gae(l);if(!w&&!L)return null;const K=v||"tl-text";return g.jsx("div",{className:`${K}-label tl-text-wrapper`,"data-font":o,"data-align":l,"data-hastext":!T,"data-isediting":w,"data-iseditinganything":M,"data-textwrap":!!u,"data-isselected":p,style:{justifyContent:l==="middle"||B?"center":l,alignItems:c==="middle"?"center":c,padding:f,...b},children:g.jsxs("div",{className:`${K}-label__inner tl-text-content__wrapper`,style:{fontSize:i,lineHeight:Math.floor(i*a)+"px",minHeight:Math.floor(i*a)+"px",minWidth:Math.ceil(S||0),color:s,width:S?Math.ceil(S):void 0,height:C?Math.ceil(C):void 0},children:[g.jsx("div",{className:`${K} tl-text tl-text-content`,dir:"auto",children:z.split(`
`).map((O,U)=>g.jsx("div",{dir:"auto",children:O},U))}),(M||p)&&g.jsx(mae,{ref:E,text:n,isEditing:w,...R,handleKeyDown:m??R.handleKeyDown},D)]})})}),vae=new il;function bae(r){return vae.get(r,()=>r.store.createComputedCache("arrowLabelSize",e=>{const t=Qa(r,e);let n=0,s=0;const o=t.isStraight?new $l({start:P.From(t.start.point),end:P.From(t.end.point)}):new vh({center:P.Cast(t.handleArc.center),start:P.Cast(t.start.point),end:P.Cast(t.end.point),sweepFlag:t.bodyArc.sweepFlag,largeArcFlag:t.bodyArc.largeArcFlag});if(e.props.text.trim()){const i=o.bounds,a=rk(e),{w:l,h:c}=r.textMeasure.measureText(e.props.text,{...Vs,fontFamily:Jl[e.props.font],fontSize:a,maxWidth:null});n=l,s=c;let u=!1;if(i.width>i.height?(n=Math.max(Math.min(l,64),Math.min(i.width-64,l)),u=!0):n>16*a&&(n=16*a,u=!0),u){const{w:p,h:f}=r.textMeasure.measureText(e.props.text,{...Vs,fontFamily:Jl[e.props.font],fontSize:a,maxWidth:n});n=p,s=f}}return new P(n,s).addScalar(f0*2*e.props.scale)}))}function zP(r,e){return e.props.text.trim()===""?new P(0,0).addScalar(f0*2*e.props.scale):bae(r).get(e.id)??new P(0,0)}function M9(r){const e=Ks[r.props.size];return(Tie+(e-Ks.s)*2+(e===Ks.xl?20:0))*r.props.scale}function Sae(r,e,t){const n=zP(r,e),s=M9(e),o=P.Nudge(t.start.point,t.end.point,s),i=P.Nudge(t.end.point,t.start.point,s),a=T2(o,i,Ve.FromCenter(t.middle,n).corners);if(!a||a.length!==2)return{start:.5,end:.5};let[l,c]=a;P.Dist2(l,o)>P.Dist2(c,o)&&([c,l]=a);const u=o.add(P.Sub(t.middle,l)),p=i.add(P.Sub(t.middle,c)),f=P.Dist(t.start.point,u)/t.length,m=P.Dist(t.start.point,p)/t.length;return{start:f,end:m}}function xae(r,e,t){const n=zP(r,e),s=M9(e),o=Math.sign(e.props.bend),i=s/t.handleArc.radius*o,a=P.Angle(t.bodyArc.center,t.start.point)-i,l=P.Angle(t.bodyArc.center,t.end.point)+i,c=uu(t.bodyArc.center,t.bodyArc.radius,a),u=uu(t.bodyArc.center,t.bodyArc.radius,l),p=[],f=ED(t.bodyArc.center,t.bodyArc.radius,a,l,o,Ve.FromCenter(c,n).corners);p.push(new Er({points:Ve.FromCenter(c,n).corners,debugColor:"lime",isFilled:!1,ignore:!0}));const m=ED(t.bodyArc.center,t.bodyArc.radius,a,l,o,Ve.FromCenter(u,n).corners);p.push(new Er({points:Ve.FromCenter(u,n).corners,debugColor:"lime",isFilled:!1,ignore:!0}));for(const D of[...f??[],...m??[],c,u])p.push(new U2({x:D.x-3,y:D.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));const v=(f&&kD(t.start.point,f))??t.middle,b=(m&&kD(t.end.point,m))??t.middle,S=P.Angle(t.bodyArc.center,t.start.point),C=P.Angle(t.bodyArc.center,t.end.point),E=P.Angle(t.bodyArc.center,v),T=P.Angle(t.bodyArc.center,b);if($c(S,E,o)>$c(S,T,o))return{start:.5,end:.5,dbg:p};const w=$c(S,C,o),M=$c(S,E,o)/w,R=$c(S,T,o)/w;return{start:M,end:R,dbg:p}}function cv(r,e){let t;const n=[],s=Qa(r,e),o={hasStartBinding:!!s.bindings.start,hasEndBinding:!!s.bindings.end,hasStartArrowhead:s.start.arrowhead!=="none",hasEndArrowhead:s.end.arrowhead!=="none"};if(s.isStraight){const a=Sae(r,e,s),l=CD(r,e,a,o);t=P.Lrp(s.start.point,s.end.point,l)}else{const a=xae(r,e,s);a.dbg&&n.push(...a.dbg);const l=CD(r,e,a,o),c=wae(P.Angle(s.bodyArc.center,s.start.point),P.Angle(s.bodyArc.center,s.end.point),Math.sign(e.props.bend),l);t=uu(s.bodyArc.center,s.bodyArc.radius,c)}const i=zP(r,e);return{box:Ve.FromCenter(t,i),debugGeom:n}}function CD(r,e,t,n){const{hasEndArrowhead:s,hasEndBinding:o,hasStartBinding:i,hasStartArrowhead:a}=n,l=D9(r,e);let c=ps(e.props.labelPosition,a||i?t.start:0,s||o?t.end:1);const u=Math.min(.02,500/l*.02);return c=c>=.5-u&&c<=.5+u?.5:c,c}function ED(r,e,t,n,s,o){const i=EE(r,e,o),a=$c(t,n,s);return i==null?void 0:i.filter(l=>{const c=$c(t,P.Angle(r,l),s);return c>=0&&c<=a})}function kD(r,e){let t=null,n=-1/0;for(const s of e){const o=P.Dist2(r,s);o>n&&(t=s,n=o)}return t}function wae(r,e,t,n){const s=$c(r,e,t);return r+s*n*t*-1}function rk(r){return _ie[r.props.size]*r.props.scale}function Cae(r,e,t){const n=e==="end"?r.end.point:r.start.point,s=e==="end"?r.start.point:r.end.point,o=r.isStraight?P.Dist(s,n):Math.abs(r.bodyArc.length),i=Math.max(Math.min(o/5,t*3),t);let a;if(r.isStraight)a=P.Nudge(n,s,i);else{const l=tX(n,i,r.handleArc.center,r.handleArc.radius);a=e==="end"?r.handleArc.sweepFlag?l[0]:l[1]:r.handleArc.sweepFlag?l[1]:l[0]}return P.IsNaN(a)&&(a=r.start.point),{point:n,int:a}}function Eae({point:r,int:e}){const t=P.RotWith(e,r,cn/6),n=P.RotWith(e,r,-cn/6);return`M ${t.x} ${t.y} L ${r.x} ${r.y} L ${n.x} ${n.y}`}function kae({point:r,int:e}){const t=P.RotWith(e,r,cn/6),n=P.RotWith(e,r,-cn/6);return`M ${t.x} ${t.y} L ${n.x} ${n.y} L ${r.x} ${r.y} Z`}function Pae({point:r,int:e}){const t=P.Sub(e,r).div(2),n=P.Add(r,P.Rot(t,Bn)),s=P.Sub(r,P.Rot(t,Bn));return`M ${n.x} ${n.y} L ${e.x} ${e.y} L ${s.x} ${s.y} Z`}function Iae({point:r,int:e}){const t=P.Lrp(r,e,.45),n=P.Dist(t,r);return`M ${t.x-n},${t.y}
  a ${n},${n} 0 1,0 ${n*2},0
  a ${n},${n} 0 1,0 -${n*2},0 `}function _ae({point:r,int:e}){const t=P.Lrp(r,e,.75),n=P.RotWith(t,r,cn/4),s=P.RotWith(t,r,-cn/4),o=P.Lrp(n,s,.5);return o.add(P.Sub(o,r)),`M ${o.x} ${o.y} L ${s.x} ${s.y} ${r.x} ${r.y} L ${n.x} ${n.y} Z`}function Tae({int:r,point:e}){const t=P.Lrp(e,r,.85),n=P.Sub(t,e).div(2),s=P.Add(e,P.Rot(n,Bn)),o=P.Sub(e,P.Rot(n,Bn)),i=P.Add(t,P.Rot(n,Bn)),a=P.Sub(t,P.Rot(n,Bn));return`M ${s.x} ${s.y} L ${i.x} ${i.y} L ${a.x} ${a.y} L ${o.x} ${o.y} Z`}function Mae({int:r,point:e}){const t=P.Sub(r,e).div(2),n=P.Add(e,P.Rot(t,Bn)),s=P.Sub(e,P.Rot(t,Bn));return`M ${n.x} ${n.y} L ${s.x} ${s.y}`}function g0(r,e,t){const n=e==="end"?r.end.arrowhead:r.start.arrowhead;if(n==="none")return;const s=Cae(r,e,t);if(s){switch(n){case"bar":return Mae(s);case"square":return Tae(s);case"diamond":return _ae(s);case"dot":return Iae(s);case"inverted":return Pae(s);case"arrow":return Eae(s);case"triangle":return kae(s)}return""}}function Aae(r){const{start:e,end:t,handleArc:{radius:n,largeArcFlag:s,sweepFlag:o}}=r;return`M${e.handle.x},${e.handle.y} A${n} ${n} 0 ${s} ${o} ${t.handle.x},${t.handle.y}`}function A9(r){const{start:e,end:t,bodyArc:{radius:n,largeArcFlag:s,sweepFlag:o}}=r;return`M${e.point.x},${e.point.y} A${n} ${n} 0 ${s} ${o} ${t.point.x},${t.point.y}`}function j9(r,e){return`M${r.x},${r.y}L${e.x},${e.y}`}function jae(r){return j9(r.start.handle,r.end.handle)}function R9(r){return j9(r.start.point,r.end.point)}class dv extends pa{constructor(){super(...arguments);k(this,"_resizeInitialBindings",new il)}canEdit(){return!0}canBind({toShapeType:t}){return t!=="arrow"}canSnap(){return!1}hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsBg(){return!0}hideSelectionBoundsFg(){return!0}canBeLaidOut(t){const n=Fo(this.editor,t);return!n.start&&!n.end}getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{x:0,y:0},end:{x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",labelPosition:.5,font:"draw",scale:1}}getGeometry(t){const n=Qa(this.editor,t),s=[],o=n.isStraight?new $l({start:P.From(n.start.point),end:P.From(n.end.point)}):new vh({center:P.Cast(n.handleArc.center),start:P.Cast(n.start.point),end:P.Cast(n.end.point),sweepFlag:n.bodyArc.sweepFlag,largeArcFlag:n.bodyArc.largeArcFlag});let i;if(t.props.text.trim()){const a=cv(this.editor,t);s.push(...a.debugGeom),i=new dl({x:a.box.x,y:a.box.y,width:a.box.w,height:a.box.h,isFilled:!0,isLabel:!0})}return new Fi({children:[...i?[o,i]:[o],...s]})}getHandles(t){const n=Qa(this.editor,t);return[{id:"start",type:"vertex",index:"a0",x:n.start.handle.x,y:n.start.handle.y},{id:"middle",type:"virtual",index:"a2",x:n.middle.x,y:n.middle.y},{id:"end",type:"vertex",index:"a3",x:n.end.handle.x,y:n.end.handle.y}].filter(Boolean)}getText(t){return t.props.text}onHandleDrag(t,{handle:n,isPrecise:s}){const o=n.id,i=Fo(this.editor,t);if(o==="middle"){const{start:R,end:D}=Sh(this.editor,t,i),N=P.Sub(D,R),z=P.Per(N),L=P.Med(D,R),B=P.Sub(L,z),K=P.Add(L,z),O=P.NearestPointOnLineSegment(B,K,n,!1);let U=P.Dist(O,L);return P.Clockwise(O,D,L)&&(U*=-1),{id:t.id,type:t.type,props:{bend:U}}}const a={id:t.id,type:"arrow",props:{}},l=i[o],u=i[o==="start"?"end":"start"];if(this.editor.inputs.ctrlKey)return ov(this.editor,t,o),a.props[o]={x:n.x,y:n.y},a;const p=this.editor.getShapePageTransform(t.id).applyToPoint(n),f=this.editor.getShapeAtPoint(p,{hitInside:!0,hitFrameInside:!0,margin:0,filter:R=>!R.isLocked&&this.editor.canBindShapes({fromShape:t,toShape:R,binding:"arrow"})});if(!f){ov(this.editor,t,o);const R=fa(new P(n.x,n.y),this.editor);return a.props[o]={x:R.x,y:R.y},a}const m=this.editor.getShapeGeometry(f),v=Ve.ZeroFix(m.bounds),S=this.editor.getShapePageTransform(a.id).applyToPoint(n),C=this.editor.getPointInShapeSpace(f,S);let E=s;E||(!l||l&&f.id!==l.toId)&&(E=this.editor.inputs.pointerVelocity.len()<.5),s||(m.isClosed||(E=!0),u&&f.id===u.toId&&u.props.isPrecise&&(E=!0));const T={x:(C.x-v.minX)/v.width,y:(C.y-v.minY)/v.height};E&&P.Dist(C,v.center)<Math.max(4,Math.min(Math.min(v.width,v.height)*.15,16))/this.editor.getZoomLevel()&&(T.x=.5,T.y=.5);const w={terminal:o,normalizedAnchor:T,isPrecise:E,isExact:this.editor.inputs.altKey};sf(this.editor,t,f.id,w),this.editor.setHintingShapes([f.id]);const M=Fo(this.editor,t);return M.start&&M.end&&M.start.toId===M.end.toId&&P.Equals(M.start.props.normalizedAnchor,M.end.props.normalizedAnchor)&&sf(this.editor,t,M.end.toId,{...M.end.props,normalizedAnchor:{x:M.end.props.normalizedAnchor.x+.05,y:M.end.props.normalizedAnchor.y}}),a}onTranslateStart(t){const n=Fo(this.editor,t),s=Sh(this.editor,t,n),o=this.editor.getShapePageTransform(t.id),i=this.editor.getSelectedShapeIds();if(!(n.start&&(i.includes(n.start.toId)||this.editor.isAncestorSelected(n.start.toId))||n.end&&(i.includes(n.end.toId)||this.editor.isAncestorSelected(n.end.toId)))){ID.set(t,{pagePosition:o.applyToPoint(t),terminalBindings:jg(s,(a,l)=>{const c=n[a];return c?{binding:c,shapePosition:l,pagePosition:o.applyToPoint(l)}:null})}),n.start&&(p0({editor:this.editor,arrow:t,terminal:"start",useHandle:!0}),t=this.editor.getShape(t.id)),n.end&&p0({editor:this.editor,arrow:t,terminal:"end",useHandle:!0});for(const a of["start","end"]){const l=n[a];l&&this.editor.updateBinding({...l,props:{...l.props,isPrecise:!0}})}}}onTranslate(t,n){const s=ID.get(t);if(!s)return;const o=this.editor.getShapePageTransform(n.id),i=P.Sub(o.applyToPoint(n),s.pagePosition);for(const a of Object.values(s.terminalBindings)){if(!a)continue;const l=P.Add(a.pagePosition,P.Mul(i,.5)),c=this.editor.getShapeAtPoint(l,{hitInside:!0,hitFrameInside:!0,margin:0,filter:u=>!u.isLocked&&this.editor.canBindShapes({fromShape:n,toShape:u,binding:"arrow"})});if((c==null?void 0:c.id)===a.binding.toId){const u=Ve.ZeroFix(this.editor.getShapeGeometry(c).bounds),p=this.editor.getPointInShapeSpace(c,l),f={x:(p.x-u.minX)/u.width,y:(p.y-u.minY)/u.height};sf(this.editor,n,c.id,{...a.binding.props,normalizedAnchor:f,isPrecise:!0})}else ov(this.editor,n,a.binding.props.terminal)}}onResize(t,n){const{scaleX:s,scaleY:o}=n,i=this._resizeInitialBindings.get(t,()=>Fo(this.editor,t)),a=Sh(this.editor,t,i),{start:l,end:c}=Kn(t.props);let{bend:u}=t.props;i.start||(l.x=a.start.x*s,l.y=a.start.y*o),i.end||(c.x=a.end.x*s,c.y=a.end.y*o);const p=Math.abs(s),f=Math.abs(o),m=i!=null&&i.start?P.From(i.start.props.normalizedAnchor):null,v=i!=null&&i.end?P.From(i.end.props.normalizedAnchor):null;return s<0&&o>=0?(u!==0&&(u*=-1,u*=Math.max(p,f)),m&&(m.x=1-m.x),v&&(v.x=1-v.x)):s>=0&&o<0?(u!==0&&(u*=-1,u*=Math.max(p,f)),m&&(m.y=1-m.y),v&&(v.y=1-v.y)):s>=0&&o>=0?u!==0&&(u*=Math.max(p,f)):s<0&&o<0&&(u!==0&&(u*=Math.max(p,f)),m&&(m.x=1-m.x,m.y=1-m.y),v&&(v.x=1-v.x,v.y=1-v.y)),i.start&&m&&sf(this.editor,t,i.start.toId,{...i.start.props,normalizedAnchor:m.toJson()}),i.end&&v&&sf(this.editor,t,i.end.toId,{...i.end.props,normalizedAnchor:v.toJson()}),{props:{start:l,end:c,bend:u}}}onDoubleClickHandle(t,n){switch(n.id){case"start":return{id:t.id,type:t.type,props:{...t.props,arrowheadStart:t.props.arrowheadStart==="none"?"arrow":"none"}};case"end":return{id:t.id,type:t.type,props:{...t.props,arrowheadEnd:t.props.arrowheadEnd==="none"?"arrow":"none"}}}}component(t){const n=Bi(),s=this.editor.getOnlySelectedShape(),o=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getIsReadonly(),i=Qa(this.editor,t);if(!(i!=null&&i.isValid))return null;const a=cv(this.editor,t),l=t.id===this.editor.getOnlySelectedShapeId(),u=this.editor.getEditingShapeId()===t.id||t.props.text;return g.jsxs(g.Fragment,{children:[g.jsx(sd,{style:{minWidth:50,minHeight:50},children:g.jsx(PD,{shape:t,shouldDisplayHandles:o&&(s==null?void 0:s.id)===t.id})}),u&&g.jsx(Bb,{shapeId:t.id,classNamePrefix:"tl-arrow",type:"arrow",font:t.props.font,fontSize:rk(t),lineHeight:Vs.lineHeight,align:"middle",verticalAlign:"middle",text:t.props.text,labelColor:n[t.props.labelColor].solid,textWidth:a.box.w-f0*2*t.props.scale,isSelected:l,padding:0,style:{transform:`translate(${a.box.center.x}px, ${a.box.center.y}px)`}})]})}indicator(t){const n=gb(t.id),s=ha(t.id+"_clip"),o=Qa(this.editor,t);if(!o)return null;const{start:i,end:a}=Sh(this.editor,t,o==null?void 0:o.bindings),l=this.editor.getShapeGeometry(t),c=l.bounds,u=t.props.text.trim()?l.children[1]:null;if(P.Equals(i,a))return null;const p=Ks[t.props.size]*t.props.scale,f=o.start.arrowhead&&g0(o,"start",p),m=o.end.arrowhead&&g0(o,"end",p),v=o.isStraight?R9(o):A9(o),b=f&&o.start.arrowhead!=="arrow"||m&&o.end.arrowhead!=="arrow"||!!u;if(n&&u)return g.jsx("rect",{x:fe(u.x),y:fe(u.y),width:u.w,height:u.h,rx:3.5*t.props.scale,ry:3.5*t.props.scale});const S=!(o.start.arrowhead==="none"||o.start.arrowhead==="arrow"),C=!(o.end.arrowhead==="none"||o.end.arrowhead==="arrow");return g.jsxs("g",{children:[b&&g.jsx("defs",{children:g.jsx(O9,{hasText:t.props.text.trim().length>0,bounds:c,labelBounds:u?u.getBounds():new Ve(0,0,0,0),as:S&&f?f:"",ae:C&&m?m:""})}),g.jsxs("g",{style:{clipPath:b?`url(#${s})`:void 0,WebkitClipPath:b?`url(#${s})`:void 0},children:[b&&g.jsx("rect",{x:c.minX-100,y:c.minY-100,width:c.width+200,height:c.height+200,opacity:0}),g.jsx("path",{d:v})]}),f&&g.jsx("path",{d:f}),m&&g.jsx("path",{d:m}),u&&g.jsx("rect",{x:fe(u.x),y:fe(u.y),width:u.w,height:u.h,rx:3.5,ry:3.5})]})}onEditEnd(t){const{id:n,type:s,props:{text:o}}=t;o.trimEnd()!==t.props.text&&this.editor.updateShapes([{id:n,type:s,props:{text:o.trimEnd()}}])}toSvg(t,n){n.addExportDef(LP(t.props.fill)),t.props.text&&n.addExportDef(zb(t.props.font));const s=rc(n),o=1/t.props.scale;return g.jsxs("g",{transform:`scale(${o})`,children:[g.jsx(PD,{shape:t,shouldDisplayHandles:!1}),g.jsx($b,{fontSize:rk(t),font:t.props.font,align:"middle",verticalAlign:"middle",text:t.props.text,labelColor:s[t.props.labelColor].solid,bounds:cv(this.editor,t).box.clone().expandBy(-f0*t.props.scale),padding:0})]})}getCanvasSvgDefs(){return[NP(),{key:"arrow:dot",component:Rae},{key:"arrow:cross",component:Dae}]}getInterpolatedProps(t,n,s){return{...s>.5?n.props:t.props,scale:Gt(t.props.scale,n.props.scale,s),start:{x:Gt(t.props.start.x,n.props.start.x,s),y:Gt(t.props.start.y,n.props.start.y,s)},end:{x:Gt(t.props.end.x,n.props.end.x,s),y:Gt(t.props.end.y,n.props.end.y,s)},bend:Gt(t.props.bend,n.props.bend,s),labelPosition:Gt(t.props.labelPosition,n.props.labelPosition,s)}}}k(dv,"type","arrow"),k(dv,"props",J3),k(dv,"migrations",Q3);function D9(r,e){const t=Qa(r,e);return t.isStraight?P.Dist(t.start.handle,t.end.handle):Math.abs(t.handleArc.length)}const PD=Ss(function({shape:e,shouldDisplayHandles:t}){const n=ue(),s=Bi(),o=Qa(n,e),i=Ve.ZeroFix(n.getShapeGeometry(e).bounds),a=Fo(n,e),l=ye("force solid",()=>n.getZoomLevel()<.2,[n]),c=ha(e.id+"_clip"),u=ha("arrowhead-dot"),p=ha("arrowhead-cross");if(!(o!=null&&o.isValid))return null;const f=Ks[e.props.size]*e.props.scale,m=o.start.arrowhead&&g0(o,"start",f),v=o.end.arrowhead&&g0(o,"end",f),b=o.isStraight?R9(o):A9(o);let S=null;if(t){const R=2/n.getZoomLevel(),{strokeDasharray:D,strokeDashoffset:N}=sa(D9(n,e),R,{end:"skip",start:"skip",lengthRatio:2.5});S=a.start||a.end?g.jsx("path",{className:"tl-arrow-hint",d:o.isStraight?jae(o):Aae(o),strokeDasharray:D,strokeDashoffset:N,strokeWidth:R,markerStart:a.start?a.start.props.isExact?"":a.start.props.isPrecise?`url(#${p})`:`url(#${u})`:"",markerEnd:a.end?a.end.props.isExact?"":a.end.props.isPrecise?`url(#${p})`:`url(#${u})`:"",opacity:.16}):null}const{strokeDasharray:C,strokeDashoffset:E}=sa(o.isStraight?o.length:Math.abs(o.bodyArc.length),f,{style:e.props.dash,forceSolid:l}),T=cv(n,e),w=!(o.start.arrowhead==="none"||o.start.arrowhead==="arrow"),M=!(o.end.arrowhead==="none"||o.end.arrowhead==="arrow");return g.jsxs(g.Fragment,{children:[g.jsx("defs",{children:g.jsx("clipPath",{id:c,children:g.jsx(O9,{hasText:e.props.text.trim().length>0,bounds:i,labelBounds:T.box,as:w&&m?m:"",ae:M&&v?v:""})})}),g.jsxs("g",{fill:"none",stroke:s[e.props.color].solid,strokeWidth:f,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[S,g.jsxs("g",{style:{clipPath:`url(#${c})`,WebkitClipPath:`url(#${c})`},children:[g.jsx("rect",{x:fe(i.minX-100),y:fe(i.minY-100),width:fe(i.width+200),height:fe(i.height+200),opacity:0}),g.jsx("path",{d:b,strokeDasharray:C,strokeDashoffset:E})]}),m&&w&&e.props.fill!=="none"&&g.jsx(Ns,{theme:s,d:m,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),v&&M&&e.props.fill!=="none"&&g.jsx(Ns,{theme:s,d:v,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),m&&g.jsx("path",{d:m}),v&&g.jsx("path",{d:v})]})]})});function O9({hasText:r,bounds:e,labelBounds:t,as:n,ae:s}){const o=`M${fe(e.minX-100)},${fe(e.minY-100)} h${e.width+200} v${e.height+200} h-${e.width+200} Z`,i=`M${fe(t.minX)},${fe(t.minY)} v${t.height} h${t.width} v-${t.height} Z`;return g.jsx("path",{d:`${o}${r?i:""}${n}${s}`})}const ID=new WeakMap;function Rae(){const r=ha("arrowhead-dot");return g.jsx("marker",{id:r,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:g.jsx("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function Dae(){const r=ha("arrowhead-cross");return g.jsxs("marker",{id:r,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[g.jsx("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),g.jsx("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}const _D="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function Kh({url:r}){const e=ue(),t=ye("zoomLevel",()=>e.getZoomLevel()<.32,[e]);return g.jsx("a",{className:it("tl-hyperlink-button",{"tl-hyperlink-button__hidden":t}),href:r,target:"_blank",rel:"noopener noreferrer",onPointerDown:Ar,onPointerUp:Ar,title:r,draggable:!1,children:g.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${_D}") center 100% / 100% no-repeat`,WebkitMask:`url("${_D}") center 100% / 100% no-repeat`}})})}const TD="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E",Oae=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function m0(r){return Oae.map(t=>{const{offsetX:n,offsetY:s,blur:o,spread:i,color:a}=t,l=new P(n,s),{x:c,y:u}=l.rot(-r);return`${c}px ${u}px ${o}px ${i}px ${a}`}).join(", ")}const Lae=300,L9=320,Nae=46,Fae=101;class uv extends up{canResize(){return!1}hideSelectionBoundsFg(){return!0}getText(e){return e.props.url}getDefaultProps(){return{url:"",w:Lae,h:L9,assetId:null}}component(e){return g.jsx(zae,{shape:e,util:this})}indicator(e){return g.jsx("rect",{width:fe(e.props.w),height:fe(e.props.h),rx:"6",ry:"6"})}onBeforeCreate(e){return MD(this.editor,e)}onBeforeUpdate(e,t){if(e.props.url!==t.props.url)if(ci.isValid(t.props.url))Bae(this.editor,t);else return{...t,props:{...t.props,url:e.props.url}};if(e.props.assetId!==t.props.assetId)return MD(this.editor,t)}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,w:Gt(e.props.w,t.props.w,n),h:Gt(e.props.h,t.props.h,n)}}}k(uv,"type","bookmark"),k(uv,"props",o5),k(uv,"migrations",i5);function zae({shape:r,util:e}){const t=r.props.assetId?e.editor.getAsset(r.props.assetId):null,n=!!Gg()&&Rn.isSafari,s=e.editor.getShapePageTransform(r).rotation(),o=$ae(r),[i,a]=I.useState(!0),l=()=>a(!1);return g.jsx(Qc,{children:g.jsxs("div",{className:it("tl-bookmark__container",n&&"tl-bookmark__container--safariExport"),style:{boxShadow:n?void 0:m0(s),maxHeight:r.props.h},children:[(!t||t.props.image)&&g.jsxs("div",{className:"tl-bookmark__image_container",children:[t?g.jsx("img",{className:"tl-bookmark__image",draggable:!1,referrerPolicy:"strict-origin-when-cross-origin",src:t==null?void 0:t.props.image,alt:(t==null?void 0:t.props.title)||""}):g.jsx("div",{className:"tl-bookmark__placeholder"}),(t==null?void 0:t.props.image)&&g.jsx(Kh,{url:r.props.url})]}),g.jsxs("div",{className:"tl-bookmark__copy_container",children:[t!=null&&t.props.title?g.jsx("h2",{className:"tl-bookmark__heading",children:Oie(t.props.title)}):null,t!=null&&t.props.description&&(t!=null&&t.props.image)?g.jsx("p",{className:"tl-bookmark__description",children:t.props.description}):null,g.jsxs("a",{className:"tl-bookmark__link",href:r.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:Ar,onPointerUp:Ar,onClick:Ar,children:[i&&(t!=null&&t.props.favicon)?g.jsx("img",{className:"tl-bookmark__favicon",src:t==null?void 0:t.props.favicon,referrerPolicy:"strict-origin-when-cross-origin",onError:l,alt:`favicon of ${o}`}):g.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${TD}") center 100% / 100% no-repeat`,WebkitMask:`url("${TD}") center 100% / 100% no-repeat`}}),g.jsx("span",{children:o})]})]})]})})}function MD(r,e){const t=e.props.assetId?r.getAsset(e.props.assetId):null;let n=L9;return t&&(t.props.image||(t.props.title?n=Fae:n=Nae)),{...e,props:{...e.props,h:n}}}const $ae=r=>{try{return new URL(r.props.url).hostname.replace(/^www\./,"")}catch{return r.props.url}};function Bae(r,e){const{url:t}=e.props,n=zc.createId(oE(t));r.getAsset(n)?e.props.assetId!==n&&r.updateShapes([{id:e.id,type:e.type,props:{assetId:n}}]):(r.updateShapes([{id:e.id,type:e.type,props:{assetId:null}}]),Uae(r,e))}const Uae=z0(async(r,e)=>{if(r.isDisposed)return;const{url:t}=e.props,n=await r.getAssetForExternalContent({type:"url",url:t});n&&r.run(()=>{r.createAssets([n]),r.updateShapes([{id:e.id,type:e.type,props:{assetId:n.id}}])})},500);function vu(r,e=!1){const t=r.length;if(t<2)return"";let n=r[0].point,s=r[1].point;if(t===2)return`M${ln(n)}L${ln(s)}`;let o="";for(let i=2,a=t-1;i<a;i++)n=r[i].point,s=r[i+1].point,o+=No(n,s);return e?`M${No(r[0].point,r[1].point)}Q${ln(r[1].point)}${No(r[1].point,r[2].point)}T${o}${No(r[t-1].point,r[0].point)}${No(r[0].point,r[1].point)}Z`:`M${ln(r[0].point)}Q${ln(r[1].point)}${No(r[1].point,r[2].point)}${r.length>3?"T":""}${o}L${ln(r[t-1].point)}`}function Hae(r,e={}){const{start:t={},end:n={}}=e,{cap:s=!0}=t,{cap:o=!0}=n;fn(!t.taper&&!n.taper,"cap taper not supported here"),fn(!t.easing&&!n.easing,"cap easing not supported here"),fn(s&&o,"cap must be true");const i=pl(r,e);Nb(i,e);const a=Gae(i);let l="";for(const c of a)l+=Kae(c,e);return l}function Gae(r){if(r.length<=2)return[r];const e=[];let t=[r[0]],n=P.Sub(r[1].point,r[0].point).uni(),s,o,i,a,l;for(let c=1,u=r.length;c<u-1;c++){if(i=r[c-1],a=r[c],l=r[c+1],s=P.Sub(l.point,a.point).uni(),o=P.Dpr(n,s),n=s,o<-.8){const p={...a,point:a.input};t.push(p),e.push(kC(t)),t=[p];continue}if(t.push(a),!(o>.7)&&(P.Dist2(i.point,a.point)+P.Dist2(a.point,l.point))/((i.radius+a.radius+l.radius)/3)**2<1.5){t.push(a),e.push(kC(t)),t=[a];continue}}return t.push(r[r.length-1]),e.push(kC(t)),e}function kC(r){const e=r[0];let t;for(;r.length>2&&(t=r[1],P.Dist2(e.point,t.point)<((e.radius+t.radius)/2*.5)**2);)r.splice(1,1);const n=r[r.length-1];let s;for(;r.length>2&&(s=r[r.length-2],P.Dist2(n.point,s.point)<((n.radius+s.radius)/2*.5)**2);)r.splice(r.length-2,1);return r.length>1&&(r[0]={...r[0],vector:P.Sub(r[0].point,r[1].point).uni()},r[r.length-1]={...r[r.length-1],vector:P.Sub(r[r.length-2].point,r[r.length-1].point).uni()}),r}function Wae(r,e,t){return"M "+r+" "+e+" m -"+t+", 0 a "+t+","+t+" 0 1,1 "+t*2+",0 a "+t+","+t+" 0 1,1 -"+t*2+",0"}function Kae(r,e={}){if(r.length===0)return"";if(r.length===1)return Wae(r[0].point.x,r[0].point.y,r[0].radius);const{left:t,right:n}=m9(r,e);n.reverse();let s=`M${ln(t[0])}T`;for(let o=1;o<t.length;o++)s+=No(t[o-1],t[o]);{const o=r[r.length-1],i=o.radius,a=o.vector.clone().per().neg(),l=P.Add(o.point,P.Mul(a,i)),c=P.Add(o.point,P.Mul(a,-i));s+=`${ln(l)}A${fe(i)},${fe(i)} 0 0 1 ${ln(c)}T`}for(let o=1;o<n.length;o++)s+=No(n[o-1],n[o]);{const o=r[0],i=o.radius,a=o.vector.clone().per(),l=P.Add(o.point,P.Mul(a,i)),c=P.Add(o.point,P.Mul(a,-i));s+=`${ln(l)}A${fe(i)},${fe(i)} 0 0 1 ${ln(c)}Z`}return s}const N9=(r,e,t)=>{const n=[],s=[];r.forEach(c=>n.push(...c.points)),e.forEach(c=>s.push(...c.points));const o=Math.max(n.length,s.length),i=[],a=[];for(let c=0;c<o;c++)i.push(n[c]||n[n.length-1]),a.push(s[c]||s[s.length-1]);return[{type:"free",points:i.map((c,u)=>{let p=.5;return a[u].z!==void 0&&c.z!==void 0&&(p=Gt(c.z,a[u].z,t)),{x:Gt(c.x,a[u].x,t),y:Gt(c.y,a[u].y,t),z:p}})}]},Vae=r=>r*.65+xV(r*cn/2)*.35,qae=r=>({size:r,thinning:.5,streamline:Bh(r,[9,16],[.64,.74],!0),smoothing:.62,easing:ss.easeOutSine,simulatePressure:!0}),Yae=r=>({size:1+r*1.2,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:Vae}),AD=r=>({size:r,thinning:0,streamline:Bh(r,[9,16],[.64,.74],!0),smoothing:.62,simulatePressure:!1,easing:ss.linear}),Xae=r=>({size:r,thinning:0,streamline:.62,smoothing:.62,simulatePressure:!1,easing:ss.linear});function $P({strokeWidth:r,showAsComplete:e}){return{size:1+r,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:ss.easeOutSine,last:e}}function sk(r,e,t,n){const s=r.isComplete||t;return n?r.isPen?{...Xae(e),last:s}:{...AD(e),last:s}:r.dash==="draw"?r.isPen?{...Yae(e),last:s}:{...qae(e),last:s}:{...AD(e),last:s}}function Vh(r){const e=[];for(const t of r)if(t.type==="free"||t.points.length<2)e.push(...t.points.map(P.Cast));else{const n=Math.max(4,Math.floor(P.Dist(t.points[0],t.points[1])/16));e.push(...P.PointsBetween(t.points[0],t.points[1],n))}return e}function Zae(r,e,t){return{draw:"none",solid:"none",dotted:`${t} ${e*2}`,dashed:`${e*2} ${e*2}`}[r.props.dash]}class hv extends pa{hideResizeHandles(e){return PC(e)}hideRotateHandle(e){return PC(e)}hideSelectionBoundsFg(e){return PC(e)}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1,scale:1}}getGeometry(e){const t=Vh(e.props.segments),n=(Ks[e.props.size]+1)*e.props.scale;if(e.props.segments.length===1){const o=Ve.FromPoints(t);if(o.width<n*2&&o.height<n*2)return new U2({x:-n,y:-n,radius:n,isFilled:!0})}const s=pl(t,sk(e.props,n,e.props.isPen,!0)).map(o=>o.point);return e.props.isClosed?new Er({points:s,isFilled:e.props.fill!=="none"}):new ap({points:s})}component(e){return g.jsx(sd,{children:g.jsx(jD,{shape:e})})}indicator(e){var u;const t=Vh(e.props.segments);let n=(Ks[e.props.size]+1)*e.props.scale;const s=this.editor.getZoomLevel();!(s<.5&&s<1.5/n)&&!e.props.isPen&&e.props.dash==="draw"&&t.length===1&&(n+=ya(e.id)()*(n/6));const i=e.props.isComplete||((u=gs(e.props.segments))==null?void 0:u.type)==="straight",a=sk(e.props,n,i,!0),l=pl(t,a),c=l.length>1?vu(l,e.props.isClosed):F9(t[0],n);return g.jsx("path",{d:c})}toSvg(e,t){t.addExportDef(LP(e.props.fill));const n=1/e.props.scale;return g.jsx("g",{transform:`scale(${n})`,children:g.jsx(jD,{shape:e,zoomOverride:1})})}getCanvasSvgDefs(){return[NP()]}onResize(e,t){const{scaleX:n,scaleY:s}=t,o=[];for(const i of e.props.segments)o.push({...i,points:i.points.map(({x:a,y:l,z:c})=>({x:zl(n*a),y:zl(s*l),z:c}))});return{props:{segments:o}}}expandSelectionOutlinePx(e){const t=e.props.dash==="draw"?1.6:1;return Ks[e.props.size]*t/2*e.props.scale}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,segments:N9(e.props.segments,t.props.segments,n),scale:Gt(e.props.scale,t.props.scale,n)}}}k(hv,"type","draw"),k(hv,"props",l5),k(hv,"migrations",c5);function F9(r,e){const t=(e+1)*.5;return`M ${r.x} ${r.y} m -${t}, 0 a ${t},${t} 0 1,0 ${t*2},0 a ${t},${t} 0 1,0 -${t*2},0`}function PC(r){return r.props.segments.length===1&&r.props.segments[0].points.length<2}function jD({shape:r,zoomOverride:e}){var m;const t=Bi(),n=ue(),s=Vh(r.props.segments),o=r.props.isComplete||((m=gs(r.props.segments))==null?void 0:m.type)==="straight";let i=(Ks[r.props.size]+1)*r.props.scale;const a=ye("force solid",()=>{const v=e??n.getZoomLevel();return v<.5&&v<1.5/i},[n,i,e]),l=ye("dot adjustment",()=>(e??n.getZoomLevel())<.2?0:.1,[n,e]);!a&&!r.props.isPen&&r.props.dash==="draw"&&s.length===1&&(i+=ya(r.id)()*(i/6));const c=sk(r.props,i,o,a);if(!a&&r.props.dash==="draw")return g.jsxs(g.Fragment,{children:[r.props.isClosed&&r.props.fill&&s.length>1?g.jsx(Ns,{d:vu(pl(s,c),r.props.isClosed),theme:t,color:r.props.color,fill:r.props.isClosed?r.props.fill:"none",scale:r.props.scale}):null,g.jsx("path",{d:Hae(s,c),strokeLinecap:"round",fill:t[r.props.color].solid})]});const u=pl(s,c),p=u.length<2,f=p?F9(s[0],0):vu(u,r.props.isClosed);return g.jsxs(g.Fragment,{children:[g.jsx(Ns,{d:f,theme:t,color:r.props.color,fill:p||r.props.isClosed?r.props.fill:"none",scale:r.props.scale}),g.jsx("path",{d:f,strokeLinecap:"round",fill:p?t[r.props.color].solid:"none",stroke:t[r.props.color].solid,strokeWidth:i,strokeDasharray:p?"none":Zae(r,i,l),strokeDashoffset:"0"})]})}function Jae(r){if(typeof r!="string")throw new TypeError("Expected a string");return r.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function Qae(r,e){const t=vt(e);if(!t)return;const n=t.host.replace("www.","");for(const s of r)if(z9(s.hostnames,n)){const o=s.fromEmbedUrl(e);if(o)return{definition:s,url:o,embedUrl:e}}}const ele=r=>r.split("*").map(e=>Jae(e)).join(".+"),z9=(r,e)=>!!r.find(t=>{const n=new RegExp(ele(t));return e.match(n)});function tle(r,e){const t=vt(e);if(!t)return;const n=t.host.replace("www.","");for(const s of r)if(z9(s.hostnames,n)){const o=s.toEmbedUrl(e);if(o)return{definition:s,embedUrl:o,url:e}}}function nle(r,e){try{return tle(r,e)??Qae(r,e)}catch{return}}const rle=r=>Object.entries(r).filter(([e,t])=>t).map(([e])=>e).join(" "),Nl=class Nl extends up{static setEmbedDefinitions(e){Nl.embedDefinitions=e}getEmbedDefinitions(){return Nl.embedDefinitions}getEmbedDefinition(e){return nle(Nl.embedDefinitions,e)}getText(e){return e.props.url}hideSelectionBoundsFg(e){return!this.canResize(e)}canEdit(){return!0}canResize(e){var t,n;return!!((n=(t=this.getEmbedDefinition(e.props.url))==null?void 0:t.definition)!=null&&n.doesResize)}canEditInReadOnly(){return!0}getDefaultProps(){return{w:300,h:300,url:""}}isAspectRatioLocked(e){const t=this.getEmbedDefinition(e.props.url);return(t==null?void 0:t.definition.isAspectRatioLocked)??!1}onResize(e,t){const n=this.isAspectRatioLocked(e),s=this.getEmbedDefinition(e.props.url);let o=(s==null?void 0:s.definition.minWidth)??200,i=(s==null?void 0:s.definition.minHeight)??200;if(n){const a=e.props.w/e.props.h;a>1?o*=a:i/=a}return fb(e,t,{minWidth:o,minHeight:i})}component(e){const t=Gg(),{w:n,h:s,url:o}=e.props,i=gb(e.id),a=this.getEmbedDefinition(o),l=ye("is hovering",()=>{const{editingShapeId:m,hoveredShapeId:v}=this.editor.getCurrentPageState();if(m&&v!==m){const b=this.editor.getShape(m);if(b&&this.editor.isShapeOfType(b,"embed"))return!0}return!1},[]),c=this.editor.getShapePageTransform(e).rotation();if(t)return g.jsx(Qc,{className:"tl-embed-container",id:e.id,children:g.jsx("div",{className:"tl-embed",style:{border:0,boxShadow:m0(c),borderRadius:(a==null?void 0:a.definition.overrideOutlineRadius)??8,background:(a==null?void 0:a.definition.backgroundColor)??"var(--color-background)",width:n,height:s}})});const u=i||l;if(typeof window<"u"&&(window!==window.top||window.self!==window.parent)&&(a==null?void 0:a.definition.type)==="tldraw")return null;if((a==null?void 0:a.definition.type)==="github_gist"){const m=a.url.split("/").pop();if(!m)throw Error("No gist id!");return g.jsx(Qc,{className:"tl-embed-container",id:e.id,children:g.jsx(sle,{id:m,width:fe(n),height:fe(s),isInteractive:u,pageRotation:c})})}const f=rle({...cse,...(a==null?void 0:a.definition.overridePermissions)??{}});return g.jsx(Qc,{className:"tl-embed-container",id:e.id,children:a!=null&&a.definition?g.jsx("iframe",{className:"tl-embed",sandbox:f,src:a.embedUrl,width:fe(n),height:fe(s),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:u?"auto":"none",zIndex:u?"":"-1",boxShadow:m0(c),borderRadius:(a==null?void 0:a.definition.overrideOutlineRadius)??8,background:a==null?void 0:a.definition.backgroundColor}}):null})}indicator(e){const t=this.getEmbedDefinition(e.props.url);return g.jsx("rect",{width:fe(e.props.w),height:fe(e.props.h),rx:(t==null?void 0:t.definition.overrideOutlineRadius)??8,ry:(t==null?void 0:t.definition.overrideOutlineRadius)??8})}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,w:Gt(e.props.w,t.props.w,n),h:Gt(e.props.h,t.props.h,n)}}};k(Nl,"type","embed"),k(Nl,"props",d5),k(Nl,"migrations",u5),k(Nl,"embedDefinitions",EP);let y0=Nl;function sle({id:r,isInteractive:e,width:t,height:n,style:s,pageRotation:o}){if(!r.match(/^[0-9a-f]+$/))throw Error("No gist id!");return g.jsx("iframe",{className:"tl-embed",draggable:!1,width:fe(t),height:fe(n),frameBorder:"0",scrolling:"no",referrerPolicy:"no-referrer-when-downgrade",style:{...s,pointerEvents:e?"all":"none",zIndex:e?"":"-1",boxShadow:m0(o)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=${`https://gist.github.com/${r}.js`}><\/script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}function ok(r,e){const s=((ru(r.getShapePageTransform(e.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4;return Math.floor(s)}function RD(r,e,t){const n=r.textMeasure.measureTextSpans(B9(e.props.name,"Frame")+"​",t),s=n[0],o=gs(n),i=o.box.w+o.box.x-s.box.x;return{box:new Ve(0,-t.height,i,t.height),spans:n}}function DD(r,e){return{fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:r.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle",fill:e,offsetY:-34,offsetX:2}}function $9(r,e,t){const n=t?"":"px",s=t?"":"deg";let o;switch(e){case 0:o="";break;case 3:o=`translate(${fe(r.props.w)}${n}, 0${n}) rotate(90${s})`;break;case 2:o=`translate(${fe(r.props.w)}${n}, ${fe(r.props.h)}${n}) rotate(180${s})`;break;case 1:o=`translate(0${n}, ${fe(r.props.h)}${n}) rotate(270${s})`;break;default:throw Error("labelSide out of bounds")}return o}const ole=I.forwardRef(({id:r,name:e,isEditing:t},n)=>{const s=ue(),o=I.useCallback(l=>{l.key==="Enter"&&!l.nativeEvent.isComposing&&(Ar(l),l.currentTarget.blur(),s.setEditingShape(null))},[s]),i=I.useCallback(l=>{const c=s.getShape(r);if(!c)return;const u=c.props.name,p=l.currentTarget.value.trim();u!==p&&s.updateShapes([{id:r,type:"frame",props:{name:p}}])},[r,s]),a=I.useCallback(l=>{const c=s.getShape(r);if(!c)return;const u=c.props.name,p=l.currentTarget.value;u!==p&&s.updateShapes([{id:r,type:"frame",props:{name:p}}])},[r,s]);return g.jsxs("div",{className:`tl-frame-label ${t?"tl-frame-label__editing":""}`,children:[g.jsx("input",{className:"tl-frame-name-input",ref:n,style:{display:t?void 0:"none"},value:e,autoFocus:!0,onKeyDown:o,onBlur:i,onChange:a}),B9(e,"Frame")+"​"]})});function ile({id:r,name:e,width:t,height:n}){const s=ue(),{side:o,translation:i}=ye("shape rotation",()=>{const c=s.getShape(r);if(!c)return{side:0,translation:"translate(0, 0)"};const u=ok(s,c);return{side:u,translation:$9(c,u,!1)}},[s,r]),a=I.useRef(null),l=gb(r);return I.useEffect(()=>{const c=a.current;c&&l&&(c.focus(),c.select())},[a,l]),g.jsx("div",{className:"tl-frame-heading",style:{overflow:l?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${Math.ceil(o===0||o===2?t:n)}px + var(--space-5))`,bottom:"100%",transform:`${i} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`},children:g.jsx("div",{className:"tl-frame-heading-hit-area",children:g.jsx(ole,{ref:a,id:r,name:e,isEditing:l})})})}function B9(r,e){return r.match(/^\s*$/)?e:r}class pv extends up{canEdit(){return!0}getDefaultProps(){return{w:160*2,h:90*2,name:""}}getGeometry(e){const{editor:t}=this,n=t.getZoomLevel(),s=DD(e,"black"),o=RD(t,e,s),i=ok(t,e);let a,l,c,u;const{w:p,h:f}=o.box,m=Math.min(p,e.props.w*n),v=Math.min(f,e.props.h*n);switch(i){case 0:{a=-8/n,l=(-f-4)/n,c=(m+16)/n,u=f/n;break}case 1:{a=(-f-4)/n,u=(v+16)/n,l=e.props.h-u+8/n,c=f/n;break}case 2:{a=e.props.w-(m+8)/n,l=e.props.h+4/n,c=(v+16)/n,u=f/n;break}case 3:{a=e.props.w+4/n,u=(v+16)/n,l=-8/n,c=f/n;break}}return new Fi({children:[new dl({width:e.props.w,height:e.props.h,isFilled:!1}),new dl({x:a,y:l,width:c,height:u,isFilled:!0,isLabel:!0})]})}getText(e){return e.props.name}component(e){const t=this.editor.getShapeGeometry(e).bounds,n=Bi(),s=ye("is creating this shape",()=>{const o=this.editor.getStateDescendant("select.resizing");if(!o||!o.getIsActive())return!1;const i=o==null?void 0:o.info;return i?i.isCreating&&this.editor.getOnlySelectedShapeId()===e.id:!1},[e.id]);return g.jsxs(g.Fragment,{children:[g.jsx(sd,{children:g.jsx("rect",{className:it("tl-frame__body",{"tl-frame__creating":s}),width:t.width,height:t.height,fill:n.solid,stroke:n.text})}),s?null:g.jsx(ile,{id:e.id,name:e.props.name,width:t.width,height:t.height})]})}toSvg(e,t){const n=rc({isDarkMode:t.isDarkMode}),s=ok(this.editor,e),o=$9(e,s,!0),i=DD(e,n.text),{box:a,spans:l}=RD(this.editor,e,i),c=nk(this.editor,l,i);return g.jsxs(g.Fragment,{children:[g.jsx("rect",{width:e.props.w,height:e.props.h,fill:n.solid,stroke:n.black.solid,strokeWidth:1,rx:1,ry:1}),g.jsxs("g",{transform:o,children:[g.jsx("rect",{x:a.x-8,y:a.y-4,width:a.width+20,height:a.height,fill:n.background,rx:4,ry:4}),c]})]})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds;return g.jsx("rect",{width:fe(t.width),height:fe(t.height),className:"tl-frame-indicator"})}canReceiveNewChildrenOfType(e,t){return!e.isLocked}providesBackgroundForChildren(){return!0}canDropShapes(e,t){return!e.isLocked}onDragShapesOver(e,t){t.every(n=>n.parentId===e.id)||this.editor.reparentShapes(t,e.id)}onDragShapesOut(e,t){const n=this.editor.getShape(e.parentId);n&&this.editor.isShapeOfType(n,"group")?this.editor.reparentShapes(t,n.id):this.editor.reparentShapes(t,this.editor.getCurrentPageId())}onResize(e,t){return fb(e,t)}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,w:Gt(e.props.w,t.props.w,n),h:Gt(e.props.h,t.props.h,n)}}}k(pv,"type","frame"),k(pv,"props",h5),k(pv,"migrations",p5);function OD(r,e){return r>e?(cn*(e/2)+(r-e))*2:(cn*(r/2)+(e-r))*2}function U9(r,e){return BP(r,e).map((t,n)=>t.getSvgPathData(n===0)).join(" ")+" Z"}function ale(r,e,t,n){const s=r/4,o=e/4,i=ya(n),a=t*.75,l=E=>E.addXY(i()*a,i()*a),c=new P(r/2,e),u=new P(0,o*1.2),p=new P(r/2,o*.9),f=new P(r,o*1.2),m=l(new P(r/2,e)),v=l(new P(0,o*1.2)),b=l(new P(r/2,o*.9)),S=l(new P(r,o*1.2));return[new $s({start:c,cp1:new P(s*1.5,o*3),cp2:new P(0,o*2.5),end:u}),new $s({start:u,cp1:new P(0,-o*.32),cp2:new P(s*1.85,-o*.32),end:p}),new $s({start:p,cp1:new P(s*2.15,-o*.32),cp2:new P(r,-o*.32),end:f}),new $s({start:f,cp1:new P(r,o*2.5),cp2:new P(s*2.5,o*3),end:m}),new $s({start:m,cp1:new P(s*1.5,o*3),cp2:new P(0,o*2.5),end:v}),new $s({start:v,cp1:new P(0,-o*.32),cp2:new P(s*1.85,-o*.32),end:b}),new $s({start:b,cp1:new P(s*2.15,-o*.32),cp2:new P(r,-o*.32),end:S}),new $s({start:S,cp1:new P(r,o*2.5),cp2:new P(s*2.5,o*3),end:c})].map((E,T)=>E.getSvgPathData(T===0)).join(" ")+" Z"}function BP(r,e){const t=r/4,n=e/4;return[new $s({start:new P(r/2,e),cp1:new P(t*1.5,n*3),cp2:new P(0,n*2.5),end:new P(0,n*1.2)}),new $s({start:new P(0,n*1.2),cp1:new P(0,-n*.32),cp2:new P(t*1.85,-n*.32),end:new P(r/2,n*.9)}),new $s({start:new P(r/2,n*.9),cp1:new P(t*2.15,-n*.32),cp2:new P(r,-n*.32),end:new P(r,n*1.2)}),new $s({start:new P(r,n*1.2),cp1:new P(r,n*2.5),cp2:new P(t*2.5,n*3),end:new P(r/2,e)})]}function lle(r){return{size:1+r,thinning:.25,end:{taper:r},start:{taper:r},streamline:0,smoothing:1,simulatePressure:!1}}function cle(r,e,t,n){const s=ya(r),o=e/2,i=t/2,a=j5(o,i),l=[],c=xn*s(),u=xn+Bn/2+Math.abs(s())*Bn,p=Math.max(16,a/10);for(let f=0;f<p;f++){const m=f/(p-1),v=c+m*u,b=Math.cos(v),S=Math.sin(v);l.push(new P(o*b+e*.5+.05*s(),i*S+t/2+.05*s(),Math.min(1,.5+Math.abs(.5-(s()>0?ss.easeInOutSine(m):ss.easeInExpo(m)))/2)))}return pl(l,lle(n))}function dle(r,e,t,n){return vu(cle(r,e,t,n))}function ik(r){let e="M";const t=r.length;let n,s,o;for(let i=0,a=t;i<a;i+=3)n=r[i],s=r[i+1],o=r[i+2],e+=`${ln(n)}L${ln(s)}Q${ln(o)}`;return e+=`${ln(r[0])}`,e}function ak(r,e,t,n,s){const o=[],i=ya(r);let a=e[0],l;const c=e.length;for(let u=0,p=c*s;u<p;u++){l=P.AddXY(e[(u+1)%c],i()*t,i()*t);const f=P.Sub(l,a),m=P.Len(f),v=P.Div(f,m).mul(Math.min(m/4,n));o.push(P.Add(a,v),P.Add(l,v.neg()),l),a=l}return o}function ule(r,e,t){const n=Math.min(r,e)/2,s=Math.max(r,e)-n*2,i=(Math.PI*(n*2)+2*s)/t,a=r>e?[{type:"straight",start:new P(n,0),delta:new P(1,0)},{type:"arc",center:new P(r-n,n),startAngle:-cn/2},{type:"straight",start:new P(r-n,e),delta:new P(-1,0)},{type:"arc",center:new P(n,n),startAngle:cn/2}]:[{type:"straight",start:new P(r,n),delta:new P(0,1)},{type:"arc",center:new P(n,e-n),startAngle:0},{type:"straight",start:new P(0,e-n),delta:new P(0,-1)},{type:"arc",center:new P(n,n),startAngle:cn}];let l=0;const c=[];for(let u=0;u<t;u++){const p=a[0];p.type==="straight"?c.push(P.Add(p.start,P.Mul(p.delta,l))):c.push(uu(p.center,n,p.startAngle+l/n)),l+=i;let f=p.type==="straight"?s:cn*n;for(;l>f;)l-=f,a.push(a.shift()),f=a[0].type==="straight"?s:cn*n}return c}const hle={s:50,m:70,l:100,xl:130},ple=.2;function Ub(r,e,t,n,s){const o=ya(t),i=OD(r,e),a=Math.max(Math.ceil(i/hle[n]),6,Math.ceil(i/Math.min(r,e))),l=i/a*ple,c=Math.max(r-l*2,1),u=Math.max(e-l*2,1),f=OD(c,u)/a,m=(r-c)/2,v=(e-u)/2,b=ule(c,u,a).map(w=>w.addXY(m,v)),S=r<20?0:l*.3,C=e<20?0:l*.3,E=b.slice(0);for(let w=0;w<Math.floor(a/2);w++)E[w]=P.AddXY(E[w],o()*S*s,o()*C*s),E[a-w-1]=P.AddXY(E[a-w-1],o()*S*s,o()*C*s);const T=[];for(let w=0;w<E.length;w++){const M=w===E.length-1?0:w+1,R=E[w],D=E[M],N=b[w],z=b[M],L=P.Dist(N,z),B=f-L,O=P.Dist(R,D)/L,U=(Math.max(m,v)+B)*O,X=P.Lrp(N,z,.5).add(P.Sub(z,N).uni().per().mul(U));X.x<0?X.x=0:X.x>r&&(X.x=r),X.y<0?X.y=0:X.y>e&&(X.y=e);const H=S2(R,D,X),ee=P.Dist(H||P.Average([R,D]),R);T.push({leftPoint:R,rightPoint:D,arcPoint:X,center:H,radius:ee})}return T}function fle(r,e,t,n,s){const o=[],i=Ub(r,e,t,n,s);for(const{center:a,radius:l,leftPoint:c,rightPoint:u}of i)o.push(...kV(c,u,a,l,10));return o}function lk(r,e,t,n,s){const o=Ub(r,e,t,n,s);let i=`M${o[0].leftPoint.toFixed()}`;for(const{leftPoint:a,rightPoint:l,radius:c,center:u}of o){if(u===null){i+=` L${l.toFixed()}`;continue}const p=P.Clockwise(a,l,u)?"0":"1";i+=` A${fe(c)},${fe(c)} 0 ${p},1 ${l.toFixed()}`}return i+=" Z",i}const gle={s:.5,m:.7,l:.9,xl:1.6};function mle(r,e,t,n,s){const o=ya(t),i=gle[n]*s,a=Ub(r,e,t,n,s),u=a.reduce((v,b)=>v+P.Dist2(b.leftPoint,b.rightPoint),0)/a.length>(i*15)**2?v=>P.AddXY(v,o()*i*2,o()*i*2):v=>v;let p=`M${a[0].leftPoint.toFixed()}`,f=u(a[0].leftPoint),m=`M${f.toFixed()}`;for(const{leftPoint:v,center:b,rightPoint:S,radius:C,arcPoint:E}of a){if(b===null){p+=` L${S.toFixed()}`;const N=u(S);m+=` L${N.toFixed()}`,f=N;continue}const T=P.Clockwise(v,S,b)?"0":"1";p+=` A${fe(C)},${fe(C)} 0 ${T},1 ${S.toFixed()}`;const w=u(S),M=u(E),R=S2(f,w,M);if(!R){m+=` L${w.toFixed()}`,f=w;continue}const D=Math.abs(P.Dist(R,f));m+=` A${fe(D)},${fe(D)} 0 ${T},1 ${w.toFixed()}`,f=w}return p+m+" Z"}function ck(r,e){switch(r.geo){case"x-box":return yle(r.w,r.h,e,r.dash);case"check-box":return vle(r.w,r.h);default:return}}function yle(r,e,t,n){const s=n==="draw"?.62:0;if(n==="dashed")return[[new P(0,0),new P(r/2,e/2)],[new P(r,e),new P(r/2,e/2)],[new P(0,e),new P(r/2,e/2)],[new P(r,0),new P(r/2,e/2)]];const o=a=>Math.max(0,Math.min(r,a)),i=a=>Math.max(0,Math.min(e,a));return[[new P(o(t*s),i(t*s)),new P(o(r-t*s),i(e-t*s))],[new P(o(t*s),i(e-t*s)),new P(o(r-t*s),i(t*s))]]}function vle(r,e){const t=Math.min(r,e)*.82,n=(r-t)/2,s=(e-t)/2,o=a=>Math.max(0,Math.min(r,a)),i=a=>Math.max(0,Math.min(e,a));return[[new P(o(n+t*.25),i(s+t*.52)),new P(o(n+t*.45),i(s+t*.82))],[new P(o(n+t*.45),i(s+t*.82)),new P(o(n+t*.82),i(s+t*.22))]]}function LD({shape:r,shouldScale:e,forceSolid:t}){const n=e?r.props.scale:1,s=ue(),o=Bi(),{id:i,props:a}=r,{w:l,color:c,fill:u,dash:p,growY:f,size:m,scale:v}=a,b=Ks[m]*n,S=a.h+f;switch(a.geo){case"cloud":if(p==="solid"){const C=lk(l,S,i,m,v);return g.jsxs(g.Fragment,{children:[g.jsx(Ns,{theme:o,d:C,color:c,fill:u,scale:n}),g.jsx("path",{d:C,stroke:o[c].solid,strokeWidth:b,fill:"none"})]})}else if(p==="draw"){const C=mle(l,S,i,m,v);return g.jsxs(g.Fragment,{children:[g.jsx(Ns,{theme:o,d:C,color:c,fill:u,scale:n}),g.jsx("path",{d:C,stroke:o[c].solid,strokeWidth:b,fill:"none"})]})}else{const C=lk(l,S,i,m,v),E=Ub(l,S,i,m,v);return g.jsxs(g.Fragment,{children:[g.jsx(Ns,{theme:o,d:C,color:c,fill:u,scale:n}),g.jsx("g",{strokeWidth:b,stroke:o[c].solid,fill:"none",pointerEvents:"all",children:E.map(({leftPoint:T,rightPoint:w,center:M,radius:R},D)=>{const N=M?R*ru(ru(P.Angle(M,w))-ru(P.Angle(M,T))):P.Dist(T,w),{strokeDasharray:z,strokeDashoffset:L}=sa(N,b,{style:p,start:"outset",end:"outset",forceSolid:t});return g.jsx("path",{d:M?`M${T.x},${T.y}A${R},${R},0,0,1,${w.x},${w.y}`:`M${T.x},${T.y}L${w.x},${w.y}`,strokeDasharray:z,strokeDashoffset:L},D)})})]})}case"ellipse":{const C=e?s.getShapeGeometry(r):s.getShapeUtil(r).getGeometry(r),E=C.getSvgPathData(!0);if(p==="dashed"||p==="dotted"){const T=C.length,{strokeDasharray:w,strokeDashoffset:M}=sa(T<64?T*2:T,b,{style:p,snap:4,closed:!0,forceSolid:t});return g.jsxs(g.Fragment,{children:[g.jsx(Ns,{theme:o,d:E,color:c,fill:u,scale:n}),g.jsx("path",{d:E,strokeWidth:b,fill:"none",stroke:o[c].solid,strokeDasharray:w,strokeDashoffset:M})]})}else{const w=(e?s.getShapeGeometry(r):s.getShapeUtil(r).getGeometry(r)).getSvgPathData(!0);return g.jsxs(g.Fragment,{children:[g.jsx(Ns,{theme:o,d:w,color:c,fill:u,scale:n}),g.jsx("path",{d:w,stroke:o[c].solid,strokeWidth:b,fill:"none"})]})}}case"oval":{const C=e?s.getShapeGeometry(r):s.getShapeUtil(r).getGeometry(r),E=C.getSvgPathData(!0);if(p==="dashed"||p==="dotted"){const T=C.getLength(),{strokeDasharray:w,strokeDashoffset:M}=sa(T<64?T*2:T,b,{style:p,snap:4,start:"outset",end:"outset",closed:!0,forceSolid:t});return g.jsxs(g.Fragment,{children:[g.jsx(Ns,{theme:o,d:E,color:c,fill:u,scale:n}),g.jsx("path",{d:E,strokeWidth:b,fill:"none",stroke:o[c].solid,strokeDasharray:w,strokeDashoffset:M})]})}else return g.jsxs(g.Fragment,{children:[g.jsx(Ns,{theme:o,d:E,color:c,fill:u,scale:n}),g.jsx("path",{d:E,stroke:o[c].solid,strokeWidth:b,fill:"none"})]})}case"heart":if(p==="dashed"||p==="dotted"||p==="solid"){const C=U9(l,S),E=BP(l,S);return g.jsxs(g.Fragment,{children:[g.jsx(Ns,{theme:o,d:C,color:c,fill:u,scale:n}),E.map((T,w)=>{const{strokeDasharray:M,strokeDashoffset:R}=sa(T.length,b,{style:p,snap:1,start:"outset",end:"outset",closed:!0,forceSolid:t});return g.jsx("path",{d:T.getSvgPathData(),strokeWidth:b,fill:"none",stroke:o[c].solid,strokeDasharray:M,strokeDashoffset:R,pointerEvents:"all"},`curve_${w}`)})]})}else{const C=ale(l,S,b,r.id);return g.jsxs(g.Fragment,{children:[g.jsx(Ns,{theme:o,d:C,color:c,fill:u,scale:n}),g.jsx("path",{d:C,stroke:o[c].solid,strokeWidth:b,fill:"none"})]})}default:{const C=e?s.getShapeGeometry(r):s.getShapeUtil(r).getGeometry(r),E=C instanceof Fi?C.children[0].vertices:C.vertices,T=ck(r.props,b);if(p==="solid"){let w="M"+E[0]+"L"+E.slice(1)+"Z";if(T)for(const[M,R]of T)w+=`M${M.x},${M.y}L${R.x},${R.y}`;return g.jsxs(g.Fragment,{children:[g.jsx(Ns,{theme:o,d:w,color:c,fill:u,scale:n}),g.jsx("path",{d:w,stroke:o[c].solid,strokeWidth:b,fill:"none"})]})}else if(p==="dashed"||p==="dotted"){const w="M"+E[0]+"L"+E.slice(1)+"Z";return g.jsxs(g.Fragment,{children:[g.jsx(Ns,{theme:o,d:w,color:c,fill:u,scale:n}),g.jsxs("g",{strokeWidth:b,stroke:o[c].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(E.length)).map((M,R)=>{const D=P.ToFixed(E[R]),N=P.ToFixed(E[(R+1)%E.length]),z=P.Dist(D,N),{strokeDasharray:L,strokeDashoffset:B}=sa(z,b,{style:p,start:"outset",end:"outset",forceSolid:t});return g.jsx("line",{x1:D.x,y1:D.y,x2:N.x,y2:N.y,strokeDasharray:L,strokeDashoffset:B},R)}),T&&T.map(([M,R],D)=>{const N=P.Dist(M,R),{strokeDasharray:z,strokeDashoffset:L}=sa(N,b,{style:p,start:"skip",end:"skip",snap:p==="dotted"?4:void 0,forceSolid:t});return g.jsx("path",{d:`M${M.x},${M.y}L${R.x},${R.y}`,stroke:o[c].solid,strokeWidth:b,fill:"none",strokeDasharray:z,strokeDashoffset:L},`line_fg_${D}`)})]})]})}else if(p==="draw"){let w=ik(ak(i,E,b/3,b*2,2));if(T)for(const[R,D]of T)w+=`M${R.toFixed()}L${D.toFixed()}`;const M=ik(ak(i,E,0,b*2,1));return g.jsxs(g.Fragment,{children:[g.jsx(Ns,{theme:o,d:M,color:c,fill:u,scale:n}),g.jsx("path",{d:w,stroke:o[c].solid,strokeWidth:b,fill:"none"})]})}}}}const ND=17*3;class fv extends up{canEdit(){return!0}getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:"",scale:1}}getGeometry(e){const t=Math.max(1,e.props.w),n=Math.max(1,e.props.h+e.props.growY),s=t/2,o=n/2,i=e.props.fill!=="none";let a;switch(e.props.geo){case"cloud":{a=new Er({points:fle(t,n,e.id,e.props.size,e.props.scale),isFilled:i});break}case"triangle":{a=new Er({points:[new P(s,0),new P(t,n),new P(0,n)],isFilled:i});break}case"diamond":{a=new Er({points:[new P(s,0),new P(t,o),new P(s,n),new P(0,o)],isFilled:i});break}case"pentagon":{a=new Er({points:G1(t,n,5),isFilled:i});break}case"hexagon":{a=new Er({points:G1(t,n,6),isFilled:i});break}case"octagon":{a=new Er({points:G1(t,n,8),isFilled:i});break}case"ellipse":{a=new CQ({width:t,height:n,isFilled:i});break}case"oval":{a=new EQ({width:t,height:n,isFilled:i});break}case"star":{const E=xn/5/2,T=Math.floor(5/4)*2,w=5*2-T,M=0,R=Math.floor(5/2)*2,D=Math.cos(-Bn+T*E)*t/2,N=Math.cos(-Bn+w*E)*t/2,z=Math.sin(-Bn+M*E)*n/2,L=Math.sin(-Bn+R*E)*n/2,B=t-Math.abs(D-N),K=n-Math.abs(L-z),O=t/2+N-(t/2-D),U=n/2+z-(n/2-L),X=1,H=(t-O)/2,ee=(n-U)/2,J=(t+B)/2,ne=(n+K)/2,ae=J*X/2,q=ne*X/2;a=new Er({points:Array.from(Array(5*2)).map((se,xe)=>{const Oe=-Bn+xe*E;return new P(H+(xe%2?ae:J)*Math.cos(Oe),ee+(xe%2?q:ne)*Math.sin(Oe))}),isFilled:i});break}case"rhombus":{const C=Math.min(t*.38,n*.38);a=new Er({points:[new P(C,0),new P(t,0),new P(t-C,n),new P(0,n)],isFilled:i});break}case"rhombus-2":{const C=Math.min(t*.38,n*.38);a=new Er({points:[new P(0,0),new P(t-C,0),new P(t,n),new P(C,n)],isFilled:i});break}case"trapezoid":{const C=Math.min(t*.38,n*.38);a=new Er({points:[new P(C,0),new P(t-C,0),new P(t,n),new P(0,n)],isFilled:i});break}case"arrow-right":{const C=Math.min(t,n)*.38,E=n*.16;a=new Er({points:[new P(0,E),new P(t-C,E),new P(t-C,0),new P(t,n/2),new P(t-C,n),new P(t-C,n-E),new P(0,n-E)],isFilled:i});break}case"arrow-left":{const C=Math.min(t,n)*.38,E=n*.16;a=new Er({points:[new P(C,0),new P(C,E),new P(t,E),new P(t,n-E),new P(C,n-E),new P(C,n),new P(0,n/2)],isFilled:i});break}case"arrow-up":{const C=t*.16,E=Math.min(t,n)*.38;a=new Er({points:[new P(t/2,0),new P(t,E),new P(t-C,E),new P(t-C,n),new P(C,n),new P(C,E),new P(0,E)],isFilled:i});break}case"arrow-down":{const C=t*.16,E=Math.min(t,n)*.38;a=new Er({points:[new P(C,0),new P(t-C,0),new P(t-C,n-E),new P(t,n-E),new P(t/2,n),new P(0,n-E),new P(C,n-E)],isFilled:i});break}case"check-box":case"x-box":case"rectangle":{a=new dl({width:t,height:n,isFilled:i});break}case"heart":{const E=BP(t,n).reduce((T,w)=>(T.push(...w.vertices),T),[]);a=new Er({points:E,isFilled:i});break}default:rs(e.props.geo)}const l=Fy(this.editor,e),c=t/e.props.scale,u=n/e.props.scale,p=Math.min(100,c/2),f=Math.min(ql[e.props.size]*Vs.lineHeight+Ri*2,u/2),m=Math.min(c,Math.max(l.w,Math.min(p,Math.max(1,c-8)))),v=Math.min(u,Math.max(l.h,Math.min(f,Math.max(1,u-8)))),b=ck(e.props,Ks[e.props.size]*e.props.scale),S=b?b.map(C=>new ap({points:C})):[];return new Fi({children:[a,new dl({x:e.props.align==="start"?0:e.props.align==="end"?(c-m)*e.props.scale:(c-m)/2*e.props.scale,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?(u-v)*e.props.scale:(u-v)/2*e.props.scale,width:m*e.props.scale,height:v*e.props.scale,isFilled:!0,isLabel:!0}),...S]})}getHandleSnapGeometry(e){const t=this.getGeometry(e),n=t.children[0];switch(e.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline:n,points:[...n.getVertices(),t.bounds.center]};case"cloud":case"ellipse":case"heart":case"oval":return{outline:n,points:[t.bounds.center]};default:rs(e.props.geo)}}getText(e){return e.props.text}onEditEnd(e){const{id:t,type:n,props:{text:s}}=e;s.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:s.trimEnd()}}])}component(e){const{id:t,type:n,props:s}=e,{fill:o,font:i,align:a,verticalAlign:l,size:c,text:u}=s,p=Bi(),{editor:f}=this,m=ye("isGeoOnlySelected",()=>e.id===f.getOnlySelectedShapeId(),[]),b=f.getEditingShapeId()!==null||e.props.text,S=ye("force solid",()=>f.getZoomLevel()<.2,[f]);return g.jsxs(g.Fragment,{children:[g.jsx(sd,{children:g.jsx(LD,{shape:e,shouldScale:!0,forceSolid:S})}),b&&g.jsx(Qc,{style:{overflow:"hidden",width:e.props.w,height:e.props.h+s.growY},children:g.jsx(Bb,{shapeId:t,type:n,font:i,fontSize:ql[c]*e.props.scale,lineHeight:Vs.lineHeight,padding:Ri*e.props.scale,fill:o,align:a,verticalAlign:l,text:u,isSelected:m,labelColor:p[s.labelColor].solid,wrap:!0})}),e.props.url&&g.jsx(Kh,{url:e.props.url})]})}indicator(e){const{id:t,props:n}=e,{w:s,size:o}=n,i=n.h+n.growY,a=Ks[o],l=this.editor.getShapeGeometry(e);switch(n.geo){case"ellipse":return n.dash==="draw"?g.jsx("path",{d:dle(t,s,i,a)}):g.jsx("path",{d:l.getSvgPathData(!0)});case"heart":return g.jsx("path",{d:U9(s,i)});case"oval":return g.jsx("path",{d:l.getSvgPathData(!0)});case"cloud":return g.jsx("path",{d:lk(s,i,t,o,e.props.scale)});default:{const c=this.editor.getShapeGeometry(e),u=c instanceof Fi?c.children[0].vertices:c.vertices;let p;if(n.dash==="draw"){const m=ak(t,u,0,a*2*e.props.scale,1);p=ik(m)}else p="M"+u[0]+"L"+u.slice(1)+"Z";const f=ck(e.props,a);if(f)for(const[m,v]of f)p+=`M${m.x},${m.y}L${v.x},${v.y}`;return g.jsx("path",{d:p})}}}toSvg(e,t){const n={...e,props:{...e.props,w:e.props.w/e.props.scale,h:e.props.h/e.props.scale}},s=n.props;t.addExportDef(LP(s.fill));let o;if(s.text){t.addExportDef(zb(s.font));const i=rc(t),a=new Ve(0,0,s.w,s.h+s.growY);o=g.jsx($b,{fontSize:ql[s.size],font:s.font,align:s.align,verticalAlign:s.verticalAlign,text:s.text,labelColor:i[s.labelColor].solid,bounds:a,padding:16})}return g.jsxs(g.Fragment,{children:[g.jsx(LD,{shouldScale:!1,shape:n,forceSolid:!1}),o]})}getCanvasSvgDefs(){return[NP()]}onResize(e,{handle:t,newPoint:n,scaleX:s,scaleY:o,initialShape:i}){const a=i.props.w/i.props.scale,l=i.props.h/i.props.scale,c=i.props.growY/i.props.scale;let u=a*s,p=(l+c)*o,f=0,m=0;const v=ND;if(e.props.text.trim()){let w=Math.max(Math.abs(u),v),M=Math.max(Math.abs(p),v);w<v&&M===v&&(w=v),w===v&&M<v&&(M=v);const R=Fy(this.editor,{...e,props:{...e.props,w:w*e.props.scale,h:M*e.props.scale}}),D=Math.max(Math.abs(u),R.w)*Math.sign(u),N=Math.max(Math.abs(p),R.h)*Math.sign(p);f=Math.abs(D)-Math.abs(u),m=Math.abs(N)-Math.abs(p),u=D,p=N}const b=u*e.props.scale,S=p*e.props.scale,C=new P(0,0);s<0&&(C.x+=b),(t==="left"||t==="top_left"||t==="bottom_left")&&(C.x+=s<0?f:-f),o<0&&(C.y+=S),(t==="top"||t==="top_left"||t==="top_right")&&(C.y+=o<0?m:-m);const{x:E,y:T}=C.rot(e.rotation).add(n);return{x:E,y:T,props:{w:Math.max(Math.abs(b),1),h:Math.max(Math.abs(S),1),growY:0}}}onBeforeCreate(e){if(!e.props.text)return e.props.growY?{...e,props:{...e.props,growY:0}}:void 0;const t=e.props.h/e.props.scale,n=Fy(this.editor,e).h;let s=null;if(n>t?s=n-t:e.props.growY&&(s=0),s!==null)return{...e,props:{...e.props,growY:s*e.props.scale}}}onBeforeUpdate(e,t){const n=e.props.text,s=t.props.text;if(n===s&&e.props.font===t.props.font&&e.props.size===t.props.size)return;if(n&&!s)return{...t,props:{...t.props,growY:0}};const o=e.props.w/e.props.scale,i=e.props.h/e.props.scale,a=e.props.growY/e.props.scale,l=Fy(this.editor,t);if(!n&&s&&s.length===1){let u=Math.max(o,l.w),p=Math.max(i,l.h);const f=ND;return o<f&&i<f&&(u=Math.max(u,f),p=Math.max(p,f),u=Math.max(u,p),p=Math.max(u,p)),{...t,props:{...t.props,w:u*t.props.scale,h:p*t.props.scale,growY:0}}}let c=null;if(l.h>i?c=l.h-i:a&&(c=0),c!==null){const u=t.props.w/t.props.scale;return{...t,props:{...t.props,growY:c*t.props.scale,w:Math.max(u,l.w)*t.props.scale}}}if(l.w>o)return{...t,props:{...t.props,w:l.w*t.props.scale}}}onDoubleClick(e){if(this.editor.inputs.altKey)switch(e.props.geo){case"rectangle":return{...e,props:{geo:"check-box"}};case"check-box":return{...e,props:{geo:"rectangle"}}}}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,w:Gt(e.props.w,t.props.w,n),h:Gt(e.props.h,t.props.h,n),scale:Gt(e.props.scale,t.props.scale,n)}}}k(fv,"type","geo"),k(fv,"props",f5),k(fv,"migrations",g5);function Fy(r,e){const{text:t,font:n,size:s,w:o}=e.props;if(!t)return{w:0,h:0};const i=r.textMeasure.measureText("w",{...Vs,fontFamily:Jl[n],fontSize:ql[s],maxWidth:100}),a={s:2,m:3.5,l:5,xl:10},l=r.textMeasure.measureText(t,{...Vs,fontFamily:Jl[n],fontSize:ql[s],minWidth:i.w,maxWidth:Math.max(0,Math.ceil(i.w+a[s]),Math.ceil(o/e.props.scale-Ri*2))});return{w:l.w+Ri*2,h:l.h+Ri*2}}function ble(){const[r,e]=I.useState(!1);return I.useEffect(()=>{const n=CSS.supports("color","color(display-p3 1 1 1)"),s=matchMedia("(color-gamut: p3)");e(n&&s.matches);const o=()=>e(n&&s.matches);return s.addEventListener("change",o),()=>s.removeEventListener("change",o)},[]),ye(_r.forceSrgb)||!r?"srgb":"p3"}const FD=.35,zD=.82;class gv extends pa{hideResizeHandles(e){return zy(e)}hideRotateHandle(e){return zy(e)}hideSelectionBoundsFg(e){return zy(e)}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1,scale:1}}getGeometry(e){const t=Bd(e);if(zy(e))return new U2({x:-t/2,y:-t/2,radius:t/2,isFilled:!0});const{strokePoints:n,sw:s}=$D(e,t,!0),o=$P({strokeWidth:s,showAsComplete:!0});return Nb(n,o),new Er({points:RP(n,o),isFilled:!0})}component(e){const t=IC(this.editor,e),n=Bd(e);return g.jsx(sd,{children:g.jsx($y,{shape:e,forceSolid:t,strokeWidth:n,opacity:FD})})}backgroundComponent(e){const t=IC(this.editor,e),n=Bd(e);return g.jsx(sd,{children:g.jsx($y,{shape:e,forceSolid:t,strokeWidth:n,opacity:zD})})}indicator(e){const t=IC(this.editor,e),n=Bd(e),{strokePoints:s,sw:o}=$D(e,n,t),i=Vh(e.props.segments);let a;return s.length<2?a=xle(i[0],o):a=vu(s,!1),g.jsx("path",{d:a})}toSvg(e){const t=Bd(e),n=t<1.5,s=1/e.props.scale;return g.jsx("g",{transform:`scale(${s})`,children:g.jsx($y,{forceSolid:n,strokeWidth:t,shape:e,opacity:FD})})}toBackgroundSvg(e){const t=Bd(e),n=t<1.5,s=1/e.props.scale;return g.jsx("g",{transform:`scale(${s})`,children:g.jsx($y,{forceSolid:n,strokeWidth:t,shape:e,opacity:zD})})}onResize(e,t){const{scaleX:n,scaleY:s}=t,o=[];for(const i of e.props.segments)o.push({...i,points:i.points.map(({x:a,y:l,z:c})=>({x:n*a,y:s*l,z:c}))});return{props:{segments:o}}}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,...t.props,segments:N9(e.props.segments,t.props.segments,n),scale:Gt(e.props.scale,t.props.scale,n)}}}k(gv,"type","highlight"),k(gv,"props",v5),k(gv,"migrations",b5);function Sle(r){return`M ${r.x} ${r.y} m -${.1}, 0 a ${.1},${.1} 0 1,0 ${.1*2},0 a ${.1},${.1} 0 1,0 -${.1*2},0`}function xle(r,e){const t=e/2;return`M ${r.x} ${r.y} m -${t}, 0 a ${t},${t} 0 1,0 ${t*2},0 a ${t},${t} 0 1,0 -${t*2},0`}function $D(r,e,t){var l;const n=Vh(r.props.segments),s=r.props.isComplete||((l=gs(r.props.segments))==null?void 0:l.type)==="straight";let o=e;!t&&!r.props.isPen&&n.length===1&&(o+=ya(r.id)()*(e/6));const i=$P({strokeWidth:o,showAsComplete:s});return{strokePoints:pl(n,i),sw:o}}function Bd(r){return Gh[r.props.size]*1.12*r.props.scale}function zy(r){return r.props.segments.length===1&&r.props.segments[0].points.length<2}function $y({strokeWidth:r,forceSolid:e,shape:t,opacity:n}){var f;const s=Bi(),o=Vh(t.props.segments);let i=r;!e&&!t.props.isPen&&o.length===1&&(i+=ya(t.id)()*(i/6));const a=$P({strokeWidth:i,showAsComplete:t.props.isComplete||((f=gs(t.props.segments))==null?void 0:f.type)==="straight"}),l=pl(o,a),c=l.length>1?vu(l,!1):Sle(t.props.segments[0].points[0]),u=ble(),p=s[t.props.color].highlight[u];return g.jsx("path",{d:c,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:p,strokeWidth:i,opacity:n})}function IC(r,e){return ye("forceSolid",()=>{const t=Bd(e),n=r.getZoomLevel();return t/n<1.5},[r])}function H9(){return g.jsxs("svg",{width:"15",height:"15",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[g.jsx("path",{d:"M3,11 L3,3 11,3",strokeWidth:"2"}),g.jsx("path",{d:"M19,27 L27,27 L27,19",strokeWidth:"2"}),g.jsx("path",{d:"M27,3 L3,27",strokeWidth:"2"})]})}function G9({shapeId:r,assetId:e}){const t=ue(),n=!!Gg(),s=NX(),o=I.useMemo(()=>z0(BD,500),[]),[i,a]=I.useState(()=>({asset:e?t.getAsset(e)??null:null,url:null})),l=I.useRef(!1),c=I.useRef(null);return I.useEffect(()=>{if(!e)return;let u=!1,p;const f=nl("update state",()=>{if(!n&&t.getCulledShapes().has(r))return;const m=t.getAsset(e);if(!m)return;const v=t.getShape(r);if(!v)return;if(!m.props.src){const C=t.getTemporaryAssetPreview(m.id);if(C){c.current!==C&&(c.current=C,a(E=>({...E,isPlaceholder:!0,url:C})),s());return}}const b=t.getZoomLevel()*(v.props.w/m.props.w);function S(C,E){u||c.current!==E&&(l.current=!0,c.current=E,a({asset:C,url:E}),s())}l.current?(o(t,e,b,n,C=>S(m,C)),p=o.cancel):BD(t,e,b,n,C=>S(m,C))});return()=>{f(),p==null||p(),u=!0}},[t,e,n,s,r,o]),i}function BD(r,e,t,n,s){r.resolveAssetUrl(e,{screenScale:t,shouldResolveToOriginal:n}).then(o=>{s(o)})}async function wle(r){const t=await(await al(r)).blob();return aa.blobToDataUrl(t)}class mv extends up{isAspectRatioLocked(){return!0}canCrop(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null,flipX:!1,flipY:!1}}onResize(e,t){let n=fb(e,t);const{flipX:s,flipY:o}=t.initialShape.props,{scaleX:i,scaleY:a,mode:l}=t;if(n={...n,props:{...n.props,flipX:i<0!==s,flipY:a<0!==o}},!e.props.crop)return n;const c=l==="scale_shape"&&i===-1||l==="resize_bounds"&&s!==n.props.flipX,u=l==="scale_shape"&&a===-1||l==="resize_bounds"&&o!==n.props.flipY,{topLeft:p,bottomRight:f}=e.props.crop;return n.props.crop={topLeft:{x:c?1-f.x:p.x,y:u?1-f.y:p.y},bottomRight:{x:c?1-p.x:f.x,y:u?1-p.y:f.y}},n}component(e){return g.jsx(Cle,{shape:e})}indicator(e){return this.editor.getCroppingShapeId()===e.id?null:g.jsx("rect",{width:fe(e.props.w),height:fe(e.props.h)})}async toSvg(e){if(!e.props.assetId||!this.editor.getAsset(e.props.assetId))return null;let n=await this.editor.resolveAssetUrl(e.props.assetId,{shouldResolveToOriginal:!0});return n?((n.startsWith("blob:")||n.startsWith("http")||n.startsWith("/")||n.startsWith("./"))&&(n=await wle(n)||""),g.jsx(kle,{shape:e,src:n})):null}onDoubleClickEdge(e){const t=e.props;if(!t||this.editor.getCroppingShapeId()!==e.id)return;const n=Kn(t.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},s=1/(n.bottomRight.x-n.topLeft.x)*e.props.w,o=1/(n.bottomRight.y-n.topLeft.y)*e.props.h,i=new P(n.topLeft.x*s,n.topLeft.y*o).rot(e.rotation),a={id:e.id,type:e.type,x:e.x-i.x,y:e.y-i.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:s,h:o}};this.editor.updateShapes([a])}getInterpolatedProps(e,t,n){function s(o,i){var p,f,m,v;if(o.props.crop===null&&i.props.crop===null)return null;const a=((p=o.props.crop)==null?void 0:p.topLeft)||{x:0,y:0},l=((f=o.props.crop)==null?void 0:f.bottomRight)||{x:1,y:1},c=((m=i.props.crop)==null?void 0:m.topLeft)||{x:0,y:0},u=((v=i.props.crop)==null?void 0:v.bottomRight)||{x:1,y:1};return{topLeft:{x:Gt(a.x,c.x,n),y:Gt(a.y,c.y,n)},bottomRight:{x:Gt(l.x,u.x,n),y:Gt(l.y,u.y,n)}}}return{...n>.5?t.props:e.props,w:Gt(e.props.w,t.props.w,n),h:Gt(e.props.h,t.props.h,n),crop:s(e,t)}}}k(mv,"type","image"),k(mv,"props",S5),k(mv,"migrations",x5);const Cle=I.memo(function({shape:e}){var C;const t=ue(),{asset:n,url:s}=G9({shapeId:e.id,assetId:e.props.assetId}),o=w8(),[i,a]=I.useState(""),[l,c]=I.useState(null),u=Ele(t,e);I.useEffect(()=>{if(s&&u){let E=!1;const T=Ff();return T.onload=()=>{if(E)return;const w=document.createElement("canvas");w.width=T.width,w.height=T.height;const M=w.getContext("2d");M&&(M.drawImage(T,0,0),a(w.toDataURL()),c(s))},T.crossOrigin="anonymous",T.src=s,()=>{E=!0}}},[t,u,o,s]);const p=ye("show crop preview",()=>e.id===t.getOnlySelectedShapeId()&&t.getCroppingShapeId()===e.id&&t.isIn("select.crop"),[t,e.id]),f=o&&(((C=n==null?void 0:n.props.mimeType)==null?void 0:C.includes("video"))||u),m=W9(e),v=s===l?null:s,b=f?i:l;if(!s&&!(n!=null&&n.props.src))return g.jsxs(Qc,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h,color:"var(--color-text-3)",backgroundColor:"var(--color-low)",border:"1px solid var(--color-low-border)"},children:[g.jsx("div",{className:it("tl-image-container",n&&"tl-image-container-loading"),style:m,children:n?null:g.jsx(H9,{})}),"url"in e.props&&e.props.url&&g.jsx(Kh,{url:e.props.url})]});const S=u?"anonymous":void 0;return g.jsxs(g.Fragment,{children:[p&&b&&g.jsx("div",{style:m,children:g.jsx("img",{className:"tl-image",style:{...jf(e),opacity:.1},crossOrigin:S,src:b,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1})}),g.jsxs(Qc,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h},children:[g.jsxs("div",{className:it("tl-image-container"),style:m,children:[b&&g.jsx("img",{className:"tl-image",style:jf(e),crossOrigin:S,src:b,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1},b),v&&g.jsx("img",{className:"tl-image",style:jf(e),crossOrigin:S,src:v,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,onLoad:()=>c(v)},v)]}),e.props.url&&g.jsx(Kh,{url:e.props.url})]})]})});function Ele(r,e){const t=e.props.assetId?r.getAsset(e.props.assetId):void 0;return t?"mimeType"in t.props&&ri.isAnimatedImageType(t==null?void 0:t.props.mimeType)||"isAnimated"in t.props&&t.props.isAnimated:!1}function W9(r){const e=r.props.crop,t=e==null?void 0:e.topLeft;if(!t)return{width:r.props.w,height:r.props.h};const n=1/(e.bottomRight.x-e.topLeft.x)*r.props.w,s=1/(e.bottomRight.y-e.topLeft.y)*r.props.h,o=-t.x*n,i=-t.y*s;return{transform:`translate(${o}px, ${i}px)`,width:n,height:s}}function jf(r,e){const{flipX:t,flipY:n}=r.props;if(!t&&!n)return;const s=`scale(${t?-1:1}, ${n?-1:1})`;return{transform:`${e?`translate(${t?e.width:0}px, ${n?e.height:0}px)`:""} ${s}`,transformOrigin:e?"0 0":"center center"}}function kle({shape:r,src:e}){const t=sp(),n=W9(r),s=r.props.crop;if(n.transform&&s){const{transform:o,width:i,height:a}=n,l=(s.bottomRight.x-s.topLeft.x)*i,c=(s.bottomRight.y-s.topLeft.y)*a,u=[new P(0,0),new P(l,0),new P(l,c),new P(0,c)],p=jf(r,{width:i,height:a});return g.jsxs(g.Fragment,{children:[g.jsx("defs",{children:g.jsx("clipPath",{id:t,children:g.jsx("polygon",{points:u.map(f=>`${f.x},${f.y}`).join(" ")})})}),g.jsx("g",{clipPath:`url(#${t})`,children:g.jsx("image",{href:e,width:i,height:a,style:p?{...p,transform:`${o} ${p.transform}`}:{transform:o}})})]})}else return g.jsx("image",{href:e,width:r.props.w,height:r.props.h,style:jf(r,{width:r.props.w,height:r.props.h})})}function K9(r){return{size:r,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function V9(r,e,t){const n=e.vertices,s=K9(t);return pl(n,s)}function Ple(r,e,t){const n=K9(t);return RP(Nb(V9(r,e,t),n),n)}function Ile(r,e,t){const n=Ple(r,e,t);return E2(n)}function _le(r,e,t){if(r.props.dash==="draw"){const n=V9(r,e,t);return vu(n)}return e.getSvgPathData()}function q9(r,e,t){let n=`M ${ln(e[0])}L`,s=`M ${ln(e[0])}L`;const o=t/3,i=t*2,a=ya(r);let l=e[0],c,u=e[0],p;const f=e.length;for(let m=0,v=f-1;m<v;m++){c=e[m+1],p=P.AddXY(e[m+1],a()*o,a()*o);const b=P.Sub(c,l),S=P.Len(b),C=P.Div(b,S).mul(Math.min(S/4,i)),E=P.Add(l,C),T=P.Add(c,C.neg()),w=P.Sub(p,u),M=P.Len(w),R=P.Div(w,M).mul(Math.min(M/4,i)),D=P.Add(u,R),N=P.Add(p,R.neg());m===v-1?(n+=`${ln(E)}L ${ln(c)}`,s+=`${ln(D)}L ${ln(p)}`):(n+=`${ln(E)}L ${ln(T)}Q ${ln(c)}`,s+=`${ln(D)}L ${ln(N)}Q ${ln(p)}`,l=c,u=p)}return[n,n+s]}const Tle=new il;class yv extends pa{hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsFg(){return!0}hideSelectionBoundsBg(){return!0}getDefaultProps(){const[e,t]=$f(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[e]:{id:e,index:e,x:0,y:0},[t]:{id:t,index:t,x:.1,y:.1}},scale:1}}getGeometry(e){return Sf(e)}getHandles(e){return Tle.get(e.props,()=>{const t=Sf(e),n=bf(e),s=n.map(o=>({...o,id:o.index,type:"vertex",canSnap:!0}));for(let o=0;o<n.length-1;o++){const i=zf(n[o].index,n[o+1].index),l=t.segments[o].midPoint();s.push({id:i,type:"create",index:i,x:l.x,y:l.y,canSnap:!0})}return s.sort(Hs)})}onResize(e,t){const{scaleX:n,scaleY:s}=t;return{props:{points:jg(e.props.points,(o,{id:i,index:a,x:l,y:c})=>({id:i,index:a,x:l*n,y:c*s}))}}}onBeforeCreate(e){const{props:{points:t}}=e,n=Object.keys(t);if(n.length<2)return;const s=t[n[0]];if(n.every(i=>{const a=t[i];return a.x===s.x&&a.y===s.y})){const i=n[n.length-1];return t[i]={...t[i],x:t[i].x+.1,y:t[i].y+.1},e}}onHandleDrag(e,{handle:t}){if(t.type!=="vertex")return;const n=fa(new P(t.x,t.y),this.editor);return{...e,props:{...e.props,points:{...e.props.points,[t.id]:{id:t.id,index:t.index,x:n.x,y:n.y}}}}}component(e){return g.jsx(sd,{children:g.jsx(UD,{shape:e})})}indicator(e){const t=el[e.props.size]*e.props.scale,n=Sf(e),{dash:s}=e.props;let o;if(e.props.spline==="line"){const i=n.points;if(s==="solid"||s==="dotted"||s==="dashed")o="M"+i[0]+"L"+i.slice(1);else{const[a]=q9(e.id,i,t);o=a}}else o=_le(e,n,t);return g.jsx("path",{d:o})}toSvg(e){return g.jsx(UD,{shouldScale:!0,shape:e})}getHandleSnapGeometry(e){const t=bf(e);return{points:t,getSelfSnapPoints:n=>{const s=this.getHandles(e).filter(o=>o.type==="vertex").findIndex(o=>o.id===n.id);return t.filter((o,i)=>Math.abs(i-s)>1).map(P.From)},getSelfSnapOutline:n=>{const s=this.getHandles(e).filter(i=>i.type==="vertex").findIndex(i=>i.id===n.id),o=Sf(e).segments.filter((i,a)=>a!==s-1&&a!==s);return o.length?new Fi({children:o}):null}}}getInterpolatedProps(e,t,n){const s=bf(e),o=bf(t),i=[],a=[];let l=VO;if(s.length>o.length)for(let c=0;c<s.length;c++)i[c]={...s[c]},o[c]===void 0?a[c]={...o[o.length-1],id:l}:a[c]={...o[c],id:l},l=Za(l);else if(o.length>s.length)for(let c=0;c<o.length;c++)a[c]={...o[c]},s[c]===void 0?i[c]={...s[s.length-1],id:l}:i[c]={...s[c],id:l},l=Za(l);else for(let c=0;c<o.length;c++)i[c]=s[c],a[c]=o[c];return{...n>.5?t.props:e.props,points:Object.fromEntries(i.map((c,u)=>{const p=a[u];return[c.id,{...c,x:Gt(c.x,p.x,n),y:Gt(c.y,p.y,n)}]})),scale:Gt(e.props.scale,t.props.scale,n)}}}k(yv,"type","line"),k(yv,"props",w5),k(yv,"migrations",C5);function bf(r){return Object.values(r.props.points).sort(Hs)}function Sf(r){const e=bf(r).map(P.From);switch(r.props.spline){case"cubic":return new wQ({points:e});case"line":return new ap({points:e})}}function UD({shape:r,shouldScale:e=!1,forceSolid:t=!1}){const n=Bi(),s=Sf(r),{dash:o,color:i,size:a}=r.props,l=1/r.props.scale,c=e?l:1,u=el[a]*r.props.scale;if(r.props.spline==="line"){if(o==="solid"){const p=s.points,f="M"+p[0]+"L"+p.slice(1);return g.jsx("path",{d:f,stroke:n[i].solid,strokeWidth:u,fill:"none",transform:`scale(${c})`})}if(o==="dashed"||o==="dotted")return g.jsx("g",{stroke:n[i].solid,strokeWidth:u,transform:`scale(${c})`,children:s.segments.map((p,f)=>{const{strokeDasharray:m,strokeDashoffset:v}=t?{strokeDasharray:"none",strokeDashoffset:"none"}:sa(p.length,u,{style:o,start:f>0?"outset":"none",end:f<s.segments.length-1?"outset":"none"});return g.jsx("path",{strokeDasharray:m,strokeDashoffset:v,d:p.getSvgPathData(!0),fill:"none"},f)})});if(o==="draw"){const p=s.points,[f,m]=q9(r.id,p,u);return g.jsx("path",{d:m,stroke:n[i].solid,strokeWidth:u,fill:"none",transform:`scale(${c})`})}}if(r.props.spline==="cubic"){const p=s.getSvgPathData();if(o==="solid")return g.jsx("path",{strokeWidth:u,stroke:n[i].solid,fill:"none",d:p,transform:`scale(${c})`});if(o==="dashed"||o==="dotted")return g.jsx("g",{stroke:n[i].solid,strokeWidth:u,transform:`scale(${c})`,children:s.segments.map((f,m)=>{const{strokeDasharray:v,strokeDashoffset:b}=sa(f.length,u,{style:o,start:m>0?"outset":"none",end:m<s.segments.length-1?"outset":"none",forceSolid:t});return g.jsx("path",{strokeDasharray:v,strokeDashoffset:b,d:f.getSvgPathData(),fill:"none"},m)})});if(o==="draw")return g.jsx("path",{d:Ile(r,s,u),strokeWidth:1,stroke:n[i].solid,fill:n[i].solid,transform:`scale(${c})`})}}class vv extends pa{canEdit(){return!0}hideResizeHandles(){return!0}hideSelectionBoundsFg(){return!1}getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",labelColor:"black",growY:0,fontSizeAdjustment:0,url:"",scale:1}}getGeometry(e){const{labelHeight:t,labelWidth:n}=Y9(this.editor,e),{scale:s}=e.props,o=t*s,i=n*s,a=_n*s,l=By(e);return new Fi({children:[new dl({width:a,height:l,isFilled:!0}),new dl({x:e.props.align==="start"?0:e.props.align==="end"?a-i:(a-i)/2,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?l-o:(l-o)/2,width:i,height:o,isFilled:!0,isLabel:!0})]})}getHandles(e){const{scale:t}=e.props;if(this.editor.getInstanceState().isCoarsePointer)return[];const s=this.editor.getZoomLevel();if(s*t<.25)return[];const o=By(e),i=_n*t,a=qie/s*t;return s*t<.5?[{id:"bottom",index:"a3",type:"clone",x:i/2,y:o+a}]:[{id:"top",index:"a1",type:"clone",x:i/2,y:-a},{id:"right",index:"a2",type:"clone",x:i+a,y:o/2},{id:"bottom",index:"a3",type:"clone",x:i/2,y:o+a},{id:"left",index:"a4",type:"clone",x:-a,y:o/2}]}getText(e){return e.props.text}component(e){const{id:t,type:n,props:{labelColor:s,scale:o,color:i,font:a,size:l,align:c,text:u,verticalAlign:p,fontSizeAdjustment:f}}=e,m=jle(t),v=Bi(),b=_n*o,S=By(e),C=ye("shape rotation",()=>{var M;return((M=this.editor.getShapePageTransform(t))==null?void 0:M.rotation())??0},[this.editor]),E=ye("zoom",()=>this.editor.getZoomLevel()<.35/o,[o,this.editor]),T=ye("dark mode",()=>this.editor.user.getIsDarkMode(),[this.editor]),w=e.id===this.editor.getOnlySelectedShapeId();return g.jsxs(g.Fragment,{children:[g.jsx("div",{id:t,className:"tl-note__container",style:{width:b,height:S,backgroundColor:v[i].note.fill,borderBottom:E?T?`${2*o}px solid rgb(20, 20, 20)`:`${2*o}px solid rgb(144, 144, 144)`:"none",boxShadow:E?"none":Rle(e.id,C,o)},children:g.jsx(Bb,{shapeId:t,type:n,font:a,fontSize:(f||ql[l])*o,lineHeight:Vs.lineHeight,align:c,verticalAlign:p,text:u,isNote:!0,isSelected:w,labelColor:s==="black"?v[i].note.text:v[s].fill,wrap:!0,padding:16*o,onKeyDown:m})}),"url"in e.props&&e.props.url&&g.jsx(Kh,{url:e.props.url})]})}indicator(e){const{scale:t}=e.props;return g.jsx("rect",{rx:t,width:fe(_n*t),height:fe(By(e))})}toSvg(e,t){e.props.text&&t.addExportDef(zb(e.props.font));const n=rc({isDarkMode:t.isDarkMode}),s=Dle(e);return g.jsxs(g.Fragment,{children:[g.jsx("rect",{x:5,y:5,rx:1,width:_n-10,height:s.h,fill:"rgba(0,0,0,.1)"}),g.jsx("rect",{rx:1,width:_n,height:s.h,fill:n[e.props.color].note.fill}),g.jsx($b,{fontSize:e.props.fontSizeAdjustment||ql[e.props.size],font:e.props.font,align:e.props.align,verticalAlign:e.props.verticalAlign,text:e.props.text,labelColor:n[e.props.color].note.text,bounds:s,stroke:!1})]})}onBeforeCreate(e){return HD(this.editor,e)}onBeforeUpdate(e,t){if(!(e.props.text===t.props.text&&e.props.font===t.props.font&&e.props.size===t.props.size))return HD(this.editor,t)}onEditEnd(e){const{id:t,type:n,props:{text:s}}=e;s.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:s.trimEnd()}}])}getInterpolatedProps(e,t,n){return{...n>.5?t.props:e.props,scale:Gt(e.props.scale,t.props.scale,n)}}}k(vv,"type","note"),k(vv,"props",E5),k(vv,"migrations",k5);function HD(r,e){const{labelHeight:t,fontSizeAdjustment:n}=Y9(r,e),s=Math.max(0,t-_n);if(s!==e.props.growY||n!==e.props.fontSizeAdjustment)return{...e,props:{...e.props,growY:s,fontSizeAdjustment:n}}}function Mle(r,e){const{text:t}=e.props;if(!t)return{labelHeight:ql[e.props.size]*Vs.lineHeight+Ri*2,labelWidth:100,fontSizeAdjustment:0};const n=ql[e.props.size];let s=0,o=0,i=_n,a=_n;const l=1;do{s=Math.min(n,n-o);const c=r.textMeasure.measureText(t,{...Vs,fontFamily:Jl[e.props.font],fontSize:s,maxWidth:_n-Ri*2-l,disableOverflowWrapBreaking:!0});if(i=c.h+Ri*2,a=c.w+Ri*2,s<=14){const u=r.textMeasure.measureText(t,{...Vs,fontFamily:Jl[e.props.font],fontSize:s,maxWidth:_n-Ri*2-l});i=u.h+Ri*2,a=u.w+Ri*2;break}if(c.scrollWidth.toFixed(0)===c.w.toFixed(0))break}while(o++<50);return{labelHeight:i,labelWidth:a,fontSizeAdjustment:s}}const Ale=new il;function Y9(r,e){return Ale.get(e,()=>Mle(r,e))}function jle(r){const e=ue(),t=EF();return I.useCallback(n=>{const s=e.getShape(r);if(!s)return;const o=n.key==="Tab",i=(n.metaKey||n.ctrlKey)&&n.key==="Enter";if(o||i){n.preventDefault();const a=e.getShapePageTransform(r),l=a.rotation(),c=!!(t.dir==="rtl"||b9(s.props.text)),u=(_n+e.options.adjacentShapeMargin+(i&&!n.shiftKey?s.props.growY:0))*s.props.scale,p=new P(o?n.shiftKey!=c?-1:1:0,i?n.shiftKey?-1:1:0).mul(u).add(Fb.clone().mul(s.props.scale)).rot(l).add(a.point()),f=P9(e,s,p,l);f&&(e.markHistoryStoppingPoint("editing adjacent shape"),l0(e,f,!0))}},[r,e,t.dir])}function By(r){return(_n+r.props.growY)*r.props.scale}function Rle(r,e,t){const n=ya(r),s=Math.abs(n())+.5,o=Math.cos(e),i=5*t,a=4*t,l=6*t,c=7*t;return`0px ${i-s}px ${i}px -${i}px rgba(15, 23, 31, .6),
	0px ${(a+s*c)*Math.max(0,o)}px ${l+s*c}px -${a+s*l}px rgba(15, 23, 31, ${(.3+s*.1).toFixed(2)}), 
	0px ${48*t}px ${10*t}px -${10*t}px inset rgba(15, 23, 44, ${((.022+n()*.005)*((1+o)/2)).toFixed(2)})`}function Dle(r){return new Ve(0,0,_n,_n+r.props.growY)}function Ole(r,{initialBounds:e,scaleX:t,scaleY:n,newPoint:s}){const o=Math.max(.01,Math.min(Math.abs(t),Math.abs(n))),i=new P(0,0);t<0&&(i.x=-(e.width*o)),n<0&&(i.y=-(e.height*o));const{x:a,y:l}=P.Add(s,i.rot(r.rotation));return{x:a,y:l,props:{scale:o*r.props.scale}}}const Lle=new il;class bv extends pa{getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",textAlign:"start",autoSize:!0,scale:1}}getMinDimensions(e){return Lle.get(e.props,t=>GD(this.editor,t))}getGeometry(e){const{scale:t}=e.props,{width:n,height:s}=this.getMinDimensions(e);return new dl({width:n*t,height:s*t,isFilled:!0,isLabel:!0})}getText(e){return e.props.text}canEdit(){return!0}isAspectRatioLocked(){return!0}component(e){const{id:t,props:{font:n,size:s,text:o,color:i,scale:a,textAlign:l}}=e,{width:c,height:u}=this.getMinDimensions(e),p=e.id===this.editor.getOnlySelectedShapeId(),f=Bi(),m=Nle(t);return g.jsx(Bb,{shapeId:t,classNamePrefix:"tl-text-shape",type:"text",font:n,fontSize:Gh[s],lineHeight:Vs.lineHeight,align:l,verticalAlign:"middle",text:o,labelColor:f[i].solid,isSelected:p,textWidth:c,textHeight:u,style:{transform:`scale(${a})`,transformOrigin:"top left"},wrap:!0,onKeyDown:m})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds,n=ue();return e.props.autoSize&&n.getEditingShapeId()===e.id?null:g.jsx("rect",{width:fe(t.width),height:fe(t.height)})}toSvg(e,t){e.props.text&&t.addExportDef(zb(e.props.font));const n=this.editor.getShapeGeometry(e).bounds,s=n.width/(e.props.scale??1),o=n.height/(e.props.scale??1),i=rc(t);return g.jsx($b,{fontSize:Gh[e.props.size],font:e.props.font,align:e.props.textAlign,verticalAlign:"middle",text:e.props.text,labelColor:i[e.props.color].solid,bounds:new Ve(0,0,s,o),padding:0})}onResize(e,t){const{newPoint:n,initialBounds:s,initialShape:o,scaleX:i,handle:a}=t;if(t.mode==="scale_shape"||a!=="right"&&a!=="left")return{id:e.id,type:e.type,...Ole(e,t)};{const l=Math.max(1,Math.abs(s.width*i)),{x:c,y:u}=i<0?P.Sub(n,P.FromAngle(e.rotation).mul(l)):n;return{id:e.id,type:e.type,x:c,y:u,props:{w:l/o.props.scale,autoSize:!1}}}}onEditEnd(e){const{id:t,type:n,props:{text:s}}=e,o=e.props.text.trimEnd();o.length===0?this.editor.deleteShapes([e.id]):o!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:s.trimEnd()}}])}onBeforeUpdate(e,t){if(!t.props.autoSize)return;const n=e.props.size!==t.props.size||e.props.textAlign!==t.props.textAlign||e.props.font!==t.props.font||e.props.scale!==1&&t.props.scale===1,s=e.props.text!==t.props.text;if(!n&&!s)return;const o=this.getMinDimensions(e),i=GD(this.editor,t.props),a=o.width*e.props.scale,l=o.height*e.props.scale,c=i.width*t.props.scale,u=i.height*t.props.scale;let p;switch(t.props.textAlign){case"middle":{p=new P((c-a)/2,s?0:(u-l)/2);break}case"end":{p=new P(c-a,s?0:(u-l)/2);break}default:{if(s)break;p=new P(0,(u-l)/2);break}}if(p){p.rot(t.rotation);const{x:f,y:m}=t;return{...t,x:f-p.x,y:m-p.y,props:{...t.props,w:c}}}else return{...t,props:{...t.props,w:c}}}}k(bv,"type","text"),k(bv,"props",P5),k(bv,"migrations",I5);function GD(r,e){const{font:t,text:n,autoSize:s,size:o,w:i}=e,a=s?16:Math.max(16,i),l=Gh[o],c=s?null:Math.floor(Math.max(a,i)),u=r.textMeasure.measureText(n,{...Vs,fontFamily:Jl[t],fontSize:l,maxWidth:c});return s&&(u.w+=1),{width:Math.max(a,u.w),height:Math.max(l,u.h)}}function Nle(r){const e=ue();return I.useCallback(t=>{if(e.getEditingShapeId()===r)switch(t.key){case"Enter":{(t.ctrlKey||t.metaKey)&&e.complete();break}case"Tab":{Ot(t),t.shiftKey?Wh.unindent(t.currentTarget):Wh.indent(t.currentTarget);break}}},[e,r])}class Sv extends up{canEdit(){return!0}isAspectRatioLocked(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(e){return g.jsx(Fle,{shape:e})}indicator(e){return g.jsx("rect",{width:fe(e.props.w),height:fe(e.props.h)})}async toSvg(e){const t=await zle(this.editor,e);return t?g.jsx("image",{href:t,width:e.props.w,height:e.props.h}):null}}k(Sv,"type","video"),k(Sv,"props",_5),k(Sv,"migrations",T5);const Fle=I.memo(function({shape:e}){const t=ue(),n=t.getShapeGeometry(e).bounds.w*t.getZoomLevel()>=110,s=gb(e.id),o=w8(),{Spinner:i}=Vn(),{asset:a,url:l}=G9({shapeId:e.id,assetId:e.props.assetId}),c=I.useRef(null),[u,p]=I.useState(!1),[f,m]=I.useState(!1);I.useEffect(()=>{const b=()=>m(document.fullscreenElement===c.current);return document.addEventListener("fullscreenchange",b),()=>document.removeEventListener("fullscreenchange",b)});const v=I.useCallback(b=>{b.currentTarget&&p(!0)},[]);return I.useEffect(()=>{const b=c.current;b&&s&&document.activeElement!==b&&b.focus()},[s,u]),I.useEffect(()=>{if(o){const b=c.current;if(!b)return;b.pause(),b.currentTime=0}},[c,o]),g.jsxs(g.Fragment,{children:[g.jsx(Qc,{id:e.id,style:{color:"var(--color-text-3)",backgroundColor:a?"transparent":"var(--color-low)",border:a?"none":"1px solid var(--color-low-border)"},children:g.jsx("div",{className:"tl-counter-scaled",children:g.jsx("div",{className:"tl-video-container",children:a?i&&!a.props.src?g.jsx(i,{}):l?g.jsxs(g.Fragment,{children:[g.jsx("video",{ref:c,style:s?{pointerEvents:"all"}:u?void 0:{display:"none"},className:it("tl-video",`tl-video-shape-${e.id.split(":")[1]}`,{"tl-video-is-fullscreen":f}),width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:s&&n,onLoadedData:v,hidden:!u,children:g.jsx("source",{src:l})}),!u&&i&&g.jsx(i,{})]}):null:g.jsx(H9,{})})})}),"url"in e.props&&e.props.url&&g.jsx(Kh,{url:e.props.url})]})});async function zle(r,e){const t=await r.resolveAssetUrl(e.props.assetId,{shouldResolveToOriginal:!0});if(!t)return null;const n=await ri.loadVideo(t);return ri.getVideoFrameAsDataUrl(n,0)}const X9=[bv,uv,hv,fv,vv,yv,pv,dv,gv,y0,mv,Sv];function $le(r){return r.sideEffects.register({instance_page_state:{afterChange:(e,t)=>{if(e.croppingShapeId!==t.croppingShapeId){const n=r.isIn("select.crop");!e.croppingShapeId&&t.croppingShapeId?n||r.setCurrentTool("select.crop.idle"):e.croppingShapeId&&!t.croppingShapeId&&n&&r.setCurrentTool("select.idle")}if(e.editingShapeId!==t.editingShapeId)if(!e.editingShapeId&&t.editingShapeId){if(!r.isIn("select.editing_shape")){const n=r.getEditingShape();n&&n.type==="text"&&r.isInAny("text.pointing","select.resizing")&&r.getInstanceState().isToolLocked?r.setCurrentTool("select.editing_shape",{isCreatingTextWhileToolLocked:!0}):r.setCurrentTool("select.editing_shape")}}else e.editingShapeId&&!t.editingShapeId&&r.isIn("select.editing_shape")&&r.setCurrentTool("select.idle")}}})}class Z9 extends nt{constructor(){super(...arguments);k(this,"info",{});k(this,"scribbleId","id");k(this,"markId","");k(this,"excludedShapeIds",new Set)}onEnter(t){this.markId=this.editor.markHistoryStoppingPoint("erase scribble begin"),this.info=t;const{originPagePoint:n}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(o=>{if(this.editor.isShapeOrAncestorLocked(o))return!0;if(this.editor.isShapeOfType(o,"group")||this.editor.isShapeOfType(o,"frame")){const i=this.editor.getPointInShapeSpace(o,n);return this.editor.getShapeGeometry(o).bounds.containsPoint(i)}return!1}).map(o=>o.id));const s=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=s.id,this.update()}pushPointToScribble(){const{x:t,y:n}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,n)}onExit(){this.editor.setErasingShapes([]),this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}update(){const{editor:t,excludedShapeIds:n}=this,s=t.getErasingShapeIds(),o=t.getZoomLevel(),i=t.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:a,previousPagePoint:l}}=t;this.pushPointToScribble();const c=new Set(s),u=this.editor.options.hitTestMargin/o;for(const p of i){if(t.isShapeOfType(p,"group"))continue;const f=t.getShapeMask(p.id);if(f&&!ai(a,f))continue;const m=t.getShapeGeometry(p),v=t.getShapePageTransform(p);if(!m||!v)continue;const b=v.clone().invert(),S=b.applyToPoint(l),C=b.applyToPoint(a),{bounds:E}=m;E.minX-u>Math.max(S.x,C.x)||E.minY-u>Math.max(S.y,C.y)||E.maxX+u<Math.min(S.x,C.x)||E.maxY+u<Math.min(S.y,C.y)||m.hitTestLineSegment(S,C,u)&&c.add(t.getOutermostSelectableShape(p).id)}this.editor.setErasingShapes([...c].filter(p=>!n.has(p)))}complete(){const{editor:t}=this;t.deleteShapes(t.getCurrentPageState().erasingShapeIds),this.parent.transition("idle")}cancel(){const{editor:t}=this;t.bailToMark(this.markId),this.parent.transition("idle",this.info)}}k(Z9,"id","erasing");var XC;let Ble=(XC=class extends nt{onPointerDown(e){this.parent.transition("pointing",e)}onCancel(){this.editor.setCurrentTool("select")}},k(XC,"id","idle"),XC);var ZC;let Ule=(ZC=class extends nt{onEnter(){const e=this.editor.getZoomLevel(),t=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:n}}=this.editor,s=new Set,o=s.size;for(let i=t.length,a=i-1;a>=0;a--){const l=t[a];if(!(this.editor.isShapeOrAncestorLocked(l)||this.editor.isShapeOfType(l,"group"))&&this.editor.isPointInShape(l,n,{hitInside:!1,margin:this.editor.options.hitTestMargin/e})){const c=this.editor.getOutermostSelectableShape(l);if(this.editor.isShapeOfType(c,"frame")&&s.size>o)break;s.add(c.id)}}this.editor.setErasingShapes([...s])}onLongPress(e){this.startErasing(e)}onExit(e,t){t!=="erasing"&&this.editor.setErasingShapes([])}onPointerMove(e){this.editor.inputs.isDragging&&this.startErasing(e)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}startErasing(e){this.parent.transition("erasing",e)}complete(){const e=this.editor.getErasingShapeIds();e.length&&(this.editor.markHistoryStoppingPoint("erase end"),this.editor.deleteShapes(e)),this.parent.transition("idle")}cancel(){this.parent.transition("idle")}},k(ZC,"id","pointing"),ZC);class xv extends nt{static children(){return[Ble,Ule,Z9]}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}}k(xv,"id","eraser"),k(xv,"initial","idle"),k(xv,"isLockable",!1);class J9 extends nt{constructor(){super(...arguments);k(this,"initialCamera",new P)}onEnter(){this.initialCamera=P.From(this.editor.getCamera()),this.update()}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.parent.transition("idle")}onComplete(){this.complete()}update(){const{initialCamera:t,editor:n}=this,{currentScreenPoint:s,originScreenPoint:o}=n.inputs,i=P.Sub(s,o).div(n.getZoomLevel());i.len2()!==0&&n.setCamera(t.clone().add(i))}complete(){const{editor:t}=this,{pointerVelocity:n}=t.inputs,s=Math.min(n.len(),2);s>.1&&this.editor.slideCamera({speed:s,direction:n}),this.parent.transition("idle")}}k(J9,"id","dragging");var JC;let Hle=(JC=class extends nt{onEnter(){this.editor.setCursor({type:"grab",rotation:0})}onPointerDown(e){this.parent.transition("pointing",e)}onCancel(){this.editor.setCurrentTool("select")}},k(JC,"id","idle"),JC);var QC;let Gle=(QC=class extends nt{onEnter(){this.editor.stopCameraAnimation(),this.editor.setCursor({type:"grabbing",rotation:0})}onLongPress(){this.startDragging()}onPointerMove(){this.editor.inputs.isDragging&&this.startDragging()}startDragging(){this.parent.transition("dragging")}onPointerUp(){this.complete()}onCancel(){this.complete()}onComplete(){this.complete()}onInterrupt(){this.complete()}complete(){this.parent.transition("idle")}},k(QC,"id","pointing"),QC);class wv extends nt{static children(){return[Hle,Gle,J9]}onDoubleClick(e){if(e.phase==="settle"){const{currentScreenPoint:t}=this.editor.inputs;this.editor.zoomIn(t,{animation:{duration:220,easing:ss.easeOutQuint}})}}onTripleClick(e){if(e.phase==="settle"){const{currentScreenPoint:t}=this.editor.inputs;this.editor.zoomOut(t,{animation:{duration:320,easing:ss.easeOutQuint}})}}onQuadrupleClick(e){if(e.phase==="settle"){const t=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:n}}=this.editor;t===1?this.editor.zoomToFit({animation:{duration:400,easing:ss.easeOutQuint}}):this.editor.resetZoom(n,{animation:{duration:320,easing:ss.easeOutQuint}})}}}k(wv,"id","hand"),k(wv,"initial","idle"),k(wv,"isLockable",!1);var eE;let Wle=(eE=class extends nt{onPointerDown(e){this.parent.transition("lasering",e)}},k(eE,"id","idle"),eE);class Q9 extends nt{constructor(){super(...arguments);k(this,"scribbleId","id")}onEnter(){const t=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:this.editor.options.laserDelayMs,shrink:.05,taper:!0});this.scribbleId=t.id,this.pushPointToScribble()}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.pushPointToScribble()}onPointerUp(){this.complete()}pushPointToScribble(){const{x:t,y:n}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,n)}onCancel(){this.cancel()}onComplete(){this.complete()}complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}k(Q9,"id","lasering");class Cv extends nt{static children(){return[Wle,Q9]}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}}k(Cv,"id","laser"),k(Cv,"initial","idle"),k(Cv,"isLockable",!1);class ez extends nt{constructor(){super(...arguments);k(this,"info",{});k(this,"initialSelectedShapeIds",[]);k(this,"excludedShapeIds",new Set);k(this,"isWrapMode",!1);k(this,"initialStartShape",null)}onEnter(t){const{altKey:n,currentPagePoint:s}=this.editor.inputs;if(this.isWrapMode=this.editor.user.getIsWrapMode(),n){this.parent.transition("scribble_brushing",t);return}this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(o=>this.editor.isShapeOfType(o,"group")||this.editor.isShapeOrAncestorLocked(o)).map(o=>o.id)),this.info=t,this.initialSelectedShapeIds=this.editor.getSelectedShapeIds().slice(),this.initialStartShape=this.editor.getShapesAtPoint(s)[0],this.hitTestShapes()}onExit(){this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})}onTick({elapsed:t}){const{editor:n}=this;n.edgeScrollManager.updateEdgeScrolling(t)}onPointerMove(){this.hitTestShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(t){this.editor.setSelectedShapes(this.initialSelectedShapeIds),this.parent.transition("idle",t)}onKeyDown(t){this.editor.inputs.altKey?this.parent.transition("scribble_brushing",t):this.hitTestShapes()}onKeyUp(){this.hitTestShapes()}complete(){this.hitTestShapes(),this.parent.transition("idle")}hitTestShapes(){const{editor:t,excludedShapeIds:n,isWrapMode:s}=this,{inputs:{originPagePoint:o,currentPagePoint:i,shiftKey:a,ctrlKey:l}}=t,c=new Set(a?this.initialSelectedShapeIds:[]),u=s?!l:l,p=Ve.FromPoints([o,i]),{corners:f}=p;let m,v,b,S,C,E;const T=t.getCurrentPageRenderingShapesSorted(),w=t.getCurrentPageId();e:for(let D=0,N=T.length;D<N;D++){if(b=T[D],n.has(b.id)||c.has(b.id)||(S=t.getShapePageBounds(b),!S))continue e;if(p.contains(S)){this.handleHit(b,i,w,c,f);continue e}if(u||t.isShapeOfType(b,"frame"))continue e;if(p.collides(S)){if(C=t.getShapePageTransform(b),!C)continue e;E=C.clone().invert().applyToPoints(f);const z=t.getShapeGeometry(b);t:for(let L=0;L<4;L++)if(m=E[L],v=E[(L+1)%4],z.hitTestLineSegment(m,v,0)){this.handleHit(b,i,w,c,f);break t}}}const M=t.getInstanceState().brush;(!M||!p.equals(M))&&t.updateInstanceState({brush:{...p.toJson()}});const R=t.getSelectedShapeIds();(R.length!==c.size||R.some(D=>!c.has(D)))&&t.setSelectedShapes(Array.from(c))}onInterrupt(){this.editor.updateInstanceState({brush:null})}handleHit(t,n,s,o,i){if(t.parentId===s){o.add(t.id);return}const a=this.editor.getOutermostSelectableShape(t),l=this.editor.getShapeMask(a.id);l&&!A2(l,i)&&!ai(n,l)||o.add(a.id)}}k(ez,"id","brushing");const qh={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class tz extends nt{constructor(){super(...arguments);k(this,"info",{})}updateCursor(){const t=this.editor.getSelectedShapes(),n=qh[this.info.handle];this.editor.setCursor({type:n,rotation:t.length===1?this.editor.getSelectionRotation():0})}onEnter(t){this.info=t,this.updateCursor()}onPointerMove(){this.editor.inputs.isDragging&&this.startResizing()}onLongPress(){this.startResizing()}startResizing(){this.editor.getIsReadonly()||this.parent.transition("resizing",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}k(tz,"id","pointing_resize_handle");const Ci=8;class UP extends nt{constructor(){super(...arguments);k(this,"info",{});k(this,"markId","");k(this,"snapshot",{})}onEnter(t){this.info=t,this.markId=this.editor.markHistoryStoppingPoint("cropping"),this.snapshot=this.createSnapshot(),this.updateShapes()}onPointerMove(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}updateCursor(){if(!this.editor.getSelectedShapes()[0])return;const n=qh[this.info.handle];this.editor.setCursor({type:n,rotation:this.editor.getSelectionRotation()})}getDefaultCrop(){return{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}}}updateShapes(){const{shape:t,cursorHandleOffset:n}=this.snapshot;if(!t||!this.editor.getShapeUtil("image"))return;const o=t.props,i=this.editor.inputs.currentPagePoint.clone().sub(n),a=this.editor.inputs.originPagePoint.clone().sub(n),l=i.clone().sub(a).rot(-t.rotation),c=o.crop??this.getDefaultCrop(),u=Kn(c),p=new P(t.x,t.y),f=new P(0,0),m=1/(c.bottomRight.x-c.topLeft.x)*o.w,v=1/(c.bottomRight.y-c.topLeft.y)*o.h;let b=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":{if(v<Ci)break;b=!0,u.topLeft.y=u.topLeft.y+l.y/v,v*(u.bottomRight.y-u.topLeft.y)<Ci?(u.topLeft.y=u.bottomRight.y-Ci/v,f.y=(u.topLeft.y-c.topLeft.y)*v):u.topLeft.y<=0?(u.topLeft.y=0,f.y=(u.topLeft.y-c.topLeft.y)*v):f.y=l.y;break}case"bottom":case"bottom_left":case"bottom_right":{if(v<Ci)break;b=!0,u.bottomRight.y=Math.min(1,u.bottomRight.y+l.y/v),v*(u.bottomRight.y-u.topLeft.y)<Ci&&(u.bottomRight.y=u.topLeft.y+Ci/v);break}}switch(this.info.handle){case"left":case"top_left":case"bottom_left":{if(m<Ci)break;b=!0,u.topLeft.x=u.topLeft.x+l.x/m,m*(u.bottomRight.x-u.topLeft.x)<Ci?(u.topLeft.x=u.bottomRight.x-Ci/m,f.x=(u.topLeft.x-c.topLeft.x)*m):u.topLeft.x<=0?(u.topLeft.x=0,f.x=(u.topLeft.x-c.topLeft.x)*m):f.x=l.x;break}case"right":case"top_right":case"bottom_right":{if(m<Ci)break;b=!0,u.bottomRight.x=Math.min(1,u.bottomRight.x+l.x/m),m*(u.bottomRight.x-u.topLeft.x)<Ci&&(u.bottomRight.x=u.topLeft.x+Ci/m);break}}if(!b)return;p.add(f.rot(t.rotation));const S={id:t.id,type:t.type,x:p.x,y:p.y,props:{crop:u,w:(u.bottomRight.x-u.topLeft.x)*m,h:(u.bottomRight.y-u.topLeft.y)*v}};this.editor.updateShapes([S]),this.updateCursor()}complete(){this.updateShapes(),zn(this.editor,[this.snapshot.shape.id]),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}createSnapshot(){const t=this.editor.getSelectionRotation(),{inputs:{originPagePoint:n}}=this.editor,s=this.editor.getOnlySelectedShape(),o=this.editor.getSelectionRotatedPageBounds(),i=P.RotWith(o.getHandlePoint(this.info.handle),o.point,t),a=P.Sub(n,i);return{shape:s,cursorHandleOffset:a}}}k(UP,"id","cropping");function nz(r,e=!1){const t=r.getZoomLevel(),{inputs:{currentPagePoint:n}}=r;return r.getShapeAtPoint(n,{hitInside:!1,hitLabels:e,margin:r.options.hitTestMargin/t,renderingOnly:!0})??r.getSelectedShapeAtPoint(n)}function rz(r,e,t){if(!e)throw Error("Needs to translate a cropped shape!");const{crop:n}=e.props;if(!n)return;const s=r.inputs.shiftKey?Math.abs(t.x)<Math.abs(t.y)?"x":"y":null;s==="x"?t.x=0:s==="y"&&(t.y=0),t.rot(-e.rotation);const o=1/(n.bottomRight.x-n.topLeft.x)*e.props.w,i=1/(n.bottomRight.y-n.topLeft.y)*e.props.h,a=n.bottomRight.y-n.topLeft.y,l=n.bottomRight.x-n.topLeft.x,c=Kn(n);return c.topLeft.x=Math.min(1-l,Math.max(0,c.topLeft.x-t.x/o)),c.topLeft.y=Math.min(1-a,Math.max(0,c.topLeft.y-t.y/i)),c.bottomRight.x=c.topLeft.x+l,c.bottomRight.y=c.topLeft.y+a,{id:e.id,type:e.type,props:{crop:c}}}var tE;let Kle=(tE=class extends nt{onEnter(){this.editor.setCursor({type:"default",rotation:0});const e=this.editor.getOnlySelectedShape();e&&this.editor.setCroppingShape(e.id)}onExit(){this.editor.setCursor({type:"default",rotation:0})}onCancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}onPointerDown(e){var t;if(e.accelKey){this.cancel(),this.editor.root.handleEvent(e);return}switch(e.target){case"canvas":{const n=nz(this.editor);if(n&&!this.editor.isShapeOfType(n,"group")){this.onPointerDown({...e,shape:n,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(e);break}case"shape":{if(e.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",e);return}else(t=this.editor.getShapeUtil(e.shape))!=null&&t.canCrop(e.shape)?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.editor.setCurrentTool("select.pointing_rotate_handle",{...e,onInteractionEnd:"select.crop.idle"});break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{this.editor.setCurrentTool("select.crop.pointing_crop_handle",{...e,onInteractionEnd:"select.crop.idle"});break}default:this.cancel()}break}}}onDoubleClick(e){var o;if(this.editor.inputs.shiftKey||e.phase!=="up")return;const t=this.editor.getCroppingShapeId();if(!t)return;const n=this.editor.getShape(t);if(!n)return;const s=this.editor.getShapeUtil(n);if(s){if(e.target==="selection"){(o=s.onDoubleClickEdge)==null||o.call(s,n);return}this.cancel(),this.editor.root.handleEvent(e)}}onKeyDown(){this.nudgeCroppingImage(!1)}onKeyRepeat(){this.nudgeCroppingImage(!0)}onKeyUp(e){switch(e.code){case"Enter":{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{});break}}}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(e=!1){const{editor:{inputs:{keys:t}}}=this,n=t.has("ShiftLeft"),s=new P(0,0);if(t.has("ArrowLeft")&&(s.x+=1),t.has("ArrowRight")&&(s.x-=1),t.has("ArrowUp")&&(s.y+=1),t.has("ArrowDown")&&(s.y-=1),s.equals(new P(0,0)))return;n&&s.mul(10);const o=this.editor.getShape(this.editor.getCroppingShapeId());if(!o)return;const i=rz(this.editor,o,s);i&&(e||this.editor.markHistoryStoppingPoint("translate crop"),this.editor.updateShapes([i]))}},k(tE,"id","idle"),tE);class sz extends nt{onCancel(){this.editor.setCurrentTool("select.crop.idle",{})}onPointerMove(e){this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",e)}onPointerUp(e){this.editor.setCurrentTool("select.crop.idle",e)}}k(sz,"id","pointing_crop");class HP extends nt{constructor(){super(...arguments);k(this,"info",{})}onEnter(t){this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd);const n=this.editor.getSelectedShapes()[0];if(!n)return;const s=qh[this.info.handle];this.editor.setCursor({type:s,rotation:this.editor.getSelectionRotation()}),this.editor.setCroppingShape(n.id)}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0)}onPointerMove(){this.editor.inputs.isDragging&&this.startCropping()}onLongPress(){this.startCropping()}startCropping(){this.editor.getIsReadonly()||this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})}onPointerUp(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}}k(HP,"id","pointing_crop_handle");class oz extends nt{constructor(){super(...arguments);k(this,"info",{});k(this,"markId","");k(this,"snapshot",{})}onEnter(t){this.info=t,this.snapshot=this.createSnapshot(),this.markId=this.editor.markHistoryStoppingPoint("translating_crop"),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()}onExit(){this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}onKeyDown(t){switch(t.key){case"Alt":case"Shift":{this.updateShapes();return}}}onKeyUp(t){switch(t.key){case"Enter":{this.complete();return}case"Alt":case"Shift":this.updateShapes()}}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){const t=this.snapshot.shape;if(!t)return;const{originPagePoint:n,currentPagePoint:s}=this.editor.inputs,o=s.clone().sub(n),i=rz(this.editor,t,o);i&&this.editor.updateShapes([i])}}k(oz,"id","translating_crop");class dk extends nt{constructor(){super(...arguments);k(this,"markId","");k(this,"didExit",!1)}static children(){return[Kle,oz,sz,HP,UP]}onEnter(){this.didExit=!1,this.markId=this.editor.markHistoryStoppingPoint("crop")}onExit(){this.didExit||(this.didExit=!0,this.editor.squashToMark(this.markId))}onCancel(){this.didExit||(this.didExit=!0,this.editor.bailToMark(this.markId))}}k(dk,"id","crop"),k(dk,"initial","idle");class iz extends nt{constructor(){super(...arguments);k(this,"shapeId","");k(this,"initialHandle",{});k(this,"initialAdjacentHandle",null);k(this,"initialPagePoint",{});k(this,"markId","");k(this,"initialPageTransform");k(this,"initialPageRotation");k(this,"info",{});k(this,"isPrecise",!1);k(this,"isPreciseId",null);k(this,"pointingId",null);k(this,"exactTimeout",-1)}onEnter(t){const{shape:n,isCreating:s,creatingMarkId:o,handle:i}=t;if(this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.shapeId=n.id,this.markId="",s)if(o)this.markId=o;else{const c=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);c&&(this.markId=c)}else this.markId=this.editor.markHistoryStoppingPoint("dragging handle");if(this.initialHandle=Kn(i),this.editor.isShapeOfType(n,"line")&&this.initialHandle.type==="create"){this.editor.updateShape({...n,props:{points:{...n.props.points,[i.index]:{id:i.index,index:i.index,x:i.x,y:i.y}}}});const u=this.editor.getShapeHandles(n).find(p=>p.index===i.index);this.initialHandle=Kn(u)}this.initialPageTransform=this.editor.getShapePageTransform(n),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.setCursor({type:s?"cross":"grabbing",rotation:0});const a=this.editor.getShapeHandles(n).sort(Hs),l=a.findIndex(c=>c.id===t.handle.id);this.initialAdjacentHandle=null;for(let c=l+1;c<a.length;c++){const u=a[c];if(u.type==="vertex"&&u.id!=="middle"&&u.id!==t.handle.id){this.initialAdjacentHandle=u;break}}if(!this.initialAdjacentHandle)for(let c=a.length-1;c>=0;c--){const u=a[c];if(u.type==="vertex"&&u.id!=="middle"&&u.id!==t.handle.id){this.initialAdjacentHandle=u;break}}if(this.editor.isShapeOfType(n,"arrow")){const c=Fo(this.editor,n)[t.handle.id];this.isPrecise=!1,c?(this.editor.setHintingShapes([c.toId]),this.isPrecise=c.props.isPrecise,this.isPrecise?this.isPreciseId=c.toId:this.resetExactTimeout()):this.editor.setHintingShapes([])}this.update(),this.editor.select(this.shapeId)}resetExactTimeout(){this.exactTimeout!==-1&&this.clearExactTimeout(),this.exactTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){this.exactTimeout!==-1&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.update(),this.complete()}onCancel(){this.cancel()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setHintingShapes([]),this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0})}complete(){this.editor.snaps.clearIndicators(),zn(this.editor,[this.shapeId]);const{onInteractionEnd:t}=this.info;if(this.editor.getInstanceState().isToolLocked&&t){this.editor.setCurrentTool(t,{shapeId:this.shapeId});return}this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();const{onInteractionEnd:t}=this.info;if(t){this.editor.setCurrentTool(t,{shapeId:this.shapeId});return}this.parent.transition("idle")}update(){var D;const{editor:t,shapeId:n,initialPagePoint:s}=this,{initialHandle:o,initialPageRotation:i,initialAdjacentHandle:a}=this,l=this.editor.getHintingShapeIds(),c=this.editor.user.getIsSnapMode(),{snaps:u,inputs:{currentPagePoint:p,shiftKey:f,ctrlKey:m,altKey:v,pointerVelocity:b}}=t,S=this.info.shape,C=t.getShape(n);if(!C)return;const E=t.getShapeUtil(C);let T=p.clone().sub(s).rot(-i).add(o);if(f&&a&&o.id!=="middle"){const N=P.Angle(a,T),L=Zv(N,24)-N;T=P.RotWith(T,a,L)}t.snaps.clearIndicators();let w={...o,x:T.x,y:T.y};if(o.canSnap&&(c?!m:m)){if(!t.getShapePageTransform(C.id))throw Error("Expected a page transform");const z=u.handles.snapHandle({currentShapeId:n,handle:w});z&&(z.nudge.rot(-t.getShapeParentTransform(C).rotation()),T.add(z.nudge),w={...o,x:T.x,y:T.y})}const M=(D=E.onHandleDrag)==null?void 0:D.call(E,C,{handle:w,isPrecise:this.isPrecise||v,initial:S}),R={id:C.id,type:C.type,...M};if(o.type==="vertex"&&this.editor.isShapeOfType(C,"arrow")){const N=Fo(t,C)[o.id];N?l[0]!==N.toId&&(t.setHintingShapes([N.toId]),this.pointingId=N.toId,this.isPrecise=b.len()<.5||v,this.isPreciseId=this.isPrecise?N.toId:null,this.resetExactTimeout()):l.length>0&&(t.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}M&&t.updateShapes([R])}}k(iz,"id","dragging_handle");function az(r){return r.isLabel?[r]:r instanceof Fi?r.children.filter(e=>e.isLabel):[]}class lz extends nt{constructor(){super(...arguments);k(this,"hitShapeForPointerUp",null);k(this,"info",{})}onEnter(t){const n=this.editor.getEditingShape();if(!n)throw Error("Entered editing state without an editing shape");this.hitShapeForPointerUp=null,this.info=t,t.isCreatingTextWhileToolLocked&&this.parent.setCurrentToolIdMask("text"),Bl(this.editor),this.editor.select(n)}onExit(){var o;const{editingShapeId:t}=this.editor.getCurrentPageState();if(!t)return;this.editor.setEditingShape(null),Bl.cancel();const n=this.editor.getShape(t),s=this.editor.getShapeUtil(n);(o=s.onEditEnd)==null||o.call(s,n),this.info.isCreatingTextWhileToolLocked&&(this.parent.setCurrentToolIdMask(void 0),this.editor.setCurrentTool("text",{}))}onPointerMove(t){if(this.hitShapeForPointerUp&&this.editor.inputs.isDragging){if(this.editor.getIsReadonly()||this.hitShapeForPointerUp.isLocked)return;this.editor.select(this.hitShapeForPointerUp),this.parent.transition("translating",t),this.hitShapeForPointerUp=null;return}switch(t.target){case"shape":case"canvas":{Bl(this.editor);return}}}onPointerDown(t){switch(this.hitShapeForPointerUp=null,t.target){case"shape":{const{shape:n}=t,s=this.editor.getEditingShape();if(!s)throw Error("Expected an editing shape!");const o=this.editor.getShapeUtil(n).getGeometry(n),i=az(o),a=i.length===1?i[0]:void 0,l=this.editor.isShapeOfType(s,"text")&&s.props.text.trim()==="";if(a&&!l){const c=this.editor.getPointInShapeSpace(n,this.editor.inputs.currentPagePoint);if(a.bounds.containsPoint(c,0)&&a.hitTestPoint(c)){if(n.id===s.id)return;this.hitShapeForPointerUp=n,this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(n.id);return}}else{if(n.id===s.id)this.editor.isShapeOfType(n,"frame")&&(this.editor.setEditingShape(null),this.parent.transition("idle",t));else{this.parent.transition("pointing_shape",t);return}return}break}}this.parent.transition("idle",t),this.editor.root.handleEvent(t)}onPointerUp(t){const n=this.hitShapeForPointerUp;if(!n)return;this.hitShapeForPointerUp=null;const s=this.editor.getShapeUtil(n);if(!n.isLocked){if(this.editor.getIsReadonly()&&!s.canEditInReadOnly(n)){this.parent.transition("pointing_shape",t);return}this.editor.select(n.id),this.editor.setEditingShape(n.id),Bl(this.editor)}}onComplete(t){this.parent.transition("idle",t)}onCancel(t){this.parent.transition("idle",t)}}k(lz,"id","editing_shape");function WD(r){const e=r.getOnlySelectedShape();return!!(e&&!r.isShapeOrAncestorLocked(e)&&r.getShapeUtil(e).canCrop(e))}function v0(r,e){const t=r.getSelectedShapeIds(),{currentPagePoint:n}=r.inputs,{shiftKey:s,altKey:o,accelKey:i}=e,a=s||i,l=r.getShapeAtPoint(n,{hitInside:!1,margin:r.options.hitTestMargin/r.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:c=>!c.isLocked});if(l){const c=r.getOutermostSelectableShape(l);if(a&&!o)r.cancelDoubleClick(),t.includes(c.id)?(r.markHistoryStoppingPoint("deselecting shape"),r.deselect(c)):(r.markHistoryStoppingPoint("shift selecting shape"),r.setSelectedShapes([...t,c.id]));else{let u;c===l||c.id===r.getFocusedGroupId()||t.includes(c.id)?u=l:u=c,u&&!t.includes(u.id)&&(r.markHistoryStoppingPoint("selecting shape"),r.select(u.id))}}else{if(a)return;{t.length>0&&(r.markHistoryStoppingPoint("selecting none"),r.selectNone());const c=r.getFocusedGroupId();if(Oo(c)){const u=r.getShape(c);r.isPointInShape(u,n,{margin:0,hitInside:!0})||r.setFocusedGroup(null)}}}}const Vle=["Delete","Backspace","[","]","Enter"," ","Shift","Tab"];var nE;let qle=(nE=class extends nt{onEnter(){this.parent.setCurrentToolIdMask(void 0),Bl(this.editor),this.editor.setCursor({type:"default",rotation:0})}onExit(){Bl.cancel()}onPointerMove(){Bl(this.editor)}onPointerDown(e){const t=e.ctrlKey&&WD(this.editor);switch(e.target){case"canvas":{const n=nz(this.editor);if(n&&!n.isLocked){this.onPointerDown({...e,shape:n,target:"shape"});return}const s=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:i}}=this.editor;if((s.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&KD(this.editor,i)){this.onPointerDown({...e,target:"selection"});return}this.parent.transition("pointing_canvas",e);break}case"shape":{const{shape:n}=e;if(this.isOverArrowLabelTest(n)){this.parent.transition("pointing_arrow_label",e);break}if(this.editor.isShapeOrAncestorLocked(n)){this.parent.transition("pointing_canvas",e);break}this.parent.transition("pointing_shape",e);break}case"handle":{if(this.editor.getIsReadonly())break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{if(e.accelKey){this.parent.transition("brushing",e);break}this.parent.transition("pointing_rotate_handle",e);break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{if(t)this.parent.transition("crop.pointing_crop_handle",e);else{if(e.accelKey){this.parent.transition("brushing",e);break}this.parent.transition("pointing_resize_handle",e)}break}default:{const n=this.editor.getHoveredShape();if(n&&!this.editor.getSelectedShapeIds().includes(n.id)&&!n.isLocked){this.onPointerDown({...e,shape:n,target:"shape"});return}this.parent.transition("pointing_selection",e)}}break}}}onDoubleClick(e){var t,n,s,o;if(!(this.editor.inputs.shiftKey||e.phase!=="up")&&!(e.ctrlKey||e.shiftKey))switch(e.target){case"canvas":{const i=this.editor.getHoveredShape(),a=i&&!this.editor.isShapeOfType(i,"group")?i:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1}),l=this.editor.getFocusedGroupId();if(a){if(this.editor.isShapeOfType(a,"group")){v0(this.editor,e);return}else{const c=this.editor.getShape(a.parentId);if(c&&this.editor.isShapeOfType(c,"group")&&!(l&&c.id===l)){v0(this.editor,e);return}}this.onDoubleClick({...e,shape:a,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.getIsReadonly())break;const i=this.editor.getOnlySelectedShape();if(i){const a=this.editor.getShapeUtil(i);if(!this.canInteractWithShapeInReadOnly(i))return;if(e.handle==="right"||e.handle==="left"||e.handle==="top"||e.handle==="bottom"){const l=(t=a.onDoubleClickEdge)==null?void 0:t.call(a,i);if(l){this.editor.markHistoryStoppingPoint("double click edge"),this.editor.updateShapes([l]),zn(this.editor,[i.id]);return}}if(a.canCrop(i)&&!this.editor.isShapeOrAncestorLocked(i)){this.parent.transition("crop",e);return}this.shouldStartEditingShape(i)&&this.startEditingShape(i,e,!0)}break}case"shape":{const{shape:i}=e,a=this.editor.getShapeUtil(i);if(i.type!=="video"&&i.type!=="embed"&&this.editor.getIsReadonly())break;if(a.onDoubleClick){const l=(n=a.onDoubleClick)==null?void 0:n.call(a,i);if(l){this.editor.updateShapes([l]);return}}if(a.canCrop(i)&&!this.editor.isShapeOrAncestorLocked(i)){this.editor.markHistoryStoppingPoint("select and crop"),this.editor.select((s=e.shape)==null?void 0:s.id),this.parent.transition("crop",e);return}this.shouldStartEditingShape(i)?this.startEditingShape(i,e,!0):this.handleDoubleClickOnCanvas(e);break}case"handle":{if(this.editor.getIsReadonly())break;const{shape:i,handle:a}=e,l=this.editor.getShapeUtil(i),c=(o=l.onDoubleClickHandle)==null?void 0:o.call(l,i,a);c?this.editor.updateShapes([c]):this.shouldStartEditingShape(i)&&this.startEditingShape(i,e,!0)}}}onRightClick(e){switch(e.target){case"canvas":{const t=this.editor.getHoveredShape(),n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitLocked:!0,hitFrameInside:!0,renderingOnly:!0});if(n){this.onRightClick({...e,shape:n,target:"shape"});return}const s=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:i}}=this.editor;if((s.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&KD(this.editor,i)){this.onRightClick({...e,target:"selection"});return}this.editor.selectNone();break}case"shape":{const{selectedShapeIds:t}=this.editor.getCurrentPageState(),{shape:n}=e,s=this.editor.getOutermostSelectableShape(n,o=>!t.includes(o.id));!t.includes(s.id)&&!this.editor.findShapeAncestor(s,o=>t.includes(o.id))&&(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([s.id]));break}}}onCancel(){this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.markHistoryStoppingPoint("clearing selection"),this.editor.selectNone())}onKeyDown(e){switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!1);return}}if(_r.editOnType.get()&&!Vle.includes(e.key)&&!e.altKey&&!e.ctrlKey){const t=this.editor.getOnlySelectedShape();if(t&&this.editor.isShapeOfType(t,"note")&&this.shouldStartEditingShape(t)){this.startEditingShape(t,{...e,target:"shape",shape:t},!0);return}}}onKeyRepeat(e){switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!0);break}}}onKeyUp(e){switch(e.code){case"Enter":{const t=this.editor.getSelectedShapes();if(t.every(s=>this.editor.isShapeOfType(s,"group"))){this.editor.setSelectedShapes(t.flatMap(s=>this.editor.getSortedChildIdsForParent(s.id)));return}const n=this.editor.getOnlySelectedShape();if(n&&this.shouldStartEditingShape(n)){this.startEditingShape(n,{...e,target:"shape",shape:n},!0);return}WD(this.editor)&&this.parent.transition("crop",e);break}}}shouldStartEditingShape(e=this.editor.getOnlySelectedShape()){return!e||this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||!this.canInteractWithShapeInReadOnly(e)?!1:this.editor.getShapeUtil(e).canEdit(e)}startEditingShape(e,t,n){this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||(this.editor.markHistoryStoppingPoint("editing shape"),l0(this.editor,e,n),this.parent.transition("editing_shape",t))}isOverArrowLabelTest(e){if(!e)return!1;const t=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint);if(this.editor.isShapeOfType(e,"arrow")){const n=this.editor.getShapeGeometry(e).children[1];if(n&&ai(t,n.vertices))return!0}return!1}handleDoubleClickOnCanvas(e){if(this.editor.getIsReadonly()||!this.editor.options.createTextOnCanvasDoubleClick)return;this.editor.markHistoryStoppingPoint("creating text shape");const t=vn(),{x:n,y:s}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:t,type:"text",x:n,y:s,props:{text:"",autoSize:!0}}]);const o=this.editor.getShape(t);if(!o)return;const i=this.editor.getShapeUtil(o);this.editor.getIsReadonly()&&!i.canEditInReadOnly(o)||(this.editor.setEditingShape(t),this.editor.select(t),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(e=!1){const{editor:{inputs:{keys:t}}}=this,n=t.has("ShiftLeft"),s=new P(0,0);if(t.has("ArrowLeft")&&(s.x-=1),t.has("ArrowRight")&&(s.x+=1),t.has("ArrowUp")&&(s.y-=1),t.has("ArrowDown")&&(s.y+=1),s.equals(new P(0,0)))return;e||this.editor.markHistoryStoppingPoint("nudge shapes");const{gridSize:o}=this.editor.getDocumentSettings(),i=this.editor.getInstanceState().isGridMode?n?o*Zle:o:n?Yle:Xle,a=this.editor.getSelectedShapeIds();this.editor.nudgeShapes(a,s.mul(i)),zn(this.editor,a)}canInteractWithShapeInReadOnly(e){return!!(!this.editor.getIsReadonly()||this.editor.getShapeUtil(e).canEditInReadOnly(e))}},k(nE,"id","idle"),nE);const Yle=10,Xle=1,Zle=5;function KD(r,e){const t=r.getSelectionRotatedPageBounds();if(!t)return!1;const n=r.getSelectionRotation();return n?ai(e,t.corners.map(s=>P.RotWith(s,t.point,n))):t.containsPoint(e)}class cz extends nt{constructor(){super(...arguments);k(this,"shapeId","");k(this,"markId","");k(this,"wasAlreadySelected",!1);k(this,"didDrag",!1);k(this,"didCtrlOnEnter",!1);k(this,"info",{});k(this,"_labelDragOffset",new P(0,0))}updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}onEnter(t){const{shape:n}=t;this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.info=t,this.shapeId=n.id,this.didDrag=!1,this.didCtrlOnEnter=t.accelKey,this.wasAlreadySelected=this.editor.getOnlySelectedShapeId()===n.id,this.updateCursor();const o=this.editor.getShapeGeometry(n).children[1];if(!o)throw Error(`Expected to find an arrow label geometry for shape: ${n.id}`);const{currentPagePoint:i}=this.editor.inputs,a=this.editor.getPointInShapeSpace(n,i);this._labelDragOffset=P.Sub(o.center,a),this.markId=this.editor.markHistoryStoppingPoint("label-drag start"),this.editor.setSelectedShapes([this.shapeId])}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){const{isDragging:t}=this.editor.inputs;if(!t)return;if(this.didCtrlOnEnter){this.parent.transition("brushing",this.info);return}const n=this.editor.getShape(this.shapeId);if(!n)return;const s=Qa(this.editor,n),o=this.editor.getShapeGeometry(n),i=o.children[0],a=this.editor.getPointInShapeSpace(n,this.editor.inputs.currentPagePoint),l=i.nearestPoint(P.Add(a,this._labelDragOffset));let c;if(s.isStraight){const u=P.Dist(s.start.point,s.end.point);c=1-P.Dist(s.end.point,l)/u}else{const{_center:u,measure:p,angleEnd:f,angleStart:m}=o.children[0];c=bE(p,m,f,u.angle(l))}isNaN(c)&&(c=.5),this.didDrag=!0,this.editor.updateShape({id:n.id,type:n.type,props:{labelPosition:c}})}onPointerUp(){const t=this.editor.getShape(this.shapeId);t&&(this.didDrag||!this.wasAlreadySelected?this.complete():this.editor.getIsReadonly()||(this.editor.setEditingShape(t.id),this.editor.setCurrentTool("select.editing_shape")))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}k(cz,"id","pointing_arrow_label");class dz extends nt{onEnter(e){e.shiftKey||e.accelKey||this.editor.getSelectedShapeIds().length>0&&(this.editor.markHistoryStoppingPoint("selecting none"),this.editor.selectNone())}onPointerMove(e){this.editor.inputs.isDragging&&this.parent.transition("brushing",e)}onPointerUp(e){v0(this.editor,e),this.complete()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle")}complete(){this.parent.transition("idle")}}k(dz,"id","pointing_canvas");class uz extends nt{constructor(){super(...arguments);k(this,"didCtrlOnEnter",!1);k(this,"info",{})}onEnter(t){this.info=t,this.didCtrlOnEnter=t.accelKey;const{shape:n}=t;if(this.editor.isShapeOfType(n,"arrow")){const s=Fo(this.editor,n)[t.handle.id];s&&this.editor.setHintingShapes([s.toId])}this.editor.setCursor({type:"grabbing",rotation:0})}onExit(){this.editor.setHintingShapes([]),this.editor.setCursor({type:"default",rotation:0})}onPointerUp(){const{shape:t,handle:n}=this.info;if(this.editor.isShapeOfType(t,"note")){const{editor:s}=this,o=VD(s,t,n,!1);if(o){l0(s,o,!0);return}}this.parent.transition("idle",this.info)}onPointerMove(t){const{editor:n}=this;n.inputs.isDragging&&(this.didCtrlOnEnter?this.parent.transition("brushing",t):this.startDraggingHandle())}onLongPress(){this.startDraggingHandle()}startDraggingHandle(){const{editor:t}=this;if(t.getIsReadonly())return;const{shape:n,handle:s}=this.info;if(t.isShapeOfType(n,"note")){const o=VD(t,n,s,!0);if(o){const i=t.getPointInParentSpace(o,t.inputs.originPagePoint).sub(P.Rot(Fb.clone().mul(n.props.scale),o.rotation));t.updateShape({...o,x:i.x,y:i.y}),t.setHoveredShape(o.id).select(o.id).setCurrentTool("select.translating",{...this.info,target:"shape",shape:t.getShape(o),onInteractionEnd:"note",isCreating:!0,onCreate:()=>{l0(t,o,!0)}});return}}this.parent.transition("dragging_handle",this.info)}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}k(uz,"id","pointing_handle");function VD(r,e,t,n){const s=r.getShapePageTransform(e.id),o=s.point(),i=s.rotation(),l=E9(r,o,i,e.props.growY,0,e.props.scale)[t.index];if(l)return P9(r,e,l,i,n)}class hz extends nt{constructor(){super(...arguments);k(this,"info",{})}updateCursor(){this.editor.setCursor({type:qh[this.info.handle],rotation:this.editor.getSelectionRotation()})}onEnter(t){this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.info=t,this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.editor.inputs.isDragging&&this.startRotating()}onLongPress(){this.startRotating()}startRotating(){this.editor.getIsReadonly()||this.parent.transition("rotating",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}k(hz,"id","pointing_rotate_handle");class pz extends nt{constructor(){super(...arguments);k(this,"info",{})}onEnter(t){this.info=t}onPointerUp(t){v0(this.editor,t),this.parent.transition("idle",t)}onPointerMove(t){this.editor.inputs.isDragging&&this.startTranslating(t)}onLongPress(t){this.startTranslating(t)}startTranslating(t){this.editor.getIsReadonly()||this.parent.transition("translating",t)}onDoubleClick(t){var o,i;const n=this.editor.getHoveredShape(),s=n&&!this.editor.isShapeOfType(n,"group")?n:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(s){this.parent.transition("idle"),(i=(o=this.parent).onDoubleClick)==null||i.call(o,{...t,target:"shape",shape:this.editor.getShape(s)});return}}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}k(pz,"id","pointing_selection");class fz extends nt{constructor(){super(...arguments);k(this,"hitShape",{});k(this,"hitShapeForPointerUp",{});k(this,"isDoubleClick",!1);k(this,"didCtrlOnEnter",!1);k(this,"didSelectOnEnter",!1)}onEnter(t){const n=this.editor.getSelectedShapeIds(),s=this.editor.getSelectionRotatedPageBounds(),o=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:i}}=this.editor,{shiftKey:a,altKey:l,accelKey:c}=t;this.hitShape=t.shape,this.isDoubleClick=!1,this.didCtrlOnEnter=c;const u=this.editor.getOutermostSelectableShape(t.shape),p=this.editor.findShapeAncestor(u,f=>n.includes(f.id));if(this.didCtrlOnEnter||this.editor.getShapeUtil(t.shape).onClick||u.id===o||n.includes(u.id)||p||n.length>1&&(s!=null&&s.containsPoint(i))){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=u;return}this.didSelectOnEnter=!0,a&&!l?(this.editor.cancelDoubleClick(),n.includes(u.id)||(this.editor.markHistoryStoppingPoint("shift selecting shape"),this.editor.setSelectedShapes([...n,u.id]))):(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([u.id]))}onPointerUp(t){var u;const n=this.editor.getSelectedShapeIds(),s=this.editor.getFocusedGroupId(),o=this.editor.getZoomLevel(),{inputs:{currentPagePoint:i}}=this.editor,a=t.shiftKey||t.accelKey,l=this.editor.getShapeAtPoint(i,{margin:this.editor.options.hitTestMargin/o,hitInside:!0,renderingOnly:!0})??this.hitShape,c=l?this.editor.getOutermostSelectableShape(l):this.hitShapeForPointerUp;if(c){const p=this.editor.getShapeUtil(c);if(p.onClick){const f=(u=p.onClick)==null?void 0:u.call(p,c);if(f){this.editor.markHistoryStoppingPoint("shape on click"),this.editor.updateShapes([f]),this.parent.transition("idle",t);return}}if(c.id===s){n.length>0?(this.editor.markHistoryStoppingPoint("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",t);return}}if(!this.didSelectOnEnter){const p=this.editor.getOutermostSelectableShape(l,f=>!n.includes(f.id));if(n.includes(p.id))if(a)this.editor.markHistoryStoppingPoint("deselecting on pointer up"),this.editor.deselect(c);else if(n.includes(c.id)){if(n.length===1){const f=this.editor.getShapeUtil(c).getGeometry(c),m=az(f),v=m.length===1?m[0]:void 0;if(v){const b=this.editor.getPointInShapeSpace(c,i);if(v.bounds.containsPoint(b,0)&&v.hitTestPoint(b)){this.editor.run(()=>{this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(c.id);const S=this.editor.getShapeUtil(c);this.editor.getIsReadonly()&&!S.canEditInReadOnly(c)||(this.editor.setEditingShape(c.id),this.editor.setCurrentTool("select.editing_shape"),this.isDoubleClick&&this.editor.emit("select-all-text",{shapeId:c.id}))});return}}}this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(c.id)}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(c);else if(a){const f=this.editor.getShapeAncestors(p);this.editor.markHistoryStoppingPoint("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(m=>!f.find(v=>v.id===m)),p.id])}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.setSelectedShapes([p.id])}this.parent.transition("idle",t)}onDoubleClick(){this.isDoubleClick=!0}onPointerMove(t){this.editor.inputs.isDragging&&(this.didCtrlOnEnter?this.parent.transition("brushing",t):this.startTranslating(t))}onLongPress(t){this.startTranslating(t)}startTranslating(t){this.editor.getIsReadonly()||(this.editor.focus(),this.parent.transition("translating",t))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}k(fz,"id","pointing_shape");class gz extends nt{constructor(){super(...arguments);k(this,"info",{});k(this,"markId","");k(this,"didHoldCommand",!1);k(this,"creationCursorOffset",{x:0,y:0});k(this,"snapshot",{})}onEnter(t){const{isCreating:n=!1,creatingMarkId:s,creationCursorOffset:o={x:0,y:0}}=t;if(this.info=t,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.creationCursorOffset=o,this.snapshot=this._createSnapshot(),this.markId="",n)if(s)this.markId=s;else{const i=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);i&&(this.markId=i)}else this.markId=this.editor.markHistoryStoppingPoint("starting resizing");n&&this.editor.setCursor({type:"cross",rotation:0}),this.handleResizeStart(),this.updateShapes()}onTick({elapsed:t}){const{editor:n}=this;n.edgeScrollManager.updateEdgeScrolling(t)}onPointerMove(){this.updateShapes()}onKeyDown(){this.updateShapes()}onKeyUp(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){var t,n;if(zn(this.editor,this.snapshot.selectedShapeIds),this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){(n=(t=this.info).onCreate)==null||n.call(t,this.editor.getOnlySelectedShape());return}if(this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle")}handleResizeStart(){const{shapeSnapshots:t}=this.snapshot,n=[];t.forEach(({shape:s})=>{var a;const o=this.editor.getShapeUtil(s),i=(a=o.onResizeStart)==null?void 0:a.call(o,s);i&&n.push(i)}),n.length>0&&this.editor.updateShapes(n)}handleResizeEnd(){const{shapeSnapshots:t}=this.snapshot,n=[];t.forEach(({shape:s})=>{var l;const o=this.editor.getShape(s.id),i=this.editor.getShapeUtil(s),a=(l=i.onResizeEnd)==null?void 0:l.call(i,s,o);a&&n.push(a)}),n.length>0&&this.editor.updateShapes(n)}updateShapes(){const{altKey:t,shiftKey:n}=this.editor.inputs,{frames:s,shapeSnapshots:o,selectionBounds:i,cursorHandleOffset:a,selectedShapeIds:l,selectionRotation:c,canShapesDeform:u}=this.snapshot;let p=n||!u;if(o.size===1){const N=[...o.values()][0];this.editor.isShapeOfType(N.shape,"text")&&(p=!(this.info.handle==="left"||this.info.handle==="right"))}const{ctrlKey:f}=this.editor.inputs,m=this.editor.inputs.currentPagePoint.clone().sub(a).sub(this.creationCursorOffset),v=this.editor.inputs.originPagePoint.clone().sub(a);if(this.editor.getInstanceState().isGridMode&&!f){const{gridSize:N}=this.editor.getDocumentSettings();m.snapToGrid(N)}const b=this.info.handle,S=qD(b,Math.PI);if(this.editor.snaps.clearIndicators(),(this.editor.user.getIsSnapMode()?!f:f)&&c%Bn===0){const{nudge:N}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:P.Sub(m,v),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:qD(b,c),isAspectRatioLocked:p,isResizingFromCenter:t});m.add(N)}const E=P.RotWith(t?i.center:i.getHandlePoint(S),i.point,c),T=P.Sub(m,E).rot(-c),w=P.Sub(v,E).rot(-c),M=P.DivV(T,w);Number.isFinite(M.x)||(M.x=1),Number.isFinite(M.y)||(M.y=1);const R=b==="top"||b==="bottom",D=b==="left"||b==="right";p?D?M.y=Math.abs(M.x):R?M.x=Math.abs(M.y):Math.abs(M.x)>Math.abs(M.y)?M.y=Math.abs(M.x)*(M.y<0?-1:1):M.x=Math.abs(M.y)*(M.x<0?-1:1):(R&&(M.x=1),D&&(M.y=1)),this.info.isCreating||this.updateCursor({dragHandle:b,isFlippedX:M.x<0,isFlippedY:M.y<0,rotation:c});for(const N of o.keys()){const z=o.get(N);this.editor.resizeShape(N,M,{initialShape:z.shape,initialBounds:z.bounds,initialPageTransform:z.pageTransform,dragHandle:b,mode:l.length===1&&N===l[0]?"resize_bounds":"scale_shape",scaleOrigin:E,isAspectRatioLocked:p,scaleAxisRotation:c,skipStartAndEndCallbacks:!0})}if(this.editor.inputs.ctrlKey){this.didHoldCommand=!0;for(const{id:N,children:z}of s){if(!z.length)continue;const L=o.get(N).shape,B=this.editor.getShape(N);if(!(L&&B))continue;const K=B.x-L.x,O=B.y-L.y,U=new P(K,O).rot(-L.rotation);if(U.x!==0||U.y!==0)for(const X of z)this.editor.updateShape({id:X.id,type:X.type,x:X.x-U.x,y:X.y-U.y})}}else if(this.didHoldCommand){this.didHoldCommand=!1;for(const{children:N}of s)if(N.length)for(const z of N)this.editor.updateShape({id:z.id,type:z.type,x:z.x,y:z.y})}}updateCursor({dragHandle:t,isFlippedX:n,isFlippedY:s,rotation:o}){const i={...this.editor.getInstanceState().cursor};switch(t){case"top_left":case"bottom_right":{i.type="nwse-resize",n!==s&&(i.type="nesw-resize");break}case"top_right":case"bottom_left":{i.type="nesw-resize",n!==s&&(i.type="nwse-resize");break}}i.rotation=o,this.editor.setCursor(i)}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0}),this.editor.snaps.clearIndicators()}_createSnapshot(){const t=this.editor.getSelectedShapeIds(),n=this.editor.getSelectionRotation(),{inputs:{originPagePoint:s}}=this.editor,o=this.editor.getSelectionRotatedPageBounds(),i=P.RotWith(o.getHandlePoint(this.info.handle),o.point,n),a=P.Sub(s,i),l=new Map,c=[];t.forEach(p=>{const f=this.editor.getShape(p);if(f){if(f.type==="frame"&&c.push({id:p,children:kt(this.editor.getSortedChildIdsForParent(f).map(m=>this.editor.getShape(m)))}),l.set(f.id,this._createShapeSnapshot(f)),this.editor.isShapeOfType(f,"frame")&&t.length===1)return;this.editor.visitDescendants(f.id,m=>{const v=this.editor.getShape(m);if(v&&(l.set(v.id,this._createShapeSnapshot(v)),this.editor.isShapeOfType(v,"frame")))return!1})}});const u=![...l.values()].some(p=>!D5(p.pageRotation,n)||p.isAspectRatioLocked);return{shapeSnapshots:l,selectionBounds:o,cursorHandleOffset:a,selectionRotation:n,selectedShapeIds:t,canShapesDeform:u,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:c}}_createShapeSnapshot(t){const n=this.editor.getShapePageTransform(t),s=this.editor.getShapeUtil(t);return{shape:t,bounds:this.editor.getShapeGeometry(t).bounds,pageTransform:n,pageRotation:Ne.Decompose(n).rotation,isAspectRatioLocked:s.isAspectRatioLocked(t)}}}k(gz,"id","resizing");const _C=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function qD(r,e){e=e%xn;const t=Math.round(e/(cn/4)),n=_C.indexOf(r);return _C[(n+t)%_C.length]}const YD=Math.PI/180;class mz extends nt{constructor(){super(...arguments);k(this,"snapshot",{});k(this,"info",{});k(this,"markId","")}onEnter(t){this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.markId=this.editor.markHistoryStoppingPoint("rotate start");const n=UL({editor:this.editor,ids:this.editor.getSelectedShapeIds()});if(!n)return this.parent.transition("idle",this.info);this.snapshot=n;const s=this._getRotationFromPointerPosition({snapToNearestDegree:!1});Qy({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.setCursor({type:qh[this.info.handle],rotation:s+this.snapshot.initialShapesRotation})}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}update(){const t=this._getRotationFromPointerPosition({snapToNearestDegree:!1});Qy({editor:this.editor,delta:t,snapshot:this.snapshot,stage:"update"}),this.editor.setCursor({type:qh[this.info.handle],rotation:t+this.snapshot.initialShapesRotation})}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}complete(){Qy({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),zn(this.editor,this.snapshot.shapeSnapshots.map(t=>t.shape.id)),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}_getRotationFromPointerPosition({snapToNearestDegree:t}){const n=this.editor.getSelectionRotation(),s=this.editor.getSelectionRotatedPageBounds(),{inputs:{shiftKey:o,currentPagePoint:i}}=this.editor,{initialCursorAngle:a,initialShapesRotation:l}=this.snapshot;if(!s)return l;const u=s.center.clone().rotWith(s.point,n).angle(i)-a;let p=l+u;if(o)p=Zv(p,24);else if(t&&(p=Math.round(p/YD)*YD,this.editor.getInstanceState().isCoarsePointer)){const f=Zv(p,4),m=Xy(p,f);Math.abs(m)<wV(5)&&(p=f)}return p-l}}k(mz,"id","rotating");class yz extends nt{constructor(){super(...arguments);k(this,"hits",new Set);k(this,"size",0);k(this,"scribbleId","id");k(this,"initialSelectedShapeIds",new Set);k(this,"newlySelectedShapeIds",new Set)}onEnter(){this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const t=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=t.id,this.updateScribbleSelection(!0),this.editor.updateInstanceState({brush:null})}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.updateScribbleSelection(!0)}onPointerUp(){this.complete()}onKeyDown(){this.updateScribbleSelection(!1)}onKeyUp(){this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")}onCancel(){this.cancel()}onComplete(){this.complete()}pushPointToScribble(){const{x:t,y:n}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,n)}updateScribbleSelection(t){const{editor:n}=this,s=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{shiftKey:o,originPagePoint:i,previousPagePoint:a,currentPagePoint:l}}=this.editor,{newlySelectedShapeIds:c,initialSelectedShapeIds:u}=this;t&&this.pushPointToScribble();const p=s;let f,m,v,b;const S=0;for(let T=0,w=p.length;T<w;T++){if(f=p[T],n.isShapeOfType(f,"group")||c.has(f.id)||n.isShapeOrAncestorLocked(f)||(m=n.getShapeGeometry(f),n.isShapeOfType(f,"frame")&&m.bounds.containsPoint(n.getPointInShapeSpace(f,i))))continue;const M=n.getShapePageTransform(f);if(!m||!M)continue;const R=M.clone().invert();v=R.applyToPoint(a),b=R.applyToPoint(l);const{bounds:D}=m;if(!(D.minX-S>Math.max(v.x,b.x)||D.minY-S>Math.max(v.y,b.y)||D.maxX+S<Math.min(v.x,b.x)||D.maxY+S<Math.min(v.y,b.y))&&m.hitTestLineSegment(v,b,S)){const N=this.editor.getOutermostSelectableShape(f),z=this.editor.getShapeMask(N.id);if(z&&T2(a,l,z)!==null&&!ai(l,z))continue;c.add(N.id)}}const C=n.getSelectedShapeIds(),E=new Set(o?[...c,...u]:[...c]);(C.length!==E.size||C.some(T=>!E.has(T)))&&this.editor.setSelectedShapes(Array.from(E))}complete(){this.updateScribbleSelection(!0),this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds]),this.parent.transition("idle")}}k(yz,"id","scribble_brushing");var Jle=Object.create,vz=Object.defineProperty,Qle=Object.getOwnPropertyDescriptor,ece=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),bz=r=>{throw TypeError(r)},Sz=(r,e,t)=>e in r?vz(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,tce=r=>[,,,Jle(null)],xz=["class","method","getter","setter","accessor","field","value","get","set"],wz=r=>r!==void 0&&typeof r!="function"?bz("Function expected"):r,nce=(r,e,t,n,s)=>({kind:xz[r],name:e,metadata:n,addInitializer:o=>t._?bz("Already initialized"):s.push(wz(o||null))}),rce=(r,e)=>Sz(e,ece("metadata"),r[3]),sce=(r,e,t,n)=>{for(var s=0,o=r[e>>1],i=o&&o.length;s<i;s++)o[s].call(t);return n},oce=(r,e,t,n,s,o)=>{for(var i,a,l,c,u=e&7,p=!!(e&8),f=!!(e&16),m=2,v=xz[u+5],b=r[m]||(r[m]=[]),S=(s=s.prototype,Qle(s,t)),C=n.length-1;C>=0;C--)l=nce(u,t,a={},r[3],b),l.static=p,l.private=f,c=l.access={has:E=>t in E},c.get=E=>E[t],i=(0,n[C])(S[v],l),a._=1,wz(i)&&(S[v]=i);return S&&vz(s,t,S),s},TC=(r,e,t)=>Sz(r,typeof e!="symbol"?e+"":e,t),Cz,Hb;const ice=20,ace=100;Cz=[Bo];class GP{constructor(e){this.editor=e,sce(Hb,5,this),TC(this,"prevDroppingShapeId",null),TC(this,"droppingNodeTimer",null),TC(this,"first",!0),e.disposables.add(this.dispose)}updateDroppingNode(e,t){var n;this.first&&(this.editor.setHintingShapes(e.map(s=>this.editor.findShapeAncestor(s,o=>o.type!=="group")).filter(s=>s)),this.prevDroppingShapeId=((n=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,e))==null?void 0:n.id)??null,this.first=!1),this.droppingNodeTimer===null?this.setDragTimer(e,ice,t):this.editor.inputs.pointerVelocity.len()>.5&&(clearTimeout(this.droppingNodeTimer),this.setDragTimer(e,ace,t))}setDragTimer(e,t,n){this.droppingNodeTimer=this.editor.timers.setTimeout(()=>{this.editor.run(()=>{this.handleDrag(this.editor.inputs.currentPagePoint,e,n)}),this.droppingNodeTimer=null},t)}handleDrag(e,t,n){var l,c,u,p,f;t=kt(t.map(m=>this.editor.getShape(m.id)));const s=((l=this.editor.getDroppingOverShape(e,t))==null?void 0:l.id)??null;if(s===this.prevDroppingShapeId){this.hintParents(t);return}const{prevDroppingShapeId:o}=this,i=o&&this.editor.getShape(o),a=s&&this.editor.getShape(s);i&&((u=(c=this.editor.getShapeUtil(i)).onDragShapesOut)==null||u.call(c,i,t)),a&&((f=(p=this.editor.getShapeUtil(a)).onDragShapesOver)==null||f.call(p,a,t)),this.hintParents(t),n==null||n(),this.prevDroppingShapeId=s}hintParents(e){const t=new Map;for(const s of e){const o=this.editor.findShapeAncestor(s,i=>i.type!=="group");o&&(t.has(o.id)||t.set(o.id,[]),t.get(o.id).push(s.id))}const n=[];for(const[s,o]of t){const i=this.editor.getShape(s);i&&xF(this.editor,i).length<o.length&&n.push(i.id)}this.editor.setHintingShapes(n)}dropShapes(e){var n,s;const{prevDroppingShapeId:t}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,e),t){const o=this.editor.getShape(t);if(!o)return;(s=(n=this.editor.getShapeUtil(o)).onDropShapesOver)==null||s.call(n,o,e)}}clear(){this.prevDroppingShapeId=null,this.droppingNodeTimer!==null&&clearTimeout(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}dispose(){this.clear()}}Hb=tce();oce(Hb,1,"dispose",Cz,GP);rce(Hb,GP);var lce=Object.create,Ez=Object.defineProperty,cce=Object.getOwnPropertyDescriptor,kz=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),Pz=r=>{throw TypeError(r)},Iz=(r,e,t)=>e in r?Ez(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,dce=r=>[,,,lce((r==null?void 0:r[kz("metadata")])??null)],_z=["class","method","getter","setter","accessor","field","value","get","set"],Tz=r=>r!==void 0&&typeof r!="function"?Pz("Function expected"):r,uce=(r,e,t,n,s)=>({kind:_z[r],name:e,metadata:n,addInitializer:o=>t._?Pz("Already initialized"):s.push(Tz(o||null))}),hce=(r,e)=>Iz(e,kz("metadata"),r[3]),pce=(r,e,t,n)=>{for(var s=0,o=r[e>>1],i=o&&o.length;s<i;s++)o[s].call(t);return n},fce=(r,e,t,n,s,o)=>{for(var i,a,l,c,u=e&7,p=!!(e&8),f=!!(e&16),m=2,v=_z[u+5],b=r[m]||(r[m]=[]),S=(s=s.prototype,cce(s,t)),C=n.length-1;C>=0;C--)l=uce(u,t,a={},r[3],b),l.static=p,l.private=f,c=l.access={has:E=>t in E},c.get=E=>E[t],i=(0,n[C])(S[v],l),a._=1,Tz(i)&&(S[v]=i);return S&&Ez(s,t,S),s},Nc=(r,e,t)=>Iz(r,typeof e!="symbol"?e+"":e,t),Mz,uk,Gb;class Wb extends(uk=nt,Mz=[Bo],uk){constructor(){super(...arguments),pce(Gb,5,this),Nc(this,"info",{}),Nc(this,"selectionSnapshot",{}),Nc(this,"snapshot",{}),Nc(this,"markId",""),Nc(this,"isCloning",!1),Nc(this,"isCreating",!1),Nc(this,"dragAndDropManager",new GP(this.editor))}onCreate(e){}onEnter(e){var o;const{isCreating:t=!1,creatingMarkId:n,onCreate:s=()=>{}}=e;if(!((o=this.editor.getSelectedShapeIds())!=null&&o.length)){this.parent.transition("idle");return}if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.isCreating=t,this.markId="",t)if(n)this.markId=n;else{const i=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);i&&(this.markId=i)}else this.markId=this.editor.markHistoryStoppingPoint("translating");if(this.onCreate=s,this.isCloning=!1,this.info=e,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=XD(this.editor),!this.isCreating&&this.editor.inputs.altKey){this.startCloning();return}this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0}),this.dragAndDropManager.clear()}onTick({elapsed:e}){const{editor:t}=this;this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),t.edgeScrollManager.updateEdgeScrolling(e)}onPointerMove(){this.updateShapes()}onKeyDown(){if(this.editor.inputs.altKey&&!this.isCloning){this.startCloning();return}this.updateShapes()}onKeyUp(){if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate cloning"),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=XD(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate"),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){var e;this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),zn(this.editor,this.snapshot.movingShapes.map(t=>t.id)),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?(e=this.onCreate)==null||e.call(this,this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){const{movingShapes:e}=this.snapshot,t=[];e.forEach(n=>{var i;const s=this.editor.getShapeUtil(n),o=(i=s.onTranslateStart)==null?void 0:i.call(s,n);o&&t.push(o)}),t.length>0&&this.editor.updateShapes(t),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes:e}=this.snapshot;if(this.isCloning&&e.length>0){const n=P.Average(e.map(o=>this.editor.getShapePageTransform(o.id).point())),s=P.Sub(n,this.selectionSnapshot.averagePagePoint);P.IsNaN(s)||this.editor.updateInstanceState({duplicateProps:{shapeIds:e.map(o=>o.id),offset:{x:s.x,y:s.y}}})}const t=[];e.forEach(n=>{var a;const s=this.editor.getShape(n.id),o=this.editor.getShapeUtil(n),i=(a=o.onTranslateEnd)==null?void 0:a.call(o,n,s);i&&t.push(i)}),t.length>0&&this.editor.updateShapes(t)}updateShapes(){const{snapshot:e}=this;this.dragAndDropManager.updateDroppingNode(e.movingShapes,this.updateParentTransforms),gce({editor:this.editor,snapshot:e});const{movingShapes:t}=e,n=[];t.forEach(s=>{var l;const o=this.editor.getShape(s.id),i=this.editor.getShapeUtil(s),a=(l=i.onTranslate)==null?void 0:l.call(i,s,o);a&&n.push(a)}),n.length>0&&this.editor.updateShapes(n)}updateParentTransforms(){const{editor:e,snapshot:{shapeSnapshots:t}}=this;t.forEach(n=>{const s=e.getShape(n.shape.id);if(!s)return null;const o=Po(s.parentId)?null:Ne.Inverse(e.getShapePageTransform(s.parentId));n.parentTransform=o})}}Gb=dce(uk);fce(Gb,1,"updateParentTransforms",Mz,Wb);hce(Gb,Wb);Nc(Wb,"id","translating");function XD(r){var p;const e=[],t=[],n=r.getSelectedShapeIds(),s=kt(n.map(f=>{const m=r.getShape(f);if(!m)return null;e.push(m);const v=r.getShapePageTransform(f),b=v.point(),S=v.rotation();t.push(b);const C=ui.isId(m.parentId)?null:Ne.Inverse(r.getShapePageTransform(m.parentId));return{shape:m,pagePoint:b,pageRotation:S,parentTransform:C}})),o=r.getOnlySelectedShape();let i=[];if(o)i=r.snaps.shapeBounds.getSnapPoints(o.id);else{const f=r.getSelectionPageBounds();f&&(i=f.cornersAndCenter.map((m,v)=>({id:"selection:"+v,x:m.x,y:m.y})))}let a,l;const{originPagePoint:c}=r.inputs,u=s.filter(f=>r.isShapeOfType(f.shape,"note")&&r.isPointInShape(f.shape,c));if(u.length!==0)if(u.length===1)l=u[0];else{const f=r.getCurrentPageShapesSorted();l=(p=u.map(m=>({snapshot:m,index:f.findIndex(v=>v.id===m.shape.id)})).sort((m,v)=>v.index-m.index)[0])==null?void 0:p.snapshot}return l&&(a=k9(r,l.pageRotation,l.shape.props.scale,l.shape.props.growY??0)),{averagePagePoint:P.Average(t),movingShapes:e,shapeSnapshots:s,initialPageBounds:r.getSelectionPageBounds(),initialSnapPoints:i,noteAdjacentPositions:a,noteSnapshot:l}}function gce({editor:r,snapshot:e}){const{inputs:t}=r,{noteSnapshot:n,noteAdjacentPositions:s,initialPageBounds:o,initialSnapPoints:i,shapeSnapshots:a,averagePagePoint:l}=e,c=r.getInstanceState().isGridMode,u=r.getDocumentSettings().gridSize,p=P.Sub(t.currentPagePoint,t.originPagePoint),f=r.inputs.shiftKey?Math.abs(p.x)<Math.abs(p.y)?"x":"y":null;f==="x"?p.x=0:f==="y"&&(p.y=0),r.snaps.clearIndicators();const m=r.user.getIsSnapMode()?!t.ctrlKey:t.ctrlKey;let v=!1;if(m&&r.inputs.pointerVelocity.len()<.5){const{nudge:E}=r.snaps.shapeBounds.snapTranslateShapes({dragDelta:p,initialSelectionPageBounds:o,lockedAxis:f,initialSelectionSnapPoints:i});p.add(E)}else if(n&&s){const{scale:E}=n.shape.props,T=n.pagePoint.clone().add(p).add(Fb.clone().mul(E).rot(n.pageRotation));let w=C9/r.getZoomLevel(),M=new P(0,0);for(const R of s){const D=P.Sub(T,R),N=D.len();N<w&&(v=!0,w=N,M=D)}p.sub(M)}const b=P.Add(l,p),S=r.snaps.getIndicators();c&&!t.ctrlKey&&!v&&S.length===0&&b.snapToGrid(u);const C=P.Sub(b,l);r.updateShapes(kt(a.map(({shape:E,pagePoint:T,parentTransform:w})=>{const M=P.Add(T,C),R=w?Ne.applyToPoint(w,M):M;return{id:E.id,type:E.type,x:R.x,y:R.y}})))}class Ev extends nt{constructor(){super(...arguments);k(this,"reactor")}static children(){return[dk,UP,qle,dz,fz,Wb,ez,yz,HP,pz,tz,lz,gz,mz,hz,cz,uz,iz]}cleanUpDuplicateProps(){const t=this.editor.getSelectedShapeIds(),n=this.editor.getInstanceState();if(!n.duplicateProps)return;const s=new Set(n.duplicateProps.shapeIds);t.length===s.size&&t.every(o=>s.has(o))||this.editor.updateInstanceState({duplicateProps:null})}onEnter(){this.reactor=nl("clean duplicate props",()=>{try{this.cleanUpDuplicateProps()}catch(t){typeof process<"u",console.error(t)}})}onExit(){var t;(t=this.reactor)==null||t.call(this),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)}}k(Ev,"id","select"),k(Ev,"initial","idle"),k(Ev,"isLockable",!1);class Az extends nt{constructor(){super(...arguments);k(this,"info",{})}onEnter(t){this.info=t}onPointerDown(){this.parent.transition("pointing",this.info)}}k(Az,"id","idle");class jz extends nt{constructor(){super(...arguments);k(this,"info",{})}onEnter(t){this.info=t}onPointerUp(){this.complete()}onPointerMove(){this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)}onCancel(){this.cancel()}complete(){const{currentScreenPoint:t}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(t,{animation:{duration:220}}):this.editor.zoomIn(t,{animation:{duration:220}}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}k(jz,"id","pointing");class Rz extends nt{constructor(){super(...arguments);k(this,"info",{});k(this,"zoomBrush",new Ve)}onEnter(t){this.info=t,this.update()}onExit(){this.editor.updateInstanceState({zoomBrush:null})}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}update(){const{inputs:{originPagePoint:t,currentPagePoint:n}}=this.editor;this.zoomBrush.setTo(Ve.FromPoints([t,n])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:t}=this,n=8/this.editor.getZoomLevel();if(t.width<n&&t.height<n){const s=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(s,{animation:{duration:220}}):this.editor.zoomIn(s,{animation:{duration:220}})}else{const s=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(t,{targetZoom:s,animation:{duration:220}})}this.parent.transition("idle",this.info)}}k(Rz,"id","zoom_brushing");class kv extends nt{constructor(){super(...arguments);k(this,"info",{})}static children(){return[Az,Rz,jz]}onEnter(t){this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}}),this.parent.setCurrentToolIdMask(void 0)}onKeyDown(){this.updateCursor()}onKeyUp(t){this.updateCursor(),t.code==="KeyZ"&&this.complete()}onInterrupt(){this.complete()}complete(){this.info.onInteractionEnd&&this.info.onInteractionEnd!=="select"?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.setCursor({type:"zoom-out",rotation:0}):this.editor.setCursor({type:"zoom-in",rotation:0})}}k(kv,"id","zoom"),k(kv,"initial","idle"),k(kv,"isLockable",!1);const mce=[xv,wv,Cv,kv,Ev];function yce(){const r=ue(),e=ye("follow",()=>r.getInstanceState().followingUserId,[r]);return e?g.jsx(vce,{userId:e}):null}function vce({userId:r}){const e=eb(r);return e?g.jsx("div",{className:"tlui-following-indicator",style:{borderColor:e.color}}):null}let hk={fonts:{draw:`${Yc()}/fonts/Shantell_Sans-Tldrawish.woff2`,serif:`${Yc()}/fonts/IBMPlexSerif-Medium.woff2`,sansSerif:`${Yc()}/fonts/IBMPlexSans-Medium.woff2`,monospace:`${Yc()}/fonts/IBMPlexMono-Medium.woff2`}};function Dz(r){return I.useMemo(()=>r?{fonts:{...hk.fonts,...r==null?void 0:r.fonts}}:hk,[r])}const bce=["align-bottom","align-center-horizontal","align-center-vertical","align-left","align-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","blob","bring-forward","bring-to-front","broken","check-circle","check","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","color","cross-2","cross-circle","dash-dashed","dash-dotted","dash-draw","dash-solid","disconnected","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","fill-fill","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-heart","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","horizontal-align-end","horizontal-align-middle","horizontal-align-start","info-circle","leading","link","lock","menu","minus","mixed","pack","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","send-backward","send-to-back","share-1","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","stretch-horizontal","stretch-vertical","text-align-center","text-align-left","text-align-right","toggle-off","toggle-on","tool-arrow","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-screenshot","tool-text","trash","twitter","undo","ungroup","unlock","vertical-align-end","vertical-align-middle","vertical-align-start","warning-triangle","zoom-in","zoom-out"];let of={...hk,icons:Object.fromEntries(bce.map(r=>[r,`${Yc()}/icons/icon/0_merged.svg#${r}`])),translations:Object.fromEntries(Uf.map(r=>[r.locale,`${Yc()}/translations/${r.locale}.json`])),embedIcons:Object.fromEntries(EP.map(r=>[r.type,`${Yc()}/embed-icons/${r.type}.png`]))};function Sce(r){return r?{fonts:Object.assign({...of.fonts},{...r==null?void 0:r.fonts}),icons:Object.assign({...of.icons},{...r==null?void 0:r.icons}),embedIcons:Object.assign({...of.embedIcons},{...r==null?void 0:r.embedIcons}),translations:Object.assign({...of.translations},{...r==null?void 0:r.translations})}:of}var WP="Popover",[Oz,rme]=ku(WP,[wb]),nm=wb(),[xce,bd]=Oz(WP),Lz=r=>{const{__scopePopover:e,children:t,open:n,defaultOpen:s,onOpenChange:o,modal:i=!1}=r,a=nm(e),l=I.useRef(null),[c,u]=I.useState(!1),[p=!1,f]=yd({prop:n,defaultProp:s,onChange:o});return g.jsx(tP,{...a,children:g.jsx(xce,{scope:e,contentId:Vl(),triggerRef:l,open:p,onOpenChange:f,onOpenToggle:I.useCallback(()=>f(m=>!m),[f]),hasCustomAnchor:c,onCustomAnchorAdd:I.useCallback(()=>u(!0),[]),onCustomAnchorRemove:I.useCallback(()=>u(!1),[]),modal:i,children:t})})};Lz.displayName=WP;var Nz="PopoverAnchor",wce=I.forwardRef((r,e)=>{const{__scopePopover:t,...n}=r,s=bd(Nz,t),o=nm(t),{onCustomAnchorAdd:i,onCustomAnchorRemove:a}=s;return I.useEffect(()=>(i(),()=>a()),[i,a]),g.jsx(nP,{...o,...n,ref:e})});wce.displayName=Nz;var Fz="PopoverTrigger",zz=I.forwardRef((r,e)=>{const{__scopePopover:t,...n}=r,s=bd(Fz,t),o=nm(t),i=Un(e,s.triggerRef),a=g.jsx(rn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":Gz(s.open),...n,ref:i,onClick:Qe(r.onClick,s.onOpenToggle)});return s.hasCustomAnchor?a:g.jsx(nP,{asChild:!0,...o,children:a})});zz.displayName=Fz;var KP="PopoverPortal",[Cce,Ece]=Oz(KP,{forceMount:void 0}),$z=r=>{const{__scopePopover:e,forceMount:t,children:n,container:s}=r,o=bd(KP,e);return g.jsx(Cce,{scope:e,forceMount:t,children:g.jsx(ba,{present:t||o.open,children:g.jsx(Zg,{asChild:!0,container:s,children:n})})})};$z.displayName=KP;var Yh="PopoverContent",Bz=I.forwardRef((r,e)=>{const t=Ece(Yh,r.__scopePopover),{forceMount:n=t.forceMount,...s}=r,o=bd(Yh,r.__scopePopover);return g.jsx(ba,{present:n||o.open,children:o.modal?g.jsx(kce,{...s,ref:e}):g.jsx(Pce,{...s,ref:e})})});Bz.displayName=Yh;var kce=I.forwardRef((r,e)=>{const t=bd(Yh,r.__scopePopover),n=I.useRef(null),s=Un(e,n),o=I.useRef(!1);return I.useEffect(()=>{const i=n.current;if(i)return rP(i)},[]),g.jsx(kb,{as:hu,allowPinchZoom:!0,children:g.jsx(Uz,{...r,ref:s,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Qe(r.onCloseAutoFocus,i=>{var a;i.preventDefault(),o.current||(a=t.triggerRef.current)==null||a.focus()}),onPointerDownOutside:Qe(r.onPointerDownOutside,i=>{const a=i.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0,c=a.button===2||l;o.current=c},{checkForDefaultPrevented:!1}),onFocusOutside:Qe(r.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})})})}),Pce=I.forwardRef((r,e)=>{const t=bd(Yh,r.__scopePopover),n=I.useRef(!1),s=I.useRef(!1);return g.jsx(Uz,{...r,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var i,a;(i=r.onCloseAutoFocus)==null||i.call(r,o),o.defaultPrevented||(n.current||(a=t.triggerRef.current)==null||a.focus(),o.preventDefault()),n.current=!1,s.current=!1},onInteractOutside:o=>{var l,c;(l=r.onInteractOutside)==null||l.call(r,o),o.defaultPrevented||(n.current=!0,o.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const i=o.target;((c=t.triggerRef.current)==null?void 0:c.contains(i))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&s.current&&o.preventDefault()}})}),Uz=I.forwardRef((r,e)=>{const{__scopePopover:t,trapFocus:n,onOpenAutoFocus:s,onCloseAutoFocus:o,disableOutsidePointerEvents:i,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onInteractOutside:u,...p}=r,f=bd(Yh,t),m=nm(t);return W2(),g.jsx(vb,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:s,onUnmountAutoFocus:o,children:g.jsx(Yg,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:u,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onDismiss:()=>f.onOpenChange(!1),children:g.jsx(Y8,{"data-state":Gz(f.open),role:"dialog",id:f.contentId,...m,...p,ref:e,style:{...p.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Hz="PopoverClose",Ice=I.forwardRef((r,e)=>{const{__scopePopover:t,...n}=r,s=bd(Hz,t);return g.jsx(rn.button,{type:"button",...n,ref:e,onClick:Qe(r.onClick,()=>s.onOpenChange(!1))})});Ice.displayName=Hz;var _ce="PopoverArrow",Tce=I.forwardRef((r,e)=>{const{__scopePopover:t,...n}=r,s=nm(t);return g.jsx(X8,{...s,...n,ref:e})});Tce.displayName=_ce;function Gz(r){return r?"open":"closed"}var VP=Lz,qP=zz,YP=$z,XP=Bz;function ZP({id:r,children:e,onOpenChange:t,open:n}){const[s,o]=oc(r,t);return g.jsx(VP,{onOpenChange:o,open:n||s,children:g.jsx("div",{className:"tlui-popover",children:e})})}function JP({children:r}){return g.jsx(qP,{asChild:!0,dir:"ltr",children:r})}function QP({side:r,children:e,align:t="center",sideOffset:n=8,alignOffset:s=0,disableEscapeKeyDown:o=!1}){const i=Kr();return g.jsx(YP,{container:i,children:g.jsx(XP,{className:"tlui-popover__content",side:r,sideOffset:n,align:t,alignOffset:s,dir:"ltr",onEscapeKeyDown:a=>o&&a.preventDefault(),children:e})})}function Mce(r){return r.getSelectedShapeIds().map(n=>r.getShape(n)).filter(n=>{if(!n)return!1;if(r.isShapeOfType(n,"arrow")){const s=Fo(r,n);if(s.start||s.end)return!1}return!0})}const Wz=()=>{const r=ue();return ye("threeStackableItems",()=>Mce(r).length>2,[r])},ic=()=>{const r=ue();return ye("isInSelectState",()=>r.isIn("select"),[r])},Kz=()=>{const r=ue();return ye("allow group",()=>{const e=r.getSelectedShapes();if(e.length<2)return!1;for(const t of e)if(r.isShapeOfType(t,"arrow")){const n=Fo(r,t);if(n.start&&!e.some(s=>s.id===n.start.toId)||n.end&&!e.some(s=>s.id===n.end.toId))return!1}return!0},[r])},Vz=()=>{const r=ue();return ye("allowUngroup",()=>r.getSelectedShapeIds().some(e=>{var t;return((t=r.getShape(e))==null?void 0:t.type)==="group"}),[r])},Ace=typeof window<"u"&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read;function qz(r,e){const t=ue();return ye("selectedShapes",()=>t.getSelectedShapes().length>=r,[t,r,e])}function fo(r,e){const t=ue();return ye("selectedShapes",()=>{const n=t.getSelectedShapes().filter(s=>!t.isShapeOrAncestorLocked(s)).length;return r===void 0?n:n>=r},[t])}function jce(){const r=ue();return ye("showAutoSizeToggle",()=>{const e=r.getSelectedShapes();return e.length===1&&r.isShapeOfType(e[0],"text")&&e[0].props.autoSize===!1},[r])}function Yz(){const r=ue();return ye("hasLinkShapeSelected",()=>{const e=r.getOnlySelectedShape();return!!(e&&e.type!=="embed"&&"url"in e.props&&!e.isLocked)},[r])}function Rce(){const r=ue();return ye("onlyFlippableShape",()=>{const e=r.getOnlySelectedShape();return e&&(r.isShapeOfType(e,"group")||r.isShapeOfType(e,"image")||r.isShapeOfType(e,"arrow")||r.isShapeOfType(e,"line")||r.isShapeOfType(e,"draw"))},[r])}function Xz(){const r=ue();return ye("useCanRedo",()=>r.getCanRedo(),[r])}function Zz(){const r=ue();return ye("useCanUndo",()=>r.getCanUndo(),[r])}function Dce(){return g.jsxs(g.Fragment,{children:[g.jsx(Oce,{}),g.jsx(Lce,{}),g.jsx(Nce,{}),g.jsx(Fce,{}),g.jsx(zce,{}),g.jsx(Uce,{}),g.jsx(Hce,{}),g.jsx(Gce,{})]})}function Oce(){const r=fo(2),e=ic(),t=r&&e;return g.jsxs(g.Fragment,{children:[g.jsx(Pe,{actionId:"align-left",disabled:!t}),g.jsx(Pe,{actionId:"align-center-horizontal",disabled:!t}),g.jsx(Pe,{actionId:"align-right",disabled:!t}),g.jsx(Pe,{actionId:"stretch-horizontal",disabled:!t}),g.jsx(Pe,{actionId:"align-top",disabled:!t}),g.jsx(Pe,{actionId:"align-center-vertical",disabled:!t}),g.jsx(Pe,{actionId:"align-bottom",disabled:!t}),g.jsx(Pe,{actionId:"stretch-vertical",disabled:!t})]})}function Lce(){const r=fo(3),e=ic(),t=r&&e;return g.jsxs(g.Fragment,{children:[g.jsx(Pe,{actionId:"distribute-horizontal",disabled:!t}),g.jsx(Pe,{actionId:"distribute-vertical",disabled:!t})]})}function Nce(){const r=Wz(),e=ic(),t=r&&e;return g.jsxs(g.Fragment,{children:[g.jsx(Pe,{actionId:"stack-horizontal",disabled:!t}),g.jsx(Pe,{actionId:"stack-vertical",disabled:!t})]})}function Fce(){const r=fo(1),e=ic(),t=r&&e;return g.jsxs(g.Fragment,{children:[g.jsx(Pe,{actionId:"send-to-back",disabled:!t}),g.jsx(Pe,{actionId:"send-backward",disabled:!t}),g.jsx(Pe,{actionId:"bring-forward",disabled:!t}),g.jsx(Pe,{actionId:"bring-to-front",disabled:!t})]})}function zce(){return po()<yr.TABLET_SM?g.jsx($ce,{}):g.jsx(Bce,{})}function $ce(){const r=ue(),e=ye("zoom is 1",()=>r.getZoomLevel()===1,[r]);return g.jsx(Pe,{actionId:"zoom-to-100",disabled:e})}function Bce(){const r=fo(1),e=ic(),t=r&&e;return g.jsx(Pe,{actionId:"rotate-ccw",disabled:!t})}function Uce(){const r=fo(1),e=ic(),t=r&&e;return g.jsx(Pe,{actionId:"rotate-cw",disabled:!t})}function Hce(){const r=Yz(),e=ic(),t=r&&e;return g.jsx(Pe,{actionId:"edit-link",disabled:!t})}function Gce(){const r=Kz(),e=Vz();return r?g.jsx(ZD,{}):e?g.jsx(Wce,{}):g.jsx(ZD,{})}function ZD(){const r=fo(2),e=ic(),t=r&&e;return g.jsx(Pe,{actionId:"group",disabled:!t})}function Wce(){return g.jsx(Pe,{actionId:"ungroup"})}const Kce=I.memo(function({children:e}){const t=Wt(),n=po(),s=gi(),o=I.useRef(null);md(o);const i=ue(),a=ye("should display quick actions when in readonly",()=>i.isInAny("hand","zoom"),[i]),l=e??g.jsx(Dce,{});if(!(s&&!a))return g.jsxs(ZP,{id:"actions-menu",children:[g.jsx(JP,{children:g.jsx(ut,{type:"icon","data-testid":"actions-menu.button",title:t("actions-menu.title"),children:g.jsx($t,{icon:"dots-vertical",small:!0})})}),g.jsx(QP,{side:n>=yr.TABLET?"bottom":"top",sideOffset:6,children:g.jsx("div",{ref:o,className:"tlui-actions-menu tlui-buttons__grid","data-testid":"actions-menu.content",children:g.jsx(zi,{type:"icons",sourceId:"actions-menu",children:l})})})]})});function Jz(){return jce()?g.jsx(Pe,{actionId:"toggle-auto-size"}):null}function Qz(){return Yz()?g.jsx(Pe,{actionId:"edit-link"}):null}function Vce(){return fo(1)?g.jsx(Pe,{actionId:"duplicate"}):null}function e$(){const r=ue();return ye("should display flatten option",()=>{if(r.getSelectedShapeIds().length===0)return!1;const n=r.getOnlySelectedShape();return!(n&&r.isShapeOfType(n,"image"))},[r])?g.jsx(Pe,{actionId:"flatten-to-image"}):null}function t$(){return Kz()?g.jsx(Pe,{actionId:"group"}):null}function n$(){return Vz()?g.jsx(Pe,{actionId:"ungroup"}):null}function r$(){const r=ue();return ye("allow unframe",()=>{const t=r.getSelectedShapes();return t.length===0?!1:t.every(n=>r.isShapeOfType(n,"frame"))},[r])?g.jsx(Pe,{actionId:"remove-frame"}):null}function s$(){const r=ue();return ye("allow fit frame to content",()=>{const t=r.getOnlySelectedShape();return t?r.isShapeOfType(t,"frame")&&r.getSortedChildIdsForParent(t).length>0:!1},[r])?g.jsx(Pe,{actionId:"fit-frame-to-content"}):null}function o$(){const r=ue();return ye("selected shapes",()=>r.getSelectedShapes().length>0,[r])?g.jsx(Pe,{actionId:"toggle-lock"}):null}function eI(){const r=ue(),e=ye("isTransparentBg",()=>!r.getInstanceState().exportBackground,[r]);return g.jsx(xa,{actionId:"toggle-transparent",checked:e,toggle:!0})}function qce(){const r=ue(),e=ye("any shapes",()=>r.getCurrentPageShapeIds().size>0,[r]);return g.jsx(Pe,{actionId:"unlock-all",disabled:!e})}function i$(){const r=ue(),e=ye("zoomed to 100",()=>r.getZoomLevel()===1,[r]);return g.jsx(Pe,{actionId:"zoom-to-100",noClose:!0,disabled:e})}function a$(){const r=ue(),e=ye("has shapes",()=>r.getCurrentPageShapeIds().size>0,[r]);return g.jsx(Pe,{actionId:"zoom-to-fit",disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function l$(){const r=ue(),e=ye("has shapes",()=>r.getSelectedShapeIds().length>0,[r]);return g.jsx(Pe,{actionId:"zoom-to-selection",disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function c$(){return g.jsxs(_t,{id:"clipboard",children:[g.jsx(Xce,{}),g.jsx(Zce,{}),g.jsx(Jce,{}),g.jsx(Vce,{}),g.jsx(Qce,{})]})}function Yce(){var t;const r=ue(),e=ye("atLeastOneShapeOnPage",()=>r.getCurrentPageShapeIds().size>0,[r]);return g.jsxs(Vo,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!e,children:[g.jsxs(_t,{id:"copy-as-group",children:[g.jsx(Pe,{actionId:"copy-as-svg"}),!!((t=window.navigator.clipboard)!=null&&t.write)&&g.jsx(Pe,{actionId:"copy-as-png"}),g.jsx(Pe,{actionId:"copy-as-json"})]}),g.jsx(_t,{id:"copy-as-bg",children:g.jsx(eI,{})})]})}function Xce(){const r=fo(1);return g.jsx(Pe,{actionId:"cut",disabled:!r})}function Zce(){const r=qz(1);return g.jsx(Pe,{actionId:"copy",disabled:!r})}function Jce(){const r=Ace;return g.jsx(Pe,{actionId:"paste",disabled:!r})}function d$(){const r=ue();return ye("atLeastOneShapeOnPage",()=>r.getCurrentPageShapeIds().size>0,[r])?g.jsxs(_t,{id:"conversions",children:[g.jsx(Yce,{}),g.jsxs(Vo,{id:"export-as",label:"context-menu.export-as",size:"small",children:[g.jsxs(_t,{id:"export-as-group",children:[g.jsx(Pe,{actionId:"export-as-svg"}),g.jsx(Pe,{actionId:"export-as-png"}),g.jsx(Pe,{actionId:"export-as-json"})]}),g.jsx(_t,{id:"export-as-bg",children:g.jsx(eI,{})})]})]}):null}function u$(){const r=ue(),e=ye("atLeastOneShapeOnPage",()=>r.getCurrentPageShapeIds().size>0,[r]);return g.jsx(Pe,{actionId:"select-all",disabled:!e})}function Qce(){const r=fo(1);return g.jsx(Pe,{actionId:"delete",disabled:!r})}function ede(){const r=gi();return!qz(1)||r?null:g.jsxs(Vo,{id:"edit",label:"context-menu.edit",size:"small",children:[g.jsx(t$,{}),g.jsx(n$,{}),g.jsx(e$,{}),g.jsx(Qz,{}),g.jsx(s$,{}),g.jsx(r$,{}),g.jsx(p$,{}),g.jsx(h$,{}),g.jsx(Jz,{}),g.jsx(o$,{})]})}function tde(){const r=fo(2),e=Rce();return gi()||!(r||e)?null:g.jsxs(Vo,{id:"arrange",label:"context-menu.arrange",size:"small",children:[r&&g.jsxs(_t,{id:"align",children:[g.jsx(Pe,{actionId:"align-left"}),g.jsx(Pe,{actionId:"align-center-horizontal"}),g.jsx(Pe,{actionId:"align-right"}),g.jsx(Pe,{actionId:"align-top"}),g.jsx(Pe,{actionId:"align-center-vertical"}),g.jsx(Pe,{actionId:"align-bottom"})]}),g.jsx(nde,{}),r&&g.jsxs(_t,{id:"stretch",children:[g.jsx(Pe,{actionId:"stretch-horizontal"}),g.jsx(Pe,{actionId:"stretch-vertical"})]}),(r||e)&&g.jsxs(_t,{id:"flip",children:[g.jsx(Pe,{actionId:"flip-horizontal"}),g.jsx(Pe,{actionId:"flip-vertical"})]}),g.jsx(rde,{})]})}function nde(){return fo(3)?g.jsxs(_t,{id:"distribute",children:[g.jsx(Pe,{actionId:"distribute-horizontal"}),g.jsx(Pe,{actionId:"distribute-vertical"})]}):null}function rde(){const r=fo(2),e=Wz();return r?g.jsxs(_t,{id:"order",children:[g.jsx(Pe,{actionId:"pack"}),e&&g.jsx(Pe,{actionId:"stack-horizontal"}),e&&g.jsx(Pe,{actionId:"stack-vertical"})]}):null}function sde(){const r=gi(),e=fo(1);return r||!e?null:g.jsx(Vo,{id:"reorder",label:"context-menu.reorder",size:"small",children:g.jsxs(_t,{id:"reorder",children:[g.jsx(Pe,{actionId:"bring-to-front"}),g.jsx(Pe,{actionId:"bring-forward"}),g.jsx(Pe,{actionId:"send-backward"}),g.jsx(Pe,{actionId:"send-to-back"})]})})}function ode(){const r=ue(),e=ye("pages",()=>r.getPages(),[r]),t=ye("current page id",()=>r.getCurrentPageId(),[r]),{addToast:n}=sc(),s=ws(),o=gi();return!fo(1)||o?null:g.jsxs(Vo,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[g.jsx(_t,{id:"pages",children:e.map(a=>g.jsx(Wr,{id:a.id,disabled:t===a.id,label:a.name.length>30?`${a.name.slice(0,30)}…`:a.name,onSelect:()=>{r.markHistoryStoppingPoint("move_shapes_to_page"),r.moveShapesToPage(r.getSelectedShapeIds(),a.id);const l=r.getPage(a.id);l&&n({title:"Changed Page",description:`Moved to ${l.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{r.markHistoryStoppingPoint("change-page"),r.setCurrentPage(t)}}]}),s("move-to-page",{source:"context-menu"})}},a.id))}),g.jsx(_t,{id:"new-page",children:g.jsx(Pe,{actionId:"move-to-new-page"})})]})}function h$(){const r=ue();return ye("oneEmbedSelected",()=>{const t=r.getOnlySelectedShape();return t?!!(r.isShapeOfType(t,"embed")&&t.props.url&&!r.isShapeOrAncestorLocked(t)):!1},[r])?g.jsx(Pe,{actionId:"convert-to-bookmark"}):null}function p$(){const r=ue(),e=kP();return ye("oneEmbeddableBookmarkSelected",()=>{const n=r.getOnlySelectedShape();return n?!!(r.isShapeOfType(n,"bookmark")&&n.props.url&&e(n.props.url)&&!r.isShapeOrAncestorLocked(n)):!1},[r])?g.jsx(Pe,{actionId:"convert-to-embed"}):null}function ide(){const r=ue(),e=ye("isSnapMode",()=>r.user.getIsSnapMode(),[r]);return g.jsx(xa,{actionId:"toggle-snap-mode",checked:e})}function ade(){const r=ue(),e=ye("isToolLock",()=>r.getInstanceState().isToolLocked,[r]);return g.jsx(xa,{actionId:"toggle-tool-lock",checked:e})}function lde(){const r=ue(),e=ye("isGridMode",()=>r.getInstanceState().isGridMode,[r]);return g.jsx(xa,{actionId:"toggle-grid",checked:e})}function cde(){const r=ue(),e=ye("isWrapMode",()=>r.user.getIsWrapMode(),[r]);return g.jsx(xa,{actionId:"toggle-wrap-mode",checked:e})}function dde(){const r=ue(),e=ye("isFocusMode",()=>r.getInstanceState().isFocusMode,[r]);return g.jsx(xa,{actionId:"toggle-focus-mode",checked:e})}function ude(){const r=ue(),e=ye("edgeScrollSpeed",()=>r.user.getEdgeScrollSpeed(),[r]);return g.jsx(xa,{actionId:"toggle-edge-scrolling",checked:e===1})}function hde(){const r=ue(),e=ye("animationSpeed",()=>r.user.getAnimationSpeed(),[r]);return g.jsx(xa,{actionId:"toggle-reduce-motion",checked:e===0})}function pde(){const r=ue(),e=ye("isDebugMode",()=>r.getInstanceState().isDebugMode,[r]);return g.jsx(xa,{actionId:"toggle-debug-mode",checked:e})}function fde(){const r=ue(),e=ye("dynamic resize",()=>r.user.getIsDynamicResizeMode(),[r]);return g.jsx(xa,{actionId:"toggle-dynamic-size-mode",checked:e})}function gde(){const r=ue(),e=ye("paste at cursor",()=>r.user.getIsPasteAtCursorMode(),[r]);return g.jsx(xa,{actionId:"toggle-paste-at-cursor",checked:e})}function mde(){const r=ue();return ye("show cursor chat",()=>r.getCurrentToolId()==="select"&&!r.getInstanceState().isCoarsePointer,[r])?g.jsx(Pe,{actionId:"open-cursor-chat"}):null}function pk(){const r=ue(),e=Rb(),t=ye("isSelectToolActive",()=>r.getCurrentToolId()==="select",[r]),n=ye("isSinglePageMode",()=>r.options.maxPages<=1,[r]);return t?g.jsxs(g.Fragment,{children:[e&&g.jsx(mde,{}),g.jsxs(_t,{id:"modify",children:[g.jsx(ede,{}),g.jsx(tde,{}),g.jsx(sde,{}),!n&&g.jsx(ode,{})]}),g.jsx(c$,{}),g.jsx(d$,{}),g.jsx(_t,{id:"select-all",children:g.jsx(u$,{})})]}):null}const fk=I.memo(function({children:e,disabled:t=!1}){const n=ue(),{Canvas:s}=Vn(),o=I.useCallback(u=>{if(u){if(n.getInstanceState().isCoarsePointer){const p=n.getSelectedShapes(),{inputs:{currentPagePoint:f}}=n,m=n.getShapesAtPoint(f);if(!n.getSelectedShapes().length||!m.some(v=>p.includes(v))){const v=m.filter(b=>n.isShapeOrAncestorLocked(b));v.length&&n.select(...v.map(b=>b.id))}}}else{const p=n.getOnlySelectedShape();p&&n.isShapeOrAncestorLocked(p)&&n.setSelectedShapes([])}},[n]),i=Kr(),[a,l]=oc("context menu",o),c=e??g.jsx(pk,{});return g.jsxs(are,{dir:"ltr",onOpenChange:l,modal:!1,children:[g.jsx(lre,{onContextMenu:void 0,dir:"ltr",disabled:t,children:s?g.jsx(s,{}):null}),a&&g.jsx(cre,{container:i,children:g.jsx(dre,{className:"tlui-menu scrollable","data-testid":"context-menu",alignOffset:-4,collisionPadding:4,onContextMenu:Ot,children:g.jsx(zi,{type:"context-menu",sourceId:"context-menu",children:c})})})]})}),yde=2e3,vde=5e3,bde=Ss(function(){const e=ue(),{isChatting:t,chatMessage:n}=e.getInstanceState(),s=I.useRef(-1),[o,i]=I.useState("");return I.useEffect(()=>{if(!t&&n||t){const l=t?vde:yde;s.current=e.timers.setTimeout(()=>{e.updateInstanceState({chatMessage:"",isChatting:!1}),i(""),e.focus()},l)}return()=>{clearTimeout(s.current)}},[e,n,t]),t?g.jsx(xde,{value:o,setValue:i,chatMessage:n}):n.trim()?g.jsx(Sde,{chatMessage:n}):null});function f$(r){const e=ue();I.useLayoutEffect(()=>{var i;if(!r.current)return;const{x:n,y:s}=e.inputs.currentScreenPoint;(i=r.current)==null||i.style.setProperty("transform",`translate(${n}px, ${s}px)`);function o(a){var u;const{minX:l,minY:c}=e.getViewportScreenBounds();(u=r.current)==null||u.style.setProperty("transform",`translate(${a.clientX-l}px, ${a.clientY-c}px)`)}return window.addEventListener("pointermove",o),()=>{window.removeEventListener("pointermove",o)}},[r,e])}const Sde=({chatMessage:r})=>{const e=ue(),t=I.useRef(null);return f$(t),g.jsx("div",{ref:t,className:"tl-cursor-chat tl-cursor-chat__bubble",style:{backgroundColor:e.user.getColor()},children:r})},xde=Ss(function({chatMessage:e,value:t,setValue:n}){const s=ue(),o=Wt(),i=I.useRef(null),a=e||o("cursor-chat.type-to-chat");f$(i),I.useLayoutEffect(()=>{const f=i.current;if(!f)return;const m=s.textMeasure.measureText(t||a,{fontFamily:"var(--font-body)",fontSize:12,fontWeight:"500",fontStyle:"normal",maxWidth:null,lineHeight:1,padding:"6px"});f.style.setProperty("width",m.w+"px")},[s,t,a]),I.useLayoutEffect(()=>{const f=s.timers.requestAnimationFrame(()=>{var m;(m=i.current)==null||m.focus()});return()=>{cancelAnimationFrame(f)}},[s]);const l=I.useCallback(()=>{s.updateInstanceState({isChatting:!1}),s.focus()},[s]),c=I.useCallback(f=>{const{value:m}=f.target;n(m.slice(0,64)),s.updateInstanceState({chatMessage:m})},[s,n]),u=I.useCallback(f=>{const m=i.current;if(!m)return;const{value:v}=m;switch(f.key){case"Enter":{if(Ot(f),f.stopPropagation(),!v){l();return}n("");break}case"Escape":{Ot(f),f.stopPropagation(),l();break}}},[l,n]),p=I.useCallback(f=>{f.stopPropagation()},[]);return g.jsx("input",{ref:i,className:"tl-cursor-chat",style:{backgroundColor:s.user.getColor()},onBlur:l,onChange:c,onKeyDown:u,onPaste:p,value:t,placeholder:a,spellCheck:!1})});function gk({checked:r}){return g.jsx(hl,{icon:r?"check":"none",className:"tlui-button__icon",small:!0})}function wde(){const r=ue(),{addToast:e}=sc(),{addDialog:t}=tm(),[n,s]=Ht.useState(!1);return g.jsxs(g.Fragment,{children:[g.jsxs(_t,{id:"items",children:[g.jsx(Wr,{id:"add-toast",onSelect:()=>{e({id:Cn(),title:"Something good happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"success"}),e({id:Cn(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"info",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:Cn(),title:"Something maybe bad happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"warning",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:Cn(),title:"Something bad happened",severity:"error",keepOpen:!0})},label:"Show toast"}),g.jsx(Wr,{id:"show-dialog",label:"Show dialog",onSelect:()=>{t({component:({onClose:o})=>g.jsx(kde,{displayDontShowAgain:!0,onCancel:()=>o(),onContinue:()=>o()}),onClose:()=>{}})}}),g.jsx(Wr,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>Pde(r,100)}),g.jsx(Wr,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{var a;const o=r.getSelectedShapes(),i=o.length===0?r.getRenderingShapes():o;window.alert(`Shapes ${i.length}, DOM nodes:${(a=document.querySelector(".tl-shapes").querySelectorAll("*"))==null?void 0:a.length}`)}}),(()=>{if(n)throw Error("oh no!");return null})(),g.jsx(Wr,{id:"throw-error",onSelect:()=>s(!0),label:"Throw error"}),g.jsx(Wr,{id:"hard-reset",onSelect:rL,label:"Hard reset"})]}),g.jsxs(_t,{id:"flags",children:[g.jsx(Cde,{}),g.jsx(Ede,{})]})]})}function Cde(){const r=Object.values(_r);return r.length?g.jsx(Vo,{id:"debug flags",label:"Debug Flags",children:g.jsx(_t,{id:"debug flags",children:r.map(e=>g.jsx(g$,{flag:e},e.name))})}):null}function Ede(){const r=Object.values(_V);return r.length?g.jsx(Vo,{id:"feature flags",label:"Feature Flags",children:g.jsx(_t,{id:"feature flags",children:r.map(e=>g.jsx(g$,{flag:e},e.name))})}):null}function kde({title:r="title",body:e="hello hello hello",cancel:t="Cancel",confirm:n="Continue",displayDontShowAgain:s=!1,onCancel:o,onContinue:i}){const[a,l]=Ht.useState(!1);return g.jsxs(g.Fragment,{children:[g.jsxs(Tb,{children:[g.jsx(Mb,{children:r}),g.jsx(Ab,{})]}),g.jsx(qf,{style:{maxWidth:350},children:e}),g.jsxs(CP,{className:"tlui-dialog__footer__actions",children:[s&&g.jsxs(ut,{type:"normal",onClick:()=>l(!a),style:{marginRight:"auto"},children:[g.jsx(gk,{checked:a}),g.jsx(Tr,{children:"Don’t show again"})]}),g.jsx(ut,{type:"normal",onClick:o,children:g.jsx(Tr,{children:t})}),g.jsx(ut,{type:"primary",onClick:async()=>i(),children:g.jsx(Tr,{children:n})})]})]})}const g$=Ss(function({flag:e,onChange:t}){const n=e.get();return g.jsx(ou,{id:e.name,title:e.name,label:e.name.replace(/([a-z0-9])([A-Z])/g,s=>`${s[0]} ${s[1].toLowerCase()}`).replace(/^[a-z]/,s=>s.toUpperCase()),checked:n,onSelect:()=>{e.set(!n),t==null||t(!n)}})});let JD=0;function Pde(r,e){const t=Array(e),n=Math.floor(Math.sqrt(e));for(let s=0;s<e;s++)JD++,t[s]={id:vn("box"+JD),type:"geo",x:s%n*132,y:Math.floor(s/n)*132};r.run(()=>{r.createShapes(t).setSelectedShapes(t.map(s=>s.id))})}function Ide({children:r}){const e=r??g.jsx(wde,{});return g.jsxs(gu,{id:"debug",children:[g.jsx(mu,{children:g.jsx(ut,{type:"icon",title:"Debug menu",children:g.jsx($t,{icon:"dots-horizontal"})})}),g.jsx(yu,{side:"top",align:"end",alignOffset:0,children:g.jsx(zi,{type:"menu",sourceId:"debug-panel",children:e})})]})}const _de=I.memo(function(){const{DebugMenu:e}=Sd(),t=I.useRef(null);return md(t),g.jsxs("div",{ref:t,className:"tlui-debug-panel",children:[g.jsx(Mde,{}),g.jsx(Ade,{}),e&&g.jsx(e,{})]})});function Tde(r=!0){const[e,t]=I.useState(0),n=ue();I.useEffect(()=>{if(!r)return;const s=()=>t(o=>o+1);return n.on("tick",s),()=>{n.off("tick",s)}},[n,r])}const Mde=Ss(function(){Tde();const e=ue(),t=e.getPath(),n=e.getHoveredShape(),s=e.getOnlySelectedShape(),o=t==="select.idle"||!t.includes("select.")?n:s,i=o&&t.includes("select.")?` / ${o.type||""}${"geo"in o.props?" / "+o.props.geo:""} / [${P.ToInt(e.getPointInShapeSpace(o,e.inputs.currentPagePoint))}]`:"",a=t.startsWith("select.")&&!t.includes(".idle")?` / [${P.ToInt(e.inputs.originPagePoint)}] → [${P.ToInt(e.inputs.currentPagePoint)}] = ${P.Dist(e.inputs.originPagePoint,e.inputs.currentPagePoint).toFixed(0)}`:"";return g.jsx("div",{className:"tlui-debug-panel__current-state",children:`${t}${i}${a}`})});function Ade(){const r=ue(),e=ye("show_fps",()=>_r.showFps.get(),[_r]),t=I.useRef(null);return I.useEffect(()=>{if(!e)return;const n=250;let s=0,o=-1,i=performance.now(),a=0,l=0,c=!1;function u(){if(l++,a=performance.now()-i,a>n){const p=Math.round(l*(n/a)*(1e3/n));p>s&&(s=p);const f=s*.75;(p<f&&!c||p>=f&&c)&&(c=!c),t.current.innerHTML=`FPS ${p.toString()}`,t.current.className="tlui-debug-panel__fps"+(c?" tlui-debug-panel__fps__slow":""),a-=n,l=0,i=performance.now()}o=r.timers.requestAnimationFrame(u)}return u(),()=>{cancelAnimationFrame(o)}},[e,r]),e?g.jsx("div",{ref:t}):null}const jde=I.memo(function(){const e=po(),t=I.useRef(null);md(t);const{MainMenu:n,QuickActions:s,ActionsMenu:o,PageMenu:i}=Sd(),a=ue(),l=ye("isSinglePageMode",()=>a.options.maxPages<=1,[a]),c=a.options.actionShortcutsLocation==="menu"?!0:a.options.actionShortcutsLocation==="toolbar"?!1:e>=yr.TABLET;return!n&&!i&&!c?null:g.jsx("div",{ref:t,className:"tlui-menu-zone",children:g.jsxs("div",{className:"tlui-buttons__horizontal",children:[n&&g.jsx(n,{}),i&&!l&&g.jsx(i,{}),c?g.jsxs(g.Fragment,{children:[s&&g.jsx(s,{}),o&&g.jsx(o,{})]}):null]})})});function Rde(){const r=ue(),e=Iu(),[t,n]=I.useState(!1),s=I.useRef(!1);return Zc("toggle showback to content",()=>{const o=s.current,i=r.getCurrentPageShapeIds();let a=!1;i.size&&(a=i.size===r.getCulledShapes().size),o!==a&&(n(a),s.current=a)},[r]),t?g.jsx(Pe,{actionId:"back-to-content",onSelect:()=>{e["back-to-content"].onSelect("helper-buttons"),n(!1)}}):null}function Dde(){const r=ue();return ye("is pen mode",()=>r.getInstanceState().isPenMode,[r])?g.jsx(Pe,{actionId:"exit-pen-mode"}):null}function Ode(){const r=ue(),e=Iu();return ye("is following user",()=>!!r.getInstanceState().followingUserId,[r])?g.jsx(Wr,{...e["stop-following"]}):null}function Lde(){return g.jsxs(g.Fragment,{children:[g.jsx(Dde,{}),g.jsx(Rde,{}),g.jsx(Ode,{})]})}function Nde({children:r}){const e=r??g.jsx(Lde,{});return g.jsx("div",{className:"tlui-helper-buttons",children:g.jsx(zi,{type:"helper-buttons",sourceId:"helper-buttons",children:e})})}function Fde(){const r=Rb();return g.jsxs(g.Fragment,{children:[g.jsxs(_t,{label:"shortcuts-dialog.tools",id:"tools",children:[g.jsx(Pe,{actionId:"toggle-tool-lock"}),g.jsx(Pe,{actionId:"insert-media"}),g.jsx(Io,{toolId:"select"}),g.jsx(Io,{toolId:"draw"}),g.jsx(Io,{toolId:"eraser"}),g.jsx(Io,{toolId:"hand"}),g.jsx(Io,{toolId:"rectangle"}),g.jsx(Io,{toolId:"ellipse"}),g.jsx(Io,{toolId:"arrow"}),g.jsx(Io,{toolId:"line"}),g.jsx(Io,{toolId:"text"}),g.jsx(Io,{toolId:"frame"}),g.jsx(Io,{toolId:"note"}),g.jsx(Io,{toolId:"laser"}),g.jsx(Wr,{id:"pointer-down",label:"tool.pointer-down",kbd:",",onSelect:()=>{}})]}),g.jsxs(_t,{label:"shortcuts-dialog.preferences",id:"preferences",children:[g.jsx(Pe,{actionId:"toggle-dark-mode"}),g.jsx(Pe,{actionId:"toggle-focus-mode"}),g.jsx(Pe,{actionId:"toggle-grid"})]}),g.jsxs(_t,{label:"shortcuts-dialog.edit",id:"edit",children:[g.jsx(Pe,{actionId:"undo"}),g.jsx(Pe,{actionId:"redo"}),g.jsx(Pe,{actionId:"cut"}),g.jsx(Pe,{actionId:"copy"}),g.jsx(Pe,{actionId:"paste"}),g.jsx(Pe,{actionId:"select-all"}),g.jsx(Pe,{actionId:"delete"}),g.jsx(Pe,{actionId:"duplicate"})]}),g.jsxs(_t,{label:"shortcuts-dialog.view",id:"view",children:[g.jsx(Pe,{actionId:"zoom-in"}),g.jsx(Pe,{actionId:"zoom-out"}),g.jsx(Pe,{actionId:"zoom-to-100"}),g.jsx(Pe,{actionId:"zoom-to-fit"}),g.jsx(Pe,{actionId:"zoom-to-selection"})]}),g.jsxs(_t,{label:"shortcuts-dialog.transform",id:"transform",children:[g.jsx(Pe,{actionId:"bring-to-front"}),g.jsx(Pe,{actionId:"bring-forward"}),g.jsx(Pe,{actionId:"send-backward"}),g.jsx(Pe,{actionId:"send-to-back"}),g.jsx(Pe,{actionId:"group"}),g.jsx(Pe,{actionId:"ungroup"}),g.jsx(Pe,{actionId:"flip-horizontal"}),g.jsx(Pe,{actionId:"flip-vertical"}),g.jsx(Pe,{actionId:"align-top"}),g.jsx(Pe,{actionId:"align-center-vertical"}),g.jsx(Pe,{actionId:"align-bottom"}),g.jsx(Pe,{actionId:"align-left"}),g.jsx(Pe,{actionId:"align-center-horizontal"}),g.jsx(Pe,{actionId:"align-right"})]}),r&&g.jsx(_t,{label:"shortcuts-dialog.collaboration",id:"collaboration",children:g.jsx(Pe,{actionId:"open-cursor-chat"})})]})}const zde=I.memo(function({children:e}){const t=Wt(),n=po(),s=e??g.jsx(Fde,{});return g.jsxs(g.Fragment,{children:[g.jsxs(Tb,{className:"tlui-shortcuts-dialog__header",children:[g.jsx(Mb,{children:t("shortcuts-dialog.title")}),g.jsx(Ab,{})]}),g.jsx(qf,{className:it("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":n<=yr.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":n<=yr.TABLET}),children:g.jsx(zi,{type:"keyboard-shortcuts",sourceId:"kbd",children:s})}),g.jsx("div",{className:"tlui-dialog__scrim"})]})});function m$(){const r=fd(),e=ws(),t=ye("locale",()=>r==null?void 0:r.user.getLocale(),[r]);return r?g.jsx(Vo,{id:"help menu language",label:"menu.language",children:g.jsx(_t,{id:"languages",children:Uf.map(({locale:n,label:s})=>g.jsx(ou,{id:`language-${n}`,title:n,label:s,checked:n===t,readonlyOk:!0,onSelect:()=>{r.user.updateUserPreferences({locale:n}),e("change-language",{source:"menu",locale:n})}},n))})}):null}function $de(){return g.jsxs(g.Fragment,{children:[g.jsx(m$,{}),g.jsx(y$,{})]})}function y$(){const{KeyboardShortcutsDialog:r}=Sd(),{addDialog:e}=tm(),t=I.useCallback(()=>{r&&e({component:r})},[e,r]);return r?g.jsx(Wr,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:t}):null}function v$(){return g.jsxs(g.Fragment,{children:[g.jsxs(_t,{id:"basic",children:[g.jsx(Ude,{}),g.jsx(Kde,{}),g.jsx(Bde,{}),g.jsx(Vde,{})]}),g.jsx(qde,{})]})}function Bde(){return g.jsxs(Vo,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[g.jsxs(_t,{id:"export-all-as-group",children:[g.jsx(Pe,{actionId:"export-all-as-svg"}),g.jsx(Pe,{actionId:"export-all-as-png"}),g.jsx(Pe,{actionId:"export-all-as-json"})]}),g.jsx(_t,{id:"export-all-as-bg",children:g.jsx(eI,{})})]})}function Ude(){const r=ue(),e=ye("isSelectToolActive",()=>r.getCurrentToolId()==="select",[r]);return g.jsxs(Vo,{id:"edit",label:"menu.edit",disabled:!e,children:[g.jsx(Wde,{}),g.jsx(c$,{}),g.jsx(d$,{}),g.jsx(Hde,{}),g.jsx(Gde,{}),g.jsx(_t,{id:"select-all",children:g.jsx(u$,{})})]})}function Hde(){return g.jsxs(_t,{id:"misc",children:[g.jsx(t$,{}),g.jsx(n$,{}),g.jsx(Qz,{}),g.jsx(Jz,{}),g.jsx(r$,{}),g.jsx(s$,{}),g.jsx(p$,{}),g.jsx(h$,{}),g.jsx(e$,{})]})}function Gde(){return g.jsxs(_t,{id:"lock",children:[g.jsx(o$,{}),g.jsx(qce,{})]})}function Wde(){const r=Zz(),e=Xz();return g.jsxs(_t,{id:"undo-redo",children:[g.jsx(Pe,{actionId:"undo",disabled:!r}),g.jsx(Pe,{actionId:"redo",disabled:!e})]})}function Kde(){return g.jsx(Vo,{id:"view",label:"menu.view",children:g.jsxs(_t,{id:"view-actions",children:[g.jsx(Pe,{actionId:"zoom-in"}),g.jsx(Pe,{actionId:"zoom-out"}),g.jsx(i$,{}),g.jsx(a$,{}),g.jsx(l$,{})]})})}function Vde(){return g.jsxs(g.Fragment,{children:[g.jsx(Pe,{actionId:"insert-embed"}),g.jsx(Pe,{actionId:"insert-media"})]})}function qde(){return g.jsxs(_t,{id:"preferences",children:[g.jsxs(Vo,{id:"preferences",label:"menu.preferences",children:[g.jsxs(_t,{id:"preferences-actions",children:[g.jsx(ide,{}),g.jsx(ade,{}),g.jsx(lde,{}),g.jsx(cde,{}),g.jsx(dde,{}),g.jsx(ude,{}),g.jsx(hde,{}),g.jsx(fde,{}),g.jsx(gde,{}),g.jsx(pde,{})]}),g.jsx(_t,{id:"color-scheme",children:g.jsx(rie,{})})]}),g.jsx(m$,{}),g.jsx(y$,{})]})}const b$=I.memo(function({children:e}){const t=Kr(),[n,s]=oc("main menu"),o=Wt(),i=e??g.jsx(v$,{});return g.jsxs(gP,{dir:"ltr",open:n,onOpenChange:s,modal:!1,children:[g.jsx(mP,{asChild:!0,dir:"ltr",children:g.jsx(ut,{type:"icon","data-testid":"main-menu.button",title:o("menu.title"),children:g.jsx($t,{icon:"menu",small:!0})})}),g.jsx(_b,{container:t,children:g.jsx(yP,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:g.jsx(zi,{type:"menu",sourceId:"main-menu",children:i})})})]})}),MC={};function af(r){if(MC[r])return MC[r];const t=document.createElement("canvas").getContext("2d");t.fillStyle=r,t.fillRect(0,0,1,1);const[n,s,o,i]=t.getImageData(0,0,1,1).data,a=new Float32Array([n/255,s/255,o/255,i/255]);return MC[r]=a,a}const Pv=10,S$=4*6*Pv+12+4*12;function hh(r,{center:e,radius:t,numArcSegments:n=20,startAngle:s=0,endAngle:o=xn,offset:i=0}){const a=(o-s)/n;let l=i;for(let c=s;c<o;c+=a)r[l++]=e.x,r[l++]=e.y,r[l++]=e.x+Math.cos(c)*t,r[l++]=e.y+Math.sin(c)*t,r[l++]=e.x+Math.cos(c+a)*t,r[l++]=e.y+Math.sin(c+a)*t;return r}function ph(r,e,t,n,s,o){r[e++]=t,r[e++]=n,r[e++]=t,r[e++]=n+o,r[e++]=t+s,r[e++]=n,r[e++]=t+s,r[e++]=n,r[e++]=t,r[e++]=n+o,r[e++]=t+s,r[e++]=n+o}function Yde(r,e,t){const n=Pv;t=Math.min(t,Math.min(e.w,e.h)/2);const s=Ve.ExpandBy(e,-t);if(s.w<=0||s.h<=0)return hh(r,{center:e.center,radius:t,numArcSegments:Pv*4}),Pv*4*6;let o=0;return ph(r,o,s.minX,s.minY,s.w,s.h),o+=12,ph(r,o,s.minX,e.minY,s.w,t),o+=12,ph(r,o,s.maxX,s.minY,t,s.h),o+=12,ph(r,o,s.minX,s.maxY,s.w,t),o+=12,ph(r,o,e.minX,s.minY,t,s.h),o+=12,hh(r,{numArcSegments:n,offset:o,center:s.point,radius:t,startAngle:cn,endAngle:cn*1.5}),o+=n*6,hh(r,{numArcSegments:n,offset:o,center:P.Add(s.point,new P(s.w,0)),radius:t,startAngle:cn*1.5,endAngle:xn}),o+=n*6,hh(r,{numArcSegments:n,offset:o,center:P.Add(s.point,s.size),radius:t,startAngle:0,endAngle:Bn}),o+=n*6,hh(r,{numArcSegments:n,offset:o,center:P.Add(s.point,new P(0,s.h)),radius:t,startAngle:Bn,endAngle:cn}),S$}function Xde(r){if(!r)throw new Error("Canvas element not found");const e=r.getContext("webgl2",{premultipliedAlpha:!1});if(!e)throw new Error("Failed to get webgl2 context");const t=`#version 300 es
  precision mediump float;
  
  in vec2 shapeVertexPosition;

	uniform vec4 canvasPageBounds;

	// taken (with thanks) from
	// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html
  void main() {
		// convert the position from pixels to 0.0 to 1.0
		vec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;
	
		// convert from 0->1 to 0->2
		vec2 zeroToTwo = zeroToOne * 2.0;
	
		// convert from 0->2 to -1->+1 (clipspace)
		vec2 clipSpace = zeroToTwo - 1.0;
	
		gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
  }`,n=e.createShader(e.VERTEX_SHADER);if(!n)throw new Error("Failed to create vertex shader");if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error("Failed to compile vertex shader");const s=`#version 300 es
  precision mediump float;
  
	uniform vec4 fillColor;
  out vec4 outputColor;

  void main() {
	outputColor = fillColor;
  }`,o=e.createShader(e.FRAGMENT_SHADER);if(!o)throw new Error("Failed to create fragment shader");if(e.shaderSource(o,s),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS))throw new Error("Failed to compile fragment shader");const i=e.createProgram();if(!i)throw new Error("Failed to create program");if(e.attachShader(i,n),e.attachShader(i,o),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS))throw new Error("Failed to link program");e.useProgram(i);const a=e.getAttribLocation(i,"shapeVertexPosition");if(a<0)throw new Error("Failed to get shapeVertexPosition attribute location");e.enableVertexAttribArray(a);const l=e.getUniformLocation(i,"canvasPageBounds"),c=e.getUniformLocation(i,"fillColor");if(!e.createBuffer())throw new Error("Failed to create buffer");if(!e.createBuffer())throw new Error("Failed to create buffer");return{context:e,selectedShapes:Uy(e,1024),unselectedShapes:Uy(e,4096),viewport:Uy(e,S$),collaborators:Uy(e,1024),prepareTriangles(f,m){e.bindBuffer(e.ARRAY_BUFFER,f.buffer),e.bufferData(e.ARRAY_BUFFER,f.vertices,e.STATIC_DRAW,0,m),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0)},drawTrianglesTransparently(f){e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLES,0,f/2),e.disable(e.BLEND)},drawTriangles(f){e.drawArrays(e.TRIANGLES,0,f/2)},setFillColor(f){e.uniform4fv(c,f)},setCanvasPageBounds(f){e.uniform4fv(l,f)}}}function Uy(r,e){const t=r.createBuffer();if(!t)throw new Error("Failed to create buffer");return{buffer:t,vertices:new Float32Array(e)}}function QD(r,e,t){let n=r.vertices.length;for(;n<e+t.length;)n*=2;if(n!=r.vertices.length){const s=new Float32Array(n);s.set(r.vertices),r.vertices=s}r.vertices.set(t,e)}var Zde=Object.create,x$=Object.defineProperty,Jde=Object.getOwnPropertyDescriptor,Qde=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),w$=r=>{throw TypeError(r)},C$=(r,e,t)=>e in r?x$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,eue=r=>[,,,Zde(null)],E$=["class","method","getter","setter","accessor","field","value","get","set"],k$=r=>r!==void 0&&typeof r!="function"?w$("Function expected"):r,tue=(r,e,t,n,s)=>({kind:E$[r],name:e,metadata:n,addInitializer:o=>t._?w$("Already initialized"):s.push(k$(o||null))}),nue=(r,e)=>C$(e,Qde("metadata"),r[3]),rue=(r,e,t,n)=>{for(var s=0,o=r[e>>1],i=o&&o.length;s<i;s++)o[s].call(t);return n},vl=(r,e,t,n,s,o)=>{for(var i,a,l,c,u=e&7,p=!!(e&8),f=!!(e&16),m=2,v=E$[u+5],b=r[m]||(r[m]=[]),S=(s=s.prototype,Jde(s,t)),C=n.length-1;C>=0;C--)l=tue(u,t,a={},r[3],b),l.static=p,l.private=f,c=l.access={has:E=>t in E},c.get=E=>E[t],i=(0,n[C])(S[v],l),a._=1,k$(i)&&(S[v]=i);return S&&x$(s,t,S),s},jl=(r,e,t)=>C$(r,typeof e!="symbol"?e+"":e,t),P$,I$,_$,T$,M$,A$,j$,R$,D$,O$,mi;O$=[Bo],D$=[Ie],R$=[Ie],j$=[Ie],A$=[Ie],M$=[Ie],T$=[Ie],_$=[Ie],I$=[Ie],P$=[Bo];class Ui{constructor(e,t,n){this.editor=e,this.elem=t,this.container=n,rue(mi,5,this),jl(this,"disposables",[]),jl(this,"gl"),jl(this,"shapeGeometryCache"),jl(this,"colors"),jl(this,"id",Cn()),jl(this,"canvasBoundingClientRect",$r("canvasBoundingClientRect",new Ve)),jl(this,"originPagePoint",new P),jl(this,"originPageCenter",new P),jl(this,"isInViewport",!1),this.gl=Xde(t),this.shapeGeometryCache=e.store.createComputedCache("webgl-geometry",s=>{const o=e.getShapeMaskedPageBounds(s.id);if(!o)return null;const i=new Float32Array(12);return ph(i,0,o.x,o.y,o.w,o.h),i}),this.colors=this._getColors(),this.disposables.push(this._listenForCanvasResize(),nl("minimap render",this.render))}close(){return this.disposables.forEach(e=>e())}_getColors(){const e=getComputedStyle(this.editor.getContainer());return{shapeFill:af(e.getPropertyValue("--color-text-3").trim()),selectFill:af(e.getPropertyValue("--color-selected").trim()),viewportFill:af(e.getPropertyValue("--color-muted-1").trim()),background:af(e.getPropertyValue("--color-low").trim())}}updateColors(){this.colors=this._getColors()}getDpr(){return this.editor.getInstanceState().devicePixelRatio}getContentPageBounds(){const e=this.editor.getViewportPageBounds(),t=this.editor.getCurrentPageBounds();return t?Ve.Expand(t,e):e}getContentScreenBounds(){const e=this.getContentPageBounds(),t=this.editor.pageToScreen(e.point),n=this.editor.pageToScreen(new P(e.maxX,e.maxY));return new Ve(t.x,t.y,n.x-t.x,n.y-t.y)}_getCanvasBoundingRect(){const{x:e,y:t,width:n,height:s}=this.elem.getBoundingClientRect();return new Ve(e,t,n,s)}getCanvasScreenBounds(){return this.canvasBoundingClientRect.get()}_listenForCanvasResize(){const e=new ResizeObserver(()=>{const t=this._getCanvasBoundingRect();this.canvasBoundingClientRect.set(t)});return e.observe(this.elem),e.observe(this.container),()=>e.disconnect()}getCanvasSize(){const e=this.canvasBoundingClientRect.get(),t=this.getDpr();return new P(e.width*t,e.height*t)}getCanvasClientPosition(){return this.canvasBoundingClientRect.get().point}getCanvasPageBounds(){const e=this.getCanvasScreenBounds(),t=this.getContentPageBounds(),n=e.width/e.height;let s=t.width,o=s/n;o<t.height&&(o=t.height,s=o*n);const i=new Ve(0,0,s,o);return i.center=t.center,i}getZoom(){return this.getCanvasPageBounds().width/this.getCanvasScreenBounds().width}getCanvasPageBoundsArray(){const{x:e,y:t,w:n,h:s}=this.getCanvasPageBounds();return new Float32Array([e,t,n,s])}getMinimapPagePoint(e,t){const n=this.getCanvasPageBounds(),s=this.getCanvasScreenBounds();let o=e-s.x,i=t-s.y;return o*=n.width/s.width,i*=n.height/s.height,o+=n.minX,i+=n.minY,new P(o,i,1)}minimapScreenPointToPagePoint(e,t,n=!1,s=!1){const{editor:o}=this,i=o.getViewportPageBounds();let{x:a,y:l}=this.getMinimapPagePoint(e,t);if(s){const c=this.editor.getCurrentPageBounds()??new Ve,u=c.minX-i.width/2,p=c.maxX+i.width/2,f=c.minY-i.height/2,m=c.maxY+i.height/2,v=Math.max(0,u+i.width-a),b=Math.max(0,-(p-i.width-a)),S=Math.max(0,f+i.height-l),C=Math.max(0,-(m-i.height-l));a+=(v-b)/2,l+=(S-C)/2,a=ps(a,u,p),l=ps(l,f,m)}if(n){const{originPagePoint:c}=this,u=Math.abs(a-c.x),p=Math.abs(l-c.y);u>p?l=c.y:a=c.x}return new P(a,l)}render(){const e=this.gl.context,t=this.getCanvasSize();this.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray()),this.elem.width=t.x,this.elem.height=t.y,e.viewport(0,0,t.x,t.y),e.clearColor(this.colors.background[0],this.colors.background[1],this.colors.background[2],1),e.clear(e.COLOR_BUFFER_BIT);const n=new Set(this.editor.getSelectedShapeIds()),s=this.colors;let o=0,i=0;const a=this.editor.getCurrentPageShapeIdsSorted();for(let l=0,c=a.length;l<c;l++){const u=a[l],p=this.shapeGeometryCache.get(u);if(!p)continue;const f=p.length;n.has(u)?(QD(this.gl.selectedShapes,o,p),o+=f):(QD(this.gl.unselectedShapes,i,p),i+=f)}this.drawShapes(this.gl.unselectedShapes,i,s.shapeFill),this.drawShapes(this.gl.selectedShapes,o,s.selectFill),this.drawViewport(),this.drawCollaborators()}drawShapes(e,t,n){this.gl.prepareTriangles(e,t),this.gl.setFillColor(n),this.gl.drawTriangles(t)}drawViewport(){const e=this.editor.getViewportPageBounds(),t=Yde(this.gl.viewport.vertices,e,4*this.getZoom());this.gl.prepareTriangles(this.gl.viewport,t),this.gl.setFillColor(this.colors.viewportFill),this.gl.drawTrianglesTransparently(t),Rn.isSafari&&(this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t))}drawCollaborators(){const e=this.editor.getCollaboratorsOnCurrentPage();if(!e.length)return;const t=20,n=t*6,s=n*e.length;this.gl.collaborators.vertices.length<s&&(this.gl.collaborators.vertices=new Float32Array(s));const o=this.gl.collaborators.vertices;let i=0;const a=this.getZoom();for(const{cursor:l}of e)l&&(hh(o,{center:P.From(l),radius:3*a,offset:i,numArcSegments:t}),i+=n);this.gl.prepareTriangles(this.gl.collaborators,s),i=0;for(const{color:l}of e)this.gl.setFillColor(af(l)),this.gl.context.drawArrays(this.gl.context.TRIANGLES,i/2,n/2),i+=n}}mi=eue();vl(mi,1,"close",O$,Ui);vl(mi,1,"getDpr",D$,Ui);vl(mi,1,"getContentPageBounds",R$,Ui);vl(mi,1,"getContentScreenBounds",j$,Ui);vl(mi,1,"getCanvasSize",A$,Ui);vl(mi,1,"getCanvasClientPosition",M$,Ui);vl(mi,1,"getCanvasPageBounds",T$,Ui);vl(mi,1,"getZoom",_$,Ui);vl(mi,1,"getCanvasPageBoundsArray",I$,Ui);vl(mi,1,"render",P$,Ui);nue(mi,Ui);function sue(){const r=ue(),e=Kr(),t=I.useRef(null),n=I.useRef(!1),s=I.useRef();I.useEffect(()=>{try{const u=new Ui(r,t.current,e);return s.current=u,s.current.close}catch(u){r.annotateError(u,{origin:"minimap",willCrashApp:!1}),r.timers.setTimeout(()=>{throw u})}},[r,e]);const o=I.useCallback(u=>{if(!r.getCurrentPageShapeIds().size||!s.current)return;const p=s.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!1),f=s.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!0);s.current.originPagePoint.setTo(f),s.current.originPageCenter.setTo(r.getViewportPageBounds().center),r.centerOnPoint(p,{animation:{duration:r.options.animationMediumMs}})},[r]),i=I.useCallback(u=>{if(!s.current)return;const p=u.currentTarget;if(zg(p,u),!r.getCurrentPageShapeIds().size)return;n.current=!0,s.current.isInViewport=!1;const f=s.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!1),m=r.getViewportPageBounds(),v=s.current.getContentPageBounds();if(new Ve(v.x-m.width/2,v.y-m.height/2,v.width+m.width,v.height+m.height).containsPoint(f)&&!m.containsPoint(f)){s.current.isInViewport=m.containsPoint(f);const C=P.Sub(m.center,m.point),E=P.Add(f,C);s.current.originPagePoint.setTo(E),s.current.originPageCenter.setTo(f),r.centerOnPoint(f,{animation:{duration:r.options.animationMediumMs}})}else{const C=s.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!0);s.current.isInViewport=m.containsPoint(C),s.current.originPagePoint.setTo(C),s.current.originPageCenter.setTo(m.center)}function S(C){p&&$g(p,C),n.current=!1,document.body.removeEventListener("pointerup",S)}document.body.addEventListener("pointerup",S)},[r]),a=I.useCallback(u=>{if(!s.current)return;const p=s.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,u.shiftKey,!0);if(n.current){if(s.current.isInViewport){const b=s.current.originPagePoint.clone().sub(s.current.originPageCenter);r.centerOnPoint(P.Sub(p,b));return}r.centerOnPoint(p)}const f=s.current.getMinimapPagePoint(u.clientX,u.clientY),m=r.pageToScreen(f),v={type:"pointer",target:"canvas",name:"pointer_move",...si(u),point:m,isPen:r.getInstanceState().isPenMode};r.dispatch(v)},[r]),l=I.useCallback(u=>{const p=K5(u);r.dispatch({type:"wheel",name:"wheel",delta:p,point:new P(u.clientX,u.clientY),shiftKey:u.shiftKey,altKey:u.altKey,ctrlKey:u.metaKey||u.ctrlKey,metaKey:u.metaKey,accelKey:Gs(u)})},[r]),c=qg();return I.useEffect(()=>{r.timers.setTimeout(()=>{var u,p;(u=s.current)==null||u.updateColors(),(p=s.current)==null||p.render()})},[c,r]),g.jsx("div",{className:"tlui-minimap",children:g.jsx("canvas",{role:"img","aria-label":"minimap",ref:t,className:"tlui-minimap__canvas",onDoubleClick:o,onPointerMove:a,onPointerDown:i,onWheelCapture:l})})}function oue(r,e){const[t,n]=Ht.useState(e);Ht.useLayoutEffect(()=>{const o=Bk(r);if(o)try{n(JSON.parse(o))}catch{console.error(`Could not restore value ${r} from local storage.`)}},[r]);const s=Ht.useCallback(o=>{n(i=>{const a=typeof o=="function"?o(i):o;return Uk(r,JSON.stringify(a)),a})},[r]);return[t,s]}const iue=I.memo(function(){const e=Iu(),t=Wt(),n=po(),s=I.useRef(null);md(s);const[o,i]=oue("minimap",!0),a=I.useCallback(()=>{i(u=>!u)},[i]),{ZoomMenu:l,Minimap:c}=Sd();return n<yr.MOBILE?null:g.jsxs("div",{ref:s,className:"tlui-navigation-panel",children:[g.jsx("div",{className:"tlui-buttons__horizontal",children:l&&n<yr.TABLET?g.jsx(l,{}):o?g.jsxs(g.Fragment,{children:[l&&g.jsx(l,{}),c&&g.jsx(ut,{type:"icon","data-testid":"minimap.toggle-button",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:a,children:g.jsx($t,{icon:o?"chevrons-ne":"chevrons-sw"})})]}):g.jsxs(g.Fragment,{children:[g.jsx(ut,{type:"icon","data-testid":"minimap.zoom-out",title:`${t(Yf(e["zoom-out"].label))} ${qE(e["zoom-out"].kbd)}`,onClick:()=>e["zoom-out"].onSelect("navigation-zone"),children:g.jsx($t,{icon:"minus"})}),l&&g.jsx(l,{}),g.jsx(ut,{type:"icon","data-testid":"minimap.zoom-in",title:`${t(Yf(e["zoom-in"].label))} ${qE(e["zoom-in"].kbd)}`,onClick:()=>e["zoom-in"].onSelect("navigation-zone"),children:g.jsx($t,{icon:"plus"})}),c&&g.jsx(ut,{type:"icon","data-testid":"minimap.toggle-button",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:a,children:g.jsx($t,{icon:o?"chevrons-ne":"chevrons-sw"})})]})}),c&&n>=yr.TABLET&&!o&&g.jsx(c,{})]})}),aue=function({name:e,id:t,isCurrentPage:n,onCancel:s}){const o=ue(),i=ws(),a=I.useRef(null),l=I.useRef(null),c=I.useCallback(()=>{l.current=o.markHistoryStoppingPoint("rename page")},[o]),u=I.useCallback(f=>{o.renamePage(t,f||"New Page"),i("rename-page",{source:"page-menu"})},[o,t,i]),p=I.useCallback(()=>{l.current&&o.bailToMark(l.current),s()},[o,s]);return g.jsx(jb,{className:"tlui-page-menu__item__input",ref:f=>a.current=f,defaultValue:e,onValueChange:u,onCancel:p,onFocus:c,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:n,autoSelect:!0})},mk=(r,e,t,n,s)=>{let o;const i=r.getPages(),a=t>n?i[n-1]:i[n],l=t>n?i[n]:i[n+1];a&&!l?o=Za(a.index):!a&&l?o=QH(i[0].index):o=zf(a.index,l.index),o!==i[t].index&&(r.markHistoryStoppingPoint("moving page"),r.updatePage({id:e,index:o}),s("move-page",{source:"page-menu"}))},eO=Ss(function({index:e,listSize:t,item:n,onRename:s}){const o=ue(),i=Wt(),a=o.getPages(),l=ws(),c=I.useCallback(()=>{o.markHistoryStoppingPoint("creating page");const m=ui.createId();o.duplicatePage(n.id,m),l("duplicate-page",{source:"page-menu"})},[o,n,l]),u=I.useCallback(()=>{mk(o,n.id,e,e-1,l)},[o,n,e,l]),p=I.useCallback(()=>{mk(o,n.id,e,e+1,l)},[o,n,e,l]),f=I.useCallback(()=>{o.markHistoryStoppingPoint("deleting page"),o.deletePage(n.id),l("delete-page",{source:"page-menu"})},[o,n,l]);return g.jsxs(gu,{id:`page item submenu ${e}`,children:[g.jsx(mu,{children:g.jsx(ut,{type:"icon",title:i("page-menu.submenu.title"),children:g.jsx($t,{icon:"dots-vertical",small:!0})})}),g.jsx(yu,{alignOffset:0,side:"right",sideOffset:-4,children:g.jsxs(zi,{type:"menu",sourceId:"page-menu",children:[g.jsxs(_t,{id:"modify",children:[s&&g.jsx(Wr,{id:"rename",label:"page-menu.submenu.rename",onSelect:s}),g.jsx(Wr,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:c,disabled:a.length>=o.options.maxPages}),e>0&&g.jsx(Wr,{id:"move-up",onSelect:u,label:"page-menu.submenu.move-up"}),e<t-1&&g.jsx(Wr,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:p})]}),t>1&&g.jsx(_t,{id:"delete",children:g.jsx(Wr,{id:"delete",onSelect:f,label:"page-menu.submenu.delete"})})]})})]})}),lue=I.memo(function(){const e=ue(),t=ws(),n=Wt(),s=po(),o=I.useCallback(()=>C(!1),[]),[i,a]=oc("page-menu",o),l=36,c=I.useRef(null),u=ye("pages",()=>e.getPages(),[e]),p=ye("currentPage",()=>e.getCurrentPage(),[e]),f=ye("currentPageId",()=>e.getCurrentPageId(),[e]),m=gi(),v=ye("maxPageCountReached",()=>e.getPages().length>=e.options.maxPages,[e]),b=ye("isCoarsePointer",()=>e.getInstanceState().isCoarsePointer,[e]),[S,C]=I.useState(!1),E=I.useCallback(()=>{m||C(O=>!O)},[m]),T=I.useRef({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[w,M]=I.useState(Object.fromEntries(u.map((O,U)=>[O.id,{y:U*l,offsetY:0,isSelected:!1}])));I.useLayoutEffect(()=>{M(Object.fromEntries(u.map((O,U)=>[O.id,{y:U*l,offsetY:0,isSelected:!1}])))},[l,u]),I.useEffect(()=>{i&&e.timers.requestAnimationFrame(()=>{const O=document.querySelector(`[data-testid="page-menu-item-${f}"]`);if(O){const U=c.current;if(!U)return;const X=O.offsetTop,H=U.scrollTop;X<H&&U.scrollTo({top:X});const ee=X+l,J=U.scrollTop+U.offsetHeight;ee>J&&U.scrollTo({top:ee-U.offsetHeight})}})},[l,f,i,e]);const R=I.useCallback(O=>{const{clientY:U,currentTarget:X}=O,{dataset:{id:H,index:ee}}=X;if(!H||!ee)return;const J=T.current;zg(O.currentTarget,O),J.status="pointing",J.pointing={id:H,index:+ee};const ae=w[H].y;J.startY=U,J.startIndex=Math.max(0,Math.min(Math.round(ae/l),u.length-1))},[l,u.length,w]),D=I.useCallback(O=>{const U=T.current;if(U.status==="pointing"){const{clientY:X}=O,H=X-U.startY;Math.abs(H)>5&&(U.status="dragging")}if(U.status==="dragging"){const{clientY:X}=O,H=X-U.startY,ee=w[U.pointing.id],{startIndex:J,pointing:ne}=U,ae=ee.y+H,q=Math.max(0,Math.min(Math.round(ae/l),u.length-1)),se={...w};if(se[ne.id]={y:ee.y,offsetY:H,isSelected:!0},q!==U.dragIndex){U.dragIndex=q;for(let xe=0;xe<u.length;xe++){const Oe=u[xe];if(Oe.id===U.pointing.id)continue;let{y:Ee}=se[Oe.id];q===J?Ee=xe*l:q<J?q<=xe&&xe<J?Ee=(xe+1)*l:Ee=xe*l:q>J&&(q>=xe&&xe>J?Ee=(xe-1)*l:Ee=xe*l),Ee!==se[Oe.id].y&&(se[Oe.id]={y:Ee,offsetY:0,isSelected:!0})}}M(se)}},[l,u,w]),N=I.useCallback(O=>{const U=T.current;if(U.status==="dragging"){const{id:X,index:H}=U.pointing;mk(e,X,H,U.dragIndex,t)}$g(O.currentTarget,O),U.status="idle"},[e,t]),z=I.useCallback(O=>{const U=T.current;O.key==="Escape"&&(U.status==="dragging"&&M(Object.fromEntries(u.map((X,H)=>[X.id,{y:H*l,offsetY:0,isSelected:!1}]))),U.status="idle")},[l,u]),L=I.useCallback(()=>{m||(e.run(()=>{e.markHistoryStoppingPoint("creating page");const O=ui.createId();e.createPage({name:n("page-menu.new-page-initial-name"),id:O}),e.setCurrentPage(O),C(!0)}),t("new-page",{source:"page-menu"}))},[e,n,m,t]),B=I.useCallback(O=>{e.setCurrentPage(O),t("change-page",{source:"page-menu"})},[e,t]),K=I.useCallback((O,U)=>{e.renamePage(O,U),t("rename-page",{source:"page-menu"})},[e,t]);return g.jsxs(ZP,{id:"pages",onOpenChange:a,open:i,children:[g.jsx(JP,{"data-testid":"main.page-menu",children:g.jsxs(ut,{type:"menu",title:p.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[g.jsx("div",{className:"tlui-page-menu__name",children:p.name}),g.jsx($t,{icon:"chevron-down",small:!0})]})}),g.jsx(QP,{side:"bottom",align:"start",sideOffset:6,disableEscapeKeyDown:S,children:g.jsxs("div",{className:"tlui-page-menu__wrapper",children:[g.jsxs("div",{className:"tlui-page-menu__header",children:[g.jsx("div",{className:"tlui-page-menu__header__title",children:n("page-menu.title")}),!m&&g.jsxs("div",{className:"tlui-buttons__horizontal",children:[g.jsx(ut,{type:"icon","data-testid":"page-menu.edit",title:n(S?"page-menu.edit-done":"page-menu.edit-start"),onClick:E,children:g.jsx($t,{icon:S?"check":"edit"})}),g.jsx(ut,{type:"icon","data-testid":"page-menu.create",title:n(v?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:v,onClick:L,children:g.jsx($t,{icon:"plus"})})]})]}),g.jsx("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:l*u.length+4},ref:c,children:u.map((O,U)=>{const X=w[O.id]??{position:U*40,offsetY:0};return S?g.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page_menu__item__sortable",style:{zIndex:O.id===p.id?888:U,transform:`translate(0px, ${X.y+X.offsetY}px)`},children:[g.jsx(ut,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:R,onPointerUp:N,onPointerMove:D,onKeyDown:z,"data-id":O.id,"data-index":U,children:g.jsx($t,{icon:"drag-handle-dots"})}),s<yr.TABLET_SM&&b?g.jsxs(ut,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const H=window.prompt("Rename page",O.name);H&&H!==O.name&&K(O.id,H)},onDoubleClick:E,children:[g.jsx(gk,{checked:O.id===p.id}),g.jsx(Tr,{children:O.name})]}):g.jsx("div",{className:"tlui-page_menu__item__sortable__title",style:{height:l},children:g.jsx(aue,{id:O.id,name:O.name,isCurrentPage:O.id===p.id,onCancel:()=>{C(!1),e.menus.clearOpenMenus()}})}),!m&&g.jsx("div",{className:"tlui-page_menu__item__submenu","data-isediting":S,children:g.jsx(eO,{index:U,item:O,listSize:u.length})})]},O.id+"_editing"):g.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[g.jsxs(ut,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>B(O.id),onDoubleClick:E,title:n("page-menu.go-to-page"),children:[g.jsx(gk,{checked:O.id===p.id}),g.jsx(Tr,{children:O.name})]}),!m&&g.jsx("div",{className:"tlui-page_menu__item__submenu",children:g.jsx(eO,{index:U,item:O,listSize:u.length,onRename:()=>{if(Rn.isIos){const H=window.prompt("Rename page",O.name);H&&H!==O.name&&K(O.id,H)}else C(!0),f!==O.id&&B(O.id)}})})]},O.id)})})]})})]})});function cue(){const r=ue(),e=gi(),t=ye("should display quick actions",()=>r.isInAny("select","hand","zoom"),[r]);if(!(e&&!t))return g.jsxs(g.Fragment,{children:[g.jsx(uue,{}),g.jsx(due,{})]})}function due(){const r=fo(1),e=ic(),t=r&&e;return g.jsxs(g.Fragment,{children:[g.jsx(Pe,{actionId:"delete",disabled:!t}),g.jsx(Pe,{actionId:"duplicate",disabled:!t})]})}function uue(){const r=Zz(),e=Xz();return g.jsxs(g.Fragment,{children:[g.jsx(Pe,{actionId:"undo",disabled:!r}),g.jsx(Pe,{actionId:"redo",disabled:!e})]})}const hue=I.memo(function({children:e}){const t=e??g.jsx(cue,{});return g.jsx(zi,{type:"small-icons",sourceId:"quick-actions",children:t})});function pue({userId:r}){const e=eb(r);return e?g.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:e.color},children:e.userName==="New User"?"":e.userName[0]??""},r):null}const fue=Ss(function({userId:e}){const t=ue(),n=Wt(),s=ws(),o=eb(e),i=I.useCallback(()=>{t.getInstanceState().followingUserId===e?(t.stopFollowingUser(),s("stop-following",{source:"people-menu"})):(t.startFollowingUser(e),s("start-following",{source:"people-menu"}))},[t,e,s]),a=(o==null?void 0:o.followingUserId)===t.user.getId(),l=t.getInstanceState().followingUserId===e;return o?g.jsxs("div",{className:"tlui-people-menu__item tlui-buttons__horizontal",children:[g.jsxs(ut,{type:"menu",className:"tlui-people-menu__item__button",onClick:()=>t.zoomToUser(e),onDoubleClick:i,children:[g.jsx(hl,{icon:"color",color:o.color}),g.jsx("div",{className:"tlui-people-menu__name",children:o.userName??"New User"})]}),g.jsx(ut,{type:"icon",className:"tlui-people-menu__item__follow",title:n(a?"people-menu.leading":l?"people-menu.following":"people-menu.follow"),onClick:i,disabled:a,"data-active":l||a,children:g.jsx($t,{icon:a?"leading":l?"following":"follow"})})]}):null});function gue({count:r}){return g.jsx("div",{className:"tlui-people-menu__more",children:"+"+Math.abs(r)})}const mue=Ss(function(){const e=ue(),t=Kr(),n=Wt(),s=ws(),o=I.useRef(!1),[i,a]=I.useState(!1),l=I.useCallback(b=>{a(b)},[]),c=e.user.getColor(),u=I.useCallback(b=>{e.user.updateUserPreferences({color:b}),s("set-color",{source:"people-menu"})},[e,s]),{handleButtonClick:p,handleButtonPointerDown:f,handleButtonPointerEnter:m,handleButtonPointerUp:v}=Ht.useMemo(()=>{const b=()=>{o.current=!1,window.removeEventListener("pointerup",b)};return{handleButtonClick:w=>{const{id:M}=w.currentTarget.dataset;M&&c!==M&&u(M)},handleButtonPointerDown:w=>{const{id:M}=w.currentTarget.dataset;M&&(u(M),o.current=!0,window.addEventListener("pointerup",b))},handleButtonPointerEnter:w=>{if(!o.current)return;const{id:M}=w.currentTarget.dataset;M&&u(M)},handleButtonPointerUp:w=>{const{id:M}=w.currentTarget.dataset;M&&u(M)}}},[c,u]);return g.jsxs(VP,{onOpenChange:l,open:i,children:[g.jsx(qP,{dir:"ltr",asChild:!0,children:g.jsx(ut,{type:"icon",className:"tlui-people-menu__user__color",style:{color:e.user.getColor()},title:n("people-menu.change-color"),children:g.jsx($t,{icon:"color"})})}),g.jsx(YP,{container:t,children:g.jsx(XP,{dir:"ltr",className:"tlui-menu tlui-people-menu__user__color-picker",align:"start",side:"left",sideOffset:8,children:g.jsx("div",{className:"tlui-buttons__grid",children:wE.map(b=>g.jsx(ut,{type:"icon","data-id":b,"data-testid":b,"aria-label":b,"data-state":c===b?"hinted":void 0,title:b,className:"tlui-button-grid__button",style:{color:b},onPointerEnter:m,onPointerDown:f,onPointerUp:v,onClick:p,children:g.jsx($t,{icon:"color"})},b))})})})]})});function yue(){const r=ue(),e=ws(),t=ye("userName",()=>r.user.getName(),[]),n=Wt(),s=I.useRef(t),o=I.useRef(t),[i,a]=I.useState(!1),l=I.useCallback(()=>{a(f=>!f)},[]),c=I.useCallback(f=>{o.current=f,r.user.updateUserPreferences({name:f})},[r]),u=I.useCallback(()=>{s.current!==o.current&&(e("change-user-name",{source:"people-menu"}),s.current=o.current)},[e]),p=I.useCallback(()=>{a(!1),r.user.updateUserPreferences({name:s.current}),r.menus.clearOpenMenus()},[r]);return g.jsxs("div",{className:"tlui-people-menu__user",children:[g.jsx(mue,{}),i?g.jsx(jb,{className:"tlui-people-menu__user__input",defaultValue:t,onValueChange:c,onComplete:l,onCancel:p,onBlur:u,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:!0,autoSelect:!0}):g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"tlui-people-menu__user__name",onDoubleClick:()=>{i||a(!0)},children:t}),t==="New User"?g.jsx("div",{className:"tlui-people-menu__user__label",children:n("people-menu.user")}):null]}),g.jsx(ut,{type:"icon",className:"tlui-people-menu__user__edit","data-testid":"people-menu.change-name",title:n("people-menu.change-name"),onClick:l,children:g.jsx($t,{icon:i?"check":"edit"})})]})}function vue({displayUserWhenAlone:r,children:e}){const t=Wt(),n=Kr(),s=ue(),o=Y5(),i=ye("user",()=>s.user.getColor(),[s]),a=ye("user",()=>s.user.getName(),[s]),[l,c]=oc("people menu");return g.jsxs(VP,{onOpenChange:c,open:l,children:[g.jsx(qP,{dir:"ltr",asChild:!0,children:g.jsxs("button",{className:"tlui-people-menu__avatars-button",title:t("people-menu.title"),children:[o.length>5&&g.jsx(gue,{count:o.length-5}),g.jsxs("div",{className:"tlui-people-menu__avatars",children:[o.slice(-5).map(u=>g.jsx(pue,{userId:u},u)),(r||o.length>0)&&g.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:i},children:a==="New User"?"":a[0]??""})]})]})}),g.jsx(YP,{container:n,children:g.jsx(XP,{dir:"ltr",className:"tlui-menu",side:"bottom",sideOffset:2,collisionPadding:4,onEscapeKeyDown:Ot,children:g.jsxs("div",{className:"tlui-people-menu__wrapper",children:[g.jsx("div",{className:"tlui-people-menu__section",children:g.jsx(yue,{})}),o.length>0&&g.jsx("div",{className:"tlui-people-menu__section",children:o.map(u=>g.jsx(fue,{userId:u},u+"_presence"))}),e]})})})]})}function bue(){return g.jsx("div",{className:"tlui-share-zone",draggable:!1,children:g.jsx(vue,{displayUserWhenAlone:!0})})}const Sue=Object.freeze([di,cu,du,cl]);function L$(r=Sue){const e=ue();return ye("getRelevantStyles",()=>{var o;const t=new _E(e.getSharedStyles()),n=!!((o=e.root.getCurrent())!=null&&o.shapeType),s=e.isIn("select")&&e.getSelectedShapeIds().length>0;if(t.size===0&&e.isIn("select")&&e.getSelectedShapeIds().length===0)for(const i of r)t.applyValue(i,e.getStyleForNextShape(i));return n||s||t.size>0?t:null},[e])}const Oi={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],textAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],horizontalAlign:[{value:"start",icon:"horizontal-align-start"},{value:"middle",icon:"horizontal-align-middle"},{value:"end",icon:"horizontal-align-end"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-middle"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"star",icon:"geo-star"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"cloud",icon:"geo-cloud"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"},{value:"heart",icon:"geo-heart"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},Gd=I.memo(function(e){const{uiType:t,items:n,title:s,style:o,value:i,onValueChange:a,onHistoryMark:l,theme:c}=e,u=Wt(),p=I.useRef(!1),f=I.useRef(null),{handleButtonClick:m,handleButtonPointerDown:v,handleButtonPointerEnter:b,handleButtonPointerUp:S}=I.useMemo(()=>{const C=()=>{p.current=!1,window.removeEventListener("pointerup",C);const R=f.current;R&&["TEXTAREA","INPUT"].includes(R.nodeName)&&R.focus(),f.current=null};return{handleButtonClick:R=>{const{id:D}=R.currentTarget.dataset;i.type==="shared"&&i.value===D||(l==null||l("point picker item"),a(o,D))},handleButtonPointerDown:R=>{const{id:D}=R.currentTarget.dataset;l==null||l("point picker item"),a(o,D),p.current=!0,f.current=document.activeElement,window.addEventListener("pointerup",C)},handleButtonPointerEnter:R=>{if(!p.current)return;const{id:D}=R.currentTarget.dataset;a(o,D)},handleButtonPointerUp:R=>{const{id:D}=R.currentTarget.dataset;i.type==="shared"&&i.value===D||a(o,D)}}},[i,l,a,o]);return g.jsx("div",{"data-testid":`style.${t}`,className:it("tlui-buttons__grid"),children:n.map(C=>g.jsx(ut,{type:"icon","data-id":C.value,"data-testid":`style.${t}.${C.value}`,"aria-label":C.value,"data-state":i.type==="shared"&&i.value===C.value?"hinted":void 0,title:s+" — "+u(`${t}-style.${C.value}`),className:it("tlui-button-grid__button"),style:o===di?{color:c[C.value].solid}:void 0,onPointerEnter:b,onPointerDown:v,onPointerUp:S,onClick:m,children:g.jsx($t,{icon:C.icon})},C.value))})});function N$(r,[e,t]){return Math.min(t,Math.max(e,r))}function xue(r){const e=I.useRef({value:r,previous:r});return I.useMemo(()=>(e.current.value!==r&&(e.current.previous=e.current.value,e.current.value=r),e.current.previous),[r])}var F$=["PageUp","PageDown"],z$=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],$$={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},fp="Slider",[yk,wue,Cue]=yb(fp),[B$,sme]=ku(fp,[Cue]),[Eue,Kb]=B$(fp),U$=I.forwardRef((r,e)=>{const{name:t,min:n=0,max:s=100,step:o=1,orientation:i="horizontal",disabled:a=!1,minStepsBetweenThumbs:l=0,defaultValue:c=[n],value:u,onValueChange:p=()=>{},onValueCommit:f=()=>{},inverted:m=!1,form:v,...b}=r,S=I.useRef(new Set),C=I.useRef(0),T=i==="horizontal"?kue:Pue,[w=[],M]=yd({prop:u,defaultProp:c,onChange:B=>{var O;(O=[...S.current][C.current])==null||O.focus(),p(B)}}),R=I.useRef(w);function D(B){const K=Aue(w,B);L(B,K)}function N(B){L(B,C.current)}function z(){const B=R.current[C.current];w[C.current]!==B&&f(w)}function L(B,K,{commit:O}={commit:!1}){const U=Oue(o),X=Lue(Math.round((B-n)/o)*o+n,U),H=N$(X,[n,s]);M((ee=[])=>{const J=Tue(ee,H,K);if(Due(J,l*o)){C.current=J.indexOf(H);const ne=String(J)!==String(ee);return ne&&O&&f(J),ne?J:ee}else return ee})}return g.jsx(Eue,{scope:r.__scopeSlider,name:t,disabled:a,min:n,max:s,valueIndexToChangeRef:C,thumbs:S.current,values:w,orientation:i,form:v,children:g.jsx(yk.Provider,{scope:r.__scopeSlider,children:g.jsx(yk.Slot,{scope:r.__scopeSlider,children:g.jsx(T,{"aria-disabled":a,"data-disabled":a?"":void 0,...b,ref:e,onPointerDown:Qe(b.onPointerDown,()=>{a||(R.current=w)}),min:n,max:s,inverted:m,onSlideStart:a?void 0:D,onSlideMove:a?void 0:N,onSlideEnd:a?void 0:z,onHomeKeyDown:()=>!a&&L(n,0,{commit:!0}),onEndKeyDown:()=>!a&&L(s,w.length-1,{commit:!0}),onStepKeyDown:({event:B,direction:K})=>{if(!a){const X=F$.includes(B.key)||B.shiftKey&&z$.includes(B.key)?10:1,H=C.current,ee=w[H],J=o*X*K;L(ee+J,H,{commit:!0})}}})})})})});U$.displayName=fp;var[H$,G$]=B$(fp,{startEdge:"left",endEdge:"right",size:"width",direction:1}),kue=I.forwardRef((r,e)=>{const{min:t,max:n,dir:s,inverted:o,onSlideStart:i,onSlideMove:a,onSlideEnd:l,onStepKeyDown:c,...u}=r,[p,f]=I.useState(null),m=Un(e,T=>f(T)),v=I.useRef(),b=G2(s),S=b==="ltr",C=S&&!o||!S&&o;function E(T){const w=v.current||p.getBoundingClientRect(),M=[0,w.width],D=tI(M,C?[t,n]:[n,t]);return v.current=w,D(T-w.left)}return g.jsx(H$,{scope:r.__scopeSlider,startEdge:C?"left":"right",endEdge:C?"right":"left",direction:C?1:-1,size:"width",children:g.jsx(W$,{dir:b,"data-orientation":"horizontal",...u,ref:m,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:T=>{const w=E(T.clientX);i==null||i(w)},onSlideMove:T=>{const w=E(T.clientX);a==null||a(w)},onSlideEnd:()=>{v.current=void 0,l==null||l()},onStepKeyDown:T=>{const M=$$[C?"from-left":"from-right"].includes(T.key);c==null||c({event:T,direction:M?-1:1})}})})}),Pue=I.forwardRef((r,e)=>{const{min:t,max:n,inverted:s,onSlideStart:o,onSlideMove:i,onSlideEnd:a,onStepKeyDown:l,...c}=r,u=I.useRef(null),p=Un(e,u),f=I.useRef(),m=!s;function v(b){const S=f.current||u.current.getBoundingClientRect(),C=[0,S.height],T=tI(C,m?[n,t]:[t,n]);return f.current=S,T(b-S.top)}return g.jsx(H$,{scope:r.__scopeSlider,startEdge:m?"bottom":"top",endEdge:m?"top":"bottom",size:"height",direction:m?1:-1,children:g.jsx(W$,{"data-orientation":"vertical",...c,ref:p,style:{...c.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:b=>{const S=v(b.clientY);o==null||o(S)},onSlideMove:b=>{const S=v(b.clientY);i==null||i(S)},onSlideEnd:()=>{f.current=void 0,a==null||a()},onStepKeyDown:b=>{const C=$$[m?"from-bottom":"from-top"].includes(b.key);l==null||l({event:b,direction:C?-1:1})}})})}),W$=I.forwardRef((r,e)=>{const{__scopeSlider:t,onSlideStart:n,onSlideMove:s,onSlideEnd:o,onHomeKeyDown:i,onEndKeyDown:a,onStepKeyDown:l,...c}=r,u=Kb(fp,t);return g.jsx(rn.span,{...c,ref:e,onKeyDown:Qe(r.onKeyDown,p=>{p.key==="Home"?(i(p),p.preventDefault()):p.key==="End"?(a(p),p.preventDefault()):F$.concat(z$).includes(p.key)&&(l(p),p.preventDefault())}),onPointerDown:Qe(r.onPointerDown,p=>{const f=p.target;f.setPointerCapture(p.pointerId),p.preventDefault(),u.thumbs.has(f)?f.focus():n(p)}),onPointerMove:Qe(r.onPointerMove,p=>{p.target.hasPointerCapture(p.pointerId)&&s(p)}),onPointerUp:Qe(r.onPointerUp,p=>{const f=p.target;f.hasPointerCapture(p.pointerId)&&(f.releasePointerCapture(p.pointerId),o(p))})})}),K$="SliderTrack",V$=I.forwardRef((r,e)=>{const{__scopeSlider:t,...n}=r,s=Kb(K$,t);return g.jsx(rn.span,{"data-disabled":s.disabled?"":void 0,"data-orientation":s.orientation,...n,ref:e})});V$.displayName=K$;var vk="SliderRange",q$=I.forwardRef((r,e)=>{const{__scopeSlider:t,...n}=r,s=Kb(vk,t),o=G$(vk,t),i=I.useRef(null),a=Un(e,i),l=s.values.length,c=s.values.map(f=>X$(f,s.min,s.max)),u=l>1?Math.min(...c):0,p=100-Math.max(...c);return g.jsx(rn.span,{"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,...n,ref:a,style:{...r.style,[o.startEdge]:u+"%",[o.endEdge]:p+"%"}})});q$.displayName=vk;var bk="SliderThumb",Y$=I.forwardRef((r,e)=>{const t=wue(r.__scopeSlider),[n,s]=I.useState(null),o=Un(e,a=>s(a)),i=I.useMemo(()=>n?t().findIndex(a=>a.ref.current===n):-1,[t,n]);return g.jsx(Iue,{...r,ref:o,index:i})}),Iue=I.forwardRef((r,e)=>{const{__scopeSlider:t,index:n,name:s,...o}=r,i=Kb(bk,t),a=G$(bk,t),[l,c]=I.useState(null),u=Un(e,E=>c(E)),p=l?i.form||!!l.closest("form"):!0,f=z8(l),m=i.values[n],v=m===void 0?0:X$(m,i.min,i.max),b=Mue(n,i.values.length),S=f==null?void 0:f[a.size],C=S?jue(S,v,a.direction):0;return I.useEffect(()=>{if(l)return i.thumbs.add(l),()=>{i.thumbs.delete(l)}},[l,i.thumbs]),g.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${v}% + ${C}px)`},children:[g.jsx(yk.ItemSlot,{scope:r.__scopeSlider,children:g.jsx(rn.span,{role:"slider","aria-label":r["aria-label"]||b,"aria-valuemin":i.min,"aria-valuenow":m,"aria-valuemax":i.max,"aria-orientation":i.orientation,"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,tabIndex:i.disabled?void 0:0,...o,ref:u,style:m===void 0?{display:"none"}:r.style,onFocus:Qe(r.onFocus,()=>{i.valueIndexToChangeRef.current=n})})}),p&&g.jsx(_ue,{name:s??(i.name?i.name+(i.values.length>1?"[]":""):void 0),form:i.form,value:m},n)]})});Y$.displayName=bk;var _ue=r=>{const{value:e,...t}=r,n=I.useRef(null),s=xue(e);return I.useEffect(()=>{const o=n.current,i=window.HTMLInputElement.prototype,l=Object.getOwnPropertyDescriptor(i,"value").set;if(s!==e&&l){const c=new Event("input",{bubbles:!0});l.call(o,e),o.dispatchEvent(c)}},[s,e]),g.jsx("input",{style:{display:"none"},...t,ref:n,defaultValue:e})};function Tue(r=[],e,t){const n=[...r];return n[t]=e,n.sort((s,o)=>s-o)}function X$(r,e,t){const o=100/(t-e)*(r-e);return N$(o,[0,100])}function Mue(r,e){return e>2?`Value ${r+1} of ${e}`:e===2?["Minimum","Maximum"][r]:void 0}function Aue(r,e){if(r.length===1)return 0;const t=r.map(s=>Math.abs(s-e)),n=Math.min(...t);return t.indexOf(n)}function jue(r,e,t){const n=r/2,o=tI([0,50],[0,n]);return(n-o(e)*t)*t}function Rue(r){return r.slice(0,-1).map((e,t)=>r[t+1]-e)}function Due(r,e){if(e>0){const t=Rue(r);return Math.min(...t)>=e}return!0}function tI(r,e){return t=>{if(r[0]===r[1]||e[0]===e[1])return e[0];const n=(e[1]-e[0])/(r[1]-r[0]);return e[0]+n*(t-r[0])}}function Oue(r){return(String(r).split(".")[1]||"").length}function Lue(r,e){const t=Math.pow(10,e);return Math.round(r*t)/t}var Nue=U$,Fue=V$,zue=q$,$ue=Y$;const Bue=I.memo(function({onHistoryMark:e,title:t,steps:n,value:s,label:o,onValueChange:i,["data-testid"]:a}){const l=Wt(),c=I.useCallback(f=>{i(f[0])},[i]),u=I.useCallback(()=>{e("click slider")},[e]),p=I.useCallback(()=>{s&&i(s)},[s,i]);return g.jsx("div",{className:"tlui-slider__container",children:g.jsxs(Nue,{"data-testid":a,className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:n,step:1,value:s?[s]:void 0,onPointerDown:u,onValueChange:c,onPointerUp:p,title:t+" — "+l(o),children:[g.jsx(Fue,{className:"tlui-slider__track",dir:"ltr",children:s!==null&&g.jsx(zue,{className:"tlui-slider__range",dir:"ltr"})}),s!==null&&g.jsx($ue,{className:"tlui-slider__thumb",dir:"ltr"})]})})});function Uue({label:r,uiTypeA:e,uiTypeB:t,labelA:n,labelB:s,itemsA:o,itemsB:i,styleA:a,styleB:l,valueA:c,valueB:u,onValueChange:p}){const f=Wt(),m=I.useMemo(()=>{var b;return((b=o.find(S=>c.type==="shared"&&c.value===S.value))==null?void 0:b.icon)??"mixed"},[o,c]),v=I.useMemo(()=>{var b;return((b=i.find(S=>u.type==="shared"&&u.value===S.value))==null?void 0:b.icon)??"mixed"},[i,u]);return c===void 0&&u===void 0?null:g.jsxs("div",{className:"tlui-style-panel__double-select-picker",children:[g.jsx("div",{title:f(r),className:"tlui-style-panel__double-select-picker-label",children:f(r)}),g.jsxs("div",{className:"tlui-buttons__horizontal",children:[g.jsxs(gu,{id:`style panel ${e} A`,children:[g.jsx(mu,{children:g.jsx(ut,{type:"icon","data-testid":`style.${e}`,title:f(n)+" — "+(c===null||c.type==="mixed"?f("style-panel.mixed"):f(`${e}-style.${c.value}`)),children:g.jsx($t,{icon:m,small:!0,invertIcon:!0})})}),g.jsx(yu,{side:"left",align:"center",sideOffset:80,alignOffset:0,children:g.jsx("div",{className:"tlui-buttons__grid",children:o.map((b,S)=>g.jsx(Xf,{"data-testid":`style.${e}.${b.value}`,children:g.jsx(ut,{type:"icon",onClick:()=>p(a,b.value),title:`${f(n)} — ${f(`${e}-style.${b.value}`)}`,children:g.jsx($t,{icon:b.icon,invertIcon:!0})},b.value)},S))})})]}),g.jsxs(gu,{id:`style panel ${t}`,children:[g.jsx(mu,{children:g.jsx(ut,{type:"icon","data-testid":`style.${t}`,title:f(s)+" — "+(u===null||u.type==="mixed"?f("style-panel.mixed"):f(`${t}-style.${u.value}`)),children:g.jsx($t,{icon:v,small:!0})})}),g.jsx(yu,{side:"left",align:"center",sideOffset:116,alignOffset:0,children:g.jsx("div",{className:"tlui-buttons__grid",children:i.map(b=>g.jsx(Xf,{children:g.jsx(ut,{type:"icon",title:`${f(s)} — ${f(`${t}-style.${b.value}`)}`,"data-testid":`style.${t}.${b.value}`,onClick:()=>p(l,b.value),children:g.jsx($t,{icon:b.icon})})},b.value))})})]})]})]})}const Hue=I.memo(Uue);function Gue({id:r,label:e,uiType:t,stylePanelType:n,style:s,items:o,type:i,value:a,onValueChange:l}){const c=Wt(),u=ue(),p=I.useMemo(()=>{var b;return(b=o.find(S=>a.type==="shared"&&S.value===a.value))==null?void 0:b.icon},[o,a]),f=c(`style-panel.${n}`),m=a.type==="mixed"?c("style-panel.mixed"):f+" — "+c(`${t}-style.${a.value}`),v=e?c(e):"";return g.jsxs(gu,{id:`style panel ${r}`,children:[g.jsx(mu,{children:g.jsxs(ut,{type:i,"data-testid":`style.${t}`,title:m,children:[v&&g.jsx(Tr,{children:v}),g.jsx($t,{icon:p??"mixed"})]})}),g.jsx(yu,{side:"left",align:"center",alignOffset:0,children:g.jsx("div",{className:"tlui-buttons__grid",children:o.map(b=>g.jsx(Xf,{children:g.jsx(ut,{type:"icon","data-testid":`style.${t}.${b.value}`,title:f+" — "+c(`${t}-style.${b.value}`),onClick:()=>{u.markHistoryStoppingPoint("select style dropdown item"),l(s,b.value)},children:g.jsx($t,{icon:b.icon})})},b.value))})})]})}const nI=I.memo(Gue);function Wue({styles:r}){const e=qg();if(!r)return null;const t=r.get(ca),n=r.get(Kv),s=r.get(Wv),o=r.get(Xv),i=r.get(ll),a=t===void 0,l=n===void 0&&s===void 0,c=o===void 0,u=i===void 0,p=rc({isDarkMode:e});return g.jsxs(g.Fragment,{children:[g.jsx(Kue,{theme:p,styles:r}),!u&&g.jsx(Vue,{theme:p,styles:r}),!(a&&l&&c)&&g.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[g.jsx(que,{styles:r}),g.jsx(Xue,{styles:r}),g.jsx(Yue,{styles:r})]})]})}function rm(){const r=ue(),e=ws();return Ht.useMemo(()=>function(n,s){r.run(()=>{r.isIn("select")&&r.setStyleForSelectedShapes(n,s),r.setStyleForNextShapes(n,s),r.updateInstanceState({isChangingStyle:!0})}),e("set-style",{source:"style-panel",id:n.id,value:s})},[r,e])}function Kue({styles:r,theme:e}){const t=Wt(),n=ue(),s=I.useCallback(p=>n.markHistoryStoppingPoint(p),[n]),o=rm(),i=r.get(di),a=r.get(du),l=r.get(cu),c=r.get(cl),u=a!==void 0||l!==void 0||c!==void 0;return g.jsxs(g.Fragment,{children:[g.jsxs("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles","data-testid":"style.panel",children:[i===void 0?null:g.jsx(Gd,{title:t("style-panel.color"),uiType:"color",style:di,items:Oi.color,value:i,onValueChange:o,theme:e,onHistoryMark:s}),g.jsx(Zue,{})]}),u&&g.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[a===void 0?null:g.jsx(Gd,{title:t("style-panel.fill"),uiType:"fill",style:du,items:Oi.fill,value:a,onValueChange:o,theme:e,onHistoryMark:s}),l===void 0?null:g.jsx(Gd,{title:t("style-panel.dash"),uiType:"dash",style:cu,items:Oi.dash,value:l,onValueChange:o,theme:e,onHistoryMark:s}),c===void 0?null:g.jsx(Gd,{title:t("style-panel.size"),uiType:"size",style:cl,items:Oi.size,value:c,onValueChange:(p,f)=>{o(p,f);const m=n.getSelectedShapeIds();m.length>0&&zn(n,m)},theme:e,onHistoryMark:s})]})]})}function Vue({theme:r,styles:e}){const t=Wt(),n=rm(),s=ue(),o=I.useCallback(u=>s.markHistoryStoppingPoint(u),[s]),i=e.get(ll),a=e.get(yE),l=e.get(qv),c=e.get(Yv);return i===void 0&&l===void 0?null:g.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[i===void 0?null:g.jsx(Gd,{title:t("style-panel.font"),uiType:"font",style:ll,items:Oi.font,value:i,onValueChange:n,theme:r,onHistoryMark:o}),a===void 0?null:g.jsxs("div",{className:"tlui-style-panel__row",children:[g.jsx(Gd,{title:t("style-panel.align"),uiType:"align",style:yE,items:Oi.textAlign,value:a,onValueChange:n,theme:r,onHistoryMark:o}),g.jsx("div",{className:"tlui-style-panel__row__extra-button",children:g.jsx(ut,{type:"icon",title:t("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:g.jsx($t,{icon:"vertical-align-middle"})})})]}),l===void 0?null:g.jsxs("div",{className:"tlui-style-panel__row",children:[g.jsx(Gd,{title:t("style-panel.label-align"),uiType:"align",style:qv,items:Oi.horizontalAlign,value:l,onValueChange:n,theme:r,onHistoryMark:o}),g.jsx("div",{className:"tlui-style-panel__row__extra-button",children:c===void 0?g.jsx(ut,{type:"icon",title:t("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:g.jsx($t,{icon:"vertical-align-middle"})}):g.jsx(nI,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",stylePanelType:"vertical-align",style:Yv,items:Oi.verticalAlign,value:c,onValueChange:n})})]})]})}function que({styles:r}){const e=rm(),t=r.get(ca);return t===void 0?null:g.jsx(nI,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",stylePanelType:"geo",style:ca,items:Oi.geo,value:t,onValueChange:e})}function Yue({styles:r}){const e=rm(),t=r.get(Xv);return t===void 0?null:g.jsx(nI,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",stylePanelType:"spline",style:Xv,items:Oi.spline,value:t,onValueChange:e})}function Xue({styles:r}){const e=rm(),t=r.get(Kv),n=r.get(Wv);return!t||!n?null:g.jsx(Hue,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:Wv,itemsA:Oi.arrowheadStart,valueA:n,uiTypeB:"arrowheadEnd",styleB:Kv,itemsB:Oi.arrowheadEnd,valueB:t,onValueChange:e,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}const lf=[.1,.25,.5,.75,1];function Zue(){const r=ue(),e=I.useCallback(a=>r.markHistoryStoppingPoint(a),[r]),t=ye("opacity",()=>r.getSharedOpacity(),[r]),n=ws(),s=Wt(),o=Ht.useCallback(a=>{const l=lf[a];r.run(()=>{r.isIn("select")&&r.setOpacityForSelectedShapes(l),r.setOpacityForNextShapes(l),r.updateInstanceState({isChangingStyle:!0})}),n("set-style",{source:"style-panel",id:"opacity",value:a})},[r,n]);if(t===void 0)return null;const i=t.type==="mixed"?-1:lf.indexOf(wH(lf,a=>Math.abs(a-t.value)));return g.jsx(Bue,{"data-testid":"style.opacity",value:i>=0?i:lf.length-1,label:t.type==="mixed"?"style-panel.mixed":`opacity-style.${t.value}`,onValueChange:o,steps:lf.length-1,title:s("style-panel.opacity"),onHistoryMark:e})}const Jue=I.memo(function({isMobile:e,children:t}){const n=ue(),s=I.useRef(null);md(s);const o=L$(),i=I.useCallback(()=>{e||n.updateInstanceState({isChangingStyle:!1})},[n,e]),a=t??g.jsx(Wue,{styles:o});return g.jsx("div",{ref:s,className:it("tlui-style-panel",{"tlui-style-panel__wrapper":!e}),"data-ismobile":e,onPointerLeave:i,children:a})});function Que(){const r=ue(),e=Wt(),t=L$(),n=t==null?void 0:t.get(di),s=rc({isDarkMode:r.user.getIsDarkMode()}),o=((n==null?void 0:n.type)==="shared"?s[n.value]:s.black).solid,i=ye("disable style panel",()=>r.isInAny("hand","zoom","eraser","laser"),[r]),a=I.useCallback(c=>{c||r.updateInstanceState({isChangingStyle:!1})},[r]),{StylePanel:l}=Sd();return l?g.jsxs(ZP,{id:"mobile style menu",onOpenChange:a,children:[g.jsx(JP,{children:g.jsx(ut,{type:"tool","data-testid":"mobile-styles.button",style:{color:i?"var(--color-muted-1)":o},title:e("style-panel.title"),disabled:i,children:g.jsx($t,{icon:i?"blob":(n==null?void 0:n.type)==="mixed"?"mixed":"blob"})})}),g.jsx(QP,{side:"top",align:"end",children:l&&g.jsx(l,{isMobile:!0})})]}):null}function ehe(){return g.jsxs(g.Fragment,{children:[g.jsx(nhe,{}),g.jsx(rhe,{}),g.jsx(she,{}),g.jsx(ohe,{}),g.jsx(ihe,{}),g.jsx(ahe,{}),g.jsx(lhe,{}),g.jsx(che,{}),g.jsx(dhe,{}),g.jsx(uhe,{}),g.jsx(phe,{}),g.jsx(hhe,{}),g.jsx(mhe,{}),g.jsx(bhe,{}),g.jsx(fhe,{}),g.jsx(vhe,{}),g.jsx(yhe,{}),g.jsx(ghe,{}),g.jsx(She,{}),g.jsx(xhe,{}),g.jsx(whe,{}),g.jsx(Che,{}),g.jsx(Ehe,{}),g.jsx(khe,{}),g.jsx(Phe,{}),g.jsx(Ihe,{}),g.jsx(The,{}),g.jsx(_he,{})]})}function the(r){var n;const e=ue(),t=(n=r.meta)==null?void 0:n.geo;return ye("is tool selected",()=>{const s=e.getCurrentToolId(),o=e.getSharedStyles().getAsKnownValue(ca);return t?s==="geo"&&o===t:s===r.id},[e,r.id,t])}function Dn({tool:r}){const e=jP(),t=the(e[r]);return g.jsx(Io,{toolId:r,isSelected:t})}function nhe(){return g.jsx(Dn,{tool:"select"})}function rhe(){return g.jsx(Dn,{tool:"hand"})}function she(){return g.jsx(Dn,{tool:"draw"})}function ohe(){return g.jsx(Dn,{tool:"eraser"})}function ihe(){return g.jsx(Dn,{tool:"arrow"})}function ahe(){return g.jsx(Dn,{tool:"text"})}function lhe(){return g.jsx(Dn,{tool:"note"})}function che(){return g.jsx(Io,{toolId:"asset"})}function dhe(){return g.jsx(Dn,{tool:"rectangle"})}function uhe(){return g.jsx(Dn,{tool:"ellipse"})}function hhe(){return g.jsx(Dn,{tool:"diamond"})}function phe(){return g.jsx(Dn,{tool:"triangle"})}function fhe(){return g.jsx(Dn,{tool:"rhombus"})}function ghe(){return g.jsx(Dn,{tool:"heart"})}function mhe(){return g.jsx(Dn,{tool:"hexagon"})}function yhe(){return g.jsx(Dn,{tool:"cloud"})}function vhe(){return g.jsx(Dn,{tool:"star"})}function bhe(){return g.jsx(Dn,{tool:"oval"})}function She(){return g.jsx(Dn,{tool:"x-box"})}function xhe(){return g.jsx(Dn,{tool:"check-box"})}function whe(){return g.jsx(Dn,{tool:"arrow-left"})}function Che(){return g.jsx(Dn,{tool:"arrow-up"})}function Ehe(){return g.jsx(Dn,{tool:"arrow-down"})}function khe(){return g.jsx(Dn,{tool:"arrow-right"})}function Phe(){return g.jsx(Dn,{tool:"line"})}function Ihe(){return g.jsx(Dn,{tool:"highlight"})}function _he(){return g.jsx(Dn,{tool:"frame"})}function The(){return g.jsx(Dn,{tool:"laser"})}const AC=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function jC(r,e,t,n){r.addEventListener?r.addEventListener(e,t,n):r.attachEvent&&r.attachEvent("on".concat(e),t)}function cf(r,e,t,n){r.removeEventListener?r.removeEventListener(e,t,n):r.detachEvent&&r.detachEvent("on".concat(e),t)}function Z$(r,e){const t=e.slice(0,e.length-1);for(let n=0;n<t.length;n++)t[n]=r[t[n].toLowerCase()];return t}function J$(r){typeof r!="string"&&(r=""),r=r.replace(/\s/g,"");const e=r.split(",");let t=e.lastIndexOf("");for(;t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}function Mhe(r,e){const t=r.length>=e.length?r:e,n=r.length>=e.length?e:r;let s=!0;for(let o=0;o<t.length;o++)n.indexOf(t[o])===-1&&(s=!1);return s}const Zf={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":AC?173:189,"=":AC?61:187,";":AC?59:186,"'":222,"[":219,"]":221,"\\":220},fl={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},Sk={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},fs={16:!1,18:!1,17:!1,91:!1},cr={};for(let r=1;r<20;r++)Zf["f".concat(r)]=111+r;let $n=[],Rf=null,Q$="all";const Ll=new Map,sm=r=>Zf[r.toLowerCase()]||fl[r.toLowerCase()]||r.toUpperCase().charCodeAt(0),Ahe=r=>Object.keys(Zf).find(e=>Zf[e]===r),jhe=r=>Object.keys(fl).find(e=>fl[e]===r);function e7(r){Q$=r||"all"}function Jf(){return Q$||"all"}function Rhe(){return $n.slice(0)}function Dhe(){return $n.map(r=>Ahe(r)||jhe(r)||String.fromCharCode(r))}function Ohe(){const r=[];return Object.keys(cr).forEach(e=>{cr[e].forEach(t=>{let{key:n,scope:s,mods:o,shortcut:i}=t;r.push({scope:s,shortcut:i,mods:o,keys:n.split("+").map(a=>sm(a))})})}),r}function Lhe(r){const e=r.target||r.srcElement,{tagName:t}=e;let n=!0;const s=t==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(s||t==="TEXTAREA"||t==="SELECT")&&!e.readOnly)&&(n=!1),n}function Nhe(r){return typeof r=="string"&&(r=sm(r)),$n.indexOf(r)!==-1}function Fhe(r,e){let t,n;r||(r=Jf());for(const s in cr)if(Object.prototype.hasOwnProperty.call(cr,s))for(t=cr[s],n=0;n<t.length;)t[n].scope===r?t.splice(n,1).forEach(i=>{let{element:a}=i;return rI(a)}):n++;Jf()===r&&e7(e||"all")}function zhe(r){let e=r.keyCode||r.which||r.charCode;const t=$n.indexOf(e);if(t>=0&&$n.splice(t,1),r.key&&r.key.toLowerCase()==="meta"&&$n.splice(0,$n.length),(e===93||e===224)&&(e=91),e in fs){fs[e]=!1;for(const n in fl)fl[n]===e&&(Uo[n]=!1)}}function t7(r){if(typeof r>"u")Object.keys(cr).forEach(s=>{Array.isArray(cr[s])&&cr[s].forEach(o=>Hy(o)),delete cr[s]}),rI(null);else if(Array.isArray(r))r.forEach(s=>{s.key&&Hy(s)});else if(typeof r=="object")r.key&&Hy(r);else if(typeof r=="string"){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];let[s,o]=t;typeof s=="function"&&(o=s,s=""),Hy({key:r,scope:s,method:o,splitKey:"+"})}}const Hy=r=>{let{key:e,scope:t,method:n,splitKey:s="+"}=r;J$(e).forEach(i=>{const a=i.split(s),l=a.length,c=a[l-1],u=c==="*"?"*":sm(c);if(!cr[u])return;t||(t=Jf());const p=l>1?Z$(fl,a):[],f=[];cr[u]=cr[u].filter(m=>{const b=(n?m.method===n:!0)&&m.scope===t&&Mhe(m.mods,p);return b&&f.push(m.element),!b}),f.forEach(m=>rI(m))})};function tO(r,e,t,n){if(e.element!==n)return;let s;if(e.scope===t||e.scope==="all"){s=e.mods.length>0;for(const o in fs)Object.prototype.hasOwnProperty.call(fs,o)&&(!fs[o]&&e.mods.indexOf(+o)>-1||fs[o]&&e.mods.indexOf(+o)===-1)&&(s=!1);(e.mods.length===0&&!fs[16]&&!fs[18]&&!fs[17]&&!fs[91]||s||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat($n),e.method(r,e)===!1&&(r.preventDefault?r.preventDefault():r.returnValue=!1,r.stopPropagation&&r.stopPropagation(),r.cancelBubble&&(r.cancelBubble=!0)))}}function nO(r,e){const t=cr["*"];let n=r.keyCode||r.which||r.charCode;if(!Uo.filter.call(this,r))return;if((n===93||n===224)&&(n=91),$n.indexOf(n)===-1&&n!==229&&$n.push(n),["ctrlKey","altKey","shiftKey","metaKey"].forEach(a=>{const l=Sk[a];r[a]&&$n.indexOf(l)===-1?$n.push(l):!r[a]&&$n.indexOf(l)>-1?$n.splice($n.indexOf(l),1):a==="metaKey"&&r[a]&&$n.length===3&&(r.ctrlKey||r.shiftKey||r.altKey||($n=$n.slice($n.indexOf(l))))}),n in fs){fs[n]=!0;for(const a in fl)fl[a]===n&&(Uo[a]=!0);if(!t)return}for(const a in fs)Object.prototype.hasOwnProperty.call(fs,a)&&(fs[a]=r[Sk[a]]);r.getModifierState&&!(r.altKey&&!r.ctrlKey)&&r.getModifierState("AltGraph")&&($n.indexOf(17)===-1&&$n.push(17),$n.indexOf(18)===-1&&$n.push(18),fs[17]=!0,fs[18]=!0);const s=Jf();if(t)for(let a=0;a<t.length;a++)t[a].scope===s&&(r.type==="keydown"&&t[a].keydown||r.type==="keyup"&&t[a].keyup)&&tO(r,t[a],s,e);if(!(n in cr))return;const o=cr[n],i=o.length;for(let a=0;a<i;a++)if((r.type==="keydown"&&o[a].keydown||r.type==="keyup"&&o[a].keyup)&&o[a].key){const l=o[a],{splitKey:c}=l,u=l.key.split(c),p=[];for(let f=0;f<u.length;f++)p.push(sm(u[f]));p.sort().join("")===$n.sort().join("")&&tO(r,l,s,e)}}function Uo(r,e,t){$n=[];const n=J$(r);let s=[],o="all",i=document,a=0,l=!1,c=!0,u="+",p=!1,f=!1;for(t===void 0&&typeof e=="function"&&(t=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(o=e.scope),e.element&&(i=e.element),e.keyup&&(l=e.keyup),e.keydown!==void 0&&(c=e.keydown),e.capture!==void 0&&(p=e.capture),typeof e.splitKey=="string"&&(u=e.splitKey),e.single===!0&&(f=!0)),typeof e=="string"&&(o=e),f&&t7(r,o);a<n.length;a++)r=n[a].split(u),s=[],r.length>1&&(s=Z$(fl,r)),r=r[r.length-1],r=r==="*"?"*":sm(r),r in cr||(cr[r]=[]),cr[r].push({keyup:l,keydown:c,scope:o,mods:s,shortcut:n[a],method:t,key:n[a],splitKey:u,element:i});if(typeof i<"u"&&window){if(!Ll.has(i)){const m=function(){let b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return nO(b,i)},v=function(){let b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;nO(b,i),zhe(b)};Ll.set(i,{keydownListener:m,keyupListenr:v,capture:p}),jC(i,"keydown",m,p),jC(i,"keyup",v,p)}if(!Rf){const m=()=>{$n=[]};Rf={listener:m,capture:p},jC(window,"focus",m,p)}}}function $he(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(cr).forEach(t=>{cr[t].filter(s=>s.scope===e&&s.shortcut===r).forEach(s=>{s&&s.method&&s.method()})})}function rI(r){const e=Object.values(cr).flat();if(e.findIndex(n=>{let{element:s}=n;return s===r})<0){const{keydownListener:n,keyupListenr:s,capture:o}=Ll.get(r)||{};n&&s&&(cf(r,"keyup",s,o),cf(r,"keydown",n,o),Ll.delete(r))}if((e.length<=0||Ll.size<=0)&&(Object.keys(Ll).forEach(s=>{const{keydownListener:o,keyupListenr:i,capture:a}=Ll.get(s)||{};o&&i&&(cf(s,"keyup",i,a),cf(s,"keydown",o,a),Ll.delete(s))}),Ll.clear(),Object.keys(cr).forEach(s=>delete cr[s]),Rf)){const{listener:s,capture:o}=Rf;cf(window,"focus",s,o),Rf=null}}const RC={getPressedKeyString:Dhe,setScope:e7,getScope:Jf,deleteScope:Fhe,getPressedKeyCodes:Rhe,getAllKeyCodes:Ohe,isPressed:Nhe,filter:Lhe,trigger:$he,unbind:t7,keyMap:Zf,modifier:fl,modifierMap:Sk};for(const r in RC)Object.prototype.hasOwnProperty.call(RC,r)&&(Uo[r]=RC[r]);if(typeof window<"u"){const r=window.hotkeys;Uo.noConflict=e=>(e&&window.hotkeys===Uo&&(window.hotkeys=r),Uo),window.hotkeys=Uo}const rO=["copy","cut","paste","asset"];function Bhe(){const r=ue(),e=gi(),t=Iu(),n=jP(),s=ye("is focused",()=>r.getInstanceState().isFocused,[r]);I.useEffect(()=>{if(!s)return;const o=new Array,i=(l,c)=>{Uo(l,{element:document.body},c),o.push(()=>{Uo.unbind(l,c)})},a=(l,c)=>{Uo(l,{element:document.body,keyup:!0,keydown:!1},c),o.push(()=>{Uo.unbind(l,c)})};for(const l of Object.values(t))l.kbd&&(e&&!l.readonlyOk||rO.includes(l.id)||i(sO(l.kbd),c=>{xf(r)||(Ot(c),l.onSelect("kbd"))}));for(const l of Object.values(n))!l.kbd||!l.readonlyOk&&r.getIsReadonly()||rO.includes(l.id)||i(sO(l.kbd),c=>{xf(r)||(Ot(c),l.onSelect("kbd"))});return i(",",l=>{if(xf(r)||r.inputs.keys.has("Comma"))return;Ot(l),r.focus(),r.inputs.keys.add("Comma");const{x:c,y:u,z:p}=r.inputs.currentPagePoint,f=r.pageToScreen({x:c,y:u}),m={type:"pointer",name:"pointer_down",point:{x:f.x,y:f.y,z:p},shiftKey:l.shiftKey,altKey:l.altKey,ctrlKey:l.metaKey||l.ctrlKey,metaKey:l.metaKey,accelKey:Gs(l),pointerId:0,button:0,isPen:r.getInstanceState().isPenMode,target:"canvas"};r.dispatch(m)}),a(",",l=>{if(xf(r)||!r.inputs.keys.has("Comma"))return;r.inputs.keys.delete("Comma");const{x:c,y:u,z:p}=r.inputs.currentScreenPoint,f={type:"pointer",name:"pointer_up",point:{x:c,y:u,z:p},shiftKey:l.shiftKey,altKey:l.altKey,ctrlKey:l.metaKey||l.ctrlKey,metaKey:l.metaKey,accelKey:Gs(l),pointerId:0,button:0,isPen:r.getInstanceState().isPenMode,target:"canvas"};r.dispatch(f)}),()=>{o.forEach(l=>l())}},[t,n,e,r,s])}function sO(r){return Uhe(r).map(e=>{let t="";const n=e.split("");return n.length===1?t=n[0]:n[0]==="!"?t=`shift+${n[1]}`:n[0]==="?"?n.length===3&&n[1]==="!"?t=`alt+shift+${n[2]}`:t=`alt+${n[1]}`:n[0]==="$"?n[1]==="!"?t=`cmd+shift+${n[2]},ctrl+shift+${n[2]}`:n[1]==="?"?t=`cmd+⌥+${n[2]},ctrl+alt+${n[2]}`:t=`cmd+${n[1]},ctrl+${n[1]}`:t=e,t}).join(",")}function Uhe(r){typeof r!="string"&&(r=""),r=r.replace(/\s/g,"");const e=r.split(",");let t=e.lastIndexOf("");for(;t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}function xf(r){return r.menus.hasAnyOpenMenus()||r.getEditingShapeId()!==null||r.getCrashingError()}const Hhe=I.createContext(!1);function Ghe({children:r}){const e=ue(),t=sp(),n=po(),s=Wt(),o=Math.min(8,5+n),[i,a]=I.useState(0),l=I.useRef(null),[c,u]=I.useState(null),p=I.useMemo(()=>{const m=c?`:not([data-value="${c}"])`:"";return`
			#${t}_main > *:nth-child(n + ${o+(c?1:2)})${m} {
				display: none;
			}
			#${t}_more > *:nth-child(-n + ${o}) {
				display: none;
			}
        `},[c,t,o]),f=ab(()=>{if(!l.current)return;const m=Array.from(l.current.children);a(m.length),m.findIndex(S=>S.getAttribute("data-value")===c)<=o&&u(null);const b=Array.from(l.current.children).findIndex(S=>S.getAttribute("aria-checked")==="true");b!==-1&&b>=o&&u(m[b].getAttribute("data-value"))});return I.useLayoutEffect(()=>{f()}),I.useLayoutEffect(()=>{if(!l.current)return;const m=new MutationObserver(f);return m.observe(l.current,{childList:!0,subtree:!0,attributeFilter:["data-value","aria-checked"]}),()=>{m.disconnect()}},[f]),I.useEffect(()=>{const m=[["1",0],["2",1],["3",2],["4",3],["5",4],["6",5],["7",6],["8",7],["9",8],["0",9]];for(const[v,b]of m)Uo(v,S=>{var T;if(xf(e))return;Ot(S);const E=Array.from(((T=l.current)==null?void 0:T.children)??[]).filter(w=>!(w instanceof HTMLElement)||w.tagName.toLowerCase()!=="button"?!1:!!(w.offsetWidth||w.offsetHeight))[b];E&&E.click()});return()=>{Uo.unbind("1,2,3,4,5,6,7,8,9,0")}},[e]),g.jsxs(g.Fragment,{children:[g.jsx("style",{children:p}),g.jsxs("div",{className:it("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":n<yr.TABLET_SM}),role:"radiogroup",children:[g.jsx("div",{id:`${t}_main`,ref:l,className:"tlui-toolbar__tools__list",children:g.jsx(zi,{type:"toolbar",sourceId:"toolbar",children:r})}),i>o+1&&g.jsx(Hhe.Provider,{value:!0,children:g.jsxs(gu,{id:"toolbar overflow",modal:!1,children:[g.jsx(mu,{children:g.jsx(ut,{title:s("tool-panel.more"),type:"tool",className:"tlui-toolbar__overflow","data-testid":"tools.more-button",children:g.jsx($t,{icon:"chevron-up"})})}),g.jsx(yu,{side:"top",align:"center",children:g.jsx("div",{className:"tlui-buttons__grid","data-testid":"tools.more-content",id:`${t}_more`,children:g.jsx(zi,{type:"toolbar-overflow",sourceId:"toolbar",children:r})})})]})})]})]})}function Whe({activeToolId:r}){const e=ue(),t=po(),n=Wt(),s=ye("is tool locked",()=>e.getInstanceState().isToolLocked,[e]),o=ye("current tool",()=>e.getCurrentTool(),[e]);return!r||!o.isLockable?null:g.jsx(ut,{type:"normal",title:n("action.toggle-tool-lock"),"data-testid":"tool-lock",className:it("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":t<yr.TABLET_SM}),onClick:()=>e.updateInstanceState({isToolLocked:!s}),children:g.jsx($t,{icon:s?"lock":"unlock",small:!0})})}const Khe=I.memo(function({children:e}){const t=ue(),n=po(),s=gi(),o=ye("current tool id",()=>t.getCurrentToolId(),[t]),i=I.useRef(null);md(i);const{ActionsMenu:a,QuickActions:l}=Sd(),c=t.options.actionShortcutsLocation==="menu"?!1:t.options.actionShortcutsLocation==="toolbar"?!0:n<yr.TABLET;return g.jsx("div",{ref:i,className:"tlui-toolbar",children:g.jsxs("div",{className:"tlui-toolbar__inner",children:[g.jsxs("div",{className:"tlui-toolbar__left",children:[!s&&g.jsxs("div",{className:"tlui-toolbar__extras",children:[c&&g.jsxs("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[l&&g.jsx(l,{}),a&&g.jsx(a,{})]}),g.jsx(Whe,{activeToolId:o})]}),g.jsx(Ghe,{children:e??g.jsx(ehe,{})})]}),n<yr.TABLET_SM&&!s&&g.jsx("div",{className:"tlui-toolbar__tools",children:g.jsx(Que,{})})]})})});function Vhe(){const r=Wt();return g.jsxs("div",{className:it("tlui-offline-indicator"),children:[r("status.offline"),g.jsx(hl,{"aria-label":"offline",icon:"status-offline",small:!0})]})}function qhe({maxWidth:r=420,ignoreRightWidth:e=0,stylePanelWidth:t=148,marginBetweenZones:n=12,squeezeAmount:s=52,children:o}){const i=I.useRef(null),a=po(),l=I.useCallback(()=>{const c=i.current;if(!c)return;const u=c.parentElement.parentElement,p=u.querySelector(".tlui-layout__top__left"),f=u.querySelector(".tlui-layout__top__right"),m=u.offsetWidth,v=p.offsetWidth,b=f.offsetWidth,S=c.offsetWidth-e;let C=(m-S)/2;m%2!==0&&(C-=.5);const E=v+n,T=c.offsetLeft,w=Math.min(m-b-v-2*n,r),M=Math.max(C,E)-T;f.offsetWidth>t&&a<=6?c.style.setProperty("max-width",w-s+"px"):c.style.setProperty("max-width",w+"px"),c.style.setProperty("transform",`translate(${M}px, 0px)`)},[a,e,n,r,s,t]);return I.useLayoutEffect(()=>{const c=i.current;if(!c)return;const u=c.parentElement.parentElement,p=u.querySelector(".tlui-layout__top__left"),f=u.querySelector(".tlui-layout__top__right"),m=new ResizeObserver(l);return m.observe(p),m.observe(f),m.observe(u),m.observe(c),l(),()=>{m.disconnect()}},[l]),I.useLayoutEffect(()=>{l()}),g.jsx("div",{ref:i,className:"tlui-top-panel__container",children:o})}function Yhe(){const r=gse()==="offline";return g.jsx(qhe,{children:r&&g.jsx(Vhe,{})})}function Xhe(){return g.jsxs(g.Fragment,{children:[g.jsx(Pe,{actionId:"zoom-in",noClose:!0}),g.jsx(Pe,{actionId:"zoom-out",noClose:!0}),g.jsx(i$,{}),g.jsx(a$,{}),g.jsx(l$,{})]})}const Zhe=I.memo(function({children:e}){const t=Kr(),[n,s]=oc("zoom menu"),o=e??g.jsx(Xhe,{});return g.jsxs(gP,{dir:"ltr",open:n,onOpenChange:s,modal:!1,children:[g.jsx(mP,{asChild:!0,dir:"ltr",children:g.jsx(Jhe,{})}),g.jsx(_b,{container:t,children:g.jsx(yP,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:g.jsx(zi,{type:"menu",sourceId:"zoom-menu",children:o})})})]})}),Jhe=I.forwardRef(function(e,t){const n=ue(),s=po(),o=ye("zoom",()=>n.getZoomLevel(),[n]),i=Wt(),a=I.useCallback(()=>{n.resetZoom(n.getViewportScreenCenter(),{animation:{duration:n.options.animationMediumMs}})},[n]);return g.jsx(ut,{ref:t,...e,type:"icon",title:`${i("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu-button",className:s<yr.TABLET_SM?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:a,children:s<yr.MOBILE?null:g.jsxs("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(o*100),"%"]})})}),n7=I.createContext(null);function Qhe({overrides:r={},children:e}){const t=ip(r),n=Rb();return g.jsx(n7.Provider,{value:I.useMemo(()=>({ContextMenu:fk,ActionsMenu:Kce,HelpMenu:null,ZoomMenu:Zhe,MainMenu:b$,Minimap:sue,StylePanel:Jue,PageMenu:lue,NavigationPanel:iue,Toolbar:Khe,KeyboardShortcutsDialog:zde,QuickActions:hue,HelperButtons:Nde,DebugPanel:_de,DebugMenu:Ide,MenuPanel:jde,SharePanel:n?bue:null,CursorChatBubble:n?bde:null,TopPanel:n?Yhe:null,...t}),[t,n]),children:e})}function Sd(){const r=I.useContext(n7);if(!r)throw new Error("useTldrawUiComponents must be used within a TldrawUiComponentsProvider");return r}const epe=Ss(function({overrides:e,components:t,assetUrls:n,onUiEvent:s,forceMobile:o,mediaMimeTypes:i,children:a}){const l=fd();return g.jsx(d9.Provider,{value:i,children:g.jsx(Ure,{assetUrls:Sce(n),children:g.jsx(Wre,{overrides:Woe(e),locale:(l==null?void 0:l.user.getLocale())??Na.locale,children:g.jsx(IQ,{onEvent:s,children:g.jsx($se,{children:g.jsx(yse,{context:l==null?void 0:l.contextId,children:g.jsx(mse,{forceMobile:o,children:g.jsx(Qhe,{overrides:t,children:l?g.jsx(tpe,{overrides:e,children:a}):a})})})})})})})})});function tpe({overrides:r,children:e}){const t=Koe(r);return g.jsx(qoe,{overrides:t.actions,children:g.jsx(die,{overrides:t.tools,children:e})})}function npe(){const r=ue(),{addToast:e}=sc();I.useEffect(()=>{function t({name:n,count:s}){e({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${n} (${s}). Please delete some shapes or move to a different page to continue.`,severity:"warning"})}return r.addListener("max-shapes",t),()=>{r.removeListener("max-shapes",t)}},[r,e])}const rpe=Ht.memo(function({renderDebugMenuItems:e,children:t,hideUi:n,components:s,...o}){return g.jsx(epe,{...o,components:s,children:g.jsx(spe,{hideUi:n,renderDebugMenuItems:e,children:t})})}),spe=Ht.memo(function({children:e,hideUi:t,...n}){return g.jsxs(g.Fragment,{children:[e,t?null:g.jsx(ope,{...n})]})}),ope=Ht.memo(function(){const e=ue(),t=Wt(),n=po(),s=gi(),o=ye("focus",()=>e.getInstanceState().isFocusMode,[e]),i=ye("debug",()=>e.getInstanceState().isDebugMode,[e]),{SharePanel:a,TopPanel:l,MenuPanel:c,StylePanel:u,Toolbar:p,HelpMenu:f,NavigationPanel:m,HelperButtons:v,DebugPanel:b,CursorChatBubble:S}=Sd();Bhe(),yoe(),npe();const{"toggle-focus-mode":C}=Iu();return g.jsxs("div",{className:it("tlui-layout",{"tlui-layout__mobile":n<yr.TABLET_SM}),"data-breakpoint":n,children:[o?g.jsx("div",{className:"tlui-layout__top",children:g.jsx(ut,{type:"icon",className:"tlui-focus-button",title:t("focus-mode.toggle-focus-mode"),onClick:()=>C.onSelect("menu"),children:g.jsx($t,{icon:"dot"})})}):g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"tlui-layout__top",children:[g.jsxs("div",{className:"tlui-layout__top__left",children:[c&&g.jsx(c,{}),v&&g.jsx(v,{})]}),g.jsx("div",{className:"tlui-layout__top__center",children:l&&g.jsx(l,{})}),g.jsxs("div",{className:"tlui-layout__top__right",children:[a&&g.jsx(a,{}),u&&n>=yr.TABLET_SM&&!s&&g.jsx(u,{})]})]}),g.jsxs("div",{className:"tlui-layout__bottom",children:[g.jsxs("div",{className:"tlui-layout__bottom__main",children:[m&&g.jsx(m,{}),p&&g.jsx(p,{}),f&&g.jsx(f,{})]}),i&&b&&g.jsx(b,{})]})]}),g.jsx(cie,{}),g.jsx(oie,{}),g.jsx(yce,{}),S&&g.jsx(S,{})]})});async function ipe(r,e){const{url:t,style:n="normal",weight:s="500",display:o,featureSettings:i,stretch:a,unicodeRange:l,variant:c,format:u}=e,p={style:n,weight:s,display:o,featureSettings:i,stretch:a,unicodeRange:l,variant:c},f=new FontFace(r,`url(${t})`,p);return await f.load(),document.fonts.add(f),f.$$_url=t,f.$$_fontface=`
@font-face {
	font-family: ${f.family};
	font-stretch: ${f.stretch};
	font-weight: ${f.weight};
	font-style: ${f.style};
	src: url("${t}") format("${u}")
}`,f}const Gy=(r,e)=>{const[t,n]=I.useState(2);return I.useEffect(()=>{let s=!1;return n(2),ipe(r,e).then(()=>{s||n(0)}).catch(o=>{s||(console.error(o),n(1))}),()=>{s=!0}},[r,e]),t};function ape(r){return{draw:{url:r.fonts.draw,format:r.fonts.draw.split(".").pop()},serif:{url:r.fonts.serif,format:r.fonts.serif.split(".").pop()},sansSerif:{url:r.fonts.sansSerif,format:r.fonts.sansSerif.split(".").pop()},monospace:{url:r.fonts.monospace,format:r.fonts.monospace.split(".").pop()}}}function r7(r){const e=I.useMemo(()=>ape(r),[r]),t=[Gy("tldraw_draw",e.draw),Gy("tldraw_serif",e.serif),Gy("tldraw_sans",e.sansSerif),Gy("tldraw_mono",e.monospace)];return{error:t.some(n=>n===1),done:!t.some(n=>n===2)}}function lpe(r){const{children:e,maxImageDimension:t,maxAssetSize:n,acceptedImageMimeTypes:s,acceptedVideoMimeTypes:o,onMount:i,components:a={},shapeUtils:l=[],bindingUtils:c=[],tools:u=[],embeds:p,...f}=r,m=ip(a),v=I.useMemo(()=>({Scribble:fD,ShapeIndicators:xie,CollaboratorScribble:fD,SelectionForeground:vie,SelectionBackground:mie,Handles:uie,...m}),[m]),b=Bc(l),S=I.useMemo(()=>[...X9,...b],[b]),C=Bc(c),E=I.useMemo(()=>[...v9,...C],[C]),T=Bc(u),w=I.useMemo(()=>[...mce,...oae,...T],[T]),M=Bc(s??$0),R=Bc(o??Lk),D=I.useMemo(()=>[...M,...R],[M,R]),N=Dz(f.assetUrls),{done:z,error:L}=r7(N);return L?g.jsx(S8,{children:"Could not load assets. Please refresh the page."}):z?(S.find(K=>K.type==="embed")&&p&&y0.setEmbedDefinitions(p),g.jsx(hQ,{initialState:"select",...f,components:v,shapeUtils:S,bindingUtils:E,tools:w,children:g.jsxs(rpe,{...f,components:v,mediaMimeTypes:D,children:[g.jsx(cpe,{maxImageDimension:t,maxAssetSize:n,acceptedImageMimeTypes:M,acceptedVideoMimeTypes:R,onMount:i}),e]})})):g.jsx($2,{children:g.jsx(k2,{})})}function cpe({maxImageDimension:r=5e3,maxAssetSize:e=10*1024*1024,acceptedImageMimeTypes:t=$0,acceptedVideoMimeTypes:n=Lk,onMount:s}){const o=ue(),i=sc(),a=Wt();x8(()=>{const u=[];return u.push($le(o)),Fie(o,{maxImageDimension:r,maxAssetSize:e,acceptedImageMimeTypes:t,acceptedVideoMimeTypes:n},{toasts:i,msg:a}),u.push(o.store.props.onMount(o)),u.push(s==null?void 0:s(o)),()=>{u.forEach(p=>p==null?void 0:p())}});const{Canvas:l}=Vn(),{ContextMenu:c}=Sd();return c?g.jsx(c,{}):l?g.jsx(l,{}):null}I.memo(function(e){const[t,n]=I.useState(null),[s,o]=I.useState(null),i=Bc(e.shapeUtils??[]),a=I.useMemo(()=>[...X9,...i],[i]),l=Bc(e.bindingUtils??[]),c=I.useMemo(()=>[...v9,...l],[l]),u=bQ({snapshot:e.snapshot,shapeUtils:a}),p=Dz(e.assetUrls),{done:f,error:m}=r7(p),{pageId:v,bounds:b,scale:S,pixelRatio:C,background:E,padding:T,darkMode:w,preserveAspectRatio:M,format:R="svg",licenseKey:D}=e;return I.useLayoutEffect(()=>{if(!s||!u||!f)return;let N=!1;const z=document.createElement("div");s.appendChild(z),s.classList.add("tl-container","tl-theme__light");const L=new Ge({store:u,shapeUtils:a,bindingUtils:c,tools:[],getContainer:()=>z,licenseKey:D});v&&L.setCurrentPage(v);const B=L.getCurrentPageShapeIds();async function K(){const O=await L.getSvgString([...B],{bounds:b,scale:S,background:E,padding:T,darkMode:w,preserveAspectRatio:M});if(O&&!N){if(R==="svg"){if(!N){const U=new Blob([O.svg],{type:"image/svg+xml"}),X=URL.createObjectURL(U);n(X)}}else if(R==="png"){const U=await a9(L,O.svg,{type:R,width:O.width,height:O.height,pixelRatio:C});if(U&&!N){const X=URL.createObjectURL(U);n(X)}}}L.dispose()}return K(),()=>{N=!0}},[R,s,u,a,c,v,b,S,E,T,w,M,f,m,D,C]),m?g.jsx(S8,{children:"Could not load assets."}):f?g.jsx("div",{ref:o,style:{position:"relative",width:"100%",height:"100%"},children:t&&g.jsx("img",{src:t,referrerPolicy:"strict-origin-when-cross-origin",style:{width:"100%",height:"100%"}})}):g.jsx($2,{children:g.jsx(k2,{})})});I.memo(function({children:e}){const t=Wt(),n=po(),s=I.useRef(null);md(s);const o=e??g.jsx($de,{});return n<yr.MOBILE?null:g.jsx("div",{ref:s,className:"tlui-help-menu",children:g.jsxs(gu,{id:"help menu",children:[g.jsx(mu,{children:g.jsx(ut,{type:"help",title:t("help-menu.title"),"data-testid":"help-menu.button",children:g.jsx($t,{icon:"question-mark",small:!0})})}),g.jsx(yu,{side:"top",align:"end",alignOffset:0,sideOffset:8,children:g.jsx(zi,{type:"menu",sourceId:"help-menu",children:o})})]})})});const dpe=Bt({schemaVersion:qs(1),storeVersion:Yy,recordVersions:Hv(Tt,Bt({version:Yy,subTypeVersions:Hv(Tt,Yy).optional(),subTypeKey:Tt.optional()}))}),upe=Bt({schemaVersion:qs(2),sequences:Hv(Tt,Yy)});Bt({tldrawFileFormatVersion:aK,schema:lK("schemaVersion",{1:dpe,2:upe}),records:ms(Bt({id:Tt,typeName:Tt}).allowUnknownProperties())});dd("tldraw","3.7.0","esm");function hs(r){return`Minified Redux error #${r}; visit https://redux.js.org/Errors?code=${r} for the full message or use the non-minified dev environment for full errors. `}var hpe=typeof Symbol=="function"&&Symbol.observable||"@@observable",oO=hpe,DC=()=>Math.random().toString(36).substring(7).split("").join("."),ppe={INIT:`@@redux/INIT${DC()}`,REPLACE:`@@redux/REPLACE${DC()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${DC()}`},b0=ppe;function sI(r){if(typeof r!="object"||r===null)return!1;let e=r;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(r)===e||Object.getPrototypeOf(r)===null}function s7(r,e,t){if(typeof r!="function")throw new Error(hs(2));if(typeof e=="function"&&typeof t=="function"||typeof t=="function"&&typeof arguments[3]=="function")throw new Error(hs(0));if(typeof e=="function"&&typeof t>"u"&&(t=e,e=void 0),typeof t<"u"){if(typeof t!="function")throw new Error(hs(1));return t(s7)(r,e)}let n=r,s=e,o=new Map,i=o,a=0,l=!1;function c(){i===o&&(i=new Map,o.forEach((S,C)=>{i.set(C,S)}))}function u(){if(l)throw new Error(hs(3));return s}function p(S){if(typeof S!="function")throw new Error(hs(4));if(l)throw new Error(hs(5));let C=!0;c();const E=a++;return i.set(E,S),function(){if(C){if(l)throw new Error(hs(6));C=!1,c(),i.delete(E),o=null}}}function f(S){if(!sI(S))throw new Error(hs(7));if(typeof S.type>"u")throw new Error(hs(8));if(typeof S.type!="string")throw new Error(hs(17));if(l)throw new Error(hs(9));try{l=!0,s=n(s,S)}finally{l=!1}return(o=i).forEach(E=>{E()}),S}function m(S){if(typeof S!="function")throw new Error(hs(10));n=S,f({type:b0.REPLACE})}function v(){const S=p;return{subscribe(C){if(typeof C!="object"||C===null)throw new Error(hs(11));function E(){const w=C;w.next&&w.next(u())}return E(),{unsubscribe:S(E)}},[oO](){return this}}}return f({type:b0.INIT}),{dispatch:f,subscribe:p,getState:u,replaceReducer:m,[oO]:v}}function fpe(r){Object.keys(r).forEach(e=>{const t=r[e];if(typeof t(void 0,{type:b0.INIT})>"u")throw new Error(hs(12));if(typeof t(void 0,{type:b0.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(hs(13))})}function gpe(r){const e=Object.keys(r),t={};for(let o=0;o<e.length;o++){const i=e[o];typeof r[i]=="function"&&(t[i]=r[i])}const n=Object.keys(t);let s;try{fpe(t)}catch(o){s=o}return function(i={},a){if(s)throw s;let l=!1;const c={};for(let u=0;u<n.length;u++){const p=n[u],f=t[p],m=i[p],v=f(m,a);if(typeof v>"u")throw a&&a.type,new Error(hs(14));c[p]=v,l=l||v!==m}return l=l||n.length!==Object.keys(i).length,l?c:i}}function S0(...r){return r.length===0?e=>e:r.length===1?r[0]:r.reduce((e,t)=>(...n)=>e(t(...n)))}function mpe(...r){return e=>(t,n)=>{const s=e(t,n);let o=()=>{throw new Error(hs(15))};const i={getState:s.getState,dispatch:(l,...c)=>o(l,...c)},a=r.map(l=>l(i));return o=S0(...a)(s.dispatch),{...s,dispatch:o}}}function ype(r){return sI(r)&&"type"in r&&typeof r.type=="string"}var o7=Symbol.for("immer-nothing"),iO=Symbol.for("immer-draftable"),hi=Symbol.for("immer-state");function ia(r,...e){throw new Error(`[Immer] minified error nr: ${r}. Full error at: https://bit.ly/3cXEKWf`)}var Xh=Object.getPrototypeOf;function bu(r){return!!r&&!!r[hi]}function Ql(r){var e;return r?i7(r)||Array.isArray(r)||!!r[iO]||!!((e=r.constructor)!=null&&e[iO])||qb(r)||Yb(r):!1}var vpe=Object.prototype.constructor.toString();function i7(r){if(!r||typeof r!="object")return!1;const e=Xh(r);if(e===null)return!0;const t=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return t===Object?!0:typeof t=="function"&&Function.toString.call(t)===vpe}function x0(r,e){Vb(r)===0?Reflect.ownKeys(r).forEach(t=>{e(t,r[t],r)}):r.forEach((t,n)=>e(n,t,r))}function Vb(r){const e=r[hi];return e?e.type_:Array.isArray(r)?1:qb(r)?2:Yb(r)?3:0}function xk(r,e){return Vb(r)===2?r.has(e):Object.prototype.hasOwnProperty.call(r,e)}function a7(r,e,t){const n=Vb(r);n===2?r.set(e,t):n===3?r.add(t):r[e]=t}function bpe(r,e){return r===e?r!==0||1/r===1/e:r!==r&&e!==e}function qb(r){return r instanceof Map}function Yb(r){return r instanceof Set}function Ud(r){return r.copy_||r.base_}function wk(r,e){if(qb(r))return new Map(r);if(Yb(r))return new Set(r);if(Array.isArray(r))return Array.prototype.slice.call(r);const t=i7(r);if(e===!0||e==="class_only"&&!t){const n=Object.getOwnPropertyDescriptors(r);delete n[hi];let s=Reflect.ownKeys(n);for(let o=0;o<s.length;o++){const i=s[o],a=n[i];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(n[i]={configurable:!0,writable:!0,enumerable:a.enumerable,value:r[i]})}return Object.create(Xh(r),n)}else{const n=Xh(r);if(n!==null&&t)return{...r};const s=Object.create(n);return Object.assign(s,r)}}function oI(r,e=!1){return Xb(r)||bu(r)||!Ql(r)||(Vb(r)>1&&(r.set=r.add=r.clear=r.delete=Spe),Object.freeze(r),e&&Object.entries(r).forEach(([t,n])=>oI(n,!0))),r}function Spe(){ia(2)}function Xb(r){return Object.isFrozen(r)}var xpe={};function Su(r){const e=xpe[r];return e||ia(0,r),e}var Qf;function l7(){return Qf}function wpe(r,e){return{drafts_:[],parent_:r,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function aO(r,e){e&&(Su("Patches"),r.patches_=[],r.inversePatches_=[],r.patchListener_=e)}function Ck(r){Ek(r),r.drafts_.forEach(Cpe),r.drafts_=null}function Ek(r){r===Qf&&(Qf=r.parent_)}function lO(r){return Qf=wpe(Qf,r)}function Cpe(r){const e=r[hi];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function cO(r,e){e.unfinalizedDrafts_=e.drafts_.length;const t=e.drafts_[0];return r!==void 0&&r!==t?(t[hi].modified_&&(Ck(e),ia(4)),Ql(r)&&(r=w0(e,r),e.parent_||C0(e,r)),e.patches_&&Su("Patches").generateReplacementPatches_(t[hi].base_,r,e.patches_,e.inversePatches_)):r=w0(e,t,[]),Ck(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),r!==o7?r:void 0}function w0(r,e,t){if(Xb(e))return e;const n=e[hi];if(!n)return x0(e,(s,o)=>dO(r,n,e,s,o,t)),e;if(n.scope_!==r)return e;if(!n.modified_)return C0(r,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const s=n.copy_;let o=s,i=!1;n.type_===3&&(o=new Set(s),s.clear(),i=!0),x0(o,(a,l)=>dO(r,n,s,a,l,t,i)),C0(r,s,!1),t&&r.patches_&&Su("Patches").generatePatches_(n,t,r.patches_,r.inversePatches_)}return n.copy_}function dO(r,e,t,n,s,o,i){if(bu(s)){const a=o&&e&&e.type_!==3&&!xk(e.assigned_,n)?o.concat(n):void 0,l=w0(r,s,a);if(a7(t,n,l),bu(l))r.canAutoFreeze_=!1;else return}else i&&t.add(s);if(Ql(s)&&!Xb(s)){if(!r.immer_.autoFreeze_&&r.unfinalizedDrafts_<1)return;w0(r,s),(!e||!e.scope_.parent_)&&typeof n!="symbol"&&Object.prototype.propertyIsEnumerable.call(t,n)&&C0(r,s)}}function C0(r,e,t=!1){!r.parent_&&r.immer_.autoFreeze_&&r.canAutoFreeze_&&oI(e,t)}function Epe(r,e){const t=Array.isArray(r),n={type_:t?1:0,scope_:e?e.scope_:l7(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:r,draft_:null,copy_:null,revoke_:null,isManual_:!1};let s=n,o=iI;t&&(s=[n],o=eg);const{revoke:i,proxy:a}=Proxy.revocable(s,o);return n.draft_=a,n.revoke_=i,a}var iI={get(r,e){if(e===hi)return r;const t=Ud(r);if(!xk(t,e))return kpe(r,t,e);const n=t[e];return r.finalized_||!Ql(n)?n:n===OC(r.base_,e)?(LC(r),r.copy_[e]=Pk(n,r)):n},has(r,e){return e in Ud(r)},ownKeys(r){return Reflect.ownKeys(Ud(r))},set(r,e,t){const n=c7(Ud(r),e);if(n!=null&&n.set)return n.set.call(r.draft_,t),!0;if(!r.modified_){const s=OC(Ud(r),e),o=s==null?void 0:s[hi];if(o&&o.base_===t)return r.copy_[e]=t,r.assigned_[e]=!1,!0;if(bpe(t,s)&&(t!==void 0||xk(r.base_,e)))return!0;LC(r),kk(r)}return r.copy_[e]===t&&(t!==void 0||e in r.copy_)||Number.isNaN(t)&&Number.isNaN(r.copy_[e])||(r.copy_[e]=t,r.assigned_[e]=!0),!0},deleteProperty(r,e){return OC(r.base_,e)!==void 0||e in r.base_?(r.assigned_[e]=!1,LC(r),kk(r)):delete r.assigned_[e],r.copy_&&delete r.copy_[e],!0},getOwnPropertyDescriptor(r,e){const t=Ud(r),n=Reflect.getOwnPropertyDescriptor(t,e);return n&&{writable:!0,configurable:r.type_!==1||e!=="length",enumerable:n.enumerable,value:t[e]}},defineProperty(){ia(11)},getPrototypeOf(r){return Xh(r.base_)},setPrototypeOf(){ia(12)}},eg={};x0(iI,(r,e)=>{eg[r]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});eg.deleteProperty=function(r,e){return eg.set.call(this,r,e,void 0)};eg.set=function(r,e,t){return iI.set.call(this,r[0],e,t,r[0])};function OC(r,e){const t=r[hi];return(t?Ud(t):r)[e]}function kpe(r,e,t){var s;const n=c7(e,t);return n?"value"in n?n.value:(s=n.get)==null?void 0:s.call(r.draft_):void 0}function c7(r,e){if(!(e in r))return;let t=Xh(r);for(;t;){const n=Object.getOwnPropertyDescriptor(t,e);if(n)return n;t=Xh(t)}}function kk(r){r.modified_||(r.modified_=!0,r.parent_&&kk(r.parent_))}function LC(r){r.copy_||(r.copy_=wk(r.base_,r.scope_.immer_.useStrictShallowCopy_))}var Ppe=class{constructor(r){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,n)=>{if(typeof e=="function"&&typeof t!="function"){const o=t;t=e;const i=this;return function(l=o,...c){return i.produce(l,u=>t.call(this,u,...c))}}typeof t!="function"&&ia(6),n!==void 0&&typeof n!="function"&&ia(7);let s;if(Ql(e)){const o=lO(this),i=Pk(e,void 0);let a=!0;try{s=t(i),a=!1}finally{a?Ck(o):Ek(o)}return aO(o,n),cO(s,o)}else if(!e||typeof e!="object"){if(s=t(e),s===void 0&&(s=e),s===o7&&(s=void 0),this.autoFreeze_&&oI(s,!0),n){const o=[],i=[];Su("Patches").generateReplacementPatches_(e,s,o,i),n(o,i)}return s}else ia(1,e)},this.produceWithPatches=(e,t)=>{if(typeof e=="function")return(i,...a)=>this.produceWithPatches(i,l=>e(l,...a));let n,s;return[this.produce(e,t,(i,a)=>{n=i,s=a}),n,s]},typeof(r==null?void 0:r.autoFreeze)=="boolean"&&this.setAutoFreeze(r.autoFreeze),typeof(r==null?void 0:r.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(r.useStrictShallowCopy)}createDraft(r){Ql(r)||ia(8),bu(r)&&(r=Ipe(r));const e=lO(this),t=Pk(r,void 0);return t[hi].isManual_=!0,Ek(e),t}finishDraft(r,e){const t=r&&r[hi];(!t||!t.isManual_)&&ia(9);const{scope_:n}=t;return aO(n,e),cO(void 0,n)}setAutoFreeze(r){this.autoFreeze_=r}setUseStrictShallowCopy(r){this.useStrictShallowCopy_=r}applyPatches(r,e){let t;for(t=e.length-1;t>=0;t--){const s=e[t];if(s.path.length===0&&s.op==="replace"){r=s.value;break}}t>-1&&(e=e.slice(t+1));const n=Su("Patches").applyPatches_;return bu(r)?n(r,e):this.produce(r,s=>n(s,e))}};function Pk(r,e){const t=qb(r)?Su("MapSet").proxyMap_(r,e):Yb(r)?Su("MapSet").proxySet_(r,e):Epe(r,e);return(e?e.scope_:l7()).drafts_.push(t),t}function Ipe(r){return bu(r)||ia(10,r),d7(r)}function d7(r){if(!Ql(r)||Xb(r))return r;const e=r[hi];let t;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,t=wk(r,e.scope_.immer_.useStrictShallowCopy_)}else t=wk(r,!0);return x0(t,(n,s)=>{a7(t,n,d7(s))}),e&&(e.finalized_=!1),t}var pi=new Ppe,u7=pi.produce;pi.produceWithPatches.bind(pi);pi.setAutoFreeze.bind(pi);pi.setUseStrictShallowCopy.bind(pi);pi.applyPatches.bind(pi);pi.createDraft.bind(pi);pi.finishDraft.bind(pi);function h7(r){return({dispatch:t,getState:n})=>s=>o=>typeof o=="function"?o(t,n,r):s(o)}var _pe=h7(),Tpe=h7,Mpe=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?S0:S0.apply(null,arguments)};function uO(r,e){function t(...n){if(e){let s=e(...n);if(!s)throw new Error(Yl(0));return{type:r,payload:s.payload,..."meta"in s&&{meta:s.meta},..."error"in s&&{error:s.error}}}return{type:r,payload:n[0]}}return t.toString=()=>`${r}`,t.type=r,t.match=n=>ype(n)&&n.type===r,t}var p7=class wf extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,wf.prototype)}static get[Symbol.species](){return wf}concat(...e){return super.concat.apply(this,e)}prepend(...e){return e.length===1&&Array.isArray(e[0])?new wf(...e[0].concat(this)):new wf(...e.concat(this))}};function hO(r){return Ql(r)?u7(r,()=>{}):r}function pO(r,e,t){return r.has(e)?r.get(e):r.set(e,t(e)).get(e)}function Ape(r){return typeof r=="boolean"}var jpe=()=>function(e){const{thunk:t=!0,immutableCheck:n=!0,serializableCheck:s=!0,actionCreatorCheck:o=!0}=e??{};let i=new p7;return t&&(Ape(t)?i.push(_pe):i.push(Tpe(t.extraArgument))),i},Rpe="RTK_autoBatch",fO=r=>e=>{setTimeout(e,r)},Dpe=(r={type:"raf"})=>e=>(...t)=>{const n=e(...t);let s=!0,o=!1,i=!1;const a=new Set,l=r.type==="tick"?queueMicrotask:r.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:fO(10):r.type==="callback"?r.queueNotification:fO(r.timeout),c=()=>{i=!1,o&&(o=!1,a.forEach(u=>u()))};return Object.assign({},n,{subscribe(u){const p=()=>s&&u(),f=n.subscribe(p);return a.add(u),()=>{f(),a.delete(u)}},dispatch(u){var p;try{return s=!((p=u==null?void 0:u.meta)!=null&&p[Rpe]),o=!s,o&&(i||(i=!0,l(c))),n.dispatch(u)}finally{s=!0}}})},Ope=r=>function(t){const{autoBatch:n=!0}=t??{};let s=new p7(r);return n&&s.push(Dpe(typeof n=="object"?n:void 0)),s};function Lpe(r){const e=jpe(),{reducer:t=void 0,middleware:n,devTools:s=!0,preloadedState:o=void 0,enhancers:i=void 0}=r||{};let a;if(typeof t=="function")a=t;else if(sI(t))a=gpe(t);else throw new Error(Yl(1));let l;typeof n=="function"?l=n(e):l=e();let c=S0;s&&(c=Mpe({trace:!1,...typeof s=="object"&&s}));const u=mpe(...l),p=Ope(u);let f=typeof i=="function"?i(p):p();const m=c(...f);return s7(a,o,m)}function f7(r){const e={},t=[];let n;const s={addCase(o,i){const a=typeof o=="string"?o:o.type;if(!a)throw new Error(Yl(28));if(a in e)throw new Error(Yl(29));return e[a]=i,s},addMatcher(o,i){return t.push({matcher:o,reducer:i}),s},addDefaultCase(o){return n=o,s}};return r(s),[e,t,n]}function Npe(r){return typeof r=="function"}function Fpe(r,e){let[t,n,s]=f7(e),o;if(Npe(r))o=()=>hO(r());else{const a=hO(r);o=()=>a}function i(a=o(),l){let c=[t[l.type],...n.filter(({matcher:u})=>u(l)).map(({reducer:u})=>u)];return c.filter(u=>!!u).length===0&&(c=[s]),c.reduce((u,p)=>{if(p)if(bu(u)){const m=p(u,l);return m===void 0?u:m}else{if(Ql(u))return u7(u,f=>p(f,l));{const f=p(u,l);if(f===void 0){if(u===null)return u;throw Error("A case reducer on a non-draftable value must not return undefined")}return f}}return u},a)}return i.getInitialState=o,i}var zpe=Symbol.for("rtk-slice-createasyncthunk");function $pe(r,e){return`${r}/${e}`}function Bpe({creators:r}={}){var t;const e=(t=r==null?void 0:r.asyncThunk)==null?void 0:t[zpe];return function(s){const{name:o,reducerPath:i=o}=s;if(!o)throw new Error(Yl(11));typeof process<"u";const a=(typeof s.reducers=="function"?s.reducers(Hpe()):s.reducers)||{},l=Object.keys(a),c={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},u={addCase(T,w){const M=typeof T=="string"?T:T.type;if(!M)throw new Error(Yl(12));if(M in c.sliceCaseReducersByType)throw new Error(Yl(13));return c.sliceCaseReducersByType[M]=w,u},addMatcher(T,w){return c.sliceMatchers.push({matcher:T,reducer:w}),u},exposeAction(T,w){return c.actionCreators[T]=w,u},exposeCaseReducer(T,w){return c.sliceCaseReducersByName[T]=w,u}};l.forEach(T=>{const w=a[T],M={reducerName:T,type:$pe(o,T),createNotation:typeof s.reducers=="function"};Wpe(w)?Vpe(M,w,u,e):Gpe(M,w,u)});function p(){const[T={},w=[],M=void 0]=typeof s.extraReducers=="function"?f7(s.extraReducers):[s.extraReducers],R={...T,...c.sliceCaseReducersByType};return Fpe(s.initialState,D=>{for(let N in R)D.addCase(N,R[N]);for(let N of c.sliceMatchers)D.addMatcher(N.matcher,N.reducer);for(let N of w)D.addMatcher(N.matcher,N.reducer);M&&D.addDefaultCase(M)})}const f=T=>T,m=new Map;let v;function b(T,w){return v||(v=p()),v(T,w)}function S(){return v||(v=p()),v.getInitialState()}function C(T,w=!1){function M(D){let N=D[T];return typeof N>"u"&&w&&(N=S()),N}function R(D=f){const N=pO(m,w,()=>new WeakMap);return pO(N,D,()=>{const z={};for(const[L,B]of Object.entries(s.selectors??{}))z[L]=Upe(B,D,S,w);return z})}return{reducerPath:T,getSelectors:R,get selectors(){return R(M)},selectSlice:M}}const E={name:o,reducer:b,actions:c.actionCreators,caseReducers:c.sliceCaseReducersByName,getInitialState:S,...C(i),injectInto(T,{reducerPath:w,...M}={}){const R=w??i;return T.inject({reducerPath:R,reducer:b},M),{...E,...C(R,!0)}}};return E}}function Upe(r,e,t,n){function s(o,...i){let a=e(o);return typeof a>"u"&&n&&(a=t()),r(a,...i)}return s.unwrapped=r,s}var g7=Bpe();function Hpe(){function r(e,t){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...t}}return r.withTypes=()=>r,{reducer(e){return Object.assign({[e.name](...t){return e(...t)}}[e.name],{_reducerDefinitionType:"reducer"})},preparedReducer(e,t){return{_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:t}},asyncThunk:r}}function Gpe({type:r,reducerName:e,createNotation:t},n,s){let o,i;if("reducer"in n){if(t&&!Kpe(n))throw new Error(Yl(17));o=n.reducer,i=n.prepare}else o=n;s.addCase(r,o).exposeCaseReducer(e,o).exposeAction(e,i?uO(r,i):uO(r))}function Wpe(r){return r._reducerDefinitionType==="asyncThunk"}function Kpe(r){return r._reducerDefinitionType==="reducerWithPrepare"}function Vpe({type:r,reducerName:e},t,n,s){if(!s)throw new Error(Yl(18));const{payloadCreator:o,fulfilled:i,pending:a,rejected:l,settled:c,options:u}=t,p=s(r,o,u);n.exposeAction(e,p),i&&n.addCase(p.fulfilled,i),a&&n.addCase(p.pending,a),l&&n.addCase(p.rejected,l),c&&n.addMatcher(p.settled,c),n.exposeCaseReducer(e,{fulfilled:i||Wy,pending:a||Wy,rejected:l||Wy,settled:c||Wy})}function Wy(){}function Yl(r){return`Minified Redux Toolkit error #${r}; visit https://redux-toolkit.js.org/Errors?code=${r} for the full message or use the non-minified dev environment for full errors. `}const qpe={value:{}},m7=g7({name:"exports",initialState:qpe,reducers:{setExports:(r,e)=>{Object.assign(r.value,e.payload)},clearExports:r=>{r.value={}}}}),{setExports:Ype,clearExports:ome}=m7.actions,Xpe=m7.reducer,Zpe={value:[]},y7=g7({name:"errors",initialState:Zpe,reducers:{addError:(r,e)=>{r.value.push(e.payload)},removeError:(r,e)=>{const t=r.value.findIndex(n=>n===e.payload);t>-1&&r.value.splice(t,1)}}}),{addError:gO,removeError:Jpe}=y7.actions,Qpe=y7.reducer;var Pt,bt,kr,mO;(function(r){r.Write="write",r.Erase="erase",r.Select="select",r.Move="move"})(Pt||(Pt={})),function(r){r.Pencil="pencil",r.Rectangle="rectangle",r.Rhombus="rhombus",r.Circle="circle",r.Ellipse="ellipse",r.Triangle="triangle",r.Parallelogram="parallelogram",r.Line="line",r.Arrow="arrow",r.DoubleArrow="double-arrow"}(bt||(bt={})),function(r){r.Guide="guide",r.InteractElementsGroup="interact-elements-group",r.Translate="translate",r.Resize="resize",r.Rotate="rotate"}(kr||(kr={})),function(r){r.North="n-resize",r.East="e-resize",r.South="s-resize",r.West="w-resize",r.NorthEast="ne-resize",r.NorthWest="nw-resize",r.SouthEast="se-resize",r.SouthWest="sw-resize"}(mO||(mO={}));const zs=10;class Xt{constructor(){k(this,"promise");k(this,"resolve");k(this,"reject");k(this,"isFullFilled");k(this,"isPending");this.isFullFilled=!1,this.isPending=!0,this.promise=new Promise((e,t)=>{this.reject=async n=>(this.isFullFilled=!0,this.isPending=!1,t(n)),this.resolve=async n=>(this.isFullFilled=!0,this.isPending=!1,e(n))})}}function Ul(r){return r!=null&&!isNaN(parseFloat(r.toString()))&&isFinite(+r)}function ar(r,e,t){return r>=e&&r<=t}function v7(r){return r.reduce((e,t)=>e+t,0)/(r.length||1)}function tg(r,e){const t=Math.hypot(e.y-r.y,e.x-r.x);return isNaN(t)?0:t}function zr(r,e){return Math.atan2(e.y-r.y,e.x-r.x)}function Ik(r){return+(r%(2*Math.PI)/Math.PI*180).toFixed(4)}function Iv(r){return+(r%360/180*Math.PI).toFixed(4)}function Ai(r,e,t){const n=r.x-e.x,s=r.y-e.y,o=Math.cos(t),i=Math.sin(t);return{x:+(e.x+o*n-i*s).toFixed(3),y:+(e.y+i*n+o*s).toFixed(3)}}function _v(r,e,t,n,s){const o=Math.cos(n),i=Math.sin(n),a=Math.abs(e)*Math.cos(s),l=Math.abs(t)*Math.sin(s);return{x:+(r.x+o*a-i*l).toFixed(3),y:+(r.y+i*a+o*l).toFixed(3)}}function om(r,e){if(r.p1.x===e.p1.x&&r.p1.y===e.p1.y||r.p1.x===e.p2.x&&r.p1.y===e.p2.y)return r.p1;if(r.p2.x===e.p1.x&&r.p2.y===e.p1.y||r.p2.x===e.p2.x&&r.p2.y===e.p2.y)return r.p2;const t=r.p2.x-r.p1.x,n=r.p2.y-r.p1.y,s=e.p2.x-e.p1.x,o=e.p2.y-e.p1.y,i=r.p1.x-e.p1.x,a=r.p1.y-e.p1.y,l=s*a-o*i,c=t*a-n*i,u=o*t-s*n;if(l===0||c===0||u===0)return;const p=l/u,f=c/u;return ar(p,0,1)&&ar(f,0,1)?{x:r.p1.x+p*t,y:r.p1.y+p*n}:void 0}function efe(r,e,t){const n=[],s=Math.pow(r.p2.x-r.p1.x,2)+Math.pow(r.p2.y-r.p1.y,2),o=2*((r.p2.x-r.p1.x)*(r.p1.x-e.x)+(r.p2.y-r.p1.y)*(r.p1.y-e.y)),i=Math.pow(e.x,2)+Math.pow(e.y,2)+Math.pow(r.p1.x,2)+Math.pow(r.p1.y,2)-2*(e.x*r.p1.x+e.y*r.p1.y)-Math.pow(t,2),a=Math.pow(o,2)-4*s*i;if(a<=0)return[];const l=Math.sqrt(a),c=(-o+l)/(2*s),u=(-o-l)/(2*s);return(c<0||c>1)&&(u<0||u>1)||(ar(c,0,1)&&n.push({x:(r.p2.x-r.p1.x)*c+r.p1.x,y:(r.p2.y-r.p1.y)*c+r.p1.y}),ar(u,0,1)&&n.push({x:(r.p2.x-r.p1.x)*u+r.p1.x,y:(r.p2.y-r.p1.y)*u+r.p1.y})),n}function tfe(r,e,t){const n=Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2)),s=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),o=Math.sqrt(Math.pow(t.x-r.x,2)+Math.pow(t.y-r.y,2));return Math.acos((s*s+n*n-o*o)/(2*s*n))}function nfe(r,e){let t=r[0],n=e[0],s=Number.MAX_SAFE_INTEGER;return r.forEach(o=>{e.forEach(i=>{const a=tg(o,i);s>a&&(s=a,t=o,n=i)})}),{p1:t,p2:n}}function yO(r,e){let t,n=Number.MAX_SAFE_INTEGER,s=-1;return r.forEach((o,i)=>{const a=tg(o,e);n>a&&(n=a,t=o,s=i)}),{point:t,index:s}}function rfe(r,e){let t=!1;for(let n=0,s=e.length-1;n<e.length;s=n++){const o=e[n],i=e[s];o.y>r.y!=i.y>r.y&&r.x<(i.x-o.x)*(r.y-o.y)/(i.y-o.y)+o.x&&(t=!t)}return t}const io=(r,e)=>{const t=r.split("."),n=e.split(".");for(let s=0;s<n.length;s++){const o=Number(n[s]),i=Number(t[s]);if(o>i)return!1;if(o<i)return!0}return!0};async function Zb(r,e,t){const n=new TextEncoder,s=n.encode(r),o=n.encode(e+t),i=await crypto.subtle.importKey("raw",o,{name:"HMAC",hash:{name:"SHA-512"}},!1,["sign"]),a=await crypto.subtle.sign("HMAC",i,s),l=new Uint8Array(a);return Array.prototype.map.call(l,c=>c.toString(16).padStart(2,"0")).join("")}function ot(r){return+(96*r/25.4).toFixed(3)}function sfe(r){return+(r/96*25.4).toFixed(3)}function Ol(r){return r?{x:ot(r.x),y:ot(r.y),width:ot(r.width),height:ot(r.height)}:{height:0,width:0,x:0,y:0}}function zo(){let r=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),(e=="x"?t:3&t|8).toString(16)})}const It=(r,...e)=>{const t=s=>s&&typeof s=="object"&&!Array.isArray(s);if(!e.length)return r;const n=e.shift();if(t(r)&&t(n))for(const s in n)t(n[s])?(r[s]||Object.assign(r,{[s]:{}}),It(r[s],n[s])):Array.isArray(r[s])&&Array.isArray(n[s])?r[s]=r[s].concat(n[s]):Object.assign(r,{[s]:n[s]});else Array.isArray(r)&&Array.isArray(n)?r=r.concat(n):n&&(r=n);return It(r,...e)};async function ofe(r){var e,t;if((e=r==null?void 0:r.server)!=null&&e.scheme&&((t=r==null?void 0:r.server)!=null&&t.host)){const n=r.server;return(await fetch(`${n.scheme}://${n.host}/api/v4.0/iink/availableLanguageList`)).json()}return Promise.reject("Failed to get languages: configuration.server.scheme & configuration.server.host are required!")}function ns(r,e,t){const n=r.p*t;return[{x:+(r.x-Math.sin(e)*n).toFixed(3),y:+(r.y+Math.cos(e)*n).toFixed(3)},{x:+(r.x+Math.sin(e)*n).toFixed(3),y:+(r.y-Math.cos(e)*n).toFixed(3)}]}function Li(r,e){return{x:+((e.x+r.x)/2).toFixed(3),y:+((e.y+r.y)/2).toFixed(3),p:+((e.p+r.p)/2).toFixed(3),t:+((e.t+r.t)/2).toFixed(3)}}async function im(r){var e,t;try{if(!((e=r==null?void 0:r.server)!=null&&e.scheme)&&!((t=r==null?void 0:r.server)!=null&&t.host))return Promise.reject("Failed to get infos: configuration.server.scheme & configuration.server.host are required!");const n=await fetch(`${r.server.scheme}://${r.server.host}/api/v4.0/iink/version`);return n.ok?await n.json():{version:"3.1.3",gitCommit:"unknown",nativeVersion:"<=3.1.1"}}catch{return{version:"3.1.3",gitCommit:"7e148bd566438ca77dc83cb4edcc6ed0f51a8a15",nativeVersion:"<=3.1.1"}}}var In,lt;(function(r){r.DEBUG="1",r.INFO="2",r.WARN="3",r.ERROR="4"})(In||(In={})),function(r){r.EDITOR="EDITOR",r.RECOGNIZER="RECOGNIZER",r.GRABBER="GRABBER",r.GESTURE="GESTURE",r.EDITOR_EVENT="EDITOR_EVENT",r.MODEL="MODEL",r.RENDERER="RENDERER",r.SMARTGUIDE="SMARTGUIDE",r.STYLE="STYLE",r.HISTORY="HISTORY",r.SYMBOL="SYMBOL",r.WRITE="WRITE",r.TRANSFORMER="TRANSFORMER",r.CONVERTER="CONVERTER",r.SELECTION="SELECTION",r.SVGDEBUG="SVGDEBUG",r.MENU="MENU"}(lt||(lt={}));class ife{constructor(e,t){k(this,"category");k(this,"level");this.category=e,this.level=t}debug(e,...t){if(In.DEBUG>=this.level){const n={level:"debug",from:`${this.category}.${e}`,message:t};console.debug(n)}}info(e,...t){if(In.INFO>=this.level){const n={level:"info",from:`${this.category}.${e}`,message:t};console.info(n)}}warn(e,...t){if(In.WARN>=this.level){const n={level:"warn",from:`${this.category}.${e}`,message:t};console.warn(n)}}error(e,...t){const n={level:"error",from:`${this.category}.${e}`,message:t};console.error(n)}}var Mh;const A0=class A0{static getLogger(e){return j(this,Mh).has(e)||j(this,Mh).set(e,new ife(e,In.ERROR)),j(this,Mh).get(e)}static setLoggerLevel(e){Object.keys(e).forEach(t=>{A0.getLogger(t).level=e[t]})}};Mh=new WeakMap,De(A0,Mh,new Map);let Rt=A0;const Zh={[lt.EDITOR]:In.ERROR,[lt.RECOGNIZER]:In.ERROR,[lt.GRABBER]:In.ERROR,[lt.RENDERER]:In.ERROR,[lt.EDITOR_EVENT]:In.ERROR,[lt.MODEL]:In.ERROR,[lt.SYMBOL]:In.ERROR,[lt.SMARTGUIDE]:In.ERROR,[lt.GESTURE]:In.ERROR,[lt.STYLE]:In.ERROR,[lt.HISTORY]:In.ERROR,[lt.TRANSFORMER]:In.ERROR,[lt.CONVERTER]:In.ERROR,[lt.WRITE]:In.ERROR,[lt.SELECTION]:In.ERROR,[lt.SVGDEBUG]:In.ERROR,[lt.MENU]:In.ERROR};var hn;(function(r){r.CHANGED="changed",r.CLEARED="cleared",r.CONVERTED="converted",r.ERROR="error",r.POINTEREVENTS="pointer_events",r.NOTIF="notif",r.EXPORTED="exported",r.IMPORTED="imported",r.IDLE="idle",r.LOADED="loaded",r.SESSION_OPENED="session-opened",r.SELECTED="selected",r.TOOL_CHANGED="tool-changed",r.UI_UPDATED="ui-updated",r.SYNCHRONIZED="synchronized",r.GESTURED="gestured"})(hn||(hn={}));var Zt;class afe extends EventTarget{constructor(t){super();De(this,Zt,Rt.getLogger(lt.EDITOR_EVENT));k(this,"abortController");k(this,"element");j(this,Zt).info("constructor",{element:t}),this.abortController=new AbortController,this.element=t}removeAllListeners(){j(this,Zt).info("removeAllListeners"),this.abortController.abort(),this.abortController=new AbortController}emit(t,n){var o;const s=new CustomEvent(t,Object.assign({bubbles:!0,composed:!0},n?{detail:n}:void 0));this.dispatchEvent(s),(o=this.element)==null||o.dispatchEvent(s)}emitSessionOpened(t){j(this,Zt).info("emitSessionOpened"),this.emit(hn.SESSION_OPENED,t)}addSessionOpenedListener(t){j(this,Zt).info("addSessionOpenedListener",{callback:t}),this.addEventListener(hn.SESSION_OPENED,n=>t(n.detail),{signal:this.abortController.signal})}emitLoaded(){j(this,Zt).info("emitLoaded"),this.emit(hn.LOADED)}addLoadedListener(t){j(this,Zt).info("addLoadedListener",{callback:t}),this.addEventListener(hn.LOADED,()=>t(),{signal:this.abortController.signal})}emitNotif(t){j(this,Zt).info("emitNotif",{notif:t}),this.emit(hn.NOTIF,t)}addNotifListener(t){j(this,Zt).info("addNotifListener",{callback:t}),this.addEventListener(hn.NOTIF,n=>t(n.detail),{signal:this.abortController.signal})}emitError(t){j(this,Zt).info("emitError",{err:t}),this.emit(hn.ERROR,t)}addErrorListener(t){j(this,Zt).info("addErrorListener",{callback:t}),this.addEventListener(hn.ERROR,n=>t(n.detail),{signal:this.abortController.signal})}emitExported(t){j(this,Zt).info("emitExported",{exports:t}),this.emit(hn.EXPORTED,t)}addExportedListener(t){j(this,Zt).info("addExportedListener",{callback:t}),this.addEventListener(hn.EXPORTED,n=>t(n.detail),{signal:this.abortController.signal})}emitChanged(t){j(this,Zt).info("emitChanged",{undoRedoContext:t}),this.emit(hn.CHANGED,{...t,canClear:!t.empty})}addChangedListener(t){j(this,Zt).info("addChangedListener",{callback:t}),this.addEventListener(hn.CHANGED,n=>t(n.detail),{signal:this.abortController.signal})}emitIdle(t){j(this,Zt).info("emitIdle",{idle:t}),this.emit(hn.IDLE,t)}addIdleListener(t){j(this,Zt).info("addIdleListener",{callback:t}),this.addEventListener(hn.IDLE,n=>t(n.detail),{signal:this.abortController.signal})}emitCleared(){j(this,Zt).info("emitCleared"),this.emit(hn.CLEARED)}addClearedListener(t){j(this,Zt).info("addClearedListener",{callback:t}),this.addEventListener(hn.CLEARED,()=>t(),{signal:this.abortController.signal})}emitConverted(t){j(this,Zt).info("emitConverted",{exports:t}),this.emit(hn.CONVERTED,t)}addConvertedListener(t){j(this,Zt).info("addConvertedListener",{callback:t}),this.addEventListener(hn.CONVERTED,n=>t(n.detail),{signal:this.abortController.signal})}emitImported(t){j(this,Zt).info("emitImported",{exports:t}),this.emit(hn.IMPORTED,t)}addImportedListener(t){j(this,Zt).info("addImportedListener",{callback:t}),this.addEventListener(hn.IMPORTED,n=>t(n.detail),{signal:this.abortController.signal})}emitSelected(t){j(this,Zt).info("emitSelected"),this.emit(hn.SELECTED,t)}addSelectedListener(t){j(this,Zt).info("addSelectedListener",{callback:t}),this.addEventListener(hn.SELECTED,n=>t(n.detail),{signal:this.abortController.signal})}emitToolChanged(t){j(this,Zt).info("emitToolChanged"),this.emit(hn.TOOL_CHANGED,t)}addToolChangedListener(t){j(this,Zt).info("addToolChangedListener",{callback:t}),this.addEventListener(hn.TOOL_CHANGED,n=>t(n.detail),{signal:this.abortController.signal})}emitUIpdated(){j(this,Zt).info("emitUIpdated"),this.emit(hn.UI_UPDATED)}addUIpdatedListener(t){j(this,Zt).info("addUIpdatedListener",{callback:t}),this.addEventListener(hn.UI_UPDATED,()=>t(),{signal:this.abortController.signal})}emitSynchronized(){j(this,Zt).info("emitSynchronized"),this.emit(hn.SYNCHRONIZED)}addSynchronizedListener(t){j(this,Zt).info("addSynchronizedListener",{callback:t}),this.addEventListener(hn.SYNCHRONIZED,()=>t(),{signal:this.abortController.signal})}emitGestured(t){j(this,Zt).info("emitSynchronized"),this.emit(hn.GESTURED,t)}addGesturedListener(t){j(this,Zt).info("addSynchronizedListener",{callback:t}),this.addEventListener(hn.GESTURED,n=>t(n.detail),{signal:this.abortController.signal})}}Zt=new WeakMap;var E0,Df,Us,da,vO,bO;class lfe{constructor(e,t="ms-editor"){k(this,"root");k(this,"ui");k(this,"rendering");k(this,"onCloseModal");this.root=e,this.root.classList.add(t),this.rendering=this.createLayerRender(),this.ui=this.createLayerUI()}render(){const e=document.createElement("style");e.appendChild(document.createTextNode(`.ms-editor{color:#1a9fff;container-name:editor;container-type:inline-size;font-family:sans-serif;height:100%;overflow:auto;position:relative;touch-action:none;width:100%;z-index:10}#editor:active,#editor:focus{-webkit-tap-highlight-color:transparent}.ms-editor.draw{cursor:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='m14.363 5.652 1.48-1.48a2 2 0 0 1 2.829 0l1.414 1.414a2 2 0 0 1 0 2.828l-1.48 1.48m-4.243-4.242-9.616 9.615a2 2 0 0 0-.578 1.238l-.242 2.74a1 1 0 0 0 1.084 1.085l2.74-.242a2 2 0 0 0 1.24-.578l9.615-9.616m-4.243-4.242 4.243 4.242' stroke='%23000' fill='%23fff' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E") 5 20,pointer}.ms-editor.draw.shape{cursor:crosshair}.ms-editor.erase{cursor:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='m2.893 12.607 9.193-9.193a2 2 0 0 1 2.828 0l4.95 4.95a2 2 0 0 1 0 2.828l-9.243 9.243a1.929 1.929 0 0 1-2.728 0l-5-5a2 2 0 0 1 0-2.828Z' stroke='%23000' fill='%23fff' stroke-linecap='round' stroke-linejoin='round'/%3E%3Cpath d='M21 21H9M15.889 14.89 8.464 7.463' stroke='%23000' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E") 5 20,auto}.ms-editor.move{cursor:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='m7 10.5-2.004 2.672a2 2 0 0 0 .126 2.552l3.784 4.128c.378.413.912.648 1.473.648H15c2.4 0 4-1.5 4-4 0 0 0 0 0 0V7.929M16 8.5v-.571c0-2.286 3-2.286 3 0' stroke='%23000' stroke-linecap='round' stroke-linejoin='round'/%3E%3Cpath d='M13 8.5V7.027m0-.527v.527M16 8.5V7.027c0-2.286-3-2.286-3 0' stroke='%23000' stroke-linecap='round' stroke-linejoin='round'/%3E%3Cpath d='M13 8.5V7.027c0-2.286 3-2.286 3 0V8.5M10 8.5v-2c0-2.286 3-2.286 3 0 0 0 0 0 0 0v2M7 13.5v-7A1.5 1.5 0 0 1 8.5 5v0c.828 0 1.5.555 1.5 1.384V8.5' stroke='%23000' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E") 10 10,auto}.ms-editor.select{cursor:context-menu}.ms-editor .ms-layer-rendering{height:100%;width:100%}.ms-editor .ms-layer-rendering,.ms-editor [data-layer=CAPTURE],.ms-editor [data-layer=MODEL]{left:0;position:absolute;top:0;z-index:20}.ms-editor .ms-layer-rendering .ms-rendering-canvas{pointer-events:none;z-index:9}.ms-editor .ms-layer-rendering.text .ms-rendering-canvas{background-image:linear-gradient(180deg,#c8c8c8 1px,transparent 0)}.ms-editor .ms-layer-rendering.diagram .ms-rendering-canvas,.ms-editor .ms-layer-rendering.raw-content .ms-rendering-canvas,.ms-editor .ms-layer-rendering.shape .ms-rendering-canvas{background-image:linear-gradient(90deg,#c8c8c8 1px,transparent 0),linear-gradient(180deg,#c8c8c8 1px,transparent 0);background-size:40px 40px}.ms-editor .ms-layer-ui{height:100%;left:0;pointer-events:none;position:sticky;top:0;user-select:none;width:100%;z-index:25}.ms-editor .ms-layer-ui>*{cursor:auto;pointer-events:all;user-select:none}.ms-editor .loader{-webkit-animation:spin 2s linear infinite;animation:spin 2s linear infinite;border:16px solid #f5f6f7;border-radius:50%;border-top-color:#1a9fff;height:120px;left:calc(50% - 60px);position:absolute;top:calc(50% - 60px);width:120px;z-index:30}@keyframes spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}.ms-editor .state{background-color:#f5f6f7;bottom:8px;box-shadow:1px 1px 5px rgba(0,0,0,.25),-1px -1px 5px rgba(0,0,0,.25);color:#717171;cursor:auto;height:42px;left:0;position:absolute;width:42px;z-index:99}.ms-editor .state .busy{-webkit-animation:spin 2s linear infinite;animation:spin 2s linear infinite;border:4px solid #1a9fff;border-radius:100%;border-right-color:#f5f6f7;color:#717171;height:30px;margin-left:6px;margin-top:6px;width:30px}.ms-editor .message-container,.ms-editor .message-overlay{height:100%;position:absolute;width:100%}.ms-editor .message-overlay{background-color:hsla(0,0%,73%,.25);z-index:99}.ms-editor .message-modal{word-wrap:break-word;background-color:#fff;box-shadow:1px 1px 5px rgba(0,0,0,.25),-1px -1px 5px rgba(0,0,0,.25);font-size:16px;left:50%;max-height:calc(100% - 100px);max-width:calc(100% - 8px);overflow:auto;padding:12px;position:absolute;text-align:center;top:50%;transform:translate(-50%,-50%);z-index:999}@container editor (max-width: 400px){.ms-editor .message-modal{width:100%}}@container editor (min-width: 401px) and (max-width: 800px){.ms-editor .message-modal{width:66%}}@container editor (min-width: 801px){.ms-editor .message-modal{width:50%}}.ms-editor .message-modal.error-msg:before{content:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgNzYuNSA2MTIgNDU5IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJ4TWluWU1pbiBtZWV0Ij48cGF0aCBmaWxsPSIjMUE5RkZGIiBkPSJNNDk0LjcgMjI5LjVjLTE3Ljg1MS04Ni43LTk0LjM1MS0xNTMtMTg4LjctMTUzLTM4LjI1IDAtNzMuOTUgMTAuMi0xMDIgMzAuNmwzOC4yNSAzOC4yNWMxNy44NS0xMi43NSA0MC44LTE3Ljg1IDYzLjc1LTE3Ljg1IDc2LjUgMCAxNDAuMjUgNjMuNzUgMTQwLjI1IDE0MC4yNXYxMi43NWgzOC4yNWM0My4zNSAwIDc2LjUgMzMuMTUgNzYuNSA3Ni41IDAgMjguMDUtMTUuMyA1My41NS00MC44IDY2LjNsMzguMjUgMzguMjVDNTkxLjYgNDM4LjYgNjEyIDQwMC4zNSA2MTIgMzU3YzAtNjYuMy01My41NS0xMjIuNC0xMTcuMy0xMjcuNXpNNzYuNSAxMDkuNjVsNzEuNCA2OC44NUM2Ni4zIDE4My42IDAgMjQ5LjkgMCAzMzEuNWMwIDg0LjE1IDY4Ljg1IDE1MyAxNTMgMTUzaDI5OC4zNWw1MSA1MSAzMy4xNS0zMy4xNUwxMDkuNjUgNzYuNSA3Ni41IDEwOS42NXpNMTk2LjM1IDIyOS41bDIwNCAyMDRIMTUzYy01Ni4xIDAtMTAyLTQ1LjktMTAyLTEwMnM0NS45LTEwMiAxMDItMTAyaDQzLjM1eiIvPjwvc3ZnPg==");display:block;margin:auto;width:100px}.ms-editor .message-modal.info-msg:before{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMUE5RkZGIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iMTAiLz48cGF0aCBkPSJNMTIgMTZ2LTRNMTIgOGguMDEiLz48L3N2Zz4=");background-size:100% 100%;content:"";display:block;height:25px;margin:auto;padding-bottom:10px;width:25px}.ms-editor .message-modal .ms-button{background-color:#fff;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' fill='none' xmlns='http://www.w3.org/2000/svg' color='%23000'%3E%3Cpath d='M9.172 14.828 12.001 12m2.828-2.828L12.001 12m0 0L9.172 9.172M12.001 12l2.828 2.828M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Z' stroke='%23000' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");background-position:50%;background-repeat:no-repeat;border:none;border-radius:4px;color:#000;cursor:pointer;font-size:inherit;height:32px;padding:0;position:absolute;right:0;top:0;width:32px}.ms-editor .message-modal .ms-button:hover{background-color:#eee}.ms-editor .collapsible-wrapper .collapsible-header{align-items:center;color:#424242;cursor:pointer;display:flex;justify-content:space-between}.ms-editor .collapsible-wrapper .collapsible-header:hover{background-color:#efefef}.ms-editor .collapsible-wrapper .collapsible-header .collapsible-header-icon{align-items:center;display:flex;height:32px;justify-content:center;padding:4px;position:relative;transition:transform .5s;width:32px}.ms-editor .collapsible-wrapper.active .collapsible-header .collapsible-header-icon{transform:rotate(180deg)}.ms-editor .collapsible-wrapper .collapsible-content{max-height:0;overflow:auto;transition:max-height .5s}.ms-editor .collapsible-wrapper.active .collapsible-content{max-height:200px}.ms-editor .removed-stroke{opacity:0;transition:opacity .1s ease-in-out}`)),this.root.prepend(e),this.root.appendChild(this.rendering),this.root.appendChild(this.ui.root)}createLoader(){const e=document.createElement("div");return e.classList.add("loader"),e.style.display="none",e}showLoader(){this.ui.loader.style.display="block"}hideLoader(){this.ui.loader.style.display="none"}createMessageOverlay(){const e=document.createElement("div");return e.classList.add("message-overlay"),e}closeMessageModal(){var e;(e=this.onCloseModal)==null||e.call(this,this.ui.message.modal.root.classList.contains("error-msg")),this.hideMessageModal()}hideMessageModal(){this.ui.message.root.style.display="none",this.ui.message.modal.text.innerText="",this.ui.message.modal.root.classList.remove("error-msg"),this.ui.message.modal.root.classList.remove("info-msg")}createMessageModal(){const e=document.createElement("div");e.classList.add("message-modal");const t=document.createElement("button");t.classList.add("ms-button","close"),t.addEventListener("pointerup",this.closeMessageModal.bind(this)),e.appendChild(t);const n=document.createElement("p");return e.appendChild(n),{root:e,text:n}}createMessage(){const e=document.createElement("div");e.classList.add("message-container"),e.style.display="none";const t=this.createMessageOverlay();e.appendChild(t);const n=this.createMessageModal();return e.appendChild(n.root),{root:e,overlay:t,modal:n}}showMessageInfo(e){this.ui.message.modal.root.classList.add("info-msg"),this.ui.message.modal.root.classList.remove("error-msg"),this.ui.message.root.style.display="block",this.ui.message.modal.text.innerText=e.message,setTimeout(()=>{this.closeMessageModal()},e.timeout||2500)}showMessageError(e){this.ui.message.modal.root.classList.add("error-msg"),this.ui.message.modal.root.classList.remove("info-msg"),this.ui.message.root.style.display="block",this.ui.message.modal.text.innerText=typeof e=="string"?e:e.message}createBusy(){const e=document.createElement("div");return e.classList.add("busy"),e}createState(){const e=document.createElement("div");e.classList.add("state"),e.style.display="none";const t=this.createBusy();return e.appendChild(t),{root:e,busy:t}}showState(){this.ui.state.root.style.display="block"}hideState(){this.ui.state.root.style.display="none"}updateState(e){e?this.hideState():this.showState()}createLayerUI(){const e=document.createElement("div");e.classList.add("ms-layer-ui");const t=this.createLoader();e.appendChild(t);const n=this.createMessage();e.appendChild(n.root);const s=this.createState();return e.appendChild(s.root),{root:e,loader:t,message:n,state:s}}createLayerRender(){const e=document.createElement("div");return e.classList.add("ms-layer-rendering"),e}destroy(){for(;this.root.lastChild;)this.root.removeChild(this.root.lastChild)}}var Ah;class Jb{constructor(e,t){k(this,"logger",Rt.getLogger(lt.EDITOR));k(this,"layers");k(this,"event");k(this,"info");De(this,Ah);var n,s;this.loggerConfiguration=Object.assign({},Zh,(n=t==null?void 0:t.configuration)==null?void 0:n.logger),this.logger.info("constructor",{rootElement:e,options:t}),this.event=new afe(e),this.layers=new lfe(e,((s=t==null?void 0:t.override)==null?void 0:s.cssClass)||"ms-editor"),e.editor=this}get loggerConfiguration(){return j(this,Ah)}set loggerConfiguration(e){Je(this,Ah,Object.assign({},Zh,e)),Rt.setLoggerLevel(j(this,Ah))}async loadInfo(e){return this.info||(this.info=await im({server:e})),this.info}}Ah=new WeakMap;(function(r){r.JIIX="application/vnd.myscript.jiix",r.TEXT="text/plain",r.LATEX="application/x-latex",r.MATHML="application/mathml+xml",r.SVG="image/svg+xml",r.OFFICE_DOCUMENT="application/vnd.openxmlformats-officedocument.presentationml.presentation"})(E0||(E0={})),function(r){r.Text="Text",r.Node="Node",r.Edge="Edge",r.RawContent="Raw Content"}(Df||(Df={})),function(r){r.Circle="circle",r.Ellipse="ellipse",r.Rectangle="rectangle",r.Triangle="triangle",r.Parallelogram="parallelogram",r.Polygon="polygon",r.Rhombus="rhombus"}(Us||(Us={})),function(r){r.Line="line",r.PolyEdge="polyedge",r.Arc="arc"}(da||(da={})),function(r){r.JIIX="application/vnd.myscript.jiix",r.TEXT="text/plain",r.LATEX="application/x-latex"}(vO||(vO={})),function(r){r.Circle="circle",r.Ellipse="ellipse",r.Rectangle="rectangle",r.Triangle="triangle",r.IsoscelesTriangle="isosceles triangle",r.RightTriangle="right triangle",r.RightIsoscelesTriangle="right isosceles triangle",r.EquilateralTriangle="equilateral triangle",r.Quadrilateral="quadrilateral",r.Trapezoid="trapezoid",r.Square="square",r.Parallelogram="parallelogram",r.Polygon="polygon",r.Rhombus="rhombus",r.Line="line",r.ArcOfEllipse="arc of ellipse",r.ArcOfCircle="arc of circle",r.PolyLine="polyline",r.Arrow="arrow",r.CurvedDoubleArrow="curved double arrow",r.CurvedArrow="curved arrow",r.PolylineArrow="polyline arrow",r.PolylineDoubleArrow="polyline double arrow",r.DoubleArrow="double arrow"}(bO||(bO={}));class at{constructor(e){k(this,"x");k(this,"y");k(this,"width");k(this,"height");if(e.width<0)throw new Error("width must be positive");if(e.height<0)throw new Error("height must be positive");this.height=e.height,this.width=e.width,this.x=e.x,this.y=e.y}static createFromBoxes(e){if(!(e!=null&&e.length))return new at({height:0,width:0,x:0,y:0});const t=Math.min(...e.map(i=>i.x)),n=Math.max(...e.map(i=>i.x+i.width))-t,s=Math.min(...e.map(i=>i.y)),o=Math.max(...e.map(i=>i.y+i.height))-s;return new at({x:t,y:s,width:n,height:o})}static createFromPoints(e){if(!(e!=null&&e.length))return new at({height:0,width:0,x:0,y:0});const t=Math.min(...e.map(i=>i.x)),n=Math.max(...e.map(i=>i.x))-t,s=Math.min(...e.map(i=>i.y)),o=Math.max(...e.map(i=>i.y))-s;return new at({x:t,y:s,width:n,height:o})}static getCorners(e){return[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}]}static getSide(e){return[{x:e.x+e.width/2,y:e.y},{x:e.x+e.width,y:e.y+e.height/2},{x:e.x+e.width/2,y:e.y+e.height},{x:e.x,y:e.y+e.height/2}]}static getCenter(e){return{x:e.x+e.width/2,y:e.y+e.height/2}}static getSides(e){const t=at.getCorners(e);return t.map((n,s)=>s===3?{p1:t[0],p2:n}:{p1:n,p2:t[s+1]})}static isContained(e,t){return ar(e.x,t.x,t.x+t.width)&&ar(e.x+e.width,t.x,t.x+t.width)&&ar(e.y,t.y,t.y+t.height)&&ar(e.y+e.height,t.y,t.y+t.height)}static containsPoint(e,t){return ar(t.x,e.x,e.x+e.width)&&ar(t.y,e.y,e.y+e.height)}static contains(e,t){return ar(t.x,e.x,e.x+e.width)&&ar(t.x+t.width,e.x,e.x+e.width)&&ar(t.y,e.y,e.y+e.height)&&ar(t.y+t.height,e.y,e.y+e.height)}static overlaps(e,t){return!(e.x>t.x+t.width)&&!(e.x+e.width<t.x)&&!(e.y>t.y+t.height)&&!(e.y+e.height<t.y)}get xMin(){return this.x}get xMid(){return this.x+this.width/2}get xMax(){return this.x+this.width}get yMin(){return this.y}get yMid(){return this.y+this.height/2}get yMax(){return this.y+this.height}get corners(){return at.getCorners(this)}get center(){return at.getCenter(this)}get side(){return at.getSide(this)}get snapPoints(){return[...this.corners,this.center]}isContained(e){return at.isContained(this,e)}contains(e){return at.contains(this,e)}containsPoint(e){return at.containsPoint(this,e)}overlaps(e){return at.overlaps(this,e)}}const Sn={width:2,color:"#000000"},aI={},lI={ink:{color:"#000000",width:1,"-myscript-pen-width":1,"-myscript-pen-fill-style":"none","-myscript-pen-fill-color":"#FFFFFF00"},".math":{"font-family":"STIXGeneral"},".math-solved":{"font-family":"STIXGeneral",color:"#A8A8A8FF"},".text":{"font-family":"MyScriptInter","font-size":10}};var b7=function(e,t){return e(t={exports:{}},t.exports),t.exports}(function(r,e){r.exports=function(t){function n(o){if(s[o])return s[o].exports;var i=s[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}var s={};return n.m=t,n.c=s,n.i=function(o){return o},n.d=function(o,i,a){n.o(o,i)||Object.defineProperty(o,i,{configurable:!1,enumerable:!0,get:a})},n.n=function(o){var i=o&&o.__esModule?function(){return o.default}:function(){return o};return n.d(i,"a",i),i},n.o=function(o,i){return Object.prototype.hasOwnProperty.call(o,i)},n.p="",n(n.s=1)}([function(t,n,s){function o(l,c){if(!(l instanceof c))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(l){return typeof l}:function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},a=function l(c){var u=this;o(this,l),this.toJSON=function(p){if(typeof p!="string")return console.error("Need a CSS string but given ",p===void 0?"undefined":i(p),p),"Not a valid CSS..!";var f={},m=void 0,v=void 0,b=void 0;try{p.split("{").forEach(function(S){if(v=S.trim())if(v.indexOf("}")===-1)f[v]={},m=v;else{v.substring(0,v.indexOf("}")).split(";").forEach(function(C){(b=C.split(":"))&&b.length===2&&(f[m][b[0].trim().replace(/^\"|\"$/g,"")]=u._trimSemiColon(b[1].trim().replace(/^\"|\"$/g,"")))});try{(m=v.split("}")[1].trim())&&(f[m]={})}catch{}}})}catch{return"Not a valid CSS..!"}return f},this.toCSS=function(p){if((p===void 0?"undefined":i(p))!=="object")return console.error("Need a JSON object but given ",p===void 0?"undefined":i(p),p),"Not a valid JSON..!";var f="";try{for(var m in p)if(p.hasOwnProperty(m)){for(var v in f+=m+` {
`,p[m])p[m].hasOwnProperty(v)&&(f+=v+": "+p[m][v]+`;
`);f+=`}
`}}catch{return"Not a valid JSON..!"}return f},this._trimSemiColon=function(p){return p.slice(-1)===";"?p.slice(0,u.length-1):p}};n.default=a},function(t,n,s){t.exports=s(0).default}])}),cfe=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(b7);b7.JsonCSS;const df=new cfe,_k={themeToCSS:r=>df.toCSS(r),themeToJSON(r){const e=df.toJSON(r);return e[".text"]["font-size"]=Number(e[".text"]["font-size"]),e.ink["-myscript-pen-width"]=Number(e.ink["-myscript-pen-width"]),e.ink.width=Number(e.ink.width),e},penStyleToCSS(r){let e=df.toCSS({css:r});return e=e.substring(6,e.length-3),e},penStyleToJSON(r){const e=df.toJSON(`css {${r}}`).css;return e.width?e.width=Number(e.width):delete e.width,e["-myscript-pen-width"]?e["-myscript-pen-width"]=Number(e["-myscript-pen-width"]):delete e["-myscript-pen-width"],e},stringToJSON:r=>df.toJSON(`css {${r}}`).css,JSONToString:r=>Object.entries(r).map(([e,t])=>`${e}:${t}`).join(";")};var jh,Rh,qd,Uc,za;class S7{constructor(e,t){De(this,jh);De(this,Rh);De(this,qd);De(this,Uc);De(this,za,Rt.getLogger(lt.STYLE));j(this,za).info("constructor",{penStyle:e,theme:t}),this.setTheme(t),this.setPenStyleClasses(),this.setPenStyle(e)}get currentPenStyle(){return j(this,Uc)||j(this,jh)}get penStyle(){return j(this,jh)}setPenStyle(e){j(this,za).info("setPenStyle",{style:e}),Je(this,jh,It(structuredClone(aI),e||{})),Je(this,Uc,e||this.theme[`.${j(this,qd)}`]),j(this,za).debug("setPenStyle",j(this,Uc))}get theme(){return j(this,Rh)}setTheme(e){j(this,za).info("setTheme",{theme:e}),Je(this,Rh,It(structuredClone(lI),e||{})),j(this,za).debug("setTheme",j(this,Rh))}get penStyleClasses(){return j(this,qd)}setPenStyleClasses(e=""){j(this,za).info("setPenStyleClasses",{penStyleClass:e}),Je(this,qd,e),Je(this,Uc,this.theme[`.${j(this,qd)}`]),j(this,za).debug("setPenStyleClasses",j(this,Uc))}}jh=new WeakMap,Rh=new WeakMap,qd=new WeakMap,Uc=new WeakMap,za=new WeakMap;var Qt,oe,jr,iu,mr,jn;(function(r){r.Highlight="highlight",r.Surround="surround",r.Underline="underline",r.Strikethrough="strikethrough"})(Qt||(Qt={}));class Pr{constructor(e,t){k(this,"id");k(this,"kind");k(this,"style");this.id=`${e}-${zo()}`,this.style=structuredClone(It({},Sn,t)),this.kind=e}clone(){const e=new Pr(this.kind,structuredClone(this.style));return e.id=this.id,e}}class Wd{constructor(e,t,n,s,o,i){k(this,"xx");k(this,"yx");k(this,"xy");k(this,"yy");k(this,"tx");k(this,"ty");this.xx=e,this.yx=t,this.xy=n,this.yy=s,this.tx=o,this.ty=i}static identity(){return new Wd(1,0,0,1,0,0)}static applyToPoint(e,t){return{x:e.xx*t.x+e.xy*t.y+e.tx,y:e.yx*t.x+e.yy*t.y+e.ty}}static rotation(e){let t;if(e.xx!==0||e.xy!==0){const n=Math.hypot(e.xx,e.xy);t=Math.acos(e.xx/n)*(e.xy>0?-1:1)}else if(e.yx!==0||e.yy!==0){const n=Math.hypot(e.yx,e.yy);t=Math.PI/2+Math.acos(e.yx/n)*(e.yy>0?-1:1)}else t=0;return t}static toCssString(e){return`matrix(${e.xx}, ${e.yx}, ${e.xy}, ${e.yy}, ${e.tx}, ${e.ty})`}invert(){const{xx:e,yx:t,xy:n,yy:s,tx:o,ty:i}=this,a=e*s-t*n;return this.xx=s/a,this.yx=t/-a,this.xy=n/-a,this.yy=e/a,this.tx=(s*o-n*i)/-a,this.ty=(t*o-e*i)/a,this}multiply(e){const{xx:t,yx:n,xy:s,yy:o,tx:i,ty:a}=this;return this.xx=t*e.xx+s*e.yx,this.yx=n*e.xx+o*e.yx,this.xy=t*e.xy+s*e.yy,this.yy=n*e.xy+o*e.yy,this.tx=t*e.tx+s*e.ty+i,this.ty=n*e.tx+o*e.ty+a,this}translate(e,t){return this.multiply({xx:1,yx:0,xy:0,yy:1,tx:e,ty:t})}rotate(e,t){t&&this.translate(t.x,t.y);const n=Math.round(1e3*Math.cos(e))/1e3,s=Math.round(1e3*Math.sin(e))/1e3;return this.multiply({xx:n,yx:s,xy:-s,yy:n,tx:0,ty:0}),t&&this.translate(-t.x,-t.y),this}scale(e,t,n){return n&&this.translate(n.x,n.y),this.multiply({xx:e,yx:0,xy:0,yy:t,tx:0,ty:0}),n&&this.translate(-n.x,-n.y),this}applyToPoint(e){return Wd.applyToPoint(this,e)}clone(){return new Wd(this.xx,this.yx,this.xy,this.yy,this.tx,this.ty)}toCssString(){return Wd.toCssString(this)}}class _u{constructor(e,t){k(this,"type");k(this,"style");k(this,"id");k(this,"creationTime");k(this,"modificationDate");k(this,"selected");k(this,"deleting");k(this,"transform");this.type=e,this.id=`${this.type}-${zo()}`,this.creationTime=Date.now(),this.modificationDate=this.creationTime,this.selected=!1,this.deleting=!1,this.transform=Wd.identity(),this.style=Object.assign({},Sn,t),this.style.opacity&&(this.style.opacity=+this.style.opacity),this.style.width=+this.style.width}get edges(){return this.isClosed?this.vertices.map((e,t)=>t===this.vertices.length-1?{p1:e,p2:this.vertices[0]}:{p1:e,p2:this.vertices[t+1]}):this.vertices.slice(0,-1).map((e,t)=>({p1:e,p2:this.vertices[t+1]}))}isIntersected(e){return this.edges.some(t=>om(t,e))}}(function(r){r.Stroke="stroke",r.Group="group",r.Shape="shape",r.Edge="edge",r.Text="text",r.Eraser="eraser",r.Recognized="recognized"})(oe||(oe={})),function(r){r.Line="line",r.PolyEdge="polyedge",r.Arc="arc"}(jr||(jr={})),function(r){r.Arrow="arrow-head"}(iu||(iu={}));class cI extends _u{constructor(t,n,s,o){super(oe.Edge,o);k(this,"kind");k(this,"isClosed",!1);k(this,"startDecoration");k(this,"endDecoration");this.kind=t,this.startDecoration=n,this.endDecoration=s}get bounds(){const t=at.createFromPoints(this.vertices);return t.x-=5,t.y-=5,t.height+=zs,t.width+=zs,(this.startDecoration||this.endDecoration)&&(t.x-=2.5*(this.style.width||1),t.y-=2.5*(this.style.width||1),t.height+=5*(this.style.width||1),t.width+=5*(this.style.width||1)),t}get snapPoints(){return this.vertices}overlaps(t){return this.bounds.isContained(t)||this.edges.some(n=>at.getSides(t).some(s=>!!om(n,s)))}}function cd(r){return!!r&&!!Ul(r.x)&&!!Ul(r.y)}class ng extends cI{constructor(t,n,s,o,i,a,l,c,u){super(jr.Arc,l,c,u);k(this,"center");k(this,"startAngle");k(this,"sweepAngle");k(this,"radiusX");k(this,"radiusY");k(this,"phi");k(this,"_vertices");this.center=t,this.startAngle=n,this.sweepAngle=s,this.radiusX=o,this.radiusY=i,this.phi=a,this._vertices=new Map,this._vertices.set(this.verticesId,this.computedVertices())}get verticesId(){return`${this.center.x}-${this.center.y}-${this.startAngle}-${this.sweepAngle}-${this.radiusX}-${this.radiusY}-${this.phi}`}computedVertices(){const t=Math.abs(this.sweepAngle)*Math.sqrt((Math.pow(this.radiusX,2)+Math.pow(this.radiusY,2))/2),n=Math.max(8,Math.round(t/zs)),s=this.sweepAngle/n,o=[],i=this.startAngle+this.sweepAngle;if(this.sweepAngle>0)for(let a=this.startAngle;a<i;a+=s)o.push(_v(this.center,this.radiusX,this.radiusY,this.phi,a));else for(let a=this.startAngle;a>i;a+=s)o.push(_v(this.center,this.radiusX,this.radiusY,this.phi,a));return o.push(_v(this.center,this.radiusX,this.radiusY,this.phi,i)),o}get vertices(){return this._vertices.has(this.verticesId)||this._vertices.set(this.verticesId,this.computedVertices()),this._vertices.get(this.verticesId)}get snapPoints(){return[this.vertices[0],this.vertices.at(-1)]}clone(){const t=new ng(structuredClone(this.center),this.startAngle,this.sweepAngle,this.radiusX,this.radiusY,this.phi,this.startDecoration,this.endDecoration,structuredClone(this.style));return t.id=this.id,t.selected=this.selected,t.deleting=this.deleting,t.creationTime=this.creationTime,t.modificationDate=this.modificationDate,t}toJSON(){return{id:this.id,type:this.type,kind:this.kind,center:this.center,startAngle:this.startAngle,sweepAngle:this.sweepAngle,radiusX:this.radiusX,radiusY:this.radiusY,phi:this.phi,startDecoration:this.startDecoration,style:this.style,endDecoration:this.endDecoration}}static create(t){if(!cd(t==null?void 0:t.center))throw new Error("Unable to create a arc, center point is invalid");if(!Ul(t==null?void 0:t.startAngle))throw new Error("Unable to create a arc, startAngle is invalid");if(!Ul(t==null?void 0:t.sweepAngle))throw new Error("Unable to create a arc, sweepAngle is invalid");if(!Ul(t==null?void 0:t.radiusX))throw new Error("Unable to create a arc, radiusX is invalid");if(!Ul(t==null?void 0:t.radiusY))throw new Error("Unable to create a arc, radiusY is invalid");const n=new ng(t==null?void 0:t.center,t.startAngle,t.sweepAngle,t.radiusX,t.radiusY,t.phi||0,t.startDecoration,t.endDecoration,t.style);return t.id&&(n.id=t.id),n}}class Jh extends cI{constructor(t,n,s,o,i){super(jr.Line,s,o,i);k(this,"start");k(this,"end");this.start=t,this.end=n}get vertices(){return[this.start,this.end]}clone(){const t=new Jh(structuredClone(this.start),structuredClone(this.end),this.startDecoration,this.endDecoration,structuredClone(this.style));return t.id=this.id,t.selected=this.selected,t.deleting=this.deleting,t.creationTime=this.creationTime,t.modificationDate=this.modificationDate,t}toJSON(){return{id:this.id,type:this.type,kind:this.kind,start:this.start,end:this.end,style:this.style,startDecoration:this.startDecoration,endDecoration:this.endDecoration}}static create(t){if(!cd(t==null?void 0:t.start))throw new Error("Unable to create a arc, start point is invalid");if(!cd(t==null?void 0:t.end))throw new Error("Unable to create a arc, end point is invalid");const n=new Jh(t==null?void 0:t.start,t==null?void 0:t.end,t.startDecoration,t.endDecoration,t.style);return t.id&&(n.id=t.id),n}}class rg extends cI{constructor(t,n,s,o){super(jr.PolyEdge,n,s,o);k(this,"points");this.points=t}get vertices(){return this.points}clone(){const t=new rg(structuredClone(this.points),this.startDecoration,this.endDecoration,structuredClone(this.style));return t.id=this.id,t.selected=this.selected,t.deleting=this.deleting,t.creationTime=this.creationTime,t.modificationDate=this.modificationDate,t}toJSON(){return{id:this.id,type:this.type,kind:this.kind,points:this.points,style:this.style,startDecoration:this.startDecoration,endDecoration:this.endDecoration}}static create(t){var s;if(!((s=t==null?void 0:t.points)!=null&&s.map(o=>cd(o))))throw new Error("Unable to create a PolyLine, points are invalid");const n=new rg(t==null?void 0:t.points,t.startDecoration,t.endDecoration,t.style);return t.id&&(n.id=t.id),n}}(function(r){r.Circle="circle",r.Ellipse="ellipse",r.Polygon="polygon",r.Table="table"})(mr||(mr={}));class dI extends _u{constructor(t,n){super(oe.Shape,n);k(this,"kind");k(this,"isClosed",!0);this.kind=t}get bounds(){return at.createFromPoints(this.vertices)}get snapPoints(){return this.bounds.snapPoints}overlaps(t){return this.bounds.isContained(t)||this.edges.some(n=>at.getSides(t).some(s=>!!om(n,s)))}}class ed extends dI{constructor(t,n,s){super(mr.Circle,s);k(this,"center");k(this,"radius");k(this,"_vertices");k(this,"_bounds");this.center=t,this.radius=n,this._vertices=new Map,this._vertices.set(this.verticesId,this.computedVertices()),this._bounds=new Map,this._bounds.set(this.verticesId,this.computedBondingBox())}get verticesId(){return`${this.center.x}-${this.center.y}-${this.radius}`}computedVertices(){const t={x:this.center.x,y:this.radius+this.center.y},n=2*Math.PI*this.radius,s=Math.max(8,Math.round(n/zs)),o=[];for(let i=0;i<s;i++){const a=2*Math.PI*(i/s);o.push(Ai(t,this.center,a))}return o}computedBondingBox(){const t={x:this.center.x-this.radius,y:this.center.y-this.radius,height:2*this.radius,width:2*this.radius};return new at(t)}get bounds(){return this._bounds.has(this.verticesId)||this._bounds.set(this.verticesId,this.computedBondingBox()),this._bounds.get(this.verticesId)}get vertices(){return this._vertices.has(this.verticesId)||this._vertices.set(this.verticesId,this.computedVertices()),this._vertices.get(this.verticesId)}overlaps(t){return this.bounds.isContained(t)||at.getSides(t).some(n=>efe(n,this.center,this.radius).length)}clone(){const t=new ed(structuredClone(this.center),this.radius,structuredClone(this.style));return t.id=this.id,t.selected=this.selected,t.deleting=this.deleting,t.creationTime=this.creationTime,t.modificationDate=this.modificationDate,t}toJSON(){return{id:this.id,type:this.type,kind:this.kind,center:this.center,radius:this.radius,style:this.style}}static createBetweenPoints(t,n,s){const o={x:(t.x+n.x)/2,y:(t.y+n.y)/2},i=Math.abs(t.x-n.x),a=Math.abs(t.y-n.y),l=Math.min(i,a)/2;return new ed(o,l,s)}static updateBetweenPoints(t,n,s){t.center={x:(n.x+s.x)/2,y:(n.y+s.y)/2};const o=Math.abs(n.x-s.x),i=Math.abs(n.y-s.y);return t.radius=Math.min(o,i)/2,t}static create(t){if(!cd(t.center))throw new Error("Unable to create circle, center is invalid");if(!Ul(t.radius))throw new Error("Unable to create circle, radius is undefined");const n=new ed(t.center,t.radius,t.style);return t.id&&(n.id=t.id),n}}class td extends dI{constructor(t,n,s,o,i){super(mr.Ellipse,i);k(this,"center");k(this,"radiusX");k(this,"radiusY");k(this,"orientation");k(this,"_vertices");this.center=t,this.radiusX=n,this.radiusY=s,this.orientation=o,this._vertices=new Map}get verticesId(){return`${this.center.x}-${this.center.y}-${this.radiusX}-${this.radiusY}-${this.orientation}`}computedVertices(){const t=[],n=2*Math.PI*Math.sqrt((Math.pow(this.radiusX,2)+Math.pow(this.radiusY,2))/2),s=Math.max(8,Math.round(n/zs));for(let o=0;o<s;o++){const i=2*Math.PI*(o/s);t.push(_v(this.center,this.radiusX,this.radiusY,this.orientation,i))}return t}get vertices(){return this._vertices.has(this.verticesId)||this._vertices.set(this.verticesId,this.computedVertices()),this._vertices.get(this.verticesId)}overlaps(t){return this.bounds.isContained(t)||this.edges.some(n=>at.getSides(t).some(s=>!!om(n,s)))}clone(){const t=new td(structuredClone(this.center),this.radiusX,this.radiusY,this.orientation,structuredClone(this.style));return t.id=this.id,t.selected=this.selected,t.deleting=this.deleting,t.creationTime=this.creationTime,t.modificationDate=this.modificationDate,t}toJSON(){return{id:this.id,type:this.type,kind:this.kind,center:this.center,orientation:this.orientation,radiusX:this.radiusX,radiusY:this.radiusY,style:this.style}}static createBetweenPoints(t,n,s){const o={x:(t.x+n.x)/2,y:(t.y+n.y)/2},i=Math.abs(t.x-n.x)/2,a=Math.abs(t.y-n.y)/2;return new td(o,i,a,0,s)}static updateBetweenPoints(t,n,s){return t.center={x:(n.x+s.x)/2,y:(n.y+s.y)/2},t.radiusX=Math.abs(n.x-s.x)/2,t.radiusY=Math.abs(n.y-s.y)/2,t}static create(t){if(!cd(t.center))throw new Error("Unable to create ellipse, center is undefined");if(!Ul(t.radiusX))throw new Error("Unable to create ellipse, radiusX is undefined");if(!Ul(t.radiusY))throw new Error("Unable to create ellipse, radiusY is undefined");const n=new td(t.center,t.radiusX,t.radiusY,t.orientation||0,t.style);return t.id&&(n.id=t.id),n}}class Ir extends dI{constructor(t,n){super(mr.Polygon,n);k(this,"points");this.points=t}get vertices(){return this.points}get bounds(){return at.createFromPoints(this.vertices)}clone(){const t=new Ir(structuredClone(this.points),structuredClone(this.style));return t.id=this.id,t.selected=this.selected,t.deleting=this.deleting,t.creationTime=this.creationTime,t.modificationDate=this.modificationDate,t}toJSON(){return{id:this.id,type:this.type,kind:this.kind,points:this.points,style:this.style}}static create(t){var s,o;if(!(t!=null&&t.points)||((s=t==null?void 0:t.points)==null?void 0:s.length)<3)throw new Error("Unable to create polygon at least 3 points required");if((o=t==null?void 0:t.points)!=null&&o.some(i=>!cd(i)))throw new Error("Unable to create a polygon, one or more points are invalid");const n=new Ir(t.points,t.style);return t.id&&(n.id=t.id),n}static createTriangleBetweenPoints(t,n,s){const o=[{x:t.x,y:t.y},{x:n.x,y:t.y},{x:(t.x+n.x)/2,y:n.y}];return new Ir(o,s)}static updateTriangleBetweenPoints(t,n,s){return t.points=[{x:n.x,y:n.y},{x:s.x,y:n.y},{x:(n.x+s.x)/2,y:s.y}],t.modificationDate=Date.now(),t}static createParallelogramBetweenPoints(t,n,s){const o=[{x:t.x,y:t.y},{x:t.x+.75*(n.x-t.x),y:t.y},{x:n.x,y:n.y},{x:t.x+.25*(n.x-t.x),y:n.y}];return new Ir(o,s)}static updateParallelogramBetweenPoints(t,n,s){const o=[{x:n.x,y:n.y},{x:n.x+.75*(s.x-n.x),y:n.y},{x:s.x,y:s.y},{x:n.x+.25*(s.x-n.x),y:s.y}];return t.points=o,t.modificationDate=Date.now(),t}static createRectangleBetweenPoints(t,n,s){const o=at.createFromPoints([t,n]),i=[{x:o.xMin,y:o.yMin},{x:o.xMax,y:o.yMin},{x:o.xMax,y:o.yMax},{x:o.xMin,y:o.yMax}];return new Ir(i,s)}static updateRectangleBetweenPoints(t,n,s){const o=at.createFromPoints([n,s]),i=[{x:o.xMin,y:o.yMin},{x:o.xMax,y:o.yMin},{x:o.xMax,y:o.yMax},{x:o.xMin,y:o.yMax}];return t.points=i,t.modificationDate=Date.now(),t}static createRhombusBetweenPoints(t,n,s){const o=at.createFromPoints([t,n]),i=[{x:o.xMid,y:o.yMin},{x:o.xMax,y:o.yMid},{x:o.xMid,y:o.yMax},{x:o.xMin,y:o.yMid}];return new Ir(i,s)}static updateRhombusBetweenPoints(t,n,s){const o=at.createFromPoints([n,s]),i=[{x:o.xMid,y:o.yMin},{x:o.xMax,y:o.yMid},{x:o.xMid,y:o.yMax},{x:o.xMin,y:o.yMid}];return t.points=i,t.modificationDate=Date.now(),t}}class Jn extends _u{constructor(t,n="pen"){super(oe.Stroke,t);k(this,"isClosed",!1);k(this,"pointerType");k(this,"length");k(this,"decorators");k(this,"pointers");this.pointerType=n,this.pointers=[],this.decorators=[],this.length=0}get bounds(){return at.createFromPoints(this.vertices)}static split(t,n){const s=new Jn(t.style,t.pointerType);s.pointers=t.pointers.slice(0,n);const o=new Jn(t.style,t.pointerType);return o.pointers=t.pointers.slice(n),{before:s,after:o}}static substract(t,n){var u,p;if(!n.length)return{before:t};const s={},o={x:n.pointers[0].x,y:n.pointers[0].y},i=yO(t.pointers,o);if(i.index>-1){const f=Jn.split(t,i.index);s.before=f.before,s.after=f.after}const a=s.after||t,l={x:n.pointers.at(-1).x,y:n.pointers.at(-1).y},c=yO(a.pointers,l);if(c.index>-1){const f=Jn.split(a,c.index);s.after=f.after}return(u=s.before)!=null&&u.pointers.length||(s.before=void 0),(p=s.after)!=null&&p.pointers.length||(s.after=void 0),s}get snapPoints(){return this.bounds.snapPoints}get vertices(){return this.pointers}computePressure(t){let n=1;t===this.length?n=1:t<10?n=.2+Math.pow(.1*t,.4):t>this.length-10&&(n=.2+Math.pow(.1*(this.length-t),.4));const s=n*Math.max(.1,1-.1*Math.sqrt(t));return isNaN(s)?.5:Math.round(100*s)/100}filterPointByAcquisitionDelta(t){const n=this.pointers.at(-1),s=2+(this.style.width||1)/4;return!n||Math.abs(n.x-t.x)>=s||Math.abs(n.y-t.y)>=s}addPointer(t){if(this.filterPointByAcquisitionDelta(t)){const n=this.pointers.at(-1),s=n?tg(t,n):0;this.length+=s,t.p=this.computePressure(s),this.pointers.push(t),this.modificationDate=Date.now()}}overlaps(t){return this.pointers.some(n=>n.x>=t.x&&n.x<=t.x+t.width&&n.y>=t.y&&n.y<=t.y+t.height)}clone(){const t=new Jn(this.style,this.pointerType);return t.id=this.id,t.selected=this.selected,t.deleting=this.deleting,t.creationTime=this.creationTime,t.modificationDate=this.modificationDate,t.pointers=structuredClone(this.pointers),t.decorators=this.decorators.map(n=>n.clone()),t.length=this.length,t}formatToSend(){const t={id:this.id,pointerType:this.pointerType,p:[],t:[],x:[],y:[]};return this.pointers.forEach(n=>{t.p.push(n.p),t.t.push(n.t),t.x.push(n.x),t.y.push(n.y)}),t}toJSON(){return{id:this.id,type:this.type,pointers:this.pointers,style:this.style,decorators:this.decorators.length?this.decorators:void 0}}static create(t){var i,a,l;if(!((i=t.pointers)!=null&&i.length))throw new Error("not pointers");const n=new Jn(t.style,t.pointerType);t.id&&(n.id=t.id);const s=[];let o=!0;if((a=t.pointers)==null||a.forEach((c,u)=>{if(!c)return s.push(`no pointer at ${u}`),void(o=!1);const p={p:c.p||1,t:c.t||u,x:0,y:0};return(c==null?void 0:c.x)==null||(c==null?void 0:c.x)==null?(s.push(`no x at pointer at ${u}`),void(o=!1)):(p.x=c.x,(c==null?void 0:c.y)==null||(c==null?void 0:c.y)==null?(s.push(`no y at pointer at ${u}`),void(o=!1)):(p.y=c.y,void(o&&n.addPointer(p))))}),s.length)throw new Error(s.join(" and "));return(l=t.decorators)!=null&&l.length&&t.decorators.forEach(c=>{c!=null&&c.kind&&n.decorators.push(new Pr(c.kind,Object.assign({},n.style,c.style)))}),n}}function dfe(r){const e=[],t=[];if(r.forEach((n,s)=>{try{t.push(Jn.create(n))}catch(o){e.push(`stroke ${s+1} has ${o.message}`)}}),e.length)throw new Error(e.join(`
`));return t}(function(r){r.Text="text",r.Line="line",r.PolyEdge="polyedge",r.Arc="arc",r.Circle="circle",r.Ellipse="ellipse",r.Polygone="polygone"})(jn||(jn={}));class Tu extends _u{constructor(t,n,s){super(oe.Recognized,s);k(this,"kind");k(this,"strokes");this.kind=t,this.strokes=n}get vertices(){return this.strokes.flatMap(t=>t.vertices)}get bounds(){return at.createFromBoxes(this.strokes.map(t=>t.bounds))}get snapPoints(){return this.bounds.snapPoints}updateChildrenStyle(){this.strokes.forEach(t=>t.style=Object.assign({},t.style,this.style))}overlaps(t){return this.strokes.some(n=>n.overlaps(t))}containsStroke(t){return this.strokes.some(n=>n.id===t)}removeStrokes(t){const n=this.strokes.filter(s=>t.includes(s.id));return this.strokes=this.strokes.filter(s=>!t.includes(s.id)),n}}class sg extends Tu{constructor(t,n){super(jn.Arc,t,n);k(this,"isClosed",!1)}clone(){const t=new sg(this.strokes.map(n=>n.clone()),structuredClone({...this.style}));return t.id=this.id,t.selected=this.selected,t.deleting=this.deleting,t.creationTime=this.creationTime,t.modificationDate=this.modificationDate,t}toJSON(){return{id:this.id,type:this.type,kind:this.kind,strokes:JSON.parse(JSON.stringify(this.strokes))}}static create(t){var o;if(!((o=t.strokes)!=null&&o.length))throw new Error("no strokes");const n=t.strokes.map(i=>Jn.create(i)),s=new sg(n,t.style);return t.id&&(s.id=t.id),s}}class og extends Tu{constructor(t,n){super(jn.Circle,t,n);k(this,"isClosed",!0)}clone(){const t=new og(this.strokes.map(n=>n.clone()),structuredClone({...this.style}));return t.id=this.id,t.selected=this.selected,t.deleting=this.deleting,t.creationTime=this.creationTime,t.modificationDate=this.modificationDate,t}toJSON(){return{id:this.id,type:this.type,kind:this.kind,strokes:JSON.parse(JSON.stringify(this.strokes))}}static create(t){var o;if(!((o=t.strokes)!=null&&o.length))throw new Error("no strokes");const n=t.strokes.map(i=>Jn.create(i)),s=new og(n,t.style);return t.id&&(s.id=t.id),s}}class ig extends Tu{constructor(t,n){super(jn.Ellipse,t,n);k(this,"isClosed",!0)}clone(){const t=new ig(this.strokes.map(n=>n.clone()),structuredClone({...this.style}));return t.id=this.id,t.selected=this.selected,t.deleting=this.deleting,t.creationTime=this.creationTime,t.modificationDate=this.modificationDate,t}toJSON(){return{id:this.id,type:this.type,kind:this.kind,strokes:JSON.parse(JSON.stringify(this.strokes))}}static create(t){var o;if(!((o=t.strokes)!=null&&o.length))throw new Error("no strokes");const n=t.strokes.map(i=>Jn.create(i)),s=new ig(n,t.style);return t.id&&(s.id=t.id),s}}class ag extends Tu{constructor(t,n){super(jn.Line,t,n);k(this,"isClosed",!1)}clone(){const t=new ag(this.strokes.map(n=>n.clone()),structuredClone({...this.style}));return t.id=this.id,t.selected=this.selected,t.deleting=this.deleting,t.creationTime=this.creationTime,t.modificationDate=this.modificationDate,t}toJSON(){return{id:this.id,type:this.type,kind:this.kind,strokes:JSON.parse(JSON.stringify(this.strokes))}}static create(t){var o;if(!((o=t.strokes)!=null&&o.length))throw new Error("no strokes");const n=t.strokes.map(i=>Jn.create(i)),s=new ag(n,t.style);return t.id&&(s.id=t.id),s}}class lg extends Tu{constructor(t,n){super(jn.PolyEdge,t,n);k(this,"isClosed",!1)}clone(){const t=new lg(this.strokes.map(n=>n.clone()),structuredClone({...this.style}));return t.id=this.id,t.selected=this.selected,t.deleting=this.deleting,t.creationTime=this.creationTime,t.modificationDate=this.modificationDate,t}toJSON(){return{id:this.id,type:this.type,kind:this.kind,strokes:JSON.parse(JSON.stringify(this.strokes))}}static create(t){var o;if(!((o=t.strokes)!=null&&o.length))throw new Error("no strokes");const n=t.strokes.map(i=>Jn.create(i)),s=new lg(n,t.style);return t.id&&(s.id=t.id),s}}class cg extends Tu{constructor(t,n){super(jn.Polygone,t,n);k(this,"isClosed",!0)}clone(){const t=new cg(this.strokes.map(n=>n.clone()),structuredClone({...this.style}));return t.id=this.id,t.selected=this.selected,t.deleting=this.deleting,t.creationTime=this.creationTime,t.modificationDate=this.modificationDate,t}toJSON(){return{id:this.id,type:this.type,kind:this.kind,strokes:JSON.parse(JSON.stringify(this.strokes))}}static create(t){var o;if(!((o=t.strokes)!=null&&o.length))throw new Error("no strokes");const n=t.strokes.map(i=>Jn.create(i)),s=new cg(n,t.style);return t.id&&(s.id=t.id),s}}class tl extends Tu{constructor(t,n,s){super(jn.Text,t,s);k(this,"isClosed",!1);k(this,"decorators");k(this,"baseline");k(this,"xHeight");k(this,"label");this.baseline=n.baseline,this.xHeight=n.xHeight,this.decorators=[]}clone(){const t=new tl(this.strokes.map(n=>n.clone()),{baseline:this.baseline,xHeight:this.xHeight},structuredClone({...this.style}));return t.id=this.id,t.label=this.label,t.selected=this.selected,t.deleting=this.deleting,t.creationTime=this.creationTime,t.modificationDate=this.modificationDate,t.decorators=this.decorators.map(n=>n.clone()),t}toJSON(){return{id:this.id,type:this.type,kind:this.kind,label:this.label,baseline:this.baseline,xHeight:this.xHeight,strokes:JSON.parse(JSON.stringify(this.strokes)),decorators:this.decorators.length?JSON.parse(JSON.stringify(this.decorators)):void 0}}static create(t){var i,a;if(!((i=t.strokes)!=null&&i.length))throw new Error("no strokes");const n=t.strokes.map(l=>Jn.create(l)),s={baseline:t.baseline||0,xHeight:t.xHeight||0},o=new tl(n,s,t.style);return(a=t.decorators)!=null&&a.length&&t.decorators.forEach(l=>{l!=null&&l.kind&&o.decorators.push(new Pr(l.kind,Object.assign({},o.style,l.style)))}),t.id&&(o.id=t.id),o}}class Gr extends _u{constructor(t,n){super(oe.Group,n);k(this,"isClosed",!1);k(this,"children");k(this,"decorators");this.children=t,this.decorators=[]}get snapPoints(){return this.bounds.snapPoints}get vertices(){return this.children.flatMap(t=>t.vertices)}get bounds(){return at.createFromBoxes(this.children.map(t=>t.bounds))}updateChildrenStyle(){this.children.forEach(t=>{switch(t.style=Object.assign({},t.style,this.style),t.type){case oe.Group:t.updateChildrenStyle();break;case oe.Text:t.chars.forEach(n=>{t.style.color&&(n.color=t.style.color)});break;case oe.Recognized:t.updateChildrenStyle()}})}overlaps(t){return this.children.some(n=>n.overlaps(t))}containsSymbol(t){return Gr.containsSymbol(this,t)}containsOnlyStroke(){return Gr.containsOnlyStroke(this)}extractText(){return Gr.extractText(this)}extractStrokes(){return Gr.extractStrokes(this)}removeChilds(t){return Gr.removeChilds(this,t)}static containsOnlyStroke(t){return t.children.every(n=>n.type===oe.Group?Gr.containsOnlyStroke(n):n.type===oe.Stroke)}static extractText(t){const n=[];return t.children.forEach(s=>{switch(s.type){case oe.Text:n.push(s);break;case oe.Group:n.push(...Gr.extractText(s))}}),n}static extractStrokes(t){const n=[];return t.children.forEach(s=>{switch(s.type){case oe.Stroke:n.push(s);break;case oe.Recognized:n.push(...s.strokes);break;case oe.Group:n.push(...Gr.extractStrokes(s))}}),n}static containsSymbol(t,n){return t.children.some(s=>s.id===n||(s.type===oe.Group?Gr.containsSymbol(s,n):s.type===oe.Recognized&&s.containsStroke(n)))}static removeChilds(t,n){return t.children=t.children.filter(s=>!n.includes(s.id)),t.children.slice().forEach(s=>{s.type===oe.Group?s.removeChilds(n).children.length||(t.children=t.children.filter(o=>o.id!==s.id)):s.type===oe.Recognized&&(s.removeStrokes(n),s.strokes.length||t.removeChilds([s.id]))}),t}clone(){const t=new Gr(this.children.map(n=>n.clone()),structuredClone({...this.style}));return t.id=this.id,t.selected=this.selected,t.deleting=this.deleting,t.creationTime=this.creationTime,t.modificationDate=this.modificationDate,t.decorators=this.decorators.map(n=>n.clone()),t}toJSON(){return{id:this.id,type:this.type,children:JSON.parse(JSON.stringify(this.children)),decorators:this.decorators.length?JSON.parse(JSON.stringify(this.decorators)):void 0}}}class ol extends _u{constructor(t,n,s,o){super(oe.Text,o);k(this,"isClosed",!0);k(this,"point");k(this,"chars");k(this,"decorators");k(this,"bounds");k(this,"rotation");this.point=n,this.bounds=new at(s),this.chars=t,this.decorators=[]}get label(){return this.chars.map(t=>t.label).join("")}get vertices(){if(this.rotation){const t=this.rotation.center,n=Iv(-this.rotation.degree);return this.bounds.corners.map(s=>Ai(s,t,n))}return this.bounds.corners}get snapPoints(){const t=this.bounds.yMax-this.point.y,n=[{x:this.bounds.x,y:this.bounds.yMin+t},{x:this.bounds.xMax,y:this.bounds.yMin+t},{x:this.bounds.xMax,y:this.bounds.yMax-t},{x:this.bounds.x,y:this.bounds.yMax-t},this.bounds.center];if(this.rotation){const s=this.rotation.center,o=Iv(-this.rotation.degree);return n.map(i=>Ai(i,s,o))}return n}getCharCorners(t){const n=new at(t.bounds);if(this.rotation){const s=this.rotation.center,o=Iv(-this.rotation.degree);return n.corners.map(i=>Ai(i,s,o))}return n.corners}updateChildrenStyle(){this.chars.forEach(t=>{this.style.color&&(t.color=this.style.color)}),this.modificationDate=Date.now()}updateChildrenFont({fontSize:t,fontWeight:n}){this.chars.forEach(s=>{t&&(s.fontSize=t),n&&(s.fontWeight=n)}),this.modificationDate=Date.now()}getCharsOverlaps(t){return this.chars.filter(n=>{const s=this.getCharCorners(n);return t.some(o=>rfe(o,s))})}overlaps(t){return this.vertices.some(n=>at.containsPoint(t,n))||this.edges.some(n=>at.getSides(t).some(s=>!!om(n,s)))}clone(){const t=new ol(structuredClone(this.chars),structuredClone(this.point),this.bounds,structuredClone(this.style));return t.id=this.id,t.selected=this.selected,t.deleting=this.deleting,t.creationTime=this.creationTime,t.modificationDate=this.modificationDate,t.decorators=this.decorators.map(n=>n.clone()),t.rotation=this.rotation?structuredClone(this.rotation):void 0,t}toJSON(){return{id:this.id,type:this.type,point:this.point,chars:this.chars,style:this.style,rotation:this.rotation,bounds:this.bounds,decorators:this.decorators.length?this.decorators:void 0}}static create(t){var s,o;if(!cd(t==null?void 0:t.point))throw new Error("Unable to create a IIText, point are invalid");if(!((s=t.chars)!=null&&s.length))throw new Error("Unable to create a IIText, no chars");if(!t.bounds)throw new Error("Unable to create a IIText, no boundingBox");const n=new ol(t.chars,t.point,t.bounds,t.style);return t.id&&(n.id=t.id),(o=t.decorators)!=null&&o.length&&t.decorators.forEach(i=>{i!=null&&i.kind&&n.decorators.push(new Pr(i.kind,Object.assign({},n.style,i.style)))}),n}}const ufe={color:"grey",fill:"none",width:12,opacity:.2};class uI extends _u{constructor(){super(oe.Eraser,ufe);k(this,"isClosed",!1);k(this,"pointers");this.id=`${this.type}-${zo()}`,this.creationTime=Date.now(),this.modificationDate=this.creationTime,this.pointers=[]}get bounds(){return at.createFromPoints(this.vertices)}get vertices(){return this.pointers}get snapPoints(){return[]}clone(){const t=new uI;return t.id=this.id,t.creationTime=this.creationTime,t.modificationDate=this.modificationDate,t.pointers=structuredClone(this.pointers),t}overlaps(t){return this.pointers.some(n=>n.x>=t.x&&n.x<=t.x+t.width&&n.y>=t.y&&n.y<=t.y+t.height)}toJSON(){return{id:this.id,pointers:this.pointers,style:this.style}}}class am{constructor(e,t="pen"){k(this,"type",oe.Stroke);k(this,"id");k(this,"creationTime");k(this,"modificationDate");k(this,"style");k(this,"pointerType");k(this,"pointers");k(this,"length");this.id=`${this.type}-${zo()}`,this.creationTime=Date.now(),this.modificationDate=this.creationTime,this.style=e,this.pointerType=t,this.pointers=[],this.length=0}clone(){const e=new am(this.style,this.pointerType);return e.id=this.id,e.creationTime=this.creationTime,e.modificationDate=this.modificationDate,e.pointers=structuredClone(this.pointers),e.length=this.length,e}formatToSend(){const e={id:this.id,pointerType:this.pointerType,p:[],t:[],x:[],y:[]};return this.pointers.forEach(t=>{e.p.push(t.p),e.t.push(t.t),e.x.push(t.x),e.y.push(t.y)}),e}}var yn;const mI=class mI{constructor(e=100,t=100,n=0,s=Date.now()){k(this,"creationTime");k(this,"modificationDate");k(this,"positions");k(this,"currentSymbol");k(this,"symbols");k(this,"exports");k(this,"converts");k(this,"width");k(this,"height");k(this,"rowHeight");k(this,"idle");De(this,yn,Rt.getLogger(lt.MODEL));j(this,yn).info("constructor",{width:e,height:t,creationDate:s}),this.creationTime=s,this.modificationDate=s,this.width=e,this.height=t,this.rowHeight=n,this.symbols=[],this.positions={lastSentPosition:0,lastReceivedPosition:0},this.idle=!0}computePressure(e,t){let n=1;e===t?n=1:e<10?n=.2+Math.pow(.1*e,.4):e>t-10&&(n=.2+Math.pow(.1*(t-e),.4));const s=n*Math.max(.1,1-.1*Math.sqrt(e));return isNaN(s)?.5:Math.round(100*s)/100}filterPointByAcquisitionDelta(e,t,n){const s=2+(e.style["-myscript-pen-width"]||0)/4;return!n||e.pointers.length===0||Math.abs(n.x-t.x)>=s||Math.abs(n.y-t.y)>=s}getStrokeFromPoint(e){j(this,yn).info("getStrokeFromPoint",{point:e});const t=(s,o,i)=>s>=o&&s<=i,n=[];return this.symbols.forEach(s=>{for(let o=0;o<s.pointers.length;o++){const i=s.pointers[o];if(t(i.x,e.x-5,e.x+5)&&t(i.y,e.y-5,e.y+5)){n.push(s);break}if(tg(e,i)<10){n.push(s);break}}}),j(this,yn).debug("getStrokeFromPoint",{strokes:n}),n}addPoint(e,t){j(this,yn).debug("addPoint",{stroke:e,pointer:t});const n=e.pointers.at(-1);if(this.filterPointByAcquisitionDelta(e,t,n)){const s=n?tg(t,n):0;e.length+=s,t.p=this.computePressure(s,e.length),e.pointers.push(t),e.modificationDate=Date.now()}}addStroke(e){j(this,yn).info("addStroke",{stroke:e}),this.symbols.push(e),this.modificationDate=Date.now(),this.converts=void 0,this.exports=void 0}updateStroke(e){j(this,yn).info("updateStroke",{updatedStroke:e});const t=this.symbols.findIndex(n=>n.id===e.id);t!==-1&&(e.modificationDate=Date.now(),this.symbols.splice(t,1,e),this.modificationDate=Date.now(),this.converts=void 0,this.exports=void 0),j(this,yn).debug("updateStroke",this.symbols)}removeStroke(e){j(this,yn).info("removeStroke",{id:e});const t=this.symbols.findIndex(n=>n.id===e);t!==-1&&(this.positions.lastSentPosition--,this.positions.lastReceivedPosition--,this.symbols.splice(t,1),this.modificationDate=Date.now(),this.converts=void 0,this.exports=void 0),j(this,yn).debug("removeStroke",this.symbols)}removeStrokesFromPoint(e){j(this,yn).info("removeStrokesFromPoint",{point:e});const t=this.getStrokeFromPoint(e);return t.forEach(n=>{this.removeStroke(n.id)}),j(this,yn).debug("removeStrokesFromPoint",t.map(n=>n.id)),t.map(n=>n.id)}extractUnsentStrokes(){return this.symbols.slice(this.positions.lastSentPosition)}initCurrentStroke(e,t,n,s=96){if(j(this,yn).info("initCurrentStroke",{point:e,pointerType:t,style:n,dpi:s}),n["-myscript-pen-width"]){const o=n["-myscript-pen-width"]*s/25.4;n.width=o/2}this.modificationDate=Date.now(),this.exports=void 0,this.currentSymbol=new am(n,t),j(this,yn).debug("initCurrentStroke",this.currentSymbol),this.addPoint(this.currentSymbol,e)}appendToCurrentStroke(e){j(this,yn).info("appendToCurrentStroke",{point:e}),this.currentSymbol&&this.addPoint(this.currentSymbol,e),j(this,yn).debug("appendToCurrentStroke",this.currentSymbol)}endCurrentStroke(e){j(this,yn).info("endCurrentStroke",{point:e}),this.currentSymbol&&(this.addPoint(this.currentSymbol,e),this.addStroke(this.currentSymbol),this.currentSymbol=void 0),j(this,yn).debug("endCurrentStroke",this.currentSymbol)}updatePositionSent(e=this.symbols.length){j(this,yn).info("updatePositionSent",{position:e}),this.positions.lastSentPosition=e,j(this,yn).debug("updatePositionSent",this.positions.lastSentPosition)}updatePositionReceived(){j(this,yn).info("updatePositionReceived"),this.positions.lastReceivedPosition=this.positions.lastSentPosition,j(this,yn).debug("updatePositionReceived",this.positions.lastReceivedPosition)}mergeExport(e){j(this,yn).info("mergeExport",{exports:e}),this.exports?Object.assign(this.exports,e):this.exports=e,j(this,yn).debug("mergeExport",this.exports)}mergeConvert(e){j(this,yn).info("mergeConvert",{converts:e}),this.converts?Object.assign(this.converts,e):this.converts=e,j(this,yn).debug("mergeConvert",this.converts)}clone(){j(this,yn).info("clone");const e=new mI(this.width,this.height,this.rowHeight,this.creationTime);return e.modificationDate=JSON.parse(JSON.stringify(this.modificationDate)),e.currentSymbol=this.currentSymbol?this.currentSymbol.clone():void 0,e.symbols=this.symbols.map(t=>t.clone()),e.positions=JSON.parse(JSON.stringify(this.positions)),e.exports=this.exports?JSON.parse(JSON.stringify(this.exports)):void 0,e.converts=this.converts?JSON.parse(JSON.stringify(this.converts)):void 0,e.idle=this.idle,j(this,yn).debug("clone",{clonedModel:e}),e}clear(){j(this,yn).info("clear"),this.modificationDate=Date.now(),this.currentSymbol=void 0,this.symbols=[],this.positions.lastSentPosition=0,this.positions.lastReceivedPosition=0,this.exports=void 0,this.converts=void 0,this.idle=!0}};yn=new WeakMap;let k0=mI;var Mo;const yI=class yI{constructor(e=100,t=100,n=0,s=Date.now()){De(this,Mo,Rt.getLogger(lt.MODEL));k(this,"creationTime");k(this,"modificationDate");k(this,"currentSymbol");k(this,"symbols");k(this,"exports");k(this,"converts");k(this,"width");k(this,"height");k(this,"rowHeight");k(this,"idle");this.creationTime=s,this.modificationDate=s,this.width=e,this.height=t,this.rowHeight=n,this.symbols=[],this.exports=void 0,this.converts=void 0,this.idle=!0}get symbolsSelected(){return this.symbols.filter(e=>e.selected)}get symbolsToDelete(){return this.symbols.filter(e=>e.deleting)}selectSymbol(e){const t=this.symbols.find(n=>n.id===e||n.type===oe.Group&&n.containsSymbol(e));t&&(t.selected=!0)}unselectSymbol(e){const t=this.symbols.find(n=>n.id===e);t&&(t.selected=!1)}resetSelection(){this.symbols.forEach(e=>e.selected=!1)}getRootSymbol(e){return this.symbols.find(t=>t.id===e||t.type===oe.Group&&t.containsSymbol(e)||t.type===oe.Recognized&&t.containsStroke(e)?t:void 0)}getSymbolRowIndex(e){return Math.round((e.type===oe.Recognized&&e.kind===jn.Text?e.baseline:e.bounds.yMid)/this.rowHeight)}getSymbolsByRowOrdered(){const e=[];return this.symbols.forEach(t=>{const n=this.getSymbolRowIndex(t),s=e.find(o=>o.rowIndex===n);s?s.symbols.push(t):e.push({rowIndex:n,symbols:[t]})}),e.forEach(t=>{t.symbols.sort((n,s)=>n.bounds.xMid-s.bounds.xMid)}),e.sort((t,n)=>t.rowIndex-n.rowIndex)}roundToLineGuide(e){return Math.round(e/this.rowHeight)*this.rowHeight}isSymbolAbove(e,t){return this.getSymbolRowIndex(e)>this.getSymbolRowIndex(t)}isSymbolInRow(e,t){return this.getSymbolRowIndex(e)===this.getSymbolRowIndex(t)}isSymbolBelow(e,t){return this.getSymbolRowIndex(e)<this.getSymbolRowIndex(t)}getFirstSymbol(e){if(e.length)return e.reduce((t,n)=>t&&(this.getSymbolRowIndex(t)<this.getSymbolRowIndex(n)||this.getSymbolRowIndex(t)==this.getSymbolRowIndex(n)&&t.bounds.xMid<n.bounds.xMid)?t:n)}getLastSymbol(e){if(e.length)return e.reduce((t,n)=>{if(t){if(this.getSymbolRowIndex(t)>this.getSymbolRowIndex(n))return t;if(this.getSymbolRowIndex(t)<this.getSymbolRowIndex(n))return n;if(t.bounds.xMid>n.bounds.xMid)return t}return n})}addSymbol(e){if(j(this,Mo).info("addSymbol",{symbol:e}),this.symbols.findIndex(t=>t.id===e.id)>-1)throw new Error(`Symbol id already exist: ${e.id}`);this.symbols.push(e),this.modificationDate=Date.now(),this.converts=void 0,this.exports=void 0,j(this,Mo).debug("addSymbol",this.symbols)}updateSymbol(e){j(this,Mo).info("updateSymbol",{updatedSymbol:e});const t=this.symbols.findIndex(n=>n.id===e.id);t!==-1&&(e.modificationDate=Date.now(),this.symbols.splice(t,1,e),this.modificationDate=Date.now(),this.converts=void 0,this.exports=void 0),j(this,Mo).debug("updateSymbol",this.symbols)}replaceSymbol(e,t){const n=this.symbols.findIndex(s=>s.id===e);n!==-1&&(this.symbols.splice(n,1,...t),this.modificationDate=Date.now(),this.converts=void 0,this.exports=void 0)}changeOrderSymbol(e,t){const n=this.symbols.findIndex(s=>s.id===e);if(n>-1){let s=n;switch(t){case"first":s=0;break;case"last":s=this.symbols.length-1;break;case"forward":s=Math.min(s+1,this.symbols.length-1);break;case"backward":s=Math.max(s-1,0)}const o=this.symbols.splice(n,1)[0];this.symbols.splice(s,0,o)}}removeSymbol(e){j(this,Mo).info("removeSymbol",{id:e});const t=this.symbols.findIndex(n=>n.id===e);t!==-1&&(this.symbols.splice(t,1),this.modificationDate=Date.now(),this.converts=void 0,this.exports=void 0),j(this,Mo).debug("removeSymbol",this.symbols)}extractDifferenceSymbols(e){return{added:this.symbols.filter(t=>e.symbols.findIndex(n=>t.id===n.id&&t.modificationDate===n.modificationDate)===-1),removed:e.symbols.filter(t=>this.symbols.findIndex(n=>t.id===n.id&&t.modificationDate===n.modificationDate)===-1)}}mergeExport(e){j(this,Mo).info("mergeExport",{exports:e}),this.exports?Object.assign(this.exports,e):this.exports=e,j(this,Mo).debug("mergeExport",this.exports)}clone(){j(this,Mo).info("clone");const e=new yI(this.width,this.height,this.rowHeight,this.creationTime);return e.modificationDate=this.modificationDate,e.symbols=this.symbols.map(t=>{const n=t.clone();return n.selected=!1,n}),e.exports=structuredClone(this.exports),e.idle=this.idle,j(this,Mo).debug("clone",{clonedModel:e}),e}clear(){j(this,Mo).info("clear"),this.modificationDate=Date.now(),this.symbols=[],this.currentSymbol=void 0,this.exports=void 0,this.converts=void 0,this.idle=!0}};Mo=new WeakMap;let Tk=yI;var Ao;const vI=class vI{constructor(e=100,t=100,n=0,s=Date.now()){De(this,Ao,Rt.getLogger(lt.MODEL));k(this,"creationTime");k(this,"modificationDate");k(this,"currentStroke");k(this,"strokes");k(this,"exports");k(this,"converts");k(this,"width");k(this,"height");k(this,"rowHeight");k(this,"idle");this.creationTime=s,this.modificationDate=s,this.width=e,this.height=t,this.rowHeight=n,this.strokes=[],this.exports=void 0,this.converts=void 0,this.idle=!0}get strokesToDelete(){return this.strokes.filter(e=>e.deleting)}addStroke(e){if(j(this,Ao).info("addStroke",{stroke:e}),this.strokes.findIndex(t=>t.id===e.id)>-1)throw new Error(`Stroke id already exist: ${e.id}`);this.strokes.push(e),this.modificationDate=Date.now(),this.converts=void 0,this.exports=void 0,j(this,Ao).debug("addStroke",this.strokes)}updateStroke(e){j(this,Ao).info("updateStroke",{updatedStroke:e});const t=this.strokes.findIndex(n=>n.id===e.id);t!==-1&&(e.modificationDate=Date.now(),this.strokes.splice(t,1,e),this.modificationDate=Date.now(),this.converts=void 0,this.exports=void 0),j(this,Ao).debug("updateStroke",this.strokes)}removeStroke(e){j(this,Ao).info("removeSymbol",{id:e});const t=this.strokes.findIndex(n=>n.id===e);t!==-1&&(this.strokes.splice(t,1),this.modificationDate=Date.now(),this.converts=void 0,this.exports=void 0),j(this,Ao).debug("removeSymbol",this.strokes)}extractDifferenceStrokes(e){return{added:this.strokes.filter(t=>e.strokes.findIndex(n=>t.id===n.id&&t.modificationDate===n.modificationDate)===-1),removed:e.strokes.filter(t=>this.strokes.findIndex(n=>t.id===n.id&&t.modificationDate===n.modificationDate)===-1)}}mergeExport(e){j(this,Ao).info("mergeExport",{exports:e}),this.exports?Object.assign(this.exports,e):this.exports=e,j(this,Ao).debug("mergeExport",this.exports)}clone(){j(this,Ao).info("clone");const e=new vI(this.width,this.height,this.rowHeight,this.creationTime);return e.modificationDate=this.modificationDate,e.strokes=this.strokes.map(t=>{const n=t.clone();return n.selected=!1,n}),e.exports=structuredClone(this.exports),e.idle=this.idle,j(this,Ao).debug("clone",{clonedModel:e}),e}clear(){j(this,Ao).info("clear"),this.modificationDate=Date.now(),this.strokes=[],this.exports=void 0,this.converts=void 0,this.currentStroke=void 0,this.idle=!0}};Ao=new WeakMap;let Mk=vI;const hI={scheme:"https",host:"cloud.myscript.com",applicationKey:"",hmacKey:"",version:""},x7={...hI,websocket:{pingEnabled:!0,pingDelay:15e3,maxPingLostCount:20,autoReconnect:!0,maxRetryCount:2,fileChunkSize:3e5}},gp={"erase-precisely":!1},hfe={types:["text","shape"],"match-text-size":!0},pfe={convert:hfe,eraser:gp,mimeTypes:["application/vnd.myscript.jiix"]},ffe={"bounding-box":!1,strokes:!1,ids:!1,"full-stroke-ids":!1,text:{chars:!1,words:!0,lines:!1}},pI={"image-resolution":300,jiix:ffe},Qb={top:20,left:10,right:10,bottom:10},gfe={enable:!0,"fractional-part-digits":3,"decimal-separator":".","rounding-mode":"half up","angle-unit":"deg"},mfe={mode:"stroke"},fI={solver:gfe,margin:Qb,eraser:gp,"undo-redo":mfe,mimeTypes:["application/vnd.myscript.jiix"]},w7={recognition:{types:["text","math","shape","decoration"]},classification:{types:["text","math","shape","decoration","drawing"]},eraser:gp},yfe={"draw-text-boxes":!1,"draw-image-boxes":!1},C7={debug:yfe},vfe={enable:!0},E7={guides:vfe,eraser:gp,margin:Qb,mimeTypes:["application/vnd.myscript.jiix"]},bfe={enable:!0,"line-gap-mm":100,"origin-y-mm":0},Sfe={guides:bfe,eraser:gp,margin:Qb,mimeTypes:["application/vnd.myscript.jiix"]},xfe={types:["shape"],"match-text-size":!0},wfe={enable:!0},Cfe={convert:xfe,eraser:gp,mimeTypes:["application/vnd.myscript.jiix"],beautification:wfe};var Lr,Mt;(function(r){r.START_INITIALIZATION="start-initialization",r.END_INITIALIZATION="end-initialization",r.CONTENT_CHANGED="content-changed",r.IDLE="idle",r.EXPORTED="exported",r.ERROR="error",r.CONNECTION_CLOSE="connection-close",r.SVG_PATCH="svg-patch",r.SESSION_OPENED="session-opened"})(Lr||(Lr={}));class k7 extends EventTarget{constructor(){super();k(this,"abortController");this.abortController=new AbortController}removeAllListeners(){this.abortController.abort(),this.abortController=new AbortController}emit(t,n){const s=new CustomEvent(t,Object.assign({bubbles:!0,composed:!0},n?{detail:n}:void 0));this.dispatchEvent(s)}emitStartInitialization(){this.emit(Lr.START_INITIALIZATION)}addStartInitialization(t){this.addEventListener(Lr.START_INITIALIZATION,()=>t(),{signal:this.abortController.signal})}emitEndtInitialization(){this.emit(Lr.END_INITIALIZATION)}addEndInitialization(t){this.addEventListener(Lr.END_INITIALIZATION,()=>t(),{signal:this.abortController.signal})}emitSessionOpened(t){this.emit(Lr.SESSION_OPENED,t)}addSessionOpenedListener(t){this.addEventListener(Lr.SESSION_OPENED,n=>t(n.detail),{signal:this.abortController.signal})}emitContentChanged(t){this.emit(Lr.CONTENT_CHANGED,{...t,canClear:!t.empty})}addContentChangedListener(t){this.addEventListener(Lr.CONTENT_CHANGED,n=>t(n.detail),{signal:this.abortController.signal})}emitIdle(t){this.emit(Lr.IDLE,t)}addIdleListener(t){this.addEventListener(Lr.IDLE,n=>t(n.detail),{signal:this.abortController.signal})}emitExported(t){this.emit(Lr.EXPORTED,t)}addExportedListener(t){this.addEventListener(Lr.EXPORTED,n=>t(n.detail),{signal:this.abortController.signal})}emitError(t){this.emit(Lr.ERROR,t)}addErrorListener(t){this.addEventListener(Lr.ERROR,n=>t(n.detail),{signal:this.abortController.signal})}emitConnectionClose({code:t,message:n}){this.emit(Lr.CONNECTION_CLOSE,{code:t,message:n})}addConnectionCloseListener(t){this.addEventListener(Lr.CONNECTION_CLOSE,n=>t(n.detail),{signal:this.abortController.signal})}emitSVGPatch(t){this.emit(Lr.SVG_PATCH,t)}addSVGPatchListener(t){this.addEventListener(Lr.SVG_PATCH,n=>t(n.detail),{signal:this.abortController.signal})}}(function(r){r.NO_ACTIVITY="Session closed due to no activity. Without a connection on your part, it will be permanently lost after an hour.",r.WRONG_CREDENTIALS="Application credentials are invalid. Please check or regenerate your application key and hmackey.",r.TOO_OLD="Session is too old. Max Session Duration Reached.",r.NO_SESSION_FOUND="No sessions found. Without activation for 1 hour, sessions are deleted from the server. To avoid losing your work, use the json export, then import it this will create a new session.",r.UNKNOW="An unknown error has occurred.",r.ABNORMAL_CLOSURE="MyScript recognition server is not reachable.",r.CANT_ESTABLISH="Unable to establish a connection to MyScript recognition server. Check the host and your connectivity.",r.GOING_AWAY="MyScript recognition server is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection.",r.PROTOCOL_ERROR="MyScript recognition server terminated the connection due to a protocol error.",r.UNSUPPORTED_DATA="MyScript recognition server terminated the connection because the endpoint received data of a type it cannot accept. (For example, a text-only endpoint received binary data.)",r.INVALID_FRAME_PAYLOAD="MyScript recognition server terminated the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message).",r.POLICY_VIOLATION="MyScript recognition server terminated the connection because it received a message that violates its policy.",r.MESSAGE_TOO_BIG="MyScript recognition server terminated the connection because a data frame was received that is too large.",r.INTERNAL_ERROR="MyScript recognition server terminated the connection because it encountered an unexpected condition that prevented it from fulfilling the request.",r.SERVICE_RESTART="MyScript recognition server terminated the connection because it is restarting.",r.TRY_AGAIN="MyScript recognition server terminated the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients.",r.BAD_GATEWAY="MyScript recognition server was acting as a gateway or proxy and received an invalid response from the upstream server.",r.TLS_HANDSHAKE="MyScript recognition server connection was closed due to a failure to perform a TLS handshake"})(Mt||(Mt={}));const Efe={export:pI,math:fI,diagram:pfe,"raw-content":w7,renderer:C7,text:E7,type:"TEXT",lang:"en_US"},P0={server:hI,recognition:Efe};class P7{constructor(e){k(this,"recognition");k(this,"server");var t,n,s,o,i,a,l,c,u,p,f,m,v,b,S,C,E,T,w,M,R;this.server=It({},P0.server,e==null?void 0:e.server),this.recognition=It({},P0.recognition,e==null?void 0:e.recognition),(n=(t=e==null?void 0:e.recognition)==null?void 0:t.text)!=null&&n.mimeTypes&&(this.recognition.text.mimeTypes=e.recognition.text.mimeTypes),this.recognition.text.mimeTypes=[...new Set(this.recognition.text.mimeTypes)],(o=(s=e==null?void 0:e.recognition)==null?void 0:s.math)!=null&&o.mimeTypes&&(this.recognition.math.mimeTypes=e.recognition.math.mimeTypes),this.recognition.math.mimeTypes=[...new Set(this.recognition.math.mimeTypes)],(a=(i=e==null?void 0:e.recognition)==null?void 0:i.diagram)!=null&&a.mimeTypes&&(this.recognition.diagram.mimeTypes=e.recognition.diagram.mimeTypes),this.recognition.diagram.mimeTypes=[...new Set(this.recognition.diagram.mimeTypes)],(u=(c=(l=e==null?void 0:e.recognition)==null?void 0:l.diagram)==null?void 0:c.convert)!=null&&u.types&&(this.recognition.diagram.convert.types=e.recognition.diagram.convert.types),(m=(f=(p=e==null?void 0:e.recognition)==null?void 0:p["raw-content"])==null?void 0:f.recognition)!=null&&m.types&&(this.recognition["raw-content"].recognition.types=(S=(b=(v=e==null?void 0:e.recognition)==null?void 0:v["raw-content"])==null?void 0:b.recognition)==null?void 0:S.types),this.recognition["raw-content"].recognition.types=[...new Set(this.recognition["raw-content"].recognition.types.filter(D=>D!=="decoration"))],(T=(E=(C=e==null?void 0:e.recognition)==null?void 0:C["raw-content"])==null?void 0:E.classification)!=null&&T.types&&(this.recognition["raw-content"].classification.types=(R=(M=(w=e==null?void 0:e.recognition)==null?void 0:w["raw-content"])==null?void 0:M.classification)==null?void 0:R.types),this.server.version&&(io(this.server.version,"2.3.0")||delete this.recognition.convert,io(this.server.version,"3.2.0")||delete this.recognition.export.jiix.text.lines)}}var Nr;class kfe{constructor(e){De(this,Nr,Rt.getLogger(lt.RECOGNIZER));k(this,"configuration");j(this,Nr).info("constructor",{config:e}),this.configuration=new P7(e)}get url(){return`${this.configuration.server.scheme}://${this.configuration.server.host}/api/v4.0/iink/batch`}get postConfig(){switch(this.configuration.recognition.type){case"DIAGRAM":return{lang:this.configuration.recognition.lang,diagram:this.configuration.recognition.diagram,export:this.configuration.recognition.export};case"MATH":return{lang:this.configuration.recognition.lang,math:this.configuration.recognition.math,export:this.configuration.recognition.export};case"Raw Content":return{lang:this.configuration.recognition.lang,"raw-content":this.configuration.recognition["raw-content"],export:this.configuration.recognition.export};case"TEXT":return{lang:this.configuration.recognition.lang,text:this.configuration.recognition.text,export:this.configuration.recognition.export};default:throw new Error(`get postConfig error Recognition type unkow "${this.configuration.recognition.type}"`)}}buildData(e){j(this,Nr).info("buildData",{model:e});const t=[];e.symbols.forEach(i=>{const a=t.findIndex(l=>{return c=l.penStyle,u=i.style,c&&u&&c["-myscript-pen-fill-color"]===u["-myscript-pen-fill-color"]&&c["-myscript-pen-fill-style"]===u["-myscript-pen-fill-style"]&&c["-myscript-pen-width"]===u["-myscript-pen-width"]&&c.color===u.color&&c.width===u.width;var c,u});a>-1?t[a].strokes.push(i):t.push({penStyle:i.style,strokes:[i]})});const n=[];t.forEach(i=>{const a={penStyle:JSON.stringify(i.penStyle)==="{}"?void 0:_k.penStyleToCSS(i.penStyle),strokes:i.strokes.map(l=>l.formatToSend())};n.push(a)});const s=this.configuration.recognition.type==="Raw Content"?"Raw Content":this.configuration.recognition.type.charAt(0).toUpperCase()+this.configuration.recognition.type.slice(1).toLowerCase(),o={configuration:this.postConfig,xDPI:96,yDPI:96,contentType:s,height:e.height,width:e.width,strokeGroups:n};return j(this,Nr).debug("buildData",{data:o}),o}async post(e,t){j(this,Nr).info("post",{data:e,mimeType:t});const n=new Headers;n.append("Accept","application/json,"+t),n.append("applicationKey",this.configuration.server.applicationKey);try{const a=await Zb(JSON.stringify(e),this.configuration.server.applicationKey,this.configuration.server.hmacKey);n.append("hmac",a)}catch(a){j(this,Nr).error("post.computeHmac",a)}n.append("Content-Type","application/json"),this.configuration.server.version||(this.configuration.server.version=(await im(this.configuration)).version),io(this.configuration.server.version,"2.0.4")&&(n.append("myscript-client-name","iink-ts"),n.append("myscript-client-version","1.0.0-buildVersion")),io(this.configuration.server.version,"2.3.0")||delete this.configuration.recognition.convert,io(this.configuration.server.version,"3.2.0")||delete this.configuration.recognition.export.jiix.text.lines;const s={method:"POST",headers:n,body:JSON.stringify(e)},o=new Request(this.url,s),i=await fetch(o);if(i.ok){let a;switch(i.headers.get("content-type")){case"application/vnd.openxmlformats-officedocument.presentationml.presentation":case"image/png":case"image/jpeg":a=await i.blob();break;case"application/json":a=await i.json();break;case"application/vnd.myscript.jiix":a=await i.clone().json().catch(async()=>await i.text());break;default:a=await i.text()}return j(this,Nr).debug("post",{result:a}),a}{const a=await i.json();throw j(this,Nr).error("post",{err:a}),a}}async tryFetch(e,t){return j(this,Nr).debug("tryFetch",{data:e,mimeType:t}),this.post(e,t).then(n=>{const s={};return s[t]=n,j(this,Nr).debug("tryFetch",{exports:s}),s}).catch(n=>{j(this,Nr).error("tryFetch",{data:e,mimeType:t,err:n});let s=n.message||Mt.UNKNOW;throw n.code?n.code==="access.not.granted"&&(s=Mt.WRONG_CREDENTIALS):s=Mt.CANT_ESTABLISH,new Error(s)})}getMimeTypes(e){j(this,Nr).info("getMimeTypes",{requestedMimeTypes:e});let t=e||[];if(!t.length)switch(this.configuration.recognition.type){case"DIAGRAM":t=this.configuration.recognition.diagram.mimeTypes;break;case"MATH":t=this.configuration.recognition.math.mimeTypes;break;case"Raw Content":t=["application/vnd.myscript.jiix"];break;case"TEXT":t=this.configuration.recognition.text.mimeTypes;break;default:throw new Error(`Recognition type "${this.configuration.recognition.type}" is unknown.
 Possible types are:
 -DIAGRAM
 -MATH
 -Raw Content
 -TEXT`)}return t}async convert(e,t,n){j(this,Nr).info("convert",{model:e,conversionState:t,requestedMimeTypes:n});const s=e.clone(),o=this.getMimeTypes(n),i=this.buildData(s);i.conversionState=t;const a=o.map(l=>this.tryFetch(i,l));return(await Promise.all(a)).forEach(l=>{s.mergeConvert(l)}),j(this,Nr).debug("convert",{model:s}),s}async export(e,t){j(this,Nr).info("export",{model:e,requestedMimeTypes:t});const n=e.clone();if(n.symbols.length===0)return Promise.resolve(n);const s=this.getMimeTypes(t);if(!s.length)return j(this,Nr).error("export",{model:e,requestedMimeTypes:t,"Export failed, no mimeTypes define in recognition configuration":String}),Promise.reject(new Error("Export failed, no mimeTypes define in recognition configuration"));const o=s.filter(a=>!n.exports||!n.exports[a]),i=this.buildData(e);return(await Promise.all(o.map(a=>this.tryFetch(i,a)))).forEach(a=>{n.mergeExport(a)}),j(this,Nr).debug("export",{model:n}),n}async resize(e){return j(this,Nr).info("resize",{model:e}),this.export(e)}}Nr=new WeakMap;const Pfe={export:pI,math:fI,shape:Cfe,"raw-content":w7,text:Sfe,type:"TEXT",lang:"en_US"},I0={server:hI,recognition:Pfe};class I7{constructor(e){k(this,"recognition");k(this,"server");var t,n,s,o,i,a,l,c,u,p,f,m,v,b,S,C,E,T;this.server=It({},I0.server,e==null?void 0:e.server),this.recognition=It({},I0.recognition,e==null?void 0:e.recognition),(n=(t=e==null?void 0:e.recognition)==null?void 0:t.text)!=null&&n.mimeTypes&&(this.recognition.text.mimeTypes=e.recognition.text.mimeTypes),this.recognition.text.mimeTypes=[...new Set(this.recognition.text.mimeTypes)],(o=(s=e==null?void 0:e.recognition)==null?void 0:s.math)!=null&&o.mimeTypes&&(this.recognition.math.mimeTypes=e.recognition.math.mimeTypes),this.recognition.math.mimeTypes=[...new Set(this.recognition.math.mimeTypes)],(a=(i=e==null?void 0:e.recognition)==null?void 0:i.shape)!=null&&a.mimeTypes&&(this.recognition.shape.mimeTypes=e.recognition.shape.mimeTypes),this.recognition.shape.mimeTypes=[...new Set(this.recognition.shape.mimeTypes)],(u=(c=(l=e==null?void 0:e.recognition)==null?void 0:l["raw-content"])==null?void 0:c.recognition)!=null&&u.types&&(this.recognition["raw-content"].recognition.types=(m=(f=(p=e==null?void 0:e.recognition)==null?void 0:p["raw-content"])==null?void 0:f.recognition)==null?void 0:m.types),(S=(b=(v=e==null?void 0:e.recognition)==null?void 0:v["raw-content"])==null?void 0:b.classification)!=null&&S.types&&(this.recognition["raw-content"].classification.types=(T=(E=(C=e==null?void 0:e.recognition)==null?void 0:C["raw-content"])==null?void 0:E.classification)==null?void 0:T.types),this.server.version&&(io(this.server.version,"2.3.0")||delete this.recognition.convert,io(this.server.version,"3.2.0")||delete this.recognition.export.jiix.text.lines)}}var Rs;class Ife{constructor(e){De(this,Rs,Rt.getLogger(lt.RECOGNIZER));k(this,"configuration");j(this,Rs).info("constructor",{config:e}),this.configuration=new I7(e)}get url(){return`${this.configuration.server.scheme}://${this.configuration.server.host}/api/v4.0/iink/recognize`}get postConfig(){switch(this.configuration.recognition.type){case"SHAPE":return{lang:this.configuration.recognition.lang,diagram:this.configuration.recognition.shape,export:this.configuration.recognition.export};case"MATH":return{lang:this.configuration.recognition.lang,math:this.configuration.recognition.math,export:this.configuration.recognition.export};case"Raw Content":return{lang:this.configuration.recognition.lang,"raw-content":this.configuration.recognition["raw-content"],export:this.configuration.recognition.export};case"TEXT":return{lang:this.configuration.recognition.lang,text:this.configuration.recognition.text,export:this.configuration.recognition.export};default:throw new Error(`get postConfig error Recognition type unkow "${this.configuration.recognition.type}"`)}}formatStrokes(e){return e.map(t=>({id:t.id,pointerType:t.pointerType,p:t.pointers.map(n=>n.p),t:t.pointers.map(n=>n.t),x:t.pointers.map(n=>n.x),y:t.pointers.map(n=>n.y)}))}buildData(e){j(this,Rs).info("buildData",{strokes:e});const t=this.configuration.recognition.type==="Raw Content"?"Raw Content":this.configuration.recognition.type.charAt(0).toUpperCase()+this.configuration.recognition.type.slice(1).toLowerCase(),n={configuration:this.postConfig,scaleX:.265,scaleY:.265,contentType:t,strokes:this.formatStrokes(e)};return j(this,Rs).debug("buildData",{data:n}),n}async post(e,t){j(this,Rs).info("post",{data:e,mimeType:t});const n=new Headers;n.append("Accept",t),n.append("applicationKey",this.configuration.server.applicationKey);try{const a=await Zb(JSON.stringify(e),this.configuration.server.applicationKey,this.configuration.server.hmacKey);n.append("hmac",a)}catch(a){j(this,Rs).error("post.computeHmac",a)}n.append("Content-Type","application/json"),this.configuration.server.version||(this.configuration.server.version=(await im(this.configuration)).version),this.configuration.server.version&&io(this.configuration.server.version,"2.0.4")&&(n.append("myscript-client-name","iink-ts"),n.append("myscript-client-version","1.0.0-buildVersion"));const s={method:"POST",headers:n,body:JSON.stringify(e)},o=new Request(this.url,s),i=await fetch(o);if(i.ok){let a;switch(i.headers.get("content-type")){case"application/vnd.openxmlformats-officedocument.presentationml.presentation":case"image/png":case"image/jpeg":a=await i.blob();break;case"application/json":a=await i.json();break;case"application/vnd.myscript.jiix":a=await i.clone().json().catch(async()=>await i.text());break;default:a=await i.text()}return j(this,Rs).debug("post",{result:a}),a}{const a=await i.json();throw j(this,Rs).error("post",{err:a}),a}}async tryFetch(e,t){return j(this,Rs).debug("tryFetch",{data:e,mimeType:t}),this.post(e,t).then(n=>{const s={};return s[t]=n,j(this,Rs).debug("tryFetch",{exports:s}),s}).catch(n=>{j(this,Rs).error("tryFetch",{data:e,mimeType:t,err:n});let s=n.message||Mt.UNKNOW;throw n.code?n.code==="access.not.granted"&&(s=Mt.WRONG_CREDENTIALS):s=Mt.CANT_ESTABLISH,new Error(s)})}getMimeTypes(e){j(this,Rs).info("getMimeTypes",{requestedMimeTypes:e});let t=e||[];if(!t.length)switch(this.configuration.recognition.type){case"SHAPE":t=this.configuration.recognition.shape.mimeTypes;break;case"MATH":t=this.configuration.recognition.math.mimeTypes;break;case"Raw Content":t=["application/vnd.myscript.jiix"];break;case"TEXT":t=this.configuration.recognition.text.mimeTypes;break;default:throw new Error(`Recognition type "${this.configuration.recognition.type}" is unknown.
 Possible types are:
 -DIAGRAM
 -MATH
 -Raw Content
 -TEXT
 -SHAPE`)}return t}async send(e,t){j(this,Rs).info("send",e);const n={};if(e.length===0)return Promise.resolve(n);const s=t||this.getMimeTypes(),o=this.buildData(e);return(await Promise.all(s.map(i=>this.tryFetch(o,i)))).forEach(i=>{Object.assign(n,i)}),j(this,Rs).debug("send",n),n}}Rs=new WeakMap;var _o;(function(r){r.HMAC_Challenge="hmacChallenge",r.Authenticated="authenticated",r.SessionDescription="sessionDescription",r.NewPart="newPart",r.PartChanged="partChanged",r.ContentChanged="contentChanged",r.Idle="idle",r.Pong="pong",r.Exported="exported",r.GestureDetected="gestureDetected",r.ContextlessGesture="contextlessGesture",r.Error="error"})(_o||(_o={}));var _7=null;try{var _fe=typeof jv<"u"&&typeof jv.require=="function"&&jv.require("worker_threads")||typeof __non_webpack_require__=="function"&&__non_webpack_require__("worker_threads")||typeof require=="function"&&require("worker_threads");_7=_fe.Worker}catch{}function Tfe(r,e,t){var n=function(a,l){return Buffer.from(a,"base64").toString("utf8")}(r),s=n.indexOf(`
`,10)+1,o=n.substring(s)+"";return function(a){return new _7(o,Object.assign({},a,{eval:!0}))}}function Mfe(r,e,t){var n=function(l,c){return atob(l)}(r),s=n.indexOf(`
`,10)+1,o=n.substring(s)+"",i=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(i)}var Afe=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",jfe=function(e,t,n){return function(){return Afe}()?Tfe(e):function(o,i,a){var l;return function(u){return l=l||Mfe(o),new Worker(l,u)}}(e)}("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7c2VsZi5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwoZT0+e3NldEludGVydmFsKCgoKT0+e3Bvc3RNZXNzYWdlKHt0eXBlOiJwaW5nIn0pfSksZS5kYXRhLnBpbmdEZWxheSl9KSl9KCk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPXBpbmcud29ya2VyLmpzLm1hcAoK");const Rfe={export:{jiix:{"bounding-box":!0,"full-stroke-ids":!0,ids:!0,strokes:!1,text:{chars:!0,words:!0,lines:!0}}},"raw-content":{recognition:{types:["text","shape"]},classification:{types:["text","shape"]},gestures:["underline","scratch-out","join","insert","strike-through","surround"]},lang:"en_US",gesture:{enable:!0,ignoreGestureStrokes:!1}},_0={server:x7,recognition:Rfe};class T7{constructor(e){k(this,"server");k(this,"recognition");var t,n,s,o,i,a,l,c;this.server=It({},_0.server,e==null?void 0:e.server),this.recognition=It({},_0.recognition,e==null?void 0:e.recognition),this.recognition.export.jiix["full-stroke-ids"]=!0,this.recognition.export.jiix.ids=!0,this.recognition.export.jiix.text.words=!0,this.recognition.export.jiix.text.chars=!0,this.recognition.export.jiix.text.lines=!0,this.recognition.export.jiix["bounding-box"]=!0,(s=(n=(t=e==null?void 0:e.recognition)==null?void 0:t["raw-content"])==null?void 0:n.recognition)!=null&&s.types&&(this.recognition["raw-content"].recognition.types=e.recognition["raw-content"].recognition.types),(a=(i=(o=e==null?void 0:e.recognition)==null?void 0:o["raw-content"])==null?void 0:i.classification)!=null&&a.types&&(this.recognition["raw-content"].classification.types=e.recognition["raw-content"].classification.types),(c=(l=e==null?void 0:e.recognition)==null?void 0:l["raw-content"])!=null&&c.gestures&&(this.recognition["raw-content"].gestures=e.recognition["raw-content"].gestures),this.server.version&&!io(this.server.version,"3.2.0")&&(delete this.recognition.export.jiix.text.lines,delete this.recognition["raw-content"].classification)}}var Dh,$a,Fc;class M7{constructor(e,t){De(this,$a);De(this,Dh,Rt.getLogger(lt.RECOGNIZER));k(this,"socket");k(this,"pingWorker");k(this,"pingCount",0);k(this,"reconnectionCount",0);k(this,"sessionId");k(this,"currentPartId");k(this,"currentErrorCode");k(this,"addStrokeDeferred");k(this,"contextlessGestureDeferred");k(this,"transformStrokeDeferred");k(this,"eraseStrokeDeferred");k(this,"replaceStrokeDeferred");k(this,"exportDeferredMap");k(this,"closeDeferred");k(this,"waitForIdleDeferred");k(this,"undoDeferred");k(this,"redoDeferred");k(this,"clearDeferred");k(this,"configuration");k(this,"initialized");k(this,"url");k(this,"event");j(this,Dh).info("constructor",{config:e}),this.configuration=new T7(e);const n=this.configuration.server.scheme==="https"?"wss":"ws";this.url=`${n}://${this.configuration.server.host}/api/v4.0/iink/offscreen?applicationKey=${this.configuration.server.applicationKey}`,this.event=t||new k7,this.initialized=new Xt,this.exportDeferredMap=new Map,this.contextlessGestureDeferred=new Map}get mimeTypes(){return["application/vnd.myscript.jiix"]}rejectDeferredPending(e){var t,n,s,o,i,a,l,c;this.initialized.reject(e),(t=this.addStrokeDeferred)==null||t.reject(e),(n=this.transformStrokeDeferred)==null||n.reject(e),(s=this.eraseStrokeDeferred)==null||s.reject(e),(o=this.replaceStrokeDeferred)==null||o.reject(e),(i=this.undoDeferred)==null||i.reject(e),(a=this.redoDeferred)==null||a.reject(e),(l=this.clearDeferred)==null||l.reject(e),Array.from(this.contextlessGestureDeferred.values()).forEach(u=>{u.reject(e)}),Array.from(this.exportDeferredMap.values()).forEach(u=>{u.reject(e)}),(c=this.waitForIdleDeferred)==null||c.reject(e)}resetAllDeferred(){this.initialized=new Xt,this.addStrokeDeferred=void 0,this.contextlessGestureDeferred.clear(),this.transformStrokeDeferred=void 0,this.eraseStrokeDeferred=void 0,this.replaceStrokeDeferred=void 0,this.exportDeferredMap.clear(),this.waitForIdleDeferred=void 0,this.closeDeferred=void 0}clearSocketListener(){this.socket.removeEventListener("open",this.openCallback.bind(this)),this.socket.removeEventListener("close",this.closeCallback.bind(this)),this.socket.removeEventListener("message",this.messageCallback.bind(this))}closeCallback(e){var n,s;j(this,Dh).info("closeCallback",{evt:e});let t=e.reason;if(!this.currentErrorCode)switch(e.code){case 1e3:break;case 1001:t=Mt.GOING_AWAY;break;case 1002:t=Mt.PROTOCOL_ERROR;break;case 1003:t=Mt.UNSUPPORTED_DATA;break;case 1006:t=Mt.ABNORMAL_CLOSURE;break;case 1007:t=Mt.INVALID_FRAME_PAYLOAD;break;case 1008:t=Mt.POLICY_VIOLATION;break;case 1009:t=Mt.MESSAGE_TOO_BIG;break;case 1011:t=Mt.INTERNAL_ERROR;break;case 1012:t=Mt.SERVICE_RESTART;break;case 1013:t=Mt.TRY_AGAIN;break;case 1014:t=Mt.BAD_GATEWAY;break;case 1015:t=Mt.TLS_HANDSHAKE;break;default:t=Mt.CANT_ESTABLISH}if(this.clearSocketListener(),(n=this.closeDeferred)==null||n.resolve(),!this.currentErrorCode&&e.code!==1e3){const o=new Error(t);this.event.emitError(o),this.rejectDeferredPending(t)}(s=this.pingWorker)==null||s.terminate(),this.resetAllDeferred()}openCallback(){this.reconnectionCount=0,an(this,$a,Fc).call(this,{type:"authenticate","myscript-client-name":"iink-ts","myscript-client-version":"1.0.0-buildVersion"})}async manageHMACChallenge(e){an(this,$a,Fc).call(this,{type:"hmac",hmac:await Zb(e.hmacChallenge,this.configuration.server.applicationKey,this.configuration.server.hmacKey)})}initPing(){this.pingWorker=new jfe,this.pingWorker.postMessage({pingDelay:this.configuration.server.websocket.pingDelay}),this.pingWorker.onmessage=()=>{var e;this.socket.readyState<=1&&(this.pingCount<this.configuration.server.websocket.maxPingLostCount?this.send({type:"ping"}):(this.close(1e3,"MAXIMUM_PING_REACHED"),(e=this.pingWorker)==null||e.terminate()),this.pingCount++)}}manageAuthenticated(){io(this.configuration.server.version,"3.2.0")||(delete this.configuration.recognition.export.jiix.text.lines,delete this.configuration.recognition["raw-content"].classification);const e=25.4/96;an(this,$a,Fc).call(this,{type:this.sessionId?"restoreSession":"initSession",iinkSessionId:this.sessionId,scaleX:e,scaleY:e,configuration:this.configuration.recognition})}manageSessionDescriptionMessage(e){e.iinkSessionId&&(this.sessionId=e.iinkSessionId,this.event.emitSessionOpened(this.sessionId)),this.currentPartId?an(this,$a,Fc).call(this,{type:"openContentPart",id:this.currentPartId}):an(this,$a,Fc).call(this,{type:"newContentPart",contentType:"Raw Content",mimeTypes:this.mimeTypes})}manageNewPartMessage(e){this.initialized.resolve(),this.currentPartId=e.id}managePartChangeMessage(e){this.initialized.resolve(),this.currentPartId=e.partId}manageContentChangedMessage(e){var t,n,s,o,i,a;this.initialized.resolve(),(t=this.replaceStrokeDeferred)==null||t.resolve(),(n=this.transformStrokeDeferred)==null||n.resolve(),(s=this.eraseStrokeDeferred)==null||s.resolve(),(o=this.undoDeferred)==null||o.resolve(),(i=this.redoDeferred)==null||i.resolve(),(a=this.clearDeferred)==null||a.resolve(),this.event.emitContentChanged({canRedo:e.canRedo,canUndo:e.canRedo})}manageExportMessage(e){e.exports["application/vnd.myscript.jiix"]&&(e.exports["application/vnd.myscript.jiix"]=JSON.parse(e.exports["application/vnd.myscript.jiix"].toString())),Object.keys(e.exports).forEach(t=>{this.exportDeferredMap.has(t)&&this.exportDeferredMap.get(t).resolve(e.exports)}),this.event.emitExported(e.exports)}manageWaitForIdle(){var e;(e=this.waitForIdleDeferred)==null||e.resolve(),this.event.emitIdle(!0)}manageErrorMessage(e){var n,s;this.currentErrorCode=((n=e.data)==null?void 0:n.code)||e.code;let t=((s=e.data)==null?void 0:s.message)||e.message||Mt.UNKNOW;if(this.currentErrorCode==="no.activity")this.rejectDeferredPending(t),this.event.emitConnectionClose({code:1e3,message:Mt.NO_ACTIVITY});else{switch(this.currentErrorCode){case"access.not.granted":t=Mt.WRONG_CREDENTIALS;break;case"session.too.old":t=Mt.TOO_OLD;break;case"restore.session.not.found":t=Mt.NO_SESSION_FOUND}this.rejectDeferredPending(t),this.event.emitError(new Error(t))}}manageGestureDetected(e){var t;(t=this.addStrokeDeferred)==null||t.resolve(e)}manageContextlessGesture(e){var t;(t=this.contextlessGestureDeferred.get(e.strokeId))==null||t.resolve(e)}messageCallback(e){this.currentErrorCode=void 0;try{const t=JSON.parse(e.data);if(t.type===_o.Pong)return;switch(this.pingCount=0,t.type){case _o.HMAC_Challenge:this.manageHMACChallenge(t);break;case _o.Authenticated:this.manageAuthenticated();break;case _o.SessionDescription:this.manageSessionDescriptionMessage(t);break;case _o.NewPart:this.manageNewPartMessage(t);break;case _o.PartChanged:this.managePartChangeMessage(t);break;case _o.ContentChanged:this.manageContentChangedMessage(t);break;case _o.Exported:this.manageExportMessage(t);break;case _o.GestureDetected:this.manageGestureDetected(t);break;case _o.ContextlessGesture:this.manageContextlessGesture(t);break;case _o.Error:this.manageErrorMessage(t);break;case _o.Idle:this.manageWaitForIdle();break;default:j(this,Dh).warn("messageCallback",`Message type unknow: "${t}".`)}}catch{this.event.emitError(new Error(e.data))}}async newSession(e){await this.close(1e3,"new-session"),this.configuration=It({},this.configuration,e),this.sessionId=void 0,this.currentPartId=void 0,await this.init()}async init(){this.event.emitStartInitialization(),this.currentErrorCode==="restore.session.not.found"&&(this.currentErrorCode=void 0,this.sessionId=void 0,this.currentPartId=void 0),this.initialized=new Xt,this.configuration.server.version||(this.configuration.server.version=(await im(this.configuration)).version),this.socket=new WebSocket(this.url),this.clearSocketListener(),this.socket.addEventListener("open",this.openCallback.bind(this)),this.socket.addEventListener("close",this.closeCallback.bind(this)),this.socket.addEventListener("message",this.messageCallback.bind(this)),await this.initialized.promise,this.configuration.server.websocket.pingEnabled&&(this.pingCount=0,this.initPing()),this.event.emitEndtInitialization()}async send(e){if(!this.socket)return Promise.reject(new Error("Recognizer must be initilized"));switch(this.socket.readyState){case this.socket.CONNECTING:case this.socket.OPEN:return await this.initialized.promise,an(this,$a,Fc).call(this,e),Promise.resolve();case this.socket.CLOSING:case this.socket.CLOSED:return this.configuration.server.websocket.autoReconnect?(this.reconnectionCount++,this.configuration.server.websocket.maxRetryCount>this.reconnectionCount?(await this.init(),await this.waitForIdle(),an(this,$a,Fc).call(this,e)):Promise.reject(new Error("Unable to send message. The maximum number of connection attempts has been reached."))):Promise.reject(new Error("Unable to send message. Connection closed and automatic reconnection disabled"))}}buildAddStrokesMessage(e,t=!0){return{type:"addStrokes",processGestures:t,strokes:e.map(n=>n.formatToSend())}}async addStrokes(e,t=!0){var n,s;return this.addStrokeDeferred=new Xt,e.length===0?(this.addStrokeDeferred.resolve(void 0),(n=this.addStrokeDeferred)==null?void 0:n.promise):(await this.send(this.buildAddStrokesMessage(e,t)),(s=this.addStrokeDeferred)==null?void 0:s.promise)}buildReplaceStrokesMessage(e,t){return{type:"replaceStrokes",oldStrokeIds:e,newStrokes:t.map(n=>n.formatToSend())}}async replaceStrokes(e,t){var n,s;return this.replaceStrokeDeferred=new Xt,e.length===0?(this.replaceStrokeDeferred.resolve(),(n=this.replaceStrokeDeferred)==null?void 0:n.promise):(await this.send(this.buildReplaceStrokesMessage(e,t)),(s=this.replaceStrokeDeferred)==null?void 0:s.promise)}buildTransformTranslateMessage(e,t,n){return{type:"transform",transformationType:"TRANSLATE",strokeIds:e,tx:t,ty:n}}async transformTranslate(e,t,n){var s,o;return this.transformStrokeDeferred=new Xt,e.length===0?(this.transformStrokeDeferred.resolve(),(s=this.transformStrokeDeferred)==null?void 0:s.promise):(await this.send(this.buildTransformTranslateMessage(e,t,n)),(o=this.transformStrokeDeferred)==null?void 0:o.promise)}buildTransformRotateMessage(e,t,n=0,s=0){return{type:"transform",transformationType:"ROTATE",strokeIds:e,angle:t,x0:n,y0:s}}async transformRotate(e,t,n=0,s=0){var o,i;return this.transformStrokeDeferred=new Xt,e.length===0?(this.transformStrokeDeferred.resolve(),(o=this.transformStrokeDeferred)==null?void 0:o.promise):(await this.send(this.buildTransformRotateMessage(e,t,n,s)),(i=this.transformStrokeDeferred)==null?void 0:i.promise)}buildTransformScaleMessage(e,t,n,s=0,o=0){return{type:"transform",transformationType:"SCALE",strokeIds:e,scaleX:t,scaleY:n,x0:s,y0:o}}async transformScale(e,t,n,s=0,o=0){var i,a;return this.transformStrokeDeferred=new Xt,e.length===0?(this.transformStrokeDeferred.resolve(),(i=this.transformStrokeDeferred)==null?void 0:i.promise):(await this.send(this.buildTransformScaleMessage(e,t,n,s,o)),(a=this.transformStrokeDeferred)==null?void 0:a.promise)}buildTransformMatrixMessage(e,t){return{type:"transform",transformationType:"MATRIX",strokeIds:e,...t}}async transformMatrix(e,t){var n,s;return this.transformStrokeDeferred=new Xt,e.length===0?(this.transformStrokeDeferred.resolve(),(n=this.transformStrokeDeferred)==null?void 0:n.promise):(await this.send(this.buildTransformMatrixMessage(e,t)),(s=this.transformStrokeDeferred)==null?void 0:s.promise)}buildEraseStrokesMessage(e){return{type:"eraseStrokes",strokeIds:e}}async eraseStrokes(e){var t,n;return this.eraseStrokeDeferred=new Xt,e.length===0?(this.eraseStrokeDeferred.resolve(),(t=this.eraseStrokeDeferred)==null?void 0:t.promise):(await this.send(this.buildEraseStrokesMessage(e)),(n=this.eraseStrokeDeferred)==null?void 0:n.promise)}async recognizeGesture(e){if(!e)return;this.contextlessGestureDeferred.set(e.id,new Xt);const t=25.4/96;return await this.send({type:"contextlessGesture",scaleX:t,scaleY:t,stroke:e.formatToSend()}),this.contextlessGestureDeferred.get(e.id).promise}async waitForIdle(){var e;return this.waitForIdleDeferred&&!this.waitForIdleDeferred.isFullFilled||(this.waitForIdleDeferred=new Xt),await this.send({type:"waitForIdle"}),(e=this.waitForIdleDeferred)==null?void 0:e.promise}buildUndoRedoChanges(e){var n,s,o,i,a,l,c;const t=[];return(n=e.added)!=null&&n.length&&t.push(this.buildAddStrokesMessage(e.added,!1)),(s=e.erased)!=null&&s.length&&t.push(this.buildEraseStrokesMessage(e.erased.map(u=>u.id))),(o=e.replaced)!=null&&o.newStrokes.length&&t.push(this.buildReplaceStrokesMessage(e.replaced.oldStrokes.map(u=>u.id),e.replaced.newStrokes)),(i=e.matrix)!=null&&i.strokes.length&&t.push(this.buildTransformMatrixMessage(e.matrix.strokes.map(u=>u.id),e.matrix.matrix)),(a=e.translate)!=null&&a.length&&e.translate.forEach(u=>{t.push(this.buildTransformTranslateMessage(u.strokes.map(p=>p.id),u.tx,u.ty))}),(l=e.rotate)!=null&&l.length&&e.rotate.forEach(u=>{t.push(this.buildTransformRotateMessage(u.strokes.map(p=>p.id),u.angle,u.center.x,u.center.y))}),(c=e.scale)!=null&&c.length&&e.scale.forEach(u=>{t.push(this.buildTransformScaleMessage(u.strokes.map(p=>p.id),u.scaleX,u.scaleY,u.origin.x,u.origin.y))}),t}async undo(e){var s;const t=this.buildUndoRedoChanges(e);if(t.length===0)return;this.undoDeferred=new Xt;const n={type:"undo",changes:t};return await this.send(n),(s=this.undoDeferred)==null?void 0:s.promise}async redo(e){var s;const t=this.buildUndoRedoChanges(e);if(t.length===0)return;this.redoDeferred=new Xt;const n={type:"redo",changes:t};return await this.send(n),(s=this.redoDeferred)==null?void 0:s.promise}async export(e){const t=e||this.mimeTypes.slice();await Promise.all(t.map(o=>{var i;return(i=this.exportDeferredMap.get(o))==null?void 0:i.promise})),t.forEach(o=>{this.exportDeferredMap.set(o,new Xt)});const n={type:"export",partId:this.currentPartId,mimeTypes:t};await this.send(n);const s=await Promise.all(t.map(o=>this.exportDeferredMap.get(o).promise));return Object.assign({},...s)}async clear(){var e;return this.clearDeferred=new Xt,await this.send({type:"clear"}),(e=this.clearDeferred)==null?void 0:e.promise}async close(e,t){this.resetAllDeferred(),this.closeDeferred=new Xt,this.socket.readyState===this.socket.OPEN||this.socket.readyState===this.socket.CONNECTING?this.socket.close(e,t):this.closeDeferred.resolve(),await this.closeDeferred.promise}async destroy(){this.socket&&await this.close(1e3,"Recognizer destroyed")}}Dh=new WeakMap,$a=new WeakSet,Fc=async function(e){if(!this.socket)throw new Error("Recognizer must be initilized");if(this.socket.readyState!==this.socket.OPEN)throw new Error(`Can not send message: ${e.type}, connection not ready, state: ${this.socket.readyState}`);this.socket.send(JSON.stringify(e))};const Dfe={export:pI,math:fI,renderer:C7,text:E7,type:"TEXT",lang:"en_US"},T0={server:x7,recognition:Dfe};class A7{constructor(e){k(this,"recognition");k(this,"server");var t,n,s,o;this.server=It({},T0.server,e==null?void 0:e.server),this.recognition=It({},T0.recognition,e==null?void 0:e.recognition),(n=(t=e==null?void 0:e.recognition)==null?void 0:t.text)!=null&&n.mimeTypes&&(this.recognition.text.mimeTypes=e.recognition.text.mimeTypes),this.recognition.text.mimeTypes=[...new Set(this.recognition.text.mimeTypes)],(o=(s=e==null?void 0:e.recognition)==null?void 0:s.math)!=null&&o.mimeTypes&&(this.recognition.math.mimeTypes=e.recognition.math.mimeTypes),this.recognition.math.mimeTypes=[...new Set(this.recognition.math.mimeTypes)],this.server.version&&(io(this.server.version,"2.3.0")||delete this.recognition.convert,io(this.server.version,"3.2.0")||delete this.recognition.export.jiix.text.lines)}}var Jt;class Ofe{constructor(e){De(this,Jt,Rt.getLogger(lt.RECOGNIZER));k(this,"socket");k(this,"pingCount",0);k(this,"reconnectionCount",0);k(this,"viewSizeHeight");k(this,"viewSizeWidth");k(this,"sessionId");k(this,"currentPartId");k(this,"currentErrorCode");k(this,"penStyle");k(this,"penStyleClasses");k(this,"theme");k(this,"connected");k(this,"ackDeferred");k(this,"addStrokeDeferred");k(this,"exportDeferred");k(this,"convertDeferred");k(this,"importDeferred");k(this,"resizeDeferred");k(this,"undoDeferred");k(this,"redoDeferred");k(this,"clearDeferred");k(this,"importPointEventsDeferred");k(this,"waitForIdleDeferred");k(this,"configuration");k(this,"initialized");k(this,"url");k(this,"event");j(this,Jt).info("constructor",{config:e}),this.configuration=new A7(e);const t=this.configuration.server.scheme==="https"?"wss":"ws";this.url=`${t}://${this.configuration.server.host}/api/v4.0/iink/document?applicationKey=${this.configuration.server.applicationKey}`,this.event=new k7,this.initialized=new Xt}get mimeTypes(){switch(this.configuration.recognition.type.toLocaleLowerCase()){case"text":return this.configuration.recognition.text.mimeTypes;case"math":return this.configuration.recognition.math.mimeTypes;default:throw new Error(`Unauthorized recognition type: "${this.configuration.recognition.type}"`)}}infinitePing(){this.pingCount++,this.configuration.server.websocket.maxPingLostCount<this.pingCount?this.socket.close(1e3,"MAXIMUM_PING_REACHED"):this.socket.readyState<=1&&setTimeout(()=>{this.socket.readyState<=1&&(this.socket.send(JSON.stringify({type:"ping"})),this.infinitePing())},this.configuration.server.websocket.pingDelay)}openCallback(){var t;(t=this.connected)==null||t.resolve();const e={type:this.sessionId?"restoreIInkSession":"newContentPackage",iinkSessionId:this.sessionId,applicationKey:this.configuration.server.applicationKey,xDpi:96,yDpi:96,viewSizeHeight:this.viewSizeHeight,viewSizeWidth:this.viewSizeWidth};io(this.configuration.server.version,"2.0.4")&&(e["myscript-client-name"]="iink-ts",e["myscript-client-version"]="1.0.0-buildVersion"),this.send(e)}rejectDeferredPending(e){var t,n,s,o,i,a,l,c,u,p,f,m,v,b,S,C,E,T,w,M,R,D;(t=this.connected)!=null&&t.isPending&&((n=this.connected)==null||n.reject(e)),this.initialized.isPending&&this.initialized.reject(e),(s=this.addStrokeDeferred)!=null&&s.isPending&&((o=this.addStrokeDeferred)==null||o.reject(e)),(i=this.exportDeferred)!=null&&i.isPending&&((a=this.exportDeferred)==null||a.reject(e)),(l=this.importPointEventsDeferred)!=null&&l.isPending&&((c=this.importPointEventsDeferred)==null||c.reject(e)),(u=this.convertDeferred)!=null&&u.isPending&&((p=this.convertDeferred)==null||p.reject(e)),(f=this.importDeferred)!=null&&f.isPending&&((m=this.importDeferred)==null||m.reject(e)),(v=this.resizeDeferred)!=null&&v.isPending&&((b=this.resizeDeferred)==null||b.reject(e)),(S=this.waitForIdleDeferred)!=null&&S.isPending&&((C=this.waitForIdleDeferred)==null||C.reject(e)),(E=this.undoDeferred)!=null&&E.isPending&&((T=this.undoDeferred)==null||T.reject(e)),(w=this.redoDeferred)!=null&&w.isPending&&((M=this.redoDeferred)==null||M.reject(e)),(R=this.clearDeferred)!=null&&R.isPending&&this.clearDeferred.reject(e),(D=this.waitForIdleDeferred)!=null&&D.isPending&&this.waitForIdleDeferred.reject(e)}closeCallback(e){let t="";if(!this.currentErrorCode)switch(e.code){case 1e3:break;case 1001:t=Mt.GOING_AWAY;break;case 1002:t=Mt.PROTOCOL_ERROR;break;case 1003:t=Mt.UNSUPPORTED_DATA;break;case 1006:t=Mt.ABNORMAL_CLOSURE;break;case 1007:t=Mt.INVALID_FRAME_PAYLOAD;break;case 1008:t=Mt.POLICY_VIOLATION;break;case 1009:t=Mt.MESSAGE_TOO_BIG;break;case 1011:t=Mt.INTERNAL_ERROR;break;case 1012:t=Mt.SERVICE_RESTART;break;case 1013:t=Mt.TRY_AGAIN;break;case 1014:t=Mt.BAD_GATEWAY;break;case 1015:t=Mt.TLS_HANDSHAKE;break;default:j(this,Jt).warn("closeCallback","unknow CloseEvent.code",{evt:e}),t=Mt.CANT_ESTABLISH}if(!this.currentErrorCode&&e.code!==1e3){const n=new Error(t||e.reason);this.rejectDeferredPending(n),this.event.emitError(n)}}async manageAckMessage(e){var n;j(this,Jt).info("manageAckMessage",{websocketMessage:e});const t=e;t.hmacChallenge&&this.send({type:"hmac",hmac:await Zb(t.hmacChallenge,this.configuration.server.applicationKey,this.configuration.server.hmacKey)}),t.iinkSessionId&&(this.sessionId=t.iinkSessionId),io(this.configuration.server.version,"2.3.0")||delete this.configuration.recognition.convert,io(this.configuration.server.version,"3.2.0")||delete this.configuration.recognition.export.jiix.text.lines,this.send({...this.configuration.recognition,type:"configuration"}),(n=this.ackDeferred)==null||n.resolve()}async manageContentPackageDescriptionMessage(){var e;this.reconnectionCount=0,await((e=this.ackDeferred)==null?void 0:e.promise),j(this,Jt).info("manageContentPackageDescriptionMessage"),this.currentPartId?this.send({type:"openContentPart",id:this.currentPartId,mimeTypes:this.mimeTypes}):this.send({type:"newContentPart",contentType:this.configuration.recognition.type,mimeTypes:this.mimeTypes})}managePartChangeMessage(e){j(this,Jt).info("managePartChangeMessage",{websocketMessage:e});const t=e;this.currentPartId=t.partId,this.initialized.resolve()}manageExportMessage(e){var n,s,o,i,a,l,c,u;j(this,Jt).info("manageExportMessage",{websocketMessage:e});const t=e;t.exports["application/vnd.myscript.jiix"]&&(t.exports["application/vnd.myscript.jiix"]=JSON.parse(t.exports["application/vnd.myscript.jiix"].toString())),this.initialized.resolve(),(n=this.addStrokeDeferred)==null||n.resolve(t.exports),(s=this.exportDeferred)==null||s.resolve(t.exports),(o=this.convertDeferred)==null||o.resolve(t.exports),(i=this.importDeferred)==null||i.resolve(t.exports),(a=this.undoDeferred)==null||a.resolve(t.exports),(l=this.redoDeferred)==null||l.resolve(t.exports),(c=this.clearDeferred)==null||c.resolve(t.exports),(u=this.importPointEventsDeferred)==null||u.resolve(t.exports),this.event.emitExported(t.exports)}async manageWaitForIdle(){var e;this.event.emitIdle(!0),(e=this.waitForIdleDeferred)==null||e.resolve()}manageErrorMessage(e){var o,i;const t=e;this.currentErrorCode=((o=t.data)==null?void 0:o.code)||t.code;let n=((i=t.data)==null?void 0:i.message)||t.message||Mt.UNKNOW;switch(this.currentErrorCode){case"no.activity":n=Mt.NO_ACTIVITY;break;case"access.not.granted":n=Mt.WRONG_CREDENTIALS;break;case"session.too.old":n=Mt.TOO_OLD}const s=new Error(n);this.rejectDeferredPending(s),this.event.emitError(s)}manageContentChangeMessage(e){j(this,Jt).info("manageContentChangeMessage",{websocketMessage:e});const t=e,n={canRedo:t.canRedo,canUndo:t.canUndo,empty:t.empty,stackIndex:t.undoStackIndex,possibleUndoCount:t.possibleUndoCount};this.event.emitContentChanged(n)}manageSVGPatchMessage(e){var n;j(this,Jt).info("manageSVGPatchMessage",{websocketMessage:e}),(n=this.resizeDeferred)==null||n.resolve();const t=e;this.event.emitSVGPatch(t)}messageCallback(e){j(this,Jt).debug("messageCallback",{message:e}),this.currentErrorCode=void 0;const t=JSON.parse(e.data);if(t.type!=="pong")switch(this.pingCount=0,t.type){case"ack":this.manageAckMessage(t);break;case"contentPackageDescription":this.manageContentPackageDescriptionMessage();break;case"partChanged":this.managePartChangeMessage(t);break;case"newPart":this.initialized.resolve();break;case"contentChanged":this.manageContentChangeMessage(t);break;case"exported":this.manageExportMessage(t);break;case"svgPatch":this.manageSVGPatchMessage(t);break;case"error":this.manageErrorMessage(t);break;case"idle":this.manageWaitForIdle();break;default:j(this,Jt).warn("messageCallback",`Message type unknow: "${t.type}".`)}}async init(e,t){try{this.event.emitStartInitialization(),j(this,Jt).info("init",{height:e,width:t}),this.destroy(),this.configuration.server.version||(this.configuration.server.version=(await im(this.configuration)).version),this.connected=new Xt,this.initialized=new Xt,this.ackDeferred=new Xt,this.viewSizeHeight=e,this.viewSizeWidth=t,this.pingCount=0,this.socket=new WebSocket(this.url),this.configuration.server.websocket.pingEnabled&&this.infinitePing(),this.socket.addEventListener("open",this.openCallback.bind(this)),this.socket.addEventListener("close",this.closeCallback.bind(this)),this.socket.addEventListener("message",this.messageCallback.bind(this)),this.event.emitEndtInitialization(),await this.connected.promise,await this.initialized.promise}catch(n){return this.rejectDeferredPending(n),this.initialized.promise}}async send(e){var t;return this.socket?(await((t=this.connected)==null?void 0:t.promise),this.socket.readyState===this.socket.OPEN?(j(this,Jt).debug("send",{message:e}),this.socket.send(JSON.stringify(e)),Promise.resolve()):this.socket.readyState!=this.socket.CONNECTING&&this.configuration.server.websocket.autoReconnect?(this.reconnectionCount++,this.configuration.server.websocket.maxRetryCount>=this.reconnectionCount?(j(this,Jt).debug("send",`try to reconnect number: ${this.reconnectionCount}.`),await this.init(this.viewSizeHeight,this.viewSizeWidth),await this.setPenStyle(this.penStyle),await this.setPenStyleClasses(this.penStyleClasses),await this.setTheme(this.theme),this.send(e)):Promise.reject(new Error("Unable to send message. The maximum number of connection attempts has been reached."))):void 0):Promise.reject(new Error("Recognizer must be initilized"))}async addStrokes(e){var t;return j(this,Jt).info("addStrokes",{strokes:e}),await this.initialized.promise,this.addStrokeDeferred=new Xt,e.length===0?this.addStrokeDeferred.resolve({}):await this.send({type:"addStrokes",strokes:e.map(n=>n.formatToSend())}),(t=this.addStrokeDeferred)==null?void 0:t.promise}async setPenStyle(e){j(this,Jt).info("setPenStyle",{penStyle:e}),await this.initialized.promise,this.penStyle=e;const t={type:"setPenStyle",style:_k.penStyleToCSS(e)};return this.send(t)}async setPenStyleClasses(e){await this.initialized.promise,this.penStyleClasses=e,j(this,Jt).info("setPenStyleClasses",{penStyleClasses:e});const t={type:"setPenStyleClasses",styleClasses:e};return this.send(t)}async setTheme(e){j(this,Jt).info("setTheme",{theme:e}),await this.initialized.promise,this.theme=e;const t={type:"setTheme",theme:_k.themeToCSS(e)};return this.send(t)}async export(e,t){var a;j(this,Jt).info("export",{model:e,requestedMimeTypes:t}),await this.initialized.promise,this.exportDeferred=new Xt;const n=e.clone();let s=t||[];if(!s.length)switch(this.configuration.recognition.type){case"MATH":s=this.configuration.recognition.math.mimeTypes;break;case"TEXT":s=this.configuration.recognition.text.mimeTypes;break;default:throw new Error(`Recognition type "${this.configuration.recognition.type}" is unknown.
 Possible types are:
 -MATH
 -TEXT`)}if(!s.length)return Promise.reject(new Error(`Export failed, no mimeTypes define in recognition ${this.configuration.recognition.type} configuration`));const o={type:"export",partId:this.currentPartId,mimeTypes:s};await this.send(o);const i=await((a=this.exportDeferred)==null?void 0:a.promise);return n.updatePositionReceived(),n.mergeExport(i),j(this,Jt).debug("export",{model:n}),n}async import(e,t,n){var u;j(this,Jt).info("import",{data:t,mimeType:n}),await this.initialized.promise;const s=e.clone(),o=this.configuration.server.websocket.fileChunkSize,i=Math.random().toString(10).substring(2,6);this.importDeferred=new Xt;const a=p=>{const f=new FileReader;return new Promise((m,v)=>{f.onloadend=b=>{var S;return m((S=b.target)==null?void 0:S.result)},f.onerror=()=>v(),f.readAsText(p)})},l={type:"importFile",importFileId:i,mimeType:n};await this.send(l);for(let p=0;p<t.size;p+=o){const f=t.slice(p,p+o,t.type),m={type:"fileChunk",importFileId:i,data:await a(f),lastChunk:p+o>t.size};await this.send(m)}const c=await((u=this.importDeferred)==null?void 0:u.promise);return this.importDeferred=void 0,s.mergeExport(c),s}async resize(e){var s;j(this,Jt).info("resize",{model:e}),await this.initialized.promise,this.resizeDeferred=new Xt;const t=e.clone();this.viewSizeHeight=t.height,this.viewSizeWidth=t.width;const n={type:"changeViewSize",height:this.viewSizeHeight,width:this.viewSizeWidth};return await this.send(n),await((s=this.resizeDeferred)==null?void 0:s.promise),t}async importPointEvents(e){var n;j(this,Jt).info("importPointsEvents",{strokes:e}),await this.initialized.promise,this.importPointEventsDeferred=new Xt;const t={type:"pointerEvents",events:e.map(s=>s.formatToSend())};return await this.send(t),(n=this.importPointEventsDeferred)==null?void 0:n.promise}async convert(e,t){var i;j(this,Jt).info("convert",{model:e,conversionState:t}),await this.initialized.promise,this.convertDeferred=new Xt;const n=e.clone(),s={type:"convert",conversionState:t};await this.send(s);const o=await((i=this.convertDeferred)==null?void 0:i.promise);return n.updatePositionReceived(),n.mergeConvert(o),j(this,Jt).debug("convert",{model:n}),n}async waitForIdle(){var e;return await this.initialized.promise,this.waitForIdleDeferred=new Xt,await this.send({type:"waitForIdle"}),(e=this.waitForIdleDeferred)==null?void 0:e.promise}async undo(e){var s;j(this,Jt).info("undo",{model:e}),await this.initialized.promise;const t=e.clone();this.undoDeferred=new Xt,await this.send({type:"undo"});const n=await((s=this.undoDeferred)==null?void 0:s.promise);return t.updatePositionReceived(),t.mergeExport(n),j(this,Jt).debug("undo",{model:t}),this.undoDeferred=void 0,t}async redo(e){var s;j(this,Jt).info("redo",{model:e}),await this.initialized.promise;const t=e.clone();this.redoDeferred=new Xt,await this.send({type:"redo"});const n=await((s=this.redoDeferred)==null?void 0:s.promise);return t.updatePositionReceived(),t.mergeExport(n),j(this,Jt).debug("redo",{model:n}),this.redoDeferred=void 0,t}async clear(e){var s;j(this,Jt).info("clear",{model:e}),await this.initialized.promise;const t=e.clone();t.modificationDate=Date.now(),this.clearDeferred=new Xt,await this.send({type:"clear"});const n=await((s=this.clearDeferred)==null?void 0:s.promise);return t.updatePositionReceived(),t.mergeExport(n),this.clearDeferred=void 0,j(this,Jt).info("clear",{model:t}),t}close(e,t){this.socket.readyState!==this.socket.OPEN&&this.socket.readyState!==this.socket.CONNECTING||(j(this,Jt).info("close",{code:e,reason:t}),this.socket.removeEventListener("close",this.closeCallback),this.socket.removeEventListener("message",this.messageCallback),this.socket.removeEventListener("open",this.openCallback),this.socket.close(e,t))}destroy(){j(this,Jt).info("destroy"),this.connected=void 0,this.ackDeferred=void 0,this.addStrokeDeferred=void 0,this.exportDeferred=void 0,this.convertDeferred=void 0,this.importDeferred=void 0,this.importPointEventsDeferred=void 0,this.waitForIdleDeferred=void 0,this.resizeDeferred=void 0,this.undoDeferred=void 0,this.redoDeferred=void 0,this.clearDeferred=void 0,this.socket&&(this.socket.removeEventListener("close",this.closeCallback),this.socket.removeEventListener("message",this.messageCallback),this.socket.removeEventListener("open",this.openCallback),this.close(1e3,"Recognizer destroyed"))}}Jt=new WeakMap;var jo;class Lfe{constructor(){De(this,jo,Rt.getLogger(lt.RENDERER));k(this,"symbols",{table:"table",ellipse:"ellipse",line:"line"})}phi(e){let t=(e+Math.PI)%(2*Math.PI)-Math.PI;return t<-Math.PI&&(t+=2*Math.PI),j(this,jo).debug("phi",{angle:e,returnedAngle:t}),t}drawEllipseArc(e,t){j(this,jo).debug("drawEllipseArc",{context2D:e,shapeEllipse:t});const{centerPoint:n,maxRadius:s,minRadius:o,orientation:i,startAngle:a,sweepAngle:l}=t,c=Math.cos(i)*s,u=Math.cos(i)*o,p=Math.sin(i)*s,f=Math.sin(i)*o,m=Math.floor(Math.abs(l)/.02),v=[];e.save();try{e.beginPath();for(let b=0;b<=m;b++){const S=a+b/m*l,C=Math.atan2(Math.sin(S)/o,Math.cos(S)/s),E=Math.cos(C),T=Math.sin(C),w=n.x+c*E-f*T,M=n.y+u*T+p*E;b===0?e.moveTo(w,M):e.lineTo(w,M),b!==0&&b!==m||v.push({x:w,y:M})}e.stroke()}catch(b){j(this,jo).error("drawEllipseArc",{error:b})}finally{e.restore()}return v}drawLine(e,t,n){j(this,jo).debug("drawLine",{context2D:e,p1:t,p2:n}),e.save();try{e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(n.x,n.y),e.stroke()}catch(s){j(this,jo).error("drawLine",{error:s})}finally{e.restore()}}drawArrowHead(e,t,n,s){j(this,jo).debug("drawArrowHead",{context2D:e,headPoint:t,angle:n,length:s});const o=this.phi(n+Math.PI*(7/8)),i=this.phi(n-Math.PI*(7/8));e.save();try{e.fillStyle=e.strokeStyle,e.moveTo(t.x,t.y),e.beginPath(),e.lineTo(t.x+s*Math.cos(o),t.y+s*Math.sin(o)),e.lineTo(t.x+s*Math.cos(i),t.y+s*Math.sin(i)),e.lineTo(t.x,t.y),e.fill()}catch(a){j(this,jo).error("drawArrowHead",{error:a})}finally{e.restore()}}drawShapeEllipse(e,t){j(this,jo).debug("drawShapeEllipse",{context2D:e,shapeEllipse:t});const n=this.drawEllipseArc(e,t);(t==null?void 0:t.beginDecoration)==="ARROW_HEAD"&&this.drawArrowHead(e,n[0],t.beginTangentAngle,12),(t==null?void 0:t.endDecoration)==="ARROW_HEAD"&&this.drawArrowHead(e,n[1],t.endTangentAngle,12)}drawShapeLine(e,t){j(this,jo).debug("drawShapeLine",{context2D:e,shapeLine:t}),this.drawLine(e,t.firstPoint,t.lastPoint),t.beginDecoration==="ARROW_HEAD"&&this.drawArrowHead(e,t.firstPoint,t.beginTangentAngle,12),t.endDecoration==="ARROW_HEAD"&&this.drawArrowHead(e,t.lastPoint,t.endTangentAngle,12)}draw(e,t){switch(j(this,jo).info("draw",{context2D:e,symbol:t}),e.save(),e.lineWidth=t.style.width,e.strokeStyle=t.style.color,t.type){case this.symbols.table:t.lines.forEach(n=>this.drawLine(e,n.p1,n.p2));break;case this.symbols.ellipse:this.drawShapeEllipse(e,t);break;case this.symbols.line:this.drawShapeLine(e,t);break;default:j(this,jo).warn("draw",`${t.type} not implemented`)}}}jo=new WeakMap;var Fl;class Nfe{constructor(){De(this,Fl,Rt.getLogger(lt.RENDERER))}renderArc(e,t,n){j(this,Fl).debug("renderArc",{context2d:e,center:t,radius:n}),e.arc(t.x,t.y,n,0,2*Math.PI,!0)}renderLine(e,t,n,s){j(this,Fl).debug("renderLine",{context2d:e,begin:t,end:n,width:s});const o=ns(t,zr(t,n),s),i=ns(n,zr(t,n),s);e.moveTo(o[0].x,o[0].y),e.lineTo(i[0].x,i[0].y),e.lineTo(i[1].x,i[1].y),e.lineTo(o[1].x,o[1].y)}renderFinal(e,t,n,s){j(this,Fl).debug("renderFinal",{context2d:e,begin:t,end:n,width:s});const o=zr(t,n),i=ns(n,o,s);e.moveTo(i[0].x,i[0].y);for(let a=1;a<=6;a++){const l=o-a*Math.PI/6;e.lineTo(n.x-n.p*s*Math.sin(l),n.y+n.p*s*Math.cos(l))}}renderQuadratic(e,t,n,s,o){j(this,Fl).debug("renderQuadratic",{context2d:e,begin:t,end:n,ctrl:s,width:o});const i=ns(t,zr(t,s),o),a=ns(n,zr(s,n),o),l=ns(s,zr(t,n),o);e.moveTo(i[0].x,i[0].y),e.quadraticCurveTo(l[0].x,l[0].y,a[0].x,a[0].y),e.lineTo(a[1].x,a[1].y),e.quadraticCurveTo(l[1].x,l[1].y,i[1].x,i[1].y)}draw(e,t){j(this,Fl).info("draw",{context2d:e,stroke:t});const n=t.pointers.length,s=n-2,o=t.style.width>0?t.style.width:e.lineWidth,i=t.style.color?t.style.color:e.strokeStyle,a=t.pointers[0];e.save();try{if(e.beginPath(),n<3)this.renderArc(e,a,.6*o);else{this.renderArc(e,a,o*a.p);const l=Li(a,t.pointers[1]);this.renderLine(e,a,l,o);for(let m=0;m<s;m++){const v=Li(t.pointers[m],t.pointers[m+1]),b=Li(t.pointers[m+1],t.pointers[m+2]),S=t.pointers[m+1];this.renderQuadratic(e,v,b,S,o)}const c=Li(t.pointers[n-2],t.pointers[n-1]),u=t.pointers[n-1];this.renderLine(e,c,u,o);const p=t.pointers[n-2],f=t.pointers[n-1];this.renderFinal(e,p,f,o)}e.closePath(),i!==void 0&&(e.fillStyle=i,e.fill()),e.save()}catch(l){j(this,Fl).error("draw",{error:l})}finally{e.restore()}}}Fl=new WeakMap;var Ba;class Ffe{constructor(){De(this,Ba,Rt.getLogger(lt.RENDERER));k(this,"symbols",{char:"char",string:"string",textLine:"textLine"})}drawUnderline(e,t,n){j(this,Ba).debug("#drawUnderline",{context2D:e,textUnderline:t,underline:n}),e.save();try{const s=t.data.width/t.label.length,o={x:t.data.topLeftPoint.x+n.data.firstCharacter*s,y:t.data.topLeftPoint.y+t.data.height},i={x:t.data.topLeftPoint.x+n.data.lastCharacter*s,y:t.data.topLeftPoint.y+t.data.height};e.beginPath(),e.moveTo(o.x,o.y),e.lineTo(i.x,i.y),e.stroke()}catch(s){j(this,Ba).error("#drawUnderline",{error:s})}finally{e.restore()}}drawText(e,t){j(this,Ba).debug("#drawText",{context2D:e,text:t}),e.save();try{e.font=`${t.data.textHeight}px serif`,e.textAlign=t.data.justificationType==="CENTER"?"center":"left",e.textBaseline="bottom",e.fillStyle=e.strokeStyle,e.fillText(t.label,t.data.topLeftPoint.x,t.data.topLeftPoint.y+t.data.height)}catch(n){j(this,Ba).error("#drawText",{error:n})}finally{e.restore()}}drawTextLine(e,t){j(this,Ba).debug("#drawTextLine",{context2D:e,textUnderline:t}),this.drawText(e,t),t.underlineList.forEach(n=>{this.drawUnderline(e,t,n)})}draw(e,t){switch(j(this,Ba).info("draw",{context2D:e,symbol:t}),e.lineWidth=t.style.width,e.strokeStyle=t.style.color,t.type){case this.symbols.char:case this.symbols.string:this.drawText(e,t);break;case this.symbols.textLine:this.drawTextLine(e,t);break;default:j(this,Ba).warn("draw",`${t.type} not implemented`)}}}Ba=new WeakMap;var Ei;class zfe{constructor(e){De(this,Ei,Rt.getLogger(lt.RENDERER));k(this,"configuration");k(this,"strokeRenderer");k(this,"shapeRenderer");k(this,"textRenderer");k(this,"context");j(this,Ei).info("constructor",{config:e}),this.configuration=e,this.strokeRenderer=new Nfe,this.shapeRenderer=new Lfe,this.textRenderer=new Ffe}createCanvas(e){j(this,Ei).debug("createCanvas",{type:e});const t=document.createElement("canvas");return t.id=e,t.classList.add(e),t.classList.add("ms-canvas"),t}resizeContent(){const e=window.devicePixelRatio;[this.context.renderingCanvas,this.context.capturingCanvas].forEach(t=>{var i;const n=t.parentNode,s=Math.max(this.configuration.minWidth,n.clientWidth),o=Math.max(this.configuration.minHeight,n.clientHeight);t.width=s*e,t.height=o*e,(i=t.getContext("2d"))==null||i.scale(e,e),t.style.width=`${s}px`,t.style.height=`${o}px`})}drawSymbol(e,t){if(j(this,Ei).debug("drawSymbol",{symbol:t}),t.type==="stroke"){const n=t;n.pointerType!=="eraser"&&this.strokeRenderer.draw(e,n)}else Object.keys(this.textRenderer.symbols).includes(t.type)?this.textRenderer.draw(e,t):Object.keys(this.shapeRenderer.symbols).includes(t.type)?this.shapeRenderer.draw(e,t):j(this,Ei).warn("drawSymbol",`symbol type unknow: ${t.type}`)}init(e,t){j(this,Ei).info("init",{element:e});const n=this.createCanvas("ms-rendering-canvas");n.setAttribute("data-layer","MODEL"),t&&(n.style.backgroundSize=`${t.x||1}px ${t.y||1}px`),e.appendChild(n);const s=this.createCanvas("ms-capture-canvas");s.setAttribute("data-layer","CAPTURE"),e.appendChild(s),this.context={parent:e,renderingCanvas:n,renderingCanvasContext:n.getContext("2d"),capturingCanvas:s,capturingCanvasContext:s.getContext("2d")},this.resizeContent()}drawModel(e){var t;j(this,Ei).info("drawModel",{model:e}),(t=this.context.renderingCanvasContext)==null||t.clearRect(0,0,this.context.renderingCanvas.width,this.context.renderingCanvas.height),e.symbols.forEach(n=>this.drawSymbol(this.context.renderingCanvasContext,n)),this.context.capturingCanvasContext.clearRect(0,0,this.context.capturingCanvas.width,this.context.capturingCanvas.height)}drawPendingStroke(e){j(this,Ei).info("drawPendingStroke",{stroke:e}),this.context.capturingCanvasContext.clearRect(0,0,this.context.capturingCanvas.width,this.context.capturingCanvas.height),e&&(e==null?void 0:e.pointerType)!=="eraser"&&this.strokeRenderer.draw(this.context.capturingCanvasContext,e)}resize(e){j(this,Ei).info("resize",{model:e}),this.resizeContent(),this.drawModel(e)}destroy(){j(this,Ei).info("destroy"),this.context.parent&&(this.context.parent.innerHTML="")}}Ei=new WeakMap;const Lt={arrowHeadStartMarker:"arrow-head-start",arrowHeadEndMaker:"arrow-head-end",selectionFilterId:"selection-filter",removalFilterId:"removal-filter",crossMarker:"cross-marker",noSelection:"pointer-events: none; -webkit-touch-callout: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;"},As="http://www.w3.org/2000/svg";class He{static createLayer(e,t={}){const n=document.createElementNS(As,"svg");return n.setAttribute("width",`${e.width}px`),n.setAttribute("height",`${e.height}px`),n.setAttribute("viewBox",`${e.x}, ${e.y}, ${e.width}, ${e.height}`),Object.keys(t).forEach(s=>{n.setAttribute(s,t[s])}),n}static createFilter(e,t={}){const n=document.createElementNS(As,"filter");return n.id=e,Object.keys(t).forEach(s=>{n.setAttribute(s,t[s])}),n}static createDefs(){return document.createElementNS(As,"defs")}static createMarker(e,t={}){const n=document.createElementNS(As,"marker");return n.setAttribute("id",e),Object.keys(t).forEach(s=>{n.setAttribute(s,t[s])}),n}static createComponentTransfert(){return document.createElementNS(As,"feComponentTransfer")}static createDropShadow({dx:e=0,dy:t=0,deviation:n=0,color:s="#3e68ff",opacity:o=1}){const i=document.createElementNS(As,"feDropShadow");return i.setAttribute("dx",e.toString()),i.setAttribute("dy",t.toString()),i.setAttribute("stdDeviation",n.toString()),i.setAttribute("flood-color",s),i.setAttribute("flood-opacity",o.toString()),i}static createTransfertFunctionTable(e,t){const n=document.createElementNS(As,e);return n.setAttribute("type","table"),n.setAttribute("tableValues",t),n}static createGroup(e={}){const t=document.createElementNS(As,"g");return Object.keys(e).forEach(n=>{t.setAttribute(n,e[n])}),t}static createLine(e,t,n={}){const s=document.createElementNS(As,"line");return s.setAttribute("x1",e.x.toString()),s.setAttribute("y1",e.y.toString()),s.setAttribute("x2",t.x.toString()),s.setAttribute("y2",t.y.toString()),Object.keys(n).forEach(o=>{s.setAttribute(o,n[o])}),s}static createCircle(e,t,n={}){const s=document.createElementNS(As,"circle");return s.setAttribute("cx",e.x.toString()),s.setAttribute("cy",e.y.toString()),s.setAttribute("r",t.toString()),Object.keys(n).forEach(o=>{s.setAttribute(o,n[o])}),s}static createPath(e={}){const t=document.createElementNS(As,"path");return Object.keys(e).forEach(n=>{t.setAttribute(n,e[n])}),t}static createPolygon(e,t={}){const n=document.createElementNS(As,"polygon");return n.setAttribute("points",e.join(",")),Object.keys(t).forEach(s=>{n.setAttribute(s,t[s])}),n}static createRect(e,t={}){const n=document.createElementNS(As,"rect");return n.setAttribute("x",e.x.toString()),n.setAttribute("y",e.y.toString()),n.setAttribute("width",e.width.toString()),n.setAttribute("height",e.height.toString()),Object.keys(t).forEach(s=>{n.setAttribute(s,t[s])}),n}static createTSpan(e,t={}){const n=document.createElementNS(As,"tspan");return n.textContent=e,Object.keys(t).forEach(s=>{n.setAttribute(s,t[s])}),n}static createForeignObject(e,t,n={}){const s=document.createElementNS(As,"foreignObject");return s.setAttribute("x",e.x.toString()),s.setAttribute("y",e.y.toString()),s.setAttribute("width",e.width.toString()),s.setAttribute("height",e.height.toString()),Object.keys(n).forEach(o=>{s.setAttribute(o,n[o])}),s.appendChild(t),s}static createText(e,t,n={}){const s=document.createElementNS(As,"text");return s.textContent=t,s.setAttribute("x",e.x.toString()),s.setAttribute("y",e.y.toString()),Object.keys(n).forEach(o=>{s.setAttribute(o,n[o])}),s}}class Kd{static getLinePath(e){return`M ${e.start.x} ${e.start.y} L ${e.end.x} ${e.end.y}`}static getPolyLinePath(e){return`M ${e.vertices[0].x} ${e.vertices[0].y} ${e.vertices.map(t=>`L ${t.x} ${t.y}`).join(" ")}`}static getArcPath(e){return`M ${e.vertices[0].x} ${e.vertices[0].y} Q ${e.vertices.map(t=>`${t.x} ${t.y}`).join(" ")}`}static getSVGPath(e){switch(e.kind){case jr.Line:return Kd.getLinePath(e);case jr.PolyEdge:return Kd.getPolyLinePath(e);case jr.Arc:return Kd.getArcPath(e);default:throw new Error(`Can't getSVGPath for edge cause kind is unknow: "${JSON.stringify(e)}"`)}}static getSVGElement(e){const t={id:e.id,type:e.type,kind:e.kind,"vector-effect":"non-scaling-stroke","stroke-linecap":"round","stroke-linejoin":"round"};e.selected&&(t.filter=`url(#${Lt.selectionFilterId})`),e.deleting&&(t.filter=`url(#${Lt.removalFilterId})`);const n=He.createGroup(t),s={fill:"transparent",stroke:e.style.color||Sn.color,"stroke-width":(e.style.width||Sn.width).toString(),d:Kd.getSVGPath(e)};return e.style.opacity&&(s.opacity=e.style.opacity.toString()),e.startDecoration===iu.Arrow&&(s["marker-start"]=`url(#${Lt.arrowHeadStartMarker})`),e.endDecoration===iu.Arrow&&(s["marker-end"]=`url(#${Lt.arrowHeadEndMaker})`),n.appendChild(He.createPath(s)),n}}class gI{static getSVGPath(e){if(e.pointers.length<1)return"";const t=e.pointers.at(0),n=`M ${t.x} ${t.y}`;if(e.pointers.length===1){const s=e.style.width||4;return`${n} L ${t.x+s/2} ${t.y}`}return e.pointers.slice(1).reduce((s,o)=>`${s} L ${o.x} ${o.y}`,n)}static getSVGElement(e){const t={id:e.id,type:"eraser","stroke-width":"12",stroke:"grey",opacity:"0.2",shadowBlur:"5","stroke-linecap":"round",fill:"transparent",d:gI.getSVGPath(e)};return He.createPath(t)}}class eS{static getSVGElement(e,t){const n={id:e.id,type:"decorator",kind:e.kind,"vector-effect":"non-scaling-stroke","stroke-linecap":"round","stroke-linejoin":"round"};let s;switch(e.style.opacity&&(n.opacity=e.style.opacity.toString()),t.deleting&&(n.opacity=(.5*(e.style.opacity||1)).toString()),e.kind){case Qt.Highlight:{n.opacity=t.deleting?"0.25":"0.5",n.stroke="transparent",n.fill=e.style.color||Sn.color;const o={x:t.bounds.x-+(t.style.width||Sn.width),y:t.bounds.y-+(t.style.width||Sn.width),height:t.bounds.height+2*+(t.style.width||Sn.width),width:t.bounds.width+2*+(t.style.width||Sn.width)};s=He.createRect(o,n);break}case Qt.Surround:{n.fill="transparent",n.stroke=e.style.color||Sn.color,n["stroke-width"]=(e.style.width||Sn.width).toString();const o={x:t.bounds.x-+(t.style.width||Sn.width),y:t.bounds.y-+(t.style.width||Sn.width),height:t.bounds.height+2*+(t.style.width||Sn.width),width:t.bounds.width+2*+(t.style.width||Sn.width)};s=He.createRect(o,n);break}case Qt.Strikethrough:{n.fill="transparent",n.stroke=e.style.color||Sn.color,n["stroke-width"]=(e.style.width||Sn.width).toString();const o={x:t.bounds.xMin,y:t.bounds.yMid},i={x:t.bounds.xMax,y:t.bounds.yMid};t.type===oe.Recognized&&t.kind===jn.Text&&(o.y=t.baseline-t.xHeight/2,i.y=t.baseline-t.xHeight/2),s=He.createLine(o,i,n);break}case Qt.Underline:{n.fill="transparent",n.stroke=e.style.color||Sn.color,n["stroke-width"]=(e.style.width||Sn.width).toString();const o={x:t.bounds.xMin,y:t.bounds.yMax+ +(t.style.width||Sn.width)},i={x:t.bounds.xMax,y:t.bounds.yMax+ +(t.style.width||Sn.width)};t.type===oe.Recognized&&t.kind===jn.Text&&(o.y=t.baseline+t.xHeight/2,i.y=t.baseline+t.xHeight/2),s=He.createLine(o,i,n);break}}return s}}class Vd{static getPolygonePath(e){return`M ${e.points[0].x} ${e.points[0].y} ${e.points.slice(1).map(t=>`L ${t.x} ${t.y}`).join(" ")} Z`}static getCirclePath(e){return`M ${e.center.x-e.radius} ${e.center.y} a ${e.radius} ${e.radius} 0 1 1 ${2*e.radius} 0 a ${e.radius} ${e.radius} 0 1 1 -${2*e.radius} 0 Z`}static getEllipsePath(e){return`M ${e.center.x-e.radiusX} ${e.center.y} a ${e.radiusX} ${e.radiusY} 0 1 1 ${2*e.radiusX} 0 a ${e.radiusX} ${e.radiusY} 0 1 1 -${2*e.radiusX} 0 Z`}static getSVGPath(e){switch(e.kind){case mr.Polygon:return Vd.getPolygonePath(e);case mr.Circle:return Vd.getCirclePath(e);case mr.Ellipse:return Vd.getEllipsePath(e);default:throw new Error(`Can't getSVGPath for shape cause kind is unknow: "${JSON.stringify(e)}"`)}}static getSVGElement(e){const t={id:e.id,type:e.type,kind:e.kind,"vector-effect":"non-scaling-stroke","stroke-linecap":"round","stroke-linejoin":"round"};e.selected&&(t.filter=`url(#${Lt.selectionFilterId})`),e.deleting&&(t.filter=`url(#${Lt.removalFilterId})`);const n=He.createGroup(t),s={fill:e.style.fill||"transparent",stroke:e.style.color||Sn.color,"stroke-width":(e.style.width||Sn.width).toString(),d:Vd.getSVGPath(e)};return e.style.opacity&&(s.opacity=e.style.opacity.toString()),e.kind===mr.Ellipse&&(s.transform=`rotate(${Ik(e.orientation)}, ${e.center.x}, ${e.center.y})`),n.appendChild(He.createPath(s)),n}}class lm{static getArcPath(e,t){return[`M ${e.x} ${e.y}`,`m ${-t} 0`,`a ${t} ${t} 0 1 0 ${2*t} 0`,`a ${t} ${t} 0 1 0 ${-2*t} 0`].join(" ")}static getLinePath(e,t,n){const s=ns(e,zr(e,t),n),o=ns(t,zr(e,t),n);return[`M ${s[0].x} ${s[0].y}`,`L ${o[0].x} ${o[0].y}`,`L ${o[1].x} ${o[1].y}`,`L ${s[1].x} ${s[1].y}`].join(" ")}static getFinalPath(e,t,n){const s=zr(e,t),o=ns(t,s,n),i=[`M ${o[0].x} ${o[0].y}`];for(let a=1;a<=6;a++){const l=s-a*(Math.PI/6),c=+(t.x-t.p*n*Math.sin(l)).toFixed(3),u=+(t.y+t.p*n*Math.cos(l)).toFixed(3);i.push(`L ${c} ${u}`)}return i.join(" ")}static getQuadraticPath(e,t,n,s){const o=ns(e,zr(e,n),s),i=ns(t,zr(n,t),s),a=ns(n,zr(e,t),s);return[`M ${o[0].x} ${o[0].y}`,`Q ${a[0].x} ${a[0].y} ${i[0].x} ${i[0].y}`,`L ${i[1].x} ${i[1].y}`,`Q ${a[1].x} ${a[1].y} ${o[1].x} ${o[1].y}`].join(" ")}static getSVGPath(e){const t=e.pointers.length;if(!t)return"";const n=e.style.width,s=t-2,o=e.pointers[0],i=[];if(t<3)i.push(this.getArcPath(o,.6*n));else{i.push(this.getArcPath(o,n*o.p)),i.push(this.getLinePath(o,Li(o,e.pointers[1]),n));for(let c=0;c<s;c++){const u=Li(e.pointers[c],e.pointers[c+1]),p=Li(e.pointers[c+1],e.pointers[c+2]),f=e.pointers[c+1];i.push(this.getQuadraticPath(u,p,f,n))}const a=e.pointers[t-2],l=e.pointers[t-1];i.push(this.getLinePath(Li(a,l),l,n)),i.push(this.getFinalPath(a,l,n))}return i.join(" ")}static getSVGElement(e){const t={id:e.id,type:"stroke","vector-effect":"non-scaling-stroke","stroke-linecap":"round","stroke-linejoin":"round"};e.selected&&(t.filter=`url(#${Lt.selectionFilterId})`),e.deleting&&(t.filter=`url(#${Lt.removalFilterId})`);const n=He.createGroup(t),s={fill:e.style.color||Sn.color,"stroke-width":e.style.width.toString(),d:lm.getSVGPath(e)};return e.style.opacity&&(s.opacity=e.style.opacity.toString()),n.append(He.createPath(s)),e.decorators.forEach(o=>{const i=eS.getSVGElement(o,e);i&&(o.kind===Qt.Highlight?n.prepend(i):n.append(i))}),n}}class j7{static getSVGElement(e){const t={id:e.id,type:e.type,"vector-effect":"non-scaling-stroke","stroke-linecap":"round","stroke-linejoin":"round",style:Lt.noSelection};e.style.opacity&&(t.opacity=e.style.opacity.toString()),e.rotation&&(t.transform=`rotate(${e.rotation.degree}, ${e.rotation.center.x}, ${e.rotation.center.y})`),e.selected&&(t.filter=`url(#${Lt.selectionFilterId})`),e.deleting&&(t.filter=`url(#${Lt.removalFilterId})`);const n=He.createGroup(t),s=He.createText(e.point,"");return e.chars.forEach(o=>{const i={id:o.id,fill:o.color,"font-size":`${o.fontSize}px`,"font-weight":o.fontWeight.toString()};s.appendChild(He.createTSpan(o.label,i))}),n.append(s),e.decorators.forEach(o=>{const i=eS.getSVGElement(o,e);i&&(o.kind===Qt.Highlight?n.prepend(i):n.append(i))}),n}}class R7{static getSVGElement(e){const t={id:e.id,type:e.type,kind:e.kind,"vector-effect":"non-scaling-stroke","stroke-linecap":"round","stroke-linejoin":"round",fill:e.style.color||Sn.color,"stroke-width":(e.style.width||Sn.width).toString()};e.style.opacity&&(t.opacity=e.style.opacity.toString()),e.selected&&(t.filter=`url(#${Lt.selectionFilterId})`),e.deleting&&(t.filter=`url(#${Lt.removalFilterId})`);const n=He.createGroup(t);return e.strokes.forEach(s=>{n.append(lm.getSVGElement(s))}),e.kind===jn.Text&&e.decorators.forEach(s=>{const o=eS.getSVGElement(s,e);o&&(s.kind===Qt.Highlight?n.prepend(o):n.append(o))}),n}}class M0{static getChildElement(e){let t;switch(e.type){case oe.Stroke:t=lm.getSVGElement(e);break;case oe.Shape:t=Vd.getSVGElement(e);break;case oe.Edge:t=Kd.getSVGElement(e);break;case oe.Text:t=j7.getSVGElement(e);break;case oe.Group:t=M0.getSVGElement(e);break;case oe.Recognized:t=R7.getSVGElement(e)}return t}static getSVGElement(e){const t={id:e.id,type:"group","vector-effect":"non-scaling-stroke","stroke-linecap":"round","stroke-linejoin":"round",fill:e.style.color||Sn.color,"stroke-width":(e.style.width||Sn.width).toString()};e.style.opacity&&(t.opacity=e.style.opacity.toString()),e.selected&&(t.filter=`url(#${Lt.selectionFilterId})`),e.deleting&&(t.filter=`url(#${Lt.removalFilterId})`);const n=He.createGroup(t);return e.children.forEach(s=>{n.append(M0.getChildElement(s))}),e.decorators.forEach(s=>{const o=eS.getSVGElement(s,e);o&&(s.kind===Qt.Highlight?n.prepend(o):n.append(o))}),n}}var Qr;class D7{constructor(e){De(this,Qr,Rt.getLogger(lt.RENDERER));k(this,"groupGuidesId","guides-wrapper");k(this,"configuration");k(this,"parent");k(this,"layer");k(this,"definitionGroup");k(this,"verticalGuides",[]);k(this,"horizontalGuides",[]);j(this,Qr).info("constructor",{configuration:e}),this.configuration=e}initLayer(){const e=Math.max(this.configuration.minWidth,this.parent.clientWidth),t=Math.max(this.configuration.minHeight,this.parent.clientHeight);this.layer=He.createLayer({x:0,y:0,width:e,height:t}),this.layer.style.setProperty("height","auto"),this.layer.style.setProperty("width","auto"),this.layer.appendChild(this.createSVGTools()),this.parent.style.setProperty("overflow","auto"),this.parent.appendChild(this.layer)}createDefs(){const e=He.createDefs(),t=4,n=2.5,s={style:Lt.noSelection,fill:"context-stroke",markerWidth:"5",markerHeight:"5",refX:t.toString(),refY:n.toString()},o=He.createMarker(Lt.arrowHeadStartMarker,{...s,orient:"auto-start-reverse"});o.appendChild(He.createPolygon([0,0,5,n,0,5],s)),e.appendChild(o);const i=He.createMarker(Lt.arrowHeadEndMaker,{...s,orient:"auto"});i.appendChild(He.createPolygon([0,0,5,n,0,5],s)),e.appendChild(i);const a={style:Lt.noSelection,markerWidth:"5",markerHeight:"5",refX:"0",refY:"0",viewBox:"-5 -5 10 10"},l=He.createMarker(Lt.crossMarker,a);return l.appendChild(He.createPath({d:"M -4,-4 L 4,4 M -4,4 L 4,-4",stroke:"white","stroke-width":"3"})),l.appendChild(He.createPath({d:"M -4,-4 L 4,4 M -4,4 L 4,-4",stroke:"context-stroke","stroke-width":"2"})),e.appendChild(l),e}createFilters(){const e=He.createGroup({id:"definition-group"}),t=He.createFilter(Lt.removalFilterId,{filterUnits:"userSpaceOnUse"}),n=He.createComponentTransfert(),s=He.createTransfertFunctionTable("feFuncA","0 0.25");n.appendChild(s),t.appendChild(n),e.appendChild(t);const o=He.createFilter(Lt.selectionFilterId,{filterUnits:"userSpaceOnUse"});return o.appendChild(He.createDropShadow({dx:-1,dy:-1,deviation:1})),e.appendChild(o),e}drawGuides(){var a,l;this.verticalGuides=[],this.horizontalGuides=[];const e=Number((a=this.layer.getAttribute("height"))==null?void 0:a.replace("px","")),t=Number((l=this.layer.getAttribute("width"))==null?void 0:l.replace("px","")),n=this.configuration.guides.gap,s=this.configuration.guides.gap/5,o={id:this.groupGuidesId,stroke:"grey",opacity:"0.5",style:Lt.noSelection,role:kr.Guide},i=He.createGroup(o);switch(this.configuration.guides.type){case"line":for(let c=n;c<e;c+=n){const u={x:n,y:c},p={x:t-n,y:c};this.horizontalGuides.push(c);const f=He.createLine(u,p,{"stroke-width":"1",style:Lt.noSelection});i.appendChild(f)}break;case"grid":for(let c=0;c<e;c+=n){const u={x:0,y:c},p={x:t,y:c},f=He.createLine(u,p,{"stroke-width":"1",style:Lt.noSelection});i.appendChild(f),this.horizontalGuides.push(c);for(let m=c+s;m<c+n;m+=s){this.horizontalGuides.push(m);const v=He.createLine({x:0,y:m},{x:t,y:m},{"stroke-width":"0.25",style:Lt.noSelection});i.appendChild(v)}}for(let c=0;c<t;c+=n){const u={x:c,y:0},p={x:c,y:e},f=He.createLine(u,p,{"stroke-width":"1",style:Lt.noSelection});i.appendChild(f),this.verticalGuides.push(c);for(let m=c+s;m<c+n;m+=s){this.verticalGuides.push(m);const v=He.createLine({x:m,y:0},{x:m,y:e},{"stroke-width":"0.25",style:Lt.noSelection});i.appendChild(v)}}break;case"point":for(let c=n;c<t;c+=n){this.verticalGuides.push(c);for(let u=n;u<e;u+=n){this.horizontalGuides.push(u);const p=He.createCircle({x:c,y:u},1);i.appendChild(p)}}break;default:j(this,Qr).error("drawGuides",`Guide type unknown: ${this.configuration.guides.type}`)}this.horizontalGuides=[...new Set(this.horizontalGuides)],this.verticalGuides=[...new Set(this.verticalGuides)],this.definitionGroup.appendChild(i)}removeGuides(){var e;this.verticalGuides=[],this.horizontalGuides=[],(e=this.layer.querySelector(`#${this.groupGuidesId}`))==null||e.remove()}createSVGTools(){return this.definitionGroup=He.createGroup({id:"definition-group"}),this.definitionGroup.appendChild(this.createDefs()),this.definitionGroup.appendChild(this.createFilters()),this.configuration.guides.enable&&this.drawGuides(),this.definitionGroup}init(e){j(this,Qr).info("init",{element:e}),this.parent=e,this.parent.oncontextmenu=()=>!1,this.initLayer()}getAttribute(e,t){const n=this.layer.querySelector(`#${e}`);return n==null?void 0:n.getAttribute(t)}setAttribute(e,t,n){const s=this.layer.querySelector(`#${e}`);s==null||s.setAttribute(t,n)}buildElementFromSymbol(e){let t;switch(e.type){case oe.Stroke:t=lm.getSVGElement(e);break;case oe.Eraser:t=gI.getSVGElement(e);break;case oe.Shape:t=Vd.getSVGElement(e);break;case oe.Edge:t=Kd.getSVGElement(e);break;case oe.Text:t=j7.getSVGElement(e);break;case oe.Group:t=M0.getSVGElement(e);break;case oe.Recognized:t=R7.getSVGElement(e);break;default:j(this,Qr).error("buildElementFromSymbol",`symbol unknow: "${JSON.stringify(e)}"`)}return t}prependElement(e){this.layer.prepend(e)}changeOrderSymbol(e,t){var s,o;const n=this.layer.querySelector(`#${e.id}`);if(n)switch(t){case"first":this.definitionGroup.insertAdjacentElement("afterend",n);break;case"last":this.layer.insertAdjacentElement("beforeend",n);break;case"forward":(s=n.nextElementSibling)==null||s.insertAdjacentElement("afterend",n);break;case"backward":n.previousElementSibling!==this.definitionGroup&&((o=n.previousElementSibling)==null||o.insertAdjacentElement("beforebegin",n))}}appendElement(e){this.layer.appendChild(e)}removeElement(e){j(this,Qr).debug("Element",{id:e});const t=this.layer.querySelector(`#${e}`);t&&t.remove()}drawSymbol(e){j(this,Qr).debug("drawSymbol",{symbol:e});const t=this.layer.querySelector(`#${e==null?void 0:e.id}`),n=this.buildElementFromSymbol(e);return n&&(t?t.replaceWith(n):this.layer.appendChild(n)),n}replaceSymbol(e,t){j(this,Qr).debug("drawSymbol",{symbols:t});const n=this.layer.querySelector(`#${e}`),s=t.map(o=>this.buildElementFromSymbol(o)).filter(o=>!!o);return s.length&&(n?(s.forEach(o=>n.insertAdjacentElement("beforebegin",o)),n.remove()):s.forEach(o=>this.layer.appendChild(o))),s}removeSymbol(e){j(this,Qr).debug("removeSymbol",{id:e}),this.removeElement(e)}drawCircle(e,t,n={}){j(this,Qr).info("drawCircle",{point:e,radius:t,attrs:n}),this.layer.appendChild(He.createCircle(e,t,n))}drawRect(e,t={}){j(this,Qr).info("drawRect",{box:e,attrs:t}),this.layer.appendChild(He.createRect(e,t))}drawLine(e,t,n={}){j(this,Qr).info("drawLine",{p1:e,p2:t,attrs:n}),this.layer.appendChild(He.createLine(e,t,n))}drawConnectionBetweenBox(e,t,n,s,o){let i=new at(t).corners,a=new at(n).corners;s==="sides"&&(i=new at(t).side,a=new at(n).side);const{p1:l,p2:c}=nfe(i,a),u={id:e,fill:"transparent",style:Lt.noSelection,...o};this.drawLine(l,c,u)}resize(e,t){j(this,Qr).info("resize",{height:e,width:t}),this.layer.setAttribute("width",`${t}px`),this.layer.setAttribute("height",`${e}px`),this.layer.setAttribute("viewBox",`0, 0, ${t}, ${e}`),this.removeGuides(),this.configuration.guides.enable&&this.drawGuides()}getElementById(e){return this.layer.querySelector(`#${e}`)}getElements({tagName:e,attrs:t}){j(this,Qr).info("getElements",{tagName:e,attrs:t});let n=e||"*";return t&&Object.keys(t).forEach(s=>{n+=`[${s}=${t[s]}]`}),this.layer.querySelectorAll(n)}clearElements({tagName:e,attrs:t}){j(this,Qr).info("clearElements",{tagName:e,attrs:t}),this.getElements({tagName:e,attrs:t}).forEach(n=>n.remove())}clear(){if(j(this,Qr).info("clear"),this.layer){for(;this.layer.firstChild;)this.layer.firstChild.remove();this.layer.appendChild(this.createSVGTools())}}destroy(){this.layer&&this.layer.remove()}}Qr=new WeakMap;class $fe{getArcPath(e,t){return[`M ${e.x},${e.y}`,`m ${-t},0`,`a ${t},${t} 0 1 0 ${2*t},0`,`a ${t},${t} 0 1 0 ${-2*t},0`].join(" ")}getLinePath(e,t,n){const s=ns(e,zr(e,t),n),o=ns(t,zr(e,t),n);return[`M ${s[0].x},${s[0].y}`,`L ${o[0].x},${o[0].y}`,`L ${o[1].x},${o[1].y}`,`L ${s[1].x},${s[1].y}`].join(" ")}getFinalPath(e,t,n){const s=zr(e,t),o=ns(t,s,n),i=[`M ${o[0].x},${o[0].y}`];for(let a=1;a<=6;a++){const l=s-a*(Math.PI/6);i.push(`L ${t.x-t.p*n*Math.sin(l)},${t.y+t.p*n*Math.cos(l)}`)}return i.join(" ")}getQuadraticPath(e,t,n,s){const o=ns(e,zr(e,n),s),i=ns(t,zr(n,t),s),a=ns(n,zr(e,t),s);return[`M ${o[0].x},${o[0].y}`,`Q ${a[0].x},${a[0].y} ${i[0].x},${i[0].y}`,`L ${i[1].x},${i[1].y}`,`Q ${a[1].x},${a[1].y} ${o[1].x},${o[1].y}`].join(" ")}buildSVGPath(e){const t=e.pointers.length,n=e.style.width,s=t-2,o=e.pointers[0],i=[];if(t<3)i.push(this.getArcPath(o,.6*n));else{i.push(this.getArcPath(o,n*o.p)),i.push(this.getLinePath(o,Li(o,e.pointers[1]),n));for(let c=0;c<s;c++){const u=Li(e.pointers[c],e.pointers[c+1]),p=Li(e.pointers[c+1],e.pointers[c+2]),f=e.pointers[c+1];i.push(this.getQuadraticPath(u,p,f,n))}const a=e.pointers[t-2],l=e.pointers[t-1];i.push(this.getLinePath(Li(a,l),l,n)),i.push(this.getFinalPath(a,l,n))}return i.join(" ")}drawStroke(e,t,n){const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.classList.add("pending-stroke"),s.setAttribute("id",t.id),s.setAttribute("type",t.pointerType),n==null||n.forEach(i=>{s.setAttribute(i.name,i.value)});const o=this.buildSVGPath(t);s.setAttribute("d",`${o}Z`),e.appendChild(s)}}var ki;class Bfe{constructor(e){De(this,ki,Rt.getLogger(lt.RENDERER));k(this,"config");k(this,"stroker");k(this,"context");j(this,ki).info("constructor",{config:e}),this.config=e,this.stroker=new $fe}init(e){j(this,ki).info("init",{element:e}),e.style.fontSize="10px",this.context={parent:e}}drawStroke(e,t){let n;t.pointerType==="eraser"?(t.style.width=12,n="fill:grey;stroke:transparent;shadowBlur:5;opacity:0.2;"):n=`fill:${t.style.color};stroke:transparent;`,this.stroker.drawStroke(e,t,[{name:"style",value:n}])}replaceAll(e,t){const n=this.context.parent.querySelector(`svg[data-layer="${e}"]`);n==null||n.remove(),this.context.parent.insertAdjacentHTML("beforeend",t.svg);const s=this.context.parent.querySelector(`svg[data-layer="${e}"]`);if(e==="MODEL"){const o=document.createElementNS("http://www.w3.org/2000/svg","g");o.id="pendingStrokes",s.appendChild(o)}}replaceElement(e){const t=this.context.parent.querySelector(`#${e.id}`);if(t){const n=t.parentNode;t==null||t.remove(),n==null||n.insertAdjacentHTML("beforeend",e.svg)}}appendChild(e,t){const n=t.parentId?`#${t.parentId}`:`svg[data-layer="${e}"]`,s=this.context.parent.querySelector(n);s==null||s.insertAdjacentHTML("beforeend",t.svg)}removeChild(e){var t;(t=this.context.parent.querySelector(`#${e.parentId} > *:nth-child(${e.index+1})`))==null||t.remove()}removeElement(e){const t=this.context.parent.querySelector(`#${e.id}`);t&&(e.id.includes("s")||e.id.includes("MODEL")?t.remove():(t.setAttribute("class","removed-stroke"),setTimeout(()=>{t==null||t.remove()},100)))}insertBefore(e){const t=this.context.parent.querySelector(`#${e.refId}`);t==null||t.insertAdjacentHTML("beforebegin",e.svg)}setAttribute(e){const t=e.id?`#${e.id}`:"svg",n=this.context.parent.querySelector(t);n==null||n.setAttribute(e.name,e.value)}removeAttribute(e){const t=e.id?`#${e.id}`:"svg",n=this.context.parent.querySelector(t);n==null||n.removeAttribute(e.name)}updateLayer(e,t){switch(j(this,ki).info("updateLayer",{layerName:e,update:t}),t.type){case"REPLACE_ALL":this.replaceAll(e,t);break;case"REPLACE_ELEMENT":this.replaceElement(t);break;case"APPEND_CHILD":this.appendChild(e,t);break;case"REMOVE_ELEMENT":this.removeElement(t);break;case"REMOVE_CHILD":this.removeChild(t);break;case"INSERT_BEFORE":this.insertBefore(t);break;case"SET_ATTRIBUTE":this.setAttribute(t);break;case"REMOVE_ATTRIBUTE":this.removeAttribute(t);break;default:j(this,ki).warn("updateLayer",`update.type unknow ${t.type}`)}}updatesLayer(e,t){j(this,ki).info("updatesLayer",{layerName:e,updates:t}),t.forEach(n=>this.updateLayer(e,n)),this.clearPendingStroke()}clearPendingStroke(){j(this,ki).info("clearPendingStroke");const e=this.context.parent.querySelector("#pendingStrokes");e&&(e.innerHTML="")}drawPendingStroke(e){if(j(this,ki).info("drawPendingStroke",{stroke:e}),e){const t=this.context.parent.querySelector("#pendingStrokes");if(t){const n=t.querySelector(`#${e==null?void 0:e.id}`);n&&n.remove(),this.drawStroke(t,e)}}}clearErasingStrokes(){this.context.parent.querySelectorAll("[type=eraser]").forEach(e=>{e.remove()})}resize(e){j(this,ki).info("resize",{model:e});const t=this.context.parent.getBoundingClientRect(),n=this.context.parent.querySelectorAll("svg"),s=Math.max(t.width,e.width),o=Math.max(t.height,e.height);n.forEach(i=>{i.setAttribute("viewBox",`0 0 ${s}, ${o}`),i.setAttribute("width",`${s}px`),i.setAttribute("height",`${o}px`)})}destroy(){var e;j(this,ki).info("destroy",{context:this.context}),(e=this.context)!=null&&e.parent&&this.context.parent.querySelectorAll("svg").forEach(t=>t.remove())}}ki=new WeakMap;const Ufe={enable:!0,gap:50},O7={guides:Ufe,minHeight:100,minWidth:100},L7={guides:{enable:!0,gap:50,type:"point"},minHeight:100,minWidth:100},Hfe={capture:!1,passive:!0},tS={listenerOptions:Hfe,xyFloatPrecision:0,timestampFloatPrecision:0,delayLongTouch:500};var or;class mp{constructor(e){De(this,or,Rt.getLogger(lt.GRABBER));k(this,"configuration");k(this,"layerCapture");k(this,"capturing",!1);k(this,"pointerType");k(this,"prevent",e=>e.preventDefault());k(this,"onPointerDown");k(this,"onPointerMove");k(this,"onPointerUp");k(this,"onContextMenu");k(this,"pointerDownHandler",e=>{const t=this.getPointerInfos(e);j(this,or).debug("pointerDownHandler",t),t.button===0&&e.buttons===1&&(this.capturing=!0,this.pointerType=e.pointerType,j(this,or).level===In.INFO&&j(this,or).info("pointerDownHandler",t),this.onPointerDown&&this.onPointerDown(t))});k(this,"pointerMoveHandler",e=>{const t=this.getPointerInfos(e);j(this,or).debug("pointerMoveHandler",t),this.capturing&&this.pointerType===e.pointerType&&(j(this,or).level===In.INFO&&j(this,or).info("pointerMoveHandler",t),this.onPointerMove&&this.onPointerMove(t))});k(this,"pointerUpHandler",e=>{const t=this.getPointerInfos(e);j(this,or).debug("pointerUpHandler",t),this.capturing&&this.pointerType===e.pointerType&&(j(this,or).level===In.INFO&&j(this,or).info("pointerUpHandler",t),this.pointerType=void 0,this.capturing=!1,this.onPointerUp&&this.onPointerUp(t))});k(this,"pointerOutHandler",e=>{const t=this.getPointerInfos(e);j(this,or).debug("pointerOutHandler",t),this.capturing&&this.pointerType===e.pointerType&&!this.layerCapture.contains(e.target)&&(j(this,or).level===In.INFO&&j(this,or).info("pointerOutHandler",t),this.pointerType=void 0,this.capturing=!1,this.onPointerUp&&this.onPointerUp(t))});k(this,"contextMenuHandler",e=>{const t=this.getPointerInfos(e);j(this,or).debug("contextMenuHandler",t),e.target&&this.onContextMenu&&(j(this,or).level===In.INFO&&j(this,or).info("contextMenuHandler",t),this.onContextMenu(t))});j(this,or).info("constructor",{configuration:e}),this.configuration=e}roundFloat(e,t){if(t>=0){const n=Math.pow(10,t);return Math.round(e/n)*n}return j(this,or).debug("roundFloat",{oneFloat:e,requestedFloatPrecision:t}),e}extractPointer(e){let t,n;({clientX:t,clientY:n}="changedTouches"in e?e.changedTouches[0]:e);const s=this.layerCapture.getBoundingClientRect(),o={x:this.roundFloat(t-s.left-this.layerCapture.clientLeft+this.layerCapture.scrollLeft,this.configuration.xyFloatPrecision),y:this.roundFloat(n-s.top-this.layerCapture.clientTop+this.layerCapture.scrollTop,this.configuration.xyFloatPrecision),t:this.roundFloat(Date.now(),this.configuration.timestampFloatPrecision),p:e.pressure};return j(this,or).debug("extractPointer",{event:e,pointer:o}),o}getPointerInfos(e){return{clientX:e.clientX,clientY:e.clientY,isPrimary:e.isPrimary,type:e.type,target:e.target,pointerType:e.pointerType,pointer:this.extractPointer(e),button:e.button,buttons:e.buttons}}stopPointerEvent(){this.capturing=!1,this.pointerType=void 0}attach(e){j(this,or).info("attach",{domElement:e}),this.layerCapture&&this.detach(),this.layerCapture=e,this.layerCapture.style.setProperty("touch-action","none"),this.layerCapture.addEventListener("pointerdown",this.pointerDownHandler,this.configuration.listenerOptions),this.layerCapture.addEventListener("pointermove",this.pointerMoveHandler,this.configuration.listenerOptions),this.layerCapture.addEventListener("pointerup",this.pointerUpHandler,this.configuration.listenerOptions),this.layerCapture.addEventListener("pointercancel",this.pointerUpHandler,this.configuration.listenerOptions),this.layerCapture.addEventListener("pointerleave",this.pointerUpHandler,this.configuration.listenerOptions),this.layerCapture.addEventListener("pointerout",this.pointerOutHandler,this.configuration.listenerOptions),this.layerCapture.addEventListener("contextmenu",this.contextMenuHandler)}detach(){var e,t,n,s,o,i,a,l;j(this,or).info("detach"),(e=this.layerCapture)==null||e.style.removeProperty("touch-action"),(t=this.layerCapture)==null||t.removeEventListener("pointerdown",this.pointerDownHandler,this.configuration.listenerOptions),(n=this.layerCapture)==null||n.removeEventListener("pointermove",this.pointerMoveHandler,this.configuration.listenerOptions),(s=this.layerCapture)==null||s.removeEventListener("pointerup",this.pointerUpHandler,this.configuration.listenerOptions),(o=this.layerCapture)==null||o.removeEventListener("pointerleave",this.pointerUpHandler,this.configuration.listenerOptions),(i=this.layerCapture)==null||i.removeEventListener("pointercancel",this.pointerUpHandler,this.configuration.listenerOptions),(a=this.layerCapture)==null||a.removeEventListener("pointerout",this.pointerOutHandler,this.configuration.listenerOptions),(l=this.layerCapture)==null||l.removeEventListener("contextmenu",this.contextMenuHandler)}}or=new WeakMap;var Oh;class N7{constructor(e){De(this,Oh,Rt.getLogger(lt.WRITE));k(this,"grabber");k(this,"editor");k(this,"currentSymbol");k(this,"detectGesture",!0);j(this,Oh).info("constructor"),this.editor=e,this.grabber=new mp(e.configuration.grabber)}get renderer(){return this.editor.renderer}attach(e){this.grabber.attach(e),this.grabber.onPointerDown=this.start.bind(this),this.grabber.onPointerMove=this.continue.bind(this),this.grabber.onPointerUp=this.end.bind(this)}detach(){this.grabber.detach()}start(e){j(this,Oh).info("startWriting",{info:e});const t=e.pointer;this.currentSymbol=this.createCurrentSymbol(t,this.editor.penStyle,e.pointerType),this.renderer.drawSymbol(this.currentSymbol)}continue(e){j(this,Oh).info("continueWriting",{info:e});const t=e.pointer;this.currentSymbol=this.updateCurrentSymbol(t),this.renderer.drawSymbol(this.currentSymbol)}}Oh=new WeakMap;var Hc;class Gfe{constructor(e){De(this,Hc,Rt.getLogger(lt.CONVERTER));k(this,"editor");j(this,Hc).info("constructor"),this.editor=e}get configuration(){return this.editor.configuration.fontStyle}get model(){return this.editor.model}get rowHeight(){return this.editor.configuration.rendering.guides.gap}computeFontSize(e){if(e.some(t=>t["bounding-box"])){const t=ot(v7(e.map(n=>{var s;return((s=n["bounding-box"])==null?void 0:s.height)||1})));return 2*Math.round(Math.round(t*this.rowHeight)/this.rowHeight/2)}return Math.round(this.rowHeight/2)}buildChar(e,t,n){const s=e.grid.map(a=>({x:ot(a.x),y:ot(a.y)}));let o=this.configuration.weight;o==="auto"&&(o=(t[0].style.width||1)>2?"bold":"normal");const i=t[0].style.color||"black";return{id:`text-char-${zo()}`,label:e.label,color:i,fontSize:n,fontWeight:o,bounds:at.createFromPoints(s)}}buildText(e,t,n,s){const o=at.createFromBoxes([Ol(e["bounding-box"])]),i=[],a=s==="auto"?this.computeFontSize(t):s;t.forEach(p=>{const f=n.filter(m=>{var v;return(v=p.items)==null?void 0:v.some(b=>b["full-id"]===m.id)});f.length&&i.push(this.buildChar(p,f,a))});const l={x:o.xMin,y:o.yMax},c=new ol(i,l,o,n[0].style),u=n.flatMap(p=>p.decorators);if(n.forEach(p=>{const f=this.model.getRootSymbol(p.id);if((f==null?void 0:f.type)===oe.Recognized&&f.kind===jn.Text||(f==null?void 0:f.type)===oe.Group){const m=f.decorators.find(C=>C.kind===Qt.Highlight);m&&u.push(m);const v=f.decorators.find(C=>C.kind===Qt.Strikethrough);v&&u.push(v);const b=f.decorators.find(C=>C.kind===Qt.Surround);b&&u.push(b);const S=f.decorators.find(C=>C.kind===Qt.Underline);S&&u.push(S)}}),u.length){const p=u.find(b=>b.kind===Qt.Highlight);p&&c.decorators.push(new Pr(Qt.Highlight,p.style));const f=u.find(b=>b.kind===Qt.Strikethrough);f&&c.decorators.push(new Pr(Qt.Strikethrough,f.style));const m=u.find(b=>b.kind===Qt.Surround);m&&c.decorators.push(new Pr(Qt.Surround,m.style));const v=u.find(b=>b.kind===Qt.Underline);v&&c.decorators.push(new Pr(Qt.Underline,v.style))}return c}convertText(e,t,n){var f,m;if(!e.lines)throw new Error("You need to active configuration.recognition.export.jiix.text.lines = true");if(!e.words)throw new Error("You need to active configuration.recognition.export.jiix.text.words = true");if(!e.chars)throw new Error("You need to active configuration.recognition.export.jiix.text.chars = true");if(!e.chars.some(v=>v.items))throw new Error("You need to active configuration.recognition.export.jiix.strokes = true");const s=e.words,o=e.chars,i=[];let a=this.configuration.size;n&&a==="auto"?a=2*Math.round(this.computeFontSize(o.filter(v=>{var b;return(b=v.items)==null?void 0:b.length}))/2):this.configuration.size!=="auto"&&(a=this.configuration.size*this.rowHeight);let l=!1,c=ot(e.lines[0]["baseline-y"]);const u=ot(((f=e["bounding-box"])==null?void 0:f.x)||0);let p=ot(((m=s[0]["bounding-box"])==null?void 0:m.x)||0);return s.forEach(v=>{var S;if(v.label===" ")return void(p+=this.editor.texter.getSpaceWidth(((S=i.at(-1))==null?void 0:S.symbol.chars[0].fontSize)||this.rowHeight/2));const b=t.filter(C=>{var E;return(E=v.items)==null?void 0:E.some(T=>T["full-id"]===C.id)});if(b.length){const C=o.slice(v["first-char"],(v["last-char"]||0)+1),E=this.buildText(v,C,b,a);if(n){if(l){l=!1;const T=Math.round((E.point.y-c)/this.rowHeight)||1;c+=T*this.rowHeight,p=Math.abs(E.point.x-u)<this.rowHeight?u:E.point.x}E.point.x=p,E.point.y=this.model.roundToLineGuide(c)}this.editor.texter.setBounds(E),p+=E.bounds.width,i.push({symbol:E,strokes:b})}l=v.label===`
`}),i}buildCircle(e,t){var s;const n={x:ot(e.cx),y:ot(e.cy)};return new ed(n,ot(e.r),(s=t[0])==null?void 0:s.style)}buildEllipse(e,t){var s;const n={x:ot(e.cx),y:ot(e.cy)};return new td(n,ot(e.rx),ot(e.ry),e.orientation,(s=t[0])==null?void 0:s.style)}buildRectangle(e,t){var a;const n=ot(e.height),s=ot(e.width),o=ot(e.x),i=ot(e.y);return new Ir([{x:o,y:i},{x:o+s,y:i},{x:o+s,y:i+n},{x:o,y:i+n}],(a=t[0])==null?void 0:a.style)}buildPolygon(e,t){var s;const n=[];for(let o=0;o<e.points.length;o+=2)n.push({x:ot(e.points[o]),y:ot(e.points[o+1])});return new Ir(n,(s=t[0])==null?void 0:s.style)}buildRhombus(e,t){var s;const n=[];for(let o=0;o<e.points.length;o+=2)n.push({x:ot(e.points[o]),y:ot(e.points[o+1])});return new Ir(n,(s=t[0])==null?void 0:s.style)}buildTriangle(e,t){var s;const n=[];for(let o=0;o<e.points.length;o+=2)n.push({x:ot(e.points[o]),y:ot(e.points[o+1])});return new Ir(n,(s=t[0])==null?void 0:s.style)}buildParallelogram(e,t){var s;const n=[];for(let o=0;o<e.points.length;o+=2)n.push({x:ot(e.points[o]),y:ot(e.points[o+1])});return new Ir(n,(s=t[0])==null?void 0:s.style)}convertNode(e,t){const n=t.filter(i=>{var a;return(a=e.items)==null?void 0:a.some(l=>l["full-id"]===i.id)});if(!n.length)return;const s=n.filter((i,a)=>n.findIndex(l=>i.id===l.id)===a);let o;switch(e.kind){case Us.Circle:o=this.buildCircle(e,s);break;case Us.Ellipse:o=this.buildEllipse(e,s);break;case Us.Rectangle:o=this.buildRectangle(e,s);break;case Us.Triangle:o=this.buildTriangle(e,s);break;case Us.Parallelogram:o=this.buildParallelogram(e,s);break;case Us.Polygon:o=this.buildPolygon(e,s);break;case Us.Rhombus:o=this.buildRhombus(e,s);break;default:return void j(this,Hc).warn("convertNode",`Conversion of Node with kind equal to ${JSON.stringify(e)} is unknow`)}return{symbol:o,strokes:s}}buildLine(e,t){var i;const n={x:ot(e.x1),y:ot(e.y1)},s={x:ot(e.x2),y:ot(e.y2)},o=zr(n,s);return Math.abs(o%Math.PI)<.1?(n.y=+((n.y+s.y)/2).toFixed(3),s.y=n.y):Math.abs(o%(Math.PI/2))<.1&&(n.x=+((n.x+s.x)/2).toFixed(3),s.x=n.x),new Jh(n,s,e.p1Decoration,e.p2Decoration,(i=t[0])==null?void 0:i.style)}buildPolyEdge(e,t){var o;const n={x:ot(e.edges[0].x1),y:ot(e.edges[0].y1)},s=e.edges.map(i=>({x:ot(i.x2),y:ot(i.y2)}));s.unshift(n);for(let i=0;i<s.length-1;i++){const a=s[i],l=s[i+1],c=zr(a,l);Math.abs(c%Math.PI)<.1?(a.y=+((a.y+l.y)/2).toFixed(3),l.y=a.y):Math.abs(c%(Math.PI/2))<.1&&(a.x=+((a.x+l.x)/2).toFixed(3),l.x=a.x)}return new rg(s,e.edges[0].p1Decoration,e.edges.at(-1).p2Decoration,(o=t[0])==null?void 0:o.style)}buildArc(e,t){var i;const n={x:ot(e.cx),y:ot(e.cy)},s=ot(e.rx),o=ot(e.ry);return new ng(n,e.startAngle,e.sweepAngle,s,o,e.phi,e.startDecoration,e.endDecoration,(i=t[0])==null?void 0:i.style)}convertEdge(e,t){switch(e.kind){case da.Line:{const n=t.filter(o=>{var i;return(i=e.items)==null?void 0:i.some(a=>a["full-id"]===o.id)});if(!n.length)return;const s=n.filter((o,i)=>n.findIndex(a=>o.id===a.id)===i);return{symbol:this.buildLine(e,s),strokes:s}}case da.Arc:{const n=t.filter(o=>{var i;return(i=e.items)==null?void 0:i.some(a=>a["full-id"]===o.id)});if(!n.length)return;const s=n.filter((o,i)=>n.findIndex(a=>o.id===a.id)===i);return{symbol:this.buildArc(e,s),strokes:s}}case da.PolyEdge:{const n=t.filter(o=>{var i;return(i=e.edges.flatMap(a=>a.items))==null?void 0:i.some(a=>a["full-id"]===o.id)});if(!n.length)return;const s=n.filter((o,i)=>n.findIndex(a=>o.id===a.id)===i);return{symbol:this.buildPolyEdge(e,s),strokes:s}}default:return void j(this,Hc).error("convertEdge",`Conversion of Edge with kind equal to ${JSON.stringify(e)} is unknow`)}}async apply(e=[]){var n,s,o,i;j(this,Hc).info("convert"),(n=this.model.exports)!=null&&n["application/vnd.myscript.jiix"]||await this.editor.export(["application/vnd.myscript.jiix"]),this.editor.selector.removeSelectedGroup();const t=(s=this.model.exports)==null?void 0:s["application/vnd.myscript.jiix"];if((o=t==null?void 0:t.elements)!=null&&o.length){const a=this.editor.extractStrokesFromSymbols(e.length?e:this.model.symbols),l=!((i=t.elements)!=null&&i.some(u=>u.type!=="Text")),c=[];t.elements.forEach(u=>{switch(u.type){case"Text":{const p=this.convertText(u,a,l);p&&c.push(...p);break}case"Node":{const p=this.convertNode(u,a);p&&c.push(p);break}case"Edge":{const p=this.convertEdge(u,a);p&&c.push(p);break}default:j(this,Hc).warn("buildConversions",`Unknow jiix element type: ${u.type}`)}}),this.editor.addSymbols(c.map(u=>u.symbol),!1),this.editor.removeSymbols(c.flatMap(u=>u.strokes.map(p=>p.id)),!1),this.editor.history.push(this.model,{added:c.map(u=>u.symbol),erased:c.flatMap(u=>u.strokes)})}}}Hc=new WeakMap;var Pi;class Wfe{constructor(e){De(this,Pi,Rt.getLogger(lt.TRANSFORMER));k(this,"editor");k(this,"interactElementsGroup");k(this,"direction");k(this,"boundingBox");k(this,"transformOrigin");k(this,"keepRatio",!1);j(this,Pi).info("constructor"),this.editor=e}get model(){return this.editor.model}applyToStroke(e,t,n,s){return j(this,Pi).debug("applyToStroke",{stroke:e,origin:t,scaleX:n,scaleY:s}),e.pointers.forEach(o=>{o.x=+(t.x+n*(o.x-t.x)).toFixed(3),o.y=+(t.y+s*(o.y-t.y)).toFixed(3)}),e}applyToShape(e,t,n,s){switch(j(this,Pi).debug("applyToShape",{shape:e,origin:t,scaleX:n,scaleY:s}),e.kind){case mr.Ellipse:{const o=Math.cos(e.orientation),i=Math.sin(e.orientation);return e.center.x=+(e.center.x+((n-1)*o+(s-1)*i)*(e.center.x-t.x)).toFixed(3),e.center.y=+(e.center.y+((n-1)*-i+(s-1)*o)*(e.center.y-t.y)).toFixed(3),e.radiusX=+Math.abs(e.radiusX*(n*o-s*i)).toFixed(3),e.radiusY=+Math.abs(e.radiusY*(n*i+s*o)).toFixed(3),e}case mr.Circle:return e.radius=+(e.radius*(n+s)/2).toFixed(3),e.center.x=+(t.x+n*(e.center.x-t.x)).toFixed(3),e.center.y=+(t.y+s*(e.center.y-t.y)).toFixed(3),e;case mr.Polygon:return e.points.forEach(o=>{o.x=+(t.x+n*(o.x-t.x)).toFixed(3),o.y=+(t.y+s*(o.y-t.y)).toFixed(3)}),e;default:throw new Error(`Can't apply resize on shape, kind unknow: ${JSON.stringify(e)}`)}}applyToEdge(e,t,n,s){switch(j(this,Pi).debug("applyToEdge",{edge:e,origin:t,scaleX:n,scaleY:s}),e.kind){case jr.Arc:{const o=Math.cos(e.phi),i=Math.sin(e.phi);return e.center.x=+(e.center.x+((n-1)*o+(s-1)*i)*(e.center.x-t.x)).toFixed(3),e.center.y=+(e.center.y+((n-1)*-i+(s-1)*o)*(e.center.y-t.y)).toFixed(3),e.radiusX=+(e.radiusX*Math.abs(n*o+s*i)).toFixed(3),e.radiusY=+(e.radiusY*Math.abs(n*i+s*o)).toFixed(3),n<0?(e.startAngle=+(Math.PI-e.startAngle).toFixed(3),e.sweepAngle*=-1):s<0&&(e.sweepAngle*=-1),e}case jr.Line:return e.start.x=+(t.x+n*(e.start.x-t.x)).toFixed(3),e.start.y=+(t.y+s*(e.start.y-t.y)).toFixed(3),e.end.x=+(t.x+n*(e.end.x-t.x)).toFixed(3),e.end.y=+(t.y+s*(e.end.y-t.y)).toFixed(3),e;case jr.PolyEdge:return e.points.forEach(o=>(o.x=+(t.x+n*(o.x-t.x)).toFixed(3),o.y=+(t.y+s*(o.y-t.y)).toFixed(3),o)),e;default:throw new Error(`Can't apply resize on edge, kind unknow: ${JSON.stringify(e)}`)}}applyOnText(e,t,n,s){return e.point.x=+(t.x+n*(e.point.x-t.x)).toFixed(3),e.point.y=+(t.y+s*(e.point.y-t.y)).toFixed(3),e.chars.forEach(o=>{o.fontSize=+(o.fontSize*(n+s)/2).toFixed(3)}),this.editor.texter.updateBounds(e)}applyOnGroup(e,t,n,s){return e.children.forEach(o=>this.applyToSymbol(o,t,n,s)),e}applyOnRecognizedSymbol(e,t,n,s){return e.strokes.forEach(o=>this.applyToStroke(o,t,n,s)),e.kind===jn.Text&&(e.xHeight*=s),e}applyToSymbol(e,t,n,s){switch(j(this,Pi).info("applyToSymbol",{symbol:e,scaleX:n,scaleY:s}),e.type){case oe.Stroke:return this.applyToStroke(e,t,n,s);case oe.Shape:return this.applyToShape(e,t,n,s);case oe.Edge:return this.applyToEdge(e,t,n,s);case oe.Text:return this.applyOnText(e,t,n,s);case oe.Group:return this.applyOnGroup(e,t,n,s);case oe.Recognized:return this.applyOnRecognizedSymbol(e,t,n,s);default:throw new Error(`Can't apply resize on symbol, type unknow: ${JSON.stringify(e)}`)}}setTransformOrigin(e,t,n){this.editor.renderer.setAttribute(e,"transform-origin",`${t}px ${n}px`)}scaleElement(e,t,n){j(this,Pi).info("scaleElement",{id:e,sx:t,sy:n}),this.editor.renderer.setAttribute(e,"transform",`scale(${t},${n})`)}start(e,t){j(this,Pi).info("start",{target:e}),this.interactElementsGroup=e.closest(`[role=${kr.InteractElementsGroup}]`),this.direction=e.getAttribute("resize-direction"),this.keepRatio=this.model.symbolsSelected.some(n=>n.type===oe.Text||n.type===oe.Shape&&n.kind===mr.Circle),this.transformOrigin=t,this.boundingBox=at.createFromPoints(this.model.symbolsSelected.flatMap(n=>n.vertices)),this.setTransformOrigin(this.interactElementsGroup.id,this.transformOrigin.x,this.transformOrigin.y),this.model.symbolsSelected.forEach(n=>{this.setTransformOrigin(n.id,this.transformOrigin.x,this.transformOrigin.y)})}continue(e){if(j(this,Pi).info("continue",{point:e}),!this.interactElementsGroup)throw new Error("Can't resize, you must call start before");const t=e,n=["e-resize","ne-resize","se-resize","w-resize","nw-resize","sw-resize"].includes(this.direction),s=["n-resize","ne-resize","nw-resize","s-resize","se-resize","sw-resize"].includes(this.direction),{x:o,y:i}=this.editor.snaps.snapResize(e,n,s);t.x=o,t.y=i;let a=0,l=0;["e-resize","ne-resize","se-resize"].includes(this.direction)?a=t.x-this.boundingBox.xMax:["w-resize","nw-resize","sw-resize"].includes(this.direction)&&(a=this.boundingBox.xMin-t.x),["n-resize","ne-resize","nw-resize"].includes(this.direction)?l=this.boundingBox.yMin-t.y:["s-resize","se-resize","sw-resize"].includes(this.direction)&&(l=t.y-this.boundingBox.yMax);let c=this.boundingBox.width?1+a/this.boundingBox.width:1,u=this.boundingBox.height?1+l/this.boundingBox.height:1;return this.keepRatio&&(["n-resize","s-resize"].includes(this.direction)?c=u:(["e-resize","w-resize"].includes(this.direction)||(c=Math.max(c,u)),u=c)),this.scaleElement(this.interactElementsGroup.id,c,u),this.model.symbolsSelected.forEach(p=>{this.scaleElement(p.id,c,u)}),{scaleX:c,scaleY:u}}async end(e){j(this,Pi).info("end",{point:e});const{scaleX:t,scaleY:n}=this.continue(e);this.editor.snaps.clearSnapToElementLines();const s=this.model.symbolsSelected.map(i=>i.clone());this.model.symbolsSelected.forEach(i=>{this.applyToSymbol(i,this.transformOrigin,t,n),this.editor.renderer.drawSymbol(i),this.model.updateSymbol(i)});const o=this.editor.extractStrokesFromSymbols(this.model.symbolsSelected);this.editor.recognizer.transformScale(o.map(i=>i.id),t,n,this.transformOrigin.x,this.transformOrigin.y),this.editor.history.push(this.model,{scale:[{symbols:s,origin:{...this.transformOrigin},scaleX:t,scaleY:n}]}),this.interactElementsGroup=void 0,this.editor.svgDebugger.apply()}}Pi=new WeakMap;var Gc;class Kfe{constructor(e){De(this,Gc,Rt.getLogger(lt.TRANSFORMER));k(this,"editor");k(this,"interactElementsGroup");k(this,"center");k(this,"origin");j(this,Gc).info("constructor"),this.editor=e}get model(){return this.editor.model}applyToStroke(e,t,n){return e.pointers.forEach(s=>{const{x:o,y:i}=Ai(s,t,n);s.x=o,s.y=i}),e}applyToShape(e,t,n){switch(e.kind){case mr.Ellipse:return e.center=Ai(e.center,t,n),e.orientation=(e.orientation+n)%(2*Math.PI),e;case mr.Circle:return e.center=Ai(e.center,t,n),e;case mr.Polygon:return e.points.forEach(s=>{const{x:o,y:i}=Ai(s,t,n);s.x=o,s.y=i}),e;default:throw new Error(`Can't apply rotate on shape, kind unknow: ${JSON.stringify(e)}`)}}applyToEdge(e,t,n){switch(e.kind){case jr.Arc:return e.phi=(e.phi-n)%(2*Math.PI),e.center=Ai(e.center,t,n),e;case jr.Line:return e.start=Ai(e.start,t,n),e.end=Ai(e.end,t,n),e;case jr.PolyEdge:return e.points=e.points.map(s=>Ai(s,t,n)),e;default:throw new Error(`Can't apply rotate on edge, kind unknow: ${JSON.stringify(e)}`)}}applyOnText(e,t,n){var s;return e.rotation={degree:Ik(n)+(((s=e.rotation)==null?void 0:s.degree)||0),center:t},this.editor.texter.updateBounds(e)}applyOnGroup(e,t,n){return e.children.forEach(s=>this.applyToSymbol(s,t,n)),e}applyOnRecognizedSymbol(e,t,n){return e.strokes.forEach(s=>this.applyToStroke(s,t,n)),e}applyToSymbol(e,t,n){switch(e.type){case oe.Stroke:return this.applyToStroke(e,t,n);case oe.Shape:return this.applyToShape(e,t,n);case oe.Edge:return this.applyToEdge(e,t,n);case oe.Text:return this.applyOnText(e,t,n);case oe.Group:return this.applyOnGroup(e,t,n);case oe.Recognized:return this.applyOnRecognizedSymbol(e,t,n);default:throw new Error(`Can't apply rotate on symbol, type unknow: ${JSON.stringify(e)}`)}}setTransformOrigin(e,t,n){this.editor.renderer.setAttribute(e,"transform-origin",`${t}px ${n}px`)}rotateElement(e,t){j(this,Gc).info("rotateElement",{id:e,degree:t}),this.editor.renderer.setAttribute(e,"transform",`rotate(${t})`)}start(e,t){j(this,Gc).info("start",{target:e}),this.interactElementsGroup=e.closest(`[role=${kr.InteractElementsGroup}]`);const n=at.createFromPoints(this.model.symbolsSelected.flatMap(s=>s.vertices));this.center={x:n.xMin+n.width/2,y:n.yMid},this.origin=t,this.setTransformOrigin(this.interactElementsGroup.id,this.center.x,this.center.y),this.model.symbolsSelected.forEach(s=>{this.setTransformOrigin(s.id,this.center.x,this.center.y)})}continue(e){if(j(this,Gc).info("continue",{point:e}),!this.interactElementsGroup)throw new Error("Can't rotate, you must call start before");let t=Math.round(Ik(tfe(this.origin,this.center,e)));return t=this.editor.snaps.snapRotation(t),e.x-this.center.x<0&&(t=360-t),this.rotateElement(this.interactElementsGroup.id,t),this.model.symbolsSelected.forEach(n=>{this.rotateElement(n.id,t)}),t}async end(e){j(this,Gc).info("end",{point:e});const t=Iv(this.continue(e))%(2*Math.PI),n=this.model.symbolsSelected.map(o=>o.clone());this.model.symbolsSelected.forEach(o=>{this.applyToSymbol(o,this.center,t),this.editor.renderer.drawSymbol(o),this.model.updateSymbol(o)});const s=this.editor.extractStrokesFromSymbols(this.model.symbolsSelected);this.editor.recognizer.transformRotate(s.map(o=>o.id),t,this.center.x,this.center.y),this.editor.history.push(this.model,{rotate:[{symbols:n,angle:t,center:{...this.center}}]}),this.interactElementsGroup=void 0,this.editor.svgDebugger.apply()}}Gc=new WeakMap;var Wc,dg;class Vfe{constructor(e){De(this,Wc,Rt.getLogger(lt.SELECTION));k(this,"grabber");k(this,"editor");De(this,dg,"selecting-rect");k(this,"startSelectionPoint");k(this,"endSelectionPoint");k(this,"selectedGroup");j(this,Wc).info("constructor"),this.editor=e,this.grabber=new mp(e.configuration.grabber),this.grabber.onPointerDown=this.start.bind(this),this.grabber.onPointerMove=this.continue.bind(this),this.grabber.onPointerUp=this.end.bind(this),this.grabber.onContextMenu=this.onContextMenu.bind(this)}get model(){return this.editor.model}get renderer(){return this.editor.renderer}get rotator(){return this.editor.rotator}get translator(){return this.editor.translator}get resizer(){return this.editor.resizer}get selectionBox(){if(this.startSelectionPoint&&this.endSelectionPoint)return at.createFromPoints([this.startSelectionPoint,this.endSelectionPoint])}attach(e){this.removeSelectedGroup(),this.grabber.attach(e)}detach(){this.removeSelectedGroup(),this.grabber.detach()}drawSelectingRect(e){this.clearSelectingRect();const t={id:j(this,dg),fill:"transparent",stroke:"grey",opacity:"0.25"};this.renderer.appendElement(He.createRect(e,t))}clearSelectingRect(){this.renderer.clearElements({attrs:{id:j(this,dg)}})}getPoint(e){const{clientLeft:t,scrollLeft:n,clientTop:s,scrollTop:o}=this.renderer.parent,i=this.renderer.parent.getBoundingClientRect();return{x:e.clientX-i.left-t+n,y:e.clientY-i.top-s+o}}createTranslateRect(e){const t={role:kr.Translate,style:"cursor:move",fill:"transparent",stroke:"transparent"},n={height:e.height,width:e.width,x:e.x,y:e.y},s=He.createRect(n,t),o=a=>{a.preventDefault(),a.stopPropagation(),this.translator.continue(this.getPoint(a))},i=a=>{a.preventDefault(),a.stopPropagation(),this.translator.end(this.getPoint(a)),this.renderer.layer.removeEventListener("pointermove",o),this.renderer.layer.removeEventListener("pointercancel",i),this.renderer.layer.removeEventListener("pointerleave",i),this.renderer.layer.removeEventListener("pointerup",i),this.renderer.layer.style.cursor="",this.resetSelectedGroup(this.model.symbolsSelected)};return s.addEventListener("pointerdown",a=>{a.button===0&&a.buttons===1&&(a.preventDefault(),a.stopPropagation(),this.hideInteractElements(),this.translator.start(a.target,this.getPoint(a)),this.renderer.layer.addEventListener("pointermove",o),this.renderer.layer.addEventListener("pointercancel",i),this.renderer.layer.addEventListener("pointerleave",i),this.renderer.layer.addEventListener("pointerup",i),this.renderer.layer.style.cursor="move")}),s}createRotateGroup(e){const t=He.createGroup({role:kr.Rotate,"vector-effect":"non-scaling-size",style:"cursor:pointer;",opacity:"1"}),n={x:e.x+e.width/2,y:e.y-40},s={role:kr.Rotate,"stroke-width":"2",stroke:"black",fill:"white"};t.appendChild(He.createCircle(n,8,s));const o={role:kr.Rotate,fill:"black"};t.appendChild(He.createCircle(n,4,o));const i={role:kr.Rotate,stroke:"black","stroke-width":"2"};t.appendChild(He.createLine({x:n.x,y:n.y+8},{x:n.x,y:e.y-zs},i));const a=c=>{c.preventDefault(),c.stopPropagation(),this.rotator.continue(this.getPoint(c))},l=c=>{c.preventDefault(),c.stopPropagation(),this.rotator.end(this.getPoint(c)),this.renderer.layer.removeEventListener("pointermove",a),this.renderer.layer.removeEventListener("pointercancel",l),this.renderer.layer.removeEventListener("pointerleave",l),this.renderer.layer.removeEventListener("pointerup",l),this.resetSelectedGroup(this.model.symbolsSelected)};return t.addEventListener("pointerdown",c=>{c.button===0&&c.buttons===1&&(c.preventDefault(),c.stopPropagation(),this.hideInteractElements(),this.rotator.start(c.target,this.getPoint(c)),this.renderer.layer.addEventListener("pointermove",a),this.renderer.layer.addEventListener("pointercancel",l),this.renderer.layer.addEventListener("pointerleave",l),this.renderer.layer.addEventListener("pointerup",l))}),t}createResizeGroup(e){const t=He.createGroup({role:kr.Resize,"vector-effect":"non-scaling-size","stroke-width":"4",stroke:"#3e68ff"}),n={x:e.x-zs,y:e.y-zs},s={x:e.x+e.width+zs,y:e.y-zs},o={x:e.x+e.width+zs,y:e.y+e.height+zs},i={x:e.x-zs,y:e.y+e.height+zs},a=(l,c,u)=>{const p=m=>{m.preventDefault(),m.stopPropagation(),this.resizer.continue(this.getPoint(m))},f=m=>{m.preventDefault(),m.stopPropagation(),this.resizer.end(this.getPoint(m)),this.renderer.layer.removeEventListener("pointermove",p),this.renderer.layer.removeEventListener("pointercancel",f),this.renderer.layer.removeEventListener("pointerleave",f),this.renderer.layer.removeEventListener("pointerup",f),this.renderer.layer.style.cursor="",this.resetSelectedGroup(this.model.symbolsSelected)};l.addEventListener("pointerdown",m=>{m.button===0&&m.buttons===1&&(m.preventDefault(),m.stopPropagation(),this.hideInteractElements(),this.renderer.layer.style.cursor=u,this.resizer.start(m.target,c),this.renderer.layer.addEventListener("pointermove",p),this.renderer.layer.addEventListener("pointercancel",f),this.renderer.layer.addEventListener("pointerleave",f),this.renderer.layer.addEventListener("pointerup",f))})};return[{direction:"n-resize",p1:n,p2:s,transformOrigin:{x:e.x+e.width/2,y:e.y+e.height}},{direction:"e-resize",p1:s,p2:o,transformOrigin:{x:e.x,y:e.y+e.height/2}},{direction:"s-resize",p1:i,p2:o,transformOrigin:{x:e.x+e.width/2,y:e.y}},{direction:"w-resize",p1:n,p2:i,transformOrigin:{x:e.x+e.width,y:e.y+e.height/2}}].forEach(l=>{const c={role:kr.Resize,"resize-direction":l.direction,"transform-origin":JSON.stringify(l.transformOrigin),style:`cursor:${l.direction};`},u=He.createLine(l.p1,l.p2,c);a(u,l.transformOrigin,l.direction),t.appendChild(u)}),[{direction:"nw-resize",p:n,transformOrigin:{x:e.x+e.width,y:e.y+e.height}},{direction:"ne-resize",p:s,transformOrigin:{x:e.x,y:e.y+e.height}},{direction:"se-resize",p:o,transformOrigin:{x:e.x,y:e.y}},{direction:"sw-resize",p:i,transformOrigin:{x:e.x+e.width,y:e.y}}].forEach(l=>{const c={"stroke-width":"4",role:kr.Resize,"resize-direction":l.direction,"transform-origin":JSON.stringify(l.transformOrigin),transform:"scale(1, 1)",fill:"white",style:`cursor:${l.direction};`},u=He.createCircle(l.p,5,c);a(u,l.transformOrigin,l.direction),t.appendChild(u)}),t}createInteractElementsGroup(e){if(j(this,Wc).info("createInteractElementsGroup",{symbols:e}),!e.length)return;const t=e.map(c=>({symbol:c,element:this.renderer.getElementById(c.id)})),n=at.createFromBoxes(e.map(c=>({x:c.bounds.x-(c.style.width||1),y:c.bounds.y-(c.style.width||1),height:c.bounds.height+2*(c.style.width||1),width:c.bounds.width+2*(c.style.width||1)}))),s=at.createFromPoints(e.flatMap(c=>c.vertices)),o=at.createFromBoxes([n,s]),i={id:`selected-${Date.now()}`,role:kr.InteractElementsGroup},a=He.createGroup(i);a.appendChild(this.createTranslateRect(o)),a.appendChild(this.createResizeGroup(o)),a.appendChild(this.createRotateGroup(o));const l={style:"pointer-events: none",fill:"transparent",stroke:"#3e68ff","stroke-width":"1","stroke-dasharray":"4","vector-effect":"non-scaling-size",transform:"rotate(0, 0, 0)"};return t.forEach(c=>{var u,p,f;if(c.element){const m={x:c.symbol.bounds.x-(c.symbol.style.width||1),y:c.symbol.bounds.y-(c.symbol.style.width||1),height:c.symbol.bounds.height+2*(c.symbol.style.width||1),width:c.symbol.bounds.width+2*(c.symbol.style.width||1)};if(c.symbol.type===oe.Text){const v=c.symbol;l.transform=`rotate(${((u=v.rotation)==null?void 0:u.degree)||0}, ${((p=v.rotation)==null?void 0:p.center.x)||0}, ${((f=v.rotation)==null?void 0:f.center.y)||0})`}else l.transform="rotate(0, 0, 0)";a.prepend(He.createRect(m,l))}}),a}createEdgeResizeGroup(e){const t=He.createGroup({role:kr.Resize,"vector-effect":"non-scaling-size","stroke-width":"4",stroke:"#3e68ff"}),n={role:kr.Resize,"stroke-width":"4",stroke:"#3e68ff",fill:"white",style:"cursor:grab;"},s=(o,i)=>{const a=c=>{c.preventDefault(),c.stopPropagation();const u=this.getPoint(c),{x:p,y:f}=this.editor.snaps.snapResize(u);e.vertices[i].x=p,e.vertices[i].y=f,this.model.updateSymbol(e),this.renderer.drawSymbol(e)},l=c=>{c.preventDefault(),c.stopPropagation();const u=this.getPoint(c),{x:p,y:f}=this.editor.snaps.snapResize(u);e.vertices[i].x=p,e.vertices[i].y=f,this.renderer.layer.style.cursor="",this.editor.updateSymbol(e),this.renderer.layer.removeEventListener("pointermove",a),this.renderer.layer.removeEventListener("pointercancel",l),this.renderer.layer.removeEventListener("pointerleave",l),this.renderer.layer.removeEventListener("pointerup",l),this.editor.snaps.clearSnapToElementLines(),this.resetSelectedGroup(this.model.symbolsSelected)};o.addEventListener("pointerdown",c=>{c.button===0&&c.buttons===1&&(this.renderer.layer.style.cursor="grabbing",this.hideInteractElements(),c.preventDefault(),c.stopPropagation(),this.renderer.layer.addEventListener("pointermove",a),this.renderer.layer.addEventListener("pointercancel",l),this.renderer.layer.addEventListener("pointerleave",l),this.renderer.layer.addEventListener("pointerup",l))})};return e.vertices.forEach((o,i)=>{const a=He.createCircle(o,5,n);s(a,i),t.appendChild(a)}),t}createInteractEdgeGroup(e){j(this,Wc).info("createInteractEdgeGroup",{edge:e});const t={id:`selected-${Date.now()}`,role:kr.InteractElementsGroup},n=He.createGroup(t);return n.appendChild(this.createTranslateRect(e.bounds)),n.appendChild(this.createEdgeResizeGroup(e.clone())),n}drawSelectedGroup(e){if(e.length){if(e.length===1&&e[0].type===oe.Edge?this.selectedGroup=this.createInteractEdgeGroup(e[0]):this.selectedGroup=this.createInteractElementsGroup(e),this.selectedGroup){this.renderer.layer.appendChild(this.selectedGroup);const t=this.selectedGroup.getBBox();this.editor.menu.context.position.x=t.x+t.width/2-this.renderer.parent.clientLeft,this.editor.menu.context.position.y=t.y+t.height-this.renderer.parent.clientTop,this.editor.menu.context.show()}this.editor.menu.update()}}resetSelectedGroup(e){j(this,Wc).info("resetSelectedGroup",{symbols:e}),this.removeSelectedGroup(),this.drawSelectedGroup(e)}removeSelectedGroup(){var e;j(this,Wc).info("removeSelectedGroup"),this.editor.menu.context.hide(),(e=this.selectedGroup)==null||e.remove(),this.selectedGroup=void 0}hideInteractElements(){var t;this.editor.menu.context.hide();const e=`[role=${kr.Resize}],[role=${kr.Rotate}],[role=${kr.Translate}]`;(t=this.selectedGroup)==null||t.querySelectorAll(e).forEach(n=>{n.setAttribute("visibility","hidden")})}start(e){this.removeSelectedGroup(),this.startSelectionPoint=e.pointer,this.endSelectionPoint=e.pointer,this.drawSelectingRect(this.selectionBox)}continue(e){if(!this.startSelectionPoint)throw new Error("You need to call startSelectionByBox before");this.endSelectionPoint=e.pointer;const t=[];return this.model.symbols.forEach(n=>{n.selected!==n.overlaps(this.selectionBox)&&(n.selected=n.overlaps(this.selectionBox),t.push(n),this.renderer.drawSymbol(n))}),this.drawSelectingRect(this.selectionBox),t}end(e){const t=this.continue(e);return this.startSelectionPoint=void 0,this.endSelectionPoint=void 0,this.clearSelectingRect(),this.drawSelectedGroup(this.model.symbolsSelected),this.editor.event.emitSelected(this.model.symbolsSelected),this.editor.menu.style.update(),t}async onContextMenu(e){let t=!1,n=e.target;const s=[oe.Edge.toString(),oe.Shape.toString(),oe.Stroke.toString(),oe.Text.toString()];for(;n&&n.tagName!=="svg"&&!t;)s.includes(n.getAttribute("type"))?t=!0:n=n.parentElement;this.editor.unselectAll(),n!=null&&n.id?(this.model.selectSymbol(n.id),this.renderer.drawSymbol(this.model.symbolsSelected[0]),this.drawSelectedGroup(this.model.symbolsSelected),this.editor.updateLayerUI()):(this.editor.menu.context.position.x=e.pointer.x+this.renderer.parent.clientLeft,this.editor.menu.context.position.y=e.pointer.y+this.renderer.parent.clientTop,this.editor.menu.context.show())}}Wc=new WeakMap,dg=new WeakMap;var j0;class qfe{constructor(e){De(this,j0,Rt.getLogger(lt.CONVERTER));k(this,"editor");j(this,j0).info("constructor"),this.editor=e}get renderer(){return this.editor.renderer}get rowHeight(){return this.editor.configuration.rendering.guides.gap}get model(){return this.editor.model}drawSymbolHidden(e){var s;const t=e.clone();t.id="text-to-measure",t.chars.forEach(o=>o.id+="-to-measure"),t.decorators=[],(s=this.renderer.layer.querySelector(`#${t.id}`))==null||s.remove();const n=this.renderer.buildElementFromSymbol(t);return n.setAttribute("visibility","hidden"),this.renderer.prependElement(n),n}setCharsBounds(e,t){const n=t.querySelector("text");if(n)for(let s=0;s<n.getNumberOfChars();s++){const o=e.chars.at(s);if(o){const i=n.getExtentOfChar(s);o.bounds=new at(i)}}return e}setBounds(e){const t=this.drawSymbolHidden(e);e.bounds=this.getElementBoundingBox(t),this.setCharsBounds(e,t)}getElementBoundingBox(e){return new at(e.querySelector("text").getBBox({stroke:!0,markers:!0,clipped:!0,fill:!0}))}getBoundingBox(e){const t=this.drawSymbolHidden(e);return this.getElementBoundingBox(t)}getSpaceWidth(e){var s;const t=new at({height:0,width:0,x:0,y:0}),n={id:"text-char-space",label:"-",color:"",fontSize:e,fontWeight:"normal",bounds:t};return(s=this.getBoundingBox(new ol([n],{x:0,y:0},t)))==null?void 0:s.width}updateBounds(e){return this.setBounds(e),this.model.updateSymbol(e),e}moveTextAfter(e,t){const n=this.model.getSymbolsByRowOrdered().find(s=>s.rowIndex===this.model.getSymbolRowIndex(e));if(n){const s=n.symbols.filter(o=>o.type===oe.Text&&o.bounds.xMid>e.bounds.xMid);return s.forEach(o=>{o.point.x+=t,this.updateBounds(o),this.model.updateSymbol(o),this.renderer.drawSymbol(o)}),s}}}j0=new WeakMap;var Ua;class Yfe{constructor(e){De(this,Ua,Rt.getLogger(lt.TRANSFORMER));k(this,"editor");k(this,"interactElementsGroup");k(this,"transformOrigin");j(this,Ua).info("constructor"),this.editor=e}get model(){return this.editor.model}applyToStroke(e,t,n){return e.pointers.forEach(s=>{s.x+=t,s.y+=n}),e}applyToShape(e,t,n){switch(e.kind){case mr.Ellipse:case mr.Circle:return e.center.x+=t,e.center.y+=n,e;case mr.Polygon:return e.points.forEach(s=>{s.x+=t,s.y+=n}),e;default:throw new Error(`Can't apply translate on shape, kind unknow: ${JSON.stringify(e)}`)}}applyToEdge(e,t,n){switch(e.kind){case jr.Arc:return e.center.x+=t,e.center.y+=n,e;case jr.Line:return e.start.x+=t,e.start.y+=n,e.end.x+=t,e.end.y+=n,e;case jr.PolyEdge:return e.points.forEach(s=>{s.x+=t,s.y+=n}),e}return e}applyOnText(e,t,n){return e.rotation&&(e.rotation.center={x:e.rotation.center.x+t,y:e.rotation.center.y+n}),e.point.x+=t,e.point.y+=n,this.editor.texter.updateBounds(e)}applyOnGroup(e,t,n){return e.children.forEach(s=>this.applyToSymbol(s,t,n)),e}applyOnRecognizedSymbol(e,t,n){return e.strokes.forEach(s=>this.applyToStroke(s,t,n)),e.kind===jn.Text&&(e.baseline+=n),e}applyToSymbol(e,t,n){switch(j(this,Ua).info("applyToSymbol",{symbol:e,tx:t,ty:n}),e.type){case oe.Stroke:return this.applyToStroke(e,t,n);case oe.Shape:return this.applyToShape(e,t,n);case oe.Edge:return this.applyToEdge(e,t,n);case oe.Text:return this.applyOnText(e,t,n);case oe.Group:return this.applyOnGroup(e,t,n);case oe.Recognized:return this.applyOnRecognizedSymbol(e,t,n);default:throw new Error(`Can't apply translate on symbol, type unknow: ${JSON.stringify(e)}`)}}translate(e,t,n,s=!0){j(this,Ua).info("translate",{symbols:e,tx:t,ty:n}),e.forEach(i=>{this.applyToSymbol(i,t,n),this.model.updateSymbol(i),this.editor.renderer.drawSymbol(i)}),s&&this.editor.history.push(this.model,{translate:[{symbols:this.model.symbolsSelected,tx:t,ty:n}]});const o=this.editor.extractStrokesFromSymbols(e);return this.editor.recognizer.transformTranslate(o.map(i=>i.id),t,n)}translateElement(e,t,n){j(this,Ua).info("translateElement",{id:e,tx:t,ty:n}),this.editor.renderer.setAttribute(e,"transform",`translate(${t},${n})`)}start(e,t){j(this,Ua).info("start",{origin:t}),this.interactElementsGroup=e.closest(`[role=${kr.InteractElementsGroup}]`),this.transformOrigin=t}continue(e){if(j(this,Ua).info("continue",{point:e}),!this.interactElementsGroup)throw new Error("Can't translate, you must call start before");let t=e.x-this.transformOrigin.x,n=e.y-this.transformOrigin.y;const s=this.editor.snaps.snapTranslate(t,n);return t=s.x,n=s.y,this.translateElement(this.interactElementsGroup.id,t,n),this.model.symbolsSelected.forEach(o=>{this.translateElement(o.id,t,n)}),{tx:t,ty:n}}async end(e){j(this,Ua).info("end",{point:e});const{tx:t,ty:n}=this.continue(e);this.editor.snaps.clearSnapToElementLines(),this.translate(this.model.symbolsSelected,t,n),this.interactElementsGroup=void 0,this.editor.svgDebugger.apply()}}Ua=new WeakMap;var ug;class Xfe extends N7{constructor(t){super(t);De(this,ug,bt.Pencil);k(this,"detectGesture",!0);k(this,"editor");k(this,"currentSymbolOrigin");this.editor=t}get tool(){return j(this,ug)}set tool(t){Je(this,ug,t),t!==bt.Pencil?this.editor.layers.root.classList.add("shape"):this.editor.layers.root.classList.remove("shape"),this.editor.unselectAll()}get model(){return this.editor.model}get renderer(){return this.editor.renderer}get history(){return this.editor.history}get gestureManager(){return this.editor.gesture}get snaps(){return this.editor.snaps}get recognizer(){return this.editor.recognizer}attach(t){this.grabber.attach(t),this.grabber.onPointerDown=this.start.bind(this),this.grabber.onPointerMove=this.continue.bind(this),this.grabber.onPointerUp=this.end.bind(this)}detach(){this.grabber.detach()}needContextLessGesture(t){const n=this.editor.getSymbolsBounds([t],20);return this.detectGesture&&this.model.symbols.some(s=>{switch(s.type){case oe.Recognized:case oe.Stroke:return!1;case oe.Group:return!s.containsOnlyStroke()&&s.bounds.overlaps(n);default:return s.bounds.overlaps(n)}})}createCurrentSymbol(t,n,s){switch(this.tool){case bt.Pencil:this.model.currentSymbol=new Jn(n,s);break;case bt.Rectangle:this.model.currentSymbol=Ir.createRectangleBetweenPoints(t,t,n);break;case bt.Triangle:this.model.currentSymbol=Ir.createTriangleBetweenPoints(t,t,n);break;case bt.Parallelogram:this.model.currentSymbol=Ir.createParallelogramBetweenPoints(t,t,n);break;case bt.Rhombus:this.model.currentSymbol=Ir.createRhombusBetweenPoints(t,t,n);break;case bt.Circle:this.model.currentSymbol=ed.createBetweenPoints(t,t,n);break;case bt.Ellipse:this.model.currentSymbol=td.createBetweenPoints(t,t,n);break;case bt.Line:case bt.Arrow:case bt.DoubleArrow:{let o,i;this.tool===bt.Arrow?i=iu.Arrow:this.tool===bt.DoubleArrow&&(o=iu.Arrow,i=iu.Arrow),this.model.currentSymbol=new Jh(t,t,o,i,n);break}default:throw new Error(`Can't create symbol, tool is unknow: "${this.tool}"`)}return this.updateCurrentSymbol(t)}updateCurrentSymbolShape(t){switch(this.tool){case bt.Rectangle:Ir.updateRectangleBetweenPoints(this.model.currentSymbol,this.currentSymbolOrigin,t);break;case bt.Triangle:Ir.updateTriangleBetweenPoints(this.model.currentSymbol,this.currentSymbolOrigin,t);break;case bt.Parallelogram:Ir.updateParallelogramBetweenPoints(this.model.currentSymbol,this.currentSymbolOrigin,t);break;case bt.Rhombus:Ir.updateRhombusBetweenPoints(this.model.currentSymbol,this.currentSymbolOrigin,t);break;case bt.Circle:ed.updateBetweenPoints(this.model.currentSymbol,this.currentSymbolOrigin,t);break;case bt.Ellipse:td.updateBetweenPoints(this.model.currentSymbol,this.currentSymbolOrigin,t)}}updateCurrentSymbolEdge(t){const n=this.model.currentSymbol;n.kind===jr.Line&&(n.end=t)}updateCurrentSymbol(t){if(!this.model.currentSymbol)throw new Error("Can't update current symbol because currentSymbol is undefined");switch(this.model.currentSymbol.type){case oe.Stroke:this.model.currentSymbol.addPointer(t);break;case oe.Shape:this.updateCurrentSymbolShape(t);break;case oe.Edge:this.updateCurrentSymbolEdge(t)}return this.model.currentSymbol}start(t){const n=t.pointer;if(this.tool!==bt.Pencil){const{x:s,y:o}=this.snaps.snapResize(n);n.x=s,n.y=o}this.currentSymbolOrigin=n,this.createCurrentSymbol(n,this.editor.penStyle,t.pointerType),this.renderer.drawSymbol(this.model.currentSymbol)}continue(t){const n=t.pointer;if(this.tool!==bt.Pencil){const{x:s,y:o}=this.snaps.snapResize(n);n.x=s,n.y=o}this.updateCurrentSymbol(n),this.renderer.drawSymbol(this.model.currentSymbol)}async interactWithBackend(t){const n=t.clone();let s;if(this.needContextLessGesture(t)&&(s=await this.gestureManager.getGestureFromContextLess(n)),s)this.history.pop(),this.recognizer.addStrokes([n],this.detectGesture),await this.gestureManager.apply(n,s);else{const o=await this.recognizer.addStrokes([n],this.detectGesture);o&&(this.history.pop(),await this.gestureManager.apply(n,o))}}async end(t){const n=t.pointer;if(this.tool!==bt.Pencil){const{x:o,y:i}=this.snaps.snapResize(n);n.x=o,n.y=i}const s=this.updateCurrentSymbol(n);this.model.currentSymbol=void 0,this.currentSymbolOrigin=void 0,this.snaps.clearSnapToElementLines(),this.renderer.drawSymbol(s),this.model.addSymbol(s),this.history.push(this.model,{added:[s]}),s.type===oe.Stroke&&await this.interactWithBackend(s)}}ug=new WeakMap;var Hr,hg,pg,Lh,Nh,Fh;class Zfe{constructor(e){De(this,Hr,Rt.getLogger(lt.SVGDEBUG));De(this,hg,!1);De(this,pg,!1);De(this,Lh,!1);De(this,Nh,!1);De(this,Fh,!1);k(this,"editor");j(this,Hr).info("constructor"),this.editor=e}get model(){return this.editor.model}get renderer(){return this.editor.renderer}get snapPointsVisibility(){return j(this,hg)}set snapPointsVisibility(e){Je(this,hg,e),this.debugSnapPoints()}get verticesVisibility(){return j(this,pg)}set verticesVisibility(e){Je(this,pg,e),this.debugVertices()}get boundingBoxVisibility(){return j(this,Lh)}set boundingBoxVisibility(e){Je(this,Lh,e),j(this,Lh)?this.showBoundingBox():this.hideBoundingBox()}get recognitionBoxVisibility(){return j(this,Nh)}set recognitionBoxVisibility(e){Je(this,Nh,e),this.debugRecognitionBox()}get recognitionItemBoxVisibility(){return j(this,Fh)}set recognitionItemBoxVisibility(e){Je(this,Fh,e),this.debugRecognitionItemBox()}showSnapPoints(){j(this,Hr).info("showSnapPoints"),this.model.currentSymbol&&this.model.currentSymbol.snapPoints.forEach(e=>this.renderer.drawCircle(e,2,{fill:"blue",debug:"snap-points"})),this.model.symbols.forEach(e=>e.snapPoints.forEach(t=>this.renderer.drawCircle(t,2,{fill:"blue",debug:"snap-points"})))}hideSnapPoints(){j(this,Hr).info("hideSnapPoints"),this.renderer.clearElements({attrs:{debug:"snap-points"}})}debugSnapPoints(){this.hideSnapPoints(),this.snapPointsVisibility&&this.showSnapPoints()}showVertices(){j(this,Hr).info("showVertices"),this.model.currentSymbol&&this.model.currentSymbol.vertices.forEach(e=>this.renderer.drawCircle(e,2,{fill:"red",debug:"vertices"})),this.model.symbols.forEach(e=>e.vertices.forEach(t=>this.renderer.drawCircle(t,2,{fill:"red",debug:"vertices"})))}hideVertices(){j(this,Hr).info("hideVertices"),this.renderer.clearElements({attrs:{debug:"vertices"}})}debugVertices(){this.hideVertices(),this.verticesVisibility&&this.showVertices()}drawBoundingBox(e){const t={style:"pointer-events: none",fill:"transparent",stroke:"red","stroke-width":"1","stroke-dasharray":"5 5","vector-effect":"non-scaling-stroke",debug:"bounding-box"},n={style:"pointer-events: none",fill:"transparent",stroke:"orange","stroke-width":"1","stroke-dasharray":"0 5 0","vector-effect":"non-scaling-stroke",debug:"bounding-box"};e.forEach(s=>{const o=this.renderer.getElementById(s.id);if(o)if(s.type===oe.Text){const i=s;let a="";i.rotation&&(a=`rotate(${i.rotation.degree}, ${i.rotation.center.x}, ${i.rotation.center.y})`),i.chars.forEach(c=>{const u={...n,char:c.label,transform:a};o.insertAdjacentElement("beforebegin",He.createRect(c.bounds,u))});const l={...t,symbol:s.id,transform:a};o.insertAdjacentElement("beforebegin",He.createRect(s.bounds,l))}else{const i={...t,symbol:s.id};o.insertAdjacentElement("beforebegin",He.createRect(s.bounds,i))}})}showBoundingBox(){j(this,Hr).info("showBoundingBox"),this.model.currentSymbol&&this.drawBoundingBox([this.model.currentSymbol]),this.drawBoundingBox(this.model.symbols)}hideBoundingBox(){j(this,Hr).info("hideBoundingBox"),this.renderer.clearElements({attrs:{debug:"bounding-box"}})}debugBoundingBox(){this.hideBoundingBox(),this.boundingBoxVisibility&&this.showBoundingBox()}drawRecognitionBox(e,t){const n="green",s=He.createGroup({debug:"recognition-box"}),o=He.createRect(e,{fill:"transparent",stroke:n,style:Lt.noSelection});s.appendChild(o);const i=He.createGroup({id:`infos-group-${zo()}`}),a=e.x+e.width;let l=e.y+10;t==null||t.forEach(m=>{i.appendChild(He.createText({x:a,y:l},m,{stroke:n,style:Lt.noSelection})),l+=20}),s.appendChild(i),this.renderer.layer.appendChild(s);const c=i.getBBox(),u={width:c.width+10,height:c.height+10,x:c.x-5,y:c.y-5},p=He.createRect(u,{fill:"white",style:"cursor:move",stroke:n});i.prepend(p);const f=m=>{m.preventDefault(),m.stopPropagation();const v=Number(this.renderer.getAttribute(i.id,"originX")),b=Number(this.renderer.getAttribute(i.id,"originY")),S=m.clientX-v,C=m.clientY-b;this.renderer.setAttribute(i.id,"transform",`translate(${S},${C})`);const E={width:u.width,height:u.height,x:u.x+S,y:u.y+C};this.renderer.removeSymbol(`connection-${i.id}`),this.renderer.drawConnectionBetweenBox(`connection-${i.id}`,e,E,"corners",{stroke:n,debug:"recognition-box-link"})};p.addEventListener("pointerdown",m=>{m.preventDefault(),m.stopPropagation(),this.renderer.getAttribute(i.id,"originX")||(this.renderer.setAttribute(i.id,"originX",m.clientX.toString()),this.renderer.setAttribute(i.id,"originY",m.clientY.toString())),this.renderer.layer.addEventListener("pointermove",f),this.renderer.layer.addEventListener("pointerup",()=>this.renderer.layer.removeEventListener("pointermove",f)),this.renderer.layer.addEventListener("pointerleave",()=>this.renderer.layer.removeEventListener("pointermove",f)),this.renderer.layer.addEventListener("pointercancel",()=>this.renderer.layer.removeEventListener("pointermove",f))})}async showRecognitionBox(){var t,n;j(this,Hr).info("showRecognitionBox"),await this.editor.export(["application/vnd.myscript.jiix"]);const e=(t=this.model.exports)==null?void 0:t["application/vnd.myscript.jiix"];if(j(this,Hr).debug("showRecognitionBox",{jiix:e}),e){if(!e["bounding-box"])return void j(this,Hr).warn("drawRecognitionBox",'You must to enabled configuration.recognition.exports["bounding-box"]');(n=e.elements)==null||n.forEach(s=>{var o;switch(s.type){case"Node":if(s["bounding-box"]){const i=Ol(s["bounding-box"]),a=["bounding-box","items","id"],l=Object.keys(s).filter(c=>!a.includes(c)).map(c=>`${c}: ${JSON.stringify(s[c])}`);this.drawRecognitionBox(i,l)}break;case"Text":(o=s.words)==null||o.forEach(i=>{if(i!=null&&i["bounding-box"]){const a=Ol(i["bounding-box"]);this.drawRecognitionBox(a,[`type: ${s.type}`,`candidates: ${JSON.stringify(i.candidates||[])}`])}});break;case"Edge":if(s.kind===da.PolyEdge){const i=[`type: ${s.type}`,`kind: ${s.kind}`];s.edges.forEach((l,c)=>{let u=`edge-${c}: [{ x1: ${l.x1}, y2: ${l.y1} },{ x2: ${l.x2}, y2: ${l.y2} }]`;l.p1Decoration&&(u+=`, p1Decoration: ${l.p1Decoration}`),l.p2Decoration&&(u+=`, p2Decoration: ${l.p2Decoration}`),i.push(u)});const a=Ol(at.createFromBoxes(s.edges.map(l=>l["bounding-box"])));this.drawRecognitionBox(a,i)}else if(s["bounding-box"]){const i=Ol(s["bounding-box"]),a=["bounding-box","items","id","ports","connected"],l=Object.keys(s).filter(c=>!a.includes(c)).map(c=>`${c}: ${JSON.stringify(s[c])}`);this.drawRecognitionBox(i,l)}break;default:j(this,Hr).warn("drawRecognitionBox",`Unknow jiix element type: ${s.type}`)}})}}clearRecognitionBox(){j(this,Hr).info("clearRecognitionBox"),this.renderer.clearElements({attrs:{debug:"recognition-box"}}),this.renderer.clearElements({attrs:{debug:"recognition-box-link"}})}async debugRecognitionBox(){this.clearRecognitionBox(),j(this,Nh)&&this.showRecognitionBox()}drawRecognitionItemBox(e,t,n){const s="blue",o=He.createGroup({debug:"recognition-item-box"}),i=He.createRect(e,{fill:"transparent",stroke:s,style:Lt.noSelection});o.appendChild(i);const a=e.x;let l=e.y-14;const c=He.createGroup({id:`chars-group-${zo()}`});t&&c.appendChild(He.createText({x:a,y:l},`label: ${t}`,{fill:s,"font-size":"14",style:Lt.noSelection})),n!=null&&n.length&&(l+=14,c.appendChild(He.createText({x:a,y:l},`[${n.join(", ")}]`,{fill:s,"font-size":"14",style:Lt.noSelection}))),o.appendChild(c),this.renderer.layer.appendChild(o);const u=c.getBBox(),p={width:u.width+10,height:u.height+10,x:u.x-5,y:u.y-5},f=He.createRect(p,{fill:"white",style:"cursor:move",stroke:s});c.prepend(f);const m=v=>{v.preventDefault(),v.stopPropagation();const b=Number(this.renderer.getAttribute(c.id,"originX")),S=Number(this.renderer.getAttribute(c.id,"originY")),C=v.clientX-b,E=v.clientY-S;this.renderer.setAttribute(c.id,"transform",`translate(${C},${E})`);const T={width:p.width,height:p.height,x:p.x+C,y:p.y+E};this.renderer.removeSymbol(`connection-${c.id}`),this.renderer.drawConnectionBetweenBox(`connection-${c.id}`,e,T,"corners",{stroke:s,debug:"recognition-item-box-link"})};f.addEventListener("pointerdown",v=>{v.preventDefault(),v.stopPropagation(),this.renderer.getAttribute(c.id,"originX")||(this.renderer.setAttribute(c.id,"originX",v.clientX.toString()),this.renderer.setAttribute(c.id,"originY",v.clientY.toString())),this.renderer.layer.addEventListener("pointermove",m)}),this.renderer.layer.addEventListener("pointerup",()=>this.renderer.layer.removeEventListener("pointermove",m)),this.renderer.layer.addEventListener("pointerleave",()=>this.renderer.layer.removeEventListener("pointermove",m)),this.renderer.layer.addEventListener("pointercancel",()=>this.renderer.layer.removeEventListener("pointermove",m))}async showRecognitionItemBox(){var t,n;j(this,Hr).info("showRecognitionBoxItem"),await this.editor.export(["application/vnd.myscript.jiix"]);const e=(t=this.model.exports)==null?void 0:t["application/vnd.myscript.jiix"];j(this,Hr).debug("showRecognitionBoxItem",{jiix:e}),e&&((n=e.elements)==null||n.forEach(s=>{var o;switch(s.type){case"Text":(o=s.chars)==null||o.forEach(i=>{if(i!=null&&i["bounding-box"]){const a=Ol(i["bounding-box"]);this.drawRecognitionItemBox(a,i.label,i.candidates)}});break;case"Node":if(s!=null&&s["bounding-box"]){const i=Ol(s["bounding-box"]);this.drawRecognitionItemBox(i,s.kind)}break;case"Edge":if(s.kind===da.PolyEdge)s.edges.forEach(i=>{const a=Ol(i["bounding-box"]);this.drawRecognitionItemBox(a,i.kind)});else if(s["bounding-box"]){const i=Ol(s["bounding-box"]);this.drawRecognitionItemBox(i,s.kind)}break;default:j(this,Hr).warn("drawRecognitionBoxItem",`Unknow jiix element type: ${s.type}`)}}))}clearRecognitionItemBox(){j(this,Hr).info("clearRecognitionBoxItem"),this.renderer.clearElements({attrs:{debug:"recognition-item-box"}}),this.renderer.clearElements({attrs:{debug:"recognition-item-box-link"}})}async debugRecognitionItemBox(){this.clearRecognitionItemBox(),j(this,Fh)&&this.showRecognitionItemBox()}apply(){this.debugBoundingBox(),this.debugVertices(),this.debugSnapPoints(),this.debugRecognitionBox(),this.debugRecognitionItemBox()}}Hr=new WeakMap,hg=new WeakMap,pg=new WeakMap,Lh=new WeakMap,Nh=new WeakMap,Fh=new WeakMap;class Jfe{constructor(e){k(this,"grabber");k(this,"editor");k(this,"origin");this.editor=e,this.grabber=new mp(e.configuration.grabber)}get renderer(){return this.editor.renderer}attach(e){this.grabber.attach(e),this.grabber.onPointerDown=this.start.bind(this),this.grabber.onPointerMove=this.continue.bind(this),this.grabber.onPointerUp=this.end.bind(this)}detach(){this.grabber.detach()}start(e){this.origin={left:this.renderer.parent.scrollLeft,top:this.renderer.parent.scrollTop,x:e.clientX,y:e.clientY}}continue(e){if(!this.origin)throw new Error("Can't move cause origin is undefined");const t=e.clientX-this.origin.x,n=e.clientY-this.origin.y;this.renderer.parent.scrollTop=this.origin.top-n,this.renderer.parent.scrollLeft=this.origin.left-t}end(e){this.continue(e),this.origin=void 0}}var Ii,zh,$h;class Qfe{constructor(e){De(this,Ii,Rt.getLogger(lt.SVGDEBUG));De(this,zh,!1);De(this,$h,!1);k(this,"editor");j(this,Ii).info("constructor"),this.editor=e}get model(){return this.editor.model}get renderer(){return this.editor.renderer}get recognitionBoxVisibility(){return j(this,zh)}set recognitionBoxVisibility(e){Je(this,zh,e),this.debugRecognitionBox()}get recognitionBoxItemsVisibility(){return j(this,$h)}set recognitionBoxItemsVisibility(e){Je(this,$h,e),this.debugRecognitionBoxItems()}drawBoundingBox(e){const t={style:"pointer-events: none",fill:"transparent",stroke:"red","stroke-width":"1","stroke-dasharray":"5 5","vector-effect":"non-scaling-stroke",debug:"bounding-box"},n={style:"pointer-events: none",fill:"transparent",stroke:"orange","stroke-width":"1","stroke-dasharray":"0 5 0","vector-effect":"non-scaling-stroke",debug:"bounding-box"};e.forEach(s=>{const o=this.renderer.getElementById(s.id);if(o)if(s.type===oe.Text){const i=s;let a="";i.rotation&&(a=`rotate(${i.rotation.degree}, ${i.rotation.center.x}, ${i.rotation.center.y})`),i.chars.forEach(c=>{const u={...n,char:c.label,transform:a};o.insertAdjacentElement("beforebegin",He.createRect(c.bounds,u))});const l={...t,symbol:s.id,transform:a};o.insertAdjacentElement("beforebegin",He.createRect(s.bounds,l))}else{const i={...t,symbol:s.id};o.insertAdjacentElement("beforebegin",He.createRect(s.bounds,i))}})}drawRecognitionBox(e,t,n,s){const o=He.createGroup({debug:s,opacity:s==="recognition-box-items"?"0.8":"1"}),i={fill:"transparent",stroke:n,style:Lt.noSelection,"stroke-dasharray":s==="recognition-box-items"?"1 5 10":""},a=He.createRect(e,i);o.appendChild(a);const l=He.createGroup({id:`infos-group-${zo()}`}),c=e.x+e.width;let u=e.y+10;t==null||t.forEach(b=>{l.appendChild(He.createText({x:c,y:u},b,{stroke:n,style:Lt.noSelection})),u+=20}),o.appendChild(l),this.renderer.layer.appendChild(o);const p=l.getBBox(),f={width:p.width+10,height:p.height+10,x:p.x-5,y:p.y-5},m=He.createRect(f,{...i,fill:"white",style:"cursor:move"});l.prepend(m);const v=b=>{b.preventDefault(),b.stopPropagation();const S=Number(this.renderer.getAttribute(l.id,"originX")),C=Number(this.renderer.getAttribute(l.id,"originY")),E=b.clientX-S,T=b.clientY-C;this.renderer.setAttribute(l.id,"transform",`translate(${E},${T})`);const w={width:f.width,height:f.height,x:f.x+E,y:f.y+T};this.renderer.removeSymbol(`connection-${l.id}`),this.renderer.drawConnectionBetweenBox(`connection-${l.id}`,e,w,"sides",{stroke:n,debug:s})};m.addEventListener("pointerdown",b=>{b.preventDefault(),b.stopPropagation(),this.renderer.getAttribute(l.id,"originX")||(this.renderer.setAttribute(l.id,"originX",b.clientX.toString()),this.renderer.setAttribute(l.id,"originY",b.clientY.toString())),this.renderer.layer.addEventListener("pointermove",v),this.renderer.layer.addEventListener("pointerup",()=>this.renderer.layer.removeEventListener("pointermove",v)),this.renderer.layer.addEventListener("pointerleave",()=>this.renderer.layer.removeEventListener("pointermove",v)),this.renderer.layer.addEventListener("pointercancel",()=>this.renderer.layer.removeEventListener("pointermove",v))})}buildInfos(e,t=""){const n=[];return Object.keys(e).forEach(s=>{const o=e[s],i=t?`${t}.${s}`:s;typeof o=="object"?n.push(...this.buildInfos(o,i)):n.push(`${i}: ${JSON.stringify(o)}`)}),n}async showRecognitionBox(){var t,n;j(this,Ii).info("showRecognitionBox");let e=(t=this.model.exports)==null?void 0:t["application/vnd.myscript.jiix"];e||(e=(await this.editor.recognizer.send(this.model.strokes,["application/vnd.myscript.jiix"]))["application/vnd.myscript.jiix"]),j(this,Ii).debug("showRecognitionBox",{jiix:e}),e&&((n=e.elements)==null||n.forEach(s=>{var o,i,a;switch(s.type){case"Drawing":case"Shape":{const l=[];(o=s.range)==null||o.forEach(m=>{l.push(...this.model.strokes.slice(m.from.stroke,m.to.stroke+1))});const c=at.createFromBoxes(l.map(m=>m.bounds));let u=[`type: ${s.type}`];u.push(...this.buildInfos(s));const p=["bounding-box","primitives","range","candidates"];u=u.filter(m=>!p.some(v=>m.indexOf(v)>-1));const f=s.type==="Shape"?"orange":"green";this.drawRecognitionBox(c,u,f,"recognition-box");break}case"Text":{const l=[];(i=s.range)==null||i.forEach(u=>{l.push(...this.model.strokes.slice(u.from.stroke,u.to.stroke+1))});const c=at.createFromBoxes(l.map(u=>u.bounds));this.drawRecognitionBox(c,[`type: ${s.type}`,`label: ${JSON.stringify(s.label||[])}`],"blue","recognition-box");break}case"Math":{const l=[];(a=s.range)==null||a.forEach(f=>{l.push(...this.model.strokes.slice(f.from.stroke,f.to.stroke+1))});const c=at.createFromBoxes(l.map(f=>f.bounds));let u=[`type: ${s.type}`];u.push(...this.buildInfos(s));const p=["bounding-box","primitives","range","candidates"];u=u.filter(f=>!p.some(m=>f.indexOf(m)>-1)),this.drawRecognitionBox(c,u,"red","recognition-box");break}default:j(this,Ii).warn("drawRecognitionBox",`Unknow jiix element type: ${s.type}`)}}))}async showRecognitionBoxItems(){var t,n;j(this,Ii).info("showRecognitionBoxItems");let e=(t=this.model.exports)==null?void 0:t["application/vnd.myscript.jiix"];e||(e=(await this.editor.recognizer.send(this.model.strokes,["application/vnd.myscript.jiix"]))["application/vnd.myscript.jiix"]),j(this,Ii).debug("showRecognitionBoxItems",{jiix:e}),e&&((n=e.elements)==null||n.forEach(s=>{var o;switch(s.type){case"Shape":s.elements.forEach(i=>{var p;const a=[];(p=i.range)==null||p.forEach(f=>{a.push(...this.model.strokes.slice(f.from.stroke,f.to.stroke+1))});const l=at.createFromBoxes(a.map(f=>f.bounds));let c=[`type: ${s.type}`];c.push(...this.buildInfos(i));const u=["bounding-box","primitives","range","candidates"];c=c.filter(f=>!u.some(m=>f.indexOf(m)>-1)),this.drawRecognitionBox(l,c,"#ce922a","recognition-box-items")});break;case"Math":case"Text":(o=s.lines)==null||o.forEach(i=>{var a;(a=i.spans)==null||a.forEach(l=>{const c=[];l.range.forEach(f=>{c.push(...this.model.strokes.slice(f.from.stroke,f.to.stroke+1))});const u=l.type==="Math"?"#ff6565":"#099df7",p=at.createFromBoxes(c.map(f=>f.bounds));this.drawRecognitionBox(p,[`type: ${l.type}`,`label: ${JSON.stringify(l.label||[])}`],u,"recognition-box-items")})});break;default:j(this,Ii).warn("drawRecognitionBox",`Unknow jiix element type: ${s.type}`)}}))}clearRecognitionBox(){j(this,Ii).info("clearRecognitionBox"),this.renderer.clearElements({attrs:{debug:"recognition-box"}})}clearRecognitionBoxItems(){j(this,Ii).info("clearRecognitionBoxItems"),this.renderer.clearElements({attrs:{debug:"recognition-box-items"}})}async debugRecognitionBox(){this.clearRecognitionBox(),j(this,zh)&&this.showRecognitionBox()}async debugRecognitionBoxItems(){this.clearRecognitionBoxItems(),j(this,$h)&&this.showRecognitionBoxItems()}apply(){this.debugRecognitionBox(),this.debugRecognitionBoxItems()}}Ii=new WeakMap,zh=new WeakMap,$h=new WeakMap;var Yd;class F7{constructor(e){De(this,Yd,Rt.getLogger(lt.WRITE));k(this,"grabber");k(this,"editor");k(this,"currentEraser");j(this,Yd).info("constructor"),this.editor=e,this.grabber=new mp(e.configuration.grabber)}get renderer(){return this.editor.renderer}attach(e){this.grabber.attach(e),this.grabber.onPointerDown=this.start.bind(this),this.grabber.onPointerMove=this.continue.bind(this),this.grabber.onPointerUp=this.end.bind(this)}detach(){this.grabber.detach()}start(e){j(this,Yd).info("startErase",{info:e}),this.currentEraser=new uI,this.currentEraser.pointers.push(e.pointer),this.renderer.drawSymbol(this.currentEraser)}continue(e){if(j(this,Yd).info("continueErase",{info:e}),!this.currentEraser)throw new Error("Can't update current eraser because currentEraser is undefined");this.currentEraser.pointers.push(e.pointer),this.renderer.drawSymbol(this.currentEraser);const t={p1:this.currentEraser.pointers.at(-1),p2:this.currentEraser.pointers.at(-2)};this.editor instanceof Ak?this.editor.model.symbols.forEach(n=>{n.isIntersected(t)&&(n.deleting=!0,this.renderer.drawSymbol(n))}):this.editor.model.strokes.forEach(n=>{n.isIntersected(t)&&(n.deleting=!0,this.renderer.drawSymbol(n))})}async end(e){j(this,Yd).info("finishErasing",{info:e}),this.continue(e),this.renderer.removeSymbol(this.currentEraser.id),this.editor instanceof Ak?this.editor.removeSymbols(this.editor.model.symbolsToDelete.map(t=>t.id)):this.editor.removeStrokes(this.editor.model.strokesToDelete.map(t=>t.id)),this.currentEraser=void 0}}Yd=new WeakMap;var Ha;class z7{constructor(e,t){De(this,Ha,Rt.getLogger(lt.HISTORY));k(this,"configuration");k(this,"event");k(this,"context");k(this,"stack");j(this,Ha).info("constructor",{configuration:e}),this.configuration=e,this.event=t,this.context={stackIndex:0,possibleUndoCount:0,canRedo:!1,canUndo:!1,empty:!0},this.stack=[]}updateContext(){this.context.canRedo=this.stack.length-1>this.context.stackIndex,this.context.canUndo=this.context.stackIndex>0,this.context.empty=this.stack[this.context.stackIndex].symbols.length===0}push(e){j(this,Ha).info("push",{model:e}),this.context.stackIndex+1<this.stack.length&&this.stack.splice(this.context.stackIndex+1),this.stack.push(e.clone()),this.context.stackIndex=this.stack.length-1,this.stack.length>this.configuration.maxStackSize&&(this.stack.shift(),this.context.stackIndex--),this.updateContext(),this.event.emitChanged(this.context)}updateStack(e){j(this,Ha).info("updateStack",{model:e});const t=this.stack.findIndex(n=>n.modificationDate===e.modificationDate);t>-1&&this.stack.splice(t,1,e.clone()),this.updateContext(),this.event.emitChanged(this.context)}undo(){j(this,Ha).info("undo"),this.context.canUndo&&(this.context.stackIndex--,this.updateContext(),this.event.emitChanged(this.context));const e=this.stack[this.context.stackIndex].clone();return j(this,Ha).debug("undo",e),e}redo(){j(this,Ha).info("redo"),this.context.canRedo&&(this.context.stackIndex++,this.updateContext(),this.event.emitChanged(this.context));const e=this.stack[this.context.stackIndex].clone();return j(this,Ha).debug("redo",e),e}}Ha=new WeakMap;var Qi;class ege{constructor(e,t){De(this,Qi,Rt.getLogger(lt.HISTORY));k(this,"configuration");k(this,"event");k(this,"context");k(this,"stack");j(this,Qi).info("constructor",{configuration:e}),this.configuration=e,this.event=t,this.context={stackIndex:0,possibleUndoCount:0,canRedo:!1,canUndo:!1,empty:!0},this.stack=[]}updateContext(){this.context.canRedo=this.stack.length-1>this.context.stackIndex,this.context.canUndo=this.context.stackIndex>0,this.context.empty=this.stack[this.context.stackIndex].model.symbols.length===0}isChangesEmpty(e){var t,n,s,o,i,a,l,c,u,p,f,m,v,b,S;return!((t=e.added)!=null&&t.length||(n=e.updated)!=null&&n.length||(s=e.erased)!=null&&s.length||(o=e.replaced)!=null&&o.oldSymbols.length||(i=e.matrix)!=null&&i.symbols.length||(a=e.translate)!=null&&a.length||(l=e.rotate)!=null&&l.length||(c=e.scale)!=null&&c.length||(p=(u=e.style)==null?void 0:u.symbols)!=null&&p.length||(m=(f=e.order)==null?void 0:f.symbols)!=null&&m.length||(v=e.decorator)!=null&&v.length||(b=e.group)!=null&&b.symbols.length||(S=e.ungroup)!=null&&S.group)}init(e){this.stack.push({model:e.clone(),changes:{}}),this.event.emitChanged(this.context)}push(e,t){j(this,Qi).info("push",{model:e,changes:t}),this.isChangesEmpty(t)||(this.context.stackIndex+1<this.stack.length&&this.stack.splice(this.context.stackIndex+1),this.stack.push({model:e.clone(),changes:t}),this.context.stackIndex=this.stack.length-1,this.stack.length>this.configuration.maxStackSize&&(this.stack.shift(),this.context.stackIndex--),this.updateContext(),this.event.emitChanged(this.context))}update(e){j(this,Qi).info("pop");const t=this.stack.findIndex(n=>n.model.modificationDate===e.modificationDate);t>-1&&(this.stack[t].model=e,this.updateContext())}pop(){j(this,Qi).info("pop"),this.stack.pop(),this.context.stackIndex=this.stack.length-1,this.updateContext()}reverseChanges(e){var n,s,o;const t={};return e.added&&(t.erased=e.added),e.erased&&(t.added=e.erased),e.replaced&&(t.replaced={newSymbols:e.replaced.oldSymbols,oldSymbols:e.replaced.newSymbols}),e.matrix&&(t.matrix={symbols:e.matrix.symbols,matrix:new Wd(e.matrix.matrix.xx,e.matrix.matrix.yx,e.matrix.matrix.xy,e.matrix.matrix.yy,e.matrix.matrix.tx,e.matrix.matrix.ty).invert()}),(n=e.translate)!=null&&n.length&&(t.translate=e.translate.map(i=>({symbols:i.symbols,tx:-i.tx,ty:-i.ty}))),(s=e.rotate)!=null&&s.length&&(t.rotate=e.rotate.map(i=>({symbols:i.symbols,angle:2*Math.PI-i.angle,center:i.center}))),(o=e.scale)!=null&&o.length&&(t.scale=e.scale.map(i=>({symbols:i.symbols,origin:i.origin,scaleX:1/i.scaleX,scaleY:1/i.scaleY}))),t}undo(){j(this,Qi).info("undo");const e=this.stack[this.context.stackIndex];this.context.canUndo&&(this.context.stackIndex--,this.updateContext(),this.event.emitChanged(this.context));const t=this.stack[this.context.stackIndex];return j(this,Qi).debug("undo",t),{model:t.model,changes:this.reverseChanges(e.changes)}}redo(){j(this,Qi).info("redo"),this.context.canRedo&&(this.context.stackIndex++,this.updateContext(),this.event.emitChanged(this.context));const e=this.stack[this.context.stackIndex];return j(this,Qi).debug("redo",e),e}clear(){this.context={stackIndex:0,possibleUndoCount:0,canRedo:!1,canUndo:!1,empty:!0},this.stack=[]}}Qi=new WeakMap;var ea;class tge{constructor(e,t){De(this,ea,Rt.getLogger(lt.HISTORY));k(this,"configuration");k(this,"event");k(this,"context");k(this,"stack");j(this,ea).info("constructor",{configuration:e}),this.configuration=e,this.event=t,this.context={stackIndex:0,possibleUndoCount:0,canRedo:!1,canUndo:!1,empty:!0},this.stack=[]}updateContext(){this.context.canRedo=this.stack.length-1>this.context.stackIndex,this.context.canUndo=this.context.stackIndex>0,this.context.empty=this.stack[this.context.stackIndex].model.strokes.length===0}updateModelStack(e){j(this,ea).info("updateModelStack",{model:e});const t=this.stack.findIndex(n=>n.model.modificationDate===e.modificationDate);t>-1&&(this.stack[t].model=e.clone(),this.updateContext()),this.updateContext(),this.event.emitChanged(this.context)}isChangesEmpty(e){var t,n;return!((t=e.added)!=null&&t.length||(n=e.removed)!=null&&n.length)}init(e){this.stack.push({model:e.clone(),changes:{}}),this.event.emitChanged(this.context)}push(e,t){j(this,ea).info("push",{model:e,changes:t}),this.isChangesEmpty(t)||(this.context.stackIndex+1<this.stack.length&&this.stack.splice(this.context.stackIndex+1),this.stack.push({model:e.clone(),changes:t}),this.context.stackIndex=this.stack.length-1,this.stack.length>this.configuration.maxStackSize&&(this.stack.shift(),this.context.stackIndex--),this.updateContext(),this.event.emitChanged(this.context))}pop(){j(this,ea).info("pop"),this.stack.pop(),this.context.stackIndex=this.stack.length-1,this.updateContext()}reverseChanges(e){const t={};return e.added&&(t.removed=e.added),e.removed&&(t.added=e.removed),t}undo(){j(this,ea).info("undo");const e=this.stack[this.context.stackIndex];this.context.canUndo&&(this.context.stackIndex--,this.updateContext(),this.event.emitChanged(this.context));const t=this.stack[this.context.stackIndex];return j(this,ea).debug("undo",t),{model:t.model,changes:this.reverseChanges(e.changes)}}redo(){j(this,ea).info("redo"),this.context.canRedo&&(this.context.stackIndex++,this.updateContext(),this.event.emitChanged(this.context));const e=this.stack[this.context.stackIndex];return j(this,ea).debug("redo",e),e}clear(){this.context={stackIndex:0,possibleUndoCount:0,canRedo:!1,canUndo:!1,empty:!0},this.stack=[]}}ea=new WeakMap;const nS={maxStackSize:100};var fh=`<svg
  width="24px"
  height="24px"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>
`;class rS{constructor(){k(this,"thicknessList",[{label:"S",value:1},{label:"M",value:2},{label:"L",value:4},{label:"XL",value:8}]);k(this,"fontSizeList",[{label:"Auto",value:"auto"},{label:"S",value:.5},{label:"M",value:.75},{label:"L",value:1}]);k(this,"fontWeightList",[{label:"Auto",value:"auto"},{label:"Normal",value:"normal"},{label:"Bold",value:"bold"}]);k(this,"colors",["#000000","#808080","#ffffff","transparent","#ff0000","#ff6400","#ffc800","#ffff00","#0000ff","#0064ff","#00c8ff","#00ffff","#008000","#00af00","#00e100","#00ff00"])}createWrapCollapsible(e,t){const n=document.createElement("div");n.classList.add("collapsible-wrapper");const s=document.createElement("div");s.classList.add("collapsible-header"),s.textContent=t;const o=document.createElement("span");o.classList.add("collapsible-header-icon"),o.innerHTML=fh,s.appendChild(o),s.style.setProperty("pointer","cursor");const i=document.createElement("div");return i.classList.add("collapsible-content"),s.addEventListener("pointerup",()=>n.classList.toggle("active")),n.appendChild(s),i.appendChild(e),n.appendChild(i),n}createMenuItemBoolean(e){const t=document.createElement("div");t.classList.add("ms-menu-item",e.type);const n=document.createElement("span");n.textContent=e.label,t.appendChild(n);const s=document.createElement("input");return s.id=e.id,s.setAttribute("type","checkbox"),e.disabled&&(s.disabled=!0),e.initValue==="indeterminate"?s.indeterminate=!0:s.checked=e.initValue,s.addEventListener("change",o=>e.callback(o.target.checked)),t.appendChild(s),t}createMenuItemSelect(e){const t=document.createElement("div");t.classList.add("ms-menu-item",e.type);const n=document.createElement("span");n.textContent=e.label,t.appendChild(n);const s=document.createElement("select");return s.id=e.id,e.disabled&&(s.disabled=!0),e.values.forEach(o=>{const i=o.value===e.initValue,a=new Option(o.label,o.value.toString(),i,i);s.appendChild(a)}),s.addEventListener("change",o=>e.callback(o.target.value)),t.appendChild(s),t}createMenuItemButton(e){const t=document.createElement("button");return t.classList.add("ms-menu-item","ms-menu-button"),t.innerHTML=e.icon||e.label,t.addEventListener("pointerup",e.callback),t}createMenuItemButtonList(e){const t=document.createElement("div");t.classList.add("ms-menu-item",e.type),t.id=e.id;const n=document.createElement("span");return n.textContent=e.label,t.appendChild(n),e.values.forEach(s=>{const o=document.createElement("button");e.disabled&&(o.disabled=!0),o.id=`${e.id}-${s.value}-btn`,e.initValue===s.value&&o.classList.add("active"),o.textContent=s.label,o.addEventListener("pointerup",()=>{e.callback(s.value),t.querySelectorAll("*").forEach(i=>i.classList.remove("active")),o.classList.add("active")}),t.appendChild(o)}),t}createMenuItemColorList(e){const t=document.createElement("div");t.classList.add("ms-menu-item",e.type),t.id=e.id;const n=document.createElement("span");return n.textContent=e.label,t.appendChild(n),t.appendChild(this.createColorList(e)),t}createColorList(e){const t=document.createElement("div");return t.id=`${e.id}-list`,t.classList.add("ms-menu-row","color-list"),e.values.forEach(n=>{const s=document.createElement("button");e.disabled&&(s.disabled=!0),s.id=`${e.id}-${n.replace("#","")}-btn`,s.classList.add("ms-menu-button","square");const o=document.createElement("div");o.classList.add("color"),e.fill?(o.style.setProperty("background-color",n),o.style.setProperty("border","1px solid lightgrey")):(o.style.setProperty("background-color","transparent"),o.style.setProperty("border",`3px solid ${n}`)),n==="#ffffff"&&o.style.setProperty("border","1px solid black"),n==="transparent"&&o.style.setProperty("background-image","linear-gradient(45deg, #AAA 10%, transparent 20%, #AAA 30%, transparent 40%, #AAA 50%, transparent 60%, #AAA 70%, transparent 80%, #AAA 90%, transparent 100%)"),e.initValue===n&&s.classList.add("active"),s.appendChild(o),s.addEventListener("pointerup",i=>{i.preventDefault(),i.stopPropagation(),e.callback(n),t.querySelectorAll("*").forEach(a=>a.classList.remove("active")),s.classList.add("active")}),t.appendChild(s)}),t}createMenuItem(e){switch(e.type){case"checkbox":return this.createMenuItemBoolean(e);case"select":return this.createMenuItemSelect(e);case"list":return this.createMenuItemButtonList(e);case"colors":return this.createMenuItemColorList(e);default:return this.createMenuItemButton(e)}}}var ei,Xa,Hl;(function(r){r.Select="select",r.Surround="surround",r.Highlight="highlight"})(ei||(ei={})),function(r){r.Erase="erase",r.Draw="draw"}(Xa||(Xa={})),function(r){r.LineBreak="line-break",r.Insert="insert"}(Hl||(Hl={}));const Tv={surround:ei.Select,strikeThrough:Xa.Draw,insert:Hl.LineBreak};var ds;class nge{constructor(e,t){De(this,ds,Rt.getLogger(lt.GESTURE));k(this,"insertAction",Hl.LineBreak);k(this,"surroundAction",ei.Select);k(this,"strikeThroughAction",Xa.Draw);k(this,"editor");j(this,ds).info("constructor"),this.editor=e,this.surroundAction=(t==null?void 0:t.surround)||Tv.surround,this.strikeThroughAction=(t==null?void 0:t.strikeThrough)||Tv.strikeThrough,this.insertAction=(t==null?void 0:t.insert)||Tv.insert}get renderer(){return this.editor.renderer}get recognizer(){return this.editor.recognizer}get translator(){return this.editor.translator}get texter(){return this.editor.texter}get model(){return this.editor.model}get history(){return this.editor.history}get rowHeight(){return this.editor.configuration.rendering.guides.gap}get strokeSpaceWidth(){return 2*this.editor.configuration.rendering.guides.gap}async applySurroundGesture(e,t){j(this,ds).info("applySurroundGesture",{gestureStroke:e,gesture:t});const n={},s=this.model.symbols.filter(o=>e.bounds.contains(o.bounds)).map(o=>o.id);switch(this.surroundAction){case ei.Select:s.length&&(this.editor.tool=Pt.Select,this.editor.select(s));break;case ei.Highlight:{const o=[];n.decorator=[],s.forEach(i=>{const a=this.model.getRootSymbol(i);if(a&&[oe.Group,oe.Stroke,oe.Text,oe.Recognized].includes(a.type)&&!o.includes(a.id)){const l=a,c=new Pr(Qt.Highlight,this.editor.penStyle),u=l.decorators.findIndex(f=>f.kind===Qt.Highlight),p=u===-1;p?l.decorators.push(c):l.decorators.splice(u,1),this.model.updateSymbol(l),this.renderer.drawSymbol(l),o.push(l.id),n.decorator.push({symbol:l,decorator:c,added:p})}}),n.decorator.length&&this.history.push(this.model,n);break}case ei.Surround:{const o=[];n.decorator=[],s.forEach(i=>{const a=this.model.getRootSymbol(i);if(a&&[oe.Group,oe.Stroke,oe.Text,oe.Recognized].includes(a.type)&&!o.includes(a.id)){const l=a,c=new Pr(Qt.Surround,this.editor.penStyle),u=l.decorators.findIndex(f=>f.kind===Qt.Surround),p=u===-1;p?l.decorators.push(c):l.decorators.splice(u,1),this.model.updateSymbol(l),this.renderer.drawSymbol(l),n.decorator.push({symbol:l,decorator:c,added:p}),o.push(l.id)}}),this.history.push(this.model,n);break}default:j(this,ds).error("applySurroundGesture",`Unknow surroundAction: ${this.surroundAction}, values allowed are: ${ei.Highlight}, ${ei.Select}, ${ei.Surround}`)}}computeScratchOnStrokes(e,t){var o;const n=[],s=(o=e.subStrokes)==null?void 0:o.find(i=>i.fullStrokeId===t.id);if(s){const i=new Jn;s.x.forEach((l,c)=>i.addPointer({x:l,y:s.y[c],p:1,t:1}));const a=Jn.substract(t,i);a.before&&a.before.pointers.length>1&&n.push(a.before),a.after&&a.after.pointers.length>1&&n.push(a.after)}return n}computeScratchOnText(e,t){const n=t.getCharsOverlaps(e.pointers);return t.chars.length==n.length?void 0:(n.forEach(s=>{const o=t.chars.findIndex(i=>i.id===s.id);t.chars.splice(o,1)}),this.texter.updateBounds(t),t)}computeScratchOnSymbol(e,t,n){switch(n.type){case oe.Stroke:{const s=this.computeScratchOnStrokes(t,n);return s.length?{replaced:s}:{erased:!0}}case oe.Recognized:if(n.kind===jn.Text){const s=n.strokes.filter(i=>!e.bounds.overlaps(i.bounds)),o=n.strokes.filter(i=>e.bounds.overlaps(i.bounds)).map(i=>({symbol:i,result:this.computeScratchOnStrokes(t,i)}));if(s.length===0&&o.every(i=>i.result.length===0))return{erased:!0};{const i=s.concat(...o.flatMap(l=>l.result)),a=new tl(i,{baseline:n.baseline,xHeight:n.xHeight},n.style);return a.decorators=n.decorators,{replaced:[a]}}}return{};case oe.Group:{const s=n.children.filter(i=>!e.bounds.overlaps(i.bounds)),o=n.children.filter(i=>e.bounds.overlaps(i.bounds)).map(i=>({symbol:i,result:this.computeScratchOnSymbol(e,t,i)}));if(s.length===0&&o.every(i=>i.result.erased))return{erased:!0};{const i=s;o.forEach(l=>{l.result.replaced&&i.push(...l.result.replaced)});const a=new Gr(i,n.style);return a.decorators=n.decorators,{replaced:[a]}}}case oe.Text:{const s=this.computeScratchOnText(e,n);return s?{replaced:[s]}:{erased:!0}}case oe.Shape:case oe.Edge:return{erased:!0}}}async applyScratch(e,t){if(j(this,ds).debug("applyScratchGesture",{gestureStroke:e,gesture:t}),!t.strokeIds.length)return void j(this,ds).warn("applyScratchGesture","Unable to apply underline because there are no strokes");const n=[],s=[],o={oldSymbols:[],newSymbols:[]};t.strokeIds.forEach(l=>{const c=this.model.getRootSymbol(l);if(c&&!s.some(u=>u.id===c.id)&&!o.oldSymbols.some(u=>u.id===c.id)){const u=this.computeScratchOnSymbol(e,t,c);u.erased?s.push(c):u.replaced&&(o.newSymbols.push(...u.replaced),o.oldSymbols.push(c))}});const i=[],a={};n.length&&(i.push(this.editor.updateSymbols(n,!1)),a.updated=n),s.length&&(i.push(this.editor.removeSymbols(s.map(l=>l.id),!1)),a.erased=s),o.newSymbols.length&&(a.replaced=o,i.push(this.editor.replaceSymbols(o.oldSymbols,o.newSymbols,!1))),this.history.push(this.model,a),await Promise.all(i)}async applyJoinGesture(e,t){var p;j(this,ds).debug("applyJoinGesture",{gestureStroke:e,gesture:t});const n=this.model.symbols.filter(f=>this.model.isSymbolAbove(e,f)),s=this.model.symbols.filter(f=>e.id!==f.id&&this.model.isSymbolInRow(e,f)),o=s.filter(f=>f.bounds.xMax<=e.bounds.xMid),i=s.filter(f=>f.bounds.xMax>e.bounds.xMid&&f.bounds.xMin<=e.bounds.xMid),a=s.filter(f=>f.bounds.xMin>e.bounds.xMid),l=this.model.symbols.filter(f=>this.model.isSymbolBelow(e,f)),c={},u=[];if(i.length){const f=i[0];if((f==null?void 0:f.type)===oe.Group){const m=f.children.map(S=>S.clone()),v=m.filter(S=>S.bounds.xMid<=e.bounds.xMid),b=m.filter(S=>S.bounds.xMid>e.bounds.xMid);if(v.length&&b.length){const S=Math.max(...v.map(E=>E.bounds.xMax))-Math.min(...b.map(E=>E.bounds.xMin));b.forEach(E=>this.translator.applyToSymbol(E,S,0));const C=new Gr(m,f.style);C.decorators=f.decorators.map(E=>E.clone()),c.replaced={oldSymbols:[f],newSymbols:[C]},a.length&&u.push({symbols:a,tx:S,ty:0})}else if(a.length){const S=f.bounds.xMax-Math.min(...a.map(C=>C.bounds.xMin));u.push({symbols:a,tx:S,ty:0})}}else if((f==null?void 0:f.type)===oe.Recognized){const m=f.clone(),v=m.strokes.filter(S=>S.bounds.xMid<=e.bounds.xMid),b=m.strokes.filter(S=>S.bounds.xMid>e.bounds.xMid);if(v.length&&b.length){const S=Math.max(...v.map(C=>C.bounds.xMax))-Math.min(...b.map(C=>C.bounds.xMin));b.forEach(C=>this.translator.applyToSymbol(C,S,0)),c.replaced={oldSymbols:[f],newSymbols:[m]},a.length&&u.push({symbols:a,tx:S,ty:0})}else if(a.length){const S=f.bounds.xMax-Math.min(...a.map(C=>C.bounds.xMin));u.push({symbols:a,tx:S,ty:0})}}}else if(o.length&&a.length){const f=this.model.getLastSymbol(o),m=this.model.getFirstSymbol(a),v=Math.max(...o.map(T=>T.bounds.xMax))-Math.min(...a.map(T=>T.bounds.xMin)),b=f.clone(),S=m.clone();this.translator.applyToSymbol(S,v,0);const C=f.type===oe.Group?b.children:[b];if(C.push(...S.type===oe.Group?S.children:[S]),C.every(T=>T.type===oe.Text)){const T=C,w=new ol(T.flatMap(M=>M.chars),T[0].point,at.createFromBoxes(T.map(M=>M.bounds)));this.texter.setBounds(w),c.replaced={oldSymbols:[f,m],newSymbols:[w]}}else if(C.every(T=>T.type===oe.Recognized)){const T=C,w=new tl(T.flatMap(M=>M.strokes),T[0],T[0].style);c.replaced={oldSymbols:[f,m],newSymbols:[w]}}else{const T=new Gr(C,f.style);[oe.Group,oe.Stroke,oe.Text,oe.Recognized].includes(f.type)&&f.decorators.forEach(w=>{T.decorators.push(new Pr(w.kind,w.style))}),[oe.Group,oe.Stroke,oe.Text,oe.Recognized].includes(m.type)&&m.decorators.forEach(w=>{T.decorators.some(M=>M.kind==w.kind)||T.decorators.push(new Pr(w.kind,w.style))}),c.replaced={oldSymbols:[f,m],newSymbols:[T]}}const E=a.filter(T=>T.id!==m.id);E.length&&u.push({symbols:E,tx:v,ty:0})}else if(o.length){const f=this.model.getLastSymbol(o),m=this.model.getFirstSymbol(l);if(m){if(this.model.roundToLineGuide(f.bounds.yMid)>=this.model.roundToLineGuide(m.bounds.yMid-this.rowHeight)){const v=l.filter(S=>this.model.isSymbolInRow(m,S));if(v.length){const S=f.bounds.xMax+this.strokeSpaceWidth-m.bounds.xMin;u.push({symbols:v,tx:S,ty:-this.rowHeight})}const b=l.filter(S=>this.model.isSymbolBelow(m,S));b.length&&u.push({symbols:b,tx:0,ty:-this.rowHeight})}}else u.push({symbols:l,tx:0,ty:-this.rowHeight})}else if(a.length){const f=this.model.getFirstSymbol(a),m=this.model.getLastSymbol(n);if(m){if(this.model.roundToLineGuide(m.bounds.yMid)>=this.model.roundToLineGuide(f.bounds.yMid-this.rowHeight)){const v=m.bounds.xMax+this.strokeSpaceWidth-f.bounds.xMin;u.push({symbols:a,tx:v,ty:-this.rowHeight})}else u.push({symbols:a,tx:0,ty:-this.rowHeight});l.length&&u.push({symbols:l,tx:0,ty:-this.rowHeight})}else u.push({symbols:a.concat(...l),tx:0,ty:-this.rowHeight})}(p=c.replaced)!=null&&p.oldSymbols.length&&this.editor.replaceSymbols(c.replaced.oldSymbols,c.replaced.newSymbols,!1),u.length&&(c.translate=u,Promise.all(u.map(f=>this.translator.translate(f.symbols,f.tx,f.ty,!1)))),this.history.push(this.model,c)}createStrokesFromGestureSubStroke(e,t){const n=[];if(t[0]){const s=new Jn(e.style);t[0].x.forEach((o,i)=>{var a,l;s.pointers.push({x:o,y:t[0].y[i],p:((a=e.pointers.at(i))==null?void 0:a.p)||1,t:((l=e.pointers.at(i))==null?void 0:l.t)||Math.max(...s.pointers.map(c=>c.t+20))})}),n.push(s)}if(t[1]){const s=new Jn(e.style);t[1].x.forEach((o,i)=>{var a,l;s.pointers.push({x:o,y:t[1].y[i],p:((a=e.pointers.at(s.pointers.length+i))==null?void 0:a.p)||1,t:((l=e.pointers.at(s.pointers.length+i))==null?void 0:l.t)||Math.max(...s.pointers.map(c=>c.t+20))})}),n.push(s)}return n}computeSplitStroke(e,t){let n;const s=this.createStrokesFromGestureSubStroke(e,t);return s[1]&&(n=s[1],this.translator.applyToSymbol(n,this.strokeSpaceWidth,0)),{before:s[0],after:n}}computeSplitStrokeInGroup(e,t,n){const s=[],o=[],i=[],a=n[0].fullStrokeId;return t.children.forEach(l=>{if(l.id===a){const c=this.computeSplitStroke(l,n);c.before&&o.push(c.before),c.after&&i.push(c.after)}else l.bounds.xMid<e.bounds.xMid?o.push(l):l.bounds.xMid>e.bounds.xMid&&(this.translator.applyToSymbol(l,this.strokeSpaceWidth,0),i.push(l))}),o.length&&s.push(new Gr(o,t.style)),i.length&&s.push(new Gr(i,t.style)),s}computeChangesOnSplitStroke(e,t,n){const s=[],o={oldSymbols:[],newSymbols:[]},i=this.model.symbols.filter(l=>e.id!==l.id&&this.model.isSymbolInRow(e,l)&&e.bounds.xMid<l.bounds.xMin),a=this.model.getRootSymbol(t);if((a==null?void 0:a.type)===oe.Group){const l=this.computeSplitStrokeInGroup(e,a,n);o.newSymbols.push(...l),o.oldSymbols.push(a)}else if((a==null?void 0:a.type)===oe.Stroke){const l=this.computeSplitStroke(a,n);l.before&&o.newSymbols.push(l.before),l.after&&o.newSymbols.push(l.after),o.oldSymbols.push(a)}else if((a==null?void 0:a.type)===oe.Recognized){const l=a.strokes.find(f=>f.id===t),c=a.strokes.filter(f=>f.id!==t&&f.bounds.xMid<e.bounds.xMid),u=a.strokes.filter(f=>f.id!==t&&f.bounds.xMid>e.bounds.xMid),p=this.computeSplitStroke(l,n);p.before&&o.newSymbols.push(...c,p.before),p.after&&o.newSymbols.push(p.after,...u),o.oldSymbols.push(a)}return i.length&&s.push({symbols:i,tx:this.strokeSpaceWidth,ty:0}),{translate:s,replaced:o}}computeChangesOnSplitGroup(e,t){const n=[],s={oldSymbols:[],newSymbols:[]},o=this.model.symbols.filter(l=>e.id!==l.id&&this.model.isSymbolInRow(e,l)&&e.bounds.xMid<l.bounds.xMin),i=t.children.filter(l=>l.bounds.xMid<=e.bounds.xMid),a=t.children.filter(l=>l.bounds.xMid>e.bounds.xMid);if(s.oldSymbols.push(t),i.length){const l=new Gr(i.map(c=>c.clone()),t.style);l.decorators=t.decorators.map(c=>new Pr(c.kind,c.style)),s.newSymbols.push(l)}if(a.length){const l=new Gr(a.map(c=>c.clone()),t.style);l.decorators=t.decorators.map(c=>new Pr(c.kind,c.style)),this.translator.applyToSymbol(l,this.strokeSpaceWidth,0),s.newSymbols.push(l)}return o!=null&&o.length&&n.push({symbols:o.filter(l=>l.id!==t.id),tx:this.strokeSpaceWidth,ty:0}),{translate:n,replaced:s}}computeChangesOnSplitStrokeText(e,t){const n=[],s={oldSymbols:[],newSymbols:[]},o=this.model.symbols.filter(l=>e.id!==l.id&&this.model.isSymbolInRow(e,l)&&e.bounds.xMid<l.bounds.xMin),i=t.strokes.filter(l=>l.bounds.xMid<=e.bounds.xMid),a=t.strokes.filter(l=>l.bounds.xMid>e.bounds.xMid);if(s.oldSymbols.push(t),i.length){const l=new tl(i.map(c=>c.clone()),t,t.style);l.decorators=t.decorators.map(c=>new Pr(c.kind,c.style)),s.newSymbols.push(l)}if(a.length){const l=new tl(a.map(c=>c.clone()),t,t.style);l.decorators=t.decorators.map(c=>new Pr(c.kind,c.style)),this.translator.applyToSymbol(l,this.strokeSpaceWidth,0),s.newSymbols.push(l)}return o!=null&&o.length&&n.push({symbols:o.filter(l=>l.id!==t.id),tx:this.strokeSpaceWidth,ty:0}),{translate:n,replaced:s}}computeChangesOnSplitText(e,t){const n=[],s={oldSymbols:[],newSymbols:[]},o=this.model.symbols.filter(c=>e.id!==c.id&&this.model.isSymbolInRow(e,c)&&e.bounds.xMid<c.bounds.xMin),i=t.chars.filter(c=>c.bounds.x+c.bounds.width/2<=e.bounds.xMid),a=t.chars.filter(c=>c.bounds.x+c.bounds.width/2>e.bounds.xMid),l=[];if(i.length&&a.length){const c=new ol(i,t.point,at.createFromBoxes(i.map(f=>f.bounds)));this.texter.setBounds(c),l.push(c);const u={x:c.point.x+c.bounds.width+this.texter.getSpaceWidth(v7(c.chars.map(f=>f.fontSize))),y:c.point.y},p=new ol(a,u,at.createFromBoxes(a.map(f=>f.bounds)));this.texter.setBounds(p),l.push(p),s.newSymbols=l,s.oldSymbols=[t]}return o!=null&&o.length&&n.push({symbols:o.filter(c=>c.id!==e.id),tx:this.strokeSpaceWidth,ty:0}),{translate:n,replaced:s}}async applyInsertGesture(e,t){var p,f,m;j(this,ds).debug("applyInsertGesture",{gestureStroke:e,gesture:t});const n=this.model.symbols.filter(v=>e.id!==v.id&&this.model.isSymbolInRow(e,v)),s=n.find(v=>v.type===oe.Text&&ar(e.bounds.xMid,v.bounds.xMin,v.bounds.xMax)),o=n.find(v=>v.type===oe.Group&&ar(e.bounds.xMid,v.bounds.xMin,v.bounds.xMax)),i=n.find(v=>v.type===oe.Recognized&&ar(e.bounds.xMid,v.bounds.xMin,v.bounds.xMax)),a=n.filter(v=>e.bounds.xMid>v.bounds.xMax),l=n.filter(v=>e.bounds.xMid<v.bounds.xMin),c=this.model.symbols.filter(v=>this.model.isSymbolBelow(e,v));let u;if(t.strokeIds.length&&((p=t.subStrokes)!=null&&p.length))u=this.computeChangesOnSplitStroke(e,t.strokeIds[0],t.subStrokes);else if(o)u=this.computeChangesOnSplitGroup(e,o);else if(s)u=this.computeChangesOnSplitText(e,s);else if(i)u=this.computeChangesOnSplitStrokeText(e,i);else if(l.length){const v=[];let b=0;switch(a.length&&(b=Math.min(...a.map(S=>S.bounds.xMin))-Math.min(...l.map(S=>S.bounds.xMin))),this.insertAction){case Hl.LineBreak:v.push({symbols:l,tx:b,ty:this.rowHeight}),c.length&&v.push({symbols:c,tx:0,ty:this.rowHeight});break;case Hl.Insert:v.push({symbols:l,tx:2*this.strokeSpaceWidth,ty:0})}u={translate:v}}else a.length&&c.length&&this.insertAction===Hl.LineBreak&&(u={translate:[{symbols:c,tx:0,ty:this.rowHeight}]});if(u){const v=[];(f=u.translate)!=null&&f.length&&v.push(...u.translate.map(b=>this.translator.translate(b.symbols,b.tx,b.ty,!1))),(m=u.replaced)!=null&&m.newSymbols.length&&v.push(this.editor.replaceSymbols(u.replaced.oldSymbols,u.replaced.newSymbols,!1)),this.history.push(this.model,u),await Promise.all(v)}}async applyUnderlineGesture(e,t){var o;if(j(this,ds).debug("applyUnderlineGesture",{gestureStroke:e,gesture:t}),!t.strokeIds.length)return void j(this,ds).warn("applyUnderlineGesture","Unable to apply underline because there are no strokes");const n={decorator:[]},s=[];t.strokeIds.forEach(i=>{var l;const a=this.model.getRootSymbol(i);if(a&&[oe.Group,oe.Stroke,oe.Text,oe.Recognized].includes(a.type)&&!s.includes(a.id)){const c=a,u=new Pr(Qt.Underline,this.editor.penStyle),p=c.decorators.findIndex(m=>m.kind===Qt.Underline),f=p===-1;f?c.decorators.push(u):c.decorators.splice(p,1),this.model.updateSymbol(c),this.renderer.drawSymbol(c),(l=n.decorator)==null||l.push({symbol:c,decorator:u,added:f}),s.push(c.id)}}),(o=n.decorator)!=null&&o.length&&this.history.push(this.model,n)}async applyStrikeThroughGesture(e,t){var n;if(j(this,ds).debug("applyStrikeThroughGesture",{gestureStroke:e,gesture:t}),t.strokeIds.length)switch(this.strikeThroughAction){case Xa.Draw:{const s={decorator:[]},o=[];t.strokeIds.forEach(i=>{var l;const a=this.model.getRootSymbol(i);if(a&&[oe.Group,oe.Stroke,oe.Text,oe.Recognized].includes(a.type)&&!o.includes(a.id)){const c=a,u=new Pr(Qt.Strikethrough,this.editor.penStyle),p=c.decorators.findIndex(m=>m.kind===Qt.Strikethrough),f=p===-1;f?c.decorators.push(u):c.decorators.splice(p,1),this.model.updateSymbol(c),this.renderer.drawSymbol(c),(l=s.decorator)==null||l.push({symbol:c,decorator:u,added:f}),o.push(c.id)}}),(n=s.decorator)!=null&&n.length&&this.history.push(this.model,s);break}case Xa.Erase:return this.editor.removeSymbols(t.strokeIds);default:j(this,ds).warn("#applyStrikeThroughGesture",`Unknow OnStrikeThrough: ${this.strikeThroughAction}, values allowed are: ${Xa.Draw}, ${Xa.Erase}`)}else j(this,ds).warn("applyStrikeThroughGesture","Unable to apply strikethrough because there are no strokes")}async apply(e,t){switch(j(this,ds).info("apply",{gestureStroke:e,gesture:t}),this.editor.updateSymbolsStyle([e.id],{opacity:(e.style.opacity||1)/2},!1),await this.editor.removeSymbol(e.id,!1),await this.editor.synchronizeStrokesWithJIIX(),t.gestureType){case"UNDERLINE":await this.applyUnderlineGesture(e,t);break;case"SCRATCH":await this.applyScratch(e,t);break;case"JOIN":await this.applyJoinGesture(e,t);break;case"INSERT":await this.applyInsertGesture(e,t);break;case"STRIKETHROUGH":await this.applyStrikeThroughGesture(e,t);break;case"SURROUND":await this.applySurroundGesture(e,t);break;default:j(this,ds).warn("apply",`Gesture unknow: ${t.gestureType}`)}return this.editor.event.emitGestured({gestureType:t.gestureType,stroke:e}),this.editor.svgDebugger.apply(),Promise.resolve()}async getGestureFromContextLess(e){const t=await this.recognizer.recognizeGesture(e);if(t)switch(t.gestureType){case"surround":return this.model.symbols.some(n=>!(n.id===e.id||!e.bounds.contains(n.bounds))&&(this.surroundAction===ei.Select||[oe.Group,oe.Stroke,oe.Text].includes(n.type)))?{gestureType:"SURROUND",gestureStrokeId:e.id,strokeAfterIds:[],strokeBeforeIds:[],strokeIds:[]}:void 0;case"left-right":case"right-left":{const n=this.model.symbols.filter(o=>o.id!==e.id&&[oe.Text,oe.Stroke,oe.Group].includes(o.type)&&ar(o.bounds.xMid,e.bounds.xMin,e.bounds.xMax)&&ar(e.bounds.yMid,o.bounds.y+3*o.bounds.height/4,o.bounds.y+5*o.bounds.height/4));if(n.length)return{gestureType:"UNDERLINE",gestureStrokeId:e.id,strokeAfterIds:[],strokeBeforeIds:[],strokeIds:n.map(o=>o.id)};const s=this.model.symbols.filter(o=>o.id!==e.id&&[oe.Text,oe.Stroke,oe.Group].includes(o.type)&&ar(o.bounds.xMid,e.bounds.xMin,e.bounds.xMax)&&ar(e.bounds.yMid,o.bounds.y+o.bounds.height/4,o.bounds.y+3*o.bounds.height/4));return s.length?{gestureType:"STRIKETHROUGH",gestureStrokeId:e.id,strokeAfterIds:[],strokeBeforeIds:[],strokeIds:s.map(o=>o.id)}:void 0}case"scratch":{const n=this.model.symbols.filter(s=>s.id!==e.id&&(e.bounds.overlaps(s.bounds)&&[oe.Stroke,oe.Text,oe.Group].includes(s.type)||e.bounds.contains(s.bounds)&&[oe.Shape,oe.Edge].includes(s.type)));return n.length?{gestureType:"SCRATCH",gestureStrokeId:e.id,strokeAfterIds:[],strokeBeforeIds:[],strokeIds:n.map(s=>s.id)}:void 0}case"bottom-top":return this.model.symbols.some(n=>n.id!==e.id&&[oe.Text,oe.Stroke,oe.Group].includes(n.type)&&ar(n.bounds.yMid,e.bounds.yMin,e.bounds.yMax))?{gestureType:"JOIN",gestureStrokeId:e.id,strokeAfterIds:[],strokeBeforeIds:[],strokeIds:[]}:void 0;case"top-bottom":return this.model.symbols.some(n=>n.id!==e.id&&[oe.Text,oe.Stroke,oe.Group].includes(n.type)&&ar(n.bounds.yMid,e.bounds.yMin,e.bounds.yMax))?{gestureType:"INSERT",gestureStrokeId:e.id,strokeAfterIds:[],strokeBeforeIds:[],strokeIds:[]}:void 0;default:return}}}ds=new WeakMap;class Bs{constructor(e){k(this,"element");k(this,"content");if(this.element=document.createElement("div"),this.element.classList.add("sub-menu"),this.element.appendChild(e.trigger),this.content=document.createElement("div"),e.menuTitle){const t=document.createElement("h3");t.classList.add("ms-menu-title"),t.textContent=e.menuTitle,this.content.appendChild(t)}this.content.classList.add("sub-menu-content",e.position),this.content.appendChild(e.subMenu),this.element.appendChild(this.content),e.trigger.addEventListener("pointerdown",()=>this.toggle()),document.addEventListener("pointerdown",t=>{this.element.contains(t.target)||this.close()})}open(){this.content.classList.add("open")}close(){this.content.classList.remove("open")}toggle(){this.content.classList.toggle("open")}unwrap(){this.content.classList.remove("sub-menu-content"),this.element.insertAdjacentElement("beforebegin",this.content),this.element.style.display="none"}wrap(){this.content.classList.add("sub-menu-content"),this.element.appendChild(this.content),this.element.style.display="block"}}var ro;class rge extends rS{constructor(t,n="ms-menu-action"){super();De(this,ro,Rt.getLogger(lt.MENU));k(this,"editor");k(this,"id");k(this,"wrapper");k(this,"menuLanguage");k(this,"menuClear");k(this,"menuUndo");k(this,"menuRedo");k(this,"menuConvert");k(this,"guideGaps",[{label:"S",value:"25"},{label:"M",value:"50"},{label:"L",value:"100"},{label:"XL",value:"150"}]);this.id=n,this.editor=t}get model(){return this.editor.model}get isMobile(){return this.editor.renderer.parent.clientWidth<700}createMenuClear(){return this.menuClear=document.createElement("button"),this.menuClear.id=`${this.id}-clear`,this.menuClear.classList.add("ms-menu-button","square"),this.menuClear.innerHTML=`<svg
  width="24px"
  height="24px"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path
    d="M20 9L18.005 20.3463C17.8369 21.3026 17.0062 22 16.0353 22H7.96474C6.99379 22 6.1631 21.3026 5.99496 20.3463L4 9"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
  <path
    d="M21 6L15.375 6M3 6L8.625 6M8.625 6V4C8.625 2.89543 9.52043 2 10.625 2H13.375C14.4796 2 15.375 2.89543 15.375 4V6M8.625 6L15.375 6"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
</svg>
`,this.menuClear.addEventListener("pointerup",()=>{j(this,ro).info(`${this.id}.clear`),this.editor.clear()}),this.menuClear}createMenuLanguage(){const t=document.createElement("button");t.id=`${this.id}-language-trigger`,t.classList.add("ms-menu-button","square"),t.innerHTML=`<svg
  width="24px"
  height="24px"
  stroke-width="1"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path
    d="M2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12Z"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
  <path
    d="M13 2.04932C13 2.04932 16 5.99994 16 11.9999C16 17.9999 13 21.9506 13 21.9506"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
  <path
    d="M11 21.9506C11 21.9506 8 17.9999 8 11.9999C8 5.99994 11 2.04932 11 2.04932"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
  <path d="M2.62964 15.5H21.3704" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
  <path d="M2.62964 8.5H21.3704" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>
`;const n=document.createElement("select");n.classList.add("select-language"),n.id=`${this.id}-language`,ofe(this.editor.configuration).then(o=>{const i=o.result;Object.keys(i).forEach(a=>{const l=a===this.editor.configuration.recognition.lang,c=new Option(i[a],a,l,l);n.appendChild(c)})}),n.addEventListener("change",o=>{j(this,ro).info(`${this.id}.selectLanguage`);const i=o.target.value;this.editor.changeLanguage(i)});const s={trigger:t,subMenu:n,position:"bottom-right"};return this.menuLanguage=new Bs(s),this.menuLanguage.element}createMenuUndo(){return this.menuUndo=document.createElement("button"),this.menuUndo.id=`${this.id}-undo`,this.menuUndo.classList.add("ms-menu-button","square"),this.menuUndo.innerHTML=`<svg
  width="24px"
  height="24px"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path
    d="M4.5 8C8.5 8 11 8 15 8C15 8 15 8 15 8C15 8 20 8 20 12.7059C20 18 15 18 15 18C11.5714 18 9.71429 18 6.28571 18"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
  <path
    d="M7.5 11.5C6.13317 10.1332 5.36683 9.36683 4 8C5.36683 6.63317 6.13317 5.86683 7.5 4.5"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
</svg>
`,this.menuUndo.addEventListener("pointerup",async()=>{j(this,ro).info(`${this.id}.undo`),await this.editor.undo()}),this.menuUndo}createMenuRedo(){return this.menuRedo=document.createElement("button"),this.menuRedo.id=`${this.id}-redo`,this.menuRedo.classList.add("ms-menu-button","square"),this.menuRedo.innerHTML=`<svg
  width="24px"
  height="24px"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path
    d="M19.5 8C15.5 8 13 8 9 8C9 8 9 8 9 8C9 8 4 8 4 12.7059C4 18 9 18 9 18C12.4286 18 14.2857 18 17.7143 18"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
  <path
    d="M16.5 11.5C17.8668 10.1332 18.6332 9.36683 20 8C18.6332 6.63317 17.8668 5.86683 16.5 4.5"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
</svg>
`,this.menuRedo.addEventListener("pointerup",async()=>{j(this,ro).info(`${this.id}.redo`),await this.editor.redo()}),this.menuRedo}createMenuConvert(){return this.menuConvert=document.createElement("button"),this.menuConvert.id=`${this.id}-convert`,this.menuConvert.classList.add("ms-menu-button","square"),this.menuConvert.innerHTML=`<svg
  width="24px"
  height="24px"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path
    d="M2 5H9M16 5H13.5M9 5L13.5 5M9 5V3M13.5 5C12.6795 7.73513 10.9612 10.3206 9 12.5929M4 17.5C5.58541 16.1411 7.376 14.4744 9 12.5929M9 12.5929C8 11.5 6.4 9.3 6 8.5M9 12.5929L12 15.5"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
  <path
    d="M13.5 21L14.6429 18M21.5 21L20.3571 18M14.6429 18L17.5 10.5L20.3571 18M14.6429 18H20.3571"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
</svg>
`,this.menuConvert.addEventListener("pointerup",()=>{j(this,ro).info(`${this.id}.convert`),this.editor.convert()}),this.menuConvert}createMenuGesture(){const t=document.createElement("button");t.id=`${this.id}-gesture`,t.classList.add("ms-menu-button","square"),t.innerHTML=`<svg
  width="24px"
  height="24px"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path
    d="M18 7.5L18.9187 7.65312C20.0497 7.84162 20.791 8.94046 20.5423 10.0598L20.0143 12.4357C20.0048 12.4784 20 12.5223 20 12.5661C20 15.1904 20 17.5 20 17.5C20 17.5 20 17.5 20 17.5C20 19.5 18.4 21.5 16 21.5C14.1259 21.5 11.0119 21.5 9.41979 21.5C8.83594 21.5 8.28132 21.2449 7.90136 20.8016L3.35288 15.495C2.85811 14.9178 2.84375 14.0703 3.31868 13.4767V13.4767C3.93438 12.707 5.09624 12.6814 5.74526 13.4231L8 16V12.5"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
  <path
    d="M9 5L8.20966 5.13172C7.03189 5.32802 6.28739 6.50588 6.61542 7.65395L8 12.5"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
  <path
    d="M11 12.5L8.92263 4.60598C8.69579 3.744 9.25886 2.87352 10.1381 2.72699V2.72699C10.9097 2.59838 11.6523 3.07873 11.8514 3.83526L14 12"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
  <path
    d="M17 12.5L18 7.5L18.2475 6.01515C18.3869 5.17836 17.8216 4.38694 16.9848 4.24747V4.24747C16.16 4.11 15.3767 4.65763 15.2226 5.47955L14 12"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
</svg>
`;const n=document.createElement("div");n.classList.add("ms-menu-colmun");const s=[];for(const a in ei){const l=ei[a];s.push({label:a,value:l})}const o=[];for(const a in Xa){const l=Xa[a];o.push({label:a,value:l})}const i=[];for(const a in Hl){const l=Hl[a];i.push({label:a,value:l})}return[{type:"checkbox",id:`${this.id}-gesture-detect`,label:"Detect gesture",initValue:this.editor.writer.detectGesture,callback:a=>{j(this,ro).info(`${this.id}.gesture-detect`,{value:a}),this.editor.writer.detectGesture=a,this.editor.tool=Pt.Write,this.editor.writer.tool=bt.Pencil}},{type:"select",id:`${this.id}-gesture-surround`,label:"On surround",values:s,initValue:this.editor.gesture.surroundAction,callback:a=>{j(this,ro).info(`${this.id}.gesture-surround`,{value:a}),this.editor.gesture.surroundAction=a,this.editor.tool=Pt.Write,this.editor.writer.tool=bt.Pencil}},{type:"select",id:`${this.id}-gesture-strikethrough`,label:"On strikethrough",values:o,initValue:this.editor.gesture.strikeThroughAction,callback:a=>{j(this,ro).info(`${this.id}.gesture-strikethrough`,{value:a}),this.editor.gesture.strikeThroughAction=a,this.editor.tool=Pt.Write,this.editor.writer.tool=bt.Pencil}},{type:"select",id:`${this.id}-gesture-insert`,label:"On insert",values:i,initValue:this.editor.gesture.insertAction,callback:a=>{j(this,ro).info(`${this.id}.gesture-InsertAction`,{value:a}),this.editor.gesture.insertAction=a,this.editor.tool=Pt.Write,this.editor.writer.tool=bt.Pencil}}].forEach(a=>{n.appendChild(this.createMenuItem(a))}),new Bs({trigger:t,menuTitle:"Gesture",subMenu:n,position:"right-top"}).element}createMenuGuide(){const t=document.createElement("button");t.id=`${this.id}-guide`,t.classList.add("ms-menu-button","square"),t.innerHTML=`<svg
  width="24px"
  height="24px"
  stroke-width="1"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path d="M3 21V3H21V21H3Z" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
  <path d="M3 16.5H12H21" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
  <path d="M3 12H21" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
  <path d="M3 7.5H21" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
  <path d="M16.5 3V12V21" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
  <path d="M12 3V21" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
  <path d="M7.5 3V21" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>
`;const n=document.createElement("div");return n.classList.add("ms-menu-colmun"),[{type:"checkbox",id:`${this.id}-guide-enable`,label:"Show guide",initValue:this.editor.configuration.rendering.guides.enable,callback:s=>{j(this,ro).info(`${this.id}.guide-enable`,{value:s}),this.editor.configuration.rendering.guides.enable=s,this.editor.renderingConfiguration=this.editor.configuration.rendering}},{type:"select",id:`${this.id}-guide-type`,label:"Guide style",values:[{label:"Line",value:"line"},{label:"Grid",value:"grid"},{label:"Point",value:"point"}],initValue:this.editor.configuration.rendering.guides.type,callback:s=>{j(this,ro).info(`${this.id}.guide-type`,{value:s}),this.editor.configuration.rendering.guides.type=s,this.editor.renderingConfiguration=this.editor.configuration.rendering}},{type:"list",id:`${this.id}-guide-size`,label:"Guide style",values:this.guideGaps,initValue:this.editor.configuration.rendering.guides.gap.toString(),callback:s=>{j(this,ro).info(`${this.id}.guide-size`,{value:s}),this.editor.configuration.rendering.guides.gap=+s,this.editor.renderingConfiguration=this.editor.configuration.rendering}}].forEach(s=>{n.appendChild(this.createMenuItem(s))}),new Bs({trigger:t,menuTitle:"Guide",subMenu:n,position:"right-top"}).element}createMenuSnap(){const t=document.createElement("button");t.id=`${this.id}-snap`,t.classList.add("ms-menu-button","square"),t.innerHTML=`<svg
  width="24px"
  height="24px"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path
    d="M 19 14 C 17.8954 14 17 13.1046 17 12 C 17 10.8954 17.8954 10 19 10 C 20.1046 10 21 10.8954 21 12 C 21 13.1046 20.1046 14 19 14 Z"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
  <path d="M 4 12 H 17 M 17 12 L 14 9 M 17 12 L 14 15" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>
`;const n=document.createElement("div");return n.classList.add("ms-menu-colmun"),[{type:"checkbox",id:`${this.id}-snap-to-guide`,label:"Snap to guide",initValue:this.editor.snaps.configuration.guide,callback:s=>this.editor.snaps.configuration.guide=s},{type:"checkbox",id:`${this.id}-snap-to-element`,label:"Snap to element",initValue:this.editor.snaps.configuration.symbol,callback:s=>this.editor.snaps.configuration.symbol=s},{type:"select",id:`${this.id}-snap-angle`,label:"Snap angle",values:[{label:"None",value:"0"},{label:"10°",value:"10"},{label:"30°",value:"30"},{label:"45°",value:"45"},{label:"90°",value:"90"},{label:"180°",value:"180"}],initValue:this.editor.snaps.configuration.angle.toString(),callback:s=>this.editor.snaps.configuration.angle=+s}].forEach(s=>{n.appendChild(this.createMenuItem(s))}),new Bs({trigger:t,menuTitle:"Snap",subMenu:n,position:"right-top"}).element}createMenuDebug(){const t=document.createElement("button");t.id=`${this.id}-debug`,t.classList.add("ms-menu-button","square"),t.innerHTML=`<svg
  width="24px"
  height="24px"
  viewBox="0 0 24 24"
  stroke-width="1"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path
    d="M5.81249 7C5.81249 7 5.35861 7.62759 4.81552 8.66667M18.1875 7C18.1875 7 18.6414 7.62759 19.1845 8.66667M4.81552 8.66667C4.0067 10.2142 3 12.6743 3 15.3333C5.8125 15.3333 7.49999 17 7.49999 17C7.49999 17 8.62499 22 12 22C15.375 22 16.5 17 16.5 17C16.5 17 18.1875 15.3333 21 15.3333C21 12.6743 19.9933 10.2142 19.1845 8.66667M4.81552 8.66667C4.81552 8.66667 1.875 6.44436 4.81552 2C5.81249 2.55556 8.625 4.77778 8.625 4.77778C8.625 4.77778 10.3125 3.66667 12 3.66667C13.6875 3.66667 15.375 4.77778 15.375 4.77778C15.375 4.77778 18.1875 2.55556 19.3125 2C22.125 6.44456 19.1845 8.66667 19.1845 8.66667"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
  <path d="M11 18L12 18M13 18L12 18M12 18L12 19" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
  <path d="M8.5 12.5L10 14" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
  <path d="M15.5 12.5L14 14" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>
`;const n=[{type:"checkbox",id:`${this.id}-debug-bounding-box`,label:"Show bounding box",initValue:this.editor.svgDebugger.boundingBoxVisibility,callback:o=>this.editor.svgDebugger.boundingBoxVisibility=o},{type:"checkbox",id:`${this.id}-debug-recognition-box`,label:"Show recognition box",initValue:this.editor.svgDebugger.recognitionBoxVisibility,callback:o=>this.editor.svgDebugger.recognitionBoxVisibility=o},{type:"checkbox",id:`${this.id}-debug-bounding-item-box`,label:"Show recognition item box",initValue:this.editor.svgDebugger.recognitionItemBoxVisibility,callback:o=>this.editor.svgDebugger.recognitionItemBoxVisibility=o},{type:"checkbox",id:`${this.id}-debug-snap-points`,label:"Show snap points",initValue:this.editor.svgDebugger.snapPointsVisibility,callback:o=>this.editor.svgDebugger.snapPointsVisibility=o},{type:"checkbox",id:`${this.id}-debug-vertices`,label:"Show vertices",initValue:this.editor.svgDebugger.verticesVisibility,callback:o=>this.editor.svgDebugger.verticesVisibility=o}],s=document.createElement("div");return s.classList.add("ms-menu-colmun"),n.forEach(o=>{s.appendChild(this.createMenuItem(o))}),new Bs({trigger:t,menuTitle:"Debug",subMenu:s,position:"right-top"}).element}createMenuExport(){const t=document.createElement("button");t.id=`${this.id}-export`,t.classList.add("ms-menu-button","square"),t.innerHTML=`<svg
  width="24px"
  height="24px"
  stroke-width="1"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="#000000"
>
  <path d="M6 20L18 20" stroke="#000000" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
  <path d="M12 4V16M12 16L15.5 12.5M12 16L8.5 12.5" stroke="#000000" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>
`;const n=[{type:"button",id:`${this.id}-export-json`,label:"json",callback:()=>{this.editor.downloadAsJson()}},{type:"button",id:`${this.id}-export-svg`,label:"svg",callback:()=>{this.editor.downloadAsSVG()}},{type:"button",id:`${this.id}-export-png`,label:"png",callback:()=>{this.editor.downloadAsPNG()}}],s=document.createElement("div");return s.classList.add("ms-menu-colmun"),n.forEach(o=>{s.appendChild(this.createMenuItem(o))}),new Bs({trigger:t,menuTitle:"Export",subMenu:s,position:"right-top"}).element}async readFileAsText(t){return new Promise((n,s)=>{const o=new FileReader;o.onerror=s,o.onload=()=>{n(o.result)},t&&o.readAsText(t)})}createMenuImport(){const t=document.createElement("button");t.id=`${this.id}-import`,t.classList.add("ms-menu-button","square"),t.innerHTML=`<svg
  width="24px"
  height="24px"
  stroke-width="1"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="#000000"
>
  <path d="M6 20L18 20" stroke="#000000" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
  <path d="M12 16V4M12 4L15.5 7.5M12 4L8.5 7.5" stroke="#000000" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>
`;const n=document.createElement("div");n.classList.add("ms-menu-colmun");const s=document.createElement("input");s.type="file",s.accept=".json",s.multiple=!1,s.addEventListener("change",()=>{var i;o.disabled=!((i=s.files)!=null&&i.length)}),n.appendChild(s);const o=document.createElement("button");return o.classList.add("ms-menu-button"),o.innerText="Import",o.disabled=!0,n.appendChild(o),o.addEventListener("pointerup",async i=>{var a;if(i.preventDefault(),i.stopPropagation(),(a=s.files)==null?void 0:a.length){const l=await this.readFileAsText(s.files[0]),c=JSON.parse(l);await this.editor.createSymbols(c),s.value="",o.disabled=!0}}),new Bs({trigger:t,menuTitle:"Import",subMenu:n,position:"right-top"}).element}unselectAll(){var t;(t=this.wrapper)==null||t.querySelectorAll("*").forEach(n=>n.classList.remove("active"))}closeAllSubMenu(){var t;(t=this.wrapper)==null||t.querySelectorAll(".open").forEach(n=>n.classList.remove("open"))}render(t){if(this.editor.configuration.menu.action.enable){const n=document.createElement("button");n.id=this.id,n.classList.add("ms-menu-button","square"),n.innerHTML=`<svg
  width="24px"
  height="24px"
  stroke-width="1"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path d="M3 5H21" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
  <path d="M3 12H21" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
  <path d="M3 19H21" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>
`;const s=document.createElement("div");s.classList.add("ms-menu-colmun"),s.appendChild(this.createMenuGesture()),s.appendChild(this.createMenuGuide()),s.appendChild(this.createMenuSnap()),s.appendChild(this.createMenuDebug()),s.appendChild(this.createMenuImport()),s.appendChild(this.createMenuExport()),this.wrapper=document.createElement("div"),this.wrapper.classList.add("ms-menu","ms-menu-top-left","ms-menu-row"),this.wrapper.appendChild(new Bs({trigger:n,subMenu:s,position:"bottom"}).element),this.wrapper.appendChild(this.createMenuLanguage()),this.wrapper.appendChild(this.createMenuClear()),this.wrapper.appendChild(this.createMenuUndo()),this.wrapper.appendChild(this.createMenuRedo()),this.wrapper.appendChild(this.createMenuConvert()),t.appendChild(this.wrapper),this.update(),this.show()}}update(){this.menuLanguage&&(this.isMobile?this.menuLanguage.wrap():this.menuLanguage.unwrap()),this.menuClear&&(this.menuClear.disabled=this.editor.history.context.empty),this.menuUndo&&(this.menuUndo.disabled=!this.editor.history.context.canUndo),this.menuRedo&&(this.menuRedo.disabled=!this.editor.history.context.canRedo),this.menuConvert&&(this.menuConvert.disabled=!this.editor.extractStrokesFromSymbols(this.model.symbols).length)}show(){this.wrapper&&(this.wrapper.style.visibility="visible")}hide(){this.wrapper&&(this.wrapper.style.visibility="hidden")}destroy(){if(this.wrapper){for(;this.wrapper.lastChild;)this.wrapper.removeChild(this.wrapper.lastChild);this.wrapper.remove(),this.wrapper=void 0,this.menuClear=void 0,this.menuUndo=void 0,this.menuRedo=void 0,this.menuConvert=void 0}}}ro=new WeakMap;var SO=`<svg
  width="24px"
  height="24px"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path
    d="M 21 5 V 17.986 C 21 19 21 19 20 19 H 4 C 3 19 3 19 3.015 17.986 V 5 C 3 4 3 4 4 4 H 20.4 C 21 4 21 4 21 5 Z"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
</svg>
`,xO=`<svg
  width="24px"
  height="24px"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path d="M3 20L21 4" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>
`,R0;class sge extends rS{constructor(t,n="ms-menu-tool"){super();De(this,R0,Rt.getLogger(lt.MENU));k(this,"editor");k(this,"id");k(this,"wrapper");k(this,"writeBtn");k(this,"menuSelect");k(this,"menuMove");k(this,"menuErase");k(this,"menuShape");k(this,"subMenuShape");k(this,"menuEdge");k(this,"subMenuEdge");this.id=n,j(this,R0).info("constructor"),this.editor=t}createMenuWrite(){return this.writeBtn=document.createElement("button"),this.writeBtn.id=`${this.id}-write-pencil`,this.writeBtn.classList.add("ms-menu-button","square"),this.writeBtn.innerHTML=`<svg
  width="24px"
  height="24px"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path
    d="M14.3632 5.65156L15.8431 4.17157C16.6242 3.39052 17.8905 3.39052 18.6716 4.17157L20.0858 5.58579C20.8668 6.36683 20.8668 7.63316 20.0858 8.41421L18.6058 9.8942M14.3632 5.65156L4.74749 15.2672C4.41542 15.5993 4.21079 16.0376 4.16947 16.5054L3.92738 19.2459C3.87261 19.8659 4.39148 20.3848 5.0115 20.33L7.75191 20.0879C8.21972 20.0466 8.65806 19.8419 8.99013 19.5099L18.6058 9.8942M14.3632 5.65156L18.6058 9.8942"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
</svg>
`,this.writeBtn.addEventListener("pointerup",()=>{this.unselectAll(),this.writeBtn.classList.add("active"),this.editor.tool=Pt.Write,this.editor.writer.tool=bt.Pencil}),this.writeBtn}createMenuMove(){return this.menuMove=document.createElement("button"),this.menuMove.id=`${this.id}-move`,this.menuMove.classList.add("ms-menu-button","square"),this.menuMove.innerHTML=`<svg
  width="24px"
  height="24px"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path
    d="M7 10.5L4.99591 13.1721C4.41845 13.9421 4.47127 15.0141 5.1216 15.7236L8.9055 19.8515C9.28432 20.2647 9.81826 20.5 10.3789 20.5C11.4651 20.5 13.2415 20.5 15 20.5C17.4 20.5 19 19 19 16.5C19 16.5 19 16.5 19 16.5C19 16.5 19 9.64287 19 7.92859"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
  <path
    d="M16 8.49995C16 8.49995 16 8.37483 16 7.92852C16 5.6428 19 5.6428 19 7.92852"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
  <path
    d="M13 8.50008C13 8.50008 13 7.91978 13 7.02715M13 6.50008C13 6.50008 13 6.804 13 7.02715M16 8.50008C16 8.50008 16 8.37496 16 7.92865C16 7.70549 16 7.25031 16 7.02715C16 4.74144 13 4.74144 13 7.02715"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
  <path
    d="M13 8.50008C13 8.50008 13 7.91978 13 7.02715C13 4.74144 16 4.74144 16 7.02715C16 7.25031 16 7.70549 16 7.92865C16 8.37496 16 8.50008 16 8.50008"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
  <path
    d="M10 8.50005C10 8.50005 10 7.85719 10 6.50005C10 4.21434 13 4.21434 13 6.50005C13 6.50005 13 6.50005 13 6.50005C13 6.50005 13 6.80397 13 7.02713C13 7.91975 13 8.50005 13 8.50005"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
  <path
    d="M7 13.5001V6.50006C7 5.67164 7.67157 5.00006 8.5 5.00006V5.00006C9.32843 5.00006 10 5.55527 10 6.38369C10 6.42151 10 6.4603 10 6.50006C10 7.85721 10 8.50006 10 8.50006"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
</svg>
`,this.menuMove.addEventListener("pointerup",()=>{this.unselectAll(),this.menuMove.classList.add("active"),this.editor.tool=Pt.Move}),this.menuMove}createMenuSelect(){return this.menuSelect=document.createElement("button"),this.menuSelect.id=`${this.id}-select`,this.menuSelect.classList.add("ms-menu-button","square"),this.menuSelect.innerHTML=`<svg
  width="24px"
  height="24px"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path
    d="M4.9984 2H2V4.9984H4.9984V2Z"
    stroke="currentColor"
    stroke-width="1"
    stroke-miterlimit="1.5"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
  <path
    d="M4.99854 3.50098H18.9987"
    stroke="currentColor"
    stroke-width="1"
    stroke-miterlimit="1.5"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
  <path d="M3.5 4.99854V19.0005" stroke="currentColor" stroke-width="1" stroke-miterlimit="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
  <path d="M20.4978 5V19.002" stroke="currentColor" stroke-width="1" stroke-miterlimit="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
  <path d="M4.99854 20.501H18.9987" stroke="currentColor" stroke-width="1" stroke-miterlimit="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
  <path
    d="M4.9984 19H2V21.9984H4.9984V19Z"
    stroke="currentColor"
    stroke-width="1"
    stroke-miterlimit="1.5"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
  <path
    d="M21.9974 2.00195H18.999V5.00035H21.9974V2.00195Z"
    stroke="currentColor"
    stroke-width="1"
    stroke-miterlimit="1.5"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
  <path
    d="M21.9974 19.002H18.999V22.0004H21.9974V19.002Z"
    stroke="currentColor"
    stroke-width="1"
    stroke-miterlimit="1.5"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M10.9966 15.002L7.99658 8.00195L14.9966 11.002L11.9986 12.0009L10.9966 15.002Z"
    stroke="currentColor"
    stroke-width="1"
    stroke-miterlimit="1.5"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
  <path
    fill-rule="evenodd"
    clip-rule="evenodd"
    d="M11.999 12.002L14.997 15.002L11.999 12.002Z"
    stroke="currentColor"
    stroke-width="1"
    stroke-miterlimit="1.5"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
</svg>
`,this.menuSelect.addEventListener("pointerup",()=>{this.unselectAll(),this.menuSelect.classList.add("active"),this.editor.tool=Pt.Select}),this.menuSelect}createMenuErase(){return this.menuErase=document.createElement("button"),this.menuErase.id=`${this.id}-erase`,this.menuErase.classList.add("ms-menu-button","square"),this.menuErase.innerHTML=`<svg
  width="24px"
  height="24px"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path d="M21 21L9 21" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
  <path d="M15.889 14.8891L8.46436 7.46448" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
  <path
    d="M2.8934 12.6066L12.0858 3.41421C12.8668 2.63317 14.1332 2.63317 14.9142 3.41421L19.864 8.36396C20.645 9.14501 20.645 10.4113 19.864 11.1924L10.6213 20.435C10.2596 20.7968 9.76894 21 9.25736 21C8.74577 21 8.25514 20.7968 7.8934 20.435L2.8934 15.435C2.11235 14.654 2.11235 13.3877 2.8934 12.6066Z"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
</svg>
`,this.menuErase.addEventListener("pointerup",()=>{this.unselectAll(),this.menuErase.classList.add("active"),this.editor.tool=Pt.Erase}),this.menuErase}createShapeSubMenu(t,n){const s=document.createElement("button");return s.id=`${this.id}-write-shape-${n}`,s.classList.add("ms-menu-button","square"),s.innerHTML=t,s.addEventListener("pointerup",()=>{this.unselectAll(),this.editor.tool=Pt.Write,this.editor.writer.tool=n,s.classList.add("active"),this.menuShape.innerHTML=t,this.menuShape.classList.add("active");const o=this.menuShape.nextSibling;o&&o.classList.remove("open")}),s}createMenuShape(){this.menuShape=document.createElement("button"),this.menuShape.id=`${this.id}-write-shape`,this.menuShape.classList.add("ms-menu-button","square"),this.menuShape.innerHTML=SO,this.subMenuShape={circle:this.createShapeSubMenu(`<svg
  width="24px"
  height="24px"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path
    d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
</svg>
`,bt.Circle),rectangle:this.createShapeSubMenu(SO,bt.Rectangle),triangle:this.createShapeSubMenu(`<svg
  width="24px"
  height="24px"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path
    d="M11.4752 2.94682C11.7037 2.53464 12.2963 2.53464 12.5248 2.94682L21.8985 19.8591C22.1202 20.259 21.831 20.75 21.3738 20.75H2.62625C2.16902 20.75 1.87981 20.259 2.10146 19.8591L11.4752 2.94682Z"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
</svg>
`,bt.Triangle),ellipse:this.createShapeSubMenu(`<svg
  width="24px"
  height="24px"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path
    d="M 12 19 C 18 19 22 17 22 12 C 22 7 18 5 12 5 C 6 5 2 7 2 12 C 2 17 6 19 12 19 Z"
    stroke="currentColor"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
</svg>
`,bt.Ellipse),rhombus:this.createShapeSubMenu(`<svg
  width="24px"
  height="24px"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path
    d="M11.5757 1.42426C11.81 1.18995 12.1899 1.18995 12.4243 1.42426L22.5757 11.5757C22.81 11.81 22.8101 12.1899 22.5757 12.4243L12.4243 22.5757C12.19 22.81 11.8101 22.8101 11.5757 22.5757L1.42426 12.4243C1.18995 12.19 1.18995 11.8101 1.42426 11.5757L11.5757 1.42426Z"
    stroke="#000000"
    stroke-width="1"
    stroke-linecap="round"
    stroke-linejoin="round"
  ></path>
</svg>
`,bt.Rhombus)};const t=document.createElement("div");t.id=`${this.id}-write-shape-list`,t.classList.add("ms-menu-row","sub-menu-content-shape"),t.appendChild(this.subMenuShape.rectangle),t.appendChild(this.subMenuShape.circle),t.appendChild(this.subMenuShape.ellipse),t.appendChild(this.subMenuShape.triangle),t.appendChild(this.subMenuShape.rhombus);const n={trigger:this.menuShape,subMenu:t,position:"top"};return new Bs(n).element}createEdgeSubMenu(t,n){const s=document.createElement("button");return s.id=`${this.id}-write-edge-${n}`,s.classList.add("ms-menu-button","square"),s.innerHTML=t,s.addEventListener("pointerup",()=>{this.unselectAll(),this.editor.tool=Pt.Write,this.editor.writer.tool=n,s.classList.add("active"),this.menuEdge.innerHTML=t,this.menuEdge.classList.add("active");const o=this.menuEdge.nextSibling;o&&o.classList.remove("open")}),s}createMenuEdge(){this.menuEdge=document.createElement("button"),this.menuEdge.id=`${this.id}-write-edge`,this.menuEdge.classList.add("ms-menu-button","square"),this.menuEdge.innerHTML=xO,this.subMenuEdge={line:this.createEdgeSubMenu(xO,bt.Line),arrow:this.createEdgeSubMenu(`<svg
  width="24px"
  height="24px"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path d="M3 20L21 4" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
  <path d="M15 5L21 4L 20 10" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>
`,bt.Arrow),doubleArrow:this.createEdgeSubMenu(`<svg
  width="24px"
  height="24px"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path d="M3 20L21 4" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
  <path d="M9 19L3 20L 4 14" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
  <path d="M15 5L21 4L 20 10" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>
`,bt.DoubleArrow)};const t=document.createElement("div");t.id=`${this.id}-write-edge-list`,t.classList.add("ms-menu-row","sub-menu-content-edge"),t.appendChild(this.subMenuEdge.line),t.appendChild(this.subMenuEdge.arrow),t.appendChild(this.subMenuEdge.doubleArrow);const n={trigger:this.menuEdge,subMenu:t,position:"top"};return new Bs(n).element}unselectAll(){var t;(t=this.wrapper)==null||t.querySelectorAll("*").forEach(n=>n.classList.remove("active"))}update(){var t,n,s,o,i,a,l,c,u,p,f,m,v,b,S,C,E,T,w,M,R,D,N,z,L;switch(this.unselectAll(),this.editor.tool){case Pt.Erase:(t=this.menuErase)==null||t.classList.add("active");break;case Pt.Move:(n=this.menuMove)==null||n.classList.add("active");break;case Pt.Select:(s=this.menuSelect)==null||s.classList.add("active");break;case Pt.Write:switch(this.editor.writer.tool){case bt.Circle:(o=this.menuShape)==null||o.classList.add("active"),(a=(i=this.subMenuShape)==null?void 0:i.circle)==null||a.classList.add("active");break;case bt.Ellipse:(l=this.menuShape)==null||l.classList.add("active"),(u=(c=this.subMenuShape)==null?void 0:c.ellipse)==null||u.classList.add("active");break;case bt.Triangle:(p=this.menuShape)==null||p.classList.add("active"),(m=(f=this.subMenuShape)==null?void 0:f.triangle)==null||m.classList.add("active");break;case bt.Rectangle:(v=this.menuShape)==null||v.classList.add("active"),(S=(b=this.subMenuShape)==null?void 0:b.rectangle)==null||S.classList.add("active");break;case bt.Line:(C=this.menuEdge)==null||C.classList.add("active"),(T=(E=this.subMenuEdge)==null?void 0:E.line)==null||T.classList.add("active");break;case bt.Arrow:(w=this.menuEdge)==null||w.classList.add("active"),(R=(M=this.subMenuEdge)==null?void 0:M.arrow)==null||R.classList.add("active");break;case bt.DoubleArrow:(D=this.menuEdge)==null||D.classList.add("active"),(z=(N=this.subMenuEdge)==null?void 0:N.doubleArrow)==null||z.classList.add("active");break;default:(L=this.writeBtn)==null||L.classList.add("active")}}}render(t){this.editor.configuration.menu.tool.enable&&(this.wrapper=document.createElement("div"),this.wrapper.classList.add("ms-menu","ms-menu-bottom","ms-menu-row"),this.wrapper.appendChild(this.createMenuWrite()),this.wrapper.appendChild(this.createMenuMove()),this.wrapper.appendChild(this.createMenuSelect()),this.wrapper.appendChild(this.createMenuErase()),this.wrapper.appendChild(this.createMenuEdge()),this.wrapper.appendChild(this.createMenuShape()),t.appendChild(this.wrapper),this.update(),this.show())}show(){this.wrapper&&(this.wrapper.style.visibility="visible")}hide(){this.wrapper&&(this.wrapper.style.visibility="hidden")}destroy(){if(this.wrapper){for(;this.wrapper.lastChild;)this.wrapper.removeChild(this.wrapper.lastChild);this.wrapper.remove(),this.writeBtn=void 0,this.menuSelect=void 0,this.menuMove=void 0,this.menuErase=void 0,this.menuShape=void 0,this.subMenuShape=void 0,this.menuEdge=void 0,this.subMenuEdge=void 0,this.wrapper=void 0}}}R0=new WeakMap;var D0;class oge extends rS{constructor(t,n="ms-menu-style"){super();De(this,D0,Rt.getLogger(lt.MENU));k(this,"editor");k(this,"id");k(this,"wrapper");k(this,"subMenu");k(this,"triggerBtn");k(this,"menuColorStroke");k(this,"menuColorFill");k(this,"menuThickness");k(this,"menuFontSize");k(this,"menuFontWeight");k(this,"menuStrokeOpacity");this.id=n,j(this,D0).info("constructor"),this.editor=t}get model(){return this.editor.model}get symbolsSelected(){return this.model.symbolsSelected}get writeShape(){return![bt.Arrow,bt.DoubleArrow,bt.Line,bt.Pencil].includes(this.editor.writer.tool)}get rowHeight(){return this.editor.configuration.rendering.guides.gap}get isMobile(){return this.editor.renderer.parent.clientWidth<700}createMenuStroke(){var i,a;const t=this.symbolsSelected.map(l=>l.style),n=t.length&&t.every(l=>{var c;return l.color===((c=t[0])==null?void 0:c.color)})&&((i=t[0])!=null&&i.color)?(a=t[0])==null?void 0:a.color:this.editor.penStyle.color,s={type:"colors",label:"Colors",id:`${this.id}-color`,fill:!1,values:this.colors,initValue:n,callback:l=>{this.editor.penStyle={color:l},this.editor.updateSymbolsStyle(this.symbolsSelected.map(c=>c.id),{color:l})}},o=this.createColorList(s);return this.menuColorStroke=this.createWrapCollapsible(o,"Colors"),this.menuColorStroke.id=`${this.id}-color`,this.menuColorStroke}createMenuColorFill(){const t=this.symbolsSelected.map(i=>i.style),n=t.length&&t.every(i=>{var a;return i.color===((a=t[0])==null?void 0:a.color)})&&t[0].color?t[0].color:this.editor.penStyle.color,s={type:"colors",label:"Fill",id:`${this.id}-fill`,fill:!0,values:this.colors,initValue:n,callback:i=>{this.editor.penStyle={fill:i},this.editor.updateSymbolsStyle(this.symbolsSelected.map(a=>a.id),{fill:i})}},o=this.createColorList(s);return this.menuColorFill=this.createWrapCollapsible(o,"Fill"),this.menuColorFill.id=`${this.id}-fill`,this.menuColorFill}createMenuThickness(){const t=document.createElement("div");t.id=`${this.id}-thickness-list`,t.classList.add("ms-menu-row","thickness-list");const n=this.symbolsSelected.map(o=>o.style),s=n.length&&n.every(o=>o.width===n[0].width)?n[0].width:this.editor.penStyle.width;return this.thicknessList.forEach(o=>{const i=document.createElement("button");i.id=`${this.id}-thickness-${o.label}-btn`,i.classList.add("ms-menu-button","square"),i.textContent=o.label,s===o.value&&i.classList.add("active"),i.addEventListener("pointerup",a=>{a.preventDefault(),a.stopPropagation(),this.editor.penStyle={width:o.value},t.querySelectorAll("*").forEach(l=>l.classList.remove("active")),i.classList.add("active"),this.symbolsSelected.length&&(this.editor.updateSymbolsStyle(this.symbolsSelected.map(l=>l.id),{width:o.value}),this.editor.selector.resetSelectedGroup(this.symbolsSelected))}),t.appendChild(i)}),this.menuThickness=this.createWrapCollapsible(t,"Thickness"),this.menuThickness.id=`${this.id}-thickness`,this.menuThickness}createMenuFontSize(){const t=document.createElement("div");return t.id=`${this.id}-font-size-list`,t.classList.add("ms-menu-row","font-size-list"),this.fontSizeList.forEach(n=>{const s=document.createElement("button");s.id=`${this.id}-font-size-${n.label}-btn`,s.classList.add("ms-menu-button","square"),s.textContent=n.label,this.editor.configuration.fontStyle.size===n.value&&s.classList.add("active"),s.addEventListener("pointerup",o=>{if(o.preventDefault(),o.stopPropagation(),t.querySelectorAll("*").forEach(i=>i.classList.remove("active")),s.classList.add("active"),n.value==="auto")this.editor.configuration.fontStyle.size="auto";else{const i=n.value;this.editor.configuration.fontStyle.size=i;const a=this.symbolsSelected.filter(l=>l.type===oe.Text||l.type===oe.Group&&l.extractText().length);this.editor.updateTextFontStyle(a.map(l=>l.id),{fontSize:i*this.rowHeight}),this.editor.selector.resetSelectedGroup(this.symbolsSelected)}}),t.appendChild(s)}),this.menuFontSize=this.createWrapCollapsible(t,"Font size"),this.menuFontSize.id=`${this.id}-font-size`,this.menuFontSize}createMenuFontWeight(){const t=document.createElement("div");return t.id=`${this.id}-font-weight-list`,t.classList.add("ms-menu-row","font-weight-list"),this.fontWeightList.forEach(n=>{const s=document.createElement("button");s.id=`${this.id}-font-weight-${n.label}-btn`,s.classList.add("ms-menu-button","center"),s.textContent=n.label,this.editor.configuration.fontStyle.weight===n.value&&s.classList.add("active"),s.addEventListener("pointerup",o=>{if(o.preventDefault(),o.stopPropagation(),t.querySelectorAll("*").forEach(i=>i.classList.remove("active")),s.classList.add("active"),this.editor.configuration.fontStyle.weight=n.value,this.editor.configuration.fontStyle.weight!=="auto"){const i=this.symbolsSelected.filter(a=>a.type===oe.Text||a.type===oe.Group&&a.extractText().length);this.editor.updateTextFontStyle(i.map(a=>a.id),{fontWeight:this.editor.configuration.fontStyle.weight}),this.editor.selector.resetSelectedGroup(this.symbolsSelected)}}),t.appendChild(s)}),this.menuFontWeight=this.createWrapCollapsible(t,"Font weight"),this.menuFontWeight.id=`${this.id}-font-weight`,this.menuFontWeight}createMenuOpacity(){var a,l;const t=this.symbolsSelected.map(c=>c.style),n=100*(t.length&&t.every(c=>{var u;return c.opacity===((u=t[0])==null?void 0:u.opacity)})&&((a=t[0])!=null&&a.opacity)?(l=t[0])==null?void 0:l.opacity:this.editor.penStyle.opacity||1),s=document.createElement("div");s.id=`${this.id}-opacity-input-wrapper`;const o=document.createElement("input");o.id=`${this.id}-opacity-input`,o.setAttribute("name","opacity"),o.setAttribute("type","range"),o.setAttribute("step","1"),o.setAttribute("min","1"),o.setAttribute("max","100"),s.appendChild(o);const i=document.createElement("output");return i.setAttribute("for","opacity"),i.innerHTML=n?`${n}`:"-",s.appendChild(i),n&&o.setAttribute("value",n.toString()),o.addEventListener("input",c=>{const u=c.target.value;i.innerHTML=`${u}%`,this.editor.penStyle={opacity:u/100},this.symbolsSelected.length&&this.editor.updateSymbolsStyle(this.symbolsSelected.map(p=>p.id),{opacity:u/100})}),this.menuStrokeOpacity=this.createWrapCollapsible(s,"Opacity"),this.menuStrokeOpacity.id=`${this.id}-opacity`,this.menuStrokeOpacity}render(t){if(this.editor.configuration.menu.style.enable){this.triggerBtn=document.createElement("button"),this.triggerBtn.id=this.id,this.triggerBtn.classList.add("ms-menu-button","square"),this.triggerBtn.innerHTML=`<svg
  width="24px"
  height="24px"
  stroke-width="1"
  viewBox="0 0 24 24"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
  color="currentColor"
>
  <path
    d="M20.5096 9.54C20.4243 9.77932 20.2918 9.99909 20.12 10.1863C19.9483 10.3735 19.7407 10.5244 19.5096 10.63C18.2796 11.1806 17.2346 12.0745 16.5002 13.2045C15.7659 14.3345 15.3733 15.6524 15.3696 17C15.3711 17.4701 15.418 17.9389 15.5096 18.4C15.5707 18.6818 15.5747 18.973 15.5215 19.2564C15.4682 19.5397 15.3588 19.8096 15.1996 20.05C15.0649 20.2604 14.8877 20.4403 14.6793 20.5781C14.4709 20.7158 14.2359 20.8085 13.9896 20.85C13.4554 20.9504 12.9131 21.0006 12.3696 21C11.1638 21.0006 9.97011 20.7588 8.85952 20.2891C7.74893 19.8194 6.74405 19.1314 5.90455 18.2657C5.06506 17.4001 4.40807 16.3747 3.97261 15.2502C3.53714 14.1257 3.33208 12.9252 3.36959 11.72C3.4472 9.47279 4.3586 7.33495 5.92622 5.72296C7.49385 4.11097 9.60542 3.14028 11.8496 3H12.3596C14.0353 3.00042 15.6777 3.46869 17.1017 4.35207C18.5257 5.23544 19.6748 6.49885 20.4196 8C20.6488 8.47498 20.6812 9.02129 20.5096 9.52V9.54Z"
    stroke="currentColor"
    stroke-width="1"
  ></path>
  <path d="M8 16.01L8.01 15.9989" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
  <path d="M6 12.01L6.01 11.9989" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
  <path d="M8 8.01L8.01 7.99889" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
  <path d="M12 6.01L12.01 5.99889" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
  <path d="M16 8.01L16.01 7.99889" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>
`;const n=document.createElement("div");n.classList.add("ms-menu-colmun"),n.appendChild(this.createMenuStroke()),n.appendChild(this.createMenuColorFill()),n.appendChild(this.createMenuThickness()),n.appendChild(this.createMenuFontSize()),n.appendChild(this.createMenuFontWeight()),n.appendChild(this.createMenuOpacity());const s={trigger:this.triggerBtn,subMenu:n,position:"bottom-left"};this.subMenu=new Bs(s),this.wrapper=document.createElement("div"),this.wrapper.classList.add("ms-menu","ms-menu-top-right"),this.wrapper.appendChild(this.subMenu.element),t.appendChild(this.wrapper),this.update()}}update(){if(this.subMenu&&(this.isMobile?this.subMenu.wrap():this.subMenu.unwrap()),this.editor.tool===Pt.Write)this.show(),this.menuColorStroke&&(this.menuColorStroke.style.display="block"),this.menuColorFill&&(this.menuColorFill.style.display=this.writeShape?"block":"none"),this.menuThickness&&(this.menuThickness.style.display="block"),this.menuFontSize&&(this.menuFontSize.style.display="block"),this.menuFontWeight&&(this.menuFontWeight.style.display="block"),this.menuStrokeOpacity&&(this.menuStrokeOpacity.style.display="block");else if(this.editor.tool===Pt.Select){if(this.show(),this.menuColorStroke&&(this.menuColorStroke.style.display="block"),this.menuColorFill){const t=this.model.symbolsSelected.length&&this.model.symbolsSelected.some(n=>n.type===oe.Shape);this.menuColorFill.style.display=t?"block":"none"}this.menuThickness&&(this.menuThickness.style.display="block"),this.menuFontSize&&(this.menuFontSize.style.display="block"),this.menuFontWeight&&(this.menuFontWeight.style.display="block"),this.menuStrokeOpacity&&(this.menuStrokeOpacity.style.display="block")}else this.hide()}show(){this.wrapper&&(this.wrapper.style.visibility="visible")}hide(){this.wrapper&&(this.wrapper.style.visibility="hidden")}destroy(){if(this.wrapper){for(;this.wrapper.lastChild;)this.wrapper.removeChild(this.wrapper.lastChild);this.wrapper.remove(),this.wrapper=void 0,this.subMenu=void 0,this.triggerBtn=void 0,this.menuColorStroke=void 0,this.menuColorFill=void 0,this.menuThickness=void 0,this.menuFontSize=void 0,this.menuFontWeight=void 0,this.menuStrokeOpacity=void 0}}}D0=new WeakMap;var O0;class ige extends rS{constructor(t,n="ms-menu-context"){super();De(this,O0,Rt.getLogger(lt.MENU));k(this,"editor");k(this,"id");k(this,"wrapper");k(this,"editMenu");k(this,"editInput");k(this,"editSaveBtn");k(this,"reorderMenu");k(this,"decoratorMenu");k(this,"menuExport");k(this,"duplicateBtn");k(this,"groupBtn");k(this,"convertBtn");k(this,"removeBtn");k(this,"position");this.id=n,j(this,O0).info("constructor"),this.editor=t,this.position={x:0,y:0,scrollLeft:0,scrollTop:0}}get symbolsSelected(){return this.editor.model.symbolsSelected}get haveSymbolsSelected(){return this.symbolsSelected.length>0}get symbolsDecorable(){return this.symbolsSelected.filter(t=>[oe.Stroke,oe.Text,oe.Group].includes(t.type)||t.type===oe.Recognized&&t.kind===jn.Text)}get showDecorator(){return this.symbolsDecorable.length>0}createMenuEdit(){const t=document.createElement("button");t.id=`${this.id}-edit-trigger`,t.classList.add("ms-menu-button");const n=document.createElement("span");n.innerText="Edit",t.appendChild(n);const s=document.createElement("span");s.style.setProperty("width","32px"),s.style.setProperty("transform","rotate(270deg)"),s.innerHTML=fh,t.appendChild(s);const o=document.createElement("div");o.classList.add("ms-menu-colmun"),this.editInput=document.createElement("input"),o.appendChild(this.editInput),this.editSaveBtn=document.createElement("button"),this.editSaveBtn.classList.add("ms-menu-button"),this.editSaveBtn.innerText="Save",o.appendChild(this.editSaveBtn),this.editSaveBtn.addEventListener("pointerdown",async a=>{a.stopPropagation();const l=this.editor.model.symbolsSelected.find(c=>c.type===oe.Text);if(l){const c=l.chars[0];l.chars=[];for(let u=0;u<this.editInput.value.length;u++)l.chars.push({label:this.editInput.value.charAt(u),id:zo(),color:c.color,fontSize:c.fontSize,fontWeight:c.fontWeight,bounds:c.bounds});await this.editor.updateSymbol(l),this.editor.selector.resetSelectedGroup([l])}});const i={trigger:t,subMenu:o,position:"right"};return this.editMenu=new Bs(i).element,this.editMenu}createMenuDuplicate(){return this.duplicateBtn=document.createElement("button"),this.duplicateBtn.id=`${this.id}-duplicate`,this.duplicateBtn.textContent="Duplicate",this.duplicateBtn.classList.add("ms-menu-button"),this.duplicateBtn.addEventListener("pointerup",async()=>{const t=this.symbolsSelected,n=o=>{o.children.forEach(i=>{switch(i.id=i.id.slice(0,-36)+`-${zo()}`,i.type){case oe.Group:n(i);break;case oe.Recognized:i.strokes.forEach(a=>a.id=a.id.slice(0,-36)+`-${zo()}`)}})},s=t.map(o=>{const i=o.clone();for(;this.editor.model.symbols.find(a=>a.id===i.id);)i.id=i.id.slice(0,-36)+`-${zo()}`,i.type===oe.Group?n(i):i.type===oe.Recognized&&i.strokes.forEach(a=>a.id=a.id.slice(0,-36)+`-${zo()}`);return i.selected=!0,this.editor.translator.applyToSymbol(i,zs,zs),i});this.editor.unselectAll(),await this.editor.addSymbols(s),this.editor.selector.drawSelectedGroup(s)}),this.duplicateBtn}createMenuGroup(){return this.groupBtn=document.createElement("button"),this.groupBtn.id=`${this.id}-duplicate`,this.groupBtn.textContent="Group",this.groupBtn.classList.add("ms-menu-button"),this.groupBtn.addEventListener("pointerup",async()=>{if(this.symbolsSelected.length===1&&this.symbolsSelected[0].type===oe.Group){const t=this.editor.ungroupSymbol(this.symbolsSelected[0]);this.editor.select(t.map(n=>n.id))}else{const t=this.symbolsSelected.slice();this.editor.unselectAll();const n=this.editor.groupSymbols(t);n.selected=!0,this.editor.select([n.id])}}),this.groupBtn}createMenuConvert(){return this.convertBtn=document.createElement("button"),this.convertBtn.id=`${this.id}-convert`,this.convertBtn.textContent="Convert",this.convertBtn.classList.add("ms-menu-button"),this.convertBtn.addEventListener("pointerup",()=>this.editor.convertSymbols(this.symbolsSelected)),this.convertBtn}createMenuRemove(){return this.removeBtn=document.createElement("button"),this.removeBtn.id=`${this.id}-remove`,this.removeBtn.textContent="Remove",this.removeBtn.classList.add("ms-menu-button"),this.removeBtn.addEventListener("pointerup",async()=>{this.editor.selector.removeSelectedGroup(),await this.editor.removeSymbols(this.symbolsSelected.map(t=>t.id))}),this.removeBtn}createMenuReorder(){const t=document.createElement("button");t.id=`${this.id}-reorder`,t.classList.add("ms-menu-button");const n=document.createElement("span");n.innerText="Reorder",t.appendChild(n);const s=document.createElement("span");s.style.setProperty("width","32px"),s.style.setProperty("transform","rotate(270deg)"),s.innerHTML=fh,t.appendChild(s);const o=[{type:"button",id:`${this.id}-reorder-first`,label:"Bring to front",callback:()=>{this.editor.changeOrderSymbols(this.symbolsSelected,"last"),this.editor.selector.resetSelectedGroup(this.symbolsSelected)}},{type:"button",id:`${this.id}-reorder-forward`,label:"Bring forward",callback:()=>{this.editor.changeOrderSymbols(this.symbolsSelected,"forward"),this.editor.selector.resetSelectedGroup(this.symbolsSelected)}},{type:"button",id:`${this.id}-reorder-backward`,label:"Send backward",callback:()=>{this.editor.changeOrderSymbols(this.symbolsSelected,"backward"),this.editor.selector.resetSelectedGroup(this.symbolsSelected)}},{type:"button",id:`${this.id}-reorder-last`,label:"Send to back",callback:()=>{this.editor.changeOrderSymbols(this.symbolsSelected.slice().reverse(),"first"),this.editor.selector.resetSelectedGroup(this.symbolsSelected)}}],i=document.createElement("div");i.classList.add("ms-menu-colmun"),o.forEach(l=>{i.appendChild(this.createMenuItem(l))});const a={trigger:t,subMenu:i,position:"right"};return this.reorderMenu=new Bs(a).element,this.reorderMenu}createDecoratorSubMenu(t,n){const s=document.createElement("button");s.id=`${this.id}-decorator-${n}`,s.classList.add("ms-menu-button");const o=document.createElement("span");o.innerText=t,s.appendChild(o);const i=document.createElement("span");i.style.setProperty("width","32px"),i.style.setProperty("transform","rotate(270deg)"),i.innerHTML=fh,s.appendChild(i);const a=[{type:"checkbox",id:`${this.id}-decorator-${n}-enable`,label:"Enable",initValue:!1,callback:u=>{var p;this.symbolsDecorable.forEach(f=>{if(u)f.decorators.some(m=>m.kind===n)||f.decorators.push(new Pr(n,this.editor.penStyle));else{const m=f.decorators.findIndex(v=>v.kind===n);m>-1&&f.decorators.splice(m,1)}this.editor.model.updateSymbol(f),this.editor.renderer.drawSymbol(f)}),document.querySelectorAll(`#${this.id}-decorator-${n}-color button`).forEach(f=>{f.disabled=!u,f.classList.remove("active")}),u&&((p=document.querySelector(`#${this.id}-decorator-${n}-color button`))==null||p.classList.add("active"))}},{type:"colors",label:"Colors",id:`${this.id}-decorator-${n}-color`,fill:!1,values:this.colors.filter((u,p)=>!(p%4)),initValue:this.colors[0],disabled:!0,callback:u=>{this.symbolsDecorable.forEach(p=>{const f=p.decorators.find(m=>m.kind===n);f&&(f.style.color=u,this.editor.model.updateSymbol(p),this.editor.renderer.drawSymbol(p))})}}],l=document.createElement("div");l.classList.add("ms-menu-colmun"),a.forEach(u=>{l.appendChild(this.createMenuItem(u))});const c={trigger:s,subMenu:l,position:"right"};return this.decoratorMenu=new Bs(c).element}createMenuDecorator(){const t=document.createElement("button");t.id=`${this.id}-decorator`,t.classList.add("ms-menu-button");const n=document.createElement("span");n.innerText="Decorator",t.appendChild(n);const s=document.createElement("span");s.style.setProperty("width","32px"),s.style.setProperty("transform","rotate(270deg)"),s.innerHTML=fh,t.appendChild(s);const o=document.createElement("div");o.classList.add("ms-menu-colmun"),o.appendChild(this.createDecoratorSubMenu("Hightlight",Qt.Highlight)),o.appendChild(this.createDecoratorSubMenu("Surround",Qt.Surround)),o.appendChild(this.createDecoratorSubMenu("Underline",Qt.Underline)),o.appendChild(this.createDecoratorSubMenu("Strikethrough",Qt.Strikethrough));const i={trigger:t,subMenu:o,position:"right"};return this.decoratorMenu=new Bs(i).element,this.decoratorMenu}createMenuExport(){const t=document.createElement("button");t.id=`${this.id}-export`,t.classList.add("ms-menu-button");const n=document.createElement("span");n.innerText="Export",t.appendChild(n);const s=document.createElement("span");s.style.setProperty("width","32px"),s.style.setProperty("transform","rotate(270deg)"),s.innerHTML=fh,t.appendChild(s);const o=[{type:"button",id:`${this.id}-export-json`,label:"json",callback:()=>this.editor.downloadAsJson(this.haveSymbolsSelected)},{type:"button",id:`${this.id}-export-svg`,label:"svg",callback:()=>this.editor.downloadAsSVG(this.haveSymbolsSelected)},{type:"button",id:`${this.id}-export-png`,label:"png",callback:()=>this.editor.downloadAsPNG(this.haveSymbolsSelected)}],i=document.createElement("div");i.classList.add("ms-menu-colmun"),o.forEach(l=>{i.appendChild(this.createMenuItem(l))});const a={trigger:t,subMenu:i,position:"right"};return this.menuExport=new Bs(a).element,this.menuExport}createMenuSelectAll(){const t=document.createElement("button");return t.id=`${this.id}-duplicate`,t.textContent="Select all",t.classList.add("ms-menu-button"),t.addEventListener("pointerup",async()=>this.editor.selectAll()),t}updateDecoratorSubMenu(){var t,n;this.showDecorator?((t=this.decoratorMenu)==null||t.style.removeProperty("display"),Object.values(Qt).forEach(s=>{var i;const o=document.getElementById(`${this.id}-decorator-${s}-enable`);if(o){document.querySelectorAll(`#${this.id}-decorator-${s}-color button`).forEach(l=>l.classList.remove("active"));const a=this.symbolsDecorable.flatMap(l=>l.decorators).filter(l=>l.kind===s);if(a.length&&a.every(l=>l.style.color===a[0].style.color)){const l=document.getElementById(`${this.id}-decorator-${s}-color-${(i=a[0].style.color)==null?void 0:i.replace("#","")}-btn`);l==null||l.classList.add("active")}this.symbolsDecorable.filter(l=>l.decorators.some(c=>c.kind===s)).length===this.symbolsDecorable.length?(o.checked=!0,document.querySelectorAll(`#${this.id}-decorator-${s}-color button`).forEach(l=>{l.disabled=!1}),o.indeterminate=!1):this.symbolsDecorable.filter(l=>!l.decorators.some(c=>c.kind===s)).length===this.symbolsDecorable.length?(o.checked=!1,document.querySelectorAll(`#${this.id}-decorator-${s}-color button`).forEach(l=>{l.disabled=!0}),o.indeterminate=!1):(o.setAttribute("indeterminate","true"),o.indeterminate=!0,document.querySelectorAll(`#${this.id}-decorator-${s}-color button`).forEach(l=>{l.disabled=!1}))}})):(n=this.decoratorMenu)==null||n.style.setProperty("display","none")}updateGroupMenu(){var t;this.groupBtn&&this.haveSymbolsSelected?(this.groupBtn.style.removeProperty("display"),this.symbolsSelected.length===1&&this.symbolsSelected[0].type===oe.Group?this.groupBtn.textContent="UnGroup":this.groupBtn.textContent="Group"):(t=this.groupBtn)==null||t.style.setProperty("display","none")}update(){var t,n,s,o,i,a,l,c,u,p,f,m,v,b,S;if((t=this.wrapper)==null||t.style.setProperty("left",this.position.x-this.position.scrollLeft+"px"),(n=this.wrapper)==null||n.style.setProperty("top",this.position.y-this.position.scrollTop+"px"),this.haveSymbolsSelected){const C=this.editor.model.symbolsSelected.find(E=>E.type===oe.Text);this.editMenu&&this.editInput&&this.editor.model.symbolsSelected.length===1&&C?(this.editMenu.style.removeProperty("display"),this.editInput.value=C.label):(s=this.editMenu)==null||s.style.setProperty("display","none"),this.editor.extractStrokesFromSymbols(this.symbolsSelected).length?(o=this.convertBtn)==null||o.style.removeProperty("display"):(i=this.convertBtn)==null||i.style.setProperty("display","none"),(a=this.reorderMenu)==null||a.style.removeProperty("display"),(l=this.duplicateBtn)==null||l.style.removeProperty("display"),(c=this.removeBtn)==null||c.style.removeProperty("display"),(u=this.menuExport)==null||u.style.removeProperty("display")}else(p=this.editMenu)==null||p.style.setProperty("display","none"),(f=this.convertBtn)==null||f.style.setProperty("display","none"),(m=this.reorderMenu)==null||m.style.setProperty("display","none"),(v=this.duplicateBtn)==null||v.style.setProperty("display","none"),(b=this.removeBtn)==null||b.style.setProperty("display","none"),(S=this.menuExport)==null||S.style.setProperty("display","none");this.updateDecoratorSubMenu(),this.updateGroupMenu()}render(t){this.wrapper=document.createElement("div"),this.wrapper.id=`${this.id}-wrapper`,this.wrapper.classList.add("ms-menu","ms-menu-context"),this.wrapper.appendChild(this.createMenuEdit()),this.wrapper.appendChild(this.createMenuDecorator()),this.wrapper.appendChild(this.createMenuReorder()),this.wrapper.appendChild(this.createMenuExport()),this.wrapper.appendChild(this.createMenuConvert()),this.wrapper.appendChild(this.createMenuGroup()),this.wrapper.appendChild(this.createMenuDuplicate()),this.wrapper.appendChild(this.createMenuRemove()),this.wrapper.appendChild(this.createMenuSelectAll()),this.wrapper.style.setProperty("display","none"),t.appendChild(this.wrapper),this.editor.layers.rendering.addEventListener("scroll",()=>{this.position.scrollLeft=this.editor.layers.rendering.scrollLeft||0,this.position.scrollTop=this.editor.layers.rendering.scrollTop||0,this.update()})}show(){var t;this.update(),(t=this.wrapper)==null||t.style.setProperty("display","block")}hide(){var t;(t=this.wrapper)==null||t.style.setProperty("display","none")}destroy(){var t,n;for(;(t=this.wrapper)!=null&&t.lastChild;)this.wrapper.removeChild(this.wrapper.lastChild);(n=this.wrapper)==null||n.remove()}}O0=new WeakMap;const age={enable:!0,style:{enable:!0},tool:{enable:!0},action:{enable:!0},context:{enable:!0}};var L0;class lge{constructor(e,t){De(this,L0,Rt.getLogger(lt.MENU));k(this,"editor");k(this,"layer");k(this,"action");k(this,"tool");k(this,"context");k(this,"style");if(j(this,L0).info("constructor"),this.editor=e,t==null?void 0:t.style){const n=t.style;this.style=new n(this.editor)}else this.style=new oge(this.editor);if(t!=null&&t.tool){const n=t.tool;this.tool=new n(this.editor)}else this.tool=new sge(this.editor);if(t!=null&&t.action){const n=t.action;this.action=new n(this.editor)}else this.action=new rge(this.editor);if(t!=null&&t.context){const n=t.context;this.context=new n(this.editor)}else this.context=new ige(this.editor)}render(e){if(this.editor.configuration.menu.enable){this.layer=e;const t=document.createElement("style");t.appendChild(document.createTextNode(".ms-editor .ms-menu{background-color:#fff;box-shadow:1px 1px 5px rgba(0,0,0,.25),-1px -1px 5px rgba(0,0,0,.25);cursor:auto;padding:5px;pointer-events:all;z-index:99}.ms-editor .ms-menu-top-left{border-radius:0 0 5px 5px;left:5px;position:absolute;top:0}.ms-editor .ms-menu-bottom{border-radius:5px;bottom:8px;left:50%;position:absolute;transform:translateX(-50%)}.ms-editor .ms-menu-top-right{border-radius:0 0 5px 5px;position:absolute;right:5px;top:0}.ms-editor .ms-menu .ms-menu-title{background-color:#b3dfff;border-radius:5px 5px 0 0;font-size:16px;font-weight:700;margin-bottom:8px;margin-top:0;padding:2px;text-align:center}.ms-editor .ms-menu-colmun{display:flex;flex-direction:column;justify-content:center}.ms-editor .ms-menu-row{display:flex;flex-direction:row;justify-content:center}.ms-editor .ms-menu-item{align-items:center;display:flex;gap:5px;justify-content:space-between;padding:5px;width:100%}.ms-editor .ms-menu .select-language{height:32px;padding:0 8px;width:auto}.ms-editor .ms-menu-item.list button{align-items:center;background-color:#fff;border:none;border-radius:4px;cursor:pointer;display:flex;font-size:inherit;height:32px;justify-content:center;padding:0;position:relative;width:32px}.ms-editor .ms-menu-item.list button:hover{background-color:#efefef}.ms-editor .ms-menu-item.list button.active{border:1px solid #1a9fff}.ms-editor .ms-menu .color-list{cursor:pointer;flex-wrap:wrap;gap:2px;margin:auto;max-width:150px;min-width:150px;padding:4px}.ms-editor .ms-menu .font-size-list,.ms-editor .ms-menu .thickness-list{cursor:pointer;flex-wrap:wrap;gap:2px;margin:auto;max-width:150px;min-width:150px;padding:0}.ms-editor .ms-menu .ms-menu-button{-webkit-touch-callout:none;align-items:center;background-color:#fff;border:none;border-radius:4px;color:#000;cursor:pointer;display:flex;font-size:inherit;height:32px;justify-content:space-between;padding:4px;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:100%}.ms-editor .ms-menu svg{height:20px;position:relative;width:20px}.ms-editor .ms-menu .ms-menu-button.center{justify-content:center}.ms-editor .ms-menu .ms-menu-button.square{justify-content:center;width:32px}.ms-editor .ms-menu .ms-menu-button .color{border-radius:100%;height:75%;margin:auto;width:75%}.ms-editor .ms-menu .ms-menu-button:hover{background-color:#efefef}.ms-editor .ms-menu .ms-menu-button:disabled{background-color:hsla(0,0%,100%,.4);color:rgba(0,0,0,.4);opacity:.5;pointer-events:none}.ms-editor .ms-menu .ms-menu-button:active,.ms-editor .ms-menu .ms-menu-button:focus{background-color:#1aa0ff55;outline:none}.ms-editor .ms-menu .ms-menu-button.active{border:1px solid #1a9fff;color:#1a9fff}.ms-editor .sub-menu{overflow:visible;position:relative}.ms-editor .sub-menu .sub-menu-content{background-color:#fff;border-radius:5px;box-shadow:1px 1px 5px rgba(0,0,0,.25),-1px -1px 5px rgba(0,0,0,.25);color:#000;display:none;padding:5px;position:absolute;white-space:nowrap;width:auto;z-index:100}.ms-editor .sub-menu .sub-menu-content.open{display:block}.ms-editor .sub-menu .sub-menu-content.top{left:50%;top:-8px;transform:translate(-50%,-100%)}.ms-editor .sub-menu .sub-menu-content.bottom{bottom:-8px;left:50%;transform:translate(-50%,100%)}.ms-editor .sub-menu .sub-menu-content.bottom-left{bottom:-8px;right:0;transform:translateY(100%)}.ms-editor .sub-menu .sub-menu-content.right-top{right:-8px;top:0;transform:translate(100%)}.ms-editor .sub-menu .sub-menu-content.right{right:-8px;top:50%;transform:translate(100%,-50%)}.ms-editor .ms-menu-context{position:absolute}.ms-editor .ms-menu output{background-color:#fff;border-radius:5px;box-shadow:0 2px 5px 0 rgba(0,0,0,.225);color:#000;display:none;font-weight:700;left:50%;padding:5px;position:absolute;transform:translate(-50%,-250%);white-space:nowrap;width:auto}.ms-editor .ms-menu input:focus+output,.ms-editor .ms-menu input:focus-visible+output,.ms-editor .ms-menu input:hover+output{display:block}.ms-editor .ms-menu input:not([type=checkbox]):not([type=color]):not([type=range]),.ms-editor .ms-menu select{-webkit-tap-highlight-color:transparent;-webkit-appearance:none;appearance:none;border:1px solid #ced5d9;border-radius:3px;color:#131f26;font:600 14px Source Sans Pro,sans-serif;height:2rem;padding:0 10px}.ms-editor .ms-menu input[type=file]{border:none!important}.ms-editor .ms-menu input[type=file]:focus{border:none!important;box-shadow:none!important}.ms-editor .ms-menu input[type=file]:focus::file-selector-button{border:1px solid #1a9fff!important}.ms-editor .ms-menu input[type=file]::file-selector-button{background-color:#fff;border:1px solid rgba(0,0,0,.16);border-radius:4px;box-shadow:0 1px 0 rgba(0,0,0,.05);cursor:pointer;height:2rem;margin:0 auto 0 8px;padding:0 16px;transition:background-color .2s}.ms-editor .ms-menu input[type=file]::file-selector-button:hover{background-color:#f3f4f6}.ms-editor .ms-menu input[type=file]::file-selector-button:active{background-color:#e5e7eb}.ms-editor .ms-menu select{background:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQuNDIyLjI2Yy0uMjMzLS4zMzctLjYxLS4zMzctLjg0NCAwTC4xNzUgNS4xN0MtLjE0MiA1LjYyOC4wNDggNiAuNjEgNmg2Ljc4Yy41NTggMCAuNzU0LS4zNy40MzUtLjgzTDQuNDIyLjI2em0uMDIgMTMuNDdjLS4yMzYuMzQyLS42MTguMzQ3LS44NS4wMUwuMTY3IDguODE4Qy0uMTQ2IDguMzY3LjA0OCA4IC42MDggOGg2Ljc4M2MuNTU4IDAgLjc1NS4zNy40MzcuODNsLTMuMzg1IDQuOXoiIGZpbGw9IiMxMzFGMjYiIGZpbGwtcnVsZT0iZXZlbm9kZCIvPjwvc3ZnPg==) 100% no-repeat #fff;padding:0 25px 0 10px}.ms-editor .ms-menu input:not([type=checkbox]):not([type=color]):not([type=range]):not([type=file]):focus,.ms-editor .ms-menu select:focus{border:1px solid #1a9fff;box-shadow:0 1px 1px 0 rgba(0,0,0,.16);outline:0}")),this.layer.prepend(t),this.editor.configuration.menu.action.enable&&this.action.render(this.layer),this.editor.configuration.menu.style.enable&&this.style.render(this.layer),this.editor.configuration.menu.tool.enable&&this.tool.render(this.layer),this.editor.configuration.menu.context.enable&&this.context.render(this.layer)}}update(){this.action.update(),this.tool.update(),this.style.update()}show(){this.action.show(),this.tool.show(),this.style.show()}hide(){this.action.hide(),this.tool.hide(),this.style.hide()}destroy(){this.action.destroy(),this.tool.destroy(),this.style.destroy()}}L0=new WeakMap;const Mv={guide:!0,symbol:!0,angle:0};class $7{constructor(e){k(this,"guide");k(this,"symbol");k(this,"angle");this.symbol=(e==null?void 0:e.symbol)!==void 0?e.symbol:Mv.symbol,this.guide=(e==null?void 0:e.guide)!==void 0?e.guide:Mv.guide,this.angle=(e==null?void 0:e.angle)!==void 0?e.angle:Mv.angle}}var N0;class cge{constructor(e,t){De(this,N0,Rt.getLogger(lt.CONVERTER));k(this,"editor");k(this,"configuration");j(this,N0).info("constructor"),this.editor=e,this.configuration=new $7(t)}get model(){return this.editor.model}get renderer(){return this.editor.renderer}get selectionSnapPoints(){return at.createFromPoints(this.model.symbolsSelected.flatMap(e=>e.snapPoints)).snapPoints}get otherSnapPoints(){const e=this.model.symbolsSelected.map(t=>t.id);return this.model.symbols.filter(t=>!e.includes(t.id)).flatMap(t=>t.snapPoints)}get snapThreshold(){return this.editor.configuration.rendering.guides.gap/2}getNearestVerticalGuide(e){return this.renderer.verticalGuides.length?this.renderer.verticalGuides.reduce((t,n)=>Math.abs(n-e)<Math.abs(t-e)?n:t):e}getNearestHorizontalGuide(e){return this.renderer.horizontalGuides.length?this.renderer.horizontalGuides.reduce((t,n)=>Math.abs(n-e)<Math.abs(t-e)?n:t):e}getGuidePointToSnap(e){return{x:this.getNearestVerticalGuide(e.x),y:this.getNearestHorizontalGuide(e.y)}}drawSnapToElementLines(e){const t={role:"snap-to-element",fill:"transparent",stroke:"blue","stroke-width":"2",style:Lt.noSelection,"marker-start":`url(#${Lt.crossMarker})`,"marker-end":`url(#${Lt.crossMarker})`};e.forEach(n=>{this.renderer.drawLine(n.p1,n.p2,t)})}clearSnapToElementLines(){this.renderer.clearElements({attrs:{role:"snap-to-element"}})}getSnapLinesInfos(e,t){const n={nudge:{x:1/0,y:1/0},verticales:[],horizontales:[]};return e.length&&t.length&&e.forEach(s=>{t.forEach(o=>{this.snapThreshold>Math.abs(o.x-s.x)&&(Math.abs(n.nudge.x)>Math.abs(o.x-s.x)?(n.nudge.x=o.x-s.x,n.verticales=[{p1:{...s},p2:o}]):n.nudge.x===o.x-s.x&&n.verticales.push({p1:{...s},p2:o})),this.snapThreshold>Math.abs(o.y-s.y)&&(Math.abs(n.nudge.y)>Math.abs(o.y-s.y)?(n.nudge.y=o.y-s.y,n.horizontales=[{p1:{...s},p2:o}]):n.nudge.y===o.y-s.y&&n.horizontales.push({p1:{...s},p2:o}))})}),n}snapResize(e,t=!0,n=!0){if(this.clearSnapToElementLines(),!this.configuration.symbol&&!this.configuration.guide)return e;let s={x:1/0,y:1/0};this.configuration.guide&&(s=this.getGuidePointToSnap(e));const o=[];if(this.configuration.symbol){const i=this.getSnapLinesInfos([e],this.otherSnapPoints);t&&Math.abs(i.nudge.x)<=Math.abs(e.x-s.x)&&(s.x=e.x+i.nudge.x,o.push(...i.verticales)),n&&Math.abs(i.nudge.y)<=Math.abs(e.y-s.y)&&(s.y=e.y+i.nudge.y,o.push(...i.horizontales))}return s.x===1/0&&(s.x=e.x),s.y===1/0&&(s.y=e.y),o.forEach(i=>i.p1=s),this.drawSnapToElementLines(o),s}snapTranslate(e,t){this.clearSnapToElementLines();const n={x:e,y:t};if(!this.configuration.symbol&&!this.configuration.guide)return n;const s=this.selectionSnapPoints.map(l=>({x:l.x+e,y:l.y+t}));let o=1/0,i=1/0;this.configuration.guide&&s.forEach(l=>{const c=this.getGuidePointToSnap(l);o>Math.abs(c.x-l.x)&&(n.x=c.x-l.x+e,o=Math.abs(c.x-l.x)),i>Math.abs(c.y-l.y)&&(n.y=c.y-l.y+t,i=Math.abs(c.y-l.y))});const a=[];if(this.configuration.symbol){const l=this.getSnapLinesInfos(s,this.otherSnapPoints);o>=Math.abs(l.nudge.x)&&l.verticales.length&&(n.x=l.nudge.x+e,a.push(...l.verticales)),i>=Math.abs(l.nudge.y)&&l.horizontales.length&&(n.y=l.nudge.y+t,a.push(...l.horizontales))}return a.length&&(a.forEach(l=>{l.p1.x+=n.x-e,l.p1.y+=n.y-t}),this.drawSnapToElementLines(a)),n}snapRotation(e){return this.configuration.angle>0?this.configuration.angle*Math.round(e/this.configuration.angle):e}}N0=new WeakMap;const Rc={server:_0.server,recognition:_0.recognition,menu:age,rendering:L7,logger:Zh,grabber:tS,"undo-redo":nS,penStyle:Sn,fontStyle:{size:"auto",weight:"auto"},gesture:Tv,snap:Mv};class dge{constructor(e){k(this,"grabber");k(this,"logger");k(this,"server");k(this,"recognition");k(this,"rendering");k(this,"undo-redo");k(this,"menu");k(this,"penStyle");k(this,"fontStyle");k(this,"gesture");k(this,"snap");const{server:t,recognition:n}=new T7(e);this.recognition=n,this.server=t,this.grabber=It({},Rc.grabber,e==null?void 0:e.grabber),this.logger=It({},Rc.logger,e==null?void 0:e.logger),this.rendering=It({},Rc.rendering,e==null?void 0:e.rendering),this["undo-redo"]=It({},Rc["undo-redo"],e==null?void 0:e["undo-redo"]),this.menu=It({},Rc.menu,e==null?void 0:e.menu),this.gesture=It({},Rc.gesture,e==null?void 0:e.gesture),this.snap=new $7(e==null?void 0:e.snap),this.penStyle=It({},Rc.penStyle,e==null?void 0:e.penStyle),this.fontStyle=It({},Rc.fontStyle,e==null?void 0:e.fontStyle)}}var Ds,Xd,Zd,fg,gg,Jd;class Ak extends Jb{constructor(t,n){var s,o;super(t,n);De(this,Ds);De(this,Xd);De(this,Zd,Pt.Write);De(this,fg);De(this,gg);k(this,"renderer");k(this,"recognizer");De(this,Jd);k(this,"history");k(this,"writer");k(this,"eraser");k(this,"gesture");k(this,"resizer");k(this,"rotator");k(this,"translator");k(this,"converter");k(this,"texter");k(this,"selector");k(this,"svgDebugger");k(this,"snaps");k(this,"move");k(this,"menu");if(Je(this,Ds,new dge(n==null?void 0:n.configuration)),Je(this,Jd,Object.assign({},j(this,Ds).penStyle)),(s=n==null?void 0:n.override)==null?void 0:s.recognizer){const i=n==null?void 0:n.override.recognizer;this.recognizer=new i(j(this,Ds))}else this.recognizer=new M7(j(this,Ds));this.recognizer.event.addErrorListener(this.manageError.bind(this)),this.recognizer.event.addExportedListener(this.event.emitExported.bind(this.event)),this.recognizer.event.addContentChangedListener(this.onContentChanged.bind(this)),this.recognizer.event.addSessionOpenedListener(this.event.emitSessionOpened.bind(this.event)),this.recognizer.event.addEndInitialization(this.layers.hideMessageModal.bind(this.layers)),this.recognizer.event.addIdleListener(this.updateLayerState.bind(this)),this.renderer=new D7(j(this,Ds).rendering),this.history=new ege(j(this,Ds)["undo-redo"],this.event),this.writer=new Xfe(this),this.eraser=new F7(this),this.selector=new Vfe(this),this.move=new Jfe(this),this.gesture=new nge(this,j(this,Ds).gesture),this.resizer=new Wfe(this),this.rotator=new Kfe(this),this.translator=new Yfe(this),this.converter=new Gfe(this),this.texter=new qfe(this),this.svgDebugger=new Zfe(this),this.snaps=new cge(this,j(this,Ds).snap),this.menu=new lge(this,(o=n==null?void 0:n.override)==null?void 0:o.menu),Je(this,Xd,new Tk(j(this,Ds).rendering.minWidth,j(this,Ds).rendering.minHeight,this.configuration.rendering.guides.gap))}get initializationPromise(){return this.recognizer.initialized.promise}get tool(){return j(this,Zd)}set tool(t){switch(Je(this,Zd,t),this.menu.tool.update(),this.setCursorStyle(),this.unselectAll(),this.eraser.detach(),this.selector.detach(),this.move.detach(),this.writer.detach(),j(this,Zd)){case Pt.Erase:this.eraser.attach(this.layers.rendering);break;case Pt.Select:this.selector.attach(this.layers.rendering);break;case Pt.Move:this.move.attach(this.layers.rendering);break;default:this.writer.attach(this.layers.rendering)}this.event.emitToolChanged(t)}get model(){return j(this,Xd)}get configuration(){return j(this,Ds)}set renderingConfiguration(t){this.configuration.rendering=It(this.configuration.rendering,t);const n=Math.max(this.renderer.parent.clientHeight,this.configuration.rendering.minHeight),s=Math.max(this.renderer.parent.clientWidth,this.configuration.rendering.minWidth);this.renderer.resize(n,s),this.model.rowHeight=this.configuration.rendering.guides.gap,this.history.stack.forEach(o=>o.model.rowHeight=this.model.rowHeight),this.event.emitUIpdated()}get penStyle(){return j(this,Jd)}set penStyle(t){this.logger.info("set penStyle",{penStyle:t}),Je(this,Jd,Object.assign({},j(this,Jd),t))}updateLayerState(t){this.event.emitIdle(t),this.layers.updateState(t)}updateLayerUI(t=500){clearTimeout(j(this,fg)),Je(this,fg,setTimeout(()=>{this.menu.update(),this.svgDebugger.apply(),this.waitForIdle(),this.event.emitUIpdated()},t))}manageError(t){this.layers.showMessageError(t),this.event.emitError(t)}setCursorStyle(){switch(j(this,Zd)){case Pt.Erase:this.layers.root.classList.remove("draw"),this.layers.root.classList.add("erase"),this.layers.root.classList.remove("select"),this.layers.root.classList.remove("move");break;case Pt.Select:this.layers.root.classList.remove("draw"),this.layers.root.classList.remove("erase"),this.layers.root.classList.add("select"),this.layers.root.classList.remove("move");break;case Pt.Move:this.layers.root.classList.remove("draw"),this.layers.root.classList.remove("erase"),this.layers.root.classList.remove("select"),this.layers.root.classList.add("move");break;default:this.layers.root.classList.add("draw"),this.layers.root.classList.remove("erase"),this.layers.root.classList.remove("select"),this.layers.root.classList.remove("move")}}async onContentChanged(t){clearTimeout(j(this,gg)),Je(this,gg,setTimeout(async()=>{await this.synchronizeStrokesWithJIIX(),this.updateLayerUI(0),this.event.emitChanged(t)},500))}async initialize(){try{this.logger.info("initialize"),this.layers.render(),this.layers.showLoader(),this.tool=Pt.Write,this.renderer.init(this.layers.rendering),this.menu.render(this.layers.ui.root);const t=window.getComputedStyle(this.layers.root);this.model.width=Math.max(parseInt(t.width.replace("px","")),j(this,Ds).rendering.minWidth),this.model.height=Math.max(parseInt(t.height.replace("px","")),j(this,Ds).rendering.minHeight),this.model.rowHeight=this.configuration.rendering.guides.gap,this.history.init(this.model),this.recognizer.configuration.server.version||(await this.loadInfo(this.configuration.server),this.recognizer.configuration.server.version=this.info.version),await this.recognizer.init()}catch(t){throw this.logger.error("initialize",t),this.layers.showMessageError(t),t}finally{this.logger.debug("initialize","finally"),this.layers.hideLoader(),this.layers.updateState(!0)}}async changeLanguage(t){try{this.logger.info("changeLanguage",{code:t}),this.updateLayerState(!1),this.configuration.recognition.lang=t,await this.recognizer.newSession(this.configuration),this.recognizer.addStrokes(this.extractStrokesFromSymbols(this.model.symbols),!1),await this.synchronizeStrokesWithJIIX(!0),this.layers.hideLoader(),this.event.emitLoaded()}catch(n){throw this.logger.error("changeLanguage",n),this.manageError(n),n}finally{this.updateLayerUI()}}buildShape(t){switch(t.kind){case mr.Circle:return ed.create(t);case mr.Ellipse:return td.create(t);case mr.Polygon:return Ir.create(t);default:throw new Error(`Unable to create shape, kind: "${t.kind}" is unknown`)}}buildEdge(t){switch(t.kind){case jr.Arc:return ng.create(t);case jr.Line:return Jh.create(t);case jr.PolyEdge:return rg.create(t);default:throw new Error(`Unable to create edge, kind: "${t.kind}" is unknown`)}}buildRecognized(t){switch(t.kind){case jn.Text:return tl.create(t);case jn.Arc:return sg.create(t);case jn.Circle:return og.create(t);case jn.Ellipse:return ig.create(t);case jn.Polygone:return cg.create(t);case jn.Line:return ag.create(t);case jn.PolyEdge:return lg.create(t);default:throw new Error(`Unable to create recognized, symbol type '${JSON.stringify(t)} is unknow`)}}buildGroup(t){var o;if(!((o=t.children)!=null&&o.length))throw new Error("Unable to create group, no children");const n=t.children.map(i=>{switch(i==null?void 0:i.type){case oe.Stroke:return Jn.create(i);case oe.Shape:return this.buildShape(i);case oe.Edge:return this.buildEdge(i);case oe.Text:return ol.create(i);case oe.Group:return this.buildGroup(i);case oe.Recognized:return this.buildRecognized(i);default:throw new Error(`Unable to create group, symbol type '${JSON.stringify(i)} is unknow`)}}),s=new Gr(n,t.style);return t.id&&(s.id=t.id),t.decorators&&(s.decorators=t.decorators.map(i=>new Pr(i.kind,i.style))),s}buildStroke(t){return Jn.create(t)}buildStrokeText(t){return tl.create(t)}buildText(t){return ol.create(t)}buildSymbol(t){try{switch(t.type){case oe.Stroke:return this.buildStroke(t);case oe.Shape:return this.buildShape(t);case oe.Edge:return this.buildEdge(t);case oe.Text:return this.buildText(t);case oe.Group:return this.buildGroup(t);case oe.Recognized:return this.buildRecognized(t);default:throw new Error(`Unable to build symbol, type: "${t.type}" is unknown`)}}catch(n){throw this.logger.error("createSymbol",n),this.manageError(n),n}}async createSymbol(t){try{return await this.addSymbol(this.buildSymbol(t))}catch(n){throw this.logger.error("createSymbol",n),this.manageError(n),n}finally{this.updateLayerUI()}}async createSymbols(t){try{const n=[],s=[];if(t.forEach(o=>{try{s.push(this.buildSymbol(o))}catch(i){n.push(i.message||i)}}),n.length)throw new Error(n.join(`
`));return await this.addSymbols(s)}catch(n){throw this.logger.error("createSymbols",n),this.manageError(n),n}}updateTextBounds(t){t.type===oe.Text?this.texter.updateBounds(t):t.type===oe.Group&&t.extractText().forEach(n=>this.texter.updateBounds(n))}async addSymbol(t,n=!0){this.logger.info("addSymbol",{sym:t}),this.updateLayerState(!1),this.updateTextBounds(t),this.model.addSymbol(t),this.renderer.drawSymbol(t);const s=this.extractStrokesFromSymbols([t]);return this.recognizer.addStrokes(s,!1),n&&this.history.push(this.model,{added:[t]}),this.updateLayerUI(),t}async addSymbols(t,n=!0){this.logger.info("addSymbol",{symList:t}),this.updateLayerState(!1),t.forEach(o=>{this.updateTextBounds(o),this.model.addSymbol(o),this.renderer.drawSymbol(o)});const s=this.extractStrokesFromSymbols(t);return this.recognizer.addStrokes(s,!1),n&&this.history.push(this.model,{added:t}),this.updateLayerUI(),t}async updateSymbol(t,n=!0){this.logger.info("updateSymbol",{sym:t}),this.updateLayerState(!1),this.updateTextBounds(t),this.model.updateSymbol(t),this.renderer.drawSymbol(t);const s=this.extractStrokesFromSymbols([t]);return this.recognizer.replaceStrokes(s.map(o=>o.id),s),n&&this.history.push(this.model,{updated:[t]}),this.updateLayerUI(),t}async updateSymbols(t,n=!0){this.logger.info("updateSymbol",{symList:t}),this.updateLayerState(!1),t.forEach(o=>{this.updateTextBounds(o),this.model.updateSymbol(o),this.renderer.drawSymbol(o)});const s=this.extractStrokesFromSymbols(t);return this.recognizer.replaceStrokes(s.map(o=>o.id),s),n&&this.history.push(this.model,{updated:t}),this.updateLayerUI(),t}updateSymbolsStyle(t,n,s=!0){this.logger.info("updateSymbolsStyle",{symbolIds:t,style:n});const o=[];this.model.symbols.forEach(i=>{t.includes(i.id)&&(i.style=Object.assign({},i.style,n),oe.Text!==i.type&&oe.Group!==i.type&&oe.Recognized!==i.type||i.updateChildrenStyle(),this.renderer.drawSymbol(i),this.model.updateSymbol(i),i.modificationDate=Date.now(),o.push(i))}),o.length&&o.forEach(i=>{if(i.type===oe.Text){const a=i.bounds.width;this.texter.updateBounds(i);const l=i.bounds.width-a;l!==0&&this.texter.moveTextAfter(i,l)}}),s&&o.length&&this.history.push(this.model,{style:{symbols:o,style:n}})}updateTextFontStyle(t,{fontSize:n,fontWeight:s}){this.logger.info("updateTextFontStyle",{textIds:t,fontSize:n,fontWeight:s});const o=[],i=[];this.model.symbols.forEach(a=>{if(t.includes(a.id)){if(a.type===oe.Text){a.updateChildrenFont({fontSize:n,fontWeight:s==="auto"?void 0:s});const l=a.bounds.width;this.texter.updateBounds(a),this.renderer.drawSymbol(a);const c=a.bounds.width-l;if(c!==0){const u=this.texter.moveTextAfter(a,c);u!=null&&u.length&&i.push({symbols:u,tx:c,ty:0})}a.modificationDate=Date.now(),o.push(a)}else if(a.type===oe.Group){const l=a.extractText();l.length&&(l.forEach(c=>{c.updateChildrenFont({fontSize:n,fontWeight:s==="auto"?void 0:s});const u=a.bounds.width;this.texter.updateBounds(c);const p=a.bounds.width-u,f=this.texter.moveTextAfter(c,p);f!=null&&f.length&&i.push({symbols:f,tx:p,ty:0})}),a.modificationDate=Date.now(),this.renderer.drawSymbol(a),o.push(a))}}}),o.length&&this.history.push(this.model,{style:{symbols:o,fontSize:n},translate:i})}async replaceSymbols(t,n,s=!0){this.logger.info("replaceSymbol",{oldSymbols:t,newSymbols:n}),this.updateLayerState(!1);const o=this.extractStrokesFromSymbols(t),i=this.extractStrokesFromSymbols(n),a=t.shift();a&&(t.forEach(l=>{this.renderer.removeSymbol(l.id),this.model.removeSymbol(l.id)}),this.model.replaceSymbol(a.id,n),this.renderer.replaceSymbol(a.id,n),o.length&&i.length?this.recognizer.replaceStrokes(o.map(l=>l.id),i):o.length?this.recognizer.eraseStrokes(o.map(l=>l.id)):this.recognizer.addStrokes(i,!1),s&&this.history.push(this.model,{replaced:{oldSymbols:t,newSymbols:n}}),this.updateLayerUI())}changeOrderSymbol(t,n){this.model.changeOrderSymbol(t.id,n),this.renderer.changeOrderSymbol(t,n),this.history.push(this.model,{order:{symbols:[t],position:n}})}changeOrderSymbols(t,n){t.forEach(s=>{this.model.changeOrderSymbol(s.id,n),this.renderer.changeOrderSymbol(s,n)}),this.history.push(this.model,{order:{symbols:t,position:n}})}groupSymbols(t){const n=this.buildGroup({children:t});return t.forEach(s=>{this.model.removeSymbol(s.id),this.renderer.removeSymbol(s.id)}),this.model.addSymbol(n),this.history.push(this.model,{group:{symbols:t}}),n}ungroupSymbol(t){return t.children.forEach(n=>this.renderer.drawSymbol(n)),this.renderer.removeSymbol(t.id),this.model.replaceSymbol(t.id,t.children),this.history.push(this.model,{ungroup:{group:t}}),t.children}async synchronizeStrokesWithJIIX(t=!1){var i,a;const n=this.model.symbols.filter(l=>l.type===oe.Stroke);if(!t&&!n.length)return void this.event.emitSynchronized();await this.export(["application/vnd.myscript.jiix"]);const s=(l=[])=>{const c=[],u=[],p=[];return l.forEach(f=>{const m=f["full-id"];if(p.includes(m))return;p.push(m);const v=this.model.getRootSymbol(m);if(v){(v==null?void 0:v.type)===oe.Recognized?u.push(v.strokes.find(S=>S.id===f["full-id"])):u.push(v);const b=c.findIndex(S=>S.id===v.id);b<0?c.push(v):c[b]=v}}),{symbols:c,strokes:u}},o=(i=this.model.exports)==null?void 0:i["application/vnd.myscript.jiix"];(a=o==null?void 0:o.elements)==null||a.forEach(l=>{var c;switch(l.type){case Df.Text:(c=l.words)==null||c.forEach(u=>{const p=s(u.items);if(p.strokes.length){if(p.symbols.length===1){const v=p.symbols[0];if(v.type===oe.Recognized&&v.kind===jn.Text&&v.label===u.label&&v.strokes.length==v.strokes.length)return}const f=l.lines.find(v=>v["first-char"]<=u["first-char"]&&v["last-char"]>=u["last-char"]),m=new tl(p.strokes,{baseline:ot(f["baseline-y"]),xHeight:ot(f["x-height"])});m.label=u.label,p.symbols.forEach(v=>{v.type===oe.Recognized&&v.kind===jn.Text&&v.decorators.forEach(b=>{m.decorators.some(S=>S.kind===b.kind)||m.decorators.push(b)}),this.model.removeSymbol(v.id),this.renderer.removeSymbol(v.id)}),this.model.addSymbol(m),this.renderer.drawSymbol(m)}});break;case Df.Node:{let u;const p=s(l.items);if(p.strokes.length){if(p.symbols.length===1){const f=p.symbols[0];if(f.type===oe.Recognized&&f.strokes.length===p.strokes.length)return}switch(l.kind){case Us.Circle:u=new og(p.strokes);break;case Us.Ellipse:u=new ig(p.strokes);break;case Us.Rectangle:case Us.Triangle:case Us.Parallelogram:case Us.Polygon:case Us.Rhombus:u=new cg(p.strokes);break;default:this.logger.warn("synchronizeStrokesWithJIIX",`Can not create recognized shape symbol, kind unknow: ${l}`)}u&&(p.symbols.forEach(f=>{this.model.removeSymbol(f.id),this.renderer.removeSymbol(f.id)}),this.model.addSymbol(u),this.renderer.drawSymbol(u))}break}case Df.Edge:{let u;const p=s(l.kind===da.PolyEdge?l.edges.flatMap(f=>f.items):l.items);if(p.strokes.length){if(p.symbols.length===1){const f=p.symbols[0];if(f.type===oe.Recognized&&f.strokes.length===p.strokes.length)return}switch(l.kind){case da.Line:u=new ag(p.strokes);break;case da.PolyEdge:u=new lg(p.strokes);break;case da.Arc:u=new sg(p.strokes);break;default:this.logger.warn("synchronizeStrokesWithJIIX",`Can not create recognized edge symbol, kind unknow: ${l}`)}u&&(p.symbols.forEach(f=>{this.model.removeSymbol(f.id),this.renderer.removeSymbol(f.id)}),this.model.addSymbol(u),this.renderer.drawSymbol(u))}break}default:this.logger.warn("synchronizeStrokesWithJIIX",`Can not create recognized symbol, type unknow: ${l}`)}}),this.model.mergeExport({"application/vnd.myscript.jiix":o}),this.history.update(this.model),this.event.emitSynchronized()}async removeSymbol(t,n=!0){this.logger.info("removeSymbol",{id:t});const s=this.model.getRootSymbol(t);if(s){if(this.updateLayerState(!1),s.type===oe.Group){const o=s.extractStrokes().map(i=>i.id);s.removeChilds([t]),s.children.length?(this.model.updateSymbol(s),this.renderer.drawSymbol(s),o.includes(t)&&this.recognizer.eraseStrokes([t])):(this.recognizer.eraseStrokes(o),this.model.removeSymbol(s.id),this.renderer.removeSymbol(s.id))}else this.recognizer.eraseStrokes([t]),this.model.removeSymbol(s.id),this.renderer.removeSymbol(s.id);n&&this.history.push(this.model,{erased:[s]}),this.updateLayerUI()}else this.renderer.removeSymbol(t),this.recognizer.eraseStrokes([t])}async removeSymbols(t,n=!0){this.logger.info("removeSymbol",{ids:t});const s=[],o=[],i=[];if(t.forEach(a=>{const l=this.model.getRootSymbol(a);if(l)if(l.id===a)switch(s.push(l),l.type){case oe.Stroke:i.push(l.id);break;case oe.Recognized:i.push(...l.strokes.map(c=>c.id));break;case oe.Group:i.push(...l.extractStrokes().map(c=>c.id))}else switch(l.type){case oe.Group:{const c=l.clone();i.push(...c.extractStrokes().map(u=>u.id).filter(u=>t.includes(u))),c.removeChilds(t),c.children.length?o.push(c):s.push(c);break}case oe.Recognized:{i.push(a);const c=l.clone();c.removeStrokes(t),c.strokes.length?o.push(c):s.push(c);break}}}),this.recognizer.eraseStrokes(i),s.forEach(a=>{this.model.removeSymbol(a.id),this.renderer.removeSymbol(a.id)}),o.forEach(a=>{this.model.updateSymbol(a),this.renderer.drawSymbol(a)}),n){const a={};(s.length||o.length)&&(s.length&&(a.erased=s),o.length&&(a.updated=o),this.history.push(this.model,a),this.updateLayerUI())}return this.updateLayerState(!1),s}select(t){this.selector.removeSelectedGroup(),this.model.symbols.forEach(n=>{n.selected=t.includes(n.id),this.renderer.drawSymbol(n)}),this.selector.drawSelectedGroup(this.model.symbolsSelected),this.updateLayerUI(),this.event.emitSelected(this.model.symbolsSelected)}selectAll(){this.selector.removeSelectedGroup(),this.model.symbols.forEach(t=>{t.selected=!0,this.renderer.drawSymbol(t)}),this.selector.drawSelectedGroup(this.model.symbolsSelected),this.updateLayerUI(),this.event.emitSelected(this.model.symbolsSelected)}unselectAll(){this.model.symbolsSelected.length&&(this.model.symbolsSelected.forEach(t=>{t.selected=!1,this.renderer.drawSymbol(t)}),this.selector.removeSelectedGroup(),this.updateLayerUI(),this.event.emitSelected(this.model.symbolsSelected))}async importPointEvents(t){this.logger.info("importPointEvents",{partialStrokes:t}),this.updateLayerState(!1);const n=dfe(t);return n.forEach(s=>{this.model.addSymbol(s),this.renderer.drawSymbol(s)}),this.recognizer.addStrokes(n,!1),this.history.push(this.model,{added:n}),this.logger.debug("importPointEvents",this.model),this.updateLayerUI(),this.event.emitImported(this.model.exports),this.model}triggerDownload(t,n){const s=document.createElement("a");s.setAttribute("href",n),s.setAttribute("download",t),document.body.appendChild(s),s.click(),s.remove()}getSymbolsBounds(t,n=10){const s=at.createFromBoxes(t.map(o=>o.bounds));return s.x-=n,s.y-=n,s.width+=2*n,s.height+=2*n,s}buildBlobFromSymbols(t,n){const s=He.createLayer(n);t.forEach(i=>{var l;const a=(l=this.renderer.getElementById(i.id))==null?void 0:l.cloneNode(!0);a&&s.appendChild(a)});const o=new XMLSerializer().serializeToString(s);return new Blob([o],{type:"image/svg+xml;charset=utf-8"})}getExportName(t){const n={year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"};try{return`iink-ts-${new Date().toLocaleDateString(navigator.language,n)}.${t}`}catch{return`iink-ts-${new Date().toLocaleDateString("en-US",n)}.${t}`}}downloadAsSVG(t=!1){const n=t?this.model.symbolsSelected:this.model.symbols,s=this.getSymbolsBounds(n),o=this.buildBlobFromSymbols(n,s),i=URL.createObjectURL(o);this.triggerDownload(this.getExportName("svg"),i)}downloadAsPNG(t=!1){const n=t?this.model.symbolsSelected:this.model.symbols,s=this.getSymbolsBounds(n),o=this.buildBlobFromSymbols(n,s),i=URL.createObjectURL(o),a=new Image(s.width,s.height);a.src=i,a.onload=()=>{const l=document.createElement("canvas");l.width=a.width,l.height=a.height,l.getContext("2d").drawImage(a,0,0),URL.revokeObjectURL(i);const c=l.toDataURL("image/png").replace("image/png","image/octet-stream");this.triggerDownload(this.getExportName("png"),c)}}downloadAsJson(t=!1){const n=t?this.model.symbolsSelected:this.model.symbols,s="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(n,null,2));this.triggerDownload(this.getExportName("json"),s)}extractStrokesFromSymbols(t){if(!(t!=null&&t.length))return[];const n=[];return t.forEach(s=>{switch(s.type){case oe.Stroke:n.push(s);break;case oe.Recognized:n.push(...s.strokes);break;case oe.Group:n.push(...s.extractStrokes())}}),n}extractTextsFromSymbols(t){if(!(t!=null&&t.length))return[];const n=[];return t.forEach(s=>{switch(s.type){case oe.Text:n.push(s);break;case oe.Group:n.push(...s.extractText())}}),n}extractBackendChanges(t){var a,l,c,u,p;const n={};n.added=this.extractStrokesFromSymbols(t.added),n.erased=this.extractStrokesFromSymbols(t.erased);const s=this.extractStrokesFromSymbols(t.updated),o=s.concat(this.extractStrokesFromSymbols((a=t.replaced)==null?void 0:a.oldSymbols)),i=s.concat(this.extractStrokesFromSymbols((l=t.replaced)==null?void 0:l.newSymbols));return o.length&&i.length?n.replaced={oldStrokes:o,newStrokes:i}:(n.added.push(...i),n.erased.push(...o)),t.matrix&&(n.matrix={strokes:this.extractStrokesFromSymbols(t.matrix.symbols),matrix:t.matrix.matrix}),(c=t.translate)!=null&&c.length&&(n.translate=[],t.translate.forEach(f=>{const m=this.extractStrokesFromSymbols(f.symbols);m.length&&n.translate.push({strokes:m,tx:f.tx,ty:f.ty})})),(u=t.scale)!=null&&u.length&&(n.scale=[],t.scale.forEach(f=>{const m=this.extractStrokesFromSymbols(f.symbols);m.length&&n.scale.push({strokes:m,origin:f.origin,scaleX:f.scaleX,scaleY:f.scaleY})})),(p=t.rotate)!=null&&p.length&&(n.rotate=[],t.rotate.forEach(f=>{const m=this.extractStrokesFromSymbols(f.symbols);m.length&&n.rotate.push({strokes:m,center:f.center,angle:f.angle})})),n}async undo(){var t,n,s,o,i;if(this.logger.info("undo"),this.history.context.canUndo){this.updateLayerState(!1),this.unselectAll();const a=this.history.undo(),l=a.model.extractDifferenceSymbols(this.model);Je(this,Xd,a.model.clone()),this.logger.debug("undo",{previousStackItem:a});const c=this.extractBackendChanges(a.changes);l.removed.forEach(u=>this.renderer.removeSymbol(u.id)),l.added.forEach(u=>this.renderer.drawSymbol(u)),((t=c.added)!=null&&t.length||(n=c.erased)!=null&&n.length||c.replaced||c.matrix||(s=c.translate)!=null&&s.length||(o=c.scale)!=null&&o.length||(i=c.rotate)!=null&&i.length)&&await this.recognizer.undo(c),this.updateLayerUI()}return this.model}async redo(){var t,n,s,o,i;if(this.logger.info("redo"),this.history.context.canRedo){this.updateLayerState(!1),this.unselectAll();const a=this.history.redo(),l=a.model.extractDifferenceSymbols(this.model);Je(this,Xd,a.model.clone()),this.logger.debug("redo",{modifications:l});const c=this.extractBackendChanges(a.changes);l.removed.forEach(u=>this.renderer.removeSymbol(u.id)),l.added.forEach(u=>this.renderer.drawSymbol(u)),((t=c.added)!=null&&t.length||(n=c.erased)!=null&&n.length||c.replaced||c.matrix||(s=c.translate)!=null&&s.length||(o=c.scale)!=null&&o.length||(i=c.rotate)!=null&&i.length)&&await this.recognizer.redo(c),this.updateLayerUI()}return this.model}async export(t){try{this.logger.info("export",{mimeTypes:t});const n=await this.recognizer.export(t);this.model.mergeExport(n)}catch(n){throw this.logger.error("export",{error:n}),this.manageError(n),n}return this.model}async convert(){await this.convertSymbols()}async convertSymbols(t){try{this.updateLayerState(!1),await this.converter.apply(t),this.event.emitConverted(this.model.converts)}catch(n){throw this.logger.error("convert",n),this.manageError(n),n}finally{this.updateLayerUI()}}async waitForIdle(){return this.recognizer.waitForIdle()}async resize({height:t,width:n}={}){try{this.logger.info("resize",{height:t,width:n});const s=window.getComputedStyle(this.layers.root);t=t||Math.max(parseInt(s.height.replace("px","")),this.configuration.rendering.minHeight),n=n||Math.max(parseInt(s.width.replace("px","")),this.configuration.rendering.minWidth),this.updateLayerState(!1),this.model.height=t,this.model.width=n,this.renderer.resize(t,n),this.updateLayerUI(50),this.updateLayerState(!0)}catch(s){this.manageError(s)}}async clear(){try{if(this.logger.info("clear"),this.updateLayerState(!1),this.model.symbols.length){this.selector.removeSelectedGroup();const t=this.model.symbols;this.renderer.clear(),this.model.clear(),this.history.push(this.model,{erased:t}),this.recognizer.clear(),this.event.emitSelected(this.model.symbolsSelected)}this.updateLayerUI(),this.event.emitCleared()}catch(t){this.manageError(t)}}async destroy(){return this.logger.info("destroy"),this.eraser.detach(),this.selector.detach(),this.move.detach(),this.writer.detach(),this.renderer.destroy(),this.menu.destroy(),this.recognizer.destroy(),this.model.clear(),this.history.clear(),Promise.resolve()}}Ds=new WeakMap,Xd=new WeakMap,Zd=new WeakMap,fg=new WeakMap,gg=new WeakMap,Jd=new WeakMap;const B7={exportContent:"QUIET_PERIOD",exportContentDelay:1e3,resizeTriggerDelay:100},zd={server:P0.server,recognition:P0.recognition,rendering:O7,grabber:tS,triggers:B7,"undo-redo":nS,logger:Zh,penStyle:{},theme:lI};class uge{constructor(e){k(this,"server");k(this,"recognition");k(this,"rendering");k(this,"undo-redo");k(this,"grabber");k(this,"triggers");k(this,"logger");k(this,"penStyle");k(this,"penStyleClasses");k(this,"theme");const{server:t,recognition:n}=new P7(e);this.server=t,this.recognition=n,this.rendering=It({},zd.rendering,e==null?void 0:e.rendering),this.grabber=It({},zd.grabber,e==null?void 0:e.grabber),this["undo-redo"]=It({},zd["undo-redo"],e==null?void 0:e["undo-redo"]),this.triggers=It({},zd.triggers,e==null?void 0:e.triggers),this.logger=It({},zd.logger,e==null?void 0:e.logger),this.penStyle=It({},zd.penStyle,e==null?void 0:e.penStyle),this.penStyleClasses=(e==null?void 0:e.penStyleClasses)||this.penStyleClasses,this.theme=It({},zd.theme,e==null?void 0:e.theme)}}var us,gr,mg,yg,vg;class hge extends Jb{constructor(t,n){var s,o,i,a;super(t,n);De(this,us);De(this,gr);De(this,mg);De(this,yg);k(this,"grabber");k(this,"renderer");k(this,"recognizer");k(this,"history");k(this,"styleManager");De(this,vg,Pt.Write);if(Je(this,us,new uge(n==null?void 0:n.configuration)),this.styleManager=new S7((s=n==null?void 0:n.configuration)==null?void 0:s.penStyle,(o=n==null?void 0:n.configuration)==null?void 0:o.theme),(i=n==null?void 0:n.override)==null?void 0:i.grabber){const l=n.override.grabber;this.grabber=new l(j(this,us).grabber)}else this.grabber=new mp(j(this,us).grabber);if(this.grabber.onPointerDown=this.onPointerDown.bind(this),this.grabber.onPointerMove=this.onPointerMove.bind(this),this.grabber.onPointerUp=this.onPointerUp.bind(this),(a=n==null?void 0:n.override)==null?void 0:a.recognizer){const l=n.override.recognizer;this.recognizer=new l(j(this,us))}else this.recognizer=new kfe(j(this,us));this.renderer=new zfe(j(this,us).rendering),this.tool=Pt.Write,Je(this,gr,new k0),this.history=new z7(j(this,us)["undo-redo"],this.event)}onPointerDown(t){var s;this.logger.info("onPointerDown",{tool:this.tool,info:t});const n=Object.assign({},(s=this.theme)==null?void 0:s.ink,this.currentPenStyle);switch(this.tool){case Pt.Erase:this.model.removeStrokesFromPoint(t.pointer).length>0&&this.renderer.drawModel(this.model);break;case Pt.Write:this.model.initCurrentStroke(t.pointer,t.pointerType,n),this.drawCurrentStroke();break;default:this.logger.warn("#onPointerDown",`onPointerDown tool unknow: "${this.tool}"`)}}onPointerMove(t){switch(this.logger.info("onPointerMove",{tool:this.tool,info:t}),this.tool){case Pt.Erase:this.model.removeStrokesFromPoint(t.pointer).length>0&&this.renderer.drawModel(this.model);break;case Pt.Write:this.model.appendToCurrentStroke(t.pointer),this.drawCurrentStroke();break;default:this.logger.warn("#onPointerMove",`onPointerMove tool unknow: "${this.tool}"`)}}async onPointerUp(t){var n;try{switch(this.logger.info("onPointerUp",{tool:this.tool,info:t}),this.tool){case Pt.Erase:this.model.removeStrokesFromPoint(t.pointer),((n=this.history.stack.at(-1))==null?void 0:n.modificationDate)!==this.model.modificationDate&&await this.updateModelRendering();break;case Pt.Write:this.model.endCurrentStroke(t.pointer),await this.updateModelRendering();break;default:this.logger.warn("#onPointerUp",`onPointerUp tool unknow: "${this.tool}"`)}}catch(s){throw this.layers.showMessageError(s),this.event.emitError(s),s}}get initializationPromise(){return Promise.resolve()}get tool(){return j(this,vg)}set tool(t){Je(this,vg,t),this.setCursorStyle()}setCursorStyle(){this.tool===Pt.Erase?(this.layers.root.classList.remove("draw"),this.layers.root.classList.add("erase")):(this.layers.root.classList.add("draw"),this.layers.root.classList.remove("erase"))}get model(){return j(this,gr)}get currentPenStyle(){return this.styleManager.currentPenStyle}get penStyle(){return this.styleManager.penStyle}set penStyle(t){this.logger.info("setPenStyle",{penStyle:t}),this.styleManager.setPenStyle(t)}get penStyleClasses(){return this.styleManager.penStyleClasses}set penStyleClasses(t){this.logger.info("setPenStyleClasses",{penStyleClasses:t}),this.styleManager.setPenStyleClasses(t)}get theme(){return this.styleManager.theme}set theme(t){this.logger.info("setTheme",{theme:t}),this.styleManager.setTheme(t)}get configuration(){return j(this,us)}async initialize(){try{this.logger.info("initialize"),this.layers.render(),this.layers.showLoader();const t=window.getComputedStyle(this.layers.root);this.model.width=Math.max(parseInt(t.width.replace("px","")),j(this,us).rendering.minWidth),this.model.height=Math.max(parseInt(t.height.replace("px","")),j(this,us).rendering.minHeight),this.history.push(this.model),this.layers.rendering.classList.add(this.configuration.recognition.type.toLowerCase().replace(" ","-")),this.renderer.init(this.layers.rendering,{x:50,y:50}),this.grabber.attach(this.layers.rendering)}catch(t){throw this.logger.error("initialize",t),this.layers.showMessageError(t),t}finally{this.logger.debug("initialize","finally"),this.layers.hideLoader(),this.layers.updateState(!0)}}drawCurrentStroke(){this.logger.debug("drawCurrentStroke",{stroke:this.model.currentSymbol}),this.renderer.drawPendingStroke(this.model.currentSymbol)}async updateModelRendering(){this.logger.info("updateModelRendering"),this.renderer.drawModel(this.model);const t=new Xt;if(this.history.push(this.model),j(this,us).triggers.exportContent!=="DEMAND"){clearTimeout(j(this,yg));let n=this.model.clone();Je(this,yg,setTimeout(async()=>{try{n=await this.recognizer.export(n),this.history.updateStack(n),this.model.modificationDate===n.modificationDate&&(this.model.exports=n.exports),t.resolve(this.model)}catch(s){this.logger.error("updateModelRendering",{error:s}),this.event.emitError(s),t.reject(s)}},j(this,us).triggers.exportContent==="QUIET_PERIOD"?j(this,us).triggers.exportContentDelay:0))}else t.resolve(this.model);return await t.promise,this.event.emitExported(this.model.exports),this.logger.debug("updateModelRendering",this.model.exports),t.promise}async export(t){this.logger.info("export",{mimeTypes:t});const n=await this.recognizer.export(this.model.clone(),t);return this.model.modificationDate===n.modificationDate&&this.model.mergeExport(n.exports),this.history.updateStack(n),this.event.emitExported(this.model.exports),this.logger.debug("export",this.model),this.model}async convert(t){this.logger.info("convert",{params:t});const n=await this.recognizer.convert(this.model,t==null?void 0:t.conversionState,t==null?void 0:t.mimeTypes);return Object.assign(j(this,gr),n),this.event.emitConverted(this.model.converts),this.logger.debug("convert",this.model),this.model}async importPointEvents(t){const n=[];t.forEach((s,o)=>{var l,c;let i=!0;const a=new am(s.style||aI,s.pointerType);if(s.id&&(a.id=s.id),!((l=s.pointers)!=null&&l.length))return n.push(`stroke ${o+1} has not pointers`),void(i=!1);(c=s.pointers)==null||c.forEach((u,p)=>{if(!u)return n.push(`stroke ${o+1} has no pointer at ${p}`),void(i=!1);const f={p:u.p||1,t:u.t||p,x:0,y:0};return(u==null?void 0:u.x)==null||(u==null?void 0:u.x)==null?(n.push(`stroke ${o+1} has no x at pointer at ${p}`),void(i=!1)):(f.x=u.x,(u==null?void 0:u.y)==null||(u==null?void 0:u.y)==null?(n.push(`stroke ${o+1} has no y at pointer at ${p}`),void(i=!1)):(f.y=u.y,void(i&&a.pointers.push(f))))}),i&&this.model.addStroke(a)}),n.length&&this.event.emitError(new Error(n.join(`
`)));try{const s=await this.updateModelRendering();return Object.assign(j(this,gr),s),this.event.emitImported(this.model.exports),this.model}catch(s){throw this.event.emitError(s),s}}async resize({height:t,width:n}={}){this.logger.info("resize",{height:t,width:n});const s=new Xt,o=window.getComputedStyle(this.layers.root);this.model.height=t||Math.max(parseInt(o.height.replace("px","")),this.configuration.rendering.minHeight),this.model.width=n||Math.max(parseInt(o.width.replace("px","")),this.configuration.rendering.minWidth),this.renderer.resize(this.model),this.model.symbols.length?(clearTimeout(j(this,mg)),Je(this,mg,setTimeout(async()=>{const i=await this.recognizer.resize(this.model);s.resolve(i)},j(this,us).triggers.resizeTriggerDelay))):s.resolve(this.model),Je(this,gr,await s.promise),this.logger.debug("resize",{model:this.model}),this.event.emitExported(this.model.exports)}async undo(){this.logger.info("undo"),Je(this,gr,this.history.undo()),this.renderer.drawModel(j(this,gr)),Je(this,gr,await this.recognizer.export(j(this,gr))),this.history.updateStack(j(this,gr)),this.event.emitExported(j(this,gr).exports),this.logger.debug("undo",j(this,gr))}async redo(){this.logger.info("redo"),Je(this,gr,this.history.redo()),this.renderer.drawModel(j(this,gr)),Je(this,gr,await this.recognizer.export(j(this,gr))),this.history.updateStack(j(this,gr)),this.event.emitExported(j(this,gr).exports),this.logger.debug("redo",j(this,gr))}async clear(){this.logger.info("clear"),this.model.clear(),this.history.push(this.model),this.renderer.drawModel(this.model),this.event.emitExported(this.model.exports),this.event.emitCleared(),this.logger.debug("clear",this.model)}async destroy(){return this.logger.info("destroy"),this.event.removeAllListeners(),this.grabber.detach(),this.layers.destroy(),this.renderer.destroy(),Promise.resolve()}}us=new WeakMap,gr=new WeakMap,mg=new WeakMap,yg=new WeakMap,vg=new WeakMap;var _i,Ro,Ga,es,Ti,Kc,ts,so,Wa,Ka,Va,Qd,Fr,Et,U7,H7,G7,W7,K7,V7,q7,Y7,X7,Z7,J7,F0,Av,Q7,Hd,bg,Sg,eB,tB,xg,wg,Cg,Eg,kg,Pg,nB,rB;class pge{constructor(e){De(this,Et);k(this,"uuid");De(this,_i);De(this,Ro);De(this,Ga);De(this,es);De(this,Ti);De(this,Kc);De(this,ts);De(this,so);De(this,Wa);De(this,Ka);De(this,Va);De(this,Qd);k(this,"editor");k(this,"margin");k(this,"jiix");k(this,"lastWord");k(this,"wordToChange");De(this,Fr,Rt.getLogger(lt.SMARTGUIDE));De(this,F0,e=>{var s,o;j(this,Fr).info("showCandidates",{target:e});const t=parseInt(e.id.replace("word-","").replace(this.uuid,"")),n=(s=this.jiix)==null?void 0:s.words;this.wordToChange=n[t],this.wordToChange&&(this.wordToChange.id=t.toString(),j(this,ts).innerHTML="",(o=this.wordToChange)!=null&&o.candidates&&(j(this,ts).style.display="flex",this.wordToChange.candidates.forEach((i,a)=>{var l;((l=this.wordToChange)==null?void 0:l.label)===i?j(this,ts).innerHTML+=`<span id="cdt-${a}${this.uuid}" class="selected-word">${i}</span>`:j(this,ts).innerHTML+=`<span id="cdt-${a}${this.uuid}">${i}</span>`}),e.appendChild(j(this,ts))))});De(this,bg,e=>{j(this,Fr).info("onClickEllipsis",{evt:e}),e.preventDefault(),e.stopPropagation(),j(this,Qd)?an(this,Et,Hd).call(this):an(this,Et,Q7).call(this),an(this,Et,Av).call(this)});De(this,Sg,e=>{j(this,Fr).info("onClickConvert",{evt:e}),e.preventDefault(),e.stopPropagation(),this.editor.convert(),an(this,Et,Hd).call(this)});De(this,xg,async e=>{j(this,Fr).info("onClickCopy",{evt:e}),e.preventDefault(),e.stopPropagation();try{an(this,Et,Hd).call(this);let t="Nothing to copy";if(j(this,es).innerText){t=`"${j(this,es).innerText}" copied to clipboard`;const n=an(this,Et,eB).call(this,j(this,es).innerText);j(this,Ga).appendChild(n),an(this,Et,tB).call(this,n),document.execCommand("copy"),n.remove()}this.editor.event.emitNotif({message:t,timeout:1500})}catch(t){j(this,Fr).error("onClickCopy",t),this.editor.event.emitError(t)}});De(this,wg,e=>{j(this,Fr).info("onClickDelete",{evt:e}),e.preventDefault(),e.stopPropagation(),this.editor.clear(),an(this,Et,Hd).call(this)});De(this,Cg,e=>{var n,s,o,i,a;j(this,Fr).info("onClickCandidate",{evt:e}),e.preventDefault(),e.stopPropagation();const t=e.target.innerText;(n=this.jiix)!=null&&n.words&&t!==((s=this.wordToChange)==null?void 0:s.label)&&((i=(o=this.wordToChange)==null?void 0:o.candidates)!=null&&i.includes(t))&&(this.jiix.words[parseInt((a=this.wordToChange)==null?void 0:a.id)].label=t,this.editor.import(new Blob([JSON.stringify(this.jiix)],{type:E0.JIIX}),E0.JIIX)),j(this,ts).style.display="none"});De(this,Eg,e=>{j(this,Fr).info("onClickPrompter",{evt:e}),e.preventDefault(),e.stopPropagation(),an(this,Et,Hd).call(this);const t=e.target;t.id!==j(this,es).id?j(this,F0).call(this,t):an(this,Et,Av).call(this)});De(this,kg,e=>{e.preventDefault(),e.stopPropagation()});De(this,Pg,()=>{an(this,Et,Av).call(this),an(this,Et,Hd).call(this)});j(this,Fr).info("constructor"),this.uuid=zo(),this.editor=e,this.margin={bottom:0,left:0,right:0,top:0},an(this,Et,U7).call(this),an(this,Et,H7).call(this),an(this,Et,G7).call(this),an(this,Et,W7).call(this),an(this,Et,K7).call(this),an(this,Et,V7).call(this),an(this,Et,q7).call(this),an(this,Et,Y7).call(this),an(this,Et,X7).call(this),an(this,Et,Z7).call(this),an(this,Et,J7).call(this)}init(e,t){j(this,Fr).info("init",{domElement:e,margin:t});const n=document.createElement("style");n.appendChild(document.createTextNode(".ms-editor .smartguide{background-color:#fff;box-shadow:2px 2px 12px #bdbdbd;cursor:default;font-size:16px;left:0;line-height:48px;padding-bottom:12px;padding-top:12px;position:absolute;top:0;width:100%;z-index:40}.ms-editor .smartguide .smartguide-wrapper{border-bottom:1px solid #959da6;display:flex}.ms-editor .smartguide .tag-icon{background-color:hsla(0,0%,100%,.9);border-left:1px solid #959da6;border-right:1px solid #959da6;border-top:1px solid #959da6;font-size:large;height:100%;line-height:48px;padding:0 18px;z-index:31}.ms-editor .smartguide .ellipsis,.ms-editor .smartguide .tag-icon{color:#959da6;font-weight:700;height:48px;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none;width:48px}.ms-editor .smartguide .ellipsis{-webkit-tap-highlight-color:transparent;cursor:pointer;font-size:x-large;line-height:38px;padding:0 8px}.ms-editor .smartguide .ellipsis:active{background-color:#e0e0e0}.ms-editor .smartguide .prompter-container{-webkit-tap-highlight-color:transparent;color:#bfbfbf;display:block;height:48px;line-height:48px;overflow:hidden;text-align:left;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none;white-space:nowrap;width:calc(100% - 96px)}.ms-editor .smartguide .prompter-container>div>span{cursor:pointer;display:inline-block}.ms-editor .smartguide .prompter-container .prompter-text{margin-left:12px}.ms-editor .smartguide .prompter-container .prompter-text .added-word{animation:word-added .1s linear,color-input 3s ease-in-out}.ms-editor .smartguide .prompter-container .prompter-text .modified-word{animation:word-modified .1s linear,color-input 3s ease-in-out}.ms-editor .smartguide .candidates{-webkit-tap-highlight-color:transparent;background-color:#f5f5f5;border-radius:3px;box-shadow:2px 2px 12px #bdbdbd,-2px 2px 12px #bdbdbd;color:#000;flex-direction:column;line-height:30px;position:absolute;text-align:center;z-index:100}.ms-editor .smartguide .candidates>span{cursor:pointer;padding:2px 20px}.ms-editor .smartguide .candidates>span:hover{background-color:#eee}.ms-editor .smartguide .candidates>span:active{background-color:#e0e0e0}.ms-editor .smartguide .candidates .selected-word{background-color:#e0e0e0;font-weight:700}.ms-editor .smartguide .more-menu{background-color:#f5f5f5;border-radius:3px;bottom:0;box-shadow:2px 2px 12px #bdbdbd;display:flex;flex-direction:column;line-height:30px;margin-right:12px;overflow:hidden;position:absolute;right:0;transform:translateY(100%);transition:max-height 1s ease-out,opacity 1s,visibility .5s linear;z-index:100}.ms-editor .smartguide .more-menu.open{max-height:500px;opacity:1;visibility:visible}.ms-editor .smartguide .more-menu.close{max-height:0;opacity:0;visibility:hidden}.ms-editor .smartguide .more-menu .options-label-button{-webkit-tap-highlight-color:transparent;background:transparent;border:none;box-sizing:border-box;color:#000;cursor:pointer;font-size:16px;height:40px;margin:0;outline:none;padding:0 24px}.ms-editor .smartguide .more-menu .options-label-button:hover{background-color:#eee;padding:4px}.ms-editor .smartguide .more-menu .options-label-button:active{background-color:#e0e0e0}@keyframes color-input{0%{color:#000}to{color:#bfbfbf}}@keyframes word-added{0%{transform:translate(5px)}to{transform:none}}@keyframes word-modified{0%{transform:translateY(5px)}to{transform:none}}")),e.appendChild(n),e.appendChild(j(this,_i)),j(this,_i).appendChild(j(this,Ro)),j(this,Ro).appendChild(j(this,Kc)),j(this,Ga).appendChild(j(this,es)),j(this,Ro).appendChild(j(this,Ga)),j(this,Ro).appendChild(j(this,Ti)),j(this,so).appendChild(j(this,Wa)),j(this,so).appendChild(j(this,Ka)),j(this,so).appendChild(j(this,Va)),j(this,so).classList.add("close"),j(this,Ro).appendChild(j(this,so)),Je(this,Qd,!1),j(this,ts).style.display="none",j(this,Ro).appendChild(j(this,ts)),this.margin=t,an(this,Et,nB).call(this),this.resize()}resize(){j(this,Fr).info("resize");const e=ot(this.margin.left),t=ot(this.margin.right);j(this,Ro).style.marginLeft=`${e}px`,j(this,Ro).style.marginRight=`${t}px`}update(e){var n,s;j(this,Fr).info("update",{exports:e}),this.jiix=e;const t=(o,i)=>{const a=document.createElement("span");return a.id=`word-${o}${this.uuid}`,i?a.textContent=i.label:a.innerHTML="&nbsp;",j(this,Fr).debug("update",{span:a}),a};(()=>{var o;if(j(this,Fr).info("populatePrompter"),j(this,es).innerHTML="",(o=this.jiix)==null?void 0:o.words){const i=this.jiix.words,a=document.createDocumentFragment();i.forEach((l,c)=>{var u,p,f;if(l.label===" "||l.label.includes(`
`))a.appendChild(t(c));else if(c!==i.length-1)a.appendChild(t(c,l));else{j(this,es).appendChild(a),this.lastWord&&(this.lastWord=l);const m=t(c,l);((u=this.lastWord)==null?void 0:u.candidates)!==l.candidates&&((p=this.lastWord)==null?void 0:p.label)!==l.label&&(this.lastWord=l),((f=this.wordToChange)==null?void 0:f.id)===c.toString()?(m.classList.add("modified-word"),this.wordToChange=void 0):m.classList.add("added-word"),j(this,es).appendChild(m),j(this,Ga).scrollLeft=m.offsetLeft,j(this,Fr).debug("update => populatePrompter",{span:m,lastWord:this.lastWord})}})}})(),(s=(n=this.jiix)==null?void 0:n.words)!=null&&s.length?j(this,Ti).style.setProperty("pointer-events","auto"):j(this,Ti).style.setProperty("pointer-events","none")}clear(){j(this,Fr).info("clear"),j(this,es).innerHTML="",j(this,ts).innerHTML=""}destroy(){j(this,Fr).info("destroy"),an(this,Et,rB).call(this),j(this,_i).remove()}}_i=new WeakMap,Ro=new WeakMap,Ga=new WeakMap,es=new WeakMap,Ti=new WeakMap,Kc=new WeakMap,ts=new WeakMap,so=new WeakMap,Wa=new WeakMap,Ka=new WeakMap,Va=new WeakMap,Qd=new WeakMap,Fr=new WeakMap,Et=new WeakSet,U7=function(){Je(this,_i,document.createElement("div")),j(this,_i).id=`smartguide-${this.uuid}`,j(this,_i).classList.add("smartguide"),j(this,_i).addEventListener("pointerdown",e=>{e.preventDefault(),e.stopPropagation()})},H7=function(){Je(this,Ro,document.createElement("div")),j(this,Ro).id=`smartguide-wrapper-${this.uuid}`,j(this,Ro).classList.add("smartguide-wrapper")},G7=function(){Je(this,Ga,document.createElement("div")),j(this,Ga).id=`prompter-container-${this.uuid}`,j(this,Ga).classList.add("prompter-container")},W7=function(){Je(this,es,document.createElement("div")),j(this,es).id=`prompter-text-${this.uuid}`,j(this,es).classList.add("prompter-text"),j(this,es).setAttribute("touch-action","none")},K7=function(){Je(this,Ti,document.createElement("div")),j(this,Ti).id=`ellipsis-${this.uuid}`,j(this,Ti).classList.add("ellipsis"),j(this,Ti).innerHTML="..."},V7=function(){Je(this,Kc,document.createElement("div")),j(this,Kc).id=`tag-icon-${this.uuid}`,j(this,Kc).classList.add("tag-icon"),j(this,Kc).innerHTML="&#182;"},q7=function(){Je(this,ts,document.createElement("div")),j(this,ts).id=`candidates-${this.uuid}`,j(this,ts).classList.add("candidates")},Y7=function(){Je(this,so,document.createElement("div")),j(this,so).id=`more-menu-${this.uuid}`,j(this,so).classList.add("more-menu")},X7=function(){Je(this,Wa,document.createElement("button")),j(this,Wa).id=`convert-${this.uuid}`,j(this,Wa).classList.add("options-label-button"),j(this,Wa).innerHTML="Convert"},Z7=function(){Je(this,Ka,document.createElement("button")),j(this,Ka).id=`copy-${this.uuid}`,j(this,Ka).classList.add("options-label-button"),j(this,Ka).innerHTML="Copy"},J7=function(){Je(this,Va,document.createElement("button")),j(this,Va).id=`delete-${this.uuid}`,j(this,Va).classList.add("options-label-button"),j(this,Va).innerHTML="Delete"},F0=new WeakMap,Av=function(){j(this,ts).style.display="none"},Q7=function(){j(this,so).classList.add("open"),j(this,so).classList.remove("close"),Je(this,Qd,!0)},Hd=function(){j(this,so).classList.add("close"),j(this,so).classList.remove("open"),Je(this,Qd,!1)},bg=new WeakMap,Sg=new WeakMap,eB=function(e){const t=document.documentElement.getAttribute("dir")==="rtl",n=document.createElement("textarea");n.style.fontSize="12pt",n.style.display="absolute",n.style[t?"right":"left"]="-9999px";const s=window.pageYOffset||document.documentElement.scrollTop;return n.style.top=`${s}px`,n.setAttribute("readonly",""),n.value=e,n},tB=function(e){if(navigator.userAgent.match(/ipad|iphone/i)){const t=document.createRange();t.selectNodeContents(e);const n=window.getSelection();n&&(n.removeAllRanges(),n.addRange(t),e.setSelectionRange(0,999999))}else e.select()},xg=new WeakMap,wg=new WeakMap,Cg=new WeakMap,Eg=new WeakMap,kg=new WeakMap,Pg=new WeakMap,nB=function(){j(this,_i).addEventListener("pointerdown",j(this,kg).bind(this)),j(this,Ti).addEventListener("pointerdown",j(this,bg).bind(this)),j(this,Wa).addEventListener("pointerdown",j(this,Sg).bind(this)),j(this,Ka).addEventListener("pointerdown",j(this,xg).bind(this)),j(this,Va).addEventListener("pointerdown",j(this,wg).bind(this)),j(this,es).addEventListener("pointerdown",j(this,Eg).bind(this)),j(this,ts).addEventListener("pointerdown",j(this,Cg).bind(this)),document.addEventListener("pointerdown",j(this,Pg).bind(this))},rB=function(){j(this,_i).addEventListener("pointerdown",j(this,kg)),j(this,Ti).removeEventListener("pointerdown",j(this,bg)),j(this,Wa).removeEventListener("pointerdown",j(this,Sg)),j(this,Ka).removeEventListener("pointerdown",j(this,xg)),j(this,Va).removeEventListener("pointerdown",j(this,wg)),j(this,es).removeEventListener("pointerdown",j(this,Eg)),j(this,ts).removeEventListener("pointerdown",j(this,Cg)),document.removeEventListener("pointerdown",j(this,Pg))};const fge={exportContent:"POINTER_UP",exportContentDelay:1e3,resizeTriggerDelay:100},Dc={server:T0.server,recognition:T0.recognition,rendering:O7,smartGuide:{enable:!0},grabber:tS,triggers:fge,"undo-redo":nS,logger:Zh,penStyle:{},theme:lI};class gge{constructor(e){k(this,"server");k(this,"recognition");k(this,"rendering");k(this,"smartGuide");k(this,"undo-redo");k(this,"grabber");k(this,"triggers");k(this,"logger");k(this,"penStyle");k(this,"penStyleClasses");k(this,"theme");const{server:t,recognition:n}=new A7(e);this.server=t,this.recognition=n,this.rendering=It({},Dc.rendering,e==null?void 0:e.rendering),this.smartGuide=It({},Dc.smartGuide,e==null?void 0:e.smartGuide),this["undo-redo"]=It({},Dc["undo-redo"],e==null?void 0:e["undo-redo"]),this.grabber=It({},Dc.grabber,e==null?void 0:e.grabber),this.triggers=It({},Dc.triggers,e==null?void 0:e.triggers),this.logger=It({},Dc.logger,e==null?void 0:e.logger),this.penStyle=It({},Dc.penStyle,e==null?void 0:e.penStyle),this.penStyleClasses=(e==null?void 0:e.penStyleClasses)||this.penStyleClasses,this.theme=It({},Dc.theme,e==null?void 0:e.theme),this.recognition.type!=="TEXT"&&(this.smartGuide.enable=!1),this.smartGuide.enable&&!this.recognition.text.mimeTypes.includes("application/vnd.myscript.jiix")&&this.recognition.text.mimeTypes.push("application/vnd.myscript.jiix")}}var Os,ta,Ig,_g;class mge extends Jb{constructor(t,n){var s,o,i,a;super(t,n);De(this,Os);De(this,ta);De(this,Ig);k(this,"smartGuide");k(this,"grabber");k(this,"renderer");k(this,"recognizer");k(this,"history");k(this,"styleManager");De(this,_g,Pt.Write);if(Je(this,Os,new gge(n==null?void 0:n.configuration)),this.styleManager=new S7((s=n==null?void 0:n.configuration)==null?void 0:s.penStyle,(o=n==null?void 0:n.configuration)==null?void 0:o.theme),(i=n==null?void 0:n.override)==null?void 0:i.grabber){const l=n.override.grabber;this.grabber=new l(j(this,Os).grabber)}else this.grabber=new mp(j(this,Os).grabber);if((a=n==null?void 0:n.override)!=null&&a.recognizer){const l=n.override.recognizer;this.recognizer=new l(j(this,Os))}else this.recognizer=new Ofe(j(this,Os));this.renderer=new Bfe(j(this,Os).rendering),this.tool=Pt.Write,Je(this,ta,new k0),this.history=new z7(j(this,Os)["undo-redo"],this.event)}get initializationPromise(){return this.recognizer.initialized.promise}get tool(){return j(this,_g)}set tool(t){Je(this,_g,t),this.setCursorStyle()}setCursorStyle(){this.tool===Pt.Erase?(this.layers.root.classList.remove("draw"),this.layers.root.classList.add("erase")):(this.layers.root.classList.add("draw"),this.layers.root.classList.remove("erase"))}get model(){return j(this,ta)}get configuration(){return j(this,Os)}get currentPenStyle(){return this.styleManager.currentPenStyle}get penStyle(){return this.styleManager.penStyle}set penStyle(t){this.logger.info("setPenStyle",{penStyle:t}),this.styleManager.setPenStyle(t),this.logger.debug("setPenStyle",this.styleManager.penStyle),this.recognizer.setPenStyle(this.styleManager.penStyle)}get penStyleClasses(){return this.styleManager.penStyleClasses}set penStyleClasses(t){this.logger.info("setPenStyleClasses",{penClass:t}),this.styleManager.setPenStyleClasses(t),this.logger.debug("setPenStyleClasses",this.styleManager.penStyleClasses),this.recognizer.setPenStyleClasses(this.styleManager.penStyleClasses)}get theme(){return this.styleManager.theme}set theme(t){this.logger.info("setTheme",{theme:t}),this.styleManager.setTheme(t),this.logger.debug("setTheme",this.styleManager.theme),this.recognizer.setTheme(this.styleManager.theme)}async syncStyle(){await Promise.all([this.recognizer.setPenStyle(this.styleManager.penStyle),this.recognizer.setPenStyleClasses(this.styleManager.penStyleClasses),this.recognizer.setTheme(this.styleManager.theme)])}onExport(t){if(this.logger.debug("onExport",{exports:t}),this.smartGuide&&(t==null?void 0:t["application/vnd.myscript.jiix"])){const n=t["application/vnd.myscript.jiix"];this.smartGuide.update(n)}this.model.mergeExport(t),this.event.emitExported(t)}onPointerDown(t){var s;this.logger.info("onPointerDown",{tool:this.tool,info:t});const n=Object.assign({},(s=this.theme)==null?void 0:s.ink,this.currentPenStyle);this.model.initCurrentStroke(t.pointer,this.tool===Pt.Erase?"eraser":t.pointerType,n),this.drawCurrentStroke()}onPointerMove(t){this.logger.info("onPointerMove",{tool:this.tool,info:t}),this.model.appendToCurrentStroke(t.pointer),this.drawCurrentStroke()}async onPointerUp(t){try{this.logger.info("onPointerUp",{tool:this.tool,info:t}),this.model.endCurrentStroke(t.pointer),await this.synchronizeModelWithBackend()}catch(n){this.event.emitError(n)}}onSVGPatch(t){this.logger.info("onSVGPatch",{evt:t}),this.renderer.updatesLayer(t.layer,t.updates)}initializeSmartGuide(){var t;if((t=this.smartGuide)==null||t.destroy(),this.logger.info("initializeSmartGuide",{smartGuide:this.configuration.smartGuide}),this.configuration.smartGuide.enable){this.smartGuide=new pge(this);let n=Qb;switch(this.configuration.recognition.type){case"TEXT":n=this.configuration.recognition.text.margin;break;case"MATH":n=this.configuration.recognition.math.margin}this.smartGuide.init(this.layers.ui.root,n)}}onContetChaned(t){this.history.context=t,this.event.emitChanged(t)}onError(t){this.layers.showMessageError(t),this.event.emitError(t)}async initialize(){try{this.logger.info("initialize"),this.layers.render(),this.layers.showLoader();const t=window.getComputedStyle(this.layers.root);this.model.width=Math.max(parseInt(t.width.replace("px","")),j(this,Os).rendering.minWidth),this.model.height=Math.max(parseInt(t.height.replace("px","")),j(this,Os).rendering.minHeight),this.history.push(this.model),this.renderer.init(this.layers.rendering),this.grabber.attach(this.layers.rendering),this.grabber.onPointerDown=this.onPointerDown.bind(this),this.grabber.onPointerMove=this.onPointerMove.bind(this),this.grabber.onPointerUp=this.onPointerUp.bind(this),this.initializeSmartGuide(),this.recognizer.configuration.server.version||(await this.loadInfo(this.configuration.server),this.recognizer.configuration.server.version=this.info.version),await this.recognizer.init(this.model.height,this.model.width),this.recognizer.event.addExportedListener(this.onExport.bind(this)),this.recognizer.event.addSVGPatchListener(this.onSVGPatch.bind(this)),this.recognizer.event.addContentChangedListener(this.onContetChaned.bind(this)),this.recognizer.event.addIdleListener(this.event.emitIdle.bind(this.event)),this.recognizer.event.addErrorListener(this.onError.bind(this)),await this.syncStyle()}catch(t){throw this.logger.error("initialize",t),this.layers.showMessageError(t),t}finally{this.logger.debug("initialize","finally"),this.layers.hideLoader(),this.layers.updateState(!0)}}drawCurrentStroke(){this.logger.debug("drawCurrentStroke",{stroke:this.model.currentSymbol});const t=this.model.currentSymbol;t&&this.renderer.drawPendingStroke(t)}async synchronizeModelWithBackend(){if(this.logger.info("synchronizeModelWithBackend"),j(this,Os).triggers.exportContent!=="DEMAND"){const t=this.model.extractUnsentStrokes();this.model.updatePositionSent(),this.history.push(this.model),this.renderer.clearErasingStrokes();const n=await this.recognizer.addStrokes(t);this.model.mergeExport(n),this.history.updateStack(this.model)}return this.logger.debug("synchronizeModelWithBackend",this.model),this.model}async waitForIdle(){return this.recognizer.waitForIdle()}async export(t){this.logger.info("export",{mimeTypes:t});try{if(j(this,Os).triggers.exportContent!=="DEMAND")return await this.recognizer.export(this.model,t);{const n=this.model.extractUnsentStrokes();this.history.push(this.model),this.history.stack.push(this.model.clone()),this.model.updatePositionSent();const s=await this.recognizer.addStrokes(n);this.model.updatePositionReceived(),this.model.mergeExport(s),this.logger.debug("export",this.model)}}catch(n){return this.logger.error("export",{error:n}),this.event.emitError(n),Promise.reject(n)}return this.model}async convert(t){return this.logger.info("convert",{params:t}),this.history.push(this.model),this.history.stack.push(this.model.clone()),Je(this,ta,await this.recognizer.convert(this.model,t==null?void 0:t.conversionState)),this.logger.debug("convert",this.model),this.history.push(this.model),this.event.emitConverted(this.model.converts),this.model}async import(t,n){let s;return s=t instanceof Blob?t:typeof t=="string"?new Blob([t]):new Blob([JSON.stringify(t)]),this.logger.info("import",{data:t,mimeType:n}),this.history.stack.push(this.model.clone()),Je(this,ta,await this.recognizer.import(this.model,s,n)),this.history.push(this.model),this.event.emitImported(this.model.exports),this.model}async importPointEvents(t){this.logger.info("importPointEvents",{strokes:t});const n=[],s=t.map((i,a)=>{var u,p;const l=new am(i.style||aI,i.pointerType);i.id&&(l.id=i.id),i.pointerType&&(l.pointerType=i.pointerType),(u=i.pointers)!=null&&u.length||n.push(`stroke ${a+1} has not pointers`);let c=!0;return(p=i.pointers)==null||p.forEach((f,m)=>{if(c=!0,!f)return void n.push(`stroke ${a+1} has no pointer at ${m}`);const v={p:f.p||1,t:f.t||m,x:0,y:0};(f==null?void 0:f.x)==null||(f==null?void 0:f.x)==null?(n.push(`stroke ${a+1} has no x at pointer at ${m}`),c=!1):v.x=f.x,(f==null?void 0:f.y)==null||(f==null?void 0:f.y)==null?(n.push(`stroke ${a+1} has no y at pointer at ${m}`),c=!1):v.y=f.y,c&&l.pointers.push(v)}),l});n.length&&this.event.emitError(new Error(n.join(`
`))),s.map(i=>this.model.addStroke(i));const o=await this.recognizer.importPointEvents(s);return this.model.mergeExport(o),this.event.emitImported(this.model.exports),this.logger.debug("importPointEvents",this.model),this.model}async resize({height:t,width:n}={}){var a;this.logger.info("resize",{height:t,width:n});const s=new Xt,o=window.getComputedStyle(this.layers.root);this.model.height=t||Math.max(parseInt(o.height.replace("px","")),this.configuration.rendering.minHeight),this.model.width=n||Math.max(parseInt(o.width.replace("px","")),this.configuration.rendering.minWidth);const i=this.model.clone();this.renderer.resize(i),clearTimeout(j(this,Ig)),Je(this,Ig,setTimeout(async()=>{try{const l=await this.recognizer.resize(i);s.resolve(l)}catch(l){this.logger.error("resize",{height:t,width:n,error:l}),s.reject(l)}},j(this,Os).triggers.resizeTriggerDelay)),Je(this,ta,await s.promise),(a=this.smartGuide)==null||a.resize(),this.event.emitExported(this.model.exports),this.logger.debug("resize",this.model)}async undo(){if(this.logger.info("undo"),this.history.context.canUndo)return Je(this,ta,this.history.undo()),this.recognizer.undo(this.model);throw new Error("Undo not allowed")}async redo(){if(this.logger.info("redo"),this.history.context.canRedo)return Je(this,ta,this.history.redo()),this.logger.debug("undo",j(this,ta)),this.recognizer.redo(this.model);throw new Error("Redo not allowed")}async clear(){this.logger.info("clear"),this.model.clear(),this.history.push(this.model),await this.recognizer.clear(this.model),this.event.emitCleared()}async destroy(){var t;return this.logger.info("destroy"),this.event.removeAllListeners(),this.grabber.detach(),this.layers.destroy(),this.renderer.destroy(),this.recognizer.destroy(),(t=this.smartGuide)==null||t.destroy(),Promise.resolve()}}Os=new WeakMap,ta=new WeakMap,Ig=new WeakMap,_g=new WeakMap;const dh={server:I0.server,recognition:I0.recognition,rendering:L7,grabber:tS,triggers:B7,"undo-redo":nS,logger:Zh,penStyle:Sn};class yge{constructor(e){k(this,"server");k(this,"recognition");k(this,"rendering");k(this,"undo-redo");k(this,"grabber");k(this,"triggers");k(this,"logger");k(this,"penStyle");const{server:t,recognition:n}=new I7(e);this.server=t,this.recognition=n,this.rendering=It({},dh.rendering,e==null?void 0:e.rendering),this.recognition.text.guides.enable=this.rendering.guides.enable,this.rendering.guides.enable&&(this.recognition.text.guides["line-gap-mm"]=sfe(this.rendering.guides.gap)),this.grabber=It({},dh.grabber,e==null?void 0:e.grabber),this["undo-redo"]=It({},dh["undo-redo"],e==null?void 0:e["undo-redo"]),this.triggers=It({},dh.triggers,e==null?void 0:e.triggers),this.logger=It({},dh.logger,e==null?void 0:e.logger),this.penStyle=It({},dh.penStyle,e==null?void 0:e.penStyle)}}var Tg;class vge extends N7{constructor(t){super(t);k(this,"editor");De(this,Tg);this.editor=t}get model(){return this.editor.model}createCurrentSymbol(t,n,s){return this.model.currentStroke=new Jn(n,s),this.model.currentStroke.addPointer(t),this.model.currentStroke}updateCurrentSymbol(t){var n;return((n=this.model.currentStroke)==null?void 0:n.type)===oe.Stroke&&this.model.currentStroke.addPointer(t),this.model.currentStroke}async end(t){const n=t.pointer,s=this.updateCurrentSymbol(n);this.model.currentStroke=void 0,this.renderer.drawSymbol(s),this.model.addStroke(s),this.editor.history.push(this.model,{added:[s]});const o=new Xt;if(this.editor.configuration.triggers.exportContent!=="DEMAND"){clearTimeout(j(this,Tg));const i=this.model.clone();Je(this,Tg,setTimeout(async()=>{try{const a=await this.editor.recognizer.send(this.model.strokes);i.mergeExport(a),this.model.modificationDate===i.modificationDate&&(this.model.exports=i.exports),this.editor.history.updateModelStack(i),this.editor.event.emitExported(i.exports||{}),o.resolve()}catch(a){this.editor.logger.error("updateModelRendering",{error:a}),this.editor.event.emitError(a),o.reject(a)}},this.editor.configuration.triggers.exportContent==="QUIET_PERIOD"?this.editor.configuration.triggers.exportContentDelay:0))}else o.resolve();return o.promise}}Tg=new WeakMap;var Mi,Ls,eu,Mg;class bge extends Jb{constructor(t,n){var s;super(t,n);De(this,Mi);De(this,Ls);De(this,eu);k(this,"renderer");k(this,"recognizer");k(this,"history");k(this,"writer");k(this,"eraser");k(this,"debugger");De(this,Mg,Pt.Write);if(Je(this,Mi,new yge(n==null?void 0:n.configuration)),Je(this,eu,Object.assign({},j(this,Mi).penStyle)),(s=n==null?void 0:n.override)==null?void 0:s.recognizer){const o=n.override.recognizer;this.recognizer=new o(j(this,Mi))}else this.recognizer=new Ife(j(this,Mi));this.renderer=new D7(j(this,Mi).rendering),Je(this,Ls,new Mk),this.writer=new vge(this),this.eraser=new F7(this),this.debugger=new Qfe(this),this.tool=Pt.Write,this.history=new tge(j(this,Mi)["undo-redo"],this.event)}get penStyle(){return j(this,eu)}set penStyle(t){this.logger.info("set penStyle",{penStyle:t}),Je(this,eu,Object.assign({},j(this,eu),t))}get initializationPromise(){return Promise.resolve()}get tool(){return j(this,Mg)}set tool(t){Je(this,Mg,t),this.writer.detach(),this.eraser.detach(),this.tool===Pt.Erase?(this.eraser.attach(this.layers.root),this.layers.root.classList.remove("draw"),this.layers.root.classList.add("erase")):(this.writer.attach(this.layers.root),this.layers.root.classList.add("draw"),this.layers.root.classList.remove("erase"))}get model(){return j(this,Ls)}get configuration(){return j(this,Mi)}async initialize(){try{this.logger.info("initialize"),this.layers.render(),this.layers.showLoader(),this.tool=Pt.Write,this.renderer.init(this.layers.rendering);const t=window.getComputedStyle(this.layers.root);this.model.width=Math.max(parseInt(t.width.replace("px","")),j(this,Mi).rendering.minWidth),this.model.height=Math.max(parseInt(t.height.replace("px","")),j(this,Mi).rendering.minHeight),this.model.rowHeight=this.configuration.rendering.guides.gap,this.history.init(this.model),this.recognizer.configuration.server.version||(await this.loadInfo(this.configuration.server),this.recognizer.configuration.server.version=this.info.version)}catch(t){throw this.logger.error("initialize",t),this.layers.showMessageError(t),t}finally{this.logger.debug("initialize","finally"),this.layers.hideLoader(),this.layers.updateState(!0)}}updateSymbolsStyle(t,n){this.logger.info("updateSymbolsStyle",{symbolIds:t,style:n}),this.model.strokes.forEach(s=>{t.includes(s.id)&&(s.style=Object.assign({},s.style,n),this.renderer.drawSymbol(s),this.model.updateStroke(s),s.modificationDate=Date.now())})}async export(t){this.logger.info("export");const n=await this.recognizer.send(this.model.strokes,t);return this.model.mergeExport(n),this.history.updateModelStack(this.model),this.event.emitExported(this.model.exports||{}),n}async resize({height:t,width:n}={}){this.logger.info("resize",{height:t,width:n});const s=window.getComputedStyle(this.layers.root);this.model.height=t||Math.max(parseInt(s.height.replace("px","")),this.configuration.rendering.minHeight),this.model.width=n||Math.max(parseInt(s.width.replace("px","")),this.configuration.rendering.minWidth),this.renderer.resize(this.model.height,this.model.width),this.logger.debug("resize",{model:this.model}),this.event.emitExported(this.model.exports)}async removeStrokes(t){this.logger.info("removeStrokes",{strokeIds:t});const n=this.model.strokes.filter(o=>t.includes(o.id));if(n.length===0)return void this.logger.warn("removeStrokes","No strokes found to remove");Je(this,Ls,this.model.clone()),n.forEach(o=>{this.renderer.removeSymbol(o.id),this.model.removeStroke(o.id)}),this.history.push(j(this,Ls),{removed:n});const s=await this.recognizer.send(this.model.strokes);this.model.mergeExport(s),this.history.updateModelStack(this.model),this.event.emitExported(j(this,Ls).exports),this.logger.debug("removeStrokes",{model:j(this,Ls)})}async undo(){this.logger.info("undo");const t=this.history.undo(),n=t.model.extractDifferenceStrokes(this.model);Je(this,Ls,t.model.clone()),n.removed.forEach(o=>this.renderer.removeSymbol(o.id)),n.added.forEach(o=>this.renderer.drawSymbol(o));const s=await this.recognizer.send(this.model.strokes);this.model.mergeExport(s),this.history.updateModelStack(this.model),this.event.emitExported(j(this,Ls).exports),this.logger.debug("undo",j(this,Ls))}async redo(){this.logger.info("redo");const t=this.history.redo(),n=t.model.extractDifferenceStrokes(this.model);Je(this,Ls,t.model.clone()),n.removed.forEach(o=>this.renderer.removeSymbol(o.id)),n.added.forEach(o=>this.renderer.drawSymbol(o));const s=await this.recognizer.send(this.model.strokes);this.model.mergeExport(s),this.history.updateModelStack(this.model),this.event.emitExported(j(this,Ls).exports),this.logger.debug("redo",j(this,Ls))}async clear(){this.logger.info("clear");const t=this.model.strokes;this.model.clear(),this.history.push(this.model,{removed:t}),this.renderer.clear(),this.event.emitExported(j(this,Ls).exports)}async destroy(){return this.logger.info("destroy"),this.event.removeAllListeners(),this.writer.detach(),this.layers.destroy(),this.renderer.destroy(),Promise.resolve()}}Mi=new WeakMap,Ls=new WeakMap,eu=new WeakMap,Mg=new WeakMap;const To=class To{static async load(e,t,n){if(To.logger.info("load",{type:t,options:n}),!n)throw new Error("Param 'options' missing");switch(To.instance&&await To.instance.destroy(),t){case"INTERACTIVEINK":To.instance=new Ak(e,n);break;case"INKV1":To.instance=new hge(e,n);break;case"INKV2":To.instance=new bge(e,n);break;default:To.instance=new mge(e,n)}return await To.instance.initialize(),To.instance}static getInstance(){return To.instance}};k(To,"logger",Rt.getLogger(lt.EDITOR)),k(To,"instance");let wO=To;const Lf=class Lf extends M7{constructor(t){super(t);k(this,"messages");this.messages=[]}messageCallback(t){super.messageCallback(t);const n=JSON.parse(t.data);this.messages.push({state:"Received",message:n})}send(t){return this.messages.push({state:"Sent",message:t}),super.send(t)}destroy(){return Lf.initializing=!1,super.destroy()}};k(Lf,"initializing",!1),k(Lf,"instance");let oa=Lf;const sB=async()=>{if(!oa.initializing){oa.initializing=!0;const e=await(await fetch("../../../server-configuration.json")).json(),t={"raw-content":{gestures:["underline","scratch-out","join","insert","strike-through","surround"]},gesture:{enable:!0,ignoreGestureStrokes:!1}};oa.instance=new oa({server:e,recognition:t}),await oa.instance.init()}return oa.instance};class Cf{constructor(e){k(this,"editor");k(this,"onUnderline","size");k(this,"onStrikethrough","erase");this.editor=e}get drawShapes(){return this.editor.getCurrentPageShapes().filter(e=>e.type==="draw")}async applySurround(e){const t=this.editor.getCurrentPageShapes().find(i=>i.id===e.gestureStrokeId),n=this.editor.getCurrentPageShapes().filter(i=>i.id!==e.gestureStrokeId);if(!t||!n.length)return;const s=this.editor.getShapePageBounds(t);if(!s)return;const o=n.filter(i=>s.contains(this.editor.getShapePageBounds(i)));o.length&&(this.editor.setCurrentTool("select"),this.editor.setSelectedShapes(o),this.editor.deleteShape(t))}async applyScratch(e){const t=this.editor.getCurrentPageShapes().find(i=>i.id===e.gestureStrokeId),n=this.editor.getCurrentPageShapes().filter(i=>i.id!==e.gestureStrokeId);if(!t||!n.length)return;const s=this.editor.getShapePageBounds(t);if(!s)return;const o=n.filter(i=>s.contains(this.editor.getShapePageBounds(i)));o.length&&this.editor.deleteShapes([e.gestureStrokeId,...o.map(i=>i.id)])}async applyUnderline(e){const t=this.editor.getCurrentPageShapes().find(s=>s.id===e.gestureStrokeId),n=this.editor.getCurrentPageShapes().filter(s=>e.strokeIds.includes(s.id));if(!(!t||!n.length)&&this.onUnderline==="size"){const s=["s","m","l","xl"],o=[];n.forEach(i=>{const a=s.indexOf(i.props.size);o.push({...i,props:{...i.props,size:s[Math.min(a+1,s.length-1)]}})}),o.length&&this.editor.batch(()=>{this.editor.deleteShape(t),this.editor.updateShapes(o)})}}async applyStrikeThrough(e){if(this.onStrikethrough==="erase"){const t=this.editor.getCurrentPageShapes().find(s=>s.id===e.gestureStrokeId),n=this.editor.getCurrentPageShapes().filter(s=>e.strokeIds.includes(s.id));if(!t||!n.length)return;this.editor.deleteShapes([t,...n])}}async apply(e){switch(e.gestureType){case"SCRATCH":return this.applyScratch(e);case"SURROUND":return this.applySurround(e);case"STRIKETHROUGH":this.applyStrikeThrough(e);break;case"UNDERLINE":this.applyUnderline(e);break}}}k(Cf,"instance");const oB=r=>(Cf.instance||(Cf.instance=new Cf(r)),Cf.instance);class Ef{constructor(e){k(this,"editor");k(this,"gestureManager");k(this,"processGestures",!0);k(this,"updateDebounce");k(this,"drawShapeToAdd",[]);k(this,"drawShapeToUpdate",[]);k(this,"drawShapeToRemove",[]);this.editor=e,this.gestureManager=oB(e)}formatDrawShapeToSend(e){const t={color:e.props.color,fill:e.props.fill,width:1},n=new Jn(t,e.props.isPen?"pen":"mouse");return n.id=e.id,e.props.segments.forEach(s=>{s.points.forEach((o,i)=>{n.addPointer({p:1,t:Date.now()+i*20,x:o.x+e.x,y:o.y+e.y})})}),n}async determinesContextlessGesture(e){const t=e[0];if(!t)return;const n=this.editor.getCurrentPageShapes().filter(i=>i.id!==t.id&&i.typeName==="shape"&&i.type!=="draw");if(!n.length)return;const s=this.editor.getShapePageBounds(t);if(!n.some(i=>s.contains(this.editor.getShapePageBounds(i))))return;const o=await oa.instance.recognizeGesture(this.formatDrawShapeToSend(t));if(o){if(o.gestureType=="surround"&&n.some(i=>s.contains(this.editor.getShapePageBounds(i))))return{gestureStrokeId:t.id,gestureType:"SURROUND",strokeIds:[],strokeBeforeIds:[],strokeAfterIds:[]};if(o.gestureType=="scratch"&&n.some(i=>s.contains(this.editor.getShapePageBounds(i))))return{gestureStrokeId:t.id,gestureType:"SCRATCH",strokeIds:[],strokeBeforeIds:[],strokeAfterIds:[]}}}async sync(e){for(const n of Object.values(e.added))n.typeName==="shape"&&n.type==="draw"&&this.drawShapeToAdd.push(n);for(const[n,s]of Object.values(e.updated))if(s.typeName==="shape"&&s.type==="draw"){const o=s;if(this.drawShapeToAdd.find(a=>a.id===o.id)){const a=this.drawShapeToAdd.findIndex(l=>l.id===o.id);this.drawShapeToAdd.splice(a,1,o)}else{const a=this.drawShapeToUpdate.findIndex(l=>l.id===o.id);a>-1?this.drawShapeToUpdate[a]=o:this.drawShapeToUpdate.push(o)}}for(const n of Object.values(e.removed))n.typeName==="shape"&&n.type==="draw"&&this.drawShapeToRemove.push(n);if(!this.drawShapeToAdd.filter(n=>n.props.isComplete).length&&!this.drawShapeToUpdate.length&&!this.drawShapeToRemove.length)return;const t=await sB();if(this.drawShapeToAdd.length){const n=this.drawShapeToAdd.filter(s=>s.props.isComplete);if(this.drawShapeToAdd=this.drawShapeToAdd.filter(s=>!s.props.isComplete),n.length){const s=this.processGestures&&n.length===1?await this.determinesContextlessGesture(n):void 0;t.addStrokes(n.map(this.formatDrawShapeToSend),this.processGestures&&!s&&n.length===1).then(o=>{o&&this.gestureManager.apply(o)}),s&&await this.gestureManager.apply(s)}}if(this.drawShapeToUpdate.length){clearTimeout(this.updateDebounce);const n=new Xt;this.updateDebounce=setTimeout(async()=>{const s=this.drawShapeToUpdate.map(o=>{const i=this.formatDrawShapeToSend(o);let a=o.props.segments.flatMap(c=>c.points);const l=this.editor.getShapePageTransform(o.id);return l&&(a=l.applyToPoints(a)),i.pointers=a.map((c,u)=>({p:1,t:Date.now()+u,x:c.x,y:c.y})),i});await t.replaceStrokes(s.map(o=>o.id),s),n.resolve(),this.drawShapeToUpdate=[]},500),await n}if(this.drawShapeToRemove.length){const n=t==null?void 0:t.eraseStrokes(this.drawShapeToRemove.map(s=>s.id));this.drawShapeToRemove=[],await n}}}k(Ef,"instance");const iB=r=>(Ef.instance||(Ef.instance=new Ef(r)),Ef.instance);function Sge(r){if(r.loading)return g.jsx("div",{style:{backgroundColor:"white",opacity:.75,zIndex:999,position:"absolute",top:0,left:0,height:"inherit",width:"inherit",display:"flex",alignItems:"center",justifyContent:"center"},children:g.jsx("div",{className:"loader"})})}function xge(r){return g.jsx("iframe",{style:{height:"calc(100% - 3px)",width:"100%",border:"none"},srcDoc:r})}const aB=Lpe({reducer:{exports:Xpe,errors:Qpe}});class kf{constructor(){k(this,"font","draw")}get jiixExport(){return aB.getState().exports.value["application/vnd.myscript.jiix"]}findJiixElements(e){var t,n;return((n=(t=this.jiixExport)==null?void 0:t.elements)==null?void 0:n.filter(s=>{var o,i,a;return((o=s.items)==null?void 0:o.some(l=>l["full-id"]===e.id))||((i=s.words)==null?void 0:i.some(l=>{var c;return(c=l.items)==null?void 0:c.some(u=>u["full-id"]===e.id)}))||((a=s.chars)==null?void 0:a.some(l=>{var c;return(c=l.items)==null?void 0:c.some(u=>u["full-id"]===e.id)}))}))||[]}findDerivation(e){const t=e.flatMap(n=>n.props.segments.flatMap(s=>s.points.flatMap(o=>o)));return{dx:Math.min(...t.map(n=>n.x)),dy:Math.min(...t.map(n=>n.y))}}createArrowShape(e,t,n,s,o,i,a=0,l="none",c="none"){return{typeName:"shape",type:"arrow",id:vn(e),index:t.index,isLocked:t.isLocked,opacity:t.opacity,x:n,y:s,rotation:0,props:{color:t.props.color,dash:t.props.dash,size:t.props.size,bend:a,start:{x:0,y:0},end:{x:o,y:i},arrowheadStart:l,arrowheadEnd:c}}}convertEdge(e,t){const n=t.filter(m=>{var v;return(v=e.items)==null?void 0:v.some(b=>b["full-id"]===m.id)});if(!n.length)return;const s=n[0],o=s.x,i=s.y;let a,l,c="none",u="none",p=0,f=!1;switch(e.kind){case"line":{const m=e;a=ot(m.x2-m.x1),l=ot(m.y2-m.y1),m.p1Decoration&&(c="arrow"),m.p2Decoration&&(u="arrow"),f=!0;break}case"arc":{const m=e,v=ot(m.cx),b=ot(m.cy);a=(v-o)*2,l=(b-i)*2,p=ot(m.rx+m.ry)/2,m.sweepAngle>0&&(p=-p),m.startDecoration&&(c="arrow"),m.endDecoration&&(u="arrow"),f=!0;break}default:console.warn("convertEdge",`Conversion of Edge with kind equal to ${e.kind} is unknow`);break}if(f)return this.createArrowShape(e.id,s,o,i,a,l,p,c,u)}convertText(e,t){const n=t.filter(i=>{var a,l;return((a=e.words)==null?void 0:a.some(c=>{var u;return(u=c.items)==null?void 0:u.some(p=>p["full-id"]===i.id)}))||((l=e.chars)==null?void 0:l.some(c=>{var u;return(u=c.items)==null?void 0:u.some(p=>p["full-id"]===i.id)}))});if(!n.length)return;const s=n[0],{dy:o}=this.findDerivation(n);return{typeName:"shape",type:"text",id:vn(e.id),index:s.index,isLocked:s.isLocked,opacity:s.opacity,x:s.x,y:s.y+o,rotation:0,props:{color:s.props.color,size:s.props.size,text:e.label,font:this.font,textAlign:"start"}}}createGeoShapeFromNode(e,t,n,s,o,i,a){return{typeName:"shape",type:"geo",id:vn(e),index:t.index,isLocked:t.isLocked,opacity:t.opacity,x:s,y:o,rotation:t.rotation,props:{color:t.props.color,dash:t.props.dash,size:t.props.size,fill:t.props.fill,geo:n,w:i,h:a}}}convertNode(e,t){const n=t.filter(f=>{var m;return(m=e.items)==null?void 0:m.some(v=>v["full-id"]===f.id)});if(!n.length)return;const{dx:s,dy:o}=this.findDerivation(n),i=n[0],a=i.x+s,l=i.y+o;let c,u=0,p=0;switch(e.kind){case"circle":{const f=e;c="ellipse",u=ot(f.r)*2,p=ot(f.r)*2;break}case"ellipse":{const f=e;c="ellipse",u=ot(f.rx)*2,p=ot(f.ry)*2;break}case"rectangle":{const f=e;c="rectangle",u=ot(f.width),p=ot(f.height);break}case"triangle":{const f=e;c="triangle",u=ot(f["bounding-box"].width),p=ot(f["bounding-box"].height);break}case"rhombus":{const f=e;c="diamond",u=ot(f["bounding-box"].width),p=ot(f["bounding-box"].height);break}default:console.warn("convertNode",`Conversion of Node with kind equal to ${e.kind} is unknow`)}if(c)return this.createGeoShapeFromNode(e.id,i,c,a,l,u,p)}convert(e){const t=[],n=[];let s=structuredClone(e),o=s.length-1;for(;s.length&&o>=0;){const i=s.shift(),a=this.findJiixElements(i),l=[...new Set([...a.map(c=>{var u;return(u=c.items)==null?void 0:u.map(p=>p["full-id"])}).flat(),...a.map(c=>{var u;return(u=c.words)==null?void 0:u.map(p=>{var f;return(f=p.items)==null?void 0:f.map(m=>m["full-id"])})}).flat(2),...a.map(c=>{var u;return(u=c.chars)==null?void 0:u.map(p=>{var f;return(f=p.items)==null?void 0:f.map(m=>m["full-id"])})}).flat(2)])];a.forEach(c=>{let u;try{switch(c.type){case"Node":{u=this.convertNode(c,e);break}case"Text":{u=this.convertText(c,e);break}case"Edge":{u=this.convertEdge(c,e);break}default:{console.warn("convert",`Unknow jiix element type: ${c.type}`);break}}}catch(p){console.error("error: ",p)}u&&(t.push(u),n.push(...l)),s=s.filter(p=>!l.includes(p.id)),o--})}return{toConvert:t.filter(i=>i),toRemove:n.filter(i=>i)}}}k(kf,"instance");const lB=()=>(kf.instance||(kf.instance=new kf),kf.instance);function wge(){const r=ue(),e=lB(),t=iB(r),n=oB(r),[s,o]=I.useState(t.processGestures),[i,a]=I.useState(n.onUnderline==="size"),[l,c]=I.useState(n.onStrikethrough==="erase"),u=()=>{const p=r.getCurrentPageShapes().filter(v=>v.type==="draw"),{toConvert:f,toRemove:m}=e.convert(p);r.batch(()=>{r.deleteShapes(m),r.createShapes(f)})};return I.useEffect(()=>{t.processGestures=s},[s]),I.useEffect(()=>{n.onUnderline=i?"size":"draw"},[i]),I.useEffect(()=>{n.onStrikethrough=l?"erase":"draw"},[l]),g.jsxs(b$,{children:[g.jsxs(_t,{id:"gesture-group",label:"Gesture",children:[g.jsx(ou,{id:"gesture",checked:s,label:"Gesture enable",onSelect:()=>o(!s)}),g.jsx(ou,{id:"on-underline",checked:i,label:"Change size on underline (only draw shape)",onSelect:()=>a(!i)}),g.jsx(ou,{id:"on-strikethrough",checked:l,label:"Erase on strikethrough (only draw shape)",onSelect:()=>c(!l)})]}),g.jsx(_t,{id:"convert-group",children:g.jsx(Wr,{id:"convert",label:"Convert",readonlyOk:!0,kbd:"$c",onSelect:u})}),g.jsx(v$,{})]})}function Cge(){const[r,e]=I.useState([]),t=ue(),n=lB(),s=()=>{const{toConvert:o,toRemove:i}=n.convert(r);i.length&&t.deleteShapes(i),o.length&&t.createShapes(o)};return t.on("update",()=>{e(t.getSelectedShapes().filter(o=>o.type==="draw"))},t),r.length?g.jsxs(fk,{children:[g.jsx(_t,{id:"example",children:g.jsx(Wr,{id:"convert-selection",label:"Convert",readonlyOk:!0,onSelect:s})}),g.jsx(pk,{})]}):g.jsx(fk,{children:g.jsx(pk,{})})}function Ege(r){return g.jsxs("div",{className:`modal ${r.type}`,children:[g.jsx("h3",{className:"modal-header",children:r.title}),g.jsx("div",{className:"modal-content",children:r.message}),g.jsx("div",{className:"modal-footer",children:g.jsx("button",{className:"close-btn",onPointerUp:r.onClose,children:"Close"})})]})}function kge(){const[r,e]=I.useState(),[t,n]=I.useState(),[s,o]=I.useState(!0),[i,a]=I.useState("HTML"),[l,c]=I.useState(60),u=GT(E=>E.exports.value),p=GT(E=>E.errors.value),f=dH(),m=async()=>{try{n(await sB())}catch(E){f(gO(typeof E=="string"?E:E.message))}o(!1)},v=I.useCallback(E=>{e(E),E.setCurrentTool("draw")},[]);let b;const S=async()=>{clearTimeout(b),b=setTimeout(async()=>{const E=await t.export(["application/vnd.myscript.jiix","text/html"]);f(Ype(E))},500)};I.useEffect(()=>{if(!r||!t)return;t.event.addContentChangedListener(S);const E=async T=>{if(T.source==="user")try{await iB(r).sync(T.changes)}catch(w){f(gO(typeof w=="string"?w:w.message))}};return r.on("change",E),()=>{r.off("change",E),t.destroy()}},[r,t]),I.useEffect(()=>{oa.instance||m()},[oa.instance]);const C=()=>{const E=T=>c(T.clientX/window.innerWidth*100);document.body.addEventListener("pointermove",E),document.body.addEventListener("pointerup",()=>document.body.removeEventListener("pointermove",E))};return g.jsxs("div",{style:{display:"flex",height:"100%",width:"100%"},children:[p.map((E,T)=>g.jsx(Ege,{type:"error",title:"Something went wrong",message:E,onClose:()=>f(Jpe(E))},T)),g.jsxs("div",{style:{width:`${l}%`,height:"100%"},children:[g.jsx(Sge,{loading:s}),g.jsx(lpe,{components:{MainMenu:wge,ContextMenu:Cge,PageMenu:null},onMount:v})]}),g.jsxs("div",{style:{width:`${100-l}%`,height:"100%",display:"flex"},children:[g.jsx("div",{style:{width:"5px",background:"lightgrey",cursor:"ew-resize"},onPointerDown:C}),g.jsxs("div",{style:{width:"calc(100% - 5px)",padding:12,background:"#eee",border:"none",overflow:"hidden"},children:[g.jsxs("div",{className:"tabs",children:[g.jsx("button",{className:`tab-btn ${i==="Shapes"?"active":""}`,onClick:()=>a("Shapes"),children:"Shapes"}),g.jsx("button",{className:`tab-btn ${i==="JIIX"?"active":""}`,onClick:()=>a("JIIX"),children:"Export JIIX"}),g.jsx("button",{className:`tab-btn ${i==="HTML"?"active":""}`,onClick:()=>a("HTML"),children:"Export HTML"}),g.jsx("button",{className:`tab-btn ${i==="Messages"?"active":""}`,onClick:()=>a("Messages"),children:"Messages"})]}),g.jsxs("div",{style:{height:"calc(100% - 70px)",backgroundColor:"white",overflow:"scroll",padding:12},children:[g.jsx("div",{id:"shapes-tab-content",className:`tab-content ${i==="Shapes"?"active":""}`,children:g.jsx(Lx,{src:r==null?void 0:r.getCurrentPageShapes(),collapsed:!0})}),g.jsx("div",{id:"jiix-tab-content",className:`tab-content ${i==="JIIX"?"active":""}`,children:g.jsx(Lx,{src:u["application/vnd.myscript.jiix"],collapsed:!0})}),g.jsx("div",{id:"html-tab-content",style:{pointerEvents:"none"},className:`tab-content ${i==="HTML"?"active":""}`,children:xge(u["text/html"])}),g.jsx("div",{id:"messages-tab-content",className:`tab-content ${i==="Messages"?"active":""}`,children:g.jsx(Lx,{src:(t==null?void 0:t.messages)||[],collapsed:!0})})]})]})]})]})}const Pge=EO.createRoot(document.getElementById("root"));Pge.render(g.jsx(Ht.StrictMode,{children:g.jsx(aH,{store:aB,children:g.jsx(kge,{})})}))});export default Ige();
